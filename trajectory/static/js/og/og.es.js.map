{"version":3,"file":"og.es.js","sources":["../src/math.ts","../src/LonLat.ts","../src/mercator.ts","../src/Extent.ts","../src/math/Mat3.ts","../src/math/Vec4.ts","../src/math/Mat4.ts","../src/math/Quat.ts","../src/math/Vec3.ts","../src/math/Vec2.ts","../src/utils/colorTable.ts","../src/ellipsoid/Ellipsoid.ts","../src/ellipsoid/wgs84.ts","../src/utils/shared.ts","../src/astro/jd.ts","../src/bv/Box.ts","../src/bv/Sphere.ts","../src/Events.ts","../src/ui/View.ts","../src/ui/Button.ts","../src/control/Control.ts","../src/control/CompassButton.ts","../src/ui/icons.ts","../src/ui/Dialog.ts","../src/ui/ToggleButton.ts","../src/quadTree/quadTree.ts","../src/layer/Material.ts","../src/layer/Layer.ts","../src/layer/CanvasTiles.ts","../src/control/DebugInfo.ts","../src/ui/ButtonGroup.ts","../src/utils/BaseWorker.ts","../src/entity/LabelWorker.ts","../src/entity/BaseBillboard.ts","../src/entity/Billboard.ts","../src/entity/Geometry.ts","../src/math/Line2.ts","../src/math/Line3.ts","../src/math/Plane.ts","../src/math/Ray.ts","../src/utils/objParser.ts","../src/Object3d.ts","../src/entity/GeoObject.ts","../src/entity/Label.ts","../src/entity/PointCloud.ts","../src/entity/Polyline.ts","../src/entity/Ray.ts","../src/entity/Strip.ts","../src/entity/Entity.ts","../src/scene/BaseNode.ts","../src/scene/RenderNode.ts","../src/cons.ts","../src/webgl/types.ts","../src/webgl/variableHandlers.ts","../src/webgl/Program.ts","../src/shaders/billboard/billboard_picking.vert.glsl","../src/shaders/billboard/billboard_picking.frag.glsl","../src/shaders/billboard/billboard_screen.vert.glsl","../src/shaders/billboard/billboard_screen.frag.glsl","../src/shaders/billboard/billboard.ts","../src/entity/BaseBillboardHandler.ts","../src/entity/BillboardHandler.ts","../src/shaders/geo_object/geo_object.vert.glsl","../src/shaders/geo_object/geo_object.frag.glsl","../src/shaders/geo_object/geo_object_picking.vert.glsl","../src/shaders/geo_object/geo_object_picking.frag.glsl","../src/shaders/geo_object/geo_object_depth.vert.glsl","../src/shaders/geo_object/geo_object_depth.frag.glsl","../src/shaders/geo_object/geo_object.ts","../src/entity/InstanceData.ts","../src/entity/GeoObjectHandler.ts","../src/shaders/label/label_webgl2.vert.glsl","../src/shaders/label/label_webgl2.frag.glsl","../src/shaders/label/label_webgl1.vert.glsl","../src/shaders/label/label_webgl1.frag.glsl","../src/shaders/label/label_picking.vert.glsl","../src/shaders/label/label_picking.frag.glsl","../src/shaders/label/label.ts","../src/entity/LabelHandler.ts","../src/shaders/pointCloud.ts","../src/entity/PointCloudHandler.ts","../src/shaders/polyline/polyline_screen.vert.glsl","../src/shaders/polyline/polyline_screen.frag.glsl","../src/shaders/polyline/polyline_picking.vert.glsl","../src/shaders/polyline/polyline_picking.frag.glsl","../src/shaders/polyline/polyline.ts","../src/entity/PolylineHandler.ts","../src/shaders/ray/ray.vert.glsl","../src/shaders/ray/ray.frag.glsl","../src/shaders/ray/ray.ts","../src/entity/RayHandler.ts","../src/entity/StripHandler.ts","../src/entity/EntityCollection.ts","../src/math/coder.ts","../src/utils/earcut.ts","../src/entity/GeometryHandler.ts","../src/layer/Vector.ts","../src/control/drawing/PolygonDrawingScene.ts","../src/control/drawing/LineStringDrawingScene.ts","../src/control/drawing/DrawingControl.ts","../src/control/DrawingSwitcher.ts","../src/utils/units.ts","../src/control/EarthCoordinates.ts","../src/layer/BaseGeoImage.ts","../src/control/GeoImageDragControl.ts","../src/input/input.ts","../src/control/KeyboardNavigation.ts","../src/control/LayerAnimation.ts","../src/control/LayerSwitcher.ts","../src/ui/Slider.ts","../src/ui/Color.ts","../src/control/Lighting.ts","../src/Lock.ts","../src/control/OldMouseNavigation.ts","../src/control/MouseNavigation.ts","../src/control/ruler/RulerScene.ts","../src/control/ruler/Ruler.ts","../src/control/heightRuler/HeightRulerScene.ts","../src/control/heightRuler/HeightRuler.ts","../src/control/RulerSwitcher.ts","../src/control/ScaleControl.ts","../src/control/ShowFps.ts","../src/control/SimpleNavigation.ts","../src/control/SimpleSkyBackground.ts","../src/astro/astro.ts","../src/astro/earth.ts","../src/light/LightSource.ts","../src/control/Sun.ts","../src/control/ToggleWireframe.ts","../src/control/TouchNavigation.ts","../src/control/ZoomControl.ts","../src/control/selection/SelectionScene.ts","../src/control/selection/Selection.ts","../src/control/timeline/timelineUtils.ts","../src/control/timeline/TimelineModel.ts","../src/control/timeline/TimelineView.ts","../src/control/timeline/TimelineControl.ts","../src/Deferred.ts","../src/control/elevationProfile/ElevationProfile.ts","../src/control/elevationProfile/ElevationProfileView.ts","../src/control/elevationProfile/ElevationProfileScene.ts","../src/control/elevationProfile/ElevationProfileButtonsView.ts","../src/control/elevationProfile/PointListDialog.ts","../src/control/elevationProfile/ElevationProfileLegend.ts","../src/control/elevationProfile/ElevationProfileControl.ts","../src/control/atmosphere/AtmosphereConfig.ts","../src/control/geoObjectEditor/colors.ts","../src/control/geoObjectEditor/ArrowEntity.ts","../src/control/geoObjectEditor/MoveAxisEntity.ts","../src/control/geoObjectEditor/MovePlaneEntity.ts","../src/control/geoObjectEditor/RotateEntity.ts","../src/control/geoObjectEditor/AxisTrackEntity.ts","../src/control/geoObjectEditor/GeoObjectEditorScene.ts","../src/ui/Input.ts","../src/ui/Checkbox.ts","../src/control/geoObjectEditor/GeoObjectEditorDialog.ts","../src/control/CameraLock.ts","../src/control/geoObjectEditor/GeoObjectEditor.ts","../src/control/object3dManager/Object3dItemView.ts","../src/control/object3dManager/Object3dCollectionView.ts","../src/control/object3dManager/Object3dManagerDialog.ts","../src/control/object3dManager/Object3dCollection.ts","../src/control/object3dManager/Object3dManager.ts","../src/control/CameraFrameComposer.ts","../src/scene/Axes.ts","../src/segment/segmentHelper.ts","../src/shaders/drawnode/drawnode_screen_nl.vert.glsl","../src/shaders/drawnode/drawnode_screen_nl.frag.glsl","../src/shaders/drawnode/drawnode_screen_wl_webgl1NoAtmos.vert.glsl","../src/shaders/drawnode/drawnode_screen_wl_webgl1NoAtmos.frag.glsl","../src/shaders/drawnode/drawnode_screen_wl_webgl2Atmos.vert.glsl","../src/shaders/drawnode/drawnode_screen_wl_webgl2Atmos.frag.glsl","../src/shaders/drawnode/drawnode_screen_wl_webgl2NoAtmos.vert.glsl","../src/shaders/drawnode/drawnode_screen_wl_webgl2NoAtmos.frag.glsl","../src/shaders/drawnode/drawnode_colorPicking.vert.glsl","../src/shaders/drawnode/drawnode_colorPicking.frag.glsl","../src/shaders/drawnode/drawnode_depth.vert.glsl","../src/shaders/drawnode/drawnode_depth.frag.glsl","../src/shaders/drawnode/drawnode.ts","../src/shaders/atmos/transmittance.vert.glsl","../src/shaders/atmos/transmittance.frag.glsl","../src/shaders/atmos/scattering.vert.glsl","../src/shaders/atmos/scattering.frag.glsl","../src/shaders/atmos/atmos.ts","../src/webgl/BaseFramebuffer.ts","../src/ImageCanvas.ts","../src/webgl/Framebuffer.ts","../src/control/atmosphere/atmosphere.vert.glsl","../src/control/atmosphere/atmosphere.frag.glsl","../src/control/atmosphere/Atmosphere.ts","../src/proj/Proj.ts","../src/proj/EPSG3857.ts","../src/segment/Slice.ts","../src/segment/Segment.ts","../src/quadTree/Node.ts","../src/QueueArray.ts","../src/quadTree/EntityCollectionsTreeStrategy.ts","../src/quadTree/QuadTreeStrategy.ts","../src/proj/EPSG4326.ts","../src/segment/SegmentLonLat.ts","../src/quadTree/EntityCollectionNode.ts","../src/quadTree/earth/EarthEntityCollectionNodeLonLat.ts","../src/quadTree/earth/EarthEntityCollectionsTreeStrategy.ts","../src/quadTree/earth/EarthQuadTreeStrategy.ts","../src/terrain/Geoid.ts","../src/utils/GeoImageCreator.ts","../src/utils/Loader.ts","../src/utils/NormalMapCreator.ts","../src/proj/equi.ts","../src/utils/PlainSegmentWorker.ts","../src/camera/Frustum.ts","../src/camera/Camera.ts","../src/camera/PlanetCamera.ts","../src/utils/TerrainWorker.ts","../src/utils/VectorTileCreator.ts","../src/scene/Planet.ts","../src/shaders/skybox.ts","../src/scene/SkyBox.ts","../src/terrain/EmptyTerrain.ts","../src/terrain/GlobusTerrain.ts","../src/layer/XYZ.ts","../src/layer/WMS.ts","../src/terrain/BilTerrain.ts","../src/terrain/RgbTerrain.ts","../src/terrain/GlobusRgbTerrain.ts","../src/layer/GeoImage.ts","../src/layer/GeoTexture2d.ts","../src/layer/GeoVideo.ts","../src/layer/KML.ts","../src/layer/OpenStreetMap.ts","../src/layer/Bing.ts","../src/Clock.ts","../src/webgl/ProgramController.ts","../src/Stack.ts","../src/webgl/Handler.ts","../src/webgl/Multisample.ts","../src/input/KeyboardHandler.ts","../src/input/MouseHandler.ts","../src/input/TouchHandler.ts","../src/renderer/RendererEvents.ts","../src/shaders/depth.ts","../src/Rectangle.ts","../src/utils/ImagesCacheManager.ts","../src/utils/TextureAtlas.ts","../src/utils/FontAtlas.ts","../src/shaders/screenFrame.ts","../src/shaders/tone_mapping/tone_mapping.vert.glsl","../src/shaders/tone_mapping/tone_mapping.frag.glsl","../src/shaders/tone_mapping/toneMapping.ts","../src/renderer/Renderer.ts","../src/Globe.ts","../src/ellipsoid/mars.ts","../src/ellipsoid/moon.ts","../src/Popup.ts","../src/segment/SegmentLonLatEqui.ts","../src/quadTree/equi/EquiEntityCollectionNodeLonLat.ts","../src/quadTree/equi/EquiEntityCollectionsTreeStrategy.ts","../src/quadTree/equi/EquiQuadTreeStrategy.ts","../src/quadTree/EPSG4326/EPSG4326QuadTreeStrategy.ts","../src/quadTree/wgs84/Wgs84QuadTreeStrategy.ts","../src/quadTree/index.ts"],"sourcesContent":["import {Vec3} from \"./math/Vec3\";\r\n\r\n/** @const */\r\nexport const TWO_PI = 2.0 * Math.PI;\r\n\r\n/** @const */\r\nexport const PI_TWO = Math.PI / 2.0;\r\n\r\nexport const X = 0;\r\nexport const Y = 1;\r\nexport const Z = 2;\r\nexport const W = 3;\r\n\r\nexport const MAX_FLOAT = Number.MAX_VALUE || 1.7976931348623157e308;\r\n\r\n/** @const */\r\nexport const LOG2 = Math.log(2);\r\n/** @const */\r\nexport const MAX32 = 2147483647;\r\n/** @const */\r\nexport const MAX = 549755748352;\r\n/** @const */\r\nexport const MIN = -MAX;\r\n\r\n/** @const */\r\nexport const RADIANS = Math.PI / 180.0;\r\n/** @const */\r\nexport const DEGREES = 180.0 / Math.PI;\r\n\r\n/** @const */\r\nexport const DEGREES_DOUBLE = 2.0 * DEGREES;\r\n/** @const */\r\nexport const RADIANS_HALF = 0.5 * RADIANS;\r\n\r\n/** @const */\r\nexport const ARCSECONDS_TO_RADIANS = 0.00000484813681109536;\r\n/** @const */\r\nexport const RADIANS_TO_HOURS = 3.8197186342054880584532103209403;\r\n/** @const */\r\nexport const HOURS_TO_RADIANS = 0.26179938779914943653855361527329;\r\n/** @const */\r\nexport const HOURS_TO_DEGREES = 15.0;\r\n/** @const */\r\nexport const DEGREES_TO_HOURS = 1.0 / 15.0;\r\n\r\n/** @const */\r\nexport const SQRT_HALF = Math.sqrt(0.5);\r\n\r\nexport const EPS1 = 1e-1;\r\nexport const EPS2 = 1e-2;\r\nexport const EPS3 = 1e-3;\r\nexport const EPS4 = 1e-4;\r\nexport const EPS5 = 1e-5;\r\nexport const EPS6 = 1e-6;\r\nexport const EPS7 = 1e-7;\r\nexport const EPS8 = 1e-8;\r\nexport const EPS9 = 1e-9;\r\nexport const EPS10 = 1e-10;\r\nexport const EPS11 = 1e-11;\r\nexport const EPS12 = 1e-12;\r\nexport const EPS13 = 1e-13;\r\nexport const EPS14 = 1e-14;\r\nexport const EPS15 = 1e-15;\r\nexport const EPS16 = 1e-16;\r\nexport const EPS17 = 1e-17;\r\nexport const EPS18 = 1e-18;\r\nexport const EPS19 = 1e-19;\r\nexport const EPS20 = 1e-20;\r\n\r\n/**\r\n * The log function returns the power to which the base value has to be raised to produce n.\r\n * @function\r\n * @param {number} n - Produce value.\r\n * @param {number} base - Base value.\r\n * @returns {number} -\r\n * @example\r\n * log(64, 2)\r\n * //returns 6\r\n */\r\nexport function log(n: number, base: number): number {\r\n    return Math.log(n) / Math.log(base);\r\n}\r\n\r\n/**\r\n * Clamp the number.\r\n * @function\r\n * @param {number} value - Input number.\r\n * @param {number} min - Minimal edge.\r\n * @param {number} max - Maximal edge.\r\n * @returns {number} -\r\n * @example\r\n * clamp(12, 1, 5)\r\n * //returns 5\r\n */\r\nexport function clamp(value: number, min: number, max: number): number {\r\n    return Math.max(min, Math.min(value, max));\r\n}\r\n\r\n/**\r\n * Converts degrees value to radians.\r\n * @function\r\n * @param {number} degrees - Degree value.\r\n * @returns {number} -\r\n */\r\nexport function DEG2RAD(degrees: number): number {\r\n    return degrees * RADIANS;\r\n}\r\n\r\n/**\r\n * Converts radians value to degrees.\r\n * @function\r\n * @param {number} angle - Degree value.\r\n * @returns {number} -\r\n */\r\nexport function RAD2DEG(angle: number): number {\r\n    return angle * DEGREES;\r\n}\r\n\r\n/**\r\n * Check the number is a power of two.\r\n * @function\r\n * @param {number} x - Input value.\r\n * @returns {boolean} -\r\n */\r\nexport function isPowerOfTwo(x: number): boolean {\r\n    return (x & (x - 1)) === 0;\r\n}\r\n\r\n/**\r\n * Returns next value that is power of two.\r\n * @function\r\n * @param {number} x - Input value.\r\n * @param {number} [maxValue=4096] - Maximal value.\r\n * @returns {number} -\r\n */\r\nexport function nextHighestPowerOfTwo(x: number, maxValue: number = 4096): number {\r\n    --x;\r\n    for (let i = 1; i < 32; i <<= 1) {\r\n        x = x | (x >> i);\r\n    }\r\n    return (x + 1) > maxValue ? maxValue : x + 1\r\n}\r\n\r\n/**\r\n * Returns random integer number within the bounds.\r\n * @function\r\n * @param {number} min - Minimal bound.\r\n * @param {number} max - Maximal bound.\r\n * @returns {number} -\r\n */\r\nexport function randomi(min: number = 0, max: number = 1): number {\r\n    return Math.floor(Math.random() * (max - min)) + min;\r\n}\r\n\r\n/**\r\n * Returns random number within the bounds.\r\n * @function\r\n * @param {number} [min=0] - Minimal bound.\r\n * @param {number} [max=1] - Maximal bound.\r\n * @returns {number} -\r\n */\r\nexport function random(min: number = 0, max: number = 1): number {\r\n    return Math.random() * (max - min) + min;\r\n}\r\n\r\n/**\r\n * Converts degrees value to decimal.\r\n * @function\r\n * @param {number} d - Degrees.\r\n * @param {number} m - Minutes.\r\n * @param {number} s - Seconds.\r\n * @param {boolean} [p] - Positive flag. False - default.\r\n * @returns {number} -\r\n **/\r\nexport function degToDec(d: number, m: number, s: number, p: number): number {\r\n    if (p) {\r\n        return d + m / 60.0 + s / 3600.0;\r\n    } else {\r\n        return -d - m / 60.0 - s / 3600.0;\r\n    }\r\n}\r\n\r\n/**\r\n * The modulo operation that also works for negative dividends.\r\n * @function\r\n * @param {number} m - The dividend.\r\n * @param {number} n - The divisor.\r\n * @returns {number} The remainder.\r\n */\r\nexport function mod(m: number, n: number): number {\r\n    return ((m % n) + n) % n;\r\n}\r\n\r\n/**\r\n * Returns an angle in the range 0 <= angle <= 2Pi which is equivalent to the provided angle.\r\n * @function\r\n * @param {number} a - Angle in radians\r\n * @returns {number} -\r\n */\r\nexport function zeroTwoPI(a: number): number {\r\n    const res = mod(a, TWO_PI);\r\n    if (Math.abs(res) < EPS14 && Math.abs(a) > EPS14) {\r\n        return TWO_PI;\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * Returns 0.0 if x is smaller than edge and otherwise 1.0.\r\n * @function\r\n * @param {number} edge -\r\n * @param {number} x - Value to edge.\r\n * @returns {number} -\r\n */\r\nexport function step(edge: number, x: number): number {\r\n    return x < edge ? 0.0 : 1.0;\r\n}\r\n\r\n/**\r\n * The frac function returns the fractional part of x, i.e. x minus floor(x).\r\n * @function\r\n * @param {number} x - Input value.\r\n * @returns {number} -\r\n */\r\nexport function frac(x: number): number {\r\n    const mx = Math.abs(x)\r\n    return mx - Math.floor(mx);\r\n}\r\n\r\n/**\r\n * Returns Math.log(x) / Math.log(2)\r\n * @function\r\n * @param {number} x - Input value.\r\n * @returns {number} -\r\n */\r\nexport function log2(x: number): number {\r\n    return Math.log(x) / LOG2;\r\n}\r\n\r\n/**\r\n * Returns two power of n.\r\n * @function\r\n * @param {number} n - Power value.\r\n * @returns {number} -\r\n */\r\nexport function exp2(n: number): number {\r\n    return Math.pow(2, n);\r\n}\r\n\r\n/**\r\n * Returns two power of integer n.\r\n * @function\r\n * @param {number} n - Integer power value.\r\n * @returns {number} -\r\n */\r\nexport function pow2i(n: number): number {\r\n    return 2 << (n - 1);\r\n}\r\n\r\n/**\r\n * Returns a slice of linear interpolation t * (h1 - h0)\r\n * @param {number} t - A value that linearly interpolates between the h0 parameter and the h1 parameter.\r\n * @param {number} h1 - End value.\r\n * @param {number} h0 - Start value.\r\n * @returns {number} -\r\n */\r\nexport function slice(t: number, h1: number, h0: number): number {\r\n    return t * (h1 - h0);\r\n}\r\n\r\n/**\r\n * Performs a linear interpolation.\r\n * @function\r\n * @param {number} t - A value that linearly interpolates between the h0 parameter and the h1 parameter.\r\n * @param {number} h1 - End value.\r\n * @param {number} h0 - Start value.\r\n * @returns {number} -\r\n */\r\nexport function lerp(t: number, h1: number, h0: number): number {\r\n    return h0 + t * (h1 - h0);\r\n}\r\n\r\nexport function cube(f: number): number {\r\n    return f * f * f;\r\n}\r\n\r\nexport function square(f: number): number {\r\n    return f * f;\r\n}\r\n\r\nexport function bezier1v(t: number, p0: number, p1: number, p2: number, p3: number): number {\r\n    return (\r\n        cube(1 - t) * p0 + 3 * square(1 - t) * t * p1 + 3 * (1 - t) * square(t) * p2 + cube(t) * p3\r\n    );\r\n}\r\n\r\n/**\r\n * Performs a 3D bezier interpolation.\r\n * @function\r\n * @param {number} t - Interpolation value.\r\n * @param {Vec3} p0 - First control point.\r\n * @param {Vec3} p1 - Second control point.\r\n * @param {Vec3} p2 - Third control point.\r\n * @param {Vec3} p3 - Fourth control point.\r\n * @returns {Vec3} -\r\n */\r\nexport function bezier3v(t: number, p0: Vec3, p1: Vec3, p2: Vec3, p3: Vec3): Vec3 {\r\n\r\n    let u = 1 - t;\r\n    let tt = t * t;\r\n    let uu = u * u;\r\n    let uuu = uu * u;\r\n    let ttt = tt * t;\r\n\r\n    return p0.scaleTo(uuu)\r\n        .addA(p1.scaleTo(3 * uu * t))\r\n        .addA(p2.scaleTo(3 * u * tt))\r\n        .addA(p3.scaleTo(ttt));\r\n}\r\n\r\n/**\r\n * Clamp angle value within 360.\r\n * @function\r\n * @param {number} x - Input angle.\r\n * @returns {number} -\r\n */\r\nexport function rev(x: number): number {\r\n    return x - Math.floor(x / 360.0) * 360.0;\r\n}\r\n\r\n/**\r\n * Clamp longitude within: -180 to +180 degrees.\r\n * @function\r\n * @param {number} lon - Longitude.\r\n * @returns {number} -\r\n */\r\nexport function norm_lon(lon: number): number {\r\n    return lon > 180 ? ((lon + 180) % 360) - 180 : lon < -180 ? ((lon - 180) % 360) + 180 : lon;\r\n}\r\n\r\n/**\r\n * Returns an angle in the range -Pi <= angle <= Pi which is equivalent to the provided angle.\r\n * @function\r\n * @param {number} a - Angle in radians.\r\n * @returns {number} -\r\n */\r\nexport function negativePItoPI(a: number): number {\r\n    return zeroTwoPI(a + Math.PI) - Math.PI;\r\n}\r\n\r\n/**\r\n * Solve using iteration method and a fixed number of steps.\r\n * @function\r\n * @param {Function} f - Equation. Used in Euler's equation(see og.orbit) solving.\r\n * @param {number} x0 - First approximation.\r\n * @param {number} maxIter - Maximum iterations.\r\n * @returns {number} -\r\n */\r\nexport function solve_iteration_fixed(f: (x: number) => number, x0: number, maxIter: number): number {\r\n    let x = 0;\r\n    let x2 = x0;\r\n    for (let i = 0; i < maxIter; i++) {\r\n        x = x2;\r\n        x2 = f(x);\r\n    }\r\n    return x2;\r\n}\r\n\r\n/**\r\n * Solve using iteration; terminate when error is below err or the maximum\r\n * number of iterations is reached. Used in Euler's equation(see og.orbit) solving.\r\n * @function\r\n * @param {function(number): number} f - Equation.\r\n * @param {number} x0 - First approximation.\r\n * @param {number} err - Maximal accepted error value.\r\n * @param {number} maxIter - Maximum iterations.\r\n * @returns {number} - The computed solution.\r\n */\r\nexport function solve_iteration(f: (x: number) => number, x0: number, err: number, maxIter: number = 50): number {\r\n    let x = 0;\r\n    let x2 = x0;\r\n    for (let i = 0; i < maxIter; i++) {\r\n        x = x2;\r\n        x2 = f(x);\r\n        if (Math.abs(x2 - x) < err) {\r\n            return x2;\r\n        }\r\n    }\r\n    return x2;\r\n}\r\n\r\n/**\r\n * Equation function.\r\n * @callback equationCallback\r\n * @param {number} x - Equation variable.\r\n */\r\n\r\n/**\r\n *\r\n * @param a - First bearing angle\r\n * @param b - Second bearing angle\r\n * @returns {number}\r\n */\r\nfunction getAngleDirection(a: number, b: number): number {\r\n    let a_y = Math.cos(a),\r\n        a_x = Math.sin(a),\r\n        b_y = Math.cos(b),\r\n        b_x = Math.sin(b);\r\n    let c = a_y * b_x - b_y * a_x,\r\n        d = a_x * b_x + a_y * b_y;\r\n    if (c > 0.0) {\r\n        return Math.acos(d);\r\n    }\r\n    return -Math.acos(d);\r\n}\r\n\r\n/**\r\n * Returns angle between two azimuths\r\n * @param {number} a - First azimuth angle\r\n * @param {number} b - Second azimuth angle\r\n * @returns {number}\r\n */\r\nexport function getAngleBetweenAzimuths(a: number, b: number): number {\r\n    a = zeroTwoPI(a);\r\n    b = zeroTwoPI(b);\r\n    return ((((a - b) % 360) + 360 + 180) % 360) - 180;\r\n}","import * as mercator from \"./mercator\";\r\nimport type {NumberArray2} from \"./math/Vec2\";\r\nimport type {NumberArray3} from \"./math/Vec3\";\r\n\r\nconst HALF_PI = Math.PI * 0.5;\r\nconst INV_PI_BY_180 = 180.0 / Math.PI;\r\nconst INV_PI_BY_360 = INV_PI_BY_180 * 2.0;\r\nconst PI_BY_360 = Math.PI / 360.0;\r\nconst INV_PI_BY_180_HALF_PI = INV_PI_BY_180 * HALF_PI;\r\n\r\n/**\r\n * Represents a geographical point with a certain latitude, longitude and height.\r\n * @class\r\n * @param {number} [lon] - Longitude.\r\n * @param {number} [lat] - Latitude.\r\n * @param {number} [height] - Height over the surface.\r\n */\r\nexport class LonLat {\r\n    /**\r\n     * Longitude.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public lon: number = 0;\r\n\r\n    /**\r\n     * Latitude.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public lat: number = 0;\r\n\r\n    /**\r\n     * Height.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public height: number = 0;\r\n\r\n    constructor(lon: number = 0, lat: number = 0, height: number = 0) {\r\n        this.lon = lon;\r\n        this.lat = lat;\r\n        this.height = height;\r\n    }\r\n\r\n    /**\r\n     * Check zero coordinates\r\n     * @returns {boolean} -\r\n     */\r\n    public isZero(): boolean {\r\n        return this.lon === 0.0 && this.lat === 0.0 && this.height === 0.0;\r\n    }\r\n\r\n    /**\r\n     * Creates coordinates array.\r\n     * @static\r\n     * @param{Array.<Array<number>>} arr - Coordinates array data. (exactly 3 entries)\r\n     * @return{Array.<LonLat>} the same coordinates array but each element is LonLat instance.\r\n     */\r\n    static join(arr: NumberArray2[] | NumberArray3[]): LonLat[] {\r\n        let res = [];\r\n        for (let i = 0; i < arr.length; i++) {\r\n            let ai = arr[i];\r\n            res[i] = new LonLat(ai[0], ai[1], ai[2]);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Creates an object by coordinate array.\r\n     * @static\r\n     * @param {Array.<number>} arr - Coordinates array, where first is longitude, second is latitude and third is a height. (exactly 3 entries)\r\n     * @returns {LonLat} -\r\n     */\r\n    static createFromArray(arr: [number, number, number]): LonLat {\r\n        return new LonLat(arr[0], arr[1], arr[2]);\r\n    }\r\n\r\n    /**\r\n     * Create array from lonLat\r\n     * @param lonLat\r\n     * @returns {number[]}\r\n     */\r\n    static toArray(lonLat: LonLat): [number, number, number] {\r\n        return [lonLat.lon, lonLat.lat, lonLat.height]\r\n    }\r\n\r\n    /**\r\n     * Create array from lonLat\r\n     * @returns {number[]}\r\n     */\r\n    public toArray(): [number, number, number] {\r\n        return LonLat.toArray(this);\r\n    }\r\n\r\n    /**\r\n     * Converts degrees to mercator coordinates.\r\n     * @static\r\n     * @param {number} lon - Degrees longitude.\r\n     * @param {number} lat - Degrees latitude.\r\n     * @param {number} [height] - Height.\r\n     * @returns {LonLat} -\r\n     */\r\n    static forwardMercator(lon: number, lat: number, height: number): LonLat {\r\n        return new LonLat(\r\n            lon * mercator.POLE_BY_180,\r\n            Math.log(Math.tan((90.0 + lat) * PI_BY_360)) * mercator.POLE_BY_PI,\r\n            height\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Converts degrees to mercator coordinates.\r\n     * @static\r\n     * @param {LonLat} lonLat - Input geodetic degree coordinates\r\n     * @param {LonLat} res - Output mercator coordinates\r\n     * @returns {LonLat} - Output mercator coordinates\r\n     */\r\n    static forwardMercatorRes(lonLat: LonLat, res: LonLat): LonLat {\r\n        res.lon = lonLat.lon * mercator.POLE_BY_180;\r\n        res.lat = Math.log(Math.tan((90.0 + lonLat.lat) * PI_BY_360)) * mercator.POLE_BY_PI,\r\n            res.height = lonLat.height;\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Converts mercator to degrees coordinates.\r\n     * @static\r\n     * @param {number} x - Mercator longitude.\r\n     * @param {number} y - Mercator latitude.\r\n     * @param {number} [height] - Height.\r\n     * @returns {LonLat} -\r\n     */\r\n    static inverseMercator(x: number, y: number, height: number = 0): LonLat {\r\n        return new LonLat(\r\n            x * mercator.INV_POLE_BY_180,\r\n            INV_PI_BY_360 * Math.atan(Math.exp(y * mercator.PI_BY_POLE)) - INV_PI_BY_180_HALF_PI,\r\n            height\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Sets coordinates.\r\n     * @public\r\n     * @param {number} [lon] - Longitude.\r\n     * @param {number} [lat] - Latitude.\r\n     * @param {number} [height] - Height.\r\n     * @returns {LonLat} -\r\n     */\r\n    public set(lon: number = 0, lat: number = 0, height: number = 0): LonLat {\r\n        this.lon = lon;\r\n        this.lat = lat;\r\n        this.height = height;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Copy coordinates.\r\n     * @public\r\n     * @param {LonLat} [lonLat] - Coordinates to copy.\r\n     * @returns {LonLat} -\r\n     */\r\n    public copy(lonLat: LonLat): LonLat {\r\n        this.lon = lonLat.lon;\r\n        this.lat = lonLat.lat;\r\n        this.height = lonLat.height;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Clone the coordinates.\r\n     * @public\r\n     * @returns {LonLat} -\r\n     */\r\n    public clone(): LonLat {\r\n        return new LonLat(this.lon, this.lat, this.height);\r\n    }\r\n\r\n    /**\r\n     * Converts to mercator coordinates.\r\n     * @public\r\n     * @returns {LonLat} -\r\n     */\r\n    public forwardMercator(): LonLat {\r\n        return LonLat.forwardMercator(this.lon, this.lat, this.height);\r\n    }\r\n\r\n    public forwardMercatorEPS01(): LonLat {\r\n        let lat = this.lat;\r\n        if (lat > 89.9) {\r\n            lat = 89.9;\r\n        } else if (lat < -89.9) {\r\n            lat = -89.9;\r\n        }\r\n        return new LonLat(\r\n            this.lon * mercator.POLE_BY_180,\r\n            Math.log(Math.tan((90.0 + lat) * PI_BY_360)) * mercator.POLE_BY_PI\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Converts from mercator coordinates.\r\n     * @public\r\n     * @returns {LonLat} -\r\n     */\r\n    public inverseMercator(): LonLat {\r\n        return LonLat.inverseMercator(this.lon, this.lat, this.height);\r\n    }\r\n\r\n    /**\r\n     * Compares coordinates.\r\n     * @public\r\n     * @param {LonLat} b - Coordinate to compare with.\r\n     * @returns {boolean} -\r\n     */\r\n    public equal(b: LonLat): boolean {\r\n        if (b.height) {\r\n            return this.lon === b.lon && this.lat === b.lat && this.height === b.height;\r\n        } else {\r\n            return this.lon === b.lon && this.lat === b.lat;\r\n        }\r\n    }\r\n}\r\n","import {Extent} from \"./Extent\";\r\nimport {LonLat} from './LonLat';\r\n\r\n/**\r\n * Mercator size.\r\n * @const\r\n * @type {number}\r\n */\r\nexport const POLE = 20037508.34;\r\n\r\nexport const POLE2 = POLE * 2.0;\r\n\r\nexport const PI_BY_POLE = Math.PI / POLE;\r\n\r\nexport const POLE_BY_PI = POLE / Math.PI;\r\n\r\nconst HALF_PI = Math.PI * 0.5;\r\n\r\nexport const POLE_BY_180 = POLE / 180.0;\r\n\r\nexport const INV_POLE_BY_180 = 180.0 / POLE;\r\n\r\nconst PI_BY_360 = Math.PI / 360.0;\r\n\r\nconst PI_BY_180 = Math.PI / 180.0;\r\n\r\nconst INV_PI_BY_180 = 180.0 / Math.PI;\r\n\r\n/**\r\n * Double mercator size.\r\n * @const\r\n * @type {number}\r\n */\r\nexport const POLE_DOUBLE = 2.0 * POLE;\r\n\r\n/**\r\n * One by mercator double size.\r\n * @const\r\n * @type {number}\r\n */\r\nexport const ONE_BY_POLE_DOUBLE = 1.0 / POLE_DOUBLE;\r\n\r\nexport function forward(lonLat: LonLat): LonLat {\r\n    return new LonLat(lonLat.lon * POLE / 180.0, Math.log(Math.tan((90.0 + lonLat.lat) * PI_BY_360)) * POLE_BY_PI, lonLat.height);\r\n}\r\n\r\n/**\r\n * Converts degrees longitude to mercator coordinate.\r\n * @function\r\n * @param {number} lon - Degrees geodetic longitude.\r\n * @returns {number} -\r\n */\r\nexport function forward_lon(lon: number): number {\r\n    return lon * POLE / 180.0;\r\n}\r\n\r\n/**\r\n * Converts degrees latitude to mercator coordinate.\r\n * @function\r\n * @param {number} lat - Degrees geodetic latitude.\r\n * @returns {number} -\r\n */\r\nexport function forward_lat(lat: number): number {\r\n    return Math.log(Math.tan((90.0 + lat) * PI_BY_360)) * POLE_BY_PI;\r\n}\r\n\r\n/**\r\n * Converts mercator longitude to degrees coordinate.\r\n * @function\r\n * @param {number} lon - Mercator longitude.\r\n * @returns {number} -\r\n */\r\nexport function inverse_lon(lon: number): number {\r\n    return 180 * lon / POLE;\r\n}\r\n\r\n/**\r\n * Converts mercator latitude to degrees coordinate.\r\n * @function\r\n * @param {number} lon - Mercator latitude.\r\n * @returns {number} -\r\n */\r\nexport function inverse_lat(lat: number): number {\r\n    return INV_PI_BY_180 * (2.0 * Math.atan(Math.exp(lat * PI_BY_POLE)) - HALF_PI);\r\n}\r\n\r\n/**\r\n * Returns mercator map tile grid horizontal coordinate index by geodetic\r\n * longitude and zoom level. Where top left corner of the grid is 0 coordinate index.\r\n * @function\r\n * @param {number} lon - Geodetic degrees longitude.\r\n * @param {number} zoom - Zoom level.\r\n * @returns {number}\r\n */\r\nexport function getTileX(lon: number, zoom: number): number {\r\n    return Math.floor((lon + 180) / 360.0 * Math.pow(2, zoom));\r\n}\r\n\r\n/**\r\n * Returns mercator map tile grid vertical coordinate index by geodetic\r\n * latitude and zoom level. Where top left corner of the grid is 0 coordinate index.\r\n * @function\r\n * @param {number} lat - Geodetic degrees latitude.\r\n * @param {number} zoom - Zoom level.\r\n * @returns {number}\r\n */\r\nexport function getTileY(lat: number, zoom: number): number {\r\n    return Math.floor((1.0 - Math.log(Math.tan(lat * PI_BY_180) + 1.0 / Math.cos(lat * PI_BY_180)) / Math.PI) * 0.5 * Math.pow(2, zoom));\r\n}\r\n\r\n/**\r\n * Converts geodetic coordinate array to mercator coordinate array.\r\n * @function\r\n * @param {Array.<LonLat>} lonLatArr - LonLat array to convert.\r\n * @returns {Array.<LonLat>}\r\n */\r\nexport function forwardArray(lonlatArr: LonLat[]): LonLat[] {\r\n    let res: LonLat[] = [];\r\n    for (let i = 0; i < lonlatArr.length; i++) {\r\n        res.push(lonlatArr[i].forwardMercator());\r\n    }\r\n    return res;\r\n}\r\n\r\nexport function getTileExtent(x: number, y: number, z: number): Extent {\r\n    let size = POLE2 / (1 << z),//Math.pow(2, z),\r\n        sw = new LonLat(-POLE + x * size, POLE - y * size - size);\r\n    return new Extent(sw, new LonLat(sw.lon + size, sw.lat + size));\r\n}\r\n\r\n/**\r\n * Max mercator latitude.\r\n * @const\r\n * @type {number}\r\n */\r\nexport const MAX_LAT = inverse_lat(POLE);\r\n\r\n/**\r\n * Min mercator latitude.\r\n * @const\r\n * @type {number}\r\n */\r\nexport const MIN_LAT = -MAX_LAT;\r\n","import * as math from \"./math\";\r\nimport * as mercator from \"./mercator\";\r\nimport {Ellipsoid} from \"./ellipsoid/Ellipsoid\";\r\nimport {LonLat} from \"./LonLat\";\r\n\r\n/**\r\n * Represents geographical coordinates extent.\r\n * @class\r\n * @param {LonLat} [sw] - South West extent corner coordinates.\r\n * @param {LonLat} [ne] - North East extent corner coordinates.\r\n */\r\nexport class Extent {\r\n    public southWest: LonLat;\r\n    public northEast: LonLat;\r\n\r\n    constructor(sw: LonLat = new LonLat(), ne: LonLat = new LonLat()) {\r\n        this.southWest = sw;\r\n        this.northEast = ne;\r\n    }\r\n\r\n    /**\r\n     * Creates extent instance from values in array.\r\n     * @static\r\n     * @param {Array.<number>} arr - South west and north-east longitude and latitudes packed in array. (exactly 4 entries)\r\n     * @return {Extent} Extent object.\r\n     */\r\n    static createFromArray(arr: [number, number, number, number]): Extent {\r\n        return new Extent(new LonLat(arr[0], arr[1]), new LonLat(arr[2], arr[3]));\r\n    }\r\n\r\n    /**\r\n     * Creates bound extent instance by coordinate array.\r\n     * @static\r\n     * @param {Array.<LonLat>} arr - Coordinate array.\r\n     * @return {Extent} Extent object.\r\n     */\r\n    static createByCoordinates(arr: LonLat[]): Extent {\r\n        let lonmin = math.MAX,\r\n            lonmax = math.MIN,\r\n            latmin = math.MAX,\r\n            latmax = math.MIN;\r\n        for (let i = 0; i < arr.length; i++) {\r\n            const vi = arr[i];\r\n            if (vi.lon < lonmin) lonmin = vi.lon;\r\n            if (vi.lon > lonmax) lonmax = vi.lon;\r\n            if (vi.lat < latmin) latmin = vi.lat;\r\n            if (vi.lat > latmax) latmax = vi.lat;\r\n        }\r\n        return new Extent(new LonLat(lonmin, latmin), new LonLat(lonmax, latmax));\r\n    }\r\n\r\n    /**\r\n     * Creates bound extent instance by coordinates array.\r\n     * @static\r\n     * @param {Array.<Array<number>>} arr - Coordinate array. (exactly 2 entries)\r\n     * @return {Extent} Extent object.\r\n     */\r\n    static createByCoordinatesArr(arr: [number, number][]): Extent {\r\n        let lonmin = math.MAX,\r\n            lonmax = math.MIN,\r\n            latmin = math.MAX,\r\n            latmax = math.MIN;\r\n        for (let i = 0; i < arr.length; i++) {\r\n            const vi = arr[i];\r\n            if (vi[0] < lonmin) lonmin = vi[0];\r\n            if (vi[0] > lonmax) lonmax = vi[0];\r\n            if (vi[1] < latmin) latmin = vi[1];\r\n            if (vi[1] > latmax) latmax = vi[1];\r\n        }\r\n        return new Extent(new LonLat(lonmin, latmin), new LonLat(lonmax, latmax));\r\n    }\r\n\r\n    /**\r\n     * Creates extent by merсator grid tile coordinates.\r\n     * @static\r\n     * @param {number} x -\r\n     * @param {number} y -\r\n     * @param {number} z -\r\n     * @param {number} width -\r\n     * @param {number} height -\r\n     * @returns {Extent} -\r\n     */\r\n    static fromTile(\r\n        x: number,\r\n        y: number,\r\n        z: number,\r\n        width: number = mercator.POLE_DOUBLE,\r\n        height: number = mercator.POLE_DOUBLE): Extent {\r\n        const H = 1 << z;//Math.pow(2, z);\r\n        const W = H;//Math.pow(2, z);\r\n        const lnSize = width / W;\r\n        const ltSize = height / H;\r\n\r\n        const left = -width * 0.5 + x * lnSize,\r\n            top = height * 0.5 - y * ltSize,\r\n            bottom = top - ltSize,\r\n            right = left + lnSize;\r\n\r\n        return new Extent(new LonLat(left, bottom), new LonLat(right, top));\r\n    }\r\n\r\n    /**\r\n     * Sets current bounding extent object by coordinate array.\r\n     * @public\r\n     * @param {Array.<LonLat>} arr - Coordinate array.\r\n     * @return {Extent} Current extent.\r\n     */\r\n    public setByCoordinates(arr: LonLat[]): Extent {\r\n        let lonmin = math.MAX,\r\n            lonmax = math.MIN,\r\n            latmin = math.MAX,\r\n            latmax = math.MIN;\r\n        for (let i = 0; i < arr.length; i++) {\r\n            const vi = arr[i];\r\n            if (vi.lon < lonmin) lonmin = vi.lon;\r\n            if (vi.lon > lonmax) lonmax = vi.lon;\r\n            if (vi.lat < latmin) latmin = vi.lat;\r\n            if (vi.lat > latmax) latmax = vi.lat;\r\n        }\r\n        this.southWest.lon = lonmin;\r\n        this.southWest.lat = latmin;\r\n        this.northEast.lon = lonmax;\r\n        this.northEast.lat = latmax;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Determines if point inside extent.\r\n     * @public\r\n     * @param {LonLat} lonlat - Coordinate point.\r\n     * @return {boolean} Returns true if point inside extent.\r\n     */\r\n    public isInside(lonlat: LonLat): boolean {\r\n        const sw = this.southWest;\r\n        const ne = this.northEast;\r\n        return (\r\n            lonlat.lon >= sw.lon && lonlat.lon <= ne.lon &&\r\n            lonlat.lat >= sw.lat && lonlat.lat <= ne.lat\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns true if two extent overlap each other.\r\n     * @public\r\n     * @param {Extent} e - Another extent.\r\n     * @return {boolean} -\r\n     */\r\n    public overlaps(e: Extent): boolean {\r\n        const sw = this.southWest;\r\n        const ne = this.northEast;\r\n        return (\r\n            sw.lon <= e.northEast.lon &&\r\n            ne.lon >= e.southWest.lon &&\r\n            sw.lat <= e.northEast.lat &&\r\n            ne.lat >= e.southWest.lat\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Gets extent width.\r\n     * @public\r\n     * @return {number} Extent width.\r\n     */\r\n    public getWidth(): number {\r\n        return this.northEast.lon - this.southWest.lon;\r\n    }\r\n\r\n    /**\r\n     * Gets extent height.\r\n     * @public\r\n     * @return {number} Extent height.\r\n     */\r\n    public getHeight(): number {\r\n        return this.northEast.lat - this.southWest.lat;\r\n    }\r\n\r\n    /**\r\n     * Creates clone instance of the current extent.\r\n     * @public\r\n     * @return {Extent} Extent clone.\r\n     */\r\n    public clone(): Extent {\r\n        return new Extent(this.southWest.clone(), this.northEast.clone());\r\n    }\r\n\r\n    /**\r\n     * Gets the center coordinate of the extent.\r\n     * @public\r\n     * @return {number} Center coordinate.\r\n     */\r\n    public getCenter(): LonLat {\r\n        const sw = this.southWest;\r\n        const ne = this.northEast;\r\n        return new LonLat(sw.lon + (ne.lon - sw.lon) * 0.5, sw.lat + (ne.lat - sw.lat) * 0.5);\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getNorthWest(): LonLat {\r\n        return new LonLat(this.southWest.lon, this.northEast.lat);\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getNorthEast(): LonLat {\r\n        return new LonLat(this.northEast.lon, this.northEast.lat);\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getSouthWest(): LonLat {\r\n        return new LonLat(this.southWest.lon, this.southWest.lat);\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getSouthEast(): LonLat {\r\n        return new LonLat(this.northEast.lon, this.southWest.lat);\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getNorth(): number {\r\n        return this.northEast.lat;\r\n    }\r\n\r\n    public getEast(): number {\r\n        return this.northEast.lon;\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getWest(): number {\r\n        return this.southWest.lon;\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public getSouth(): number {\r\n        return this.southWest.lat;\r\n    }\r\n\r\n    /**\r\n     * Returns extents are equals.\r\n     * @param {Extent} extent - Extent.\r\n     * @returns {boolean} -\r\n     */\r\n    public equals(extent: Extent): boolean {\r\n        return (\r\n            this.southWest.lon === extent.southWest.lon &&\r\n            this.southWest.lat === extent.southWest.lat &&\r\n            this.northEast.lon === extent.northEast.lon &&\r\n            this.northEast.lat === extent.northEast.lat\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Converts extent coordinates to mercator projection coordinates.\r\n     * @public\r\n     * @return {Extent} New instance of the current extent.\r\n     */\r\n    public forwardMercator(): Extent {\r\n        return new Extent(this.southWest.forwardMercator(), this.northEast.forwardMercator());\r\n    }\r\n\r\n    /**\r\n     * Converts extent coordinates from mercator projection to degrees.\r\n     * @public\r\n     * @return {Extent} New instance of the current extent.\r\n     */\r\n    public inverseMercator(): Extent {\r\n        return new Extent(this.southWest.inverseMercator(), this.northEast.inverseMercator());\r\n    }\r\n\r\n    /**\r\n     * Gets cartesian bounding bounds of the current ellipsoid.\r\n     * @public\r\n     * @param {Ellipsoid} ellipsoid - Ellipsoid.\r\n     * @return {Array.<number>} Cartesian 3d coordinate array. (exactly 6 entries)\r\n     */\r\n    public getCartesianBounds(ellipsoid: Ellipsoid): [number, number, number, number, number, number] {\r\n        let xmin = math.MAX,\r\n            xmax = math.MIN,\r\n            ymin = math.MAX,\r\n            ymax = math.MIN,\r\n            zmin = math.MAX,\r\n            zmax = math.MIN;\r\n\r\n        const v = [\r\n            new LonLat(this.southWest.lon, this.southWest.lat),\r\n            new LonLat(this.southWest.lon, this.northEast.lat),\r\n            new LonLat(this.northEast.lon, this.northEast.lat),\r\n            new LonLat(this.northEast.lon, this.southWest.lat)\r\n        ];\r\n\r\n        for (let i = 0; i < v.length; i++) {\r\n            const coord = ellipsoid.lonLatToCartesian(v[i]);\r\n            const x = coord.x;\r\n            const y = coord.y;\r\n            const z = coord.z;\r\n            if (x < xmin) xmin = x;\r\n            if (x > xmax) xmax = x;\r\n            if (y < ymin) ymin = y;\r\n            if (y > ymax) ymax = y;\r\n            if (z < zmin) zmin = z;\r\n            if (z > zmax) zmax = z;\r\n        }\r\n\r\n        return [xmin, ymin, zmin, xmax, ymax, zmax];\r\n    }\r\n\r\n    public toString(): string {\r\n        return (\r\n            `[${this.southWest.lon.toFixed(5)}, ${this.southWest.lat.toFixed(5)}, ${this.northEast.lon.toFixed(5)}, ${this.northEast.lat.toFixed(5)}]`\r\n        );\r\n    }\r\n}\r\n","import {Mat4} from \"./Mat4\";\r\nimport {Vec3} from \"./Vec3\";\r\n\r\nexport type NumberArray9 = [\r\n    number, number, number,\r\n    number, number, number,\r\n    number, number, number\r\n];\r\n\r\n/**\r\n * Class represents a 3x3 matrix.\r\n * @class\r\n */\r\nexport class Mat3 {\r\n\r\n    /**\r\n     * A 3x3 matrix, indexing as a column-major order array.\r\n     * @public\r\n     * @type {Array.<number>}\r\n     */\r\n    public _m: NumberArray9 = [\r\n        0, 0, 0,\r\n        0, 0, 0,\r\n        0, 0, 0\r\n    ];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    /**\r\n     * Sets column-major order array matrix.\r\n     * @public\r\n     * @param {Array.<number>} m - Matrix array.\r\n     * @returns {Mat3}\r\n     */\r\n    public set(m: NumberArray9): Mat3 {\r\n        this._m[0] = m[0];\r\n        this._m[1] = m[1];\r\n        this._m[2] = m[2];\r\n        this._m[3] = m[3];\r\n        this._m[4] = m[4];\r\n        this._m[5] = m[5];\r\n        this._m[6] = m[6];\r\n        this._m[7] = m[7];\r\n        this._m[8] = m[8];\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Duplicates a Mat3 instance.\r\n     * @public\r\n     * @returns {Mat3}\r\n     */\r\n    public clone(): Mat3 {\r\n        let res = new Mat3();\r\n        res.set(this._m);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Copy matrix.\r\n     * @public\r\n     * @param {Mat3} a - Matrix to copy.\r\n     * @returns {Mat3}\r\n     */\r\n    public copy(a: Mat3): Mat3 {\r\n        return this.set(a._m);\r\n    }\r\n\r\n    /**\r\n     * Creates transposed matrix from the current.\r\n     * @public\r\n     * @returns {Mat3}\r\n     */\r\n    public transposeTo(): Mat3 {\r\n        let res = new Mat3();\r\n        let m = this._m;\r\n        res._m[0] = m[0];\r\n        res._m[1] = m[3];\r\n        res._m[2] = m[6];\r\n        res._m[3] = m[1];\r\n        res._m[4] = m[4];\r\n        res._m[5] = m[7];\r\n        res._m[6] = m[2];\r\n        res._m[7] = m[5];\r\n        res._m[8] = m[8];\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Sets matrix to identity.\r\n     * @public\r\n     * @returns {Mat3}\r\n     */\r\n    public setIdentity(): Mat3 {\r\n        this._m[0] = 1;\r\n        this._m[1] = 0;\r\n        this._m[2] = 0;\r\n        this._m[3] = 0;\r\n        this._m[4] = 1;\r\n        this._m[5] = 0;\r\n        this._m[6] = 0;\r\n        this._m[7] = 0;\r\n        this._m[8] = 1;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Multiply to 3d vector.\r\n     * @public\r\n     * @params {Vec3} p - 3d vector.\r\n     * @returns {Vec3}\r\n     */\r\n    public mulVec(p: Vec3): Vec3 {\r\n\r\n        let d = p.x,\r\n            e = p.y,\r\n            g = p.z;\r\n\r\n        let m = this._m;\r\n\r\n        return new Vec3(\r\n            m[0] * d + m[3] * e + m[6] * g,\r\n            m[1] * d + m[4] * e + m[7] * g,\r\n            m[2] * d + m[5] * e + m[8] * g\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Converts to 4x4 matrix.\r\n     * @public\r\n     * @returns {Mat4}\r\n     */\r\n    public getMat4(): Mat4 {\r\n\r\n        let res = new Mat4();\r\n        let b = res._m;\r\n        let a = this._m;\r\n\r\n        b[0] = a[0];\r\n        b[1] = a[1];\r\n        b[2] = a[2];\r\n        b[3] = 0;\r\n        b[4] = a[3];\r\n        b[5] = a[4];\r\n        b[6] = a[5];\r\n        b[7] = 0;\r\n        b[8] = a[6];\r\n        b[9] = a[7];\r\n        b[10] = a[8];\r\n        b[11] = 0;\r\n        b[12] = 0;\r\n        b[13] = 0;\r\n        b[14] = 0;\r\n        b[15] = 1;\r\n\r\n        return res;\r\n    }\r\n}\r\n\r\n/**\r\n * Mat3 factory.\r\n * @static\r\n * @return {Mat3}\r\n */\r\nexport function mat3(): Mat3 {\r\n    return new Mat3();\r\n}\r\n","import {frac} from \"../math\";\r\nimport {Vec3} from \"./Vec3\";\r\n\r\nexport type NumberArray4 = [number, number, number, number];\r\n\r\n/**\r\n * Class represents a 4d vector.\r\n * @class\r\n * @param {number} [x] - First value.\r\n * @param {number} [y] - Second value.\r\n * @param {number} [z] - Third value.\r\n * @param {number} [w] - Fourth value.\r\n */\r\nexport class Vec4 {\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public x: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public y: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public z: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public w: number;\r\n\r\n\r\n    constructor(x: number = 0.0, y: number = 0.0, z: number = 0.0, w: number = 0.0) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n    }\r\n\r\n    /**\r\n     * Identity vector [0,0,0,1].\r\n     * @const\r\n     * @type {Vec4}\r\n     */\r\n    static get identity(): Vec4 {\r\n        return new Vec4(0, 0, 0, 1);\r\n    }\r\n\r\n    /**\r\n     * Creates 4d vector from array.\r\n     * @function\r\n     * @param {Array.<number>} arr - Array of four values\r\n     * @returns {Vec4}\r\n     */\r\n    static fromVec(arr: NumberArray4): Vec4 {\r\n        return new Vec4(arr[0], arr[1], arr[2], arr[3]);\r\n    }\r\n\r\n    /**\r\n     * Converts to Vec3, without fourth value.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public toVec3(): Vec3 {\r\n        return new Vec3(this.x, this.y, this.z);\r\n    }\r\n\r\n    /**\r\n     * Returns clone vector.\r\n     * @public\r\n     * @returns {Vec4}\r\n     */\r\n    public clone(): Vec4 {\r\n        return new Vec4(this.x, this.y, this.z, this.w);\r\n    }\r\n\r\n    /**\r\n     * Compares with vector. Returns true if it equals another.\r\n     * @public\r\n     * @param {Vec4} v - Vector to compare.\r\n     * @returns {boolean}\r\n     */\r\n    public equal(v: Vec4): boolean {\r\n        return this.x === v.x && this.y === v.y && this.z === v.z && this.w === v.w;\r\n    }\r\n\r\n    /**\r\n     * Copy input vector's values.\r\n     * @param {Vec4} v - Vector to copy.\r\n     * @returns {Vec4}\r\n     */\r\n    public copy(v: Vec4): Vec4 {\r\n        this.x = v.x;\r\n        this.y = v.y;\r\n        this.z = v.z;\r\n        this.w = v.w;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Converts vector to a number array.\r\n     * @public\r\n     * @returns {Array.<number>} - (exactly 4 entries)\r\n     */\r\n    public toArray(): NumberArray4 {\r\n        return [this.x, this.y, this.z, this.w];\r\n    }\r\n\r\n    /**\r\n     * Converts vector to a number array.\r\n     * @public\r\n     * @returns {Array.<number>} - (exactly 4 entries)\r\n     */\r\n    toArray3(): [number, number, number] {\r\n        return [this.x, this.y, this.z];\r\n    }\r\n\r\n    /**\r\n     * Sets vector's values.\r\n     * @public\r\n     * @param {number} x - Value X.\r\n     * @param {number} y - Value Y.\r\n     * @param {number} z - Value Z.\r\n     * @param {number} w - Value W.\r\n     * @returns {Vec4}\r\n     */\r\n    public set(x: number, y: number, z: number, w: number): Vec4 {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Adds vector to the current.\r\n     * @public\r\n     * @param {Vec4} v - Vector to add.\r\n     * @returns {Vec4}\r\n     */\r\n    public addA(v: Vec4): Vec4 {\r\n        this.x += v.x;\r\n        this.y += v.y;\r\n        this.z += v.z;\r\n        this.w += v.w;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract vector from the current.\r\n     * @public\r\n     * @param {Vec4} v - Subtract vector.\r\n     * @returns {Vec4}\r\n     */\r\n    public subA(v: Vec4): Vec4 {\r\n        this.x -= v.x;\r\n        this.y -= v.y;\r\n        this.z -= v.z;\r\n        this.w -= v.w;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Scale current vector.\r\n     * @public\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec4}\r\n     */\r\n    public scale(scale: number): Vec4 {\r\n        this.x *= scale;\r\n        this.y *= scale;\r\n        this.z *= scale;\r\n        this.w *= scale;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Makes vector affinity. Thereby fourth component becomes to 1.0.\r\n     * @public\r\n     * @returns {Vec4}\r\n     */\r\n    public affinity(): Vec4 {\r\n\r\n        let iw = 1.0 / this.w;\r\n\r\n        this.x *= iw;\r\n        this.y *= iw;\r\n        this.z *= iw;\r\n        this.w = 1.0;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Scale current vector to another instance.\r\n     * @public\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec3}\r\n     */\r\n    public scaleTo(scale: number): Vec4 {\r\n        return new Vec4(this.x * scale, this.y * scale, this.z * scale, this.w * scale);\r\n    }\r\n\r\n    /**\r\n     * Vector's edge function that returns vector where each component is 0.0 if it's smaller than edge and otherwise 1.0.\r\n     * @public\r\n     * @returns {Vec4}\r\n     */\r\n    public getStep(edge: number): Vec4 {\r\n        return new Vec4(\r\n            this.x < edge ? 0.0 : 1.0,\r\n            this.y < edge ? 0.0 : 1.0,\r\n            this.z < edge ? 0.0 : 1.0,\r\n            this.w < edge ? 0.0 : 1.0\r\n        );\r\n    }\r\n\r\n    /**\r\n     * The vector frac function returns the vector of fractional parts of each value, i.e. x minus floor(x).\r\n     * @public\r\n     * @param {Vec4} v - Input vector\r\n     * @returns {Vec4}\r\n     */\r\n    public getFrac(v: Vec4): Vec4 {\r\n        return new Vec4(frac(v.x), frac(v.y), frac(v.z), frac(v.w));\r\n    }\r\n\r\n    /**\r\n     * Gets vectors dot production.\r\n     * @public\r\n     * @param {Vec4} v - Another vector.\r\n     * @returns {number} - Dot product.\r\n     */\r\n    public dot(v: Vec4): number {\r\n        return v.x * this.x + v.y * this.y + v.z * this.z + v.w * this.w;\r\n    }\r\n\r\n    /**\r\n     * Returns true if vector's values are zero.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public isZero(): boolean {\r\n        return !(this.x || this.y || this.z || this.w);\r\n    }\r\n}\r\n\r\n/**\r\n * Vector 4d object creator.\r\n * @function\r\n * @param {number} [x] - First value.\r\n * @param {number} [y] - Second value.\r\n * @param {number} [z] - Third value.\r\n * @param {number} [w] - Fourth value.\r\n * @returns {Vec4}\r\n */\r\nexport function vec4(x: number = 0, y: number = 0, z: number = 0, w: number = 0): Vec4 {\r\n    return new Vec4(x, y, z, w);\r\n}\r\n","import {Mat3} from \"./Mat3\";\r\nimport {Quat} from \"./Quat\";\r\nimport {Vec3} from \"./Vec3\";\r\nimport {Vec4} from \"./Vec4\";\r\n\r\nexport type NumberArray16 = [\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number,\r\n    number, number, number, number\r\n];\r\n\r\n/**\r\n * Class represents a 4x4 matrix.\r\n * @class\r\n */\r\nexport class Mat4 {\r\n\r\n    /**\r\n     * A 4x4 matrix, index-able as a column-major order array.\r\n     * @public\r\n     * @type {Array.<number>}\r\n     */\r\n    public _m: NumberArray16 = [\r\n        0, 0, 0, 0,\r\n        0, 0, 0, 0,\r\n        0, 0, 0, 0,\r\n        0, 0, 0, 0\r\n    ];\r\n\r\n    constructor() {\r\n    }\r\n\r\n    /**\r\n     * Returns identity matrix instance.\r\n     * @static\r\n     * @returns {Mat4} -\r\n     */\r\n    static identity(): Mat4 {\r\n        let res = new Mat4();\r\n        res._m[0] = 1;\r\n        res._m[1] = 0;\r\n        res._m[2] = 0;\r\n        res._m[3] = 0;\r\n        res._m[4] = 0;\r\n        res._m[5] = 1;\r\n        res._m[6] = 0;\r\n        res._m[7] = 0;\r\n        res._m[8] = 0;\r\n        res._m[9] = 0;\r\n        res._m[10] = 1;\r\n        res._m[11] = 0;\r\n        res._m[12] = 0;\r\n        res._m[13] = 0;\r\n        res._m[14] = 0;\r\n        res._m[15] = 1;\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Get rotation matrix around the point\r\n     * @public\r\n     * @param {number} angle - Rotation angle in radians\r\n     * @param {Vec3} [center] - Point that the camera rotates around\r\n     * @param {Vec3} [up] - Camera up vector\r\n     */\r\n    static getRotationAroundPoint(angle: number, center: Vec3 = Vec3.ZERO, up: Vec3 = Vec3.UP): Mat4 {\r\n        let rot = Mat4.getRotation(angle, up);\r\n        let tr = new Mat4().setIdentity().translate(center);\r\n        let ntr = new Mat4().setIdentity().translate(center.negateTo());\r\n        return tr.mul(rot).mul(ntr);\r\n    }\r\n\r\n    static getRotation(angle: number, up: Vec3 = Vec3.UP): Mat4 {\r\n        return new Mat4().setRotation(up, angle);\r\n    }\r\n\r\n    /**\r\n     * Sets column-major order array matrix.\r\n     * @public\r\n     * @param {Array.<number>} m - Matrix array.\r\n     * @returns {Mat4} -\r\n     */\r\n    public set(m: NumberArray16): Mat4 {\r\n        this._m[0] = m[0];\r\n        this._m[1] = m[1];\r\n        this._m[2] = m[2];\r\n        this._m[3] = m[3];\r\n        this._m[4] = m[4];\r\n        this._m[5] = m[5];\r\n        this._m[6] = m[6];\r\n        this._m[7] = m[7];\r\n        this._m[8] = m[8];\r\n        this._m[9] = m[9];\r\n        this._m[10] = m[10];\r\n        this._m[11] = m[11];\r\n        this._m[12] = m[12];\r\n        this._m[13] = m[13];\r\n        this._m[14] = m[14];\r\n        this._m[15] = m[15];\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Duplicates a Matrix3 instance.\r\n     * @public\r\n     * @returns {Mat4} -\r\n     */\r\n    public clone(): Mat4 {\r\n        let res = new Mat4();\r\n        res.set(this._m);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Copy matrix.\r\n     * @public\r\n     * @param {Mat4} a - Matrix to copy.\r\n     * @return {Mat4}\r\n     */\r\n    public copy(a: Mat4): Mat4 {\r\n        return this.set(a._m);\r\n    }\r\n\r\n    /**\r\n     * Converts to 3x3 matrix.\r\n     * @public\r\n     * @returns {Mat3} -\r\n     */\r\n    public getMat3(): Mat3 {\r\n        let res = new Mat3();\r\n        let a = this._m,\r\n            b = res._m;\r\n        b[0] = a[0];\r\n        b[1] = a[1];\r\n        b[2] = a[2];\r\n        b[3] = a[4];\r\n        b[4] = a[5];\r\n        b[5] = a[6];\r\n        b[6] = a[8];\r\n        b[7] = a[9];\r\n        b[8] = a[10];\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Multiply to 3d vector.\r\n     * @public\r\n     * @param {Vec3} p - 3d vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public mulVec3(p: Vec3): Vec3 {\r\n        let d = p.x,\r\n            e = p.y,\r\n            g = p.z;\r\n        return new Vec3(\r\n            this._m[0] * d + this._m[4] * e + this._m[8] * g + this._m[12],\r\n            this._m[1] * d + this._m[5] * e + this._m[9] * g + this._m[13],\r\n            this._m[2] * d + this._m[6] * e + this._m[10] * g + this._m[14]\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Multiply to 4d vector.\r\n     * @public\r\n     * @param {Vec4} p - 4d vector.\r\n     * @returns {Vec4} -\r\n     */\r\n    public mulVec4(p: Vec4): Vec4 {\r\n        let d = p.x,\r\n            e = p.y,\r\n            g = p.z,\r\n            f = p.w;\r\n        return new Vec4(\r\n            this._m[0] * d + this._m[4] * e + this._m[8] * g + this._m[12] * f,\r\n            this._m[1] * d + this._m[5] * e + this._m[9] * g + this._m[13] * f,\r\n            this._m[2] * d + this._m[6] * e + this._m[10] * g + this._m[14] * f,\r\n            this._m[3] * d + this._m[7] * e + this._m[11] * g + this._m[15] * f\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Creates an inverse 3x3 matrix of the current.\r\n     * @public\r\n     * @returns {Mat3} -\r\n     */\r\n    public toInverseMatrix3(): Mat3 | undefined {\r\n        let a = this._m;\r\n        let c = a[0],\r\n            d = a[1],\r\n            e = a[2],\r\n            g = a[4],\r\n            f = a[5],\r\n            h = a[6],\r\n            i = a[8],\r\n            j = a[9],\r\n            k = a[10],\r\n            l = k * f - h * j,\r\n            o = -k * g + h * i,\r\n            m = j * g - f * i,\r\n            n = c * l + d * o + e * m;\r\n\r\n        if (!n) {\r\n            return;\r\n        }\r\n\r\n        n = 1.0 / n;\r\n\r\n        let res = new Mat3();\r\n        res._m[0] = l * n;\r\n        res._m[1] = (-k * d + e * j) * n;\r\n        res._m[2] = (h * d - e * f) * n;\r\n        res._m[3] = o * n;\r\n        res._m[4] = (k * c - e * i) * n;\r\n        res._m[5] = (-h * c + e * g) * n;\r\n        res._m[6] = m * n;\r\n        res._m[7] = (-j * c + d * i) * n;\r\n        res._m[8] = (f * c - d * g) * n;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Creates an inverse matrix of the current.\r\n     * @public\r\n     * @returns {Mat4} -\r\n     */\r\n    public inverseTo(res: Mat4 = new Mat4()): Mat4 {\r\n        let c = this._m[0],\r\n            d = this._m[1],\r\n            e = this._m[2],\r\n            g = this._m[3],\r\n            f = this._m[4],\r\n            h = this._m[5],\r\n            i = this._m[6],\r\n            j = this._m[7],\r\n            k = this._m[8],\r\n            l = this._m[9],\r\n            o = this._m[10],\r\n            m = this._m[11],\r\n            n = this._m[12],\r\n            p = this._m[13],\r\n            r = this._m[14],\r\n            s = this._m[15],\r\n            A = c * h - d * f,\r\n            B = c * i - e * f,\r\n            t = c * j - g * f,\r\n            u = d * i - e * h,\r\n            v = d * j - g * h,\r\n            w = e * j - g * i,\r\n            x = k * p - l * n,\r\n            y = k * r - o * n,\r\n            z = k * s - m * n,\r\n            C = l * r - o * p,\r\n            D = l * s - m * p,\r\n            E = o * s - m * r,\r\n            q = 1 / (A * E - B * D + t * C + u * z - v * y + w * x);\r\n\r\n        res._m[0] = (h * E - i * D + j * C) * q;\r\n        res._m[1] = (-d * E + e * D - g * C) * q;\r\n        res._m[2] = (p * w - r * v + s * u) * q;\r\n        res._m[3] = (-l * w + o * v - m * u) * q;\r\n        res._m[4] = (-f * E + i * z - j * y) * q;\r\n        res._m[5] = (c * E - e * z + g * y) * q;\r\n        res._m[6] = (-n * w + r * t - s * B) * q;\r\n        res._m[7] = (k * w - o * t + m * B) * q;\r\n        res._m[8] = (f * D - h * z + j * x) * q;\r\n        res._m[9] = (-c * D + d * z - g * x) * q;\r\n        res._m[10] = (n * v - p * t + s * A) * q;\r\n        res._m[11] = (-k * v + l * t - m * A) * q;\r\n        res._m[12] = (-f * C + h * y - i * x) * q;\r\n        res._m[13] = (c * C - d * y + e * x) * q;\r\n        res._m[14] = (-n * u + p * B - r * A) * q;\r\n        res._m[15] = (k * u - l * B + o * A) * q;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Creates a transposed matrix of the current.\r\n     * @public\r\n     * @returns {Mat4} -\r\n     */\r\n    public transposeTo(): Mat4 {\r\n        let res = new Mat4();\r\n        res._m[0] = this._m[0];\r\n        res._m[1] = this._m[4];\r\n        res._m[2] = this._m[8];\r\n        res._m[3] = this._m[12];\r\n        res._m[4] = this._m[1];\r\n        res._m[5] = this._m[5];\r\n        res._m[6] = this._m[9];\r\n        res._m[7] = this._m[13];\r\n        res._m[8] = this._m[2];\r\n        res._m[9] = this._m[6];\r\n        res._m[10] = this._m[10];\r\n        res._m[11] = this._m[14];\r\n        res._m[12] = this._m[3];\r\n        res._m[13] = this._m[7];\r\n        res._m[14] = this._m[11];\r\n        res._m[15] = this._m[15];\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Sets matrix to identity.\r\n     * @public\r\n     * @returns {Mat4} -\r\n     */\r\n    public setIdentity(): Mat4 {\r\n        this._m[0] = 1;\r\n        this._m[1] = 0;\r\n        this._m[2] = 0;\r\n        this._m[3] = 0;\r\n        this._m[4] = 0;\r\n        this._m[5] = 1;\r\n        this._m[6] = 0;\r\n        this._m[7] = 0;\r\n        this._m[8] = 0;\r\n        this._m[9] = 0;\r\n        this._m[10] = 1;\r\n        this._m[11] = 0;\r\n        this._m[12] = 0;\r\n        this._m[13] = 0;\r\n        this._m[14] = 0;\r\n        this._m[15] = 1;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Computes the product of two matrices.\r\n     * @public\r\n     * @param {Mat4} mx - Matrix to multiply.\r\n     * @returns {Mat4} -\r\n     */\r\n    public mul(mx: Mat4): Mat4 {\r\n\r\n        let d = this._m[0],\r\n            e = this._m[1],\r\n            g = this._m[2],\r\n            f = this._m[3],\r\n            h = this._m[4],\r\n            i = this._m[5],\r\n            j = this._m[6],\r\n            k = this._m[7],\r\n            l = this._m[8],\r\n            o = this._m[9],\r\n            m = this._m[10],\r\n            n = this._m[11],\r\n            p = this._m[12],\r\n            r = this._m[13],\r\n            s = this._m[14],\r\n            a = this._m[15];\r\n\r\n        let A = mx._m[0],\r\n            B = mx._m[1],\r\n            t = mx._m[2],\r\n            u = mx._m[3],\r\n            v = mx._m[4],\r\n            w = mx._m[5],\r\n            x = mx._m[6],\r\n            y = mx._m[7],\r\n            z = mx._m[8],\r\n            C = mx._m[9],\r\n            D = mx._m[10],\r\n            E = mx._m[11],\r\n            q = mx._m[12],\r\n            F = mx._m[13],\r\n            G = mx._m[14],\r\n            b = mx._m[15];\r\n\r\n        let res = new Mat4();\r\n\r\n        res._m[0] = A * d + B * h + t * l + u * p;\r\n        res._m[1] = A * e + B * i + t * o + u * r;\r\n        res._m[2] = A * g + B * j + t * m + u * s;\r\n        res._m[3] = A * f + B * k + t * n + u * a;\r\n        res._m[4] = v * d + w * h + x * l + y * p;\r\n        res._m[5] = v * e + w * i + x * o + y * r;\r\n        res._m[6] = v * g + w * j + x * m + y * s;\r\n        res._m[7] = v * f + w * k + x * n + y * a;\r\n        res._m[8] = z * d + C * h + D * l + E * p;\r\n        res._m[9] = z * e + C * i + D * o + E * r;\r\n        res._m[10] = z * g + C * j + D * m + E * s;\r\n        res._m[11] = z * f + C * k + D * n + E * a;\r\n        res._m[12] = q * d + F * h + G * l + b * p;\r\n        res._m[13] = q * e + F * i + G * o + b * r;\r\n        res._m[14] = q * g + F * j + G * m + b * s;\r\n        res._m[15] = q * f + F * k + G * n + b * a;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Add translation vector to the current matrix.\r\n     * @public\r\n     * @param {Vec3} v - Translate vector.\r\n     * @returns {Mat4} -\r\n     */\r\n    public translate(v: Vec3): Mat4 {\r\n\r\n        let d = v.x,\r\n            e = v.y,\r\n            b = v.z;\r\n\r\n        let a = this._m;\r\n\r\n        a[12] = a[0] * d + a[4] * e + a[8] * b + a[12];\r\n        a[13] = a[1] * d + a[5] * e + a[9] * b + a[13];\r\n        a[14] = a[2] * d + a[6] * e + a[10] * b + a[14];\r\n        a[15] = a[3] * d + a[7] * e + a[11] * b + a[15];\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets translation matrix to the position.\r\n     * @public\r\n     * @param {Vec3} v - Translate to position.\r\n     * @returns {Mat4} -\r\n     */\r\n    public translateToPosition(v: Vec3): Mat4 {\r\n        let a = this._m;\r\n        a[12] = v.x;\r\n        a[13] = v.y;\r\n        a[14] = v.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Rotate current matrix around the aligned axis and angle.\r\n     * @public\r\n     * @param {Vec3} u - Aligned axis.\r\n     * @param {number} angle - Aligned axis angle in radians.\r\n     * @returns {Mat4} -\r\n     */\r\n    public rotate(u: Vec3, angle: number): Mat4 {\r\n\r\n        let c = Math.cos(angle),\r\n            s = Math.sin(angle);\r\n\r\n        let rot = new Mat4();\r\n        let mx = rot._m;\r\n\r\n        mx[0] = c + (1 - c) * u.x * u.x;\r\n        mx[1] = (1 - c) * u.y * u.x - s * u.z;\r\n        mx[2] = (1 - c) * u.z * u.x + s * u.y;\r\n        mx[3] = 0;\r\n        mx[4] = (1 - c) * u.x * u.y + s * u.z;\r\n        mx[5] = c + (1 - c) * u.y * u.y;\r\n        mx[6] = (1 - c) * u.z * u.y - s * u.x;\r\n        mx[7] = 0;\r\n        mx[8] = (1 - c) * u.x * u.z - s * u.y;\r\n        mx[9] = (1 - c) * u.y * u.z + s * u.x;\r\n        mx[10] = c + (1 - c) * u.z * u.z;\r\n        mx[11] = 0;\r\n        mx[12] = 0;\r\n        mx[13] = 0;\r\n        mx[14] = 0;\r\n        mx[15] = 1;\r\n\r\n        return this.mul(rot);\r\n    }\r\n\r\n    /**\r\n     * Sets current rotation matrix around the aligned axis and angle.\r\n     * @public\r\n     * @param {Vec3} u - Aligned axis.\r\n     * @param {number} angle - Aligned axis angle in radians.\r\n     * @returns {Mat4} -\r\n     */\r\n    public setRotation(u: Vec3, angle: number): Mat4 {\r\n\r\n        let c = Math.cos(angle),\r\n            s = Math.sin(angle);\r\n\r\n        let mx = this._m;\r\n\r\n        mx[0] = c + (1 - c) * u.x * u.x;\r\n        mx[1] = (1 - c) * u.y * u.x - s * u.z;\r\n        mx[2] = (1 - c) * u.z * u.x + s * u.y;\r\n        mx[3] = 0;\r\n        mx[4] = (1 - c) * u.x * u.y + s * u.z;\r\n        mx[5] = c + (1 - c) * u.y * u.y;\r\n        mx[6] = (1 - c) * u.z * u.y - s * u.x;\r\n        mx[7] = 0;\r\n        mx[8] = (1 - c) * u.x * u.z - s * u.y;\r\n        mx[9] = (1 - c) * u.y * u.z + s * u.x;\r\n        mx[10] = c + (1 - c) * u.z * u.z;\r\n        mx[11] = 0;\r\n        mx[12] = 0;\r\n        mx[13] = 0;\r\n        mx[14] = 0;\r\n        mx[15] = 1;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets the rotation matrix from one vector to another.\r\n     * @public\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {Mat4} -\r\n     */\r\n    public rotateBetweenVectors(a: Vec3, b: Vec3): Mat4 {\r\n        let q = Quat.getRotationBetweenVectors(a, b);\r\n        return q.getMat4();\r\n    }\r\n\r\n    /**\r\n     * Scale current matrix to the vector values.\r\n     * @public\r\n     * @param {Vec3} v - Scale vector.\r\n     * @returns {Mat4} -\r\n     */\r\n    public scale(v: Vec3): Mat4 {\r\n        let mx = this._m;\r\n        mx[0] = mx[0] * v.x;\r\n        mx[1] = mx[1] * v.x;\r\n        mx[2] = mx[2] * v.x;\r\n        mx[3] = mx[3] * v.x;\r\n        mx[4] = mx[4] * v.y;\r\n        mx[5] = mx[5] * v.y;\r\n        mx[6] = mx[6] * v.y;\r\n        mx[7] = mx[7] * v.y;\r\n        mx[8] = mx[8] * v.z;\r\n        mx[9] = mx[9] * v.z;\r\n        mx[10] = mx[10] * v.z;\r\n        mx[11] = mx[11] * v.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets perspective projection matrix frustum values.\r\n     * @public\r\n     * @param {number} left -\r\n     * @param {number} right -\r\n     * @param {number} bottom -\r\n     * @param {number} top -\r\n     * @param {number} near -\r\n     * @param {number} far -\r\n     * @returns {Mat4} -\r\n     */\r\n    public setPerspective(left: number, right: number, bottom: number, top: number, near: number, far: number): Mat4 {\r\n\r\n        let h = right - left,\r\n            i = top - bottom,\r\n            j = near - far,\r\n            n2 = 2 * near;\r\n\r\n        let mm = this._m;\r\n\r\n        mm[0] = n2 / h;\r\n        mm[1] = 0;\r\n        mm[2] = 0;\r\n        mm[3] = 0;\r\n\r\n        mm[4] = 0;\r\n        mm[5] = n2 / i;\r\n        mm[6] = 0;\r\n        mm[7] = 0;\r\n\r\n        mm[8] = (right + left) / h;\r\n        mm[9] = (top + bottom) / i;\r\n        mm[10] = (far + near) / j;\r\n        mm[11] = -1;\r\n\r\n        mm[12] = 0;\r\n        mm[13] = 0;\r\n        mm[14] = (n2 * far) / j;\r\n        mm[15] = 0;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Creates current orthographic projection matrix.\r\n     * @public\r\n     * @param {number} left -\r\n     * @param {number} right -\r\n     * @param {number} bottom -\r\n     * @param {number} top -\r\n     * @param {number} near -\r\n     * @param {number} far -\r\n     * @return {Mat4} -\r\n     */\r\n    public setOrtho(left: number, right: number, bottom: number, top: number, near: number, far: number): Mat4 {\r\n\r\n        let lr = 1.0 / (left - right),\r\n            bt = 1.0 / (bottom - top),\r\n            nf = 1.0 / (near - far),\r\n            m = this._m;\r\n\r\n        m[0] = -2.0 * lr;\r\n        m[1] = 0;\r\n        m[2] = 0;\r\n        m[3] = 0;\r\n        m[4] = 0;\r\n        m[5] = -2.0 * bt;\r\n        m[6] = 0;\r\n        m[7] = 0;\r\n        m[8] = 0;\r\n        m[9] = 0;\r\n        m[10] = 2.0 * nf;\r\n        m[11] = 0;\r\n        m[12] = (left + right) * lr;\r\n        m[13] = (top + bottom) * bt;\r\n        m[14] = (far + near) * nf;\r\n        m[15] = 1.0;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets current rotation matrix by euler's angles.\r\n     * @public\r\n     * @param {number} ax - Rotation angle in radians around X axis.\r\n     * @param {number} ay - Rotation angle in radians around Y axis.\r\n     * @param {number} az - Rotation angle in radians around Z axis.\r\n     * @returns {Mat4} -\r\n     */\r\n    public eulerToMatrix(ax: number, ay: number, az: number): Mat4 {\r\n\r\n        let a = Math.cos(ax),\r\n            b = Math.sin(ax),\r\n            c = Math.cos(ay),\r\n            d = Math.sin(ay),\r\n            e = Math.cos(az),\r\n            f = Math.sin(az);\r\n\r\n        let ad = a * d,\r\n            bd = b * d;\r\n\r\n        let mat = this._m;\r\n\r\n        mat[0] = c * e;\r\n        mat[1] = -c * f;\r\n        mat[2] = -d;\r\n        mat[4] = -bd * e + a * f;\r\n        mat[5] = bd * f + a * e;\r\n        mat[6] = -b * c;\r\n        mat[8] = ad * e + b * f;\r\n        mat[9] = -ad * f + b * e;\r\n        mat[10] = a * c;\r\n        mat[3] = mat[7] = mat[11] = mat[12] = mat[13] = mat[14] = 0;\r\n        mat[15] = 1;\r\n\r\n        return this;\r\n    }\r\n}\r\n\r\n/**\r\n * Mat4 factory.\r\n * @static\r\n * @returns {Mat4} -\r\n */\r\nexport function mat4(): Mat4 {\r\n    return new Mat4();\r\n}\r\n","import * as math from \"../math\";\r\nimport {Vec3} from \"./Vec3\";\r\nimport {Mat4} from \"./Mat4\";\r\nimport {Mat3} from \"./Mat3\";\r\nimport {PI_TWO} from \"../math\";\r\n\r\n/**\r\n * A set of 4-dimensional coordinates used to represent rotation in 3-dimensional space.\r\n * @constructor\r\n * @param {Number} [x=0.0] The X component.\r\n * @param {Number} [y=0.0] The Y component.\r\n * @param {Number} [z=0.0] The Z component.\r\n * @param {Number} [w=0.0] The W component.\r\n */\r\nexport class Quat {\r\n    /**\r\n     * The X component.\r\n     * @public\r\n     * @type {Number}\r\n     * @default 0.0\r\n     */\r\n    public x: number;\r\n\r\n    /**\r\n     * The Y component.\r\n     * @public\r\n     * @type {Number}\r\n     * @default 0.0\r\n     */\r\n    public y: number;\r\n\r\n    /**\r\n     * The Z component.\r\n     * @public\r\n     * @type {Number}\r\n     * @default 0.0\r\n     */\r\n    public z: number;\r\n\r\n    /**\r\n     * The W component.\r\n     * @public\r\n     * @type {Number}\r\n     * @default 0.0\r\n     */\r\n    public w: number;\r\n\r\n    constructor(x: number = 0.0, y: number = 0.0, z: number = 0.0, w: number = 0.0) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n    }\r\n\r\n    /**\r\n     * Identity Quat.\r\n     * @const\r\n     * @type {Quat}\r\n     */\r\n    static get IDENTITY(): Quat {\r\n        return new Quat(0.0, 0.0, 0.0, 1.0);\r\n    }\r\n\r\n    /**\r\n     * Returns a Quat represents rotation around X axis.\r\n     * @static\r\n     * @param {number} a - The angle in radians to rotate around the axis.\r\n     * @returns {Quat} -\r\n     */\r\n    static xRotation(a: number): Quat {\r\n        a *= 0.5;\r\n        return new Quat(Math.sin(a), 0.0, 0.0, Math.cos(a));\r\n    }\r\n\r\n    /**\r\n     * Returns a Quat represents rotation around Y axis.\r\n     * @static\r\n     * @param {number} a - The angle in radians to rotate around the axis.\r\n     * @returns {Quat} -\r\n     */\r\n    static yRotation(a: number): Quat {\r\n        a *= 0.5;\r\n        return new Quat(0.0, Math.sin(a), 0.0, Math.cos(a));\r\n    }\r\n\r\n    /**\r\n     * Returns a Quat represents rotation around Z axis.\r\n     * @static\r\n     * @param {number} a - The angle in radians to rotate around the axis.\r\n     * @returns {Quat} -\r\n     */\r\n    static zRotation(a: number): Quat {\r\n        a *= 0.5;\r\n        return new Quat(0.0, 0.0, Math.sin(a), Math.cos(a));\r\n    }\r\n\r\n    /**\r\n     * Computes a Quat representing a rotation around an axis.\r\n     * @static\r\n     * @param {Vec3} axis - The axis of rotation.\r\n     * @param {number} [angle=0.0] The angle in radians to rotate around the axis.\r\n     * @returns {Quat} -\r\n     */\r\n    static axisAngleToQuat(axis: Vec3, angle: number = 0): Quat {\r\n        let v = axis.getNormal();\r\n        let half_angle = angle * 0.5;\r\n        let sin_a = Math.sin(half_angle);\r\n        return new Quat(v.x * sin_a, v.y * sin_a, v.z * sin_a, Math.cos(half_angle));\r\n    }\r\n\r\n    /**\r\n     * Computes a rotation from the given heading and up vector.\r\n     * @static\r\n     * @param {Vec3} forward - Heading target coordinates.\r\n     * @param {Vec3} up - Up vector.\r\n     * @returns {Quat} -\r\n     */\r\n    static getLookRotation(forward: Vec3, up: Vec3): Quat {\r\n        let f = forward.getNormal().negate();\r\n        let s = up.cross(f).normalize();\r\n        let u = f.cross(s);\r\n        let z = 1.0 + s.x + u.y + f.z;\r\n\r\n        if (z > 0.000001) {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(z));\r\n            return new Quat((f.y - u.z) * fd, (s.z - f.x) * fd, (u.x - s.y) * fd, 0.25 / fd);\r\n        }\r\n\r\n        if (s.x > u.y && s.x > f.z) {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + s.x - u.y - f.z));\r\n            return new Quat(0.25 / fd, (u.x + s.y) * fd, (s.z + f.x) * fd, (f.y - u.z) * fd);\r\n        }\r\n\r\n        if (u.y > f.z) {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + u.y - s.x - f.z));\r\n            return new Quat((u.x + s.y) * fd, 0.25 / fd, (f.y + u.z) * fd, (s.z - f.x) * fd);\r\n        }\r\n\r\n        let fd = 1.0 / (2.0 * Math.sqrt(1.0 + f.z - s.x - u.y));\r\n        return new Quat((s.z + f.x) * fd, (f.y + u.z) * fd, 0.25 / fd, (u.x - s.y) * fd);\r\n    }\r\n\r\n    /**\r\n     * Computes a Quat from source point heading to the destination point.\r\n     * @static\r\n     * @param {Vec3} sourcePoint - Source coordinate.\r\n     * @param {Vec3} destPoint - Destination coordinate.\r\n     * @returns {Quat} -\r\n     */\r\n    static getLookAtSourceDest(sourcePoint: Vec3, destPoint: Vec3): Quat {\r\n        let forwardVector = destPoint.subA(sourcePoint).normalize();\r\n        let dot = Vec3.FORWARD.dot(forwardVector);\r\n        if (Math.abs(dot - -1.0) < 0.000001) {\r\n            return Quat.axisAngleToQuat(Vec3.UP, Math.PI);\r\n        }\r\n        if (Math.abs(dot - 1.0) < 0.000001) {\r\n            return new Quat(0.0, 0.0, 0.0, 1.0);\r\n        }\r\n        let rotAngle = Math.acos(dot);\r\n        let rotAxis = Vec3.FORWARD.cross(forwardVector).normalize();\r\n        return Quat.axisAngleToQuat(rotAxis, rotAngle);\r\n    }\r\n\r\n    /**\r\n     * Compute rotation between two vectors.\r\n     * @static\r\n     * @param {Vec3} u - First vector.\r\n     * @param {Vec3} v - Second vector.\r\n     * @returns {Quat} -\r\n     */\r\n    static getRotationBetweenVectors(u: Vec3, v: Vec3): Quat {\r\n        let w = u.cross(v);\r\n        let q = new Quat(w.x, w.y, w.z, 1.0 + u.dot(v));\r\n        return q.normalize();\r\n    }\r\n\r\n    /**\r\n     * Compute rotation between two vectors.\r\n     * @static\r\n     * @param {Vec3} u - First vector.\r\n     * @param {Vec3} v - Second vector.\r\n     * @param {Quat} res\r\n     * @returns {Quat} -\r\n     */\r\n    static getRotationBetweenVectorsRes(u: Vec3, v: Vec3, res: Quat): Quat {\r\n        let w = u.cross(v);\r\n        res.set(w.x, w.y, w.z, 1.0 + u.dot(v));\r\n        return res.normalize();\r\n    }\r\n\r\n    /**\r\n     * Compute rotation between two vectors with around vector up\r\n     * for exactly opposite vectors. If vectors exactly in the same\r\n     * direction as returns identity Quat.\r\n     * @static\r\n     * @param {Vec3} source - First vector.\r\n     * @param {Vec3} dest - Second vector.\r\n     * @param {Vec3} up - Up vector.\r\n     * @returns {Quat} -\r\n     */\r\n    static getRotationBetweenVectorsUp(source: Vec3, dest: Vec3, up: Vec3): Quat {\r\n        let dot = source.dot(dest);\r\n        if (Math.abs(dot + 1.0) < 0.000001) {\r\n            // vector source and dest point exactly in the opposite direction,\r\n            // so it is a 180 degrees turn around the up-axis\r\n            return Quat.axisAngleToQuat(up, Math.PI);\r\n        }\r\n        if (Math.abs(dot - 1.0) < 0.000001) {\r\n            // vector source and dest point exactly in the same direction,\r\n            // so we return the identity Quat\r\n            return new Quat(0, 0, 0, 1);\r\n        }\r\n        let rotAngle = Math.acos(dot);\r\n        let rotAxis = source.cross(dest).normalize();\r\n        return Quat.axisAngleToQuat(rotAxis, rotAngle);\r\n    }\r\n\r\n    // static setFromEulerAngles(pitch: number, yaw: number, roll: number): Quat {\r\n    //     let res = new Quat();\r\n    //     return res.setFromEulerAngles(pitch, yaw, roll);\r\n    // }\r\n\r\n    /**\r\n     * Returns true if the components are zero.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public isZero(): boolean {\r\n        return this.x === 0.0 && this.y === 0.0 && this.z === 0.0 && this.w === 0.0;\r\n    }\r\n\r\n    /**\r\n     * Returns true if a component is NaN.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public isNaN(): boolean {\r\n        return isNaN(this.x) || isNaN(this.y) || isNaN(this.z) || isNaN(this.w);\r\n    }\r\n\r\n    /**\r\n     * Clear Quat. Sets zeroes.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public clear(): Quat {\r\n        this.x = this.y = this.z = this.w = 0;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets Quat values.\r\n     * @public\r\n     * @param {Number} [x=0.0] The X component.\r\n     * @param {Number} [y=0.0] The Y component.\r\n     * @param {Number} [z=0.0] The Z component.\r\n     * @param {Number} [w=0.0] The W component.\r\n     * @returns {Quat} -\r\n     */\r\n    public set(x: number, y: number, z: number, w: number): Quat {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        this.w = w;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Copy Quat values.\r\n     * @public\r\n     * @param {Quat} q - Copy Quat.\r\n     * @returns {Quat} -\r\n     */\r\n    public copy(q: Quat): Quat {\r\n        this.x = q.x;\r\n        this.y = q.y;\r\n        this.z = q.z;\r\n        this.w = q.w;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set current Quat instance to identity Quat.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public setIdentity(): Quat {\r\n        this.x = 0.0;\r\n        this.y = 0.0;\r\n        this.z = 0.0;\r\n        this.w = 1.0;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Duplicates a Quat instance.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public clone(): Quat {\r\n        return new Quat(this.x, this.y, this.z, this.w);\r\n    }\r\n\r\n    /**\r\n     * Computes the componentwise sum of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Quat to add.\r\n     * @returns {Quat} -\r\n     */\r\n    public add(q: Quat): Quat {\r\n        return new Quat(this.x + q.x, this.y + q.y, this.z + q.z, this.w + q.w);\r\n    }\r\n\r\n    /**\r\n     * Computes the componentwise sum of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Quat to add.\r\n     * @returns {Quat} -\r\n     */\r\n    public addRes(q: Quat, res: Quat): Quat {\r\n        return res.set(this.x + q.x, this.y + q.y, this.z + q.z, this.w + q.w);\r\n    }\r\n\r\n    /**\r\n     * Computes the componentwise difference of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Quat to subtract.\r\n     * @returns {Quat} -\r\n     */\r\n    public sub(q: Quat): Quat {\r\n        return new Quat(this.x - q.x, this.y - q.y, this.z - q.z, this.w - q.w);\r\n    }\r\n\r\n    /**\r\n     * Multiplies the provided Quat componentwise by the provided scalar.\r\n     * @public\r\n     * @param {Number} scale - The scalar to multiply with.\r\n     * @returns {Quat} -\r\n     */\r\n    public scaleTo(scale: number): Quat {\r\n        return new Quat(this.x * scale, this.y * scale, this.z * scale, this.w * scale);\r\n    }\r\n\r\n    /**\r\n     * Multiplies the provided Quat componentwise.\r\n     * @public\r\n     * @param {Number} scale - The scalar to multiply with.\r\n     * @returns {Quat} -\r\n     */\r\n    public scale(scale: number): Quat {\r\n        this.x *= scale;\r\n        this.y *= scale;\r\n        this.z *= scale;\r\n        this.w *= scale;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Converts Quat values to array.\r\n     * @public\r\n     * @returns {Array.<number>} - (exactly 4 entries)\r\n     */\r\n    public toVec(): [number, number, number, number] {\r\n        return [this.x, this.y, this.z, this.w];\r\n    }\r\n\r\n    public get xyz() {\r\n        return new Vec3(this.x, this.y, this.z);\r\n    }\r\n\r\n    /**\r\n     * Sets rotation with the given heading and up vectors.\r\n     * @static\r\n     * @param {Vec3} forward - Heading target coordinates.\r\n     * @param {Vec3} up - Up vector.\r\n     * @returns {Quat} -\r\n     */\r\n    public setLookRotation(forward: Vec3, up: Vec3): Quat {\r\n        let f = forward.getNormal().negate();\r\n        let s = up.cross(f).normalize();\r\n        let u = f.cross(s);\r\n        let z = 1.0 + s.x + u.y + f.z;\r\n\r\n        if (z > 0.000001) {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(z));\r\n            this.x = (f.y - u.z) * fd;\r\n            this.y = (s.z - f.x) * fd;\r\n            this.z = (u.x - s.y) * fd;\r\n            this.w = 0.25 / fd;\r\n        } else if (s.x > u.y && s.x > f.z) {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + s.x - u.y - f.z));\r\n            this.x = 0.25 / fd;\r\n            this.y = (u.x + s.y) * fd;\r\n            this.z = (s.z + f.x) * fd;\r\n            this.w = (f.y - u.z) * fd;\r\n        } else if (u.y > f.z) {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + u.y - s.x - f.z));\r\n            this.x = (u.x + s.y) * fd;\r\n            this.y = 0.25 / fd;\r\n            this.z = (f.y + u.z) * fd;\r\n            this.w = (s.z - f.x) * fd;\r\n        } else {\r\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + f.z - s.x - u.y));\r\n            this.x = (s.z + f.x) * fd;\r\n            this.y = (f.y + u.z) * fd;\r\n            this.z = 0.25 / fd;\r\n            this.w = (u.x - s.y) * fd;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets current quaternion by spherical coordinates.\r\n     * @public\r\n     * @param {number} lat - Latitude.\r\n     * @param {number} lon - Longitude.\r\n     * @param {number} angle - Angle in radians.\r\n     * @returns {Quat} -\r\n     */\r\n    public setFromSphericalCoords(lat: number, lon: number, angle: number): Quat {\r\n        let sin_a = Math.sin(angle / 2);\r\n        let cos_a = Math.cos(angle / 2);\r\n        let sin_lat = Math.sin(lat);\r\n        let cos_lat = Math.cos(lat);\r\n        let sin_long = Math.sin(lon);\r\n        let cos_long = Math.cos(lon);\r\n\r\n        this.x = sin_a * cos_lat * sin_long;\r\n        this.y = sin_a * sin_lat;\r\n        this.z = sin_a * sin_lat * cos_long;\r\n        this.w = cos_a;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets spherical coordinates.\r\n     * @public\r\n     * @returns {Object} Returns object with latitude, longitude and alpha.\r\n     */\r\n    public getSphericalCoords(): any {\r\n\r\n        let cos_a = this.w;\r\n        let sin_a = Math.sqrt(1.0 - cos_a * cos_a);\r\n\r\n        // var angle = Math.acos(cos_a) * 2;\r\n        if (Math.abs(sin_a) < 0.0005) {\r\n            sin_a = 1;\r\n        }\r\n\r\n        let tx = this.x / sin_a;\r\n        let ty = this.y / sin_a;\r\n        let tz = this.z / sin_a;\r\n\r\n        let lon, lat = -Math.asin(ty);\r\n\r\n        if (tx * tx + tz * tz < 0.0005) {\r\n            lon = 0;\r\n        } else {\r\n            lon = Math.atan2(tx, tz);\r\n        }\r\n\r\n        if (lon < 0) {\r\n            lon += 360.0;\r\n        }\r\n\r\n        return {\r\n            lat: lat,\r\n            lon: lon,\r\n            alpha: Math.acos(cos_a)\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Sets current Quat representing a rotation around an axis.\r\n     * @public\r\n     * @param {Vec3} axis - The axis of rotation.\r\n     * @param {number} angle The angle in radians to rotate around the axis.\r\n     * @returns {Quat} -\r\n     */\r\n    public setFromAxisAngle(axis: Vec3, angle: number): Quat {\r\n        let v = axis.getNormal();\r\n        let half_angle = angle * 0.5;\r\n        let sin_a = Math.sin(half_angle);\r\n        this.set(v.x * sin_a, v.y * sin_a, v.z * sin_a, Math.cos(half_angle));\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * @typedef {Object} QuatAxisAngle\r\n     * @property {Vec3} axis - The rotation axis.\r\n     * @property {number} angle - The rotation angle in radians.\r\n     */\r\n\r\n    /**\r\n     * Returns axis and angle of the current Quat.\r\n     * @public\r\n     * @returns QuatAxisAngle -\r\n     */\r\n    public getAxisAngle(): { axis: Vec3, angle: number } {\r\n        let x = this.x,\r\n            y = this.y,\r\n            z = this.z,\r\n            w = this.w;\r\n        let vl = Math.sqrt(x * x + y * y + z * z);\r\n        let axis, angle;\r\n        if (vl > 0.0000001) {\r\n            let ivl = 1.0 / vl;\r\n            axis = new Vec3(x * ivl, y * ivl, z * ivl);\r\n            if (w < 0) {\r\n                angle = 2.0 * Math.atan2(-vl, -w); // -PI,0\r\n            } else {\r\n                angle = 2.0 * Math.atan2(vl, w); // 0,PI\r\n            }\r\n        } else {\r\n            axis = new Vec3(0, 0, 0);\r\n            angle = 0;\r\n        }\r\n\r\n        return {\r\n            axis: axis,\r\n            angle: angle\r\n        };\r\n    }\r\n\r\n    public getPitch(): number {\r\n        let sinPitch = -2 * (this.y * this.z - this.w * this.x);\r\n        return Math.abs(sinPitch) >= 1\r\n            ? Math.sign(sinPitch) * PI_TWO\r\n            : Math.asin(sinPitch);\r\n    }\r\n\r\n    public getYaw(): number {\r\n        return -Math.atan2(2 * (this.x * this.z + this.w * this.y), 1 - 2 * (this.y * this.y + this.x * this.x));\r\n    }\r\n\r\n    public getRoll() {\r\n        return Math.atan2(2 * (this.x * this.y + this.w * this.z), 1 - 2 * (this.z * this.z + this.x * this.x));\r\n    }\r\n\r\n    public setPitchYawRoll(pitchRad: number, yawRad: number, rollRad: number, frame: Quat = Quat.IDENTITY): Quat {\r\n        let qp = Quat.xRotation(-pitchRad);\r\n        let qy = Quat.yRotation(yawRad);\r\n        let qr = Quat.zRotation(-rollRad);\r\n        return this.copy(qr.mul(qp).mul(qy).mul(frame).conjugate());\r\n    }\r\n\r\n    /**\r\n     * Sets current Quat by Euler's angles.\r\n     * @public\r\n     * @param {number} pitch - Pitch angle in degrees.\r\n     * @param {number} yaw - Yaw angle in degrees.\r\n     * @param {number} roll - Roll angle in degrees.\r\n     * @returns {Quat} -\r\n     */\r\n    public setFromEulerAngles(pitch: number, yaw: number, roll: number): Quat {\r\n        let ex = pitch * math.RADIANS_HALF,\r\n            ey = yaw * math.RADIANS_HALF,\r\n            ez = roll * math.RADIANS_HALF;\r\n\r\n        let cr = Math.cos(ex),\r\n            cp = Math.cos(ey),\r\n            cy = Math.cos(ez);\r\n\r\n        let sr = Math.sin(ex),\r\n            sp = Math.sin(ey),\r\n            sy = Math.sin(ez);\r\n\r\n        let cpcy = cp * cy,\r\n            spsy = sp * sy;\r\n\r\n        this.w = cr * cpcy + sr * spsy;\r\n        this.x = sr * cpcy - cr * spsy;\r\n        this.y = cr * sp * cy + sr * cp * sy;\r\n        this.z = cr * cp * sy - sr * sp * cy;\r\n\r\n        return this.normalize();\r\n    }\r\n\r\n    /**\r\n     * Returns Euler's angles of the current Quat.\r\n     * @public\r\n     * @returns {Object} -\r\n     */\r\n    public getEulerAngles(): any {\r\n        let x = this.x,\r\n            y = this.y,\r\n            z = this.z,\r\n            w = this.w;\r\n\r\n        let sqy = y * y;\r\n\r\n        let roll = Math.atan2(2.0 * (w * x + y * z), 1.0 - 2.0 * (x * x + sqy));\r\n\r\n        let a = w * y - z * x;\r\n\r\n        if (a < -1.0) {\r\n            a = -1.0;\r\n        } else if (a > 1.0) {\r\n            a = 1.0;\r\n        }\r\n        let pitch = Math.asin(2.0 * a);\r\n\r\n        let yaw = Math.atan2(2.0 * (w * z + x * y), 1.0 - 2.0 * (sqy + z * z));\r\n\r\n        return {\r\n            roll,\r\n            pitch,\r\n            yaw\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Computes a Quat from the provided 4x4 matrix instance.\r\n     * @public\r\n     * @param {Mat4} mx - The rotation matrix.\r\n     * @returns {Quat} -\r\n     */\r\n    public setFromMatrix4(mx: Mat4): Quat {\r\n        let tr,\r\n            s,\r\n            q = [];\r\n        let i, j, k;\r\n        let m = mx._m;\r\n\r\n        let nxt = [1, 2, 0];\r\n\r\n        tr = m[0] + m[5] + m[10];\r\n\r\n        if (tr > 0.0) {\r\n            s = Math.sqrt(tr + 1.0);\r\n            this.w = s / 2.0;\r\n            s = 0.5 / s;\r\n            this.x = (m[6] - m[9]) * s;\r\n            this.y = (m[8] - m[2]) * s;\r\n            this.z = (m[1] - m[4]) * s;\r\n        } else {\r\n            i = 0;\r\n            if (m[5] > m[0]) i = 1;\r\n            if (m[10] > m[i * 5]) i = 2;\r\n            j = nxt[i];\r\n            k = nxt[j];\r\n\r\n            s = Math.sqrt(m[i * 5] - (m[j * 5] + m[k * 5]) + 1.0);\r\n\r\n            q[i] = s * 0.5;\r\n\r\n            if (s !== 0.0) s = 0.5 / s;\r\n\r\n            q[3] = (m[j * 4 + k] - m[k * 4 + j]) * s;\r\n            q[j] = (m[i * 4 + j] + m[j * 4 + i]) * s;\r\n            q[k] = (m[i * 4 + k] + m[k * 4 + i]) * s;\r\n\r\n            this.x = q[0];\r\n            this.y = q[1];\r\n            this.z = q[2];\r\n            this.w = q[3];\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Converts current Quat to the rotation 4x4 matrix.\r\n     * @public\r\n     * @params {Mat4} [out] - Output matrix\r\n     * @returns {Mat4} -\r\n     */\r\n    public getMat4(out: Mat4 = new Mat4()): Mat4 {\r\n        let xs = this.x + this.x;\r\n        let ys = this.y + this.y;\r\n        let zs = this.z + this.z;\r\n        let wx = this.w * xs;\r\n        let wy = this.w * ys;\r\n        let wz = this.w * zs;\r\n        let xx = this.x * xs;\r\n        let xy = this.x * ys;\r\n        let xz = this.x * zs;\r\n        let yy = this.y * ys;\r\n        let yz = this.y * zs;\r\n        let zz = this.z * zs;\r\n\r\n        return out.set([\r\n            1 - (yy + zz), xy - wz, xz + wy, 0,\r\n            xy + wz, 1 - (xx + zz), yz - wx, 0,\r\n            xz - wy, yz + wx, 1 - (xx + yy), 0,\r\n            0, 0, 0, 1\r\n        ]);\r\n    }\r\n\r\n    /**\r\n     * Converts current Quat to the rotation 3x3 matrix.\r\n     * @public\r\n     * @returns {Mat3} -\r\n     * @todo NOT TESTED\r\n     */\r\n    public getMat3(): Mat3 {\r\n        let m = new Mat3();\r\n        let mx = m._m;\r\n        let c = this.x,\r\n            d = this.y,\r\n            e = this.z,\r\n            g = this.w,\r\n            f = c + c,\r\n            h = d + d,\r\n            i = e + e,\r\n            j = c * f,\r\n            k = c * h;\r\n\r\n        c = c * i;\r\n\r\n        let l = d * h;\r\n\r\n        d = d * i;\r\n        e = e * i;\r\n        f = g * f;\r\n        h = g * h;\r\n        g = g * i;\r\n\r\n        mx[0] = 1 - (l + e);\r\n        mx[1] = k - g;\r\n        mx[2] = c + h;\r\n        mx[3] = k + g;\r\n        mx[4] = 1 - (j + e);\r\n        mx[5] = d - f;\r\n        mx[6] = c - h;\r\n        mx[7] = d + f;\r\n        mx[8] = 1 - (j + l);\r\n\r\n        return m;\r\n    }\r\n\r\n    /**\r\n     * Returns quaternion and vector production.\r\n     * @public\r\n     * @param {Vec3} v - 3d Vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public mulVec3(v: Vec3): Vec3 {\r\n        // t = 2 * cross(q.xyz, v)\r\n        // v' = v + q.w * t + cross(q.xyz, t)\r\n\r\n        let d = v.x,\r\n            e = v.y,\r\n            g = v.z;\r\n\r\n        let b = this.x,\r\n            f = this.y,\r\n            h = this.z,\r\n            a = this.w;\r\n\r\n        let i = a * d + f * g - h * e,\r\n            j = a * e + h * d - b * g,\r\n            k = a * g + b * e - f * d;\r\n\r\n        d = -b * d - f * e - h * g;\r\n\r\n        return new Vec3(\r\n            i * a + d * -b + j * -h - k * -f,\r\n            j * a + d * -f + k * -b - i * -h,\r\n            k * a + d * -h + i * -f - j * -b\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns quaternion and vector production.\r\n     * @public\r\n     * @param {Vec3} v - 3d Vector.\r\n     * @param {Vec3} res - result output vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public mulVec3Res(v: Vec3, res: Vec3): Vec3 {\r\n        // t = 2 * cross(q.xyz, v)\r\n        // v' = v + q.w * t + cross(q.xyz, t)\r\n\r\n        let d = v.x,\r\n            e = v.y,\r\n            g = v.z;\r\n\r\n        let b = this.x,\r\n            f = this.y,\r\n            h = this.z,\r\n            a = this.w;\r\n\r\n        let i = a * d + f * g - h * e,\r\n            j = a * e + h * d - b * g,\r\n            k = a * g + b * e - f * d;\r\n\r\n        d = -b * d - f * e - h * g;\r\n\r\n        return res.set(\r\n            i * a + d * -b + j * -h - k * -f,\r\n            j * a + d * -f + k * -b - i * -h,\r\n            k * a + d * -h + i * -f - j * -b\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Computes the product of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Quat to multiply.\r\n     * @returns {Quat} -\r\n     */\r\n    public mul(q: Quat): Quat {\r\n        let d = this.x,\r\n            e = this.y,\r\n            g = this.z,\r\n            a = this.w;\r\n\r\n        let f = q.x,\r\n            h = q.y,\r\n            i = q.z,\r\n            b = q.w;\r\n\r\n        return new Quat(\r\n            d * b + a * f + e * i - g * h,\r\n            e * b + a * h + g * f - d * i,\r\n            g * b + a * i + d * h - e * f,\r\n            a * b - d * f - e * h - g * i\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Computes the product of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Quat to multiply.\r\n     * @returns {Quat} -\r\n     */\r\n    public mulRes(q: Quat, res: Quat): Quat {\r\n        let d = this.x,\r\n            e = this.y,\r\n            g = this.z,\r\n            a = this.w;\r\n\r\n        let f = q.x,\r\n            h = q.y,\r\n            i = q.z,\r\n            b = q.w;\r\n\r\n        return res.set(\r\n            d * b + a * f + e * i - g * h,\r\n            e * b + a * h + g * f - d * i,\r\n            g * b + a * i + d * h - e * f,\r\n            a * b - d * f - e * h - g * i\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Computes the product of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Quat to multiply.\r\n     * @returns {Quat} -\r\n     */\r\n    public mulA(q: Quat): Quat {\r\n        let d = this.x,\r\n            e = this.y,\r\n            g = this.z,\r\n            a = this.w;\r\n\r\n        let f = q.x,\r\n            h = q.y,\r\n            i = q.z,\r\n            b = q.w;\r\n\r\n        this.x = d * b + a * f + e * i - g * h;\r\n        this.y = e * b + a * h + g * f - d * i;\r\n        this.z = g * b + a * i + d * h - e * f;\r\n        this.w = a * b - d * f - e * h - g * i;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets the conjugate of the Quat.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public conjugate(): Quat {\r\n        return new Quat(-this.x, -this.y, -this.z, this.w);\r\n    }\r\n\r\n    /**\r\n     * Computes the inverse of the Quat.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public inverse(): Quat {\r\n        let n = 1.0 / this.magnitude2();\r\n        return new Quat(-this.x * n, -this.y * n, -this.z * n, this.w * n);\r\n    }\r\n\r\n    /**\r\n     * Computes a magnitude of the Quat.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public magnitude(): number {\r\n        let b = this.x,\r\n            c = this.y,\r\n            d = this.z,\r\n            a = this.w;\r\n        return Math.sqrt(b * b + c * c + d * d + a * a);\r\n    }\r\n\r\n    /**\r\n     * Computes a squared magnitude of the Quat.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public magnitude2(): number {\r\n        let b = this.x,\r\n            c = this.y,\r\n            d = this.z,\r\n            a = this.w;\r\n        return b * b + c * c + d * d + a * a;\r\n    }\r\n\r\n    /**\r\n     * Computes the dot (scalar) product of two Quats.\r\n     * @public\r\n     * @param {Quat} q - Second quaternion.\r\n     * @returns {number} -\r\n     */\r\n    public dot(q: Quat): number {\r\n        return this.x * q.x + this.y * q.y + this.z * q.z;\r\n    }\r\n\r\n    /**\r\n     * Current Quat normalization.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public normalize(): Quat {\r\n\r\n        let c = this.x,\r\n            d = this.y,\r\n            e = this.z,\r\n            g = this.w,\r\n            f = Math.sqrt(c * c + d * d + e * e + g * g);\r\n\r\n        if (f === 0.0) {\r\n            this.x = 0;\r\n            this.y = 0;\r\n            this.z = 0;\r\n            this.w = 0;\r\n            return this;\r\n        }\r\n\r\n        f = 1 / f;\r\n        this.x = c * f;\r\n        this.y = d * f;\r\n        this.z = e * f;\r\n        this.w = g * f;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Compares two Quats.\r\n     * @public\r\n     * @param {Quat} q - Second quaternion.\r\n     * @returns {Boolean} -\r\n     */\r\n    public isEqual(q: Quat): boolean {\r\n        let matching = this.dot(q);\r\n        if (Math.abs(matching - 1.0) < 0.001) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Performs a spherical linear interpolation between two Quats.\r\n     * @public\r\n     * @param {Quat} b - The end rotation Quat.\r\n     * @param {number} t - interpolation amount between the two Quats.\r\n     * @returns {Quat} -\r\n     */\r\n    public slerp(b: Quat, t: number): Quat {\r\n\r\n        let ax = this.x,\r\n            ay = this.y,\r\n            az = this.z,\r\n            aw = this.w,\r\n            bx = b.x,\r\n            by = b.y,\r\n            bz = b.z,\r\n            bw = b.w;\r\n\r\n        let omega, cosom, sinom, scale0, scale1;\r\n\r\n        cosom = ax * bx + ay * by + az * bz + aw * bw;\r\n\r\n        if (cosom < 0.0) {\r\n            cosom = -cosom;\r\n            bx = -bx;\r\n            by = -by;\r\n            bz = -bz;\r\n            bw = -bw;\r\n        }\r\n\r\n        if (1.0 - cosom > 0.000001) {\r\n            omega = Math.acos(cosom);\r\n            sinom = Math.sin(omega);\r\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\r\n            scale1 = Math.sin(t * omega) / sinom;\r\n        } else {\r\n            scale0 = 1.0 - t;\r\n            scale1 = t;\r\n        }\r\n\r\n        return new Quat(\r\n            scale0 * ax + scale1 * bx,\r\n            scale0 * ay + scale1 * by,\r\n            scale0 * az + scale1 * bz,\r\n            scale0 * aw + scale1 * bw\r\n        );\r\n    }\r\n\r\n    // /**\r\n    //  * Returns a roll angle in radians.\r\n    //  * @public\r\n    //  * @param {Boolean} [reprojectAxis] -\r\n    //  * @returns {Number} -\r\n    //  */\r\n    // public getRoll(reprojectAxis: boolean = false): number {\r\n    //\r\n    //     let x = this.x,\r\n    //         y = this.y,\r\n    //         z = this.z,\r\n    //         w = this.w;\r\n    //\r\n    //     if (reprojectAxis) {\r\n    //         let fTy = 2.0 * y;\r\n    //         let fTz = 2.0 * z;\r\n    //         let fTwz = fTz * w;\r\n    //         let fTxy = fTy * x;\r\n    //         let fTyy = fTy * y;\r\n    //         let fTzz = fTz * z;\r\n    //         return Math.atan2(fTxy + fTwz, 1.0 - (fTyy + fTzz));\r\n    //     } else {\r\n    //         return Math.atan2(2 * (x * y + w * z), w * w + x * x - y * y - z * z);\r\n    //     }\r\n    // }\r\n    //\r\n    // /**\r\n    //  * Returns a pitch angle in radians.\r\n    //  * @public\r\n    //  * @param {Boolean} [reprojectAxis] -\r\n    //  * @returns {number} -\r\n    //  */\r\n    // public getPitch(reprojectAxis: boolean = false): number {\r\n    //\r\n    //     let x = this.x,\r\n    //         y = this.y,\r\n    //         z = this.z,\r\n    //         w = this.w;\r\n    //\r\n    //     if (reprojectAxis) {\r\n    //         let fTx = 2.0 * x;\r\n    //         let fTz = 2.0 * z;\r\n    //         let fTwx = fTx * w;\r\n    //         let fTxx = fTx * x;\r\n    //         let fTyz = fTz * y;\r\n    //         let fTzz = fTz * z;\r\n    //         return Math.atan2(fTyz + fTwx, 1.0 - (fTxx + fTzz));\r\n    //     } else {\r\n    //         return Math.atan2(2 * (y * z + w * x), w * w - x * x - y * y + z * z);\r\n    //     }\r\n    // }\r\n    //\r\n    // /**\r\n    //  * Returns a yaw angle in radians.\r\n    //  * @public\r\n    //  * @param {Boolean} [reprojectAxis] -\r\n    //  * @returns {number} -\r\n    //  */\r\n    // public getYaw(reprojectAxis: boolean = false): number {\r\n    //\r\n    //     let x = this.x,\r\n    //         y = this.y,\r\n    //         z = this.z,\r\n    //         w = this.w;\r\n    //\r\n    //     if (reprojectAxis) {\r\n    //         let fTx = 2.0 * x;\r\n    //         let fTy = 2.0 * y;\r\n    //         let fTz = 2.0 * z;\r\n    //         let fTwy = fTy * w;\r\n    //         let fTxx = fTx * x;\r\n    //         let fTxz = fTz * x;\r\n    //         let fTyy = fTy * y;\r\n    //         return Math.atan2(fTxz + fTwy, 1.0 - (fTxx + fTyy));\r\n    //     } else {\r\n    //         return Math.asin(-2 * (x * z - w * y));\r\n    //     }\r\n    // }\r\n}\r\n\r\n/**\r\n * Creates Quat instance.\r\n * @function\r\n * @param {Number} [x=0.0] The X component.\r\n * @param {Number} [y=0.0] The Y component.\r\n * @param {Number} [z=0.0] The Z component.\r\n * @param {Number} [w=0.0] The W component.\r\n * @returns {Quat} -\r\n */\r\nexport function quat(x: number = 0, y: number = 0, z: number = 0, w: number = 0): Quat {\r\n    return new Quat(x, y, z, w);\r\n}\r\n","import {Quat} from \"./Quat\";\r\nimport {Vec4} from \"./Vec4\";\r\nimport type {NumberArray4} from \"./Vec4\";\r\nimport type {NumberArray2} from \"./Vec2\";\r\n\r\nexport type NumberArray3 = [number, number, number];\r\n\r\n/**\r\n * Class represents a 3d vector.\r\n * @class\r\n * @param {number} [x] - First value.\r\n * @param {number} [y] - Second value.\r\n * @param {number} [z] - Third value.\r\n */\r\nexport class Vec3 {\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public x: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public y: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public z: number;\r\n\r\n    constructor(x: number = 0.0, y: number = 0.0, z: number = 0.0) {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n    }\r\n\r\n    /** @const */\r\n    static get UP(): Vec3 {\r\n        return new Vec3(0, 1, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get DOWN(): Vec3 {\r\n        return new Vec3(0, -1, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get RIGHT(): Vec3 {\r\n        return new Vec3(1, 0, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get LEFT(): Vec3 {\r\n        return new Vec3(-1, 0, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get FORWARD(): Vec3 {\r\n        return new Vec3(0, 0, -1);\r\n    }\r\n\r\n    /** @const */\r\n    static get BACKWARD(): Vec3 {\r\n        return new Vec3(0, 0, 1);\r\n    }\r\n\r\n    /** @const */\r\n    static get ZERO(): Vec3 {\r\n        return new Vec3();\r\n    }\r\n\r\n    /** @const */\r\n    static get UNIT_X(): Vec3 {\r\n        return new Vec3(1, 0, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get UNIT_Y(): Vec3 {\r\n        return new Vec3(0, 1, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get UNIT_Z(): Vec3 {\r\n        return new Vec3(0, 0, 1);\r\n    }\r\n\r\n    /** @const */\r\n    static get NORTH(): Vec3 {\r\n        return Vec3.UNIT_Z;\r\n    }\r\n\r\n    /**\r\n     * Separate 63 bit Vec3 to two Vec3 32-bit float values.\r\n     * @function\r\n     * @param {Vec3} v - Double type value.\r\n     * @param {Vec3} high - Out vector high values.\r\n     * @param {Vec3} low - Out vector low values.\r\n     */\r\n    static doubleToTwoFloats(v: Vec3, high: Vec3, low: Vec3) {\r\n        let x = v.x,\r\n            y = v.y,\r\n            z = v.z;\r\n\r\n        if (x >= 0.0) {\r\n            let doubleHigh = Math.floor(x / 65536.0) * 65536.0;\r\n            high.x = Math.fround(doubleHigh);\r\n            low.x = Math.fround(x - doubleHigh);\r\n        } else {\r\n            let doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\r\n            high.x = Math.fround(-doubleHigh);\r\n            low.x = Math.fround(x + doubleHigh);\r\n        }\r\n\r\n        if (y >= 0.0) {\r\n            let doubleHigh = Math.floor(y / 65536.0) * 65536.0;\r\n            high.y = Math.fround(doubleHigh);\r\n            low.y = Math.fround(y - doubleHigh);\r\n        } else {\r\n            let doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\r\n            high.y = Math.fround(-doubleHigh);\r\n            low.y = Math.fround(y + doubleHigh);\r\n        }\r\n\r\n        if (z >= 0.0) {\r\n            let doubleHigh = Math.floor(z / 65536.0) * 65536.0;\r\n            high.z = Math.fround(doubleHigh);\r\n            low.z = Math.fround(z - doubleHigh);\r\n        } else {\r\n            let doubleHigh = Math.floor(-z / 65536.0) * 65536.0;\r\n            high.z = Math.fround(-doubleHigh);\r\n            low.z = Math.fround(z + doubleHigh);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Separate 63 bit Vec3 to two Vec3 32-bit float values.\r\n     * @function\r\n     * @param {Vec3} v - Double type value.\r\n     * @param {Float32Array} high - Out vector high values.\r\n     * @param {Float32Array} low - Out vector low values.\r\n     * @returns {Array.<number>} Encoded array. (exactly 2 entries)\r\n     */\r\n    static doubleToTwoFloat32Array(v: Vec3, high: Float32Array | NumberArray3, low: Float32Array | NumberArray3) {\r\n        let x = v.x,\r\n            y = v.y,\r\n            z = v.z;\r\n\r\n        if (x >= 0.0) {\r\n            let doubleHigh = Math.floor(x / 65536.0) * 65536.0;\r\n            high[0] = Math.fround(doubleHigh);\r\n            low[0] = Math.fround(x - doubleHigh);\r\n        } else {\r\n            let doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\r\n            high[0] = Math.fround(-doubleHigh);\r\n            low[0] = Math.fround(x + doubleHigh);\r\n        }\r\n\r\n        if (y >= 0.0) {\r\n            let doubleHigh = Math.floor(y / 65536.0) * 65536.0;\r\n            high[1] = Math.fround(doubleHigh);\r\n            low[1] = Math.fround(y - doubleHigh);\r\n        } else {\r\n            let doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\r\n            high[1] = Math.fround(-doubleHigh);\r\n            low[1] = Math.fround(y + doubleHigh);\r\n        }\r\n\r\n        if (z >= 0.0) {\r\n            let doubleHigh = Math.floor(z / 65536.0) * 65536.0;\r\n            high[2] = Math.fround(doubleHigh);\r\n            low[2] = Math.fround(z - doubleHigh);\r\n        } else {\r\n            let doubleHigh = Math.floor(-z / 65536.0) * 65536.0;\r\n            high[2] = Math.fround(-doubleHigh);\r\n            low[2] = Math.fround(z + doubleHigh);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates 3d vector from array.\r\n     * @function\r\n     * @param {NumberArray2 | NumberArray3 | NumberArray4} arr - Input array (exactly 3 entries)\r\n     * @returns {Vec3} -\r\n     */\r\n    static fromVec(arr: NumberArray2 | NumberArray3 | NumberArray4): Vec3 {\r\n        return new Vec3(arr[0], arr[1], arr[2]);\r\n    }\r\n\r\n    /**\r\n     * Gets angle between two vectors.\r\n     * @static\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {number} -\r\n     */\r\n    static angle(a: Vec3, b: Vec3): number {\r\n        // the same\r\n        // let d = a.dot(b) / Math.sqrt(a.length2() * b.length2());\r\n        // return Math.acos(Math.max(-1, Math.min(1, d)));\r\n        let dotProduct = a.dot(b);\r\n        let crossProduct = a.cross(b).length();\r\n        return Math.atan2(crossProduct, dotProduct);\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors linear interpolation.\r\n     * @static\r\n     * @param {Vec3} v1 - Start vector.\r\n     * @param {Vec3} v2 - End vector.\r\n     * @param {number} l - Interpolate value.\r\n     * @returns {Vec3} -\r\n     */\r\n    static lerp(v1: Vec3, v2: Vec3, l: number) {\r\n        return new Vec3(v1.x + (v2.x - v1.x) * l, v1.y + (v2.y - v1.y) * l, v1.z + (v2.z - v1.z) * l);\r\n    }\r\n\r\n    /**\r\n     * Returns summary vector.\r\n     * @static\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {Vec3} - Summary vector.\r\n     */\r\n    static add(a: Vec3, b: Vec3): Vec3 {\r\n        let res = new Vec3(a.x, a.y, a.z);\r\n        res.addA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors subtraction.\r\n     * @static\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {Vec3} - Vectors subtraction.\r\n     */\r\n    static sub(a: Vec3, b: Vec3): Vec3 {\r\n        let res = new Vec3(a.x, a.y, a.z);\r\n        res.subA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns scaled vector.\r\n     * @static\r\n     * @param {Vec3} a - Input vector.\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec3} -\r\n     */\r\n    static scale(a: Vec3, scale: number): Vec3 {\r\n        return a.scaleTo(scale);\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors production.\r\n     * @static\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    static mul(a: Vec3, b: Vec3): Vec3 {\r\n        let res = new Vec3(a.x, a.y, a.z);\r\n        res.mulA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns true if two vectors are non-collinear.\r\n     * @public\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    static noncollinear(a: Vec3, b: Vec3): boolean {\r\n        return Boolean(a.y * b.z - a.z * b.y || a.z * b.x - a.x * b.z || a.x * b.y - a.y * b.z);\r\n    }\r\n\r\n    /**\r\n     * Get projection of the vector to plane where n - normal to the plane.\r\n     * @static\r\n     * @param {Vec3} b - Vector to project.\r\n     * @param {Vec3} n - Plane normal.\r\n     * @param {Vec3} [def] - Default value for non existed result.\r\n     * @returns {Vec3} -\r\n     */\r\n    static proj_b_to_plane(b: Vec3, n: Vec3, def?: Vec3): Vec3 {\r\n        let res = b.sub(n.scaleTo(n.dot(b) / n.dot(n)));\r\n        if (def && res.isZero()) {\r\n            return new Vec3(def.x, def.y, def.z);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Get projection of the first vector to the second.\r\n     * @static\r\n     * @param {Vec3} b - First vector.\r\n     * @param {Vec3} a - Second vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    static proj_b_to_a(b: Vec3, a: Vec3): Vec3 {\r\n        return a.scaleTo(a.dot(b) / a.dot(a));\r\n    }\r\n\r\n    /**\r\n     * Makes vectors normalized and orthogonal to each other.\r\n     * Normalizes normal. Normalizes tangent and makes sure it is orthogonal to normal (that is, angle between them is 90 degrees).\r\n     * @static\r\n     * @param {Vec3} normal - Normal vector.\r\n     * @param {Vec3} tangent - Tangent vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    static orthoNormalize(normal: Vec3, tangent: Vec3): Vec3 {\r\n        normal = normal.getNormal();\r\n        normal.scale(tangent.dot(normal));\r\n        return tangent.subA(normal).normalize();\r\n    }\r\n\r\n    /**\r\n     * Returns vector components division product one to another.\r\n     * @static\r\n     * @param {Vec3} a - First vector.\r\n     * @param {Vec3} b - Second vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    static div(a: Vec3, b: Vec3): Vec3 {\r\n        let res = new Vec3(a.x, a.y, a.z);\r\n        res.divA(b);\r\n        return res;\r\n    }\r\n\r\n    static length2(a: Vec3): number {\r\n        return a.length2();\r\n    }\r\n\r\n    // static length(a: Vec3): number {\r\n    //     return a.length();\r\n    // }\r\n\r\n    static dot(a: Vec3, b: Vec3): number {\r\n        return a.dot(b);\r\n    }\r\n\r\n    /**\r\n     * Converts to 4d vector, Fourth value is 1.0.\r\n     * @public\r\n     * @returns {Vec4} -\r\n     */\r\n    public toVec4(): Vec4 {\r\n        return new Vec4(this.x, this.y, this.z, 1.0);\r\n    }\r\n\r\n    /**\r\n     * Returns clone vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public clone(): Vec3 {\r\n        return new Vec3(this.x, this.y, this.z);\r\n    }\r\n\r\n    /**\r\n     * Converts vector to text string.\r\n     * @public\r\n     * @returns {string} -\r\n     */\r\n    public toString(): string {\r\n        return `(${this.x},${this.y},${this.z})`;\r\n    }\r\n\r\n    /**\r\n     * Returns true if vector's values are zero.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public isZero(): boolean {\r\n        return !(this.x || this.y || this.z);\r\n    }\r\n\r\n    /**\r\n     * Get projection of the first vector to the second.\r\n     * @static\r\n     * @param {Vec3} a - Project vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public projToVec(a: Vec3): Vec3 {\r\n        return a.scaleTo(a.dot(this) / a.dot(a));\r\n    }\r\n\r\n    /**\r\n     * Compares with vector. Returns true if it equals another.\r\n     * @public\r\n     * @param {Vec3} p - Vector to compare.\r\n     * @returns {boolean} -\r\n     */\r\n    public equal(p: Vec3): boolean {\r\n        return this.x === p.x && this.y === p.y && this.z === p.z;\r\n    }\r\n\r\n    /**\r\n     * Copy input vector's values.\r\n     * @param {Vec3} p - Vector to copy.\r\n     * @returns {Vec3} -\r\n     */\r\n    public copy(p: Vec3): Vec3 {\r\n        this.x = p.x;\r\n        this.y = p.y;\r\n        this.z = p.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets vector's length.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public length(): number {\r\n        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n    }\r\n\r\n    /**\r\n     * Returns squared vector's length.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public length2(): number {\r\n        return this.x * this.x + this.y * this.y + this.z * this.z;\r\n    }\r\n\r\n    /**\r\n     * Converts vector's values to a quaternion object.\r\n     * @public\r\n     * @returns {Quat} -\r\n     */\r\n    public getQuat(): Quat {\r\n        return new Quat(this.x, this.y, this.z);\r\n    }\r\n\r\n    /**\r\n     * Adds vector to the current.\r\n     * @public\r\n     * @param {Vec3} p - Point to add.\r\n     * @returns {Vec3} -\r\n     */\r\n    public addA(p: Vec3): Vec3 {\r\n        this.x += p.x;\r\n        this.y += p.y;\r\n        this.z += p.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets two vectors summarization.\r\n     * @public\r\n     * @param {Vec3} p - Vector to add.\r\n     * @returns {Vec3} Returns a sum vector.\r\n     */\r\n    public add(p: Vec3): Vec3 {\r\n        return new Vec3(this.x + p.x, this.y + p.y, this.z + p.z);\r\n    }\r\n\r\n    /**\r\n     * Gets two vectors summarization.\r\n     * @public\r\n     * @param {Vec3} p - Vector to add.\r\n     * @returns {Vec3} Returns a sum vector.\r\n     */\r\n    public addRes(p: Vec3, res: Vec3): Vec3 {\r\n        return res.set(this.x + p.x, this.y + p.y, this.z + p.z);\r\n    }\r\n\r\n    /**\r\n     * Subtract vector from the current.\r\n     * @public\r\n     * @param {Vec3} p - Subtract vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public subA(p: Vec3): Vec3 {\r\n        this.x -= p.x;\r\n        this.y -= p.y;\r\n        this.z -= p.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets vector subtraction.\r\n     * @public\r\n     * @param {Vec3} p - Subtract vector.\r\n     * @return {Vec3} Returns new instance of a subtraction\r\n     */\r\n    public sub(p: Vec3): Vec3 {\r\n        return new Vec3(this.x - p.x, this.y - p.y, this.z - p.z);\r\n    }\r\n\r\n    /**\r\n     * Scale current vector.\r\n     * @public\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec3} -\r\n     */\r\n    public scale(scale: number): Vec3 {\r\n        this.x *= scale;\r\n        this.y *= scale;\r\n        this.z *= scale;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Scale current vector to another instance.\r\n     * @public\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec3} -\r\n     */\r\n    public scaleTo(scale: number): Vec3 {\r\n        return new Vec3(this.x * scale, this.y * scale, this.z * scale);\r\n    }\r\n\r\n    /**\r\n     * Multiply current vector object to another and store result in the current instance.\r\n     * @public\r\n     * @param {Vec3} vec - Multiply vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public mulA(vec: Vec3): Vec3 {\r\n        this.x *= vec.x;\r\n        this.y *= vec.y;\r\n        this.z *= vec.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Multiply current vector object to another and returns new vector instance.\r\n     * @public\r\n     * @param {Vec3} vec - Multiply vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public mul(vec: Vec3): Vec3 {\r\n        return new Vec3(this.x * vec.x, this.y * vec.y, this.z * vec.z);\r\n    }\r\n\r\n    /**\r\n     * Multiply current vector object to another and returns new vector instance.\r\n     * @public\r\n     * @param {Vec3} vec - Multiply vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public mulRes(vec: Vec3, res: Vec3): Vec3 {\r\n        return res.set(this.x * vec.x, this.y * vec.y, this.z * vec.z);\r\n    }\r\n\r\n    /**\r\n     * Divide current vector's components to another. Results stores in the current vector object.\r\n     * @public\r\n     * @param {Vec3} vec - Div vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public divA(vec: Vec3): Vec3 {\r\n        this.x /= vec.x;\r\n        this.y /= vec.y;\r\n        this.z /= vec.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Divide current vector's components to another and returns new vector instance.\r\n     * @public\r\n     * @param {Vec3} vec - Div vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public div(vec: Vec3): Vec3 {\r\n        return new Vec3(this.x / vec.x, this.y / vec.y, this.z / vec.z);\r\n    }\r\n\r\n    /**\r\n     * Gets vectors dot production.\r\n     * @public\r\n     * @param {Vec3} a - Another vector.\r\n     * @returns {number} -\r\n     */\r\n    public dot(a: Vec3): number {\r\n        return a.x * this.x + a.y * this.y + a.z * this.z;\r\n    }\r\n\r\n    /**\r\n     * Gets vectors dot production.\r\n     * @public\r\n     * @param {Array.<number>} arr - Array vector. (exactly 3 entries)\r\n     * @returns {number} -\r\n     */\r\n    public dotArr(arr: NumberArray3 | NumberArray4): number {\r\n        return arr[0] * this.x + arr[1] * this.y + arr[2] * this.z;\r\n    }\r\n\r\n    /**\r\n     * Gets vectors cross production.\r\n     * @public\r\n     * @param {Vec3} point3 - Another vector.\r\n     * @returns {Vec3} -\r\n     */\r\n    public cross(point3: Vec3): Vec3 {\r\n        return new Vec3(\r\n            this.y * point3.z - this.z * point3.y,\r\n            this.z * point3.x - this.x * point3.z,\r\n            this.x * point3.y - this.y * point3.x\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Sets vector to zero.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public clear(): Vec3 {\r\n        this.x = this.y = this.z = 0;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns normalized vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public getNormal(): Vec3 {\r\n        let res = new Vec3();\r\n        res.copy(this);\r\n\r\n        let length = 1.0 / res.length();\r\n\r\n        res.x *= length;\r\n        res.y *= length;\r\n        res.z *= length;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns normalized vector.\r\n     * @deprecated\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public normal(): Vec3 {\r\n        let res = new Vec3();\r\n        res.copy(this);\r\n\r\n        let length = 1.0 / res.length();\r\n\r\n        res.x *= length;\r\n        res.y *= length;\r\n        res.z *= length;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns normalized negate vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public normalNegate(): Vec3 {\r\n        let res = new Vec3();\r\n        res.copy(this);\r\n\r\n        let length = -1.0 / res.length();\r\n\r\n        res.x *= length;\r\n        res.y *= length;\r\n        res.z *= length;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns normalized negate scale vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public normalNegateScale(scale: number): Vec3 {\r\n        let res = new Vec3();\r\n        res.copy(this);\r\n\r\n        let length = -scale / res.length();\r\n\r\n        res.x *= length;\r\n        res.y *= length;\r\n        res.z *= length;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns normalized scale vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public normalScale(scale: number): Vec3 {\r\n        let res = new Vec3();\r\n        res.copy(this);\r\n\r\n        let length = scale / res.length();\r\n\r\n        res.x *= length;\r\n        res.y *= length;\r\n        res.z *= length;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Normalize current vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public normalize(): Vec3 {\r\n        let length = 1.0 / this.length();\r\n        this.x *= length;\r\n        this.y *= length;\r\n        this.z *= length;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Converts vector to a number array.\r\n     * @public\r\n     * @returns {Array.<number>} - (exactly 3 entries)\r\n     * @deprecated\r\n     */\r\n    public toVec(): NumberArray3 {\r\n        return [this.x, this.y, this.z];\r\n    }\r\n\r\n    /**\r\n     * Converts vector to a number array.\r\n     * @public\r\n     * @returns {Array.<number>} - (exactly 3 entries)\r\n     */\r\n    public toArray(): NumberArray3 {\r\n        return [this.x, this.y, this.z];\r\n    }\r\n\r\n    /**\r\n     * Gets distance to point.\r\n     * @public\r\n     * @param {Vec3} p - Distant point.\r\n     * @returns {number} -\r\n     */\r\n    public distance(p: Vec3): number {\r\n        let dx = this.x - p.x,\r\n            dy = this.y - p.y,\r\n            dz = this.z - p.z;\r\n        return Math.sqrt(dx * dx + dy * dy + dz * dz);\r\n    }\r\n\r\n    /**\r\n     * Gets square distance to point.\r\n     * @public\r\n     * @param {Vec3} p - Distant point.\r\n     * @returns {number} -\r\n     */\r\n    public distance2(p: Vec3): number {\r\n        let dx = this.x - p.x,\r\n            dy = this.y - p.y,\r\n            dz = this.z - p.z;\r\n        return dx * dx + dy * dy + dz * dz;\r\n    }\r\n\r\n    /**\r\n     * Sets vector's values.\r\n     * @public\r\n     * @param {number} x - Value X.\r\n     * @param {number} y - Value Y.\r\n     * @param {number} z - Value Z.\r\n     * @returns {Vec3} -\r\n     */\r\n    public set(x: number, y: number, z: number): Vec3 {\r\n        this.x = x;\r\n        this.y = y;\r\n        this.z = z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Negate current vector.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public negate(): Vec3 {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        this.z = -this.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Negate current vector to another instance.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public negateTo(): Vec3 {\r\n        return new Vec3(-this.x, -this.y, -this.z);\r\n    }\r\n\r\n    /**\r\n     * Gets projected point coordinates of the current vector on the ray.\r\n     * @public\r\n     * @param {Vec3} pos - Ray position.\r\n     * @param {Vec3} direction - Ray direction.\r\n     * @returns {Vec3} -\r\n     */\r\n    public projToRay(pos: Vec3, direction: Vec3): Vec3 {\r\n        let v = Vec3.proj_b_to_a(Vec3.sub(this, pos), direction);\r\n        v.addA(pos);\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * Gets angle between two vectors.\r\n     * @public\r\n     * @param {Vec3} a - Another vector.\r\n     * @returns {number} -\r\n     */\r\n    public angle(a: Vec3): number {\r\n        return Vec3.angle(this, a);\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors linear interpolation.\r\n     * @public\r\n     * @param {Vec3} v2 - End vector.\r\n     * @param {number} l - Interpolate value.\r\n     * @returns {Vec3} -\r\n     */\r\n    public lerp(v2: Vec3, l: number) {\r\n        return new Vec3(\r\n            this.x + (v2.x - this.x) * l,\r\n            this.y + (v2.y - this.y) * l,\r\n            this.z + (v2.z - this.z) * l\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns vector interpolation by v(t) = v1 * t + v2 * (1 - t)\r\n     * @public\r\n     * @param {Vec3} v2 - End vector.\r\n     * @param {number} t - Interpolate value.\r\n     * @returns {Vec3} -\r\n     */\r\n    public smerp(v2: Vec3, t: number): Vec3 {\r\n        let one_d = 1 - t;\r\n        return new Vec3(\r\n            this.x * t + v2.x * one_d,\r\n            this.y * t + v2.y * one_d,\r\n            this.z * t + v2.z * one_d\r\n        );\r\n    }\r\n\r\n    static get LERP_DELTA(): number {\r\n        return 1e-6;\r\n    }\r\n\r\n    /**\r\n     * Spherically interpolates between two vectors.\r\n     * Interpolates between current and v2 vector by amount t. The difference between this and linear interpolation (aka, \"lerp\") is that\r\n     * the vectors are treated as directions rather than points in space. The direction of the returned vector is interpolated\r\n     * by the angle and its magnitude is interpolated between the magnitudes of from and to.\r\n     * @public\r\n     * @param {Vec3} v2 -\r\n     * @param {number} t - The parameter t is clamped to the range [0, 1].\r\n     * @returns {Vec3} -\r\n     */\r\n    public slerp(v2: Vec3, t: number): Vec3 {\r\n        let res = new Vec3();\r\n\r\n        if (t <= 0.0) {\r\n            res.copy(this);\r\n            return res;\r\n        } else if (t >= 1.0) {\r\n            res.copy(v2);\r\n            return res;\r\n        }\r\n\r\n        let omega, sinom, scale0, scale1;\r\n        let cosom = this.dot(v2);\r\n\r\n        if (1.0 - cosom > Vec3.LERP_DELTA) {\r\n            omega = Math.acos(cosom);\r\n            sinom = Math.sin(omega);\r\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\r\n            scale1 = Math.sin(t * omega) / sinom;\r\n        } else {\r\n            scale0 = 1.0 - t;\r\n            scale1 = t;\r\n        }\r\n\r\n        return Vec3.add(this.scaleTo(scale0), v2.scale(scale1));\r\n    }\r\n\r\n    public mulVecA(a: Vec3): Vec3 {\r\n        this.x *= a.x;\r\n        this.y *= a.y;\r\n        this.z *= a.z;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets the shortest arc quaternion to rotate this vector to the destination vector.\r\n     * @param {Vec3} dest -\r\n     * @param {Vec3} fallbackAxis -\r\n     * @returns {Quat} -\r\n     * @todo: TEST IT!\r\n     */\r\n    public getRotationTo(dest: Vec3, fallbackAxis: Vec3): Quat {\r\n        // Based on Stan Melax's article in Game Programming Gems\r\n        // Copy, since cannot modify local\r\n        let v0 = this.clone();\r\n        let v1 = dest.clone();\r\n        v0.normalize();\r\n        v1.normalize();\r\n\r\n        let d = v0.dot(v1);\r\n        // If dot == 1, vectors are the same\r\n        if (d >= 1.0) {\r\n            return Quat.IDENTITY.clone();\r\n        }\r\n\r\n        if (d < 1e-6 - 1.0) {\r\n            if (!fallbackAxis.equal(Vec3.ZERO)) {\r\n                // rotate 180 degrees about the fallback axis\r\n                return Quat.axisAngleToQuat(fallbackAxis, Math.PI);\r\n            } else {\r\n                // Generate an axis\r\n                let axis = Vec3.UNIT_X.cross(v0);\r\n                if (axis.isZero()) {\r\n                    // pick another if colinear\r\n                    axis = Vec3.UNIT_Y.cross(v0);\r\n                }\r\n                axis.normalize();\r\n                return Quat.axisAngleToQuat(axis, Math.PI);\r\n            }\r\n        } else {\r\n            let s = Math.sqrt((1 + d) * 2);\r\n            let invs = 1.0 / s;\r\n            let c = v0.cross(v1);\r\n            let q = new Quat(c.x * invs, c.y * invs, c.z * invs, s * 0.5);\r\n            q.normalize();\r\n            return q;\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Vector 3d object creator.\r\n * @function\r\n * @param {number} [x] - value X.\r\n * @param {number} [y] - value Y.\r\n * @param {number} [z] - value Z.\r\n * @returns {Vec3} -\r\n */\r\nexport function vec3(x: number = 0, y: number = 0, z: number = 0): Vec3 {\r\n    return new Vec3(x, y, z);\r\n}\r\n","import {Vec3} from \"./Vec3\";\r\n\r\nexport type NumberArray2 = [number, number];\r\n\r\n/**\r\n * Class represents a 3d vector.\r\n * @class\r\n * @param {number} [x] - First value.\r\n * @param {number} [y] - Second value.\r\n */\r\nexport class Vec2 {\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public x: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public y: number;\r\n\r\n    constructor(x: number = 0.0, y: number = 0.0) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n\r\n    /** @const */\r\n    static get UP(): Vec2 {\r\n        return new Vec2(0, 1);\r\n    }\r\n\r\n    /** @const */\r\n    static get DOWN(): Vec2 {\r\n        return new Vec2(0, -1);\r\n    }\r\n\r\n    /** @const */\r\n    static get RIGHT(): Vec2 {\r\n        return new Vec2(1, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get LEFT(): Vec2 {\r\n        return new Vec2(-1, 0);\r\n    }\r\n\r\n    /** @const */\r\n    static get ZERO(): Vec2 {\r\n        return new Vec2();\r\n    }\r\n\r\n    /**\r\n     * Returns summary vector.\r\n     * @static\r\n     * @param {Vec2} a - First vector.\r\n     * @param {Vec2} b - Second vector.\r\n     * @returns {Vec2} - Summary vector.\r\n     */\r\n    static add(a: Vec2, b: Vec2): Vec2 {\r\n        const res = new Vec2(a.x, a.y);\r\n        res.addA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors subtraction.\r\n     * @static\r\n     * @param {Vec2} a - First vector.\r\n     * @param {Vec2} b - Second vector.\r\n     * @returns {Vec2} - Vectors subtraction.\r\n     */\r\n    static sub(a: Vec2, b: Vec2): Vec2 {\r\n        var res = new Vec2(a.x, a.y);\r\n        res.subA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns scaled vector.\r\n     * @static\r\n     * @param {Vec2} a - Input vector.\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec2}\r\n     */\r\n    static scale(a: Vec2, scale: number): Vec2 {\r\n        let res = new Vec2(a.x, a.y);\r\n        res.scale(scale);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors production.\r\n     * @static\r\n     * @param {Vec2} a - First vector.\r\n     * @param {Vec2} b - Second vector.\r\n     * @returns {Vec2}\r\n     */\r\n    static mul(a: Vec2, b: Vec2): Vec2 {\r\n        let res = new Vec2(a.x, a.y);\r\n        res.mulA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Returns vector components division product one to another.\r\n     * @static\r\n     * @param {Vec2} a - First vector.\r\n     * @param {Vec2} b - Second vector.\r\n     * @returns {Vec2}\r\n     */\r\n    static div(a: Vec2, b: Vec2): Vec2 {\r\n        let res = new Vec2(a.x, a.y);\r\n        res.divA(b);\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Get projection of the first vector to the second.\r\n     * @static\r\n     * @param {Vec2} b - First vector.\r\n     * @param {Vec2} a - Second vector.\r\n     * @returns {Vec2}\r\n     */\r\n    static proj_b_to_a(b: Vec2, a: Vec2): Vec2 {\r\n        return a.scaleTo(a.dot(b) / a.dot(a));\r\n    }\r\n\r\n    /**\r\n     * Gets angle between two vectors.\r\n     * @static\r\n     * @param {Vec2} a - First vector.\r\n     * @param {Vec2} b - Second vector.\r\n     * @returns {number}\r\n     */\r\n    static angle(a: Vec2, b: Vec2): number {\r\n        return Math.acos(a.dot(b) / Math.sqrt(a.length2() * b.length2()));\r\n    }\r\n\r\n    /**\r\n     * Makes vectors normalized and orthogonal to each other.\r\n     * @static\r\n     * @param {Vec2} normal - Normal vector.\r\n     * @param {Vec2} tangent - Tangent vector.\r\n     * @returns {Vec2}\r\n     */\r\n    static orthoNormalize(normal: Vec2, tangent: Vec2): Vec2 {\r\n        normal = normal.normal();\r\n        normal.scale(tangent.dot(normal));\r\n        return tangent.sub(normal).normalize();\r\n    }\r\n\r\n    /**\r\n     * Get projection of the vector to plane where n - normal to the plane.\r\n     * @static\r\n     * @param {Vec2} b - Vector to project.\r\n     * @param {Vec2} n - Plane normal.\r\n     * @param {Vec2} [def] - Default value for non existed result.\r\n     * @returns {Vec2} -\r\n     */\r\n    static proj_b_to_plane(b: Vec2, n: Vec2, def?: Vec3): Vec2 {\r\n        let res = b.sub(n.scaleTo(n.dot(b) / n.dot(n)));\r\n        if (def && res.isZero()) {\r\n            return new Vec2(def.x, def.y);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Converts to 3d vector, third value is 0.0.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public toVector3(): Vec3 {\r\n        return new Vec3(this.x, this.y, 0);\r\n    }\r\n\r\n    /**\r\n     * Returns clone vector.\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public clone(): Vec2 {\r\n        return new Vec2(this.x, this.y);\r\n    }\r\n\r\n    /**\r\n     * Compares with vector. Returns true if it equals another.\r\n     * @public\r\n     * @param {Vec2} p - Vector to compare.\r\n     * @returns {boolean}\r\n     */\r\n    public equal(p: Vec2): boolean {\r\n        return this.x === p.x && this.y === p.y;\r\n    }\r\n\r\n    /**\r\n     * Copy input vector's values.\r\n     * @param {Vec2} point2 - Vector to copy.\r\n     * @returns {Vec2}\r\n     */\r\n    public copy(point2: Vec2): Vec2 {\r\n        this.x = point2.x;\r\n        this.y = point2.y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets vector's length.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public length(): number {\r\n        return Math.sqrt(this.x * this.x + this.y * this.y);\r\n    }\r\n\r\n    /**\r\n     * Returns squared vector's length.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public length2(): number {\r\n        return this.x * this.x + this.y * this.y;\r\n    }\r\n\r\n    /**\r\n     * Adds vector to the current.\r\n     * @public\r\n     * @param {Vec2}\r\n     * @returns {Vec2}\r\n     */\r\n    public addA(v: Vec2): Vec2 {\r\n        this.x += v.x;\r\n        this.y += v.y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Summarize two vectors.\r\n     * @public\r\n     * @param {Vec2}\r\n     * @returns {Vec2}\r\n     */\r\n    public add(v: Vec2): Vec2 {\r\n        return new Vec2(this.x + v.x, this.y + v.y);\r\n    }\r\n\r\n    /**\r\n     * Subtract vector from the current where results saved on the current instance.\r\n     * @public\r\n     * @param {Vec2} v - Subtract vector.\r\n     * @returns {Vec2}\r\n     */\r\n    public subA(v: Vec2): Vec2 {\r\n        this.x -= v.x;\r\n        this.y -= v.y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract vector from the current.\r\n     * @public\r\n     * @param {Vec2} v - Subtract vector.\r\n     * @returns {Vec2}\r\n     */\r\n    public sub(v: Vec2): Vec2 {\r\n        return new Vec2(this.x - v.x, this.y - v.y);\r\n    }\r\n\r\n    /**\r\n     * Scale current vector.\r\n     * @public\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec2}\r\n     */\r\n    public scale(scale: number): Vec2 {\r\n        this.x *= scale;\r\n        this.y *= scale;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Scale current vector to another instance.\r\n     * @public\r\n     * @param {number} scale - Scale value.\r\n     * @returns {Vec2}\r\n     */\r\n    public scaleTo(scale: number): Vec2 {\r\n        return new Vec2(this.x * scale, this.y * scale);\r\n    }\r\n\r\n    /**\r\n     * Multiply current vector object to another and store result in the current instance.\r\n     * @public\r\n     * @param {Vec2} vec - Multiply vector.\r\n     * @returns {Vec2}\r\n     */\r\n    public mulA(vec: Vec2): Vec2 {\r\n        this.x *= vec.x;\r\n        this.y *= vec.y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Multiply current vector object to another and returns new vector instance.\r\n     * @public\r\n     * @param {Vec2} vec - Multiply vector.\r\n     * @returns {Vec2}\r\n     */\r\n    public mul(vec: Vec2): Vec2 {\r\n        return new Vec2(this.x * vec.x, this.y * vec.y);\r\n    }\r\n\r\n    /**\r\n     * Divide current vector's components to another. Results stores in the current vector object.\r\n     * @public\r\n     * @param {Vec2}\r\n     * @returns {Vec2}\r\n     */\r\n    public divA(vec: Vec2): Vec2 {\r\n        this.x /= vec.x;\r\n        this.y /= vec.y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Gets vectors dot production.\r\n     * @public\r\n     * @param {Vec2} v - Another vector.\r\n     * @returns {number}\r\n     */\r\n    public dot(v: Vec2): number {\r\n        return v.x * this.x + v.y * this.y;\r\n    }\r\n\r\n    /**\r\n     * Gets vectors dot production.\r\n     * @public\r\n     * @param {Array.<number>} arr - Array vector. (exactly 2 entries)\r\n     * @returns {number}\r\n     */\r\n    public dotArr(arr: NumberArray2): number {\r\n        return arr[0] * this.x + arr[1] * this.y;\r\n    }\r\n\r\n    /**\r\n     * Gets vectors cross production.\r\n     * @public\r\n     * @param {Vec2} v - Another vector.\r\n     * @returns {number}\r\n     */\r\n    public cross(v: Vec2): number {\r\n        return this.x * v.y - this.y * v.x;\r\n    }\r\n\r\n    /**\r\n     * Sets vector to zero.\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public clear(): Vec2 {\r\n        this.x = this.y = 0;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns normalized vector.\r\n     * @deprecated\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public normal(): Vec2 {\r\n        return this.getNormal();\r\n    }\r\n\r\n    /**\r\n     * Returns normalized vector.\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public getNormal(): Vec2 {\r\n        let res = new Vec2();\r\n        res.copy(this);\r\n\r\n        let length = 1.0 / res.length();\r\n\r\n        res.x *= length;\r\n        res.y *= length;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Normalize current vector.\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public normalize(): Vec2 {\r\n        let length = 1.0 / this.length();\r\n\r\n        this.x *= length;\r\n        this.y *= length;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Converts vector to a number array.\r\n     * @public\r\n     * @returns {Array.<number>} - (exactly 2 entries)\r\n     */\r\n    public toVec(): NumberArray2 {\r\n        return [this.x, this.y];\r\n    }\r\n\r\n    /**\r\n     * Gets distance to point.\r\n     * @public\r\n     * @param {Vec2} p - Distant point.\r\n     * @returns {number}\r\n     */\r\n    public distance(p: Vec2): number {\r\n        let vec = Vec2.sub(this, p);\r\n        return vec.length();\r\n    }\r\n\r\n    /**\r\n     * Sets vector's values.\r\n     * @public\r\n     * @param {number} x - Value X.\r\n     * @param {number} y - Value Y.\r\n     * @returns {Vec2}\r\n     */\r\n    public set(x: number, y: number): Vec2 {\r\n        this.x = x;\r\n        this.y = y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Negate current vector.\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public negate(): Vec2 {\r\n        this.x = -this.x;\r\n        this.y = -this.y;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Negate current vector to another instance.\r\n     * @public\r\n     * @returns {Vec2}\r\n     */\r\n    public negateTo(): Vec2 {\r\n        return new Vec2(-this.x, -this.y);\r\n    }\r\n\r\n    /**\r\n     * Gets projected point coordinates of the current vector on the ray.\r\n     * @public\r\n     * @param {Vec2} pos - Ray position.\r\n     * @param {Vec2} direction - Ray direction.\r\n     * @returns {Vec2}\r\n     */\r\n    public projToRay(pos: Vec2, direction: Vec2): Vec2 {\r\n        let v = Vec2.proj_b_to_a(Vec2.sub(this, pos), direction);\r\n        v.add(pos);\r\n        return v;\r\n    }\r\n\r\n    /**\r\n     * Gets angle between two vectors.\r\n     * @public\r\n     * @param {Vec2} a - Another vector.\r\n     * @returns {number}\r\n     */\r\n    public angle(a: Vec2): number {\r\n        return Vec2.angle(this, a);\r\n    }\r\n\r\n    /**\r\n     * Returns two vectors linear interpolation.\r\n     * @public\r\n     * @param {Vec2} v2 - End vector.\r\n     * @param {number} l - Interpolate value.\r\n     * @returns {Vec2}\r\n     */\r\n    public lerp(v1: Vec2, v2: Vec2, l: number): Vec2 {\r\n        let res = this.clone();\r\n        if (l <= 0.0) {\r\n            res.copy(v1);\r\n        } else if (l >= 1.0) {\r\n            res.copy(v2);\r\n        } else {\r\n            res = Vec2.add(v1, Vec2.sub(v2, v1).scale(l));\r\n        }\r\n        return res;\r\n    }\r\n\r\n    static get LERP_DELTA(): number {\r\n        return 1e-6;\r\n    }\r\n\r\n    /**\r\n     * Spherically interpolates between two vectors.\r\n     * Interpolates between current and v2 vector by amount t. The difference between this and linear interpolation (aka, \"lerp\") is that\r\n     * the vectors are treated as directions rather than points in space. The direction of the returned vector is interpolated\r\n     * by the angle and its magnitude is interpolated between the magnitudes of from and to.\r\n     * @public\r\n     * @param {Vec2} v2\r\n     * @param {number} t - The parameter t is clamped to the range [0, 1].\r\n     * @returns {Vec2}\r\n     */\r\n    public slerp(v2: Vec2, t: number): Vec2 {\r\n        let res = new Vec2();\r\n\r\n        if (t <= 0.0) {\r\n            res.copy(this);\r\n            return res;\r\n        } else if (t >= 1.0) {\r\n            res.copy(v2);\r\n            return res;\r\n        }\r\n\r\n        let omega, sinom, scale0, scale1;\r\n        let cosom = this.dot(v2);\r\n\r\n        if (1.0 - cosom > Vec2.LERP_DELTA) {\r\n            omega = Math.acos(cosom);\r\n            sinom = Math.sin(omega);\r\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\r\n            scale1 = Math.sin(t * omega) / sinom;\r\n        } else {\r\n            scale0 = 1.0 - t;\r\n            scale1 = t;\r\n        }\r\n\r\n        return Vec2.add(this.scale(scale0), v2.scale(scale1));\r\n    }\r\n\r\n    /**\r\n     * Returns true if vector's values are zero.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public isZero(): boolean {\r\n        return !(this.x || this.y);\r\n    }\r\n}\r\n\r\n/**\r\n * Vector 2d object creator.\r\n * @function\r\n * @param {number} [x] - First cvalue.\r\n * @param {number} [y] - Second value.\r\n * @returns {Vec2}\r\n */\r\nexport function vec2(x: number = 0, y: number = 0): Vec2 {\r\n    return new Vec2(x, y);\r\n}\r\n","export const colorTable: { [id: string]: string } = {\r\n    \"aliceblue\": \"#f0f8ff\",\r\n    \"antiquewhite\": \"#faebd7\",\r\n    \"aqua\": \"#00ffff\",\r\n    \"aquamarine\": \"#7fffd4\",\r\n    \"azure\": \"#f0ffff\",\r\n    \"beige\": \"#f5f5dc\",\r\n    \"bisque\": \"#ffe4c4\",\r\n    \"black\": \"#000000\",\r\n    \"blanchedalmond\": \"#ffebcd\",\r\n    \"blue\": \"#0000ff\",\r\n    \"blueviolet\": \"#8a2be2\",\r\n    \"brown\": \"#a52a2a\",\r\n    \"burlywood\": \"#deb887\",\r\n    \"cadetblue\": \"#5f9ea0\",\r\n    \"chartreuse\": \"#7fff00\",\r\n    \"chocolate\": \"#d2691e\",\r\n    \"coral\": \"#ff7f50\",\r\n    \"cornflowerblue\": \"#6495ed\",\r\n    \"cornsilk\": \"#fff8dc\",\r\n    \"crimson\": \"#dc143c\",\r\n    \"cyan\": \"#00ffff\",\r\n    \"darkblue\": \"#00008b\",\r\n    \"darkcyan\": \"#008b8b\",\r\n    \"darkgoldenrod\": \"#b8860b\",\r\n    \"darkgray\": \"#a9a9a9\",\r\n    \"darkgreen\": \"#006400\",\r\n    \"darkkhaki\": \"#bdb76b\",\r\n    \"darkmagenta\": \"#8b008b\",\r\n    \"darkolivegreen\": \"#556b2f\",\r\n    \"darkorange\": \"#ff8c00\",\r\n    \"darkorchid\": \"#9932cc\",\r\n    \"darkred\": \"#8b0000\",\r\n    \"darksalmon\": \"#e9967a\",\r\n    \"darkseagreen\": \"#8fbc8f\",\r\n    \"darkslateblue\": \"#483d8b\",\r\n    \"darkslategray\": \"#2f4f4f\",\r\n    \"darkturquoise\": \"#00ced1\",\r\n    \"darkviolet\": \"#9400d3\",\r\n    \"deeppink\": \"#ff1493\",\r\n    \"deepskyblue\": \"#00bfff\",\r\n    \"dimgray\": \"#696969\",\r\n    \"dodgerblue\": \"#1e90ff\",\r\n    \"firebrick\": \"#b22222\",\r\n    \"floralwhite\": \"#fffaf0\",\r\n    \"forestgreen\": \"#228b22\",\r\n    \"fuchsia\": \"#ff00ff\",\r\n    \"gainsboro\": \"#dcdcdc\",\r\n    \"ghostwhite\": \"#f8f8ff\",\r\n    \"gold\": \"#ffd700\",\r\n    \"goldenrod\": \"#daa520\",\r\n    \"gray\": \"#808080\",\r\n    \"green\": \"#008000\",\r\n    \"greenyellow\": \"#adff2f\",\r\n    \"honeydew\": \"#f0fff0\",\r\n    \"hotpink\": \"#ff69b4\",\r\n    \"indianred \": \"#cd5c5c\",\r\n    \"indigo\": \"#4b0082\",\r\n    \"ivory\": \"#fffff0\",\r\n    \"khaki\": \"#f0e68c\",\r\n    \"lavender\": \"#e6e6fa\",\r\n    \"lavenderblush\": \"#fff0f5\",\r\n    \"lawngreen\": \"#7cfc00\",\r\n    \"lemonchiffon\": \"#fffacd\",\r\n    \"lightblue\": \"#add8e6\",\r\n    \"lightcoral\": \"#f08080\",\r\n    \"lightcyan\": \"#e0ffff\",\r\n    \"lightgoldenrodyellow\": \"#fafad2\",\r\n    \"lightgrey\": \"#d3d3d3\",\r\n    \"lightgreen\": \"#90ee90\",\r\n    \"lightpink\": \"#ffb6c1\",\r\n    \"lightsalmon\": \"#ffa07a\",\r\n    \"lightseagreen\": \"#20b2aa\",\r\n    \"lightskyblue\": \"#87cefa\",\r\n    \"lightslategray\": \"#778899\",\r\n    \"lightsteelblue\": \"#b0c4de\",\r\n    \"lightyellow\": \"#ffffe0\",\r\n    \"lime\": \"#00ff00\",\r\n    \"limegreen\": \"#32cd32\",\r\n    \"linen\": \"#faf0e6\",\r\n    \"magenta\": \"#ff00ff\",\r\n    \"maroon\": \"#800000\",\r\n    \"mediumaquamarine\": \"#66cdaa\",\r\n    \"mediumblue\": \"#0000cd\",\r\n    \"mediumorchid\": \"#ba55d3\",\r\n    \"mediumpurple\": \"#9370d8\",\r\n    \"mediumseagreen\": \"#3cb371\",\r\n    \"mediumslateblue\": \"#7b68ee\",\r\n    \"mediumspringgreen\": \"#00fa9a\",\r\n    \"mediumturquoise\": \"#48d1cc\",\r\n    \"mediumvioletred\": \"#c71585\",\r\n    \"midnightblue\": \"#191970\",\r\n    \"mintcream\": \"#f5fffa\",\r\n    \"mistyrose\": \"#ffe4e1\",\r\n    \"moccasin\": \"#ffe4b5\",\r\n    \"navajowhite\": \"#ffdead\",\r\n    \"navy\": \"#000080\",\r\n    \"oldlace\": \"#fdf5e6\",\r\n    \"olive\": \"#808000\",\r\n    \"olivedrab\": \"#6b8e23\",\r\n    \"orange\": \"#ffa500\",\r\n    \"orangered\": \"#ff4500\",\r\n    \"orchid\": \"#da70d6\",\r\n    \"palegoldenrod\": \"#eee8aa\",\r\n    \"palegreen\": \"#98fb98\",\r\n    \"paleturquoise\": \"#afeeee\",\r\n    \"palevioletred\": \"#d87093\",\r\n    \"papayawhip\": \"#ffefd5\",\r\n    \"peachpuff\": \"#ffdab9\",\r\n    \"peru\": \"#cd853f\",\r\n    \"pink\": \"#ffc0cb\",\r\n    \"plum\": \"#dda0dd\",\r\n    \"powderblue\": \"#b0e0e6\",\r\n    \"purple\": \"#800080\",\r\n    \"rebeccapurple\": \"#663399\",\r\n    \"red\": \"#ff0000\",\r\n    \"rosybrown\": \"#bc8f8f\",\r\n    \"royalblue\": \"#4169e1\",\r\n    \"saddlebrown\": \"#8b4513\",\r\n    \"salmon\": \"#fa8072\",\r\n    \"sandybrown\": \"#f4a460\",\r\n    \"seagreen\": \"#2e8b57\",\r\n    \"seashell\": \"#fff5ee\",\r\n    \"sienna\": \"#a0522d\",\r\n    \"silver\": \"#c0c0c0\",\r\n    \"skyblue\": \"#87ceeb\",\r\n    \"slateblue\": \"#6a5acd\",\r\n    \"slategray\": \"#708090\",\r\n    \"snow\": \"#fffafa\",\r\n    \"springgreen\": \"#00ff7f\",\r\n    \"steelblue\": \"#4682b4\",\r\n    \"tan\": \"#d2b48c\",\r\n    \"teal\": \"#008080\",\r\n    \"thistle\": \"#d8bfd8\",\r\n    \"tomato\": \"#ff6347\",\r\n    \"turquoise\": \"#40e0d0\",\r\n    \"violet\": \"#ee82ee\",\r\n    \"wheat\": \"#f5deb3\",\r\n    \"white\": \"#ffffff\",\r\n    \"whitesmoke\": \"#f5f5f5\",\r\n    \"yellow\": \"#ffff00\",\r\n    \"yellowgreen\": \"#9acd32\"\r\n};","import {LonLat} from \"../LonLat\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {DEGREES, EPS1, EPS12, EPS15, RADIANS, zeroTwoPI} from \"../math\";\r\n\r\nexport interface IInverseResult {\r\n    distance: number;\r\n    initialAzimuth: number;\r\n    finalAzimuth: number;\r\n}\r\n\r\nexport interface IDirectResult {\r\n    destination: LonLat;\r\n    finalAzimuth: number;\r\n}\r\n\r\n/**\r\n * Class represents a plant ellipsoid.\r\n * @class\r\n * @param {number} equatorialSize - Equatorial ellipsoid size.\r\n * @param {number} polarSize - Polar ellipsoid size.\r\n */\r\nclass Ellipsoid {\r\n\r\n    /**\r\n     * Equatorial size\r\n     * @type {number}\r\n     * @protected\r\n     */\r\n    protected _a: number;\r\n\r\n    /**\r\n     * Polar size\r\n     * @type {number}\r\n     * @protected\r\n     */\r\n    protected _b: number;\r\n    protected _flattening: number;\r\n    protected _f: number;\r\n    protected _a2: number;\r\n    protected _b2: number;\r\n    protected _e: number;\r\n    protected _e2: number;\r\n    protected _e22: number;\r\n    protected _k: number;\r\n    protected _k2: number;\r\n    protected _radii: Vec3;\r\n    protected _radii2: Vec3;\r\n    protected _invRadii: Vec3;\r\n    public _invRadii2: Vec3;\r\n\r\n    constructor(equatorialSize: number = 1, polarSize: number = 1) {\r\n        this._a = equatorialSize;\r\n        this._b = polarSize;\r\n        this._flattening = (equatorialSize - polarSize) / equatorialSize;\r\n        this._f = 1 / this._flattening;\r\n\r\n        this._a2 = equatorialSize * equatorialSize;\r\n        this._b2 = polarSize * polarSize;\r\n\r\n        const qa2b2 = Math.sqrt(this._a2 - this._b2);\r\n\r\n        this._e = qa2b2 / equatorialSize;\r\n        this._e2 = this._e * this._e;\r\n        this._e22 = this._e2 * this._e2;\r\n\r\n        this._k = qa2b2 / polarSize;\r\n        this._k2 = this._k * this._k;\r\n\r\n        this._radii = new Vec3(equatorialSize, equatorialSize, polarSize);\r\n        this._radii2 = new Vec3(this._a2, this._a2, this._b2);\r\n        this._invRadii = new Vec3(1.0 / equatorialSize, 1.0 / equatorialSize, 1.0 / polarSize);\r\n        this._invRadii2 = new Vec3(1.0 / this._a2, 1.0 / this._a2, 1.0 / this._b2);\r\n    }\r\n\r\n    /**\r\n     * Returns the distance travelling from ‘this’ point to destination point along a rhumb line.\r\n     * @param   {LonLat} startLonLat coordinates.\r\n     * @param   {LonLat} endLonLat coordinates\r\n     * @returns {number} Distance in m between this point and destination point (same units as radius).\r\n     */\r\n    public rhumbDistanceTo(startLonLat: LonLat, endLonLat: LonLat): number {\r\n        const f1 = startLonLat.lat * RADIANS;\r\n        const f2 = endLonLat.lat * RADIANS;\r\n        const df = f2 - f1;\r\n        let d = Math.abs(endLonLat.lon - startLonLat.lon) * RADIANS;\r\n        if (Math.abs(d) > Math.PI) d = d > 0 ? -(2 * Math.PI - d) : (2 * Math.PI + d);\r\n        const dd = Math.log(Math.tan(f2 / 2 + Math.PI / 4) / Math.tan(f1 / 2 + Math.PI / 4));\r\n        const q = Math.abs(dd) > 10e-12 ? df / dd : Math.cos(f1);\r\n        const t = Math.sqrt(df * df + q * q * d * d); // angular distance in radians\r\n        return t * this._a;\r\n    }\r\n\r\n    /**\r\n     * Returns the point at given fraction between two points on the great circle.\r\n     * @param   {LonLat} lonLat1 - Longitude/Latitude of source point.\r\n     * @param   {LonLat} lonLat2 - Longitude/Latitude of destination point.\r\n     * @param   {number} fraction - Fraction between the two points (0 = source point, 1 = destination point).\r\n     * @returns {LonLat} Intermediate point between points.\r\n     */\r\n    public getIntermediatePointOnGreatCircle(lonLat1: LonLat, lonLat2: LonLat, fraction: number): LonLat {\r\n        if (fraction == 0) return lonLat1.clone();\r\n        if (fraction == 1) return lonLat2.clone();\r\n        const inverse = this.inverse(lonLat1, lonLat2);\r\n        const dist = inverse.distance;\r\n        const azimuth = inverse.initialAzimuth;\r\n        return isNaN(azimuth) ? lonLat1 : this.getGreatCircleDestination(lonLat1, azimuth, dist * fraction);\r\n    }\r\n\r\n    /**\r\n     * REMOVE ASAP after\r\n     * @param lonLat1\r\n     * @param lonLat2\r\n     * @returns {number}\r\n     */\r\n    static getBearing(lonLat1: LonLat, lonLat2: LonLat): number {\r\n        let f1 = lonLat1.lat * RADIANS,\r\n            l1 = lonLat1.lon * RADIANS;\r\n        let f2 = lonLat2.lat * RADIANS,\r\n            l2 = lonLat2.lon * RADIANS;\r\n        let y = Math.sin(l2 - l1) * Math.cos(f2);\r\n        let x = Math.cos(f1) * Math.sin(f2) - Math.sin(f1) * Math.cos(f2) * Math.cos(l2 - l1);\r\n        return Math.atan2(y, x) * DEGREES;\r\n    }\r\n\r\n    public getFlattening(): number {\r\n        return this._flattening;\r\n    }\r\n\r\n    /**\r\n     * Gets ellipsoid equatorial size.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getEquatorialSize(): number {\r\n        return this._a;\r\n    }\r\n\r\n    public get equatorialSize(): number {\r\n        return this._a;\r\n    }\r\n\r\n    public get equatorialSizeSqr(): number {\r\n        return this._a2;\r\n    }\r\n\r\n    /**\r\n     * Gets ellipsoid polar size.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getPolarSize(): number {\r\n        return this._b;\r\n    }\r\n\r\n    public get polarSize(): number {\r\n        return this._b;\r\n    }\r\n\r\n    public get polarSizeSqr(): number {\r\n        return this._b2;\r\n    }\r\n\r\n    /**\r\n     * Calculate cartesian coordinates by its ECEF geodetic coordinates.\r\n     * @public\r\n     * @param {LonLat} lonlat - Geodetic coordinates.\r\n     * @returns {Vec3} -\r\n     */\r\n    public lonLatToCartesian(lonlat: LonLat): Vec3 {\r\n        return this.geodeticToCartesian(lonlat.lon, lonlat.lat, lonlat.height);\r\n    }\r\n\r\n    /**\r\n     * Calculate cartesian coordinates by its ECEF geodetic coordinates.\r\n     * @public\r\n     * @param {LonLat} lonlat - Geodetic coordinates.\r\n     * @param {Vec3} res - Output variable reference.\r\n     * @returns {Vec3} -\r\n     */\r\n    public lonLatToCartesianRes(lonlat: LonLat, res: Vec3): Vec3 {\r\n        return this.geodeticToCartesian(lonlat.lon, lonlat.lat, lonlat.height, res);\r\n    }\r\n\r\n    /**\r\n     * Gets cartesian ECEF 3d coordinates from geodetic coordinates.\r\n     * @public\r\n     * @param {Number} lon - Longitude.\r\n     * @param {Number} lat - Latitude.\r\n     * @param {Number} height - Height.\r\n     * @param {Vec3} res - Output result variable.\r\n     * @returns {Vec3} -\r\n     */\r\n    public geodeticToCartesian(lon: number, lat: number, height: number = 0, res: Vec3 = new Vec3()): Vec3 {\r\n        let latrad = RADIANS * lat,\r\n            lonrad = RADIANS * lon;\r\n\r\n        let slt = Math.sin(latrad);\r\n\r\n        let N = this._a / Math.sqrt(1 - this._e2 * slt * slt);\r\n        let nc = (N + height) * Math.cos(latrad);\r\n\r\n        res.x = nc * Math.cos(lonrad);\r\n        res.y = nc * Math.sin(lonrad);\r\n        res.z = (N * (1 - this._e2) + height) * slt;\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Gets Wgs84 geodetic coordinates from cartesian ECEF.\r\n     * @public\r\n     * @param {Vec3} p - Cartesian coordinates.\r\n     * @returns {LonLat} -\r\n     */\r\n    public projToSurface(p: Vec3): Vec3 {\r\n\r\n        let pX = p.x || 0.0,\r\n            pY = p.y || 0.0,\r\n            pZ = p.z || 0.0;\r\n\r\n        let length = Math.sqrt(pX * pX + pY * pY + pZ * pZ);\r\n\r\n        if (length === 0) {\r\n            return this.lonLatToCartesian(new LonLat());\r\n        }\r\n\r\n        let invRadii2X = this._invRadii2.x,\r\n            invRadii2Y = this._invRadii2.y,\r\n            invRadii2Z = this._invRadii2.z;\r\n\r\n        let x2 = pX * pX * invRadii2X,\r\n            y2 = pY * pY * invRadii2Y,\r\n            z2 = pZ * pZ * invRadii2Z;\r\n\r\n        let norm = x2 + y2 + z2;\r\n        let ratio = Math.sqrt(1.0 / norm);\r\n        let first = p.scaleTo(ratio);\r\n\r\n        if (norm < EPS1) {\r\n            return !Number.isFinite(ratio) ? new Vec3() : first\r\n        }\r\n\r\n        let lambda = ((1.0 - ratio) * length) / first.mulA(this._invRadii2).length();\r\n\r\n        let m_X = 0.0, m_Y = 0.0, m_Z = 0.0;\r\n\r\n        do {\r\n            m_X = 1.0 / (1.0 + lambda * invRadii2X);\r\n            m_Y = 1.0 / (1.0 + lambda * invRadii2Y);\r\n            m_Z = 1.0 / (1.0 + lambda * invRadii2Z);\r\n\r\n            let m_X2 = m_X * m_X,\r\n                m_Y2 = m_Y * m_Y,\r\n                m_Z2 = m_Z * m_Z;\r\n\r\n            let func = x2 * m_X2 + y2 * m_Y2 + z2 * m_Z2 - 1.0;\r\n\r\n            if (Math.abs(func) < EPS12) {\r\n                break;\r\n            }\r\n\r\n            let m_X3 = m_X2 * m_X,\r\n                m_Y3 = m_Y2 * m_Y,\r\n                m_Z3 = m_Z2 * m_Z;\r\n\r\n            lambda += 0.5 * func / (x2 * m_X3 * invRadii2X + y2 * m_Y3 * invRadii2Y + z2 * m_Z3 * invRadii2Z);\r\n\r\n        } while (true); // eslint-disable-line\r\n\r\n        return new Vec3(pX * m_X, pY * m_Y, pZ * m_Z);\r\n    }\r\n\r\n    /**\r\n     * Converts 3d cartesian coordinates to geodetic\r\n     * @param {Vec3} cart - Cartesian coordinates\r\n     * @returns {LonLat} - Geodetic coordinates\r\n     */\r\n    public cartesianToLonLat(cart: Vec3): LonLat {\r\n        return this.cartesianToLonLatRes(cart);\r\n    }\r\n\r\n    /**\r\n     * Converts 3d cartesian coordinates to geodetic\r\n     * @param {Vec3} cart - Cartesian coordinates\r\n     * @param {LonLat} res - Link geodetic coordinates variable\r\n     * @returns {LonLat} - Geodetic coordinates\r\n     */\r\n    public cartesianToLonLatRes(cart: Vec3, res: LonLat = new LonLat()): LonLat {\r\n        let p = this.projToSurface(cart);\r\n        let n = this.getSurfaceNormal3v(p),\r\n            h = cart.sub(p);\r\n\r\n        res.lon = Math.atan2(n.y, n.x) * DEGREES;\r\n        res.lat = Math.asin(n.z) * DEGREES;\r\n        res.height = Math.sign(h.dot(cart)) * h.length();\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * Gets ellipsoid surface normal.\r\n     * @public\r\n     * @param {Vec3} coord - Spatial coordinates.\r\n     * @return {Vec3} -\r\n     */\r\n    public getSurfaceNormal3v(coord: Vec3): Vec3 {\r\n        let r2 = this._invRadii2;\r\n        let nx = coord.x * r2.x,\r\n            ny = coord.y * r2.y,\r\n            nz = coord.z * r2.z;\r\n        let l = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\r\n        return new Vec3(nx * l, ny * l, nz * l);\r\n    }\r\n\r\n    public getGreatCircleDistance(lonLat1: LonLat, lonLat2: LonLat): number {\r\n        return this.inverse(lonLat1, lonLat2).distance;\r\n    }\r\n\r\n    /**\r\n     * Calculates the destination point given start point lat / lon, azimuth(deg) and distance (m).\r\n     * Source: http://movable-type.co.uk/scripts/latlong-vincenty-direct.html and optimized / cleaned up by Mathias Bynens <http://mathiasbynens.be/>\r\n     * Based on the Vincenty direct formula by T. Vincenty, “Direct and Inverse Solutions of Geodesics on the Ellipsoid with application of nested equations”, Survey Review, vol XXII no 176, 1975 <http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf>\r\n     * @param {LonLat} lonLat - Origin coordinates\r\n     * @param {number} azimuth - View azimuth in degrees\r\n     * @param {number} dist - Distance to the destination point coordinates in meters\r\n     * @returns {LonLat} - Destination point coordinates\r\n     */\r\n    public getGreatCircleDestination(lonLat: LonLat, azimuth: number, dist: number): LonLat {\r\n        return this.direct(lonLat, azimuth, dist).destination;\r\n    }\r\n\r\n    /**\r\n     * Returns inverse Geodesic solution for two points\r\n     * @param {LonLat} lonLat1 - start coordinates point\r\n     * @param {LonLat} lonLat2 - end coordinates point\r\n     * @returns {IInverseResult} - Contains distance, initialAzimuth, and finalAzimuth values\r\n     */\r\n    public inverse(lonLat1: LonLat, lonLat2: LonLat): IInverseResult {\r\n\r\n        let a = this._a, b = this._b, f = this._flattening;\r\n\r\n        const fi1 = lonLat1.lat * RADIANS, lambda1 = lonLat1.lon * RADIANS;\r\n        const fi2 = lonLat2.lat * RADIANS, lambda2 = lonLat2.lon * RADIANS;\r\n\r\n        const L = lambda2 - lambda1; // L = difference in longitude, U = reduced latitude, defined by tan U = (1-f)·tanφ.\r\n        const tanU1 = (1 - f) * Math.tan(fi1), cosU1 = 1 / Math.sqrt((1 + tanU1 * tanU1)), sinU1 = tanU1 * cosU1;\r\n        const tanU2 = (1 - f) * Math.tan(fi2), cosU2 = 1 / Math.sqrt((1 + tanU2 * tanU2)), sinU2 = tanU2 * cosU2;\r\n\r\n        const antipodal = Math.abs(L) > Math.PI / 2 || Math.abs(fi2 - fi1) > Math.PI / 2;\r\n\r\n        let lmb = L, sinLmb = null, cosLmb = null; // lmb - difference in longitude on an auxiliary sphere\r\n        let s = antipodal ? Math.PI : 0, sin_s = 0, cos_s = antipodal ? -1 : 1, sinSqs = null; // s - angular distance lonLat1 lonLat2 on the sphere\r\n        let cos2sm = 1;                      // sm - angular distance on the sphere from the equator to the midpoint of the line\r\n        let cosSqa = 1;                      // a - azimuth of the geodesic at the equator\r\n\r\n        let lmb_ = null, iterations = 0;\r\n        do {\r\n            sinLmb = Math.sin(lmb);\r\n            cosLmb = Math.cos(lmb);\r\n            sinSqs = (cosU2 * sinLmb) ** 2 + (cosU1 * sinU2 - sinU1 * cosU2 * cosLmb) ** 2;\r\n            if (Math.abs(sinSqs) < 1e-24) break;  // co-incident/antipodal points (σ < ≈0.006mm)\r\n            sin_s = Math.sqrt(sinSqs);\r\n            cos_s = sinU1 * sinU2 + cosU1 * cosU2 * cosLmb;\r\n            s = Math.atan2(sin_s, cos_s);\r\n            const sin_a = cosU1 * cosU2 * sinLmb / sin_s;\r\n            cosSqa = 1 - sin_a * sin_a;\r\n            cos2sm = (cosSqa != 0) ? (cos_s - 2 * sinU1 * sinU2 / cosSqa) : 0; // on equatorial line cos²α = 0 (§6)\r\n            const C = f / 16 * cosSqa * (4 + f * (4 - 3 * cosSqa));\r\n            lmb_ = lmb;\r\n            lmb = L + (1 - C) * f * sin_a * (s + C * sin_s * (cos2sm + C * cos_s * (-1 + 2 * cos2sm * cos2sm)));\r\n        } while (Math.abs(lmb - lmb_) > EPS12 && ++iterations < 1000);\r\n\r\n        const uSq = cosSqa * (a * a - b * b) / (b * b);\r\n        const A = 1 + uSq / 16384 * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq)));\r\n        const B = uSq / 1024 * (256 + uSq * (-128 + uSq * (74 - 47 * uSq)));\r\n        const ds = B * sin_s * (cos2sm + B / 4 * (cos_s * (-1 + 2 * cos2sm * cos2sm) - B / 6 * cos2sm * (-3 + 4 * sin_s * sin_s) * (-3 + 4 * cos2sm * cos2sm)));\r\n\r\n        const dist = b * A * (s - ds); // s = length of the geodesic\r\n\r\n        // note special handling of exactly antipodal points where sin²σ = 0 (due to discontinuity\r\n        // atan2(0, 0) = 0 but atan2(ε, 0) = π/2 / 90°) - in which case bearing is always meridional,\r\n        // due north (or due south!)\r\n        // α = azimuths of the geodesic; α2 the direction P₁ P₂ produced\r\n        const a1 = Math.abs(sinSqs) < Number.EPSILON ? 0 : Math.atan2(cosU2 * sinLmb, cosU1 * sinU2 - sinU1 * cosU2 * cosLmb);\r\n        const a2 = Math.abs(sinSqs) < Number.EPSILON ? Math.PI : Math.atan2(cosU1 * sinLmb, -sinU1 * cosU2 + cosU1 * sinU2 * cosLmb);\r\n\r\n        return {\r\n            distance: dist,\r\n            initialAzimuth: Math.abs(dist) < Number.EPSILON ? NaN : zeroTwoPI(a1) * DEGREES,\r\n            finalAzimuth: Math.abs(dist) < Number.EPSILON ? NaN : zeroTwoPI(a2) * DEGREES\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculates the destination point given start point lat / lon, azimuth(deg) and distance (m).\r\n     * Source: http://movable-type.co.uk/scripts/latlong-vincenty-direct.html and optimized / cleaned up by Mathias Bynens <http://mathiasbynens.be/>\r\n     * Based on the Vincenty direct formula by T. Vincenty, “Direct and Inverse Solutions of Geodesics on the Ellipsoid with application of nested equations”, Survey Review, vol XXII no 176, 1975 <http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf>\r\n     * @param {LonLat} lonLat - Origin coordinates\r\n     * @param {number} azimuth - View azimuth in degrees\r\n     * @param {number} dist - Distance to the destination point coordinates in meters\r\n     * @returns {{destination: LonLat, finalAzimuth: number}} - Destination point coordinates\r\n     */\r\n    public direct(lonLat: LonLat, azimuth: number, dist: number): IDirectResult {\r\n\r\n        let lon1 = lonLat.lon,\r\n            lat1 = lonLat.lat;\r\n\r\n        let a = this._a,\r\n            b = this._b,\r\n            f = this._flattening,\r\n            s = dist,\r\n            alpha1 = azimuth * RADIANS,\r\n            sinAlpha1 = Math.sin(alpha1),\r\n            cosAlpha1 = Math.cos(alpha1),\r\n            tanU1 = (1 - f) * Math.tan(lat1 * RADIANS),\r\n            cosU1 = 1 / Math.sqrt(1 + tanU1 * tanU1),\r\n            sinU1 = tanU1 * cosU1,\r\n            sigma1 = Math.atan2(tanU1, cosAlpha1),\r\n            sinAlpha = cosU1 * sinAlpha1,\r\n            cosSqAlpha = 1 - sinAlpha * sinAlpha,\r\n            uSq = (cosSqAlpha * (a * a - b * b)) / (b * b),\r\n            A = 1 + (uSq / 16384) * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq))),\r\n            B = (uSq / 1024) * (256 + uSq * (-128 + uSq * (74 - 47 * uSq))),\r\n            sigma = s / (b * A),\r\n            sigmaP = 2 * Math.PI;\r\n\r\n        let cos2SigmaM = 0,\r\n            sinSigma = 0,\r\n            cosSigma = 0,\r\n            deltaSigma = 0;\r\n\r\n        while (Math.abs(sigma - sigmaP) > 1e-12) {\r\n            cos2SigmaM = Math.cos(2 * sigma1 + sigma);\r\n            sinSigma = Math.sin(sigma);\r\n            cosSigma = Math.cos(sigma);\r\n            deltaSigma = B * sinSigma *\r\n                (cos2SigmaM + (B / 4) *\r\n                    (\r\n                        cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM) -\r\n                        (B / 6) * cos2SigmaM * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2SigmaM * cos2SigmaM)\r\n                    ));\r\n            sigmaP = sigma;\r\n            sigma = s / (b * A) + deltaSigma;\r\n        }\r\n\r\n        let tmp = sinU1 * sinSigma - cosU1 * cosSigma * cosAlpha1,\r\n            lat2 = Math.atan2(\r\n                sinU1 * cosSigma + cosU1 * sinSigma * cosAlpha1,\r\n                (1 - f) * Math.sqrt(sinAlpha * sinAlpha + tmp * tmp)\r\n            ),\r\n            lambda = Math.atan2(\r\n                sinSigma * sinAlpha1,\r\n                cosU1 * cosSigma - sinU1 * sinSigma * cosAlpha1\r\n            ),\r\n            C = (f / 16.0) * cosSqAlpha * (4.0 + f * (4.0 - 3.0 * cosSqAlpha)),\r\n            L = lambda - (1.0 - C) * f * sinAlpha * (sigma + C * sinSigma * (cos2SigmaM + C * cosSigma * (-1.0 + 2.0 * cos2SigmaM * cos2SigmaM))),\r\n            revAz = Math.atan2(sinAlpha, -tmp);\r\n\r\n        return {\r\n            destination: new LonLat(lon1 + L * DEGREES, lat2 * DEGREES),\r\n            finalAzimuth: revAz * DEGREES\r\n        };\r\n    }\r\n\r\n\r\n    /**\r\n     * Returns cartesian coordinates of the intersection of a ray and an ellipsoid.\r\n     * If the ray doesn't hit ellipsoid returns null.\r\n     * @public\r\n     * @param {Vec3} origin - Ray origin point.\r\n     * @param {Vec3} direction - Ray direction.\r\n     * @returns {Vec3} -\r\n     */\r\n    public hitRay(origin: Vec3, direction: Vec3): Vec3 | undefined {\r\n        let q = this._invRadii.mul(origin);\r\n        let w = this._invRadii.mul(direction);\r\n\r\n        let q2 = q.dot(q);\r\n        let qw = q.dot(w);\r\n\r\n        let difference, w2, product, discriminant, temp;\r\n\r\n        if (q2 > 1.0) {\r\n            // Outside ellipsoid.\r\n            if (qw >= 0.0) {\r\n                // Looking outward or tangent (0 intersections).\r\n                return undefined;\r\n            }\r\n\r\n            // qw < 0.0.\r\n            var qw2 = qw * qw;\r\n            difference = q2 - 1.0; // Positively valued.\r\n            w2 = w.dot(w);\r\n            product = w2 * difference;\r\n\r\n            let eps = Math.abs(qw2 - product);\r\n\r\n            if (eps > EPS15 && qw2 < product) {\r\n                // Imaginary roots (0 intersections).\r\n                return undefined;\r\n            } else if (qw2 > product) {\r\n                // Distinct roots (2 intersections).\r\n                discriminant = qw * qw - product;\r\n                temp = -qw + Math.sqrt(discriminant); // Avoid cancellation.\r\n                var root0 = temp / w2;\r\n                var root1 = difference / temp;\r\n                if (root0 < root1) {\r\n                    return origin.add(direction.scaleTo(root0));\r\n                }\r\n                return origin.add(direction.scaleTo(root1));\r\n            } else {\r\n                // qw2 == product.  Repeated roots (2 intersections).\r\n                var root = Math.sqrt(difference / w2);\r\n                return origin.add(direction.scaleTo(root));\r\n            }\r\n        } else if (q2 < 1.0) {\r\n            // Inside ellipsoid (2 intersections).\r\n            difference = q2 - 1.0; // Negatively valued.\r\n            w2 = w.dot(w);\r\n            product = w2 * difference; // Negatively valued.\r\n            discriminant = qw * qw - product;\r\n            temp = -qw + Math.sqrt(discriminant); // Positively valued.\r\n            return origin.add(direction.scaleTo(temp / w2));\r\n        } else {\r\n            // q2 == 1.0. On ellipsoid.\r\n            if (qw < 0.0) {\r\n                // Looking inward.\r\n                w2 = w.dot(w);\r\n                return origin.add(direction.scaleTo(-qw / w2));\r\n            }\r\n            // qw >= 0.0.  Looking outward or tangent.\r\n            // return undefined\r\n        }\r\n    }\r\n\r\n    public getNorthFrameRotation(cartesian: Vec3): Quat {\r\n        let n = this.getSurfaceNormal3v(cartesian);\r\n        let t = Vec3.proj_b_to_plane(Vec3.NORTH, n);\r\n        return Quat.getLookRotation(t, n);\r\n    }\r\n\r\n    /**\r\n     * @todo this is not precise function, needs to be replaced or removed\r\n     * @param lonLat1\r\n     * @param bearing\r\n     * @param distance\r\n     * @returns {LonLat}\r\n     */\r\n    public getBearingDestination(lonLat1: LonLat, bearing: number = 0.0, distance: number = 0): LonLat {\r\n        bearing = bearing * RADIANS;\r\n        var nlon = ((lonLat1.lon + 540) % 360) - 180;\r\n        var f1 = lonLat1.lat * RADIANS,\r\n            l1 = nlon * RADIANS;\r\n        var dR = distance / this._a;\r\n        var f2 = Math.asin(\r\n            Math.sin(f1) * Math.cos(dR) + Math.cos(f1) * Math.sin(dR) * Math.cos(bearing)\r\n        );\r\n        return new LonLat(\r\n            (l1 +\r\n                Math.atan2(\r\n                    Math.sin(bearing) * Math.sin(dR) * Math.cos(f1),\r\n                    Math.cos(dR) - Math.sin(f1) * Math.sin(f2)\r\n                )) *\r\n            DEGREES,\r\n            f2 * DEGREES\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns the point at given fraction between two points on the great circle.\r\n     * @param   {LonLat} lonLat1 - Longitude/Latitude of source point.\r\n     * @param   {LonLat} lonLat2 - Longitude/Latitude of destination point.\r\n     * @param   {number} fraction - Fraction between the two points (0 = source point, 1 = destination point).\r\n     * @returns {LonLat} Intermediate point between points.\r\n     */\r\n    static getIntermediatePointOnGreatCircle(lonLat1: LonLat, lonLat2: LonLat, fraction: number): LonLat {\r\n        var f1 = lonLat1.lat * RADIANS,\r\n            l1 = lonLat1.lon * RADIANS;\r\n        var f2 = lonLat2.lat * RADIANS,\r\n            l2 = lonLat2.lon * RADIANS;\r\n\r\n        var sinf1 = Math.sin(f1),\r\n            cosf1 = Math.cos(f1),\r\n            sinl1 = Math.sin(l1),\r\n            cosl1 = Math.cos(l1);\r\n        var sinf2 = Math.sin(f2),\r\n            cosf2 = Math.cos(f2),\r\n            sinl2 = Math.sin(l2),\r\n            cosl2 = Math.cos(l2);\r\n\r\n        var df = f2 - f1,\r\n            dl = l2 - l1;\r\n        var a =\r\n            Math.sin(df / 2) * Math.sin(df / 2) +\r\n            Math.cos(f1) * Math.cos(f2) * Math.sin(dl / 2) * Math.sin(dl / 2);\r\n        var d = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\r\n        var A = Math.sin((1 - fraction) * d) / Math.sin(d);\r\n        var B = Math.sin(fraction * d) / Math.sin(d);\r\n\r\n        var x = A * cosf1 * cosl1 + B * cosf2 * cosl2;\r\n        var y = A * cosf1 * sinl1 + B * cosf2 * sinl2;\r\n        var z = A * sinf1 + B * sinf2;\r\n\r\n        var f3 = Math.atan2(z, Math.sqrt(x * x + y * y));\r\n        var l3 = Math.atan2(y, x);\r\n\r\n        return new LonLat(((l3 * DEGREES + 540) % 360) - 180, f3 * DEGREES);\r\n    }\r\n\r\n    static getRhumbBearing(lonLat1: LonLat, lonLat2: LonLat): number {\r\n        var dLon = (lonLat2.lon - lonLat1.lon) * RADIANS;\r\n        var dPhi = Math.log(\r\n            Math.tan((lonLat2.lat * RADIANS) / 2 + Math.PI / 4) /\r\n            Math.tan((lonLat1.lat * RADIANS) / 2 + Math.PI / 4)\r\n        );\r\n        if (Math.abs(dLon) > Math.PI) {\r\n            if (dLon > 0) {\r\n                dLon = (2 * Math.PI - dLon) * -1;\r\n            } else {\r\n                dLon = 2 * Math.PI + dLon;\r\n            }\r\n        }\r\n        return (Math.atan2(dLon, dPhi) * DEGREES + 360) % 360;\r\n    }\r\n\r\n    public getLonLatVisibilitySimple(eye: Vec3, lonLat: LonLat, forward?: Vec3): boolean {\r\n        const cart = this.lonLatToCartesian(lonLat);\r\n        const height = lonLat.height;\r\n\r\n        const f = this.polarSize + height;\r\n        const g = Math.max(eye.length() - this.polarSize, 0);\r\n        const look = cart.sub(eye);\r\n\r\n        let maxVisibleDistance;\r\n        if (g > 0) {\r\n            maxVisibleDistance = Math.sqrt((f + g) ** 2 - f ** 2);\r\n        } else {\r\n            maxVisibleDistance = f;\r\n        }\r\n\r\n        return maxVisibleDistance > look.length() &&\r\n            (!forward || forward.dot(look.normalize()) > 0.0);\r\n    }\r\n}\r\n\r\nexport {Ellipsoid};\r\n","import {Ellipsoid} from \"./Ellipsoid\";\r\n\r\n/**\r\n * WGS84 ellipsoid object.\r\n * @type {Ellipsoid}\r\n */\r\nexport const wgs84 = new Ellipsoid(6378137.0, 6356752.3142451793); // Equitorial Radius (m), Polar Radius (m)\r\n","/**\r\n * @module og/utils/shared\r\n */\r\n\r\nimport {Extent} from \"../Extent\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {colorTable} from \"./colorTable\";\r\nimport {Ellipsoid} from \"../ellipsoid/Ellipsoid\";\r\nimport {wgs84} from \"../ellipsoid/wgs84\";\r\nimport * as mercator from \"../mercator\";\r\n\r\nexport function getDefault(param?: any, def?: any): boolean {\r\n    return param != undefined ? param : def;\r\n}\r\n\r\nexport function isEmpty(v: any): boolean {\r\n    return v == null;\r\n}\r\n\r\n/**\r\n * Returns true if the object pointer is undefined.\r\n * @function\r\n * @param {Object} obj - Object pointer.\r\n * @returns {boolean} Returns true if object is undefined.\r\n */\r\nexport function isUndef(obj?: any): boolean {\r\n    return obj === void 0;\r\n}\r\n\r\nexport function isUndefExt(obj: any, defVal: any): any {\r\n    return isUndef(obj) ? defVal : obj;\r\n}\r\n\r\nlet _stampCounter: number = 0;\r\n\r\nexport function stamp(obj: any): number {\r\n    let stamp = obj._openglobus_id;\r\n    if (!stamp) {\r\n        stamp = obj._openglobus_id = ++_stampCounter;\r\n    }\r\n    return stamp;\r\n}\r\n\r\nexport function isString(s: any): boolean {\r\n    return typeof s === \"string\" || s instanceof String;\r\n}\r\n\r\nfunction d2h(val: number): string {\r\n    return val.toString(16).padStart(2, '0');\r\n}\r\n\r\nexport function rgbToStringHTML(rgb: NumberArray3 | Vec3): string {\r\n    let r: string, g: string, b: string;\r\n    if (rgb instanceof Array) {\r\n        r = d2h(rgb[0]);\r\n        g = d2h(rgb[1]);\r\n        b = d2h(rgb[2]);\r\n    } else {\r\n        r = d2h(rgb.x);\r\n        g = d2h(rgb.y);\r\n        b = d2h(rgb.z);\r\n    }\r\n    return `#${r}${g}${b}`;\r\n}\r\n\r\n/**\r\n * Convert html color string to the RGBA number vector.\r\n * @param {string} htmlColor - HTML string(\"#C6C6C6\" or \"#EF5\" or \"rgb(8,8,8)\" or \"rgba(8,8,8)\") color.\r\n * @param {number} [opacity] - Opacity for the output vector.\r\n * @returns {Vec4} -\r\n */\r\nexport function htmlColorToRgba(htmlColor: string, opacity?: number): Vec4 {\r\n    let hColor: any | undefined = colorTable[htmlColor];\r\n    if (hColor) {\r\n        htmlColor = hColor;\r\n    }\r\n\r\n    if (htmlColor[0] === \"#\") {\r\n        let shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        let hex = htmlColor.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n        let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        if (result) {\r\n            return new Vec4(\r\n                parseInt(result[1], 16) / 255,\r\n                parseInt(result[2], 16) / 255,\r\n                parseInt(result[3], 16) / 255,\r\n                isEmpty(opacity) ? 1.0 : opacity\r\n            );\r\n        } else {\r\n            return new Vec4();\r\n        }\r\n    } else {\r\n        if (isEmpty(opacity)) {\r\n            opacity = 1.0;\r\n        }\r\n        let m = htmlColor.split(\",\");\r\n        return new Vec4(\r\n            parseInt(m[0].split(\"(\")[1]) / 255,\r\n            parseInt(m[1]) / 255,\r\n            parseInt(m[2]) / 255,\r\n            !isEmpty(m[3]) ? parseFloat(m[3]) : opacity\r\n        );\r\n    }\r\n}\r\n\r\nexport function htmlColorToFloat32Array(htmlColor: string, opacity?: number): Float32Array {\r\n    let c = htmlColorToRgba(htmlColor, opacity);\r\n    return new Float32Array([c.x, c.y, c.z, c.w]);\r\n}\r\n\r\n/**\r\n * Convert html color string to the RGB number vector.\r\n * @param {string} htmlColor - HTML string(\"#C6C6C6\" or \"#EF5\" or \"rgb(8,8,8)\" or \"rgba(8,8,8)\") color.\r\n * @returns {Vec3} -\r\n */\r\nexport function htmlColorToRgb(htmlColor: string): Vec3 {\r\n    let hColor: any | undefined = colorTable[htmlColor];\r\n    if (hColor) {\r\n        htmlColor = hColor;\r\n    }\r\n\r\n    if (htmlColor[0] === \"#\") {\r\n        let shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        let hex = htmlColor.replace(shorthandRegex, function (m, r, g, b) {\r\n            return r + r + g + g + b + b;\r\n        });\r\n        let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\r\n        if (result) {\r\n            return new Vec3(\r\n                parseInt(result[1], 16) / 255,\r\n                parseInt(result[2], 16) / 255,\r\n                parseInt(result[3], 16) / 255\r\n            );\r\n        } else {\r\n            return new Vec3();\r\n        }\r\n    } else {\r\n        let m = htmlColor.split(\",\");\r\n        return new Vec3(\r\n            parseInt(m[0].split(\"(\")[1]) / 255,\r\n            parseInt(m[1]) / 255,\r\n            parseInt(m[2]) / 255\r\n        );\r\n    }\r\n}\r\n\r\n/**\r\n * Replace template substrings between '{' and '}' tokens.\r\n * @param {string} template - String with templates in \"{\" and \"}\"\r\n * @param {Object} params - Template named object with subsrtings.\r\n * @returns {string} -\r\n *\r\n * @example <caption>Example from og.terrain that replaces tile indexes in url:</caption>\r\n * var substrings = {\r\n *       \"x\": 12,\r\n *       \"y\": 15,\r\n *       \"z\": 8\r\n * }\r\n * og.utils.stringTemplate(\"http://earth3.openglobus.org/{z}/{y}/{x}.ddm\", substrings);\r\n * //returns http://earth3.openglobus.org/8/15/12.ddm\r\n */\r\nexport function stringTemplate(template: string, params?: any): string {\r\n    return template.replace(/{[^{}]+}/g, function (key) {\r\n        return params[key.replace(/[{}]+/g, \"\")] || \"\";\r\n    });\r\n}\r\n\r\n/**\r\n * Replace template substrings between '${...}' tokens.\r\n * @param {string} template - String with templates in \"${\" and \"}\"\r\n * @param {Object} params - Template named object with subsrtings.\r\n * @returns {string} -\r\n *\r\n * @example <caption>Example from og.terrain that replaces tile indexes in url:</caption>\r\n * var substrings = {\r\n *       \"x\": 12,\r\n *       \"y\": 15,\r\n *       \"z\": 8\r\n * }\r\n * og.utils.stringTemplate2(\"http://earth3.openglobus.org/${z}/${y}/${x}.ddm\", substrings);\r\n * //returns http://earth3.openglobus.org/8/15/12.ddm\r\n */\r\nexport function stringTemplate2(template: string, params?: Record<string, any>): string {\r\n    return template.replace(/\\$\\{([^}]+)\\}/g, (_, key) => {\r\n        return params?.[key.trim()] ?? \"\";\r\n    });\r\n}\r\n\r\nexport function getHTML(template: string, params?: any): string {\r\n    return stringTemplate(template, params);\r\n}\r\n\r\nexport function parseHTML(htmlStr: string): HTMLElement[] {\r\n    let p = document.createElement(\"div\");\r\n    p.innerHTML = htmlStr;\r\n    let domArr: HTMLElement[] = [];\r\n    for (let i = 0; i < p.childNodes.length; i++) {\r\n        domArr.push(p.childNodes[i] as HTMLElement);\r\n        p.removeChild(p.childNodes[i]);\r\n    }\r\n    return domArr;\r\n}\r\n\r\nexport function print2d(id: string, text: string, x: number, y: number) {\r\n    let el = document.getElementById(id);\r\n    if (!el) {\r\n        el = document.createElement(\"div\");\r\n        el.id = id;\r\n        el.classList.add(\"defaultText\");\r\n        document.body.appendChild(el);\r\n    }\r\n    el.innerHTML = text;\r\n    el.style.left = `${x}px`;\r\n    el.style.top = `${y}px`;\r\n}\r\n\r\nexport function isNumber(value: any): boolean {\r\n    return typeof value === 'number';\r\n}\r\n\r\nexport function defaultString(str?: string, def: string = \"\"): string {\r\n    return str ? str.trim() : def;\r\n}\r\n\r\nexport function createVector3(v?: number | Vec3 | Vec2 | NumberArray3 | NumberArray2 | null, def?: Vec3): Vec3 {\r\n    if (v) {\r\n        if (isNumber(v)) {\r\n            return new Vec3(v as number, v as number, v as number);\r\n        } else if (v instanceof Vec3) {\r\n            return v.clone();\r\n        } else if (v instanceof Array) {\r\n            return Vec3.fromVec(v);\r\n        } else if (v instanceof Vec2) {\r\n            return new Vec3(v.x, v.y, 0.0);\r\n        }\r\n    } else if (def) {\r\n        return def;\r\n    }\r\n    return new Vec3();\r\n}\r\n\r\nexport function createVector4(v?: Vec4 | NumberArray4 | null, def?: Vec4): Vec4 {\r\n    if (v) {\r\n        if (v instanceof Vec4) {\r\n            return v.clone();\r\n        } else if (v instanceof Array) {\r\n            return Vec4.fromVec(v);\r\n        }\r\n    } else if (def) {\r\n        return def;\r\n    }\r\n    return new Vec4();\r\n}\r\n\r\nexport function createColorRGBA(c?: string | NumberArray4 | Vec4 | null, def?: Vec4): Vec4 {\r\n    if (c) {\r\n        if (isString(c)) {\r\n            return htmlColorToRgba(c as string);\r\n        } else if (c instanceof Array) {\r\n            return Vec4.fromVec(c);\r\n        } else if (c instanceof Vec4) {\r\n            return c.clone();\r\n        }\r\n    } else if (def) {\r\n        return def;\r\n    }\r\n    return new Vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n\r\nexport function createColorRGB(c?: string | NumberArray3 | Vec3 | null, def?: Vec3): Vec3 {\r\n    if (c) {\r\n        if (isString(c)) {\r\n            return htmlColorToRgb(c as string);\r\n        } else if (c instanceof Array) {\r\n            return Vec3.fromVec(c);\r\n        } else if (c instanceof Vec3) {\r\n            return (c as Vec3).clone();\r\n        }\r\n    } else if (def) {\r\n        return def;\r\n    }\r\n    return new Vec3(1.0, 1.0, 1.0);\r\n}\r\n\r\nexport function createExtent(e?: Extent | [[number, number], [number, number]] | null, def?: Extent): Extent {\r\n    if (e) {\r\n        if (e instanceof Array) {\r\n            return new Extent(createLonLat(e[0]), createLonLat(e[1]));\r\n        } else if (e instanceof Extent) {\r\n            return e.clone();\r\n        }\r\n    } else if (def) {\r\n        return def;\r\n    }\r\n    return new Extent();\r\n}\r\n\r\nexport function createLonLat(l?: LonLat | NumberArray2 | NumberArray3, def?: LonLat): LonLat {\r\n    if (l) {\r\n        if (l instanceof Array) {\r\n            return new LonLat(l[0], l[1], l[2]);\r\n        } else if (l instanceof LonLat) {\r\n            return l.clone();\r\n        }\r\n    } else if (def) {\r\n        return def;\r\n    }\r\n    return new LonLat();\r\n}\r\n\r\nexport function binarySearchFast(arr: number[] | TypedArray, x: number) {\r\n    let start = 0,\r\n        end = arr.length - 1;\r\n    while (start <= end) {\r\n        let k = Math.floor((start + end) * 0.5);\r\n        if (Math.abs(arr[k] - x) < 1e-3) {\r\n            return k;\r\n        } else if (arr[k] < x) {\r\n            start = k + 1;\r\n        } else {\r\n            end = k - 1;\r\n        }\r\n    }\r\n    return -1;\r\n}\r\n\r\n/**\r\n * Finds an item in a sorted array.\r\n * @param {any[]} ar The sorted array to search.\r\n * @param {any} el The item to find in the array.\r\n * @param {Function} compare_fn comparator The function to use to compare the item to\r\n *        elements in the array.\r\n * @returns {number} a negative number  if 'a' is less than 'b'; 0 if 'a' is equal to 'b'; 'a' positive number of 'a' is greater than 'b'.\r\n *\r\n * @example\r\n * // Create a comparator function to search through an array of numbers.\r\n * function comparator(a, b) {\r\n *     return a - b;\r\n * };\r\n * var numbers = [0, 2, 4, 6, 8];\r\n * var index = og.utils.binarySearch(numbers, 6, comparator); // 3\r\n */\r\nexport function binarySearch(ar: any[], el: any, compare_fn: Function): number {\r\n    let m = 0;\r\n    let n = ar.length - 1;\r\n    while (m <= n) {\r\n        let k = (n + m) >> 1;\r\n        let cmp = compare_fn(el, ar[k], k);\r\n        if (cmp > 0) {\r\n            m = k + 1;\r\n        } else if (cmp < 0) {\r\n            n = k - 1;\r\n        } else {\r\n            return k;\r\n        }\r\n    }\r\n    return -m - 1;\r\n}\r\n\r\n/**\r\n * @todo: replace any with generic\r\n * Binary insertion that uses binarySearch algorithm.\r\n * @param {any[]} ar - The sorted array to insert.\r\n * @param {any} el - The item to insert.\r\n * @param {Function} compare_fn - comparator The function to use to compare the item to\r\n *        elements in the array.\r\n * @returns {number} Array index position in which item inserted in.\r\n */\r\nexport function binaryInsert(ar: any[], el: any, compare_fn: Function): number {\r\n    let i = binarySearch(ar, el, compare_fn);\r\n    if (i < 0) {\r\n        i = ~i;\r\n    }\r\n    ar.splice(i, 0, el);\r\n    return i;\r\n}\r\n\r\n/**\r\n * Returns two segment lines intersection coordinate.\r\n * @static\r\n * @param {Vec2} start1 - First line first coordinate.\r\n * @param {Vec2} end1 - First line second coordinate.\r\n * @param {Vec2} start2 - Second line first coordinate.\r\n * @param {Vec2} end2 - Second line second coordinate.\r\n * @param {boolean} [isSegment] - Lines are segments.\r\n * @return {Vec2} - Intersection coordinate.\r\n */\r\nexport function getLinesIntersection2v(start1: Vec2, end1: Vec2, start2: Vec2, end2: Vec2, isSegment: boolean): Vec2 | undefined {\r\n    let dir1 = end1.sub(start1);\r\n    let dir2 = end2.sub(start2);\r\n\r\n    let a1 = -dir1.y;\r\n    let b1 = +dir1.x;\r\n    let d1 = -(a1 * start1.x + b1 * start1.y);\r\n\r\n    let a2 = -dir2.y;\r\n    let b2 = +dir2.x;\r\n    let d2 = -(a2 * start2.x + b2 * start2.y);\r\n\r\n    let seg1_line2_start = a2 * start1.x + b2 * start1.y + d2;\r\n    let seg1_line2_end = a2 * end1.x + b2 * end1.y + d2;\r\n\r\n    let seg2_line1_start = a1 * start2.x + b1 * start2.y + d1;\r\n    let seg2_line1_end = a1 * end2.x + b1 * end2.y + d1;\r\n\r\n    if (\r\n        isSegment &&\r\n        (seg1_line2_start * seg1_line2_end > 0 || seg2_line1_start * seg2_line1_end > 0)\r\n    ) {\r\n        return undefined;\r\n    }\r\n\r\n    let u = seg1_line2_start / (seg1_line2_start - seg1_line2_end);\r\n\r\n    return new Vec2(start1.x + u * dir1.x, start1.y + u * dir1.y);\r\n}\r\n\r\n/**\r\n * Returns two segment lines intersection coordinate.\r\n * @static\r\n * @param {Vec2} start1 - First line first coordinate.\r\n * @param {Vec2} end1 - First line second coordinate.\r\n * @param {Vec2} start2 - Second line first coordinate.\r\n * @param {Vec2} end2 - Second line second coordinate.\r\n * @param {boolean} [isSegment=false] - Lines are segments.\r\n * @return {Vec2} - Intersection coordinate.\r\n */\r\nexport function getLinesIntersectionLonLat(start1: LonLat, end1: LonLat, start2: LonLat, end2: LonLat, isSegment: boolean = false): LonLat | undefined {\r\n    let dir1 = new LonLat(end1.lon - start1.lon, end1.lat - start1.lat);\r\n    let dir2 = new LonLat(end2.lon - start2.lon, end2.lat - start2.lat);\r\n\r\n    let a1 = -dir1.lat;\r\n    let b1 = +dir1.lon;\r\n    let d1 = -(a1 * start1.lon + b1 * start1.lat);\r\n\r\n    let a2 = -dir2.lat;\r\n    let b2 = +dir2.lon;\r\n    let d2 = -(a2 * start2.lon + b2 * start2.lat);\r\n\r\n    let seg1_line2_start = a2 * start1.lon + b2 * start1.lat + d2;\r\n    let seg1_line2_end = a2 * end1.lon + b2 * end1.lat + d2;\r\n\r\n    let seg2_line1_start = a1 * start2.lon + b1 * start2.lat + d1;\r\n    let seg2_line1_end = a1 * end2.lon + b1 * end2.lat + d1;\r\n\r\n    if (\r\n        isSegment &&\r\n        (seg1_line2_start * seg1_line2_end > 0 || seg2_line1_start * seg2_line1_end > 0)\r\n    ) {\r\n        return undefined;\r\n    }\r\n\r\n    let u = seg1_line2_start / (seg1_line2_start - seg1_line2_end);\r\n\r\n    return new LonLat(start1.lon + u * dir1.lon, start1.lat + u * dir1.lat);\r\n}\r\n\r\n/**\r\n * Converts XML to JSON\r\n * @static\r\n * @param {Object} xml - Xml object\r\n * @return {Object} - Json converted object.\r\n */\r\nexport function xmlToJson(xml: any): any {\r\n    // Create the return object\r\n    let obj: any = {};\r\n\r\n    if (xml.nodeType === 1) {\r\n        // element\r\n        // do attributes\r\n        if (xml.attributes.length > 0) {\r\n            obj[\"@attributes\"] = {};\r\n            for (let j = 0; j < xml.attributes.length; j++) {\r\n                let attribute = xml.attributes.item(j);\r\n                obj[\"@attributes\"][attribute.nodeName] = attribute.nodeValue;\r\n            }\r\n        }\r\n    } else if (xml.nodeType === 3) {\r\n        // text\r\n        obj = xml.nodeValue;\r\n    }\r\n\r\n    // do children\r\n    if (xml.hasChildNodes()) {\r\n        for (let i = 0; i < xml.childNodes.length; i++) {\r\n            let item = xml.childNodes.item(i);\r\n            let nodeName = item.nodeName;\r\n            if (typeof obj[nodeName] === \"undefined\") {\r\n                obj[nodeName] = xmlToJson(item);\r\n            } else {\r\n                if (typeof obj[nodeName].push === \"undefined\") {\r\n                    let old = obj[nodeName];\r\n                    obj[nodeName] = [];\r\n                    obj[nodeName].push(old);\r\n                }\r\n                obj[nodeName].push(xmlToJson(item));\r\n            }\r\n        }\r\n    }\r\n    return obj;\r\n}\r\n\r\nexport const castType = {\r\n    string: function (v: any) {\r\n        return isEmpty(v) ? v : v.toString();\r\n    },\r\n\r\n    date: function (v: any) {\r\n        return isEmpty(v) ? v : new Date(v * 1000);\r\n    },\r\n\r\n    datetime: function (v: any) {\r\n        return isEmpty(v) ? v : new Date(v * 1000);\r\n    },\r\n\r\n    time: function (v: any) {\r\n        return isEmpty(v) ? v : parseInt(v);\r\n    },\r\n\r\n    integer: function (v: any) {\r\n        return isEmpty(v) ? v : parseInt(v);\r\n    },\r\n\r\n    float: function (v: any) {\r\n        return isEmpty(v) ? v : parseFloat(v);\r\n    },\r\n\r\n    boolean: function (str: any) {\r\n        if (str === null) {\r\n            return str;\r\n        }\r\n\r\n        if (typeof str === \"boolean\") {\r\n            if (str === true) {\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n        if (typeof str === \"string\") {\r\n            if (str === \"\") {\r\n                return false;\r\n            }\r\n            str = str.replace(/^\\s+|\\s+$/g, \"\");\r\n            if (str.toLowerCase() === \"true\" || str.toLowerCase() === \"yes\") {\r\n                return true;\r\n            }\r\n            str = str.replace(/,/g, \".\");\r\n            str = str.replace(/^\\s*\\-\\s*/g, \"-\");\r\n        }\r\n        if (!isNaN(str)) {\r\n            return parseFloat(str) !== 0;\r\n        }\r\n        return false;\r\n    }\r\n};\r\n\r\nexport function base64toBlob(base64Data: string, contentType: string = \"\"): Blob {\r\n\r\n    let sliceSize = 1024;\r\n    let byteCharacters = atob(base64Data);\r\n    let bytesLength = byteCharacters.length;\r\n    let slicesCount = Math.ceil(bytesLength / sliceSize);\r\n    let byteArrays = new Array(slicesCount);\r\n\r\n    for (let sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\r\n\r\n        let begin = sliceIndex * sliceSize;\r\n        let end = Math.min(begin + sliceSize, bytesLength);\r\n        let bytes = new Array(end - begin);\r\n\r\n        for (let offset = begin, i = 0; offset < end; ++i, ++offset) {\r\n            bytes[i] = byteCharacters[offset].charCodeAt(0);\r\n        }\r\n\r\n        byteArrays[sliceIndex] = new Uint8Array(bytes);\r\n    }\r\n    return new Blob(byteArrays, {type: contentType});\r\n}\r\n\r\nexport function base64StringToBlog(string: string): Blob {\r\n\r\n    let block = string.split(\";\");\r\n    let contentType = block[0].split(\":\")[1];\r\n    let data = block[1].split(\",\")[1];\r\n\r\n    return base64toBlob(data, contentType);\r\n}\r\n\r\n///**\r\n// *\r\n// * @param {LonLat} p\r\n// * @param {LonLat} v1\r\n// * @param {LonLat} v2\r\n// * @param {LonLat} v3\r\n// * @param {Array<Number>} res\r\n// */\r\n//export function cartesianToBarycentricLonLat(p, v1, v2, v3, res) {\r\n\r\n//    const y2y3 = v2.lat - v3.lat,\r\n//        x3x2 = v3.lon - v2.lon,\r\n//        x1x3 = v1.lon - v3.lon,\r\n//        y1y3 = v1.lat - v3.lat,\r\n//        y3y1 = v3.lat - v1.lat,\r\n//        xx3 = p.lon - v3.lon,\r\n//        yy3 = p.lat - v3.lat;\r\n\r\n//    const d = y2y3 * x1x3 + x3x2 * y1y3,\r\n//        lambda1 = (y2y3 * xx3 + x3x2 * yy3) / d,\r\n//        lambda2 = (y3y1 * xx3 + x1x3 * yy3) / d;\r\n\r\n//    res[0] = lambda1;\r\n//    res[1] = lambda2;\r\n//    res[2] = 1 - lambda1 - lambda2;\r\n\r\n//    return 0 <= res[0] && res[0] <= 1 && 0 <= lambda1 && lambda1 <= 1 && 0 <= lambda2 && lambda2 <= 1;\r\n//};\r\n\r\n/**\r\n * Callback throttling\r\n * @param {any} func\r\n * @param {Number} limit\r\n * @param {boolean} [skip]\r\n */\r\nexport function throttle(func: Function, limit: number, skip: boolean = false) {\r\n    let lastFunc: any;\r\n    let lastRan: number = 0;\r\n    return function () {\r\n        const args = arguments;\r\n        if (!lastRan) {\r\n            func.apply(null, args);\r\n            lastRan = Date.now();\r\n        } else {\r\n            if (skip) {\r\n                clearTimeout(lastFunc);\r\n            }\r\n            lastFunc = setTimeout(() => {\r\n                if (Date.now() - lastRan >= limit) {\r\n                    func.apply(null, args);\r\n                    lastRan = Date.now();\r\n                }\r\n            }, limit - (Date.now() - lastRan));\r\n        }\r\n    };\r\n}\r\n\r\n/**\r\n *\r\n * y2-----Q12--------------Q22---\r\n * |       |     |          |\r\n * |       |     |          |\r\n * y-------|-----P----------|----\r\n * |       |     |          |\r\n * |       |     |          |\r\n * |       |     |          |\r\n * |       |     |          |\r\n * |       |     |          |\r\n * y1-----Q11----|---------Q21---\r\n *         |     |          |\r\n *         |     |          |\r\n *         x1    x          x2\r\n *\r\n *\r\n * @param {Number} x -\r\n * @param {Number} y -\r\n * @param {Number} fQ11 -\r\n * @param {Number} fQ21 -\r\n * @param {Number} fQ12 -\r\n * @param {Number} fQ22 -\r\n * @param {Number} [x1=0.0] -\r\n * @param {Number} [x2=1.0] -\r\n * @param {Number} [y1=0.0] -\r\n * @param {Number} [y2=1.0] -\r\n */\r\nexport function blerp(\r\n    x: number, y: number, fQ11: number, fQ21: number, fQ12: number, fQ22: number,\r\n    x1: number = 0.0, x2: number = 1.0, y1: number = 0.0, y2: number = 1.0): number {\r\n    return (\r\n        (fQ11 * (x2 - x) * (y2 - y) +\r\n            fQ21 * (x - x1) * (y2 - y) +\r\n            fQ12 * (x2 - x) * (y - y1) +\r\n            fQ22 * (x - x1) * (y - y1)) /\r\n        ((x2 - x1) * (y2 - y1))\r\n    );\r\n}\r\n\r\nexport function blerp2(x: number, y: number, fQ11: number, fQ21: number, fQ12: number, fQ22: number): number {\r\n    return (\r\n        fQ11 * (1.0 - x) * (1.0 - y) + fQ21 * x * (1.0 - y) + fQ12 * (1.0 - x) * y + fQ22 * x * y\r\n    );\r\n}\r\n\r\nexport function extractElevationTiles(rgbaData: number[] | TypedArray, outCurrenElevations: number[] | TypedArray, outChildrenElevations: number[][][] | TypedArray[][]) {\r\n    let destSize = Math.sqrt(outCurrenElevations.length) - 1;\r\n    let destSizeOne = destSize + 1;\r\n    let sourceSize = Math.sqrt(rgbaData.length / 4);\r\n    let dt = sourceSize / destSize;\r\n\r\n    let rightHeigh = 0,\r\n        bottomHeigh = 0;\r\n\r\n    for (\r\n        let k = 0, currIndex = 0, sourceDataLength = rgbaData.length / 4;\r\n        k < sourceDataLength;\r\n        k++\r\n    ) {\r\n        let height = rgbaData[k * 4];\r\n\r\n        let i = Math.floor(k / sourceSize),\r\n            j = k % sourceSize;\r\n\r\n        let tileX = Math.floor(j / destSize),\r\n            tileY = Math.floor(i / destSize);\r\n\r\n        let destArr = outChildrenElevations[tileY][tileX];\r\n\r\n        let ii = i % destSize,\r\n            jj = j % destSize;\r\n\r\n        let destIndex = (ii + tileY) * destSizeOne + jj + tileX;\r\n\r\n        destArr[destIndex] = height;\r\n\r\n        if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\r\n            outCurrenElevations[currIndex++] = height;\r\n        }\r\n\r\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\r\n            //current tile\r\n            rightHeigh = rgbaData[(k + 1) * 4];\r\n            let middleHeight = (height + rightHeigh) * 0.5;\r\n            destIndex = (ii + tileY) * destSizeOne + jj + 1;\r\n            destArr[destIndex] = middleHeight;\r\n\r\n            if ((i + tileY) % dt === 0) {\r\n                outCurrenElevations[currIndex++] = middleHeight;\r\n            }\r\n\r\n            //next right tile\r\n            let rightindex = (ii + tileY) * destSizeOne + ((jj + 1) % destSize);\r\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\r\n        }\r\n\r\n        if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\r\n            //current tile\r\n            bottomHeigh = rgbaData[(k + sourceSize) * 4];\r\n            let middleHeight = (height + bottomHeigh) * 0.5;\r\n            destIndex = (ii + 1) * destSizeOne + jj + tileX;\r\n            destArr[destIndex] = middleHeight;\r\n\r\n            if ((j + tileX) % dt === 0) {\r\n                outCurrenElevations[currIndex++] = middleHeight;\r\n            }\r\n\r\n            //next bottom tile\r\n            let bottomindex = ((ii + 1) % destSize) * destSizeOne + jj + tileX;\r\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\r\n        }\r\n\r\n        if (\r\n            (j + 1) % destSize === 0 &&\r\n            j !== sourceSize - 1 &&\r\n            (i + 1) % destSize === 0 &&\r\n            i !== sourceSize - 1\r\n        ) {\r\n            //current tile\r\n            let rightBottomHeight = rgbaData[(k + sourceSize + 1) * 4];\r\n            let middleHeight = (height + rightHeigh + bottomHeigh + rightBottomHeight) * 0.25;\r\n            destIndex = (ii + 1) * destSizeOne + (jj + 1);\r\n            destArr[destIndex] = middleHeight;\r\n\r\n            outCurrenElevations[currIndex++] = middleHeight;\r\n\r\n            //next right tile\r\n            let rightindex = (ii + 1) * destSizeOne;\r\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\r\n\r\n            //next bottom tile\r\n            let bottomindex = destSize;\r\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\r\n\r\n            //next right bottom tile\r\n            let rightBottomindex = 0;\r\n            outChildrenElevations[tileY + 1][tileX + 1][rightBottomindex] = middleHeight;\r\n        }\r\n    }\r\n}\r\n\r\nexport type TypedArray =\r\n    | Int8Array\r\n    | Uint8Array\r\n    | Uint8ClampedArray\r\n    | Int16Array\r\n    | Uint16Array\r\n    | Int32Array\r\n    | Uint32Array\r\n    | Float32Array\r\n    | Float64Array;\r\n\r\n/**\r\n * Concatenates two the same type arrays\r\n * @param {TypedArray} a\r\n * @param {TypedArray | number[]} b\r\n */\r\nexport function concatTypedArrays(a: TypedArray, b: TypedArray | number[]): TypedArray {\r\n    let c = new (a as any).constructor(a.length + b.length); //hacky\r\n    c.set(a, 0);\r\n    c.set(b, a.length);\r\n    return c;\r\n}\r\n\r\n/**\r\n * Concatenates two the same  arrays\r\n * @param {TypedArray | number[]} [a=[]] - First array\r\n * @param {TypedArray | number[]} [b=[]] - Second array\r\n * @return {TypedArray | number[]} -\r\n */\r\nexport function concatArrays(a: TypedArray | number[] = [], b: TypedArray | number[] = []): TypedArray | number[] {\r\n    if (ArrayBuffer.isView(a)) {\r\n        return concatTypedArrays(a as TypedArray, b as TypedArray);\r\n    } else {\r\n        for (let i = 0; i < b.length; i++) {\r\n            a.push(b[i]);\r\n        }\r\n        return a;\r\n    }\r\n}\r\n\r\n/**\r\n * Convert simple array to typed\r\n * @param arr {number[]}\r\n * @param ctor {Float32Array}\r\n * @returns {TypedArray}\r\n */\r\nexport function makeArrayTyped(arr: TypedArray | number[], ctor: Function = Float32Array) {\r\n    if (!ArrayBuffer.isView(arr)) {\r\n        const typedArr = new (ctor as any)(arr.length); //hacky\r\n        typedArr.set(arr, 0);\r\n        return typedArr;\r\n    } else {\r\n        return arr;\r\n    }\r\n}\r\n\r\n/**\r\n * Convert typed array to array\r\n * @param arr {TypedArray | number[]}\r\n * @returns {number[]}\r\n */\r\nexport function makeArray(arr: TypedArray | number[]): number[] {\r\n    if (ArrayBuffer.isView(arr)) {\r\n        return Array.from(arr);\r\n    } else {\r\n        return arr;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @param {TypedArray | Array} arr\r\n * @param {Number} starting\r\n * @param {Number} deleteCount\r\n * @param {{ result: number[] }} [out]\r\n */\r\n\r\nexport function spliceArray(arr: TypedArray | number[], starting: number, deleteCount: number, out?: {\r\n    result: number[]\r\n} | { result: TypedArray }): TypedArray | number[] {\r\n    if (ArrayBuffer.isView(arr)) {\r\n        if (starting < 0) {\r\n            deleteCount = Math.abs(starting);\r\n            starting += arr.length;\r\n        }\r\n        return spliceTypedArray(arr, starting, deleteCount, out as { result: TypedArray });\r\n    } else {\r\n        let res;\r\n        if (starting < 0) {\r\n            res = arr.splice(starting);\r\n        } else {\r\n            res = arr.splice(starting, deleteCount);\r\n        }\r\n        if (out) {\r\n            out.result = res;\r\n        }\r\n        return arr;\r\n    }\r\n}\r\n\r\n/**\r\n *\r\n * @param {TypedArray} arr\r\n * @param {Number} starting\r\n * @param {Number} deleteCount\r\n * @param {{ result: TypedArray }} [out]\r\n */\r\nexport function spliceTypedArray<T extends TypedArray>(arr: T, starting: number, deleteCount: number, out?: {\r\n    result: T\r\n}): T {\r\n    if (arr.length === 0) {\r\n        return arr;\r\n    }\r\n    const newSize = arr.length - deleteCount;\r\n    const splicedArray = new (arr as any).constructor(newSize); //hacky\r\n    splicedArray.set(arr.subarray(0, starting));\r\n    splicedArray.set(arr.subarray(starting + deleteCount), starting);\r\n    if (out) {\r\n        out.result = arr.subarray(starting, starting + deleteCount) as T;\r\n    }\r\n    return splicedArray;\r\n}\r\n\r\n/**\r\n * Returns 64-bit triangle coordinate array from inside of the source triangle array.\r\n * @static\r\n * @param {TypedArray | number[]} sourceArr - Source array\r\n * @param {number} gridSize - Source array square matrix size\r\n * @param {number} i0 - First row index source array matrix\r\n * @param {number} j0 - First column index\r\n * @param {number} size - Square matrix result size.\r\n * @return {Float64Array} Triangle coordinates array from the source array.\r\n * @TODO: optimization\r\n */\r\nexport function getMatrixSubArray64(sourceArr: TypedArray | number[], gridSize: number, i0: number, j0: number, size: number): Float64Array {\r\n\r\n    const size_1 = size + 1;\r\n    const i0size = i0 + size_1;\r\n    const j0size = j0 + size_1;\r\n\r\n    let res = new Float64Array(size_1 * size_1 * 3);\r\n    let vInd = 0;\r\n\r\n    for (let i = i0; i < i0size; i++) {\r\n        for (let j = j0; j < j0size; j++) {\r\n\r\n            let ind = 3 * (i * (gridSize + 1) + j);\r\n\r\n            res[vInd++] = sourceArr[ind];\r\n            res[vInd++] = sourceArr[ind + 1];\r\n            res[vInd++] = sourceArr[ind + 2];\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\n/**\r\n * Returns 32-bit triangle coordinate array from inside of the source triangle array.\r\n * @static\r\n * @param {TypedArray | number[]} sourceArr - Source array\r\n * @param {number} gridSize - Source array square matrix size\r\n * @param {number} i0 - First row index source array matrix\r\n * @param {number} j0 - First column index\r\n * @param {number} size - Square matrix result size.\r\n * @return {Float32Array} Triangle coordinates array from the source array.\r\n */\r\nexport function getMatrixSubArray32(sourceArr: TypedArray | number[], gridSize: number, i0: number, j0: number, size: number): Float32Array {\r\n\r\n    const size_1 = size + 1;\r\n    const i0size = i0 + size_1;\r\n    const j0size = j0 + size_1;\r\n\r\n    let res = new Float32Array(size_1 * size_1 * 3);\r\n    let vInd = 0;\r\n\r\n    for (let i = i0; i < i0size; i++) {\r\n        for (let j = j0; j < j0size; j++) {\r\n\r\n            let ind = 3 * (i * (gridSize + 1) + j);\r\n\r\n            res[vInd++] = sourceArr[ind];\r\n            res[vInd++] = sourceArr[ind + 1];\r\n            res[vInd++] = sourceArr[ind + 2];\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\n/**\r\n * Returns two float32 triangle coordinate arrays from inside of the source triangle array.\r\n * @TODO: optimization\r\n */\r\nexport function getMatrixSubArrayBoundsExt(\r\n    sourceArr: TypedArray | number[],\r\n    sourceArrHigh: TypedArray | number[],\r\n    sourceArrLow: TypedArray | number[],\r\n    noDataVertices: TypedArray | number[] | undefined,\r\n    gridSize: number,\r\n    i0: number,\r\n    j0: number,\r\n    size: number,\r\n    outArr: TypedArray | number[],\r\n    outArrHigh: TypedArray | number[],\r\n    outArrLow: TypedArray | number[],\r\n    outBounds: any,\r\n    outNoDataVertices: TypedArray | number[]\r\n) {\r\n    const i0size = i0 + size + 1;\r\n    const j0size = j0 + size + 1;\r\n\r\n    gridSize += 1;\r\n\r\n    let vInd = 0,\r\n        nInd = 0;\r\n\r\n    for (let i = i0; i < i0size; i++) {\r\n        for (let j = j0; j < j0size; j++) {\r\n            let indBy3 = i * gridSize + j,\r\n                ind = 3 * indBy3;\r\n\r\n            let x = sourceArr[ind],\r\n                y = sourceArr[ind + 1],\r\n                z = sourceArr[ind + 2];\r\n\r\n            if (!noDataVertices || noDataVertices[indBy3] === 0) {\r\n                if (x < outBounds.xmin) outBounds.xmin = x;\r\n                if (x > outBounds.xmax) outBounds.xmax = x;\r\n                if (y < outBounds.ymin) outBounds.ymin = y;\r\n                if (y > outBounds.ymax) outBounds.ymax = y;\r\n                if (z < outBounds.zmin) outBounds.zmin = z;\r\n                if (z > outBounds.zmax) outBounds.zmax = z;\r\n            } else {\r\n                outNoDataVertices[nInd] = 1;\r\n            }\r\n\r\n            nInd++;\r\n\r\n            outArr[vInd] = x;\r\n            outArrLow[vInd] = sourceArrLow[ind];\r\n            outArrHigh[vInd++] = sourceArrHigh[ind];\r\n\r\n            outArr[vInd] = y;\r\n            outArrLow[vInd] = sourceArrLow[ind + 1];\r\n            outArrHigh[vInd++] = sourceArrHigh[ind + 1];\r\n\r\n            outArr[vInd] = z;\r\n            outArrLow[vInd] = sourceArrLow[ind + 2];\r\n            outArrHigh[vInd++] = sourceArrHigh[ind + 2];\r\n        }\r\n    }\r\n}\r\n\r\nexport function cloneArray(items: any[]): any[] {\r\n    return items.map((item) => (Array.isArray(item) ? cloneArray(item) : item));\r\n}\r\n\r\n/**\r\n * Promise for load images\r\n * @function\r\n * @param {string} url - link to image.\r\n * @returns {Promise<Image>} Returns promise.\r\n */\r\nexport async function loadImage(url: string): Promise<HTMLImageElement> {\r\n    return new Promise<HTMLImageElement>(resolve => {\r\n        const image = new Image();\r\n        image.addEventListener('load', () => {\r\n            resolve(image);\r\n        });\r\n        image.src = url;\r\n        image.crossOrigin = \"\"\r\n        return image;\r\n    });\r\n}\r\n\r\n/**\r\n * Gets image is loaded\r\n * @param {HTMLImageElement} image\r\n * @returns {boolean} Returns true is the image is loaded\r\n */\r\nexport function isImageLoaded(image: HTMLImageElement): boolean {\r\n    return image.complete && image.naturalHeight !== 0;\r\n}\r\n\r\nexport function distanceFormat(v: number): string {\r\n    if (v > 1000) {\r\n        return `${(v / 1000).toFixed(2)} km`;\r\n    } else if (v > 9) {\r\n        return `${Math.round(v)} m`;\r\n    } else {\r\n        return `${v.toFixed(1)} m`;\r\n    }\r\n}\r\n\r\nexport function distanceFormatExt(v: number): [string, string] {\r\n    if (v > 1000) {\r\n        let d = v - Math.floor(v);\r\n        if (d !== 0) {\r\n            return [(v / 1000).toFixed(2), \"km\"];\r\n        }\r\n        return [(v / 1000).toFixed(0), \"km\"]\r\n    } else if (v > 9) {\r\n        return [Math.round(v).toString(), \"m\"];\r\n    } else {\r\n        if (v <= 0.01) {\r\n            return [\"0\", \"m\"]\r\n        }\r\n        return [v.toFixed(1), \"m\"];\r\n    }\r\n}\r\n\r\nexport function getUrlParam(paramName: string): number | undefined {\r\n    let urlParams = new URLSearchParams(location.search);\r\n    let param = urlParams.get(paramName);\r\n    if (param) {\r\n        return Number(param);\r\n    }\r\n}\r\n\r\n\r\n/**\r\n *\r\n * @param x\r\n * @param y\r\n * @param z\r\n * @param imageSize\r\n * @param ellipsoid\r\n *\r\n * console.log(1, getTileImageResolution(0, 0, 1));\r\n * console.log(7, getTileImageResolution(66, 44, 7));\r\n * console.log(10, getTileImageResolution(536, 358, 10));\r\n * console.log(12, getTileImageResolution(2149, 1446, 12));\r\n * console.log(13, getTileImageResolution(4301, 2892, 13));\r\n * console.log(14, getTileImageResolution(8582, 5736, 14));\r\n * console.log(15, getTileImageResolution(17205, 11569, 15));\r\n * console.log(16, getTileImageResolution(34419, 23138, 16));\r\n * console.log(17, getTileImageResolution(68661, 45892, 17));\r\n * console.log(18, getTileImageResolution(137650, 92555, 18));\r\n */\r\nexport function getTileImageResolution(x: number, y: number, z: number, imageSize = 256, ellipsoid: Ellipsoid = wgs84) {\r\n    let ext = mercator.getTileExtent(x, y, z);\r\n    let b0 = ext.getSouthWest().inverseMercator(),\r\n        b1 = ext.getNorthEast().inverseMercator();\r\n    let width = ellipsoid.getGreatCircleDistance(b0, new LonLat(b1.lon, b0.lat)),\r\n        height = ellipsoid.getGreatCircleDistance(b0, new LonLat(b0.lon, b1.lat));\r\n\r\n    return [width / imageSize, height / imageSize];\r\n}\r\n\r\nexport function toFixedMax(value: number, maxFixed: number = -1): string {\r\n    if (maxFixed < 0) {\r\n        return value.toString();\r\n    }\r\n    const factor = Math.pow(10, maxFixed);\r\n    return (Math.round(value * factor) / factor).toString();\r\n}","import {binarySearch} from \"../utils/shared\";\r\n\r\nexport type JulianDate = number;\r\n\r\n/**\r\n * Seconds in millisecond.\r\n * @const\r\n */\r\nexport const SECONDS_PER_MILLISECOND = 0.001;\r\n\r\n/**\r\n * Milliseconds in second.\r\n * @const\r\n */\r\nexport const MILLISECONDS_PER_SECOND = 1000.0;\r\n\r\n/**\r\n * Seconds in minute.\r\n * @const\r\n */\r\nexport const SECONDS_PER_MINUTE = 60.0;\r\n\r\n/**\r\n * One by seconds in minute.\r\n * @const\r\n */\r\nexport const ONE_BY_SECONDS_PER_MINUTE = 1.0 / SECONDS_PER_MINUTE;\r\n\r\n/**\r\n * Minutes in hour.\r\n * @const\r\n */\r\nexport const MINUTES_PER_HOUR = 60.0;\r\n\r\n/**\r\n * Hours in day.\r\n * @const\r\n */\r\nexport const HOURS_PER_DAY = 24.0;\r\n\r\n/**\r\n * One by hours in day.\r\n * @const\r\n */\r\nexport const ONE_BY_HOURS_PER_DAY = 1.0 / HOURS_PER_DAY;\r\n\r\n/**\r\n * Seconds in hour.\r\n * @const\r\n */\r\nexport const SECONDS_PER_HOUR = 3600.0;\r\n\r\n/**\r\n * One by seconds in hour.\r\n * @const\r\n */\r\nexport const ONE_BY_SECONDS_PER_HOUR = 1.0 / SECONDS_PER_HOUR;\r\n\r\n/**\r\n * Seconds in 12 hours.\r\n * @const\r\n */\r\nexport const SECONDS_PER_12_HOURS = 12.0 * SECONDS_PER_HOUR;\r\n\r\n/**\r\n * Minutes in day.\r\n * @const\r\n */\r\nexport const MINUTES_PER_DAY = 1440.0;\r\n\r\n/**\r\n * One by minutes in day.\r\n * @const\r\n */\r\nexport const ONE_BY_MINUTES_PER_DAY = 1.0 / MINUTES_PER_DAY;\r\n\r\n/**\r\n * Seconds in day.\r\n * @const\r\n */\r\nexport const SECONDS_PER_DAY = 86400.0;\r\n\r\n/**\r\n * Milliseconds in day.\r\n * @const\r\n */\r\nexport const MILLISECONDS_PER_DAY = 86400000.0;\r\n\r\n/**\r\n * One by milliseconds in day.\r\n * @const\r\n */\r\nexport const ONE_BY_MILLISECONDS_PER_DAY = 1.0 / MILLISECONDS_PER_DAY;\r\n\r\n/**\r\n * One by seconds in day.\r\n * @const\r\n */\r\nexport const ONE_BY_SECONDS_PER_DAY = 1.0 / SECONDS_PER_DAY;\r\n\r\n/**\r\n * Days in julian century.\r\n * @const\r\n */\r\nexport const DAYS_PER_JULIAN_CENTURY = 36525.0;\r\n\r\n/**\r\n * Days in julian year.\r\n * @const\r\n */\r\nexport const DAYS_PER_JULIAN_YEAR = 365.25;\r\n\r\n/**\r\n * Seconds in picoseconds.\r\n * @const\r\n */\r\nexport const PICOSECOND = 0.000000001;\r\n\r\n/**\r\n * Modified julian date difference.\r\n * @const\r\n */\r\nexport const MODIFIED_JULIAN_DATE_DIFFERENCE = 2400000.5;\r\n\r\n/**\r\n * Julian date of 2000 year. Epoch.\r\n * @const\r\n */\r\nexport const J2000 = 2451545.0;\r\n\r\n/**\r\n * Returns julian days from Epoch.\r\n * @param {JulianDate} jd - Julian date.\r\n * @returns {number} Days from epoch\r\n */\r\nexport function T(jd: JulianDate): number {\r\n    return (jd - J2000) / DAYS_PER_JULIAN_CENTURY;\r\n}\r\n\r\n/**\r\n * Gets the date's julian day.\r\n * @param {number} year - Year.\r\n * @param {number} month - Month.\r\n * @param {number} day - Day.\r\n * @returns {number} Day number\r\n */\r\nexport function getDayNumber(year: number, month: number, day: number): number {\r\n    let a = ((month - 14) / 12) | 0;\r\n    let b = year + 4800 + a;\r\n    return (\r\n        (((1461 * b) / 4) | 0) +\r\n        (((367 * (month - 2 - 12 * a)) / 12) | 0) -\r\n        (((3 * (((b + 100) / 100) | 0)) / 4) | 0) +\r\n        day -\r\n        32075\r\n    );\r\n}\r\n\r\n/**\r\n * Converts javascript date to the universal(UTC) julian date.\r\n * @param {Date} date - Date.\r\n * @returns {JulianDate} UTC julian date\r\n */\r\nexport function DateToUTC(date: Date): JulianDate {\r\n    let dayNumber = getDayNumber(date.getUTCFullYear(), date.getUTCMonth() + 1, date.getUTCDate());\r\n\r\n    let hour = date.getUTCHours() - 12;\r\n    if (hour < 0) {\r\n        hour += 24;\r\n    }\r\n\r\n    let secondsOfDay =\r\n        date.getUTCSeconds() +\r\n        hour * SECONDS_PER_HOUR +\r\n        date.getUTCMinutes() * SECONDS_PER_MINUTE +\r\n        date.getUTCMilliseconds() * SECONDS_PER_MILLISECOND;\r\n\r\n    if (secondsOfDay >= SECONDS_PER_12_HOURS) {\r\n        dayNumber--;\r\n    }\r\n\r\n    let extraDays = (secondsOfDay * ONE_BY_SECONDS_PER_DAY) | 0;\r\n    dayNumber += extraDays;\r\n    secondsOfDay -= SECONDS_PER_DAY * extraDays;\r\n\r\n    if (secondsOfDay < 0) {\r\n        dayNumber--;\r\n        secondsOfDay += SECONDS_PER_DAY;\r\n    }\r\n\r\n    return dayNumber + secondsOfDay * ONE_BY_SECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Converts javascript date to the atomic(TAI) julian date.\r\n * @param {Date} date - Date.\r\n * @returns {JulianDate} TAI julian date\r\n */\r\nexport function DateToTAI(date: Date): JulianDate {\r\n    return UTCtoTAI(DateToUTC(date));\r\n}\r\n\r\n/**\r\n * Converts coordinated universal(UTC) julian date to atomic(TAI) julian date.\r\n * @param {JulianDate} jd - UTC julian date.\r\n * @returns {JulianDate} TAI julian date\r\n */\r\nexport function UTCtoTAI(jd: JulianDate): JulianDate {\r\n    let leapSeconds = leapSecondsTable;\r\n\r\n    let index = binarySearch(leapSeconds, jd, function (a: number, b: LeapSeconds) {\r\n        return a - b.jd;\r\n    });\r\n\r\n    if (index < 0) {\r\n        index = ~index;\r\n    }\r\n\r\n    if (index >= leapSeconds.length) {\r\n        index = leapSeconds.length - 1;\r\n    }\r\n\r\n    let offset = leapSeconds[index].leapSeconds;\r\n\r\n    if (index !== 0) {\r\n        if ((leapSeconds[index].jd - jd) * SECONDS_PER_DAY > offset) {\r\n            offset = leapSeconds[index - 1].leapSeconds;\r\n        }\r\n    }\r\n\r\n    return jd + offset * ONE_BY_SECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Converts atomic julian date(TAI) to the coordinated universal(UTC) julian date.\r\n * @param {JulianDate} tai - TAI julian date.\r\n * @returns {JulianDate | undefined} UTC julian date\r\n */\r\nexport function TAItoUTC(tai: JulianDate): JulianDate | undefined {\r\n    let leapSeconds = leapSecondsTable;\r\n    let index = binarySearch(leapSeconds, tai, function (a: JulianDate, b: LeapSeconds) {\r\n        return a - b.jd;\r\n    });\r\n\r\n    if (index < 0) {\r\n        index = ~index;\r\n    }\r\n\r\n    if (index >= leapSeconds.length) {\r\n        return tai - leapSeconds[index - 1].leapSeconds * ONE_BY_SECONDS_PER_DAY;\r\n    }\r\n\r\n    if (index === 0) {\r\n        return tai - leapSeconds[0].leapSeconds * ONE_BY_SECONDS_PER_DAY;\r\n    }\r\n\r\n    let diff = (leapSeconds[index].jd - tai) * SECONDS_PER_DAY;\r\n\r\n    if (diff === 0) {\r\n        return tai - leapSeconds[index].leapSeconds * ONE_BY_SECONDS_PER_DAY;\r\n    }\r\n\r\n    if (diff <= 1.0) {\r\n        return;\r\n    }\r\n\r\n    return tai - leapSeconds[index - 1].leapSeconds * ONE_BY_SECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Converts UTC julian date to the javascript date object.\r\n * @param {JulianDate} utc - UTC julian date.\r\n * @returns {Date} JavaScript Date object\r\n */\r\nexport function UTCtoDate(utc: JulianDate): Date {\r\n    let julianDayNumber = utc | 0;\r\n    let secondsOfDay = (utc - julianDayNumber) * SECONDS_PER_DAY;\r\n\r\n    if (secondsOfDay >= SECONDS_PER_12_HOURS) {\r\n        julianDayNumber++;\r\n    }\r\n\r\n    let L = (julianDayNumber + 68569) | 0;\r\n    let N = ((4 * L) / 146097) | 0;\r\n    L = (L - (((146097 * N + 3) / 4) | 0)) | 0;\r\n    let I = ((4000 * (L + 1)) / 1461001) | 0;\r\n    L = (L - (((1461 * I) / 4) | 0) + 31) | 0;\r\n    let J = ((80 * L) / 2447) | 0;\r\n    let day = (L - (((2447 * J) / 80) | 0)) | 0;\r\n    L = (J / 11) | 0;\r\n    let month = (J + 2 - 12 * L) | 0;\r\n    let year = (100 * (N - 49) + I + L) | 0;\r\n\r\n    let hour = (secondsOfDay * ONE_BY_SECONDS_PER_HOUR) | 0;\r\n    let remainingSeconds = secondsOfDay - hour * SECONDS_PER_HOUR;\r\n    let minute = (remainingSeconds * ONE_BY_SECONDS_PER_MINUTE) | 0;\r\n    remainingSeconds = remainingSeconds - minute * SECONDS_PER_MINUTE;\r\n    let second = remainingSeconds | 0;\r\n    let millisecond = ((remainingSeconds - second) * MILLISECONDS_PER_SECOND) | 0;\r\n\r\n    hour += 12;\r\n    if (hour > 23) {\r\n        hour -= 24;\r\n    }\r\n\r\n    return new Date(Date.UTC(year, month - 1, day, hour, minute, second, millisecond));\r\n}\r\n\r\n/**\r\n * Converts TAI julian date to the javascript date object.\r\n * @param {JulianDate} tai - TAI julian date.\r\n * @returns {Date} JavaScript Date object\r\n */\r\nexport function TAItoDate(tai: JulianDate): Date {\r\n    let utc = TAItoUTC(tai);\r\n    if (!utc) {\r\n        utc = TAItoUTC(addSeconds(tai, -1))!;\r\n        console.trace(`TAItoDate - can't convert ${tai.toString()} to utc.`);\r\n    }\r\n\r\n    return UTCtoDate(utc);\r\n}\r\n\r\n/**\r\n * Adds milliseconds to the julian date.\r\n * @param {JulianDate} jd - Julian date.\r\n * @param {number} milliseconds - Milliseconds to add.\r\n * @returns {JulianDate} Julian date\r\n */\r\nexport function addMilliseconds(jd: JulianDate, milliseconds: number): JulianDate {\r\n    return jd + milliseconds * ONE_BY_MILLISECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Adds seconds to the julian date.\r\n * @param {JulianDate} jd - Julian date.\r\n * @param {number} seconds - Seconds to add.\r\n * @returns {JulianDate} Julian date\r\n */\r\nexport function addSeconds(jd: JulianDate, seconds: number): JulianDate {\r\n    return jd + seconds * ONE_BY_SECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Adds hours to the julian date.\r\n * @param {JulianDate} jd - Julian date.\r\n * @param {number} hours - Hours to add.\r\n * @returns {JulianDate} Julian date\r\n */\r\nexport function addHours(jd: JulianDate, hours: number): JulianDate {\r\n    return jd + hours * ONE_BY_HOURS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Adds minutes to the julian date.\r\n * @param {JulianDate} jd - Julian date.\r\n * @param {number} minutes - Minutes to add.\r\n * @returns {JulianDate} Julian date\r\n */\r\nexport function addMinutes(jd: JulianDate, minutes: number): JulianDate {\r\n    return jd + minutes * MINUTES_PER_DAY;\r\n}\r\n\r\n/**\r\n * Adds days to the julian date.\r\n * @param {JulianDate} jd - Julian date.\r\n * @param {number} days - Days to add.\r\n * @returns {JulianDate} Julian date\r\n */\r\nexport function addDays(jd: JulianDate, days: number): JulianDate {\r\n    return jd + days;\r\n}\r\n\r\n/**\r\n * Gets milliseconds of a julian date.\r\n * @param {JulianDate} jd - julian date.\r\n * @returns {number} Milliseconds\r\n */\r\nexport function getMilliseconds(jd: JulianDate): number {\r\n    let s = jd - (jd | 0);\r\n    s *= SECONDS_PER_DAY;\r\n    return ((s - (s | 0)) * MILLISECONDS_PER_SECOND) | 0;\r\n}\r\n\r\n/**\r\n * Gets seconds of a julian date.\r\n * @param {JulianDate} jd - julian date.\r\n * @returns {number} Seconds\r\n */\r\nexport function getSeconds(jd: JulianDate): number {\r\n    let s = jd - (jd | 0);\r\n    return s * SECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Gets hours of a julian date.\r\n * @param {JulianDate} jd - julian date.\r\n * @returns {number} Hours\r\n */\r\nexport function getHours(jd: JulianDate): number {\r\n    let julianDayNumber = jd | 0;\r\n    let secondsOfDay = (jd - julianDayNumber) * SECONDS_PER_DAY;\r\n\r\n    let hour = (secondsOfDay * ONE_BY_SECONDS_PER_HOUR) | 0;\r\n    let remainingSeconds = secondsOfDay - hour * SECONDS_PER_HOUR;\r\n    let minute = (remainingSeconds * ONE_BY_SECONDS_PER_MINUTE) | 0;\r\n    remainingSeconds = remainingSeconds - minute * SECONDS_PER_MINUTE;\r\n    let second = remainingSeconds | 0;\r\n    let millisecond = ((remainingSeconds - second) * MILLISECONDS_PER_SECOND) | 0;\r\n\r\n    hour += 12 + minute / 60 + second / 3600 + millisecond / 1000;\r\n    if (hour > 23) {\r\n        hour -= 24;\r\n    }\r\n\r\n    return hour;\r\n}\r\n\r\n/**\r\n * Gets minutes of a julian date.\r\n * @param {JulianDate} jd - julian date.\r\n * @returns {number} Minutes\r\n */\r\nexport function getMinutes(jd: JulianDate): number {\r\n    let s = jd - (jd | 0);\r\n    return (s * MINUTES_PER_DAY) | 0;\r\n}\r\n\r\n/**\r\n * Gets days of a julian date.\r\n * @param {JulianDate} jd - julian date.\r\n * @returns {number} Days\r\n */\r\nexport function getDays(jd: JulianDate): number {\r\n    return jd | 0;\r\n}\r\n\r\n/**\r\n * Returns days in seconds.\r\n * @param {number} s - Seconds.\r\n * @returns {number} Days\r\n */\r\nexport function secondsToDays(s: number): number {\r\n    return s * ONE_BY_SECONDS_PER_DAY;\r\n}\r\n\r\n/**\r\n * Returns seconds in days.\r\n * @param {number} d - Days.\r\n * @returns {number} Seconds\r\n */\r\nexport function daysToSeconds(d: number): number {\r\n    return d * SECONDS_PER_DAY;\r\n}\r\n\r\ntype LeapSeconds = { jd: JulianDate, leapSeconds: number };\r\n\r\nfunction __ls(jd: JulianDate, leapSeconds: number): LeapSeconds {\r\n    return {\r\n        jd: jd,\r\n        leapSeconds: leapSeconds\r\n    };\r\n}\r\n\r\nconst leapSecondsTable: LeapSeconds[] = [\r\n    __ls(2441317.5, 10.0), // 1972-01-01T00:00:00.000Z\r\n    __ls(2441499.5, 11.0), // 1972-07-01T00:00:00.000Z\r\n    __ls(2441683.5, 12.0), // 1973-01-01T00:00:00.000Z\r\n    __ls(2442048.5, 13.0), // 1974-01-01T00:00:00.000Z\r\n    __ls(2442413.5, 14.0), // 1975-01-01T00:00:00.000Z\r\n    __ls(2442778.5, 15.0), // 1976-01-01T00:00:00.000Z\r\n    __ls(2443144.5, 16.0), // 1977-01-01T00:00:00.000Z\r\n    __ls(2443509.5, 17.0), // 1978-01-01T00:00:00.000Z\r\n    __ls(2443874.5, 18.0), // 1979-01-01T00:00:00.000Z\r\n    __ls(2444239.5, 19.0), // 1980-01-01T00:00:00.000Z\r\n    __ls(2444786.5, 20.0), // 1981-07-01T00:00:00.000Z\r\n    __ls(2445151.5, 21.0), // 1982-07-01T00:00:00.000Z\r\n    __ls(2445516.5, 22.0), // 1983-01-01T00:00:00.000Z\r\n    __ls(2446247.5, 23.0), // 1985-07-01T00:00:00.000Z\r\n    __ls(2447161.5, 24.0), // 1988-01-01T00:00:00.000Z\r\n    __ls(2447892.5, 25.0), // 1990-01-01T00:00:00.000Z\r\n    __ls(2448257.5, 26.0), // 1991-01-01T00:00:00.000Z\r\n    __ls(2448804.5, 27.0), // 1992-07-01T00:00:00.000Z\r\n    __ls(2449169.5, 28.0), // 1993-07-01T00:00:00.000Z\r\n    __ls(2449534.5, 29.0), // 1994-07-01T00:00:00.000Z\r\n    __ls(2450083.5, 30.0), // 1996-01-01T00:00:00.000Z\r\n    __ls(2450630.5, 31.0), // 1997-07-01T00:00:00.000Z\r\n    __ls(2451179.5, 32.0), // 1999-01-01T00:00:00.000Z\r\n    __ls(2453736.5, 33.0), // 2006-01-01T00:00:00.000Z\r\n    __ls(2454832.5, 34.0), // 2009-01-01T00:00:00.000Z\r\n    __ls(2456109.5, 35.0), // 2012-07-01T00:00:00.000Z\r\n    __ls(2457204.5, 36.0) // 2015-07-01T00:00:00.000Z\r\n];\r\n\r\nexport const J2000TAI = UTCtoTAI(J2000);\r\n","import {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray6} from \"./Sphere\";\r\nimport {Ellipsoid} from \"../ellipsoid/Ellipsoid\";\r\nimport {Extent} from \"../Extent\";\r\n\r\ntype Vec3Array8 = [Vec3, Vec3, Vec3, Vec3, Vec3, Vec3, Vec3, Vec3];\r\n\r\n/**\r\n * Bounding box class.\r\n * @class\r\n * @param {NumberArray6} [boundsArr]\r\n */\r\nclass Box {\r\n\r\n    /**\r\n     * Vertices array.\r\n     * @public\r\n     * @type{Array.<Vec3>}\r\n     */\r\n    public vertices: Vec3Array8\r\n\r\n    constructor(boundsArr?: NumberArray6) {\r\n\r\n        this.vertices = [\r\n            new Vec3(),\r\n            new Vec3(),\r\n            new Vec3(),\r\n            new Vec3(),\r\n            new Vec3(),\r\n            new Vec3(),\r\n            new Vec3(),\r\n            new Vec3()\r\n        ];\r\n\r\n        if (boundsArr) {\r\n            this.setFromBoundsArr(boundsArr);\r\n        }\r\n    }\r\n\r\n    public copy(bbox: Box) {\r\n        for (let i = 0, len = this.vertices.length; i < len; i++) {\r\n            this.vertices[i].copy(bbox.vertices[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets bounding box coordinates by the bounds array.\r\n     * @param {NumberArray6} bounds - Bounds is an array where [minX, minY, minZ, maxX, maxY, maxZ]\r\n     */\r\n    public setFromBoundsArr(bounds: NumberArray6) {\r\n        let xmin = bounds[0],\r\n            xmax = bounds[3],\r\n            ymin = bounds[1],\r\n            ymax = bounds[4],\r\n            zmin = bounds[2],\r\n            zmax = bounds[5];\r\n\r\n        let v = this.vertices;\r\n\r\n        v[0].set(xmin, ymin, zmin);\r\n        v[1].set(xmax, ymin, zmin);\r\n        v[2].set(xmax, ymin, zmax);\r\n        v[3].set(xmin, ymin, zmax);\r\n        v[4].set(xmin, ymax, zmin);\r\n        v[5].set(xmax, ymax, zmin);\r\n        v[6].set(xmax, ymax, zmax);\r\n        v[7].set(xmin, ymax, zmax);\r\n    }\r\n\r\n    /**\r\n     * Sets bounding box coordinates by ellipsoid geodetic extend.\r\n     * @param {Ellipsoid} ellipsoid - Ellipsoid.\r\n     * @param {Extent} extent - Geodetic extent.\r\n     */\r\n    public setFromExtent(ellipsoid: Ellipsoid, extent: Extent) {\r\n        this.setFromBoundsArr(extent.getCartesianBounds(ellipsoid));\r\n    }\r\n}\r\n\r\nexport {Box};\r\n\r\n","import {Vec3} from \"../math/Vec3\";\r\nimport {Ellipsoid} from \"../ellipsoid/Ellipsoid\";\r\nimport {Extent} from \"../Extent\";\r\n\r\nexport type NumberArray6 = [number, number, number, number, number, number];\r\n\r\n/**\r\n * Bounding sphere class.\r\n * @class\r\n * @param {Number} [radius] - Bounding sphere radius.\r\n * @param {Vec3} [center] - Bounding sphere coordinates.\r\n */\r\nclass Sphere {\r\n    /**\r\n     * Sphere radius.\r\n     * @public\r\n     * @type {Number}\r\n     */\r\n    public radius: number;\r\n\r\n    /**\r\n     * Sphere coordinates.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public center: Vec3;\r\n\r\n    constructor(radius: number = 0, center?: Vec3) {\r\n\r\n        this.radius = radius;\r\n\r\n        this.center = center ? center.clone() : new Vec3();\r\n    }\r\n\r\n    /**\r\n     * Sets bounding sphere coordinates by the bounds array.\r\n     * @param {Array.<number>} bounds - Bounds is an array where [minX, minY, minZ, maxX, maxY, maxZ]\r\n     */\r\n    public setFromBounds(bounds: NumberArray6) {\r\n        let m = new Vec3(bounds[0], bounds[1], bounds[2]);\r\n        this.center.set(\r\n            m.x + (bounds[3] - m.x) * 0.5,\r\n            m.y + (bounds[3] - m.y) * 0.5,\r\n            m.z + (bounds[5] - m.z) * 0.5\r\n        );\r\n        this.radius = this.center.distance(m);\r\n    }\r\n\r\n    /**\r\n     * Sets bounding sphere coordinates by ellipsoid geodetic extend.\r\n     * @param {Ellipsoid} ellipsoid - Ellipsoid.\r\n     * @param {Extent} extent - Geodetic extent.\r\n     */\r\n    public setFromExtent(ellipsoid: Ellipsoid, extent: Extent) {\r\n        this.setFromBounds(extent.getCartesianBounds(ellipsoid));\r\n    }\r\n}\r\n\r\nexport {Sphere};\r\n","import {binaryInsert, stamp} from \"./utils/shared\";\r\n\r\nexport type EventCallback = (((...args: any[]) => boolean) | ((...args: any[]) => void));\r\n\r\nexport type EventCallbackStamp = EventCallback & { _openglobus_id?: number; _openglobus_priority?: number };\r\n\r\ntype EventCallbacks = Array<EventCallback>;\r\ntype EventCallbackHandler = { active: boolean; handlers: EventCallbacks };\r\n\r\nexport type EventsMap<T extends string[]> = {\r\n    [K in T[number]]?: EventCallbackHandler\r\n}\r\n\r\nexport type EventsHandler<T extends string[]> = Events<T> & EventsMap<T>;\r\n\r\nexport function createEvents<T extends string[]>(methodNames: T, sender?: any) {\r\n    return new Events(methodNames, sender) as EventsHandler<T>;\r\n}\r\n\r\n/**\r\n * Base events class to handle custom events.\r\n * @class\r\n * @param {Array.<string>} [eventNames] - Event names that could be dispatched.\r\n * @param {*} [sender]\r\n */\r\nexport class Events<T extends string[]> {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Registered event names.\r\n     * @protected\r\n     * @type {T}\r\n     */\r\n    protected _eventNames: T;\r\n\r\n    protected _sender: any;\r\n\r\n    /**\r\n     * Stop propagation flag\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _stopPropagation: boolean;\r\n    protected _stampCache: any;\r\n\r\n    constructor(eventNames: T, sender?: any) {\r\n\r\n        this.__id = Events.__counter__++;\r\n\r\n        this._eventNames = [] as any;\r\n\r\n        eventNames && this.registerNames(eventNames);\r\n\r\n        this._sender = sender || this;\r\n\r\n        this._stopPropagation = false;\r\n\r\n        this._stampCache = {};\r\n    }\r\n\r\n    public bindSender(sender?: any) {\r\n        this._sender = sender || this;\r\n    }\r\n\r\n    /**\r\n     * Function that creates event object properties that would be dispatched.\r\n     * @public\r\n     * @param {Array.<string>} eventNames - Specified event names list.\r\n     */\r\n    public registerNames(eventNames: T): this {\r\n        for (let i = 0; i < eventNames.length; i++) {\r\n            (this as any)[eventNames[i]] = {\r\n                active: true,\r\n                handlers: []\r\n            };\r\n            this._eventNames.push(eventNames[i]);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    protected _getStamp(name: string, id: number, ogid: number) {\r\n        return `${name}_${id}_${ogid}`;\r\n    }\r\n\r\n    /**\r\n     * Returns true if event callback has stamped.\r\n     * @protected\r\n     * @param {Object} name - Event identifier.\r\n     * @param {Object} obj - Event callback.\r\n     * @return {boolean} -\r\n     */\r\n    protected _stamp(name: string, obj: any) {\r\n        let ogid = stamp(obj);\r\n        let st = this._getStamp(name, this.__id, ogid);\r\n\r\n        if (!this._stampCache[st]) {\r\n            this._stampCache[st] = ogid;\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Attach listener.\r\n     * @public\r\n     * @param {string} name - Event name to listen.\r\n     * @param {EventCallback} callback - Event callback function.\r\n     * @param {any} [sender] - Event callback function owner.\r\n     * @param {number} [priority] - Priority of event callback.\r\n     */\r\n    public on(name: string, callback: EventCallback, sender?: any, priority: number = 0) {\r\n        if (this._stamp(name, callback)) {\r\n            if ((this as any)[name]) {\r\n                let c = callback.bind(sender || this._sender) as EventCallbackStamp;\r\n                c._openglobus_id = (callback as EventCallbackStamp)._openglobus_id;\r\n                c._openglobus_priority = priority;\r\n                binaryInsert((this as any)[name].handlers, c, (a: EventCallbackStamp, b: EventCallbackStamp) => {\r\n                    return (b._openglobus_priority || 0) - (a._openglobus_priority || 0);\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Stop listening event name with specified callback function.\r\n     * @public\r\n     * @param {string} name - Event name.\r\n     * @param {EventCallback | null} callback - Attached  event callback.\r\n     */\r\n    public off(name: string, callback?: EventCallback | null) {\r\n        if (callback) {\r\n            let st = this._getStamp(name, this.__id, (callback as EventCallbackStamp)._openglobus_id!);\r\n            if ((callback as EventCallbackStamp)._openglobus_id && this._stampCache[st]) {\r\n                let h = (this as any)[name].handlers;\r\n                let i = h.length;\r\n                let indexToRemove = -1;\r\n                while (i--) {\r\n                    let hi = h[i];\r\n                    if (hi._openglobus_id === (callback as EventCallbackStamp)._openglobus_id) {\r\n                        indexToRemove = i;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (indexToRemove !== -1) {\r\n                    h.splice(indexToRemove, 1);\r\n                    this._stampCache[st] = undefined;\r\n                    delete this._stampCache[st];\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dispatch event.\r\n     * @public\r\n     * @param {EventCallbackHandler} event - Event instance property that created by event name.\r\n     * @param {Object} [args] - Callback parameters.\r\n     */\r\n    public dispatch(event: EventCallbackHandler | undefined, ...args: any[]) {\r\n        let result = true;\r\n        if (event && event.active && !this._stopPropagation) {\r\n            let h = event.handlers.slice(0),\r\n                i = h.length;\r\n            while (i--) {\r\n                if ((h[i] as any)(...args) === false) {\r\n                    result = false;\r\n                }\r\n            }\r\n        }\r\n        this._stopPropagation = false;\r\n        return result;\r\n    }\r\n\r\n    /**\r\n     * Brakes events propagation.\r\n     * @public\r\n     */\r\n    public stopPropagation() {\r\n        this._stopPropagation = true;\r\n    }\r\n\r\n    /**\r\n     * Removes all events.\r\n     * @public\r\n     */\r\n    public clear() {\r\n        for (let i = 0; i < this._eventNames.length; i++) {\r\n            let e = (this as any)[this._eventNames[i]];\r\n            e.handlers.length = 0;\r\n            e.handlers = [];\r\n        }\r\n        this._eventNames.length = 0;\r\n        this._eventNames = [] as any;\r\n    }\r\n}\r\n","import {createEvents} from '../Events';\r\nimport type {EventCallback, EventsHandler} from '../Events';\r\nimport {parseHTML, stringTemplate} from '../utils/shared';\r\n\r\nexport interface IViewParams {\r\n    model?: any;\r\n    template?: string;\r\n    parent?: View<any> | null;\r\n    classList?: string[];\r\n    initRender?: boolean;\r\n}\r\n\r\nexport type ViewEventsList = [\"render\"];\r\nconst VIEW_EVENTS: ViewEventsList = [\"render\"];\r\n\r\nclass View<M> {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    public events: EventsHandler<ViewEventsList>;\r\n\r\n    public model: M;\r\n\r\n    public template: string;\r\n\r\n    public parent: View<any> | null;\r\n\r\n    public el: HTMLElement | null;\r\n\r\n    protected _classList: string[];\r\n\r\n    constructor(options: IViewParams = {}) {\r\n        this.__id = View.__counter__++;\r\n        this.events = createEvents<ViewEventsList>(VIEW_EVENTS);\r\n        this.model = options.model || null;\r\n        this.template = options.template || \"\";\r\n        this.parent = options.parent || null;\r\n        this._classList = options.classList || [];\r\n        this.el = null;\r\n        if (options.initRender) {\r\n            this.render();\r\n        }\r\n    }\r\n\r\n    public on(name: string, callback: EventCallback, sender?: any, priority?: number) {\r\n        this.events.on(name, callback, sender, priority);\r\n    }\r\n\r\n    public off(name: string, callback: EventCallback) {\r\n        this.events.off(name, callback);\r\n    }\r\n\r\n    static getHTML(template: string, params: any): string {\r\n        return stringTemplate(template, params);\r\n    }\r\n\r\n    static parseHTML(htmlStr: string): HTMLElement[] {\r\n        return parseHTML(htmlStr);\r\n    }\r\n\r\n    static insertAfter(newNodes: HTMLElement | HTMLElement[], referenceNode: Node): HTMLElement[] {\r\n        if (!Array.isArray(newNodes)) {\r\n            newNodes = [newNodes];\r\n        }\r\n        for (let i = 0; i < newNodes.length; i++) {\r\n            if (referenceNode.parentNode) {\r\n                referenceNode.parentNode.insertBefore(newNodes[i], referenceNode.nextSibling);\r\n            }\r\n        }\r\n        return newNodes;\r\n    }\r\n\r\n    static insertBefore(newNodes: HTMLElement | HTMLElement[], referenceNode: Node): HTMLElement[] {\r\n        if (!Array.isArray(newNodes)) {\r\n            newNodes = [newNodes];\r\n        }\r\n        for (let i = 0; i < newNodes.length; i++) {\r\n            if (referenceNode.parentNode) {\r\n                referenceNode.parentNode.insertBefore(newNodes[i], referenceNode);\r\n            }\r\n        }\r\n        return newNodes;\r\n    }\r\n\r\n    public insertBefore(view: View<any> | HTMLElement) {\r\n        if (!this.el) {\r\n            this.render();\r\n        }\r\n        if (this.el) {\r\n            if (view instanceof HTMLElement && view.parentNode) {\r\n                View.insertBefore(this.el, view);\r\n            }\r\n            if (view instanceof View && view.el && view.el.parentNode) {\r\n                View.insertBefore(this.el, view.el);\r\n            }\r\n        }\r\n    }\r\n\r\n    public insertAfter(view: View<any> | HTMLElement) {\r\n        if (!this.el) {\r\n            this.render();\r\n        }\r\n        if (this.el) {\r\n            if (view instanceof HTMLElement && view.parentNode) {\r\n                View.insertAfter(this.el, view);\r\n            }\r\n            if (view instanceof View && view.el && view.el.parentNode) {\r\n                View.insertAfter(this.el, view.el);\r\n            }\r\n        }\r\n    }\r\n\r\n    public isEqual(view: View<any>): boolean {\r\n        return view.__id === this.__id;\r\n    }\r\n\r\n    public appendTo(node: HTMLElement, clean: boolean = false, firstPosition: boolean = false) {\r\n        if (node) {\r\n            if (!this.el) {\r\n                this.beforeRender(node);\r\n                this.render();\r\n            }\r\n\r\n            if (this.el && this.el.parentNode) {\r\n                this.el.parentNode.removeChild(this.el);\r\n            }\r\n\r\n            if (clean) {\r\n                node.innerHTML = \"\";\r\n            }\r\n\r\n            if (this.el) {\r\n                if (firstPosition) {\r\n                    if (node.childNodes[0]) {\r\n                        View.insertBefore(this.el, node.childNodes[0]);\r\n                    } else {\r\n                        node.appendChild(this.el);\r\n                    }\r\n                } else {\r\n                    node.appendChild(this.el);\r\n                }\r\n            }\r\n            this.afterRender(node);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public afterRender(parentNode: HTMLElement) {\r\n    }\r\n\r\n    public beforeRender(parentNode: HTMLElement) {\r\n    }\r\n\r\n    public stopPropagation() {\r\n        this.events.stopPropagation();\r\n    }\r\n\r\n    public renderTemplate(params: any): HTMLElement {\r\n        return View.parseHTML(View.getHTML(this.template, params || {}))[0];\r\n    }\r\n\r\n    public render(params?: any): this {\r\n        this.el = this.renderTemplate(params);\r\n        for (let i = 0, len = this._classList.length; i < len; i++) {\r\n            this.el.classList.add(this._classList[i]);\r\n        }\r\n        this.events.dispatch(this.events.render, this);\r\n        return this;\r\n    }\r\n\r\n    public select<T extends HTMLElement>(queryStr: string): T | null {\r\n        if (this.el) {\r\n            return this.el.querySelector<T>(queryStr);\r\n        }\r\n        return null as T | null;\r\n    }\r\n\r\n    public selectRemove(queryStr: string): HTMLElement | undefined {\r\n        if (this.el) {\r\n            let r = this.select(queryStr);\r\n            if (r && r.parentNode) {\r\n                r.parentNode.removeChild(r);\r\n                return r;\r\n            }\r\n        }\r\n    }\r\n\r\n    public selectAll(queryStr: string, callback?: Function) {\r\n        if (this.el) {\r\n            const res = this.el.querySelectorAll(queryStr);\r\n            if (callback) {\r\n                for (let i = 0, len = res.length; i < len; i++) {\r\n                    callback(res[i], i);\r\n                }\r\n            }\r\n            return res;\r\n        }\r\n    }\r\n\r\n    public remove() {\r\n        if (this.el && this.el.parentNode) {\r\n            this.el.parentNode.removeChild(this.el);\r\n        }\r\n    }\r\n}\r\n\r\nexport {View};\r\n","import {stringTemplate} from '../utils/shared';\r\nimport {View} from './View';\r\nimport type {IViewParams, ViewEventsList} from './View';\r\nimport type {EventsHandler} from \"../Events\";\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-button\" title=\"{title}\">\r\n       <div class=\"og-button-icon\">{icon}</div>\r\n       <div class=\"og-button-text\">{text}</div>\r\n    </div>`;\r\n\r\ninterface HTMLElementExt extends HTMLElement {\r\n    __og_button__: Button;\r\n}\r\n\r\nexport type ButtonEventsList = [\"click\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\", \"touchcancel\"];\r\n\r\nconst BUTTON_EVENTS: ButtonEventsList = [\"click\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\", \"touchcancel\"];\r\n\r\nexport interface IButtonParams extends IViewParams {\r\n    icon?: string;\r\n    text?: string;\r\n    title?: string;\r\n    name?: string;\r\n}\r\n\r\nclass Button extends View<null> {\r\n\r\n    public override events: EventsHandler<ButtonEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    public override el: HTMLElementExt | null;\r\n\r\n    public name: string;\r\n    public $icon: HTMLElement | null;\r\n    public $text: HTMLElement | null;\r\n\r\n    constructor(options: IButtonParams = {}) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                icon: options.icon || \"\",\r\n                text: options.text || \"\",\r\n                title: options.title || \"\"\r\n            }),\r\n            ...options\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(BUTTON_EVENTS);\r\n\r\n        this.el = null;\r\n\r\n        this.name = options.name || \"\";\r\n\r\n        this.$icon = null;\r\n        this.$text = null;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n        super.render(params);\r\n        this.$icon = this.select(\".og-button-icon\");\r\n        this.$text = this.select(\".og-button-text\");\r\n        this.el!.__og_button__ = this;\r\n        this._initEvents();\r\n        return this;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        if (this.el) {\r\n            this.el.addEventListener(\"click\", this._onMouseClick);\r\n            this.el.addEventListener(\"mousedown\", this._onMouseDown);\r\n            this.el.addEventListener(\"mouseup\", this._onMouseUp);\r\n            this.el.addEventListener(\"touchstart\", this._onTouchStart);\r\n            this.el.addEventListener(\"touchend\", this._onTouchEnd);\r\n            this.el.addEventListener(\"touchcancel\", this._onTouchCancel);\r\n        }\r\n    }\r\n\r\n    protected _onMouseDown = (e: MouseEvent) => {\r\n        e.preventDefault();\r\n        this.events.dispatch(this.events.mousedown, this, e);\r\n    }\r\n\r\n    protected _onMouseUp = (e: MouseEvent) => {\r\n        e.preventDefault();\r\n        this.events.dispatch(this.events.mouseup, this, e);\r\n    }\r\n\r\n    protected _onTouchStart = (e: TouchEvent) => {\r\n        e.preventDefault();\r\n        this.events.dispatch(this.events.touchstart, this, e);\r\n    }\r\n\r\n    protected _onTouchEnd = (e: TouchEvent) => {\r\n        e.preventDefault();\r\n        this.events.dispatch(this.events.touchend, this, e);\r\n    }\r\n\r\n    protected _onTouchCancel = (e: TouchEvent) => {\r\n        e.preventDefault();\r\n        this.events.dispatch(this.events.touchcancel, this, e);\r\n    }\r\n\r\n    protected _mouseClickHandler(e: MouseEvent) {\r\n        e.preventDefault();\r\n        this.events.dispatch(this.events.click, this, e);\r\n    }\r\n\r\n    protected _onMouseClick = (e: MouseEvent) => {\r\n        this._mouseClickHandler(e)\r\n    }\r\n\r\n    public override remove() {\r\n        this._clearEvents();\r\n        super.remove();\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        this.el && this.el.removeEventListener(\"click\", this._onMouseClick);\r\n    }\r\n}\r\n\r\nexport {Button};\r\n","import {Planet, Renderer} from \"../index\";\r\n\r\nexport interface IControlParams {\r\n    name?: string;\r\n    autoActivate?: boolean\r\n}\r\n\r\n/**\r\n * Base control class. All other controls extend from this class.\r\n * @class Control\r\n * @param {Boolean} [options.autoActivate=true] - If true - calls initialize function after the renderer assigning.\r\n */\r\nexport class Control {\r\n    static __counter__: number = 0;\r\n    protected __id: number;\r\n    protected _name: string;\r\n\r\n    /**\r\n     * Control activity.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _active: boolean;\r\n\r\n    /**\r\n     * Control initialized.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _initialized: boolean;\r\n\r\n    public planet: Planet | null;\r\n\r\n    /**\r\n     * Assigned renderer.\r\n     * @public\r\n     * @type {Renderer}\r\n     */\r\n    public renderer: Renderer | null;\r\n\r\n    /**\r\n     * Auto activation flag.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public autoActivate: boolean;\r\n\r\n    protected _deferredActive: boolean;\r\n\r\n    constructor(options: IControlParams = {}) {\r\n\r\n        this.__id = Control.__counter__++;\r\n\r\n        this._name = options.name || `_control_${this.__id.toString()}`;\r\n\r\n        this.planet = null;\r\n\r\n        this._initialized = false;\r\n\r\n        this.renderer = null;\r\n\r\n        this.autoActivate = options.autoActivate || false;\r\n\r\n        this._active = false;\r\n\r\n        this._deferredActive = true;\r\n    }\r\n\r\n    /**\r\n     * Returns control name.\r\n     * @public\r\n     * @return {string} -\r\n     */\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    /**\r\n     * Control initialization function have to be overridden.\r\n     * @public\r\n     */\r\n    public oninit() {\r\n    }\r\n\r\n    /**\r\n     * Control renderer assigning function have to be overridden.\r\n     * @public\r\n     */\r\n    public onadd() {\r\n    }\r\n\r\n    /**\r\n     * Control remove function have to be overridden.\r\n     * @public\r\n     */\r\n    public onremove() {\r\n    }\r\n\r\n    /**\r\n     * Control activation function have to be overridden.\r\n     * @public\r\n     */\r\n    public onactivate() {\r\n    }\r\n\r\n    /**\r\n     * Control deactivation function have to be overriden.\r\n     * @public\r\n     */\r\n    public ondeactivate() {\r\n    }\r\n\r\n    /**\r\n     * Assign renderer to the control.\r\n     * @public\r\n     * @type {Renderer}\r\n     */\r\n    public addTo(renderer: Renderer) {\r\n        if (renderer) {\r\n            this.renderer = renderer;\r\n            renderer.controls[this.name] = this;\r\n            this.onadd && this.onadd();\r\n            if (renderer.isInitialized() && !this._initialized) {\r\n                this._initialized = true;\r\n                this.oninit && this.oninit();\r\n                if (this.autoActivate) {\r\n                    this.activate();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes control.\r\n     * @public\r\n     */\r\n    public remove() {\r\n\r\n        this.deactivate();\r\n\r\n        this.onremove && this.onremove();\r\n\r\n        let r = this.renderer,\r\n            n = this.name;\r\n\r\n        if (!r) return;\r\n\r\n        let c = r.controls[n];\r\n\r\n        if (c) {\r\n            if (this.isEqual(c)) {\r\n                delete r.controls[n];\r\n            }\r\n        }\r\n\r\n        this.renderer = null;\r\n        this._active = false;\r\n        this._initialized = false;\r\n    }\r\n\r\n    /**\r\n     * Activate control.\r\n     * @public\r\n     */\r\n    public activate() {\r\n        if (!this._active) {\r\n            if (!this._initialized) {\r\n                this._initialized = true;\r\n                this.oninit && this.oninit();\r\n            }\r\n            if (this._deferredActive) {\r\n                this._active = true;\r\n                this.onactivate && this.onactivate();\r\n            } else {\r\n                this._deferredActive = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deactivate control.\r\n     * @public\r\n     */\r\n    public deactivate() {\r\n        if (this._active) {\r\n            this._active = false;\r\n            this.ondeactivate && this.ondeactivate();\r\n        } else if (!this._initialized) {\r\n            this._deferredActive = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Is control active.\r\n     * @public\r\n     */\r\n    public isActive(): boolean {\r\n        return this._active;\r\n    }\r\n\r\n    public isEqual(control: Control): boolean {\r\n        return control.__id === this.__id;\r\n    }\r\n}\r\n","import {Button} from \"../ui/Button\";\r\nimport {Control, type IControlParams} from \"./Control\";\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg\r\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\r\n   xmlns:cc=\"http://creativecommons.org/ns#\"\r\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\r\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\r\n   xmlns=\"http://www.w3.org/2000/svg\"\r\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\r\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\r\n   viewBox=\"0 0 110.6 110.3\"\r\n   version=\"1.1\"\r\n   id=\"svg21\"\r\n   sodipodi:docname=\"aaa.svg\"\r\n   inkscape:version=\"0.92.3 (2405546, 2018-03-11)\">\r\n  <metadata\r\n     id=\"metadata11\">\r\n    <rdf:RDF>\r\n      <cc:Work\r\n         rdf:about=\"\">\r\n        <dc:format>image/svg+xml</dc:format>\r\n        <dc:type\r\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\r\n      </cc:Work>\r\n    </rdf:RDF>\r\n  </metadata>\r\n  <defs\r\n     id=\"defs25\" />\r\n  <sodipodi:namedview\r\n     pagecolor=\"#ffffff\"\r\n     bordercolor=\"#666666\"\r\n     borderopacity=\"1\"\r\n     objecttolerance=\"10\"\r\n     gridtolerance=\"10\"\r\n     guidetolerance=\"10\"\r\n     inkscape:pageopacity=\"0\"\r\n     inkscape:pageshadow=\"2\"\r\n     inkscape:window-width=\"1920\"\r\n     inkscape:window-height=\"1001\"\r\n     id=\"namedview23\"\r\n     showgrid=\"false\"\r\n     inkscape:zoom=\"9.4900968\"\r\n     inkscape:cx=\"28.376998\"\r\n     inkscape:cy=\"60.17054\"\r\n     inkscape:window-x=\"-9\"\r\n     inkscape:window-y=\"-9\"\r\n     inkscape:window-maximized=\"1\"\r\n     inkscape:current-layer=\"svg21\" />\r\n  <g\r\n     id=\"Layer_2\"\r\n     data-name=\"Layer 2\"\r\n     transform=\"matrix(1,0,0,-1,0,110.3)\">\r\n    <g\r\n       id=\"Слой_1\"\r\n       data-name=\"Слой 1\">\r\n      <g\r\n         id=\"_Group_\"\r\n         data-name=\"&lt;Group&gt;\">\r\n        <g\r\n           id=\"_Group_7\"\r\n           data-name=\"&lt;Group&gt;\">\r\n          <polygon\r\n             id=\"_Path_7\"\r\n             data-name=\"&lt;Path&gt;\"\r\n             points=\"55.2,97.6 55.3,97.4 55.3,97.6 55.3,97.2 65.3,55.1 55.3,55.1 55.2,55.1 45.3,55.1 55.2,97.2 \"\r\n             style=\"fill:#ff2b45\" />\r\n          <polygon\r\n             id=\"_Path_8\"\r\n             data-name=\"&lt;Path&gt;\"\r\n             points=\"55.3,12.7 55.3,12.9 55.2,12.7 55.2,13.1 45.3,55.1 55.2,55.1 55.3,55.1 65.3,55.1 55.3,13.1 \"\r\n             style=\"fill:#cecece;\" />\r\n        </g>\r\n      </g>\r\n    </g>\r\n  </g>\r\n</svg>`;\r\n\r\ninterface ICompasButtonParams extends IControlParams {\r\n\r\n}\r\n\r\n/**\r\n * Planet compass button\r\n */\r\nexport class CompassButton extends Control {\r\n    protected _heading: number;\r\n    protected _svg: HTMLElement | null;\r\n\r\n    constructor(options: ICompasButtonParams = {}) {\r\n        super(options);\r\n        this._heading = 0;\r\n        this._svg = null;\r\n    }\r\n\r\n    public override oninit() {\r\n\r\n        let btn = new Button({\r\n            classList: [\"og-map-button\", \"og-compass-button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        btn.appendTo(this.renderer!.div!);\r\n\r\n        btn.events.on(\"click\", this._onClick, this);\r\n\r\n        this._svg = btn.select(\"svg\");\r\n\r\n        this.renderer!.events!.on(\"draw\", this._draw, this);\r\n    }\r\n\r\n    protected _onClick() {\r\n        const planet = this.planet!;\r\n        let c = planet.getCartesianFromPixelTerrain(this.renderer!.handler!.getCenter());\r\n        if (c) {\r\n            planet.flyCartesian(\r\n                c.normal().scaleTo(c.length() + c.distance(planet.camera.eye)),\r\n                null,\r\n                null,\r\n                0,\r\n                null,\r\n                null,\r\n                () => {\r\n                    planet.camera.look(c!);\r\n                }\r\n            );\r\n        } else {\r\n            planet.flyCartesian(planet.camera.eye);\r\n        }\r\n    }\r\n\r\n    protected _draw() {\r\n        this.setHeading(this.planet!.camera.getHeading());\r\n    }\r\n\r\n    public setHeading(heading: number) {\r\n        if (this._heading !== heading) {\r\n            this._heading = heading;\r\n            this._svg!.style.transform = `rotateZ(${-heading}deg)`;\r\n        }\r\n    }\r\n}\r\n","export const CLOSE_ICON = `<svg className=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor; overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path d=\"M777.856 280.192l-33.92-33.952-231.872 231.872-231.84-231.872-33.984 33.888 231.872 231.904-231.84 231.84 33.888 33.984 231.904-231.904 231.84 231.872 33.952-33.888-231.872-231.904z\"/>\r\n</svg>`","import {getDefault, stringTemplate} from '../utils/shared';\r\nimport {Button} from './Button';\r\nimport {CLOSE_ICON} from './icons';\r\nimport {View} from './View';\r\nimport type {IViewParams, ViewEventsList} from './View';\r\nimport type {EventsHandler} from \"../Events\";\r\n\r\nexport interface IDialogParams extends IViewParams {\r\n    title?: string;\r\n    visible?: boolean;\r\n    resizable?: boolean;\r\n    width?: number;\r\n    height?: number;\r\n    left?: number;\r\n    right?: number;\r\n    top?: number;\r\n    minHeight?: number;\r\n    maxHeight?: number;\r\n    minWidth?: number;\r\n    maxWidth?: number;\r\n    useHide?: boolean;     // Using hide instead of remove when close\r\n}\r\n\r\nexport type DialogEventsList = [\"resize\", \"focus\", \"visibility\", \"dragstart\", \"dragend\"];\r\n\r\nconst DIALOG_EVENTS: DialogEventsList = [\"resize\", \"focus\", \"visibility\", \"dragstart\", \"dragend\"];\r\n\r\nconst TEMPLATE = `<div class=\"og-ddialog\" \r\n        style=\"display:{display}; resize:{resize}; width: {width}px; {height}; top: {top}px; left: {left}px; min-height: {minHeight}; max-height: {maxHeight}; min-width: {minWidth}; max-width: {maxWidth};\">\r\n       <div class=\"og-ddialog-header\">\r\n         <div class=\"og-ddialog-header__title\">{title}</div>      \r\n         <div class=\"og-ddialog-header__buttons\"></div>      \r\n        </div>\r\n       <div class=\"og-ddialog-container\"></div>\r\n    </div>>`;\r\n\r\nclass Dialog<M> extends View<M> {\r\n\r\n    static __zIndex__: number = 0;\r\n\r\n    public override events: EventsHandler<DialogEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    public $header: HTMLElement | null;\r\n    public $title: HTMLElement | null;\r\n    public $container: HTMLElement | null;\r\n    public $buttons: HTMLElement | null;\r\n\r\n    public useHide: boolean;\r\n\r\n    protected _startPosX: number;\r\n    protected _startPosY: number;\r\n\r\n    protected _closeBtn: Button;\r\n\r\n    protected _visibility: boolean;\r\n\r\n    protected _right: number | null;\r\n\r\n    constructor(options: IDialogParams = {}) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                title: options.title || \"\",\r\n                display: getDefault(options.visible, true) ? \"flex\" : \"none\",\r\n                resize: getDefault(options.resizable, true) ? \"both\" : \"none\",\r\n                width: options.width || 300,\r\n                height: options.height ? `height: ${options.height || 200}px` : \"\",\r\n                left: options.left || 0,\r\n                top: options.top || 0,\r\n                minHeight: options.minHeight ? `${options.minHeight}px` : 'unset',\r\n                maxHeight: options.maxHeight ? `${options.maxHeight}px` : 'unset',\r\n                minWidth: options.minWidth ? `${options.minWidth}px` : 'unset',\r\n                maxWidth: options.maxWidth ? `${options.maxWidth}px` : 'unset',\r\n            }),\r\n            ...options\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(DIALOG_EVENTS);\r\n\r\n        this._startPosX = 0;\r\n        this._startPosY = 0;\r\n\r\n        this.$header = null;\r\n        this.$title = null;\r\n        this.$container = null;\r\n        this.$buttons = null;\r\n\r\n        this._closeBtn = new Button({\r\n            icon: CLOSE_ICON,\r\n            classList: [\"og-button-size__20\"]\r\n        });\r\n\r\n        this.useHide = options.useHide || false;\r\n\r\n        this._visibility = getDefault(options.visible, true);\r\n\r\n        this._right = options.right != undefined ? options.right : null;\r\n    }\r\n\r\n    public setContainer(htmlStr: string) {\r\n        this.$container!.innerHTML = htmlStr;\r\n    }\r\n\r\n    public get container(): HTMLElement | null {\r\n        return this.$container;\r\n    }\r\n\r\n    public get width(): number {\r\n        return this.el ? parseFloat(this.el.style.width) : 0;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this.el ? parseFloat(this.el.style.height) : 0;\r\n    }\r\n\r\n    public bringToFront() {\r\n        this.el!.style.zIndex = String(Dialog.__zIndex__++);\r\n    }\r\n\r\n    public override render(params: any): this {\r\n        super.render(params);\r\n        this.bringToFront();\r\n        this.$header = this.select(\".og-ddialog-header\");\r\n        this.$title = this.select(\".og-ddialog-header__title\");\r\n        this.$container = this.select(\".og-ddialog-container\");\r\n        this.$buttons = this.select(\".og-ddialog-header__buttons\");\r\n        this._initEvents();\r\n        this._initButtons();\r\n\r\n        if (this._right != null) {\r\n            this.el!.style.visibility = \"hidden\";\r\n            const observer = new IntersectionObserver((entries, obs) => {\r\n                entries.forEach(entry => {\r\n                    if (entry.isIntersecting) {\r\n                        this.el!.style.visibility = \"visible\";\r\n                        //@ts-ignore\r\n                        if (this.el!.parentNode) {\r\n                            this.setPosition((this.el!.parentNode as HTMLElement).clientWidth - this.el!.clientWidth - this._right!);\r\n                            obs.disconnect();\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n\r\n            observer.observe(this.el!);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    public show() {\r\n        if (!this._visibility) {\r\n            this._visibility = true;\r\n            this.el!.style.display = \"flex\";\r\n            this.bringToFront();\r\n            this.events.dispatch(this.events.visibility, true, this);\r\n        }\r\n    }\r\n\r\n    public hide() {\r\n        if (this._visibility) {\r\n            this._visibility = false;\r\n            this.el!.style.display = \"none\";\r\n            this.events.dispatch(this.events.visibility, false, this);\r\n        }\r\n    }\r\n\r\n    public close() {\r\n        if (this.useHide) {\r\n            this.hide();\r\n        } else {\r\n            this.remove();\r\n        }\r\n    }\r\n\r\n    public setVisibility(visibility: boolean) {\r\n        if (visibility) {\r\n            this.show();\r\n        } else {\r\n            this.hide();\r\n        }\r\n    }\r\n\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    protected _initButtons() {\r\n        this._closeBtn.events.on(\"click\", this._onCloseBtnClick);\r\n        this._closeBtn.appendTo(this.$buttons!);\r\n    }\r\n\r\n    protected _initEvents() {\r\n        this.$header!.addEventListener(\"mousedown\", this._onMouseDown);\r\n        this.el!.addEventListener(\"mousedown\", this._onMouseDownAll);\r\n    }\r\n\r\n    protected _onCloseBtnClick = () => {\r\n        this.close();\r\n    }\r\n\r\n    protected _onMouseDownAll = () => {\r\n        this.bringToFront();\r\n    }\r\n\r\n    protected _onMouseDown = (e: MouseEvent) => {\r\n        e.preventDefault();\r\n\r\n        this._startDragging();\r\n\r\n        this._startPosX = e.clientX;\r\n        this._startPosY = e.clientY;\r\n\r\n        document.addEventListener(\"mousemove\", this._onMouseMove);\r\n        document.addEventListener(\"mouseup\", this._onMouseUp);\r\n    }\r\n\r\n    public setPosition(x?: number, y?: number) {\r\n        if (x != undefined) {\r\n            this.el!.style.left = `${x}px`;\r\n        }\r\n        if (y != undefined) {\r\n            this.el!.style.top = `${y}px`;\r\n        }\r\n    }\r\n\r\n    protected _onMouseMove = (e: MouseEvent) => {\r\n        e.preventDefault();\r\n        let dx = this._startPosX - e.clientX;\r\n        let dy = this._startPosY - e.clientY;\r\n        this._startPosX = e.clientX;\r\n        this._startPosY = e.clientY;\r\n        this.setPosition(this.el!.offsetLeft - dx, this.el!.offsetTop - dy);\r\n    }\r\n\r\n    protected _startDragging() {\r\n        if (!this.el!.classList.contains(\"dragging\")) {\r\n            this.el!.classList.add(\"dragging\");\r\n            this.events.dispatch(this.events.dragstart, this);\r\n        }\r\n    }\r\n\r\n    protected _clearDragging() {\r\n        if (this.el!.classList.contains(\"dragging\")) {\r\n            this.events.dispatch(this.events.dragend, this);\r\n            this.el!.classList.remove(\"dragging\");\r\n        }\r\n    }\r\n\r\n    protected _onMouseUp = () => {\r\n        this._clearDragging();\r\n        document.removeEventListener(\"mouseup\", this._onMouseUp);\r\n        document.removeEventListener(\"mousemove\", this._onMouseMove);\r\n    }\r\n\r\n    public override remove() {\r\n        this._clearDragging();\r\n        this._clearEvents();\r\n        super.remove();\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        this._closeBtn.events.off(\"click\", this._onCloseBtnClick);\r\n\r\n        document.removeEventListener(\"mouseup\", this._onMouseUp);\r\n        document.removeEventListener(\"mousemove\", this._onMouseMove);\r\n\r\n        this.$header!.removeEventListener(\"mousedown\", this._onMouseDown);\r\n        this.el!.removeEventListener(\"mousedown\", this._onMouseDownAll);\r\n    }\r\n}\r\n\r\nexport {Dialog};\r\n","import {Button} from './Button';\r\nimport type {IButtonParams, ButtonEventsList} from './Button';\r\nimport type {EventsHandler} from \"../Events\";\r\nimport type {ViewEventsList} from \"./View\";\r\n\r\ninterface IToggleButtonParams extends IButtonParams {\r\n    isActive?: boolean;\r\n    preventClick?: boolean;\r\n}\r\n\r\ntype ToggleButtonEventsList = [\"change\"];\r\n\r\nconst TOGGLEBUTTON_EVENTS: ToggleButtonEventsList = [\"change\"];\r\n\r\nclass ToggleButton extends Button {\r\n\r\n    public override events: EventsHandler<ToggleButtonEventsList> & EventsHandler<ButtonEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    protected _isActive: boolean;\r\n    public preventClick: boolean;\r\n\r\n    constructor(options: IToggleButtonParams) {\r\n        super({\r\n            ...options\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(TOGGLEBUTTON_EVENTS);\r\n\r\n        this._isActive = options.isActive || false;\r\n\r\n        this.preventClick = options.preventClick || false;\r\n    }\r\n\r\n    public setActive(isActive: boolean, stopPropagation: boolean = false) {\r\n        if (isActive !== this._isActive) {\r\n            this._isActive = isActive;\r\n            this._toggle();\r\n            if (!stopPropagation) {\r\n                this.events.dispatch(this.events.change, isActive, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _toggle() {\r\n        this.el && this.el.classList.toggle(\"og-button__active\");\r\n    }\r\n\r\n    public get isActive(): boolean {\r\n        return this._isActive;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n        super.render(params);\r\n        if (this._isActive) {\r\n            this._toggle();\r\n        }\r\n        return this;\r\n    }\r\n\r\n    protected override _onMouseClick = (e: MouseEvent) => {\r\n        if (!this.preventClick) {\r\n            this._mouseClickHandler(e);\r\n            this.setActive(!this.isActive);\r\n        }\r\n    }\r\n}\r\n\r\nexport {ToggleButton}","export const VISIBLE_DISTANCE = 3570.0;\r\nexport const MAX_RENDERED_NODES = 1000;\r\n\r\nexport const NW = 0;\r\nexport const NE = 1;\r\nexport const SW = 2;\r\nexport const SE = 3;\r\n\r\nexport const N = 0;\r\nexport const E = 1;\r\nexport const S = 2;\r\nexport const W = 3;\r\n\r\nexport const NOTRENDERING = 0;\r\nexport const RENDERING = 1;\r\nexport const WALKTHROUGH = 2;\r\n\r\n/**\r\n * World opposite side table.\r\n */\r\nexport const OPSIDE = [S, W, N, E];\r\n\r\n/**\r\n * First index is {N,E,S,W} and second is {NW,NE,SW,SE}\r\n */\r\nexport const NEIGHBOUR = [\r\n    [-1, -1, NW, NE],\r\n    [NE, -1, SE, -1],\r\n    [SW, SE, -1, -1],\r\n    [-1, NW, -1, SW]\r\n];\r\n\r\n/**\r\n * Neighbor's oposite part. For example oposite side\r\n * on the east neighbor side is: [S][SE] = NE\r\n */\r\nexport const OPPART = [\r\n    [SW, SE, NW, NE],\r\n    [NE, NW, SE, SW],\r\n    [SW, SE, NW, NE],\r\n    [NE, NW, SE, SW]\r\n];\r\n\r\n/**\r\n * Neighbos's opside array order. For example NW node\r\n * by E side array index is 0, SE node by S side is 1.\r\n */\r\nexport const NOPSORD = [\r\n    [0, 1, 0, 1],\r\n    [0, 0, 1, 1],\r\n    [0, 1, 0, 1],\r\n    [0, 0, 1, 1]\r\n];\r\n\r\n/**\r\n * First index is {NW,NE,SW,SE}, another one is {N,E,S,W}\r\n */\r\nexport const COMSIDE = [\r\n    [true, false, false, true],\r\n    [true, true, false, false],\r\n    [false, false, true, true],\r\n    [false, true, true, false]\r\n];\r\n\r\n/**\r\n * Gets segment part left to right or up to downo ffset against neighbour side.\r\n * Where 0 - no offset 1 - half segment size offset.\r\n */\r\nexport const PARTOFFSET = [\r\n    /*     N  E  S  W */\r\n    /*NW*/ [0, 1, 0, 0],\r\n    /*NE*/ [1, 0, 0, 0],\r\n    /*SW*/ [0, 1, 0, 1],\r\n    /*SE*/ [1, 1, 1, 1]\r\n];\r\n","import {Layer} from \"./Layer\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport type {WebGLTextureExt} from \"../webgl/Handler\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\n\r\n/**\r\n * @class Material\r\n * @param {Segment} segment\r\n * @param {Layer} layer\r\n */\r\nclass Material {\r\n\r\n    public segment: Segment;\r\n    public layer: Layer;\r\n    public isReady: boolean;\r\n    public isLoading: boolean;\r\n    public texture: WebGLTextureExt | null;\r\n    public pickingMask: WebGLTextureExt | null;\r\n\r\n    public textureExists: boolean;\r\n    public appliedNodeId: number;\r\n    public appliedNode: Node | null;\r\n    public texOffset: NumberArray4;\r\n    public loadingAttempts: number;\r\n\r\n    // vector data\r\n    public _updateTexture: WebGLTextureExt | null;\r\n    public _updatePickingMask: WebGLTextureExt | null;\r\n    public pickingReady: boolean;\r\n\r\n    constructor(segment: Segment, layer: Layer) {\r\n        this.segment = segment;\r\n        this.layer = layer;\r\n        this.isReady = false;\r\n        this.isLoading = false;\r\n        this.texture = null;\r\n        this.pickingMask = null;\r\n\r\n        this.textureExists = false;\r\n        this.appliedNodeId = 0;\r\n        this.appliedNode = null;\r\n        this.texOffset = [0.0, 0.0, 1.0, 1.0];\r\n        this.loadingAttempts = 0;\r\n\r\n        this._updateTexture = null;\r\n        this._updatePickingMask = null;\r\n        this.pickingReady = false;\r\n    }\r\n\r\n    public abortLoading() {\r\n        this.layer.abortMaterialLoading(this);\r\n    }\r\n\r\n    public _createTexture(img: HTMLCanvasElement | ImageBitmap | HTMLImageElement) {\r\n        return this.layer._planet && this.layer.createTexture!(img, this.layer._internalFormat, this.isReady ? this.texture : null);\r\n    }\r\n\r\n    public applyImage(img: HTMLCanvasElement | ImageBitmap | HTMLImageElement) {\r\n        if (this.segment.initialized) {\r\n            this._updateTexture = null;\r\n            //this.image = img;\r\n            this.texture = this._createTexture(img);\r\n            this.isReady = true;\r\n            this.pickingReady = true;\r\n            this.textureExists = true;\r\n            this.isLoading = false;\r\n            this.appliedNodeId = this.segment.node.nodeId;\r\n            this.texOffset = [0.0, 0.0, 1.0, 1.0];\r\n        }\r\n    }\r\n\r\n    public applyTexture(texture: WebGLTextureExt | null, pickingMask?: WebGLTextureExt | null) {\r\n        if (this.segment.initialized) {\r\n            this.texture = texture;\r\n            this._updateTexture = null;\r\n            this.pickingMask = pickingMask || null;\r\n            this._updatePickingMask = null;\r\n            this.isReady = true;\r\n            this.pickingReady = true;\r\n            this.textureExists = true;\r\n            this.isLoading = false;\r\n            this.appliedNodeId = this.segment.node.nodeId;\r\n            this.texOffset = [0.0, 0.0, 1.0, 1.0];\r\n        }\r\n    }\r\n\r\n    public textureNotExists() {\r\n        if (this.segment.initialized) {\r\n            this.pickingReady = true;\r\n            this.isLoading = false;\r\n            this.isReady = true;\r\n            this.textureExists = false;\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        this.loadingAttempts = 0;\r\n        this.layer.clearMaterial(this);\r\n    }\r\n}\r\n\r\nexport {Material};\r\n","import * as mercator from \"../mercator\";\r\nimport * as utils from \"../utils/shared\";\r\nimport {createColorRGB} from \"../utils/shared\";\r\nimport {createEvents} from \"../Events\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {Extent} from \"../Extent\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Material} from \"./Material\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport type {IDefaultTextureParams} from \"../webgl/Handler\";\r\n\r\nconst FADING_RATIO = 30;\r\n\r\nexport interface ILayerParams {\r\n    properties?: any;\r\n    labelMaxLetters?: number;\r\n    hideInLayerSwitcher?: boolean;\r\n    opacity?: number;\r\n    minZoom?: number;\r\n    maxZoom?: number;\r\n    attribution?: string;\r\n    zIndex?: number;\r\n    isBaseLayer?: boolean;\r\n    defaultTextures?: [IDefaultTextureParams, IDefaultTextureParams];\r\n    visibility?: boolean;\r\n    fading?: boolean;\r\n    height?: number;\r\n    textureFilter?: string;\r\n    isSRGB?: boolean;\r\n    pickingEnabled?: boolean;\r\n    preLoadZoomLevels?: number[];\r\n    extent?: Extent | [[number, number], [number, number]];\r\n    ambient?: string | NumberArray3 | Vec3;\r\n    diffuse?: string | NumberArray3 | Vec3;\r\n    specular?: string | NumberArray3 | Vec3;\r\n    shininess?: number;\r\n    nightTextureCoefficient?: number;\r\n    iconSrc?: string | null;\r\n}\r\n\r\n/**\r\n * @class\r\n * Base class; normally only used for creating subclasses and not instantiated in apps.\r\n * A visual representation of raster or vector map data well known as a layer.\r\n * @class\r\n * @param {String} [name=\"noname\"] - Layer name.\r\n * @param {Object} [options] - Layer options:\r\n * @param {number} [options.opacity=1.0] - Layer opacity.\r\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\r\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\r\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\r\n * @param {boolean} [options.isBaseLayer=false] - This is a base layer.\r\n * @param {boolean} [options.visibility=true] - Layer visibility.\r\n * @param {boolean} [options.hideInLayerSwitcher=false] - Presence of layer in dialog window of LayerSwitcher control.\r\n * @param {boolean} [options.isSRGB=false] - Layer image webgl internal format.\r\n * @param {Extent} [options.extent=[[-180.0, -90.0], [180.0, 90.0]]] - Visible extent.\r\n * @param {string} [options.textureFilter=\"anisotropic\"] - Image texture filter. Available values: \"nearest\", \"linear\", \"mipmap\" and \"anisotropic\".\r\n * @param {string} [options.icon] - Icon for LayerSwitcher\r\n * @fires EventsHandler<LayerEventsList>#visibilitychange\r\n * @fires EventsHandler<LayerEventsList>#add\r\n * @fires EventsHandler<LayerEventsList>#remove\r\n * @fires EventsHandler<LayerEventsList>#mousemove\r\n * @fires EventsHandler<LayerEventsList>#mouseenter\r\n * @fires EventsHandler<LayerEventsList>#mouseleave\r\n * @fires EventsHandler<LayerEventsList>#lclick\r\n * @fires EventsHandler<LayerEventsList>#rclick\r\n * @fires EventsHandler<LayerEventsList>#mclick\r\n * @fires EventsHandler<LayerEventsList>#ldblclick\r\n * @fires EventsHandler<LayerEventsList>#rdblclick\r\n * @fires EventsHandler<LayerEventsList>#mdblclick\r\n * @fires EventsHandler<LayerEventsList>#lup\r\n * @fires EventsHandler<LayerEventsList>#rup\r\n * @fires EventsHandler<LayerEventsList>#mup\r\n * @fires EventsHandler<LayerEventsList>#ldown\r\n * @fires EventsHandler<LayerEventsList>#rdown\r\n * @fires EventsHandler<LayerEventsList>#mdown\r\n * @fires EventsHandler<LayerEventsList>#lhold\r\n * @fires EventsHandler<LayerEventsList>#rhold\r\n * @fires EventsHandler<LayerEventsList>#mhold\r\n * @fires EventsHandler<LayerEventsList>#mousewheel\r\n * @fires EventsHandler<LayerEventsList>#touchmove\r\n * @fires EventsHandler<LayerEventsList>#touchstart\r\n * @fires EventsHandler<LayerEventsList>#touchend\r\n * @fires EventsHandler<LayerEventsList>#doubletouch\r\n */\r\nclass Layer {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    /**\r\n     * Uniq identifier.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public __id: number;\r\n\r\n    /**\r\n     * Events handler.\r\n     * @public\r\n     * @type {Events}\r\n     */\r\n    public events: EventsHandler<LayerEventsList>;\r\n\r\n    /**\r\n     * Layer user name.\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public name: string;\r\n\r\n    public properties: any;\r\n\r\n    public hideInLayerSwitcher: boolean;\r\n\r\n    /**\r\n     * Minimal zoom level when layer is visible.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public minZoom: number;\r\n\r\n    /**\r\n     * Maximal zoom level when layer is visible.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public maxZoom: number;\r\n\r\n    /**\r\n     * Planet node.\r\n     * @public\r\n     * @type {Planet}\r\n     */\r\n    public _planet: Planet | null;\r\n\r\n    public createTexture: Function | null;\r\n\r\n    public nightTextureCoefficient: number;\r\n\r\n    protected _hasImageryTiles: boolean;\r\n\r\n    /**\r\n     * Layer global opacity.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    protected _opacity: number;\r\n\r\n    /**\r\n     * Layer attribution.\r\n     * @protected\r\n     * @type {string}\r\n     */\r\n    protected _attribution: string;\r\n\r\n    /**\r\n     * Layer z-index.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _zIndex: number;\r\n\r\n    /**\r\n     * Base layer type flag.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _isBaseLayer: boolean;\r\n\r\n    public _defaultTextures: [IDefaultTextureParams | null, IDefaultTextureParams | null];\r\n\r\n    /**\r\n     * Layer visibility.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _visibility: boolean;\r\n\r\n    public _fading: boolean;\r\n\r\n    protected _fadingFactor: number;\r\n\r\n    public _fadingOpacity: number;\r\n\r\n    /**\r\n     * Height over the ground.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _height: number;\r\n\r\n    protected _textureFilter: string;\r\n\r\n    protected _isSRGB: boolean;\r\n\r\n    public _internalFormat: number | null;\r\n\r\n    /**\r\n     * Visible degrees extent.\r\n     * @public\r\n     * @type {Extent}\r\n     */\r\n    public _extent: Extent;\r\n\r\n    /**\r\n     * Visible mercator extent.\r\n     * @public\r\n     * @type {Extent}\r\n     */\r\n    public _extentMerc: Extent;\r\n\r\n    /**\r\n     * Layer picking color. Assign when added to the planet.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public _pickingColor: Vec3;\r\n\r\n    public _pickingEnabled: boolean;\r\n\r\n    protected _isPreloadDone: boolean;\r\n\r\n    protected _preLoadZoomLevels: number[];\r\n\r\n    public _ambient: Float32Array | null;\r\n    public _diffuse: Float32Array | null;\r\n    public _specular: Float32Array | null;\r\n\r\n    public isVector: boolean = false;\r\n\r\n    protected _iconSrc: string | null;\r\n\r\n    constructor(name?: string | null, options: ILayerParams = {}) {\r\n\r\n        this.__id = Layer.__counter__++;\r\n\r\n        this._iconSrc = options.iconSrc || null;\r\n\r\n        this.events = createEvents<LayerEventsList>(LAYER_EVENTS, this);\r\n\r\n        this.name = name || \"noname\";\r\n\r\n        this.properties = options.properties || {};\r\n\r\n        this.hideInLayerSwitcher = options.hideInLayerSwitcher || false;\r\n\r\n        this._hasImageryTiles = true;\r\n\r\n        this._opacity = options.opacity != undefined ? options.opacity : 1.0;\r\n\r\n        this.minZoom = options.minZoom || 0;\r\n\r\n        this.maxZoom = options.maxZoom != undefined ? options.maxZoom : 50;\r\n\r\n        this._planet = null;\r\n\r\n        this.isVector = false;\r\n\r\n        this._attribution = options.attribution || \"\";\r\n\r\n        this._zIndex = options.zIndex || 0;\r\n\r\n        this._isBaseLayer = options.isBaseLayer || false;\r\n\r\n        this._defaultTextures = options.defaultTextures || [null, null];\r\n\r\n        this._visibility = options.visibility !== undefined ? options.visibility : true;\r\n\r\n        this._fading = options.fading || false;\r\n\r\n        this._fadingFactor = this._opacity / FADING_RATIO;\r\n\r\n        if (this._fading) {\r\n            this._fadingOpacity = 0;\r\n        } else {\r\n            this._fadingOpacity = this._opacity;\r\n        }\r\n\r\n        this._height = options.height || 0;\r\n\r\n        this._extent = new Extent();\r\n\r\n        this.createTexture = null;\r\n\r\n        this._textureFilter = options.textureFilter ? options.textureFilter.trim().toUpperCase() : \"MIPMAP\";\r\n\r\n        this._isSRGB = options.isSRGB != undefined ? options.isSRGB : false;\r\n\r\n        this._internalFormat = null;\r\n\r\n        this._extentMerc = new Extent();\r\n\r\n        // Setting the extent up\r\n        this.setExtent(\r\n            utils.createExtent(\r\n                options.extent,\r\n                new Extent(new LonLat(-180, -90), new LonLat(180, 90))\r\n            )\r\n        );\r\n\r\n        /**\r\n         * Layer picking color. Assign when added to the planet.\r\n         * @protected\r\n         * @type {Vec3}\r\n         */\r\n        this._pickingColor = new Vec3();\r\n\r\n        this._pickingEnabled = options.pickingEnabled !== undefined ? options.pickingEnabled : true;\r\n\r\n        this._isPreloadDone = false;\r\n\r\n        this._preLoadZoomLevels = options.preLoadZoomLevels || [0, 1];\r\n\r\n        this._ambient = null;\r\n        this._diffuse = null;\r\n        this._specular = null;\r\n\r\n        if (options.ambient) {\r\n            let a = utils.createColorRGB(options.ambient, new Vec3(0.2, 0.2, 0.2));\r\n            this._ambient = new Float32Array([a.x, a.y, a.z]);\r\n        }\r\n\r\n        if (options.diffuse) {\r\n            let d = utils.createColorRGB(options.diffuse, new Vec3(0.8, 0.8, 0.8));\r\n            this._diffuse = new Float32Array([d.x, d.y, d.z]);\r\n        }\r\n\r\n        if (options.specular) {\r\n            let s = utils.createColorRGB(options.specular, new Vec3(0.0003, 0.0003, 0.0003));\r\n            let shininess = options.shininess || 20.0;\r\n            this._specular = new Float32Array([s.x, s.y, s.z, shininess]);\r\n        }\r\n\r\n        this.nightTextureCoefficient = options.nightTextureCoefficient || 1.0;\r\n    }\r\n\r\n    public get iconSrc(): string | null {\r\n        return this._iconSrc;\r\n    }\r\n\r\n    public set iconSrc(src: string | null) {\r\n        // @todo: add event\r\n        this._iconSrc = src;\r\n    }\r\n\r\n    public set diffuse(rgb: string | NumberArray3 | Vec3 | null | undefined) {\r\n        if (rgb) {\r\n            let vec = createColorRGB(rgb);\r\n            this._diffuse = new Float32Array(vec.toArray());\r\n        } else {\r\n            this._diffuse = null;\r\n        }\r\n    }\r\n\r\n    public set ambient(rgb: string | NumberArray3 | Vec3 | null | undefined) {\r\n        if (rgb) {\r\n            let vec = createColorRGB(rgb);\r\n            this._ambient = new Float32Array(vec.toArray());\r\n        } else {\r\n            this._ambient = null;\r\n        }\r\n    }\r\n\r\n    public set specular(rgb: string | NumberArray3 | Vec3 | null | undefined) {\r\n        if (rgb) {\r\n            let vec = createColorRGB(rgb);\r\n            this._specular = new Float32Array([vec.x, vec.y, vec.y, this._specular ? this._specular[3] : 0.0]);\r\n        } else {\r\n            this._specular = null;\r\n        }\r\n    }\r\n\r\n    public set shininess(v: number) {\r\n        if (this._specular) {\r\n            this._specular[3] = v;\r\n        }\r\n    }\r\n\r\n    // get normalMapCreator() {\r\n    //     return this._normalMapCreator;\r\n    // }\r\n\r\n    static getTMS(x: number, y: number, z: number): { x: number; y: number; z: number } {\r\n        return {\r\n            x: x,\r\n            y: (1 << z) - y - 1,\r\n            z: z\r\n        };\r\n    }\r\n\r\n    static getTileIndex(x: number, y: number, z: number, tileGroup: number): string {\r\n        return `${tileGroup}::${x}_${y}_${z}`;\r\n    }\r\n\r\n    public get instanceName(): string {\r\n        return \"Layer\";\r\n    }\r\n\r\n    public get rendererEvents(): EventsHandler<LayerEventsList> {\r\n        return this.events;\r\n    }\r\n\r\n    public set opacity(opacity: number) {\r\n        if (opacity !== this._opacity) {\r\n            if (this._fading) {\r\n                if (opacity > this._opacity) {\r\n                    this._fadingFactor = (opacity - this._opacity) / FADING_RATIO;\r\n                } else if (opacity < this._opacity) {\r\n                    this._fadingFactor = (this._opacity - opacity) / FADING_RATIO;\r\n                }\r\n            } else {\r\n                this._fadingOpacity = opacity;\r\n            }\r\n            this._opacity = opacity;\r\n        }\r\n    }\r\n\r\n    public set pickingEnabled(picking: boolean) {\r\n        this._pickingEnabled = picking;\r\n    }\r\n\r\n    public get pickingEnabled(): boolean {\r\n        return this._pickingEnabled;\r\n    }\r\n\r\n    /**\r\n     * Returns true if a layer has imagery tiles.\r\n     * @public\r\n     * @virtual\r\n     * @returns {boolean} - Imagery tiles flag.\r\n     */\r\n    public hasImageryTiles(): boolean {\r\n        return this._hasImageryTiles;\r\n    }\r\n\r\n    /**\r\n     * Gets layer identifier.\r\n     * @public\r\n     * @returns {string} - Layer object id.\r\n     */\r\n    public getID(): number {\r\n        return this.__id;\r\n    }\r\n\r\n    public get id(): number {\r\n        return this.__id;\r\n    }\r\n\r\n    /**\r\n     * @todo: remove after all\r\n     */\r\n    public get _id(): number {\r\n        return this.__id;\r\n    }\r\n\r\n    /**\r\n     * Compares layers instances.\r\n     * @public\r\n     * @param {Layer} layer - Layer instance to compare.\r\n     * @returns {boolean} - Returns true if the layers is the same instance of the input.\r\n     */\r\n    public isEqual(layer: Layer): boolean {\r\n        return layer.__id === this.__id;\r\n    }\r\n\r\n    /**\r\n     * Assign the planet.\r\n     * @protected\r\n     * @virtual\r\n     * @param {Planet} planet - Planet render node.\r\n     */\r\n    public _assignPlanet(planet: Planet) {\r\n\r\n        this._planet = planet;\r\n\r\n        planet._layers.push(this);\r\n\r\n        if (planet.renderer && planet.renderer.isInitialized()) {\r\n            // TODO: webgl1\r\n            if (this._isSRGB) {\r\n                this._internalFormat = planet.renderer.handler.gl!.SRGB8_ALPHA8;\r\n            } else {\r\n                this._internalFormat = planet.renderer.handler.gl!.RGBA8;\r\n            }\r\n            this.createTexture = planet.renderer.handler.createTexture[this._textureFilter];\r\n\r\n            this.events.on(\"visibilitychange\", planet._onLayerVisibilityChanged, planet);\r\n\r\n            if (this._isBaseLayer && this._visibility) {\r\n                planet.setBaseLayer(this);\r\n            }\r\n\r\n            planet.events.dispatch(planet.events.layeradd, this);\r\n            this.events.dispatch(this.events.add, planet);\r\n            planet.updateVisibleLayers();\r\n            this._bindPicking();\r\n\r\n            if (this._visibility && this.hasImageryTiles()) {\r\n                this._preLoad();\r\n            }\r\n        }\r\n    }\r\n\r\n    public get isIdle(): boolean {\r\n        return this._planet && this._planet._terrainCompletedActivated || false;\r\n    }\r\n\r\n    /**\r\n     * Assign picking color to the layer.\r\n     * @protected\r\n     * @virtual\r\n     */\r\n    protected _bindPicking() {\r\n        this._planet && this._planet.renderer && this._planet.renderer.assignPickingColor<Layer>(this);\r\n    }\r\n\r\n    /**\r\n     * Adds layer to the planet.\r\n     * @public\r\n     * @param {Planet} planet - Adds layer to the planet.\r\n     */\r\n    public addTo(planet: Planet) {\r\n        if (!this._planet) {\r\n            this._assignPlanet(planet);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes from planet.\r\n     * @public\r\n     * @returns {Layer} -This layer.\r\n     */\r\n    public remove(): this {\r\n        let p = this._planet;\r\n        if (p) {\r\n            //TODO: replace to planet\r\n            for (let i = 0; i < p._layers.length; i++) {\r\n                if (this.isEqual(p._layers[i])) {\r\n                    p.renderer && p.renderer.clearPickingColor(this);\r\n                    p._layers.splice(i, 1);\r\n                    p.updateVisibleLayers();\r\n                    this.clear();\r\n                    p.events.dispatch(p.events.layerremove, this);\r\n                    this.events.dispatch(this.events.remove, p);\r\n                    this._planet = null;\r\n                    this._internalFormat = null;\r\n                    this.createTexture = null;\r\n                    return this;\r\n                }\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Clears layer material.\r\n     * @virtual\r\n     */\r\n    public clear() {\r\n        if (this._planet) {\r\n            this._planet._clearLayerMaterial(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns planet instance.\r\n     */\r\n    get planet(): Planet | null {\r\n        return this._planet;\r\n    }\r\n\r\n    /**\r\n     * Sets layer attribution text.\r\n     * @public\r\n     * @param {string} html - HTML code that represents layer attribution, it could be just a text.\r\n     */\r\n    public setAttribution(html: string) {\r\n        if (this._attribution !== html) {\r\n            this._attribution = html;\r\n            this._planet && this._planet.updateAttributionsList();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets layer attribution.\r\n     * @public\r\n     * @returns {string} Layer attribution\r\n     */\r\n    public getAttribution(): string {\r\n        return this._attribution;\r\n    }\r\n\r\n    /**\r\n     * Sets height over the ground.\r\n     * @public\r\n     * @param {number} height - Layer height.\r\n     */\r\n    public setHeight(height: number) {\r\n        this._height = height;\r\n        this._planet && this._planet.updateVisibleLayers();\r\n    }\r\n\r\n    /**\r\n     * Gets layer height.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getHeight(): number {\r\n        return this._height;\r\n    }\r\n\r\n    /**\r\n     * Sets z-index.\r\n     * @public\r\n     * @param {number} zIndex - Layer z-index.\r\n     */\r\n    public setZIndex(zIndex: number) {\r\n        this._zIndex = zIndex;\r\n        this._planet && this._planet.updateVisibleLayers();\r\n    }\r\n\r\n    /**\r\n     * Gets z-index.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getZIndex(): number {\r\n        return this._zIndex;\r\n    }\r\n\r\n    /**\r\n     * Set zIndex to the maximal value depend on other layers on the planet.\r\n     * @public\r\n     */\r\n    public bringToFront() {\r\n        if (this._planet) {\r\n            let vl = this._planet.visibleTileLayers;\r\n            let l = vl[vl.length - 1];\r\n            if (!l.isEqual(this)) {\r\n                this.setZIndex(l.getZIndex() + 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns true if the layer is a base.\r\n     * @public\r\n     * @returns {boolean} - Base layer flag.\r\n     */\r\n    public isBaseLayer(): boolean {\r\n        return this._isBaseLayer;\r\n    }\r\n\r\n    /**\r\n     * Sets base layer type true.\r\n     * @public\r\n     * @param {boolean} isBaseLayer -\r\n     */\r\n    public setBaseLayer(isBaseLayer: boolean) {\r\n        this._isBaseLayer = isBaseLayer;\r\n        if (this._planet) {\r\n            if (!isBaseLayer && this._planet.baseLayer && this.isEqual(this._planet.baseLayer)) {\r\n                this._planet.baseLayer = null;\r\n            }\r\n            this._planet.updateVisibleLayers();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets layer visibility.\r\n     * @public\r\n     * @virtual\r\n     * @param {boolean} visibility - Layer visibility.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        if (visibility !== this._visibility) {\r\n            this._visibility = visibility;\r\n            if (this._planet) {\r\n                if (this._isBaseLayer && visibility) {\r\n                    this._planet.setBaseLayer(this);\r\n                }\r\n                this._planet.updateVisibleLayers();\r\n                if (visibility && !this._isPreloadDone && !this.isVector) {\r\n                    this._isPreloadDone = true;\r\n                    this._preLoad();\r\n                }\r\n            }\r\n            this.events.dispatch(this.events.visibilitychange, this);\r\n        }\r\n    }\r\n\r\n    protected _forceMaterialApply(segment: Segment) {\r\n        let pm = segment.materials,\r\n            m = pm[this.__id];\r\n\r\n        if (!m) {\r\n            m = pm[this.__id] = this.createMaterial(segment);\r\n        }\r\n\r\n        if (!m.isReady) {\r\n            this._planet!._renderCompleted = false;\r\n        }\r\n\r\n        this.applyMaterial(m, true);\r\n    }\r\n\r\n    public clearMaterial(material: Material) {\r\n        //empty\r\n    }\r\n\r\n    public loadMaterial(material: Material, forceLoading: boolean = false) {\r\n        //empty\r\n    }\r\n\r\n    public applyMaterial(m: Material, isForced: boolean = false): NumberArray4 {\r\n        return [0, 0, 1, 1];\r\n    }\r\n\r\n    protected _preLoadRecursive(node: Node, maxZoom: number) {\r\n        if (node.segment.tileZoom > maxZoom) {\r\n            return;\r\n        }\r\n        if (this._preLoadZoomLevels.includes(node.segment.tileZoom)) {\r\n            this._forceMaterialApply(node.segment);\r\n        }\r\n\r\n        for (let i = 0, len = node.nodes.length; i < len; i++) {\r\n            if (node.nodes[i]) {\r\n                this._preLoadRecursive(node.nodes[i], maxZoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _preLoad() {\r\n        if (this._planet && this._preLoadZoomLevels.length) {\r\n\r\n            let p = this._planet,\r\n                maxZoom = Math.max(...this._preLoadZoomLevels);\r\n\r\n            for (let i = 0, len = p.quadTreeStrategy.quadTreeList.length; i < len; i++) {\r\n                this._preLoadRecursive(p.quadTreeStrategy.quadTreeList[i], maxZoom);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets layer visibility.\r\n     * @public\r\n     * @returns {boolean} - Layer visibility.\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    /**\r\n     * Sets visible geographical extent.\r\n     * @public\r\n     * @param {Extent} extent - Layer visible geographical extent.\r\n     */\r\n    public setExtent(extent: Extent) {\r\n        let sw = extent.southWest.clone(),\r\n            ne = extent.northEast.clone();\r\n\r\n        if (sw.lat < mercator.MIN_LAT) {\r\n            sw.lat = mercator.MIN_LAT;\r\n        }\r\n\r\n        if (ne.lat > mercator.MAX_LAT) {\r\n            ne.lat = mercator.MAX_LAT;\r\n        }\r\n\r\n        this._extent = extent.clone();\r\n        this._extentMerc = new Extent(sw.forwardMercator(), ne.forwardMercator());\r\n\r\n        this._correctFullExtent();\r\n    }\r\n\r\n    /**\r\n     * Gets layer extent.\r\n     * @public\r\n     * @return {Extent} - Layer geodetic extent.\r\n     */\r\n    public getExtent(): Extent {\r\n        return this._extent;\r\n    }\r\n\r\n    /**\r\n     * Gets layer web-mercator extent.\r\n     * @public\r\n     * @return {Extent} - Layer extent.\r\n     */\r\n    public getExtentMerc(): Extent {\r\n        return this._extentMerc;\r\n    }\r\n\r\n\r\n    /**\r\n     * Fly extent.\r\n     * @public\r\n     */\r\n    public flyExtent() {\r\n        this._planet?.flyExtent(this.getExtent());\r\n    }\r\n\r\n    /**\r\n     * View extent.\r\n     * @public\r\n     */\r\n    public viewExtent() {\r\n        this._planet?.viewExtent(this.getExtent());\r\n    }\r\n\r\n    /**\r\n     * Special correction of the whole globe extent.\r\n     * @protected\r\n     */\r\n    protected _correctFullExtent() {\r\n        // var e = this._extent,\r\n        //    em = this._extentMerc;\r\n        // var ENLARGE_MERCATOR_LON = og.mercator.POLE + 50000;\r\n        // var ENLARGE_MERCATOR_LAT = og.mercator.POLE + 50000;\r\n        // if (e.northEast.lat === 90.0) {\r\n        //    em.northEast.lat = ENLARGE_MERCATOR_LAT;\r\n        // }\r\n        // if (e.northEast.lon === 180.0) {\r\n        //    em.northEast.lon = ENLARGE_MERCATOR_LON;\r\n        // }\r\n        // if (e.southWest.lat === -90.0) {\r\n        //    em.southWest.lat = -ENLARGE_MERCATOR_LAT;\r\n        // }\r\n        // if (e.southWest.lon === -180.0) {\r\n        //    em.southWest.lon = -ENLARGE_MERCATOR_LON;\r\n        // }\r\n    }\r\n\r\n    public get opacity(): number {\r\n        return this._opacity;\r\n    }\r\n\r\n    public get screenOpacity(): number {\r\n        return this._fading ? this._fadingOpacity : this._opacity;\r\n    }\r\n\r\n    public _refreshFadingOpacity() {\r\n        let p = this._planet!;\r\n        if (\r\n            this._visibility && p.getViewExtent().overlaps(this._extent) &&\r\n            p.maxCurrZoom >= this.minZoom &&\r\n            p.minCurrZoom <= this.maxZoom\r\n        ) {\r\n            this._fadingOpacity += this._fadingFactor;\r\n\r\n            if (\r\n                (this._fadingFactor > 0.0 && this._fadingOpacity > this._opacity) ||\r\n                (this._fadingFactor < 0.0 && this._fadingOpacity < this._opacity)\r\n            ) {\r\n                this._fadingOpacity = this._opacity;\r\n            }\r\n\r\n            return false;\r\n        } else {\r\n            this._fadingOpacity -= this._fadingFactor;\r\n            if (this._fadingOpacity <= 0) {\r\n                this._fadingOpacity = 0.0;\r\n            }\r\n            return false;\r\n        }\r\n    }\r\n\r\n    public createMaterial(segment: Segment): Material {\r\n        return new Material(segment, this);\r\n    }\r\n\r\n    public redraw() {\r\n        this._planet?.quadTreeStrategy.clearLayerMaterial(this);\r\n    }\r\n\r\n    public abortMaterialLoading(material: Material) {\r\n\r\n    }\r\n\r\n    public abortLoading() {\r\n\r\n    }\r\n}\r\n\r\nexport type LayerEventsList = [\r\n    \"visibilitychange\",\r\n    \"add\",\r\n    \"remove\",\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\"\r\n];\r\n\r\nexport const LAYER_EVENTS: LayerEventsList = [\r\n    /**\r\n     * Triggered when layer visibility changed.\r\n     * @event og.Layer#visibilitychange\r\n     */\r\n    \"visibilitychange\",\r\n\r\n    /**\r\n     * Triggered when layer has added to the planet.\r\n     * @event og.Layer#add\r\n     */\r\n    \"add\",\r\n\r\n    /**\r\n     * Triggered when layer has removed from the planet.\r\n     * @event og.Layer#remove\r\n     */\r\n    \"remove\",\r\n\r\n    /**\r\n     * Triggered when mouse moves over the layer.\r\n     * @event og.Layer#mousemove\r\n     */\r\n    \"mousemove\",\r\n\r\n    /**\r\n     * Triggered when mouse has entered over the layer.\r\n     * @event og.Layer#mouseenter\r\n     */\r\n    \"mouseenter\",\r\n\r\n    /**\r\n     * Triggered when mouse leaves the layer.\r\n     * @event og.Layer#mouseenter\r\n     */\r\n    \"mouseleave\",\r\n\r\n    /**\r\n     * Mouse left button clicked.\r\n     * @event og.Layer#lclick\r\n     */\r\n    \"lclick\",\r\n\r\n    /**\r\n     * Mouse right button clicked.\r\n     * @event og.Layer#rclick\r\n     */\r\n    \"rclick\",\r\n\r\n    /**\r\n     * Mouse right button clicked.\r\n     * @event og.Layer#mclick\r\n     */\r\n    \"mclick\",\r\n\r\n    /**\r\n     * Mouse left button double click.\r\n     * @event og.Layer#ldblclick\r\n     */\r\n    \"ldblclick\",\r\n\r\n    /**\r\n     * Mouse right button double click.\r\n     * @event og.Layer#rdblclick\r\n     */\r\n    \"rdblclick\",\r\n\r\n    /**\r\n     * Mouse middle button double click.\r\n     * @event og.Layer#mdblclick\r\n     */\r\n    \"mdblclick\",\r\n\r\n    /**\r\n     * Mouse left button up(stop pressing).\r\n     * @event og.Layer#lup\r\n     */\r\n    \"lup\",\r\n\r\n    /**\r\n     * Mouse right button up(stop pressing).\r\n     * @event og.Layer#rup\r\n     */\r\n    \"rup\",\r\n\r\n    /**\r\n     * Mouse middle button up(stop pressing).\r\n     * @event og.Layer#mup\r\n     */\r\n    \"mup\",\r\n\r\n    /**\r\n     * Mouse left button is just pressed down(start pressing).\r\n     * @event og.Layer#ldown\r\n     */\r\n    \"ldown\",\r\n\r\n    /**\r\n     * Mouse right button is just pressed down(start pressing).\r\n     * @event og.Layer#rdown\r\n     */\r\n    \"rdown\",\r\n\r\n    /**\r\n     * Mouse middle button is just pressed down(start pressing).\r\n     * @event og.Layer#mdown\r\n     */\r\n    \"mdown\",\r\n\r\n    /**\r\n     * Mouse left button is pressing.\r\n     * @event og.Layer#lhold\r\n     */\r\n    \"lhold\",\r\n\r\n    /**\r\n     * Mouse right button is pressing.\r\n     * @event og.Layer#rhold\r\n     */\r\n    \"rhold\",\r\n\r\n    /**\r\n     * Mouse middle button is pressing.\r\n     * @event og.Layer#mhold\r\n     */\r\n    \"mhold\",\r\n\r\n    /**\r\n     * Mouse wheel is rotated.\r\n     * @event og.Layer#mousewheel\r\n     */\r\n    \"mousewheel\",\r\n\r\n    /**\r\n     * Triggered when touching moves over the layer.\r\n     * @event og.Layer#touchmove\r\n     */\r\n    \"touchmove\",\r\n\r\n    /**\r\n     * Triggered when layer begins to touch.\r\n     * @event og.Layer#touchstart\r\n     */\r\n    \"touchstart\",\r\n\r\n    /**\r\n     * Triggered when layer has finished touching.\r\n     * @event og.Layer#touchend\r\n     */\r\n    \"touchend\",\r\n\r\n    /**\r\n     * Triggered layer has double touched.\r\n     * @event og.Layer#doubletouch\r\n     */\r\n    \"doubletouch\",\r\n\r\n    /**\r\n     * Triggered when touching leaves layer borders.\r\n     * @event og.Layer#touchleave\r\n     */\r\n    \"touchleave\",\r\n\r\n    /**\r\n     * Triggered when touch enters over the layer.\r\n     * @event og.Layer#touchenter\r\n     */\r\n    \"touchenter\"\r\n];\r\n\r\nexport {Layer};\r\n","import * as quadTree from \"../quadTree/quadTree\";\r\nimport type {EventCallback, EventsHandler} from \"../Events\";\r\nimport {Layer} from \"./Layer\";\r\nimport type {ILayerParams, LayerEventsList} from \"./Layer\";\r\nimport {Material} from \"../layer/Material\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {Planet} from \"../scene/Planet\";\r\n\r\ntype ApplyImageFunc = (material: HTMLCanvasElement | ImageBitmap | HTMLImageElement) => void;\r\ntype DrawTileCallback = (material: Material, applyImage: ApplyImageFunc) => void;\r\n\r\nexport interface ICanvasTilesParams extends ILayerParams {\r\n    drawTile: DrawTileCallback;\r\n    animated?: boolean;\r\n    minNativeZoom?: number;\r\n    maxNativeZoom?: number;\r\n}\r\n\r\ntype CanvasTilesEventsList = [\r\n    \"load\",\r\n    \"loadend\"\r\n];\r\n\r\ntype CanvasTilesEventsType = EventsHandler<CanvasTilesEventsList> & EventsHandler<LayerEventsList>;\r\n\r\nconst CANVASTILES_EVENTS: CanvasTilesEventsList = [\r\n    /**\r\n     * Triggered when current tile image has loaded before rendering.\r\n     * @event og.layer.CanvasTiles#load\r\n     */\r\n    \"load\",\r\n\r\n    /**\r\n     * Triggered when all tiles have loaded or loading has stopped.\r\n     * @event og.layer.CanvasTiles#loadend\r\n     */\r\n    \"loadend\"\r\n];\r\n\r\n/**\r\n * Layer used to rendering each tile as a separate canvas object.\r\n * @class\r\n * @extends {Layer}\r\n * @param {String} [name=\"noname\"] - Layer name.\r\n * @param {ICanvasTilesParams} options:\r\n * @param {number} [options.opacity=1.0] - Layer opacity.\r\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\r\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\r\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\r\n * @param {boolean} [options.isBaseLayer=false] - Base layer flag.\r\n * @param {boolean} [options.visibility=true] - Layer visibility.\r\n * @param {DrawTileCallback} options.drawTile - Draw tile callback.\r\n * @fires EventsHandler<CanvasTilesEventsList>#load\r\n * @fires EventsHandler<CanvasTilesEventsList>#loadend\r\n */\r\nclass CanvasTiles extends Layer {\r\n\r\n    static MAX_REQUESTS: number = 20;\r\n    static __requestsCounter: number = 0\r\n\r\n    public override events: CanvasTilesEventsType;\r\n\r\n    public animated: boolean;\r\n\r\n    public minNativeZoom: number;\r\n    public maxNativeZoom: number;\r\n\r\n    /**\r\n     * Current creating tiles counter.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _counter: number;\r\n\r\n    /**\r\n     * Tile pending queue that waiting for create.\r\n     * @protected\r\n     * @type {Material[]}\r\n     */\r\n    protected _pendingsQueue: Material[]; // new og.QueueArray();\r\n\r\n    /**\r\n     * Draw tile callback.\r\n     * @type {DrawTileCallback}\r\n     * @public\r\n     */\r\n    public drawTile: DrawTileCallback;\r\n\r\n    protected _onLoadend_: EventCallback | null;\r\n\r\n\r\n    constructor(name: string | null, options: ICanvasTilesParams) {\r\n        super(name, options);\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(CANVASTILES_EVENTS);\r\n\r\n        this.animated = options.animated || false;\r\n\r\n        this.minNativeZoom = options.minNativeZoom || 0;\r\n        this.maxNativeZoom = options.maxNativeZoom || 100;\r\n\r\n        this._counter = 0;\r\n\r\n        this._pendingsQueue = []; // new og.QueueArray();\r\n\r\n        this.drawTile = options.drawTile;\r\n\r\n        this._onLoadend_ = null;\r\n    }\r\n\r\n    public override addTo(planet: Planet) {\r\n        this._onLoadend_ = this._onLoadend.bind(this);\r\n        this.events.on(\"loadend\", this._onLoadend_!, this);\r\n        return super.addTo(planet);\r\n    }\r\n\r\n    public override remove() {\r\n        this.events.off(\"loadend\", this._onLoadend_);\r\n        this._onLoadend_ = null;\r\n        return super.remove();\r\n    }\r\n\r\n    public _onLoadend() {\r\n        if (this._planet && this._planet._terrainCompletedActivated) {\r\n            this._planet.events.dispatch(this._planet.events.layerloadend, this);\r\n        }\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"CanvasTiles\";\r\n    }\r\n\r\n    public override get isIdle() {\r\n        return super.isIdle && this._counter === 0;\r\n    }\r\n\r\n    /**\r\n     * Abort loading tiles.\r\n     * @public\r\n     */\r\n    public override abortLoading() {\r\n        this._pendingsQueue.forEach((qi: Material) => {\r\n            this.abortMaterialLoading(qi);\r\n        })\r\n        this._pendingsQueue = [];\r\n    }\r\n\r\n    /**\r\n     * Sets layer visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Layer visibility.\r\n     */\r\n    public override setVisibility(visibility: boolean) {\r\n        if (visibility !== this._visibility) {\r\n            super.setVisibility(visibility);\r\n\r\n            if (!visibility) {\r\n                this.abortLoading();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Start to load tile material.\r\n     * @public\r\n     * @virtual\r\n     * @param {Material} material -\r\n     */\r\n    public override loadMaterial(material: Material) {\r\n        let seg = material.segment;\r\n\r\n        if (this._isBaseLayer) {\r\n            material.texture = seg.getDefaultTexture();\r\n        } else {\r\n            material.texture = seg.planet.transparentTexture;\r\n        }\r\n\r\n        if (this._planet!.layerLock.isFree() || material.segment.tileZoom < 2) {\r\n            material.isReady = false;\r\n            material.isLoading = true;\r\n            if (CanvasTiles.__requestsCounter >= CanvasTiles.MAX_REQUESTS && this._counter) {\r\n                this._pendingsQueue.push(material);\r\n            } else {\r\n                this._exec(material);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Loads material image and apply it to the planet segment.\r\n     * @protected\r\n     * @param {Material} material - Loads material image.\r\n     */\r\n    protected _exec(material: Material) {\r\n        CanvasTiles.__requestsCounter++;\r\n        this._counter++;\r\n        const e = this.events.load!;\r\n        if (e.handlers.length) {\r\n            this.events.dispatch(e, material);\r\n        }\r\n        requestAnimationFrame(() => {\r\n            this.drawTile(material, (canvas: HTMLCanvasElement | ImageBitmap | HTMLImageElement) => {\r\n                this._counter--;\r\n                CanvasTiles.__requestsCounter--;\r\n                this._correctCounter();\r\n                if (material.isLoading) {\r\n                    material.applyImage(canvas);\r\n                }\r\n                this._dequeueRequest();\r\n            });\r\n        });\r\n    }\r\n\r\n    protected _correctCounter() {\r\n        if (this._counter < 0) this._counter = 0;\r\n        if (CanvasTiles.__requestsCounter < 0) CanvasTiles.__requestsCounter = 0;\r\n    }\r\n\r\n    /**\r\n     * Abort exact material loading.\r\n     * @public\r\n     * @param {Material} material - Segment material.\r\n     */\r\n    public override abortMaterialLoading(material: Material) {\r\n        if (material.isLoading) {\r\n            this._counter--;\r\n            CanvasTiles.__requestsCounter--;\r\n            this._correctCounter();\r\n            this._dequeueRequest();\r\n        }\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n\r\n    protected _dequeueRequest() {\r\n        if (this._pendingsQueue.length) {\r\n            if (CanvasTiles.__requestsCounter < CanvasTiles.MAX_REQUESTS) {\r\n                const pmat = this._whilePendings();\r\n                if (pmat) {\r\n                    this._exec(pmat);\r\n                }\r\n            }\r\n        } else if (this._counter === 0 && this._planet && this._planet._terrainCompletedActivated) {\r\n            this.events.dispatch(this.events.loadend);\r\n        }\r\n    }\r\n\r\n    protected _whilePendings(): Material | null {\r\n        while (this._pendingsQueue.length) {\r\n            const pmat = this._pendingsQueue.pop();\r\n            if (pmat && pmat.segment && pmat.segment.node) {\r\n                if (pmat.segment.initialized && pmat.segment.node.getState() === quadTree.RENDERING) {\r\n                    return pmat;\r\n                }\r\n                pmat.isLoading = false;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    public override applyMaterial(material: Material): NumberArray4 {\r\n        if (material.isReady) {\r\n\r\n            // IMPORTANT!\r\n            // Animated doesn't work withMaxNativeZoom\r\n            // It could be fixed with call drawTile method only for parent\r\n            // material (which is rendered on the current segment material),\r\n            // just for one renderer frame\r\n            if ((material.layer as CanvasTiles).animated) {\r\n                requestAnimationFrame(() => {\r\n                    this.drawTile(material, function (canvas) {\r\n                        material.applyImage(canvas);\r\n                    });\r\n                });\r\n            }\r\n\r\n            return material.texOffset;\r\n\r\n        } else if (material.segment.tileZoom < this.minNativeZoom) {\r\n            material.textureNotExists();\r\n        } else {\r\n\r\n            let segment = material.segment;\r\n            let pn = segment.node,\r\n                parentTextureExists = false;\r\n            let maxNativeZoom = (material.layer as CanvasTiles).maxNativeZoom;\r\n\r\n            if (segment.passReady && !material.isLoading && segment.tileZoom <= maxNativeZoom) {\r\n                this.loadMaterial(material);\r\n            }\r\n\r\n            let mId = this._id;\r\n            let psegm = material;\r\n            while (pn.parentNode) {\r\n                pn = pn.parentNode;\r\n                psegm = pn.segment.materials[mId];\r\n                if (psegm && psegm.textureExists) {\r\n                    parentTextureExists = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (segment.passReady) {\r\n                if (pn.segment.tileZoom === maxNativeZoom) {\r\n                    if (segment.tileZoom > maxNativeZoom) {\r\n                        material.textureNotExists();\r\n                    }\r\n                } else if (pn.segment.tileZoom < maxNativeZoom) {\r\n\r\n                    let pn = segment.node;\r\n                    while (pn.segment.tileZoom > maxNativeZoom) {\r\n                        pn = pn.parentNode!;\r\n                    }\r\n\r\n                    let pnm = pn.segment.materials[mId];\r\n                    if (pnm) {\r\n                        !pnm.isLoading && !pnm.isReady && this.loadMaterial(pnm);\r\n                    } else {\r\n                        pnm = pn.segment.materials[material.layer._id] = material.layer.createMaterial(\r\n                            pn.segment\r\n                        );\r\n                        this.loadMaterial(pnm);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (parentTextureExists) {\r\n\r\n                //\r\n                // Animated doesn't work withMaxNativeZoom\r\n                //\r\n                if ((material.layer as CanvasTiles).animated) {\r\n                    requestAnimationFrame(() => {\r\n                        this.drawTile(material, function (canvas) {\r\n                            material.applyImage(canvas);\r\n                        });\r\n                    });\r\n                }\r\n\r\n                material.appliedNodeId = pn.nodeId;\r\n                material.texture = psegm.texture;\r\n                let dZ2 = 1.0 / (2 << (segment.tileZoom - pn.segment.tileZoom - 1));\r\n                material.texOffset[0] = segment.tileX * dZ2 - pn.segment.tileX;\r\n                material.texOffset[1] = segment.tileY * dZ2 - pn.segment.tileY;\r\n                material.texOffset[2] = dZ2;\r\n                material.texOffset[3] = dZ2;\r\n            } else {\r\n                material.texture = segment.planet.transparentTexture;\r\n                material.texOffset[0] = 0.0;\r\n                material.texOffset[1] = 0.0;\r\n                material.texOffset[2] = 1.0;\r\n                material.texOffset[3] = 1.0;\r\n            }\r\n        }\r\n\r\n        return material.texOffset;\r\n    }\r\n\r\n    public override clearMaterial(material: Material) {\r\n        if (material.isReady) {\r\n            material.isReady = false;\r\n            if (material.textureExists && material.texture && !material.texture.default) {\r\n                material.segment.handler.gl!.deleteTexture(material.texture);\r\n                material.texture = null;\r\n            }\r\n        }\r\n\r\n        this.abortMaterialLoading(material);\r\n        material.isLoading = false;\r\n        material.textureExists = false;\r\n\r\n        //@ts-ignore\r\n        material.layer = null;\r\n        //@ts-ignore\r\n        material.segment = null;\r\n\r\n        // if (material.image) {\r\n        //     material.image.src = \"\";\r\n        //     material.image = null;\r\n        // }\r\n    }\r\n}\r\n\r\nexport {CanvasTiles};\r\n","import {Control, type IControlParams} from \"./Control\";\r\nimport {Dialog} from \"../ui/Dialog\";\r\nimport {ToggleButton} from \"../ui/ToggleButton\";\r\nimport {GlobusTerrain} from \"../terrain/GlobusTerrain\";\r\nimport {CanvasTiles} from \"../layer/CanvasTiles\";\r\nimport {DEGREES} from \"../math\";\r\n\r\nconst ICON_LOCK_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\r\n<svg fill=\"#000000\" width=\"800px\" height=\"800px\" viewBox=\"-7.5 0 32 32\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\r\n<title>lock</title>\r\n<path d=\"M14.625 15.156h2.094c0.281 0 0.5 0.25 0.5 0.531v11c0 0.281-0.219 0.5-0.5 0.5h-16.219c-0.281 0-0.5-0.219-0.5-0.5v-11c0-0.281 0.219-0.531 0.5-0.531h2.031v-5.125c0-2.875 1.844-5.25 4.688-5.25h2.688c2.875 0 4.719 2.375 4.719 5.25v5.125zM5.188 15.156h6.813v-4.875c0-1.594-1.313-2.938-2.938-2.938h-0.969c-1.594 0-2.906 1.344-2.906 2.938v4.875zM7.156 24h2.906l-0.719-3.156c0.5-0.25 0.844-0.781 0.844-1.375 0-0.906-0.719-1.594-1.594-1.594s-1.563 0.688-1.563 1.594c0 0.594 0.344 1.125 0.844 1.375z\"></path>\r\n</svg>`;\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\r\n<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\r\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\r\n<svg fill=\"#000000\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \r\n\\t width=\"800px\" height=\"800px\" viewBox=\"0 0 932.179 932.179\"\r\n\\t xml:space=\"preserve\">\r\n<g>\r\n\\t<path d=\"M61.2,341.538c4.9,16.8,11.7,33,20.3,48.2l-24.5,30.9c-8,10.1-7.1,24.5,1.9,33.6l42.2,42.2c9.1,9.1,23.5,9.899,33.6,1.899\r\n\\t\\tl30.7-24.3c15.8,9.101,32.6,16.2,50.1,21.2l4.6,39.5c1.5,12.8,12.3,22.4,25.1,22.4h59.7c12.8,0,23.6-9.601,25.1-22.4l4.4-38.1\r\n\\t\\tc18.8-4.9,36.8-12.2,53.7-21.7l29.7,23.5c10.1,8,24.5,7.1,33.6-1.9l42.2-42.2c9.1-9.1,9.9-23.5,1.9-33.6l-23.1-29.3\r\n\\t\\tc9.6-16.601,17.1-34.3,22.1-52.8l35.6-4.1c12.801-1.5,22.4-12.3,22.4-25.1v-59.7c0-12.8-9.6-23.6-22.4-25.1l-35.1-4.1\r\n\\t\\tc-4.801-18.3-12-35.8-21.199-52.2l21.6-27.3c8-10.1,7.1-24.5-1.9-33.6l-42.1-42.1c-9.1-9.1-23.5-9.9-33.6-1.9l-26.5,21\r\n\\t\\tc-17.2-10.1-35.601-17.8-54.9-23l-4-34.3c-1.5-12.8-12.3-22.4-25.1-22.4h-59.7c-12.8,0-23.6,9.6-25.1,22.4l-4,34.3\r\n\\t\\tc-19.8,5.3-38.7,13.3-56.3,23.8l-27.5-21.8c-10.1-8-24.5-7.1-33.6,1.9l-42.2,42.2c-9.1,9.1-9.9,23.5-1.9,33.6l23,29.1\r\n\\t\\tc-9.2,16.6-16.2,34.3-20.8,52.7l-36.8,4.2c-12.8,1.5-22.4,12.3-22.4,25.1v59.7c0,12.8,9.6,23.6,22.4,25.1L61.2,341.538z\r\n\\t\\t M277.5,180.038c54.4,0,98.7,44.3,98.7,98.7s-44.3,98.7-98.7,98.7c-54.399,0-98.7-44.3-98.7-98.7S223.1,180.038,277.5,180.038z\"/>\r\n\\t<path d=\"M867.699,356.238l-31.5-26.6c-9.699-8.2-24-7.8-33.199,0.9l-17.4,16.3c-14.699-7.1-30.299-12.1-46.4-15l-4.898-24\r\n\\t\\tc-2.5-12.4-14-21-26.602-20l-41.1,3.5c-12.6,1.1-22.5,11.4-22.9,24.1l-0.799,24.4c-15.801,5.7-30.701,13.5-44.301,23.3\r\n\\t\\tl-20.799-13.8c-10.602-7-24.701-5-32.9,4.7l-26.6,31.7c-8.201,9.7-7.801,24,0.898,33.2l18.201,19.399\r\n\\t\\tc-6.301,14.2-10.801,29.101-13.4,44.4l-26,5.3c-12.4,2.5-21,14-20,26.601l3.5,41.1c1.1,12.6,11.4,22.5,24.1,22.9l28.1,0.899\r\n\\t\\tc5.102,13.4,11.801,26.101,19.9,38l-15.699,23.7c-7,10.6-5,24.7,4.699,32.9l31.5,26.6c9.701,8.2,24,7.8,33.201-0.9l20.6-19.3\r\n\\t\\tc13.5,6.3,27.699,11,42.299,13.8l5.701,28.2c2.5,12.4,14,21,26.6,20l41.1-3.5c12.6-1.1,22.5-11.399,22.9-24.1l0.9-27.601\r\n\\t\\tc15-5.3,29.199-12.5,42.299-21.399l22.701,15c10.6,7,24.699,5,32.9-4.7l26.6-31.5c8.199-9.7,7.799-24-0.9-33.2l-18.301-19.399\r\n\\t\\tc6.701-14.2,11.602-29.2,14.4-44.601l25-5.1c12.4-2.5,21-14,20-26.601l-3.5-41.1c-1.1-12.6-11.4-22.5-24.1-22.9l-25.1-0.8\r\n\\t\\tc-5.201-14.6-12.201-28.399-20.9-41.2l13.699-20.6C879.4,378.638,877.4,364.438,867.699,356.238z M712.801,593.837\r\n\\t\\tc-44.4,3.801-83.602-29.3-87.301-73.699c-3.801-44.4,29.301-83.601,73.699-87.301c44.4-3.8,83.602,29.301,87.301,73.7\r\n\\t\\tC790.301,550.938,757.199,590.138,712.801,593.837z\"/>\r\n\\t<path d=\"M205,704.438c-12.6,1.3-22.3,11.899-22.4,24.6l-0.3,25.3c-0.2,12.7,9.2,23.5,21.8,25.101l18.6,2.399\r\n\\t\\tc3.1,11.301,7.5,22.101,13.2,32.301l-12,14.8c-8,9.899-7.4,24.1,1.5,33.2l17.7,18.1c8.9,9.1,23.1,10.1,33.2,2.3l14.899-11.5\r\n\\t\\tc10.5,6.2,21.601,11.101,33.2,14.5l2,19.2c1.3,12.6,11.9,22.3,24.6,22.4l25.301,0.3c12.699,0.2,23.5-9.2,25.1-21.8l2.3-18.2\r\n\\t\\tc12.601-3.101,24.601-7.8,36-14l14,11.3c9.9,8,24.101,7.4,33.201-1.5l18.1-17.7c9.1-8.899,10.1-23.1,2.301-33.2L496.6,818.438\r\n\\t\\tc6.6-11,11.701-22.7,15.201-35l16.6-1.7c12.6-1.3,22.299-11.9,22.4-24.6l0.299-25.301c0.201-12.699-9.199-23.5-21.799-25.1\r\n\\t\\tl-16.201-2.1c-3.1-12.2-7.699-24-13.699-35l10.1-12.4c8-9.9,7.4-24.1-1.5-33.2l-17.699-18.1c-8.9-9.101-23.102-10.101-33.201-2.3\r\n\\t\\tl-12.101,9.3c-11.399-6.9-23.6-12.2-36.399-15.8l-1.601-15.7c-1.3-12.601-11.899-22.3-24.6-22.4l-25.3-0.3\r\n\\t\\tc-12.7-0.2-23.5,9.2-25.101,21.8l-2,15.601c-13.199,3.399-25.899,8.6-37.699,15.399l-12.5-10.2c-9.9-8-24.101-7.399-33.201,1.5\r\n\\t\\tl-18.2,17.801c-9.1,8.899-10.1,23.1-2.3,33.199l10.7,13.801c-6.2,11-11.1,22.699-14.3,35L205,704.438z M368.3,675.837\r\n\\t\\tc36.3,0.4,65.399,30.301,65,66.601c-0.4,36.3-30.301,65.399-66.601,65c-36.3-0.4-65.399-30.3-65-66.601\r\n\\t\\tC302.1,704.538,332,675.438,368.3,675.837z\"/>\r\n</g>\r\n</svg>`;\r\n\r\nconst ICON_CANVASTILES_SVG = `<?xml version=\"1.0\"?>\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\r\n    <path d=\"M 4 4 L 4 8 L 8 8 L 8 4 L 4 4 z M 10 4 L 10 8 L 14 8 L 14 4 L 10 4 z M 16 4 L 16 8 L 20 8 L 20 4 L 16 4 z M 4 10 L 4 14 L 8 14 L 8 10 L 4 10 z M 10 10 L 10 14 L 14 14 L 14 10 L 10 10 z M 16 10 L 16 14 L 20 14 L 20 10 L 16 10 z M 4 16 L 4 20 L 8 20 L 8 16 L 4 16 z M 10 16 L 10 20 L 14 20 L 14 16 L 10 16 z M 16 16 L 16 20 L 20 20 L 20 16 L 16 16 z\"/>\r\n</svg>`;\r\n\r\nexport interface IDebugInfoWatch {\r\n    label: string;\r\n    valEl?: HTMLElement;\r\n    frame?: () => string | number;\r\n}\r\n\r\ninterface IDebugInfoParams extends IControlParams {\r\n    watch?: IDebugInfoWatch[];\r\n}\r\n\r\nexport class DebugInfo extends Control {\r\n    public el: HTMLElement | null;\r\n    protected _watch: IDebugInfoWatch[];\r\n    protected _toggleBtn: ToggleButton;\r\n    protected _dialog: Dialog<null>;\r\n\r\n    protected _canvasTiles: CanvasTiles;\r\n\r\n    constructor(options: IDebugInfoParams = {}) {\r\n        if (!options.name || options.name === \"\") {\r\n            options.name = \"DebugInfo\";\r\n        }\r\n        super(options);\r\n        this.el = null;\r\n        this._watch = options.watch || [];\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-debuginfo_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        this._dialog = new Dialog({\r\n            title: \"Debug Info\",\r\n            visible: false,\r\n            useHide: true,\r\n            top: 120,\r\n            left: 60,\r\n            width: 480\r\n        });\r\n\r\n        this._dialog.events.on(\"visibility\", (v: boolean) => {\r\n            this._toggleBtn.setActive(v);\r\n        });\r\n\r\n        this._canvasTiles = new CanvasTiles(\"Tile grid\", {\r\n            visibility: true,\r\n            isBaseLayer: false,\r\n            hideInLayerSwitcher: true,\r\n            drawTile: function (material: any, applyCanvas: any) {\r\n\r\n                //\r\n                // This is important create canvas here!\r\n                //\r\n                let cnv = document.createElement(\"canvas\");\r\n                let ctx = cnv.getContext(\"2d\")!;\r\n                cnv.width = 256;\r\n                cnv.height = 256;\r\n\r\n                //Clear canvas\r\n                ctx.clearRect(0, 0, cnv.width, cnv.height);\r\n\r\n                //Draw border\r\n                ctx.beginPath();\r\n                ctx.rect(0, 0, cnv.width, cnv.height);\r\n                ctx.lineWidth = 2;\r\n                ctx.strokeStyle = 'black';\r\n                ctx.stroke();\r\n\r\n                let size;\r\n\r\n                // if (material.segment.isPole) {\r\n                //     let ext = material.segment.getExtentLonLat();\r\n                //\r\n                //     ctx.fillStyle = 'black';\r\n                //     ctx.font = 'normal ' + 29 + 'px Verdana';\r\n                //\r\n                //     ctx.textAlign = 'center';\r\n                //     ctx.fillText(`${ext.northEast.lon.toFixed(3)} ${ext.northEast.lat.toFixed(3)}`, cnv.width / 2, cnv.height / 2 + 20);\r\n                //     ctx.fillText(`${ext.southWest.lon.toFixed(3)} ${ext.southWest.lat.toFixed(3)}`, cnv.width / 2, cnv.height / 2 - 20);\r\n                // } else {\r\n                //Draw text\r\n                if (material.segment.tileZoom > 14) {\r\n                    size = \"26\";\r\n                } else {\r\n                    size = \"32\";\r\n                }\r\n                ctx.fillStyle = 'black';\r\n                ctx.font = 'normal ' + size + 'px Verdana';\r\n                ctx.textAlign = 'center';\r\n                ctx.fillText(material.segment.tileX + \",\" + material.segment.tileY + \",\" + material.segment.tileZoom, cnv.width / 2, cnv.height / 2);\r\n                //}\r\n\r\n                //Draw canvas tile\r\n                applyCanvas(cnv);\r\n            }\r\n        });\r\n    }\r\n\r\n    public addWatches(watches: IDebugInfoWatch[]) {\r\n        for (let i = 0; i < watches.length; i++) {\r\n            this.addWatch(watches[i]);\r\n        }\r\n    }\r\n\r\n    public addWatch(watch: IDebugInfoWatch) {\r\n        this._watch.push(watch);\r\n        let watchEl = document.createElement(\"div\");\r\n        watchEl.classList.add(\"og-watch-line\");\r\n        watchEl.innerHTML = `<div class=\"og-watch-label\">${watch.label}</div><div class=\"og-watch-value\"></div>`;\r\n        watch.valEl = watchEl.querySelector<HTMLElement>(\".og-watch-value\")!;\r\n        this.el!.appendChild(watchEl);\r\n    }\r\n\r\n    public override oninit() {\r\n\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n        this._dialog.appendTo(this.renderer!.div!);\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this._dialog.setVisibility(isActive);\r\n        });\r\n\r\n        this.el = document.createElement(\"div\");\r\n        this.el.className = \"og-debug-info\";\r\n\r\n        let $controls = document.createElement(\"div\");\r\n        $controls.classList.add(\"og-debuginfo_controls\");\r\n        this.el.appendChild($controls);\r\n\r\n        let temp = this._watch;\r\n        this._watch = [];\r\n        for (let i = 0; i < temp.length; i++) {\r\n            this.addWatch(temp[i]);\r\n        }\r\n        this._dialog.container?.appendChild(this.el);\r\n        this.renderer!.events.on(\"draw\", this._frame, this);\r\n\r\n        let p = this.planet!;\r\n\r\n        if (p) {\r\n            this.addWatches([\r\n                {\r\n                    label: \"Nodes count\",\r\n                    frame: () => p!._renderedNodes.length\r\n                },\r\n                {\r\n                    label: \"Planet._fadingNodes\",\r\n                    frame: () => p._fadingNodes.size\r\n                },\r\n                {\r\n                    label: \"createdNodes\",\r\n                    frame: () => p._createdNodesCount\r\n                },\r\n                {\r\n                    label: \"indexesCache\",\r\n                    frame: () => p._indexesCacheToRemoveCounter\r\n                },\r\n                {\r\n                    label: \"distBeforeMemClear\",\r\n                    frame: () => Math.round(p._distBeforeMemClear)\r\n                },\r\n                {\r\n                    label: \"maxZoom/minZoom\",\r\n                    frame: () => p.maxCurrZoom + \" / \" + p?.minCurrZoom\r\n                },\r\n                {\r\n                    label: \"viewExtent\",\r\n                    frame: () => p.getViewExtent().toString()\r\n                },\r\n                {\r\n                    label: \"Mouse distance, m\",\r\n                    frame: () => {\r\n                        let cart = p.getCartesianFromMouseTerrain();\r\n                        if (cart) {\r\n                            return p.camera.eye.distance(cart).toFixed(3);\r\n                        }\r\n                        return \"\";\r\n                    }\r\n                },\r\n                {\r\n                    label: \"lodSize\",\r\n                    frame: () => Math.round(p.lodSize)\r\n                },\r\n                {\r\n                    label: \"deltaTime/FPS\",\r\n                    frame: () =>\r\n                        `<div style=\"width:70px\"><div style=\"width:20px; float: left;\">\r\n                        ${Math.round(p.renderer!.handler.deltaTime)}\r\n                        </div> <div style=\"float: left\">\r\n                        ${Math.round(1000.0 / p.renderer!.handler.deltaTime)}\r\n                        </div></div>`\r\n                },\r\n                {\r\n                    label: \"-------------------------\"\r\n                },\r\n                {\r\n                    label: \"Pitch, deg\",\r\n                    frame: () => (p.camera.getPitch() * DEGREES).toFixed(2)\r\n                },\r\n                {\r\n                    label: \"Yaw, deg\",\r\n                    frame: () => (p.camera.getYaw() * DEGREES).toFixed(2)\r\n                },\r\n                {\r\n                    label: \"Roll, deg\",\r\n                    frame: () => (p.camera.getRoll() * DEGREES).toFixed(2)\r\n                },\r\n                {\r\n                    label: \"Lon, Lat\",\r\n                    frame: () =>\r\n                        `<div style=\"width:190px\">${(p.camera._lonLat.lon).toFixed(7)}, ${(p.camera._lonLat.lon).toFixed(7)}</div>`\r\n                },\r\n                {\r\n                    label: \"height/alt, m\",\r\n                    frame: () =>\r\n                        `<div style=\"width:190px\">${(p.camera._lonLat.height).toFixed(2) +\r\n                        \" / \" +\r\n                        (p.camera.getAltitude()).toFixed(2)}</div>`\r\n                },\r\n                {\r\n                    label: \"cam.slope\",\r\n                    frame: () => p.camera.slope.toFixed(3)\r\n                },\r\n                {\r\n                    label: \"-------------------------\"\r\n                },\r\n                {\r\n                    label: \"_renderCompleted / renderCompletedActivated\",\r\n                    frame: () => `${p._renderCompleted} / ${p._renderCompletedActivated}`\r\n                },\r\n                {\r\n                    label: \"_terrainCompleted / terrainCompletedActivated\",\r\n                    frame: () => `${p._terrainCompleted} / ${p._terrainCompletedActivated}`\r\n                },\r\n                {\r\n                    label: \"PlainWorker\",\r\n                    frame: () => p._plainSegmentWorker.pendingQueue.length\r\n                },\r\n                {\r\n                    label: \"TileLoader\",\r\n                    frame: () => `${p._tileLoader.loading} ${p._tileLoader.queue.length}`\r\n                },\r\n                {\r\n                    label: \"TerrainLoader\",\r\n                    frame: () => {\r\n                        if (p.terrain && !p.terrain.isEmpty) {\r\n                            return `${(p.terrain as GlobusTerrain).loader.loading}  ${(p.terrain as GlobusTerrain).loader.queue.length}`\r\n                        }\r\n                        return \"\";\r\n                    }\r\n                },\r\n                {\r\n                    label: \"TerrainWorker\",\r\n                    frame: () => p._terrainWorker.pendingQueue.length\r\n                },\r\n                {\r\n                    label: \"NormalMapCreator\",\r\n                    frame: () => p._normalMapCreator.queueSize\r\n                },\r\n                {\r\n                    label: \"VectorTileCreator\",\r\n                    frame: () => p._vectorTileCreator.queueSize\r\n                }\r\n            ]);\r\n        }\r\n\r\n        let lockTreeBtn = new ToggleButton({\r\n            classList: [\"og-debuginfo_controls-button\"],\r\n            icon: ICON_LOCK_BUTTON_SVG,\r\n            title: \"Lock/Unlock quad tree\"\r\n        });\r\n        lockTreeBtn.appendTo($controls);\r\n\r\n        lockTreeBtn.events.on(\"change\", (isActive: boolean) => {\r\n            if (isActive) {\r\n                p.lockQuadTree();\r\n            } else {\r\n                p.unlockQuadTree();\r\n            }\r\n        });\r\n\r\n        let canvasTilesBtn = new ToggleButton({\r\n            classList: [\"og-debuginfo_controls-button\"],\r\n            icon: ICON_CANVASTILES_SVG,\r\n            title: \"Show/Hide grid\"\r\n        });\r\n        canvasTilesBtn.appendTo($controls);\r\n\r\n        canvasTilesBtn.events.on(\"change\", (isActive: boolean) => {\r\n            if (isActive) {\r\n                this.planet!.addLayer(this._canvasTiles);\r\n            } else {\r\n                this._canvasTiles.remove();\r\n            }\r\n        });\r\n    }\r\n\r\n    protected _frame() {\r\n        this._watch.forEach((w) => {\r\n            if (w.valEl) {\r\n                w.valEl.innerHTML = w.frame ? String(w.frame()) : \"\";\r\n            }\r\n        });\r\n    }\r\n}","import {ToggleButton} from \"./ToggleButton\";\r\nimport {createEvents} from '../Events';\r\nimport type {EventsHandler} from '../Events';\r\n\r\ninterface IButtonGroupParams {\r\n    buttons?: ToggleButton[];\r\n}\r\n\r\ntype ButtonGroupEventsList = [\"change\"];\r\n\r\nconst BUTTONGROUP_EVENTS: ButtonGroupEventsList = [\"change\"];\r\n\r\nclass ButtonGroup {\r\n\r\n    public events: EventsHandler<ButtonGroupEventsList>;\r\n\r\n    protected _buttons: ToggleButton[];\r\n\r\n    constructor(options: IButtonGroupParams = {}) {\r\n\r\n        this.events = createEvents<ButtonGroupEventsList>(BUTTONGROUP_EVENTS);\r\n\r\n        this._buttons = options.buttons || [];\r\n\r\n        for (let i = 0; i < this._buttons.length; i++) {\r\n            this._bindButton(this._buttons[i]);\r\n        }\r\n    }\r\n\r\n    protected _bindButton(button: ToggleButton) {\r\n        button.events.on(\"change\", this._onChange);\r\n    }\r\n\r\n    public add(button: ToggleButton) {\r\n        this._buttons.push(button);\r\n        this._bindButton(button);\r\n    }\r\n\r\n    protected _onChange = (isActive: boolean, btn: ToggleButton) => {\r\n        if (isActive) {\r\n            btn.preventClick = true;\r\n            for (let i = 0; i < this._buttons.length; i++) {\r\n                let bi = this._buttons[i];\r\n                if (!bi.isEqual(btn)) {\r\n                    bi.setActive(false);\r\n                    bi.preventClick = false;\r\n                }\r\n            }\r\n            this.events.dispatch(this.events.change, btn);\r\n        }\r\n    }\r\n\r\n    public remove(button: ToggleButton) {\r\n        for (let i = 0; i < this._buttons.length; i++) {\r\n            if (this._buttons[i].isEqual(button)) {\r\n                this._buttons.splice(i);\r\n                button.events.off(\"change\", this._onChange);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {ButtonGroup}","import {isString} from \"./shared\";\r\n\r\nexport class BaseWorker<T> {\r\n    protected _sourceId: number;\r\n    protected _source: Map<number, T>;\r\n    protected _pendingQueue: T[];\r\n    protected _numWorkers: number;\r\n    protected _workerQueue: Worker[];\r\n\r\n    constructor(numWorkers: number = 2, program?: any) {\r\n        this._sourceId = 0;\r\n        this._source = new Map<number, T>();\r\n        this._pendingQueue = [];\r\n        this._numWorkers = numWorkers;\r\n        this._workerQueue = [];\r\n        if (program) {\r\n            this.setProgram(program);\r\n        }\r\n    }\r\n\r\n    public check() {\r\n        if (this._pendingQueue.length) {\r\n            this.make(this._pendingQueue.pop()!);\r\n        }\r\n    }\r\n\r\n    public setProgram(program: any) {\r\n        if (isString(program)) {\r\n            let p = new Blob([program], {type: \"application/javascript\"});\r\n            for (let i = 0; i < this._numWorkers; i++) {\r\n                let w = new Worker(URL.createObjectURL(p));\r\n                w.onmessage = (e: MessageEvent) => {\r\n                    this._onMessage(e);\r\n                    this._workerQueue && this._workerQueue.unshift(e.target as Worker);\r\n                    this.check();\r\n                }\r\n                this._workerQueue.push(w);\r\n            }\r\n        } else {\r\n            for (let i = 0; i < this._numWorkers; i++) {\r\n                let w = new program();\r\n                w.onmessage = (e: MessageEvent) => {\r\n                    this._onMessage(e);\r\n                    this._workerQueue && this._workerQueue.unshift(e.target as Worker);\r\n                    this.check();\r\n                }\r\n                this._workerQueue.push(w);\r\n            }\r\n        }\r\n    }\r\n\r\n    public make(data: T) {\r\n    }\r\n\r\n    protected _onMessage(e: MessageEvent) {\r\n\r\n    }\r\n\r\n    public destroy() {\r\n        for (let i = 0; i < this._workerQueue.length; i++) {\r\n            const w = this._workerQueue[i];\r\n            w.onmessage = null;\r\n            w.terminate();\r\n        }\r\n        //@ts-ignore\r\n        this._pendingQueue = null;\r\n        //@ts-ignore\r\n        this._workerQueue = null;\r\n    }\r\n\r\n    public get pendingQueue(): T[] {\r\n        return this._pendingQueue;\r\n    }\r\n}","import {BaseWorker} from \"../utils/BaseWorker\";\r\nimport {Label} from \"../entity/Label\";\r\nimport {LabelHandler} from \"../entity/LabelHandler\";\r\n\r\n//@ts-ignore\r\nimport LabelWorkerImpl from './LabelWorker.worker.js?worker&inline';\r\n\r\nexport const LOCK_UPDATE = -2;\r\nexport const LOCK_FREE = -1;\r\n\r\ninterface LabelInfo {\r\n    label: Label;\r\n    handler: LabelHandler;\r\n}\r\n\r\nclass LabelWorker extends BaseWorker<LabelInfo> {\r\n\r\n    constructor(numWorkers: number = 4) {\r\n        super(numWorkers, LabelWorkerImpl);\r\n    }\r\n\r\n    protected override _onMessage(e: MessageEvent) {\r\n        let s = this._source.get(e.data.id)!;\r\n\r\n        if (s.label._lockId === LOCK_UPDATE) {\r\n            requestAnimationFrame(() => {\r\n                this.make({handler: s.handler, label: s.label});\r\n            });\r\n        } else {\r\n            s.handler.workerCallback(e.data, s.label);\r\n        }\r\n\r\n        this._source.delete(e.data.id);\r\n    }\r\n\r\n\r\n    public override make(data: LabelInfo) {\r\n        let label = data.label,\r\n            handler = data.handler;\r\n\r\n        if (handler._entityCollection) {\r\n            let labelData = label.serializeWorkerData(this._sourceId);\r\n            if (labelData) {\r\n                if (this._workerQueue.length) {\r\n                    let w = this._workerQueue.pop()!;\r\n                    this._source.set(this._sourceId, data);\r\n                    label._lockId = this._sourceId;\r\n                    this._sourceId++;\r\n                    w.postMessage({\r\n                        labelData: labelData\r\n                    }, [\r\n                        labelData.buffer,\r\n                    ]);\r\n                } else {\r\n                    this._pendingQueue.push(data);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {LabelWorker};","import * as utils from \"../utils/shared\";\r\nimport {Entity} from \"./Entity\";\r\nimport {LOCK_FREE, LOCK_UPDATE} from \"./LabelWorker\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {BaseBillboardHandler} from \"./BaseBillboardHandler\";\r\n\r\nexport interface IBaseBillboardParams {\r\n    position?: NumberArray3 | Vec3;\r\n    rotation?: number;\r\n    color?: string | NumberArray4 | Vec4;\r\n    alignedAxis?: NumberArray3 | Vec3;\r\n    offset?: NumberArray2 | NumberArray3 | Vec2 | Vec3;\r\n    visibility?: boolean;\r\n}\r\n\r\n/**\r\n * Base prototype for billboard and label classes.\r\n * @class\r\n * @param {Object} [options] - Options:\r\n * @param {Vec3|Array.<number>} [options.position] - Billboard position.\r\n * @param {number} [options.rotation] - Screen angle rotation.\r\n * @param {Vec4|string|Array.<number>} [options.color] - Billboard color.\r\n * @param {Vec3|Array.<number>} [options.alignedAxis] - Billboard aligned vector.\r\n * @param {Vec3|Array.<number>} [options.offset] - Billboard center screen offset.\r\n * @param {boolean} [options.visibility] - Visibility.\r\n */\r\nclass BaseBillboard {\r\n    static __counter__: number = 0;\r\n    public __id: number;\r\n\r\n    /**\r\n     * Billboard center cartesian position.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    protected _position: Vec3;\r\n\r\n    public _positionHigh: Vec3;\r\n\r\n    public _positionLow: Vec3;\r\n\r\n    /**\r\n     * Screen space rotation angle.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _rotation: number;\r\n\r\n    /**\r\n     * RGBA color.\r\n     * @public\r\n     * @type {Vec4}\r\n     */\r\n    public _color: Vec4;\r\n\r\n    /**\r\n     * Cartesian aligned axis vector.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    protected _alignedAxis: Vec3;\r\n\r\n    /**\r\n     * Billboard center screen space offset. Where x,y - screen space offset and z - depth offset.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public _offset: Vec3;\r\n\r\n    /**\r\n     * Billboard visibility.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _visibility: boolean;\r\n\r\n    /**\r\n     * Entity instance that holds this billboard.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public _entity: Entity | null;\r\n\r\n    /**\r\n     * Handler that stores and renders this billboard object.\r\n     * @public\r\n     * @type {BillboardHandler | null}\r\n     */\r\n    public _handler: BaseBillboardHandler | null;\r\n\r\n    /**\r\n     * Billboard handler array index.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _handlerIndex: number;\r\n\r\n    /**\r\n     * An indication that the object is ready to draw\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _isReady: boolean;\r\n\r\n    public _lockId: number;\r\n\r\n    constructor(options: IBaseBillboardParams = {}) {\r\n\r\n        this.__id = BaseBillboard.__counter__++;\r\n\r\n        this._position = utils.createVector3(options.position);\r\n\r\n        this._positionHigh = new Vec3();\r\n\r\n        this._positionLow = new Vec3();\r\n\r\n        Vec3.doubleToTwoFloats(this._position, this._positionHigh, this._positionLow);\r\n\r\n        this._rotation = options.rotation || 0;\r\n\r\n        this._color = utils.createColorRGBA(options.color);\r\n\r\n        this._alignedAxis = utils.createVector3(options.alignedAxis);\r\n\r\n        this._offset = utils.createVector3(options.offset);\r\n\r\n        this._visibility = options.visibility != undefined ? options.visibility : true;\r\n\r\n        this._entity = null;\r\n\r\n        this._handler = null;\r\n\r\n        this._handlerIndex = -1;\r\n\r\n        this._isReady = false;\r\n\r\n        this._lockId = LOCK_FREE;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard position.\r\n     * @public\r\n     * @param {number} x - X coordinate.\r\n     * @param {number} y - Y coordinate.\r\n     * @param {number} z - Z coordinate.\r\n     */\r\n    public setPosition(x: number, y: number, z: number) {\r\n        this._position.x = x;\r\n        this._position.y = y;\r\n        this._position.z = z;\r\n        Vec3.doubleToTwoFloats(this._position, this._positionHigh, this._positionLow);\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setPositionArr(this._handlerIndex, this._positionHigh, this._positionLow);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets billboard position.\r\n     * @public\r\n     * @param {Vec3} position - Cartesian coordinates.\r\n     */\r\n    public setPosition3v(position: Vec3) {\r\n        this._position.x = position.x;\r\n        this._position.y = position.y;\r\n        this._position.z = position.z;\r\n        Vec3.doubleToTwoFloats(position, this._positionHigh, this._positionLow);\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setPositionArr(this._handlerIndex, this._positionHigh, this._positionLow);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns billboard position.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getPosition(): Vec3 {\r\n        return this._position;\r\n    }\r\n\r\n    /**\r\n     * Sets screen space offset.\r\n     * @public\r\n     * @param {number} x - X offset.\r\n     * @param {number} y - Y offset.\r\n     * @param {number} [z] - Z offset.\r\n     */\r\n    public setOffset(x: number, y: number, z?: number) {\r\n        this._offset.x = x;\r\n        this._offset.y = y;\r\n        z != undefined && (this._offset.z = z);\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setOffsetArr(this._handlerIndex, this._offset);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets screen space offset.\r\n     * @public\r\n     * @param {Vec2} offset - Offset size.\r\n     */\r\n    public setOffset3v(offset: Vec3) {\r\n        this.setOffset(offset.x, offset.y, offset.z);\r\n    }\r\n\r\n    /**\r\n     * Returns billboard screen space offset size.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getOffset(): Vec3 {\r\n        return this._offset;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard screen space rotation in radians.\r\n     * @public\r\n     * @param {number} rotation - Screen space rotation in radians.\r\n     */\r\n    public setRotation(rotation: number) {\r\n        if (rotation !== this._rotation) {\r\n            this._rotation = rotation;\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setRotationArr(this._handlerIndex, rotation);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets screen space rotation.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getRotation(): number {\r\n        return this._rotation;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard opacity.\r\n     * @public\r\n     * @param {number} a - Billboard opacity.\r\n     */\r\n    public setOpacity(a: number) {\r\n        if (a !== this._color.w) {\r\n            a != undefined && (this._color.w = a);\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setRgbaArr(this._handlerIndex, this._color);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets RGBA color. Each channel from 0.0 to 1.0.\r\n     * @public\r\n     * @param {number} r - Red.\r\n     * @param {number} g - Green.\r\n     * @param {number} b - Blue.\r\n     * @param {number} a - Alpha.\r\n     */\r\n    public setColor(r: number, g: number, b: number, a?: number) {\r\n        if (a !== this._color.w || r !== this._color.x || g !== this._color.y || this._color.z !== b) {\r\n            this._color.x = r;\r\n            this._color.y = g;\r\n            this._color.z = b;\r\n            a != undefined && (this._color.w = a);\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setRgbaArr(this._handlerIndex, this._color);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets RGBA color. Each channel from 0.0 to 1.0.\r\n     * @public\r\n     * @param {Vec4} color - RGBA vector.\r\n     */\r\n    public setColor4v(color: Vec4) {\r\n        this.setColor(color.x, color.y, color.z, color.w);\r\n    }\r\n\r\n    /**\r\n     * Sets billboard color.\r\n     * @public\r\n     * @param {string} color - HTML style color.\r\n     */\r\n    public setColorHTML(color: string) {\r\n        this.setColor4v(utils.htmlColorToRgba(color));\r\n    }\r\n\r\n    /**\r\n     * Returns RGBA color.\r\n     * @public\r\n     * @returns {Vec4}\r\n     */\r\n    public getColor(): Vec4 {\r\n        return this._color;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Visibility flag.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        if (visibility !== this._visibility) {\r\n            this._visibility = visibility;\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setVisibility(this._handlerIndex, visibility);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns billboard visibility.\r\n     * @public\r\n     * @returns {boolean}\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard cartesian aligned vector.\r\n     * @public\r\n     * @param {number} x - Aligned vector X coordinate.\r\n     * @param {number} y - Aligned vector Y coordinate.\r\n     * @param {number} z - Aligned vector Z coordinate.\r\n     */\r\n    public setAlignedAxis(x: number, y: number, z: number) {\r\n        this._alignedAxis.x = x;\r\n        this._alignedAxis.y = y;\r\n        this._alignedAxis.z = z;\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setAlignedAxisArr(this._handlerIndex, this._alignedAxis);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets billboard aligned vector.\r\n     * @public\r\n     * @param {Vec3} alignedAxis - Align direction.\r\n     */\r\n    public setAlignedAxis3v(alignedAxis: Vec3) {\r\n        this.setAlignedAxis(alignedAxis.x, alignedAxis.y, alignedAxis.z);\r\n    }\r\n\r\n    /**\r\n     * Returns aligned vector.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getAlignedAxis(): Vec3 {\r\n        return this._alignedAxis;\r\n    }\r\n\r\n    /**\r\n     * Removes billboard from handler.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._entity = null;\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    /**\r\n     * Sets billboard picking color.\r\n     * @public\r\n     * @param {Vec3} color - Picking color.\r\n     */\r\n    public setPickingColor3v(color: Vec3) {\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setPickingColorArr(this._handlerIndex, color);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    public serializeWorkerData(workerId: number): Float32Array | null {\r\n        if (this._handler) {\r\n            return new Float32Array([]);\r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {BaseBillboard};\r\n","import {BaseBillboard} from \"./BaseBillboard\";\r\nimport type {IBaseBillboardParams} from \"./BaseBillboard\";\r\nimport {BillboardHandler} from \"./BillboardHandler\";\r\nimport type {HTMLImageElementExt} from \"../utils/ImagesCacheManager\";\r\n\r\nexport interface IBillboardParams extends IBaseBillboardParams {\r\n    src?: string;\r\n    image?: HTMLImageElement;\r\n    size?: [number, number];\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\n/**\r\n * Represents basic quad billboard image.\r\n * @class\r\n * @extends {BaseBillboard}\r\n * @param {Object} [options] - Options:\r\n * @param {Vec3|Array.<number>} [options.position] - Billboard spatial position.\r\n * @param {number} [options.rotation] - Screen angle rotation.\r\n * @param {Vec4|string|Array.<number>} [options.color] - Billboard color.\r\n * @param {Vec3|Array.<number>} [options.alignedAxis] - Billboard aligned vector.\r\n * @param {Vec3|Array.<number>} [options.offset] - Billboard center screen offset.\r\n * @param {boolean} [options.visibility] - Visibility.\r\n * @param {string} [options.src] - Billboard image url source.\r\n * @param {Image} [options.image] - Billboard image object.\r\n * @param {number} [options.width] - Screen width.\r\n * @param {number} [options.height] - Screen height.\r\n * @param {number} [options.scale] - Billboard scale.\r\n */\r\nclass Billboard extends BaseBillboard {\r\n\r\n    public override _handler: BillboardHandler | null;\r\n\r\n    /**\r\n     * Image src.\r\n     * @protected\r\n     * @type {string}\r\n     */\r\n    protected _src: string | null;\r\n\r\n    /**\r\n     * Image object.\r\n     * @protected\r\n     * @type {Object}\r\n     */\r\n    protected _image: HTMLImageElement & { __nodeIndex?: number } | null;\r\n\r\n    protected _scale: number;\r\n\r\n    /**\r\n     * Billboard screen width.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _width: number;\r\n\r\n    /**\r\n     * Billboard screen height.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _height: number;\r\n\r\n    constructor(options: IBillboardParams = {}) {\r\n\r\n        super(options);\r\n\r\n        this._handler = null;\r\n\r\n        this._src = options.src || null;\r\n\r\n        this._image = options.image || null;\r\n\r\n        this._scale = 1.0;\r\n\r\n        this._width = options.width || (options.size ? options.size[0] : 30);\r\n\r\n        this._height = options.height || (options.size ? options.size[1] : 30);\r\n    }\r\n\r\n    /**\r\n     * Sets billboard image url source.\r\n     * @public\r\n     * @param {string} src - Image url.\r\n     */\r\n    public setSrc(src: string | null) {\r\n        this._src = src;\r\n        let bh = this._handler;\r\n        if (bh && src && src.length) {\r\n            let rn = bh._entityCollection.renderNode;\r\n            if (rn && rn.renderer) {\r\n                let ta = rn.renderer.billboardsTextureAtlas;\r\n                let that = this;\r\n                ta.loadImage(src, function (img: HTMLImageElementExt) {\r\n                    if (img.__nodeIndex != undefined && ta.get(img.__nodeIndex)) {\r\n                        that._image = img;\r\n                        bh!.setTexCoordArr(\r\n                            that._handlerIndex,\r\n                            ta.get(that._image!.__nodeIndex!)!.texCoords\r\n                        );\r\n                    } else {\r\n                        ta.addImage(img);\r\n                        ta.createTexture();\r\n                        that._image = img;\r\n                        rn!.updateBillboardsTexCoords();\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    public getSrc(): string | null {\r\n        return this._src;\r\n    }\r\n\r\n    /**\r\n     * Sets image object.\r\n     * @public\r\n     * @param {Object} image - JavaScript image object.\r\n     */\r\n    public setImage(image: HTMLImageElement) {\r\n        this.setSrc(image.src);\r\n    }\r\n\r\n    public getImage(): HTMLImageElementExt | null {\r\n        return this._image;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard screen size in pixels.\r\n     * @public\r\n     * @param {number} width - Billboard width.\r\n     * @param {number} height - Billboard height.\r\n     */\r\n    public setSize(width: number, height: number) {\r\n        this._width = width;\r\n        this._height = height;\r\n        this._handler &&\r\n        this._handler.setSizeArr(this._handlerIndex, width * this._scale, height * this._scale);\r\n    }\r\n\r\n    /**\r\n     * Returns billboard screen size.\r\n     * @public\r\n     * @returns {Object}\r\n     */\r\n    public getSize(): { width: number, height: number } {\r\n        return {\r\n            width: this._width,\r\n            height: this._height\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Sets billboard screen width.\r\n     * @public\r\n     * @param {number} width - Width.\r\n     */\r\n    public setWidth(width: number) {\r\n        this.setSize(width, this._height);\r\n    }\r\n\r\n    /**\r\n     * Gets billboard screen width.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getWidth(): number {\r\n        return this._width;\r\n    }\r\n\r\n    /**\r\n     * Sets billboard screen heigh.\r\n     * @public\r\n     * @param {number} height - Height.\r\n     */\r\n    public setHeight(height: number) {\r\n        this.setSize(this._width, height);\r\n    }\r\n\r\n    /**\r\n     * Gets billboard screen height.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getHeight(): number {\r\n        return this._height;\r\n    }\r\n}\r\n\r\nexport {Billboard};\r\n","import * as utils from \"../utils/shared\";\r\nimport {Entity} from \"./Entity\";\r\nimport {Extent} from \"../Extent\";\r\nimport {GeometryHandler} from \"./GeometryHandler\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\n\r\nexport enum GeometryTypeEnum {\r\n    POINT = 1,\r\n    LINESTRING = 2,\r\n    POLYGON = 3,\r\n    MULTIPOLYGON = 4,\r\n    MULTILINESTRING = 5,\r\n}\r\n\r\nconst GeometryType: Record<string, number> = {\r\n    POINT: 1,\r\n    LINESTRING: 2,\r\n    POLYGON: 3,\r\n    MULTIPOLYGON: 4,\r\n    MULTILINESTRING: 5\r\n};\r\n\r\nexport type CoordinatesType = NumberArray2 | NumberArray3;\r\n// {\r\n//     \"type\": \"Point\",\r\n//     \"coordinates\": [100.0, 0.0]\r\n// }\r\nexport type IPointCoordinates = CoordinatesType;\r\n\r\n// {\r\n//     \"type\": \"LineString\",\r\n//     \"coordinates\": [\r\n//         [100.0, 0.0],\r\n//         [101.0, 1.0]\r\n//     ]\r\n// }\r\nexport type ILineStringCoordinates = CoordinatesType[];\r\n\r\n// No holes\r\n// {\r\n//     \"type\": \"Polygon\",\r\n//     \"coordinates\": [\r\n//         [\r\n//             [100.0, 0.0],\r\n//             [101.0, 0.0],\r\n//             [101.0, 1.0],\r\n//             [100.0, 1.0],\r\n//             [100.0, 0.0]\r\n//         ]\r\n//     ]\r\n// }\r\n//\r\n// With holes:\r\n// {\r\n//     \"type\": \"Polygon\",\r\n//     \"coordinates\": [\r\n//         [\r\n//             [100.0, 0.0],\r\n//             [101.0, 0.0],\r\n//             [101.0, 1.0],\r\n//             [100.0, 1.0],\r\n//             [100.0, 0.0]\r\n//         ],\r\n//         [\r\n//             [100.8, 0.8],\r\n//             [100.8, 0.2],\r\n//             [100.2, 0.2],\r\n//             [100.2, 0.8],\r\n//             [100.8, 0.8]\r\n//         ]\r\n//     ]\r\n// }\r\nexport type IPolygonCoordinates = CoordinatesType[][];\r\n\r\n// {\r\n//     \"type\": \"MultiLineString\",\r\n//     \"coordinates\": [\r\n//         [\r\n//             [100.0, 0.0],\r\n//             [101.0, 1.0]\r\n//         ],\r\n//         [\r\n//             [102.0, 2.0],\r\n//             [103.0, 3.0]\r\n//         ]\r\n//     ]\r\n// }\r\nexport type IMultiLineStringCoordinates = ILineStringCoordinates[];\r\n\r\n// {\r\n//     \"type\": \"MultiPolygon\",\r\n//     \"coordinates\": [\r\n//         [\r\n//             [\r\n//                 [102.0, 2.0],\r\n//                 [103.0, 2.0],\r\n//                 [103.0, 3.0],\r\n//                 [102.0, 3.0],\r\n//                 [102.0, 2.0]\r\n//             ]\r\n//         ],\r\n//         [\r\n//             [\r\n//                 [100.0, 0.0],\r\n//                 [101.0, 0.0],\r\n//                 [101.0, 1.0],\r\n//                 [100.0, 1.0],\r\n//                 [100.0, 0.0]\r\n//             ],\r\n//             [\r\n//                 [100.2, 0.2],\r\n//                 [100.2, 0.8],\r\n//                 [100.8, 0.8],\r\n//                 [100.8, 0.2],\r\n//                 [100.2, 0.2]\r\n//             ]\r\n//         ]\r\n//     ]\r\n// }\r\nexport type IMultiPolygonCoordinates = IPolygonCoordinates[];\r\n\r\nexport type IGeometryCoordinates =\r\n    IPointCoordinates |\r\n    IPolygonCoordinates |\r\n    IMultiPolygonCoordinates |\r\n    ILineStringCoordinates |\r\n    IMultiLineStringCoordinates;\r\n\r\nexport type GeometryTypeToCoordinates = {\r\n    POINT: IPointCoordinates;\r\n    LINESTRING: ILineStringCoordinates;\r\n    POLYGON: IPolygonCoordinates;\r\n    MULTIPOLYGON: IMultiPolygonCoordinates;\r\n    MULTILINESTRING: IMultiLineStringCoordinates;\r\n};\r\n\r\ninterface IGeometry<T extends keyof typeof GeometryTypeEnum = keyof typeof GeometryTypeEnum> {\r\n    type: T;\r\n    coordinates: GeometryTypeToCoordinates[T];\r\n}\r\n\r\nexport interface IGeometryStyle {\r\n    fillColor?: string | NumberArray4 | Vec4;\r\n    lineColor?: string | NumberArray4 | Vec4;\r\n    strokeColor?: string | NumberArray4 | Vec4;\r\n    lineWidth?: number;\r\n    strokeWidth?: number;\r\n}\r\n\r\ninterface IGeometryStyleInternal {\r\n    fillColor: Vec4;\r\n    lineColor: Vec4;\r\n    strokeColor: Vec4;\r\n    lineWidth: number;\r\n    strokeWidth: number;\r\n}\r\n\r\nexport interface IGeometryParams<T extends keyof typeof GeometryTypeEnum = keyof typeof GeometryTypeEnum> {\r\n    type?: T;\r\n    coordinates?: GeometryTypeToCoordinates[T];\r\n    style?: IGeometryStyle;\r\n    visibility?: boolean;\r\n}\r\n\r\nclass Geometry {\r\n    static __counter__: number = 0;\r\n\r\n    public __id: number;\r\n\r\n    /**\r\n     * Entity instance that holds this geometry.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public _entity: Entity | null;\r\n\r\n    public _handler: GeometryHandler | null;\r\n    public _handlerIndex: number;\r\n\r\n    // Polygon\r\n    public _polyVerticesHighMerc: number[];\r\n    public _polyVerticesLowMerc: number[];\r\n    public _polyVerticesLength: number;\r\n    public _polyIndexesLength: number;\r\n    public _polyVerticesHandlerIndex: number;\r\n    public _polyIndexesHandlerIndex: number;\r\n\r\n    // Line(Linestring and polygon's stroke(s)\r\n    public _lineVerticesHighMerc: number[];\r\n    public _lineVerticesLowMerc: number[];\r\n    public _lineVerticesLength: number;\r\n    public _lineOrdersLength: number;\r\n    public _lineIndexesLength: number;\r\n    public _lineColorsLength: number;\r\n    public _lineThicknessLength: number;\r\n    public _lineVerticesHandlerIndex: number;\r\n    public _lineOrdersHandlerIndex: number;\r\n    public _lineIndexesHandlerIndex: number;\r\n    public _lineThicknessHandlerIndex: number;\r\n    public _lineColorsHandlerIndex: number;\r\n    protected _type: GeometryTypeEnum;\r\n    public _coordinates: IGeometryCoordinates;\r\n    protected _extent: Extent;\r\n    public _style: IGeometryStyleInternal;\r\n    protected _visibility: boolean;\r\n    public _pickingReady: boolean;\r\n\r\n    constructor(options: IGeometryParams = {}) {\r\n\r\n        this.__id = Geometry.__counter__++;\r\n\r\n        this._entity = null;\r\n\r\n        this._handler = null;\r\n        this._handlerIndex = -1;\r\n\r\n        this._polyVerticesHighMerc = [];\r\n        this._polyVerticesLowMerc = [];\r\n        this._polyVerticesLength = -1;\r\n        this._polyIndexesLength = -1;\r\n        this._polyVerticesHandlerIndex = -1;\r\n        this._polyIndexesHandlerIndex = -1;\r\n\r\n        this._lineVerticesHighMerc = [];\r\n        this._lineVerticesLowMerc = [];\r\n        this._lineVerticesLength = -1;\r\n        this._lineOrdersLength = -1;\r\n        this._lineIndexesLength = -1;\r\n        this._lineColorsLength = -1;\r\n        this._lineThicknessLength = -1;\r\n        this._lineVerticesHandlerIndex = -1;\r\n        this._lineOrdersHandlerIndex = -1;\r\n        this._lineIndexesHandlerIndex = -1;\r\n        this._lineThicknessHandlerIndex = -1;\r\n        this._lineColorsHandlerIndex = -1;\r\n\r\n        this._type = (options.type && Geometry.getType(options.type)) || GeometryTypeEnum.POINT;\r\n        this._coordinates = options.coordinates || [];\r\n        this._extent = Geometry.getExtent({\r\n                type: options.type || \"POINT\",\r\n                coordinates: options.coordinates || []\r\n            },\r\n            this._coordinates\r\n        );\r\n\r\n        options.style = options.style || {};\r\n\r\n        this._style = {\r\n            fillColor: utils.createColorRGBA(options.style.fillColor, new Vec4(0.19, 0.62, 0.85, 0.4)),\r\n            lineColor: utils.createColorRGBA(options.style.lineColor, new Vec4(0.19, 0.62, 0.85, 1)),\r\n            strokeColor: utils.createColorRGBA(options.style.strokeColor, new Vec4(1, 1, 1, 0.95)),\r\n            lineWidth: options.style.lineWidth || 3,\r\n            strokeWidth: options.style.strokeWidth || 0\r\n        };\r\n\r\n        this._visibility = options.visibility || true;\r\n\r\n        // optimization flag for picking mask rendering pass\r\n        this._pickingReady = false;\r\n    }\r\n\r\n    public get id(): number {\r\n        return this.__id;\r\n    }\r\n\r\n    public get type(): number {\r\n        return this._type;\r\n    }\r\n\r\n    static getType(typeStr: keyof typeof GeometryTypeEnum): GeometryTypeEnum {\r\n        return GeometryType[typeStr.toUpperCase()];\r\n    }\r\n\r\n    /**\r\n     * Returns geometry extent.\r\n     @static\r\n     @param {IGeometry} geometryObj - GeoJSON style geometry feature.\r\n     @param {IGeometryCoordinates} outCoordinates - Geometry feature coordinates clone.\r\n     @returns {Extent} -\r\n     */\r\n    static getExtent(geometryObj: IGeometry, outCoordinates: IGeometryCoordinates): Extent {\r\n        let res = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\r\n        let t = Geometry.getType(geometryObj.type);\r\n\r\n        if (t === GeometryTypeEnum.POINT) {\r\n            let lon: number = geometryObj.coordinates[0] as number,\r\n                lat: number = geometryObj.coordinates[1] as number;\r\n            res.southWest.lon = lon;\r\n            res.southWest.lat = lat;\r\n            res.northEast.lon = lon;\r\n            res.northEast.lat = lat;\r\n            outCoordinates && (outCoordinates[0] = lon) && (outCoordinates[1] = lat);\r\n        } else if (t === GeometryTypeEnum.LINESTRING) {\r\n            let c: ILineStringCoordinates = geometryObj.coordinates as ILineStringCoordinates;\r\n            for (let i = 0; i < c.length; i++) {\r\n                let lon = c[i][0],\r\n                    lat = c[i][1];\r\n                if (lon < res.southWest.lon) res.southWest.lon = lon;\r\n                if (lat < res.southWest.lat) res.southWest.lat = lat;\r\n                if (lon > res.northEast.lon) res.northEast.lon = lon;\r\n                if (lat > res.northEast.lat) res.northEast.lat = lat;\r\n                outCoordinates && ((outCoordinates as ILineStringCoordinates)[i] = [lon, lat]);\r\n            }\r\n        } else if (t === GeometryTypeEnum.POLYGON) {\r\n            let c: IPolygonCoordinates = geometryObj.coordinates as IPolygonCoordinates;\r\n            for (let i = 0; i < c.length; i++) {\r\n                let ci: CoordinatesType[] = c[i];\r\n                outCoordinates && (outCoordinates[i] = []);\r\n                for (let j = 0; j < ci.length; j++) {\r\n                    let cij = ci[j];\r\n                    let lon = cij[0],\r\n                        lat = cij[1];\r\n                    if (lon < res.southWest.lon) res.southWest.lon = lon;\r\n                    if (lat < res.southWest.lat) res.southWest.lat = lat;\r\n                    if (lon > res.northEast.lon) res.northEast.lon = lon;\r\n                    if (lat > res.northEast.lat) res.northEast.lat = lat;\r\n                    outCoordinates && ((outCoordinates as IPolygonCoordinates)[i][j] = [lon, lat]);\r\n                }\r\n            }\r\n        } else if (t === GeometryTypeEnum.MULTIPOLYGON) {\r\n            let p = geometryObj.coordinates;\r\n            for (let i = 0; i < p.length; i++) {\r\n                let pi: IPolygonCoordinates = p[i] as IPolygonCoordinates;\r\n                outCoordinates && (outCoordinates[i] = []);\r\n                for (let j = 0; j < pi.length; j++) {\r\n                    let pij: CoordinatesType[] = pi[j];\r\n                    outCoordinates && ((outCoordinates as IMultiPolygonCoordinates)[i][j] = []);\r\n                    for (let k = 0; k < pij.length; k++) {\r\n                        let pijk = pij[k];\r\n                        let lon = pijk[0],\r\n                            lat = pijk[1];\r\n                        if (lon < res.southWest.lon) res.southWest.lon = lon;\r\n                        if (lat < res.southWest.lat) res.southWest.lat = lat;\r\n                        if (lon > res.northEast.lon) res.northEast.lon = lon;\r\n                        if (lat > res.northEast.lat) res.northEast.lat = lat;\r\n                        outCoordinates && ((outCoordinates as IMultiPolygonCoordinates)[i][j][k] = [lon, lat]);\r\n                    }\r\n                }\r\n            }\r\n        } else if (t === GeometryTypeEnum.MULTILINESTRING) {\r\n            let c = geometryObj.coordinates;\r\n            for (let i = 0; i < c.length; i++) {\r\n                let ci: ILineStringCoordinates = c[i] as ILineStringCoordinates;\r\n                outCoordinates && (outCoordinates[i] = []);\r\n                for (let j = 0; j < ci.length; j++) {\r\n                    let cij = ci[j];\r\n                    let lon = cij[0],\r\n                        lat = cij[1];\r\n                    if (lon < res.southWest.lon) res.southWest.lon = lon;\r\n                    if (lat < res.southWest.lat) res.southWest.lat = lat;\r\n                    if (lon > res.northEast.lon) res.northEast.lon = lon;\r\n                    if (lat > res.northEast.lat) res.northEast.lat = lat;\r\n                    outCoordinates && ((outCoordinates as IMultiLineStringCoordinates)[i][j] = [lon, lat]);\r\n                }\r\n            }\r\n        } else {\r\n            res.southWest.lon = res.southWest.lat = res.northEast.lon = res.northEast.lat = 0.0;\r\n            outCoordinates && (outCoordinates[0] = 0) && (outCoordinates[1] = 0);\r\n        }\r\n\r\n        return res;\r\n    }\r\n\r\n    /**\r\n     * @todo ASAP need test for this method\r\n     * @param geoJson\r\n     * @returns {Geometry}\r\n     */\r\n    public setGeometry(geoJson: IGeometry): Geometry {\r\n        let h = this._handler;\r\n        if (h) {\r\n            this.remove();\r\n            this._type = Geometry.getType(geoJson.type || \"Point\");\r\n            this._extent = Geometry.getExtent(geoJson, this._coordinates);\r\n            h.add(this);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public setFillColor(r: number, g: number, b: number, a: number = 1.0): Geometry {\r\n        let c = this._style.fillColor;\r\n        if ((c.w === 0.0 && a !== 0.0) || (c.w !== 0.0 && a === 0.0)) {\r\n            this._pickingReady = false;\r\n        }\r\n        c.x = r;\r\n        c.y = g;\r\n        c.z = b;\r\n        c.w = a;\r\n        this._handler && this._handler.setPolyColorArr(this, c);\r\n        return this;\r\n    }\r\n\r\n    public overlaps(extent: Extent): boolean {\r\n        return this._extent.overlaps(extent);\r\n    }\r\n\r\n    public setFillColor4v(rgba: Vec4): Geometry {\r\n        return this.setFillColor(rgba.x, rgba.y, rgba.z, rgba.w);\r\n    }\r\n\r\n    public setStrokeColor(r: number, g: number, b: number, a: number = 1.0): Geometry {\r\n        let c = this._style.strokeColor;\r\n        if ((c.w === 0.0 && a !== 0.0) || (c.w !== 0.0 && a === 0.0)) {\r\n            this._pickingReady = false;\r\n        }\r\n        c.x = r;\r\n        c.y = g;\r\n        c.z = b;\r\n        c.w = a;\r\n        this._handler && this._handler.setLineStrokeColorArr(this, c);\r\n        return this;\r\n    }\r\n\r\n    public setLineColor(r: number, g: number, b: number, a: number = 1.0): Geometry {\r\n        let c = this._style.lineColor;\r\n        if ((c.w === 0.0 && a !== 0.0) || (c.w !== 0.0 && a === 0.0)) {\r\n            this._pickingReady = false;\r\n        }\r\n        c.x = r;\r\n        c.y = g;\r\n        c.z = b;\r\n        c.w = a;\r\n        this._handler && this._handler.setLineColorArr(this, c);\r\n        return this;\r\n    }\r\n\r\n    public setStrokeColor4v(rgba: Vec4): Geometry {\r\n        return this.setStrokeColor(rgba.x, rgba.y, rgba.z, rgba.w);\r\n    }\r\n\r\n    public setLineColor4v(rgba: Vec4): Geometry {\r\n        return this.setLineColor(rgba.x, rgba.y, rgba.z, rgba.w);\r\n    }\r\n\r\n    public setStrokeOpacity(opacity: number): Geometry {\r\n        let c = this._style.strokeColor;\r\n        c.w = opacity;\r\n        return this.setStrokeColor(c.x, c.y, c.z, opacity);\r\n    }\r\n\r\n    public setLineOpacity(opacity: number): Geometry {\r\n        let c = this._style.lineColor;\r\n        c.w = opacity;\r\n        return this.setLineColor(c.x, c.y, c.z, opacity);\r\n    }\r\n\r\n    public setStrokeWidth(width: number): Geometry {\r\n        this._style.strokeWidth = width;\r\n        this._pickingReady = false;\r\n        this._handler && this._handler.setLineStrokeArr(this, width);\r\n        return this;\r\n    }\r\n\r\n    public bringToFront(): Geometry {\r\n        this._handler && this._handler.bringToFront(this);\r\n        return this;\r\n    }\r\n\r\n    public setLineWidth(width: number): Geometry {\r\n        this._style.lineWidth = width;\r\n        this._pickingReady = false;\r\n        this._handler && this._handler.setLineThicknessArr(this, width);\r\n        return this;\r\n    }\r\n\r\n    public setFillOpacity(opacity: number): Geometry {\r\n        let c = this._style.fillColor;\r\n        if ((c.w === 0.0 && opacity !== 0.0) || (c.w !== 0.0 && opacity === 0.0)) {\r\n            this._pickingReady = false;\r\n        }\r\n        c.w = opacity;\r\n        this._handler && this._handler.setPolyColorArr(this, c);\r\n        return this;\r\n    }\r\n\r\n    public setVisibility(visibility: boolean): Geometry {\r\n        this._visibility = visibility;\r\n        this._handler && this._handler.setGeometryVisibility(this);\r\n        return this;\r\n    }\r\n\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    public remove() {\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    public getExtent(): Extent {\r\n        return this._extent.clone();\r\n    }\r\n\r\n    public getType(): number {\r\n        return this._type;\r\n    }\r\n}\r\n\r\nexport {Geometry};\r\n","import {Vec2} from './Vec2';\r\n\r\nexport class Line2 {\r\n\r\n    public a: number;\r\n    public b: number;\r\n    public c: number;\r\n\r\n    constructor(a = 0, b = 0, c = 0) {\r\n        this.a = a;\r\n        this.b = b;\r\n        this.c = c;\r\n    }\r\n\r\n    static get(p0: Vec2, p1: Vec2): Line2 {\r\n        return new Line2(p1.y - p0.y, p0.x - p1.x, p1.x * p0.y - p0.x * p1.y);\r\n    }\r\n\r\n    static getParallel(l: Line2, p: Vec2): Line2 {\r\n        return new Line2(l.a, l.b, -l.a * p.x - l.b * p.y);\r\n    }\r\n\r\n    static getIntersection(L0: Line2, L1: Line2): Vec2 {\r\n        let x = (L1.b * L0.c - L0.b * L1.c) / (L0.b * L1.a - L1.b * L0.a);\r\n        return new Vec2(x, -(L0.c + L0.a * x) / L0.b);\r\n    }\r\n\r\n    public intersects(l: Line2): Vec2 {\r\n        return Line2.getIntersection(this, l);\r\n    }\r\n}\r\n","import {EPS10} from '../math';\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Vec3} from './Vec3';\r\n\r\n/**\r\n * @todo: write tests\r\n * @class Line3\r\n * Represents a line segment in 3d space.\r\n * @param {Vec3} [p0] - First point of the line\r\n * @param {Vec3} [p1] - Second point of the line\r\n */\r\nexport class Line3 {\r\n\r\n    /**\r\n     * First point of the line\r\n     * @public\r\n     * @type: Vec3\r\n     */\r\n    public p0: Vec3;\r\n\r\n    /**\r\n     * Second point of the line\r\n     * @public\r\n     * @type: Vec3\r\n     */\r\n    public p1: Vec3;\r\n\r\n    constructor(p0?: Vec3, p1?: Vec3) {\r\n        this.p0 = p0 || new Vec3();\r\n        this.p1 = p1 || new Vec3();\r\n    }\r\n\r\n    public getMagnitude(): number {\r\n        return this.p0.distance(this.p1);\r\n    }\r\n\r\n    public getSphereIntersection(sphere: Sphere): [Vec3] | [Vec3, Vec3] | [] {\r\n        let p0 = this.p0,\r\n            p1 = this.p1;\r\n\r\n        let cx = sphere.center.x,\r\n            cy = sphere.center.y,\r\n            cz = sphere.center.z;\r\n\r\n        let px = p0.x,\r\n            py = p0.y,\r\n            pz = p0.z;\r\n\r\n        let vx = p1.x - px,\r\n            vy = p1.y - py,\r\n            vz = p1.z - pz;\r\n\r\n        let A = vx * vx + vy * vy + vz * vz,\r\n            B = 2.0 * (px * vx + py * vy + pz * vz - vx * cx - vy * cy - vz * cz),\r\n            C = px * px - 2 * px * cx + cx * cx + py * py - 2 * py * cy + cy * cy +\r\n                pz * pz - 2 * pz * cz + cz * cz - sphere.radius * sphere.radius;\r\n        let D = B * B - 4 * A * C;\r\n\r\n        if (D < 0) {\r\n            // no solutions\r\n            return [];\r\n        }\r\n\r\n        let t1 = (-B - Math.sqrt(D)) / (2.0 * A);\r\n\r\n        let solution1 = new Vec3(\r\n            p0.x * (1 - t1) + t1 * p1.x,\r\n            p0.y * (1 - t1) + t1 * p1.y,\r\n            p0.z * (1 - t1) + t1 * p1.z\r\n        );\r\n\r\n        if (D == 0) {\r\n            return [solution1];\r\n        }\r\n\r\n        let t2 = (-B + Math.sqrt(D)) / (2.0 * A);\r\n        let solution2 = new Vec3(\r\n            p0.x * (1 - t2) + t2 * p1.x,\r\n            p0.y * (1 - t2) + t2 * p1.y,\r\n            p0.z * (1 - t2) + t2 * p1.z);\r\n\r\n        // prefer a solution that's on the line segment itself\r\n        if (Math.abs(t1 - 0.5) < Math.abs(t2 - 0.5)) {\r\n            return [solution1, solution2];\r\n        }\r\n\r\n        return [solution2, solution1];\r\n    }\r\n\r\n    public intersects(line: Line3, res: Vec3, res2?: Vec3): boolean {\r\n\r\n        let p13 = this.p0.sub(line.p0),\r\n            p43 = line.p1.sub(line.p0);\r\n\r\n        if (Math.abs(p43.x) < EPS10 && Math.abs(p43.y) < EPS10 && Math.abs(p43.z) < EPS10) {\r\n            return false;\r\n        }\r\n\r\n        let p21 = this.p1.sub(this.p0);\r\n\r\n        if (Math.abs(p21.x) < EPS10 && Math.abs(p21.y) < EPS10 && Math.abs(p21.z) < EPS10) {\r\n            return false;\r\n        }\r\n\r\n        let d1343 = p13.x * p43.x + p13.y * p43.y + p13.z * p43.z,\r\n            d4321 = p43.x * p21.x + p43.y * p21.y + p43.z * p21.z,\r\n            d1321 = p13.x * p21.x + p13.y * p21.y + p13.z * p21.z,\r\n            d4343 = p43.x * p43.x + p43.y * p43.y + p43.z * p43.z,\r\n            d2121 = p21.x * p21.x + p21.y * p21.y + p21.z * p21.z;\r\n\r\n        let denom = d2121 * d4343 - d4321 * d4321;\r\n\r\n        if (Math.abs(denom) < EPS10) {\r\n            return false;\r\n        }\r\n\r\n        let numer = d1343 * d4321 - d1321 * d4343;\r\n\r\n        let mua = numer / denom;\r\n\r\n        res.x = this.p0.x + mua * p21.x;\r\n        res.y = this.p0.y + mua * p21.y;\r\n        res.z = this.p0.z + mua * p21.z;\r\n\r\n        if (res2) {\r\n\r\n            let mub = (d1343 + d4321 * mua) / d4343;\r\n\r\n            res2.x = line.p0.x + mub * p43.x;\r\n            res2.y = line.p0.y + mub * p43.y;\r\n            res2.z = line.p0.z + mub * p43.z;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    public getNearestDistancePoint(point: Vec3, res: Vec3): boolean {\r\n\r\n        let p0 = this.p0,\r\n            p1 = this.p1;\r\n\r\n        let mag = this.getMagnitude();\r\n\r\n        let u =\r\n            (\r\n                ((point.x - p0.x) * (p1.x - p0.x)) +\r\n                ((point.y - p0.y) * (p1.y - p0.y)) +\r\n                ((point.z - p0.z) * (p1.z - p0.z))\r\n            ) /\r\n            (mag * mag);\r\n\r\n        res.x = p0.x + u * (p1.x - p0.x);\r\n        res.y = p0.y + u * (p1.y - p0.y);\r\n        res.z = p0.z + u * (p1.z - p0.z);\r\n\r\n        if (u < 0.0 || u > 1.0) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n}","import {EPS5} from \"../math\";\r\nimport {Vec3} from \"./Vec3\";\r\nimport {Line3} from \"./Line3\";\r\n\r\nconst DISJOINT = 0\r\nconst COINCIDE = 1;\r\nconst INTERSECT = 2;\r\n\r\n/**\r\n * Plane class.\r\n * @constructor\r\n * @param {Vec3} [p] - Plane point.\r\n * @param {Vec3} [n] - Planet normal.\r\n */\r\nclass Plane {\r\n    public p: Vec3;\r\n    public n: Vec3;\r\n\r\n    constructor(p?: Vec3, n?: Vec3) {\r\n        this.p = p ? p.clone() : new Vec3();\r\n        this.n = n ? n.clone() : (this.p.isZero() ? Vec3.UP : this.p.getNormal());\r\n    }\r\n\r\n    public setByPoints(v0: Vec3, v1: Vec3, v2: Vec3): Plane {\r\n        let u = Vec3.sub(v1, v0);\r\n        let v = Vec3.sub(v2, v0);\r\n        this.n = u.cross(v);\r\n        this.p.copy(v0);\r\n        return this;\r\n    }\r\n\r\n    static fromPoints(v0: Vec3, v1: Vec3, v2: Vec3): Plane {\r\n        return new Plane().setByPoints(v0, v1, v2);\r\n    }\r\n\r\n    public set(p: Vec3, n: Vec3) {\r\n        this.p.copy(p);\r\n        this.n.copy(n);\r\n    }\r\n\r\n    public getNormal(): Vec3 {\r\n        return this.n.clone();\r\n    }\r\n\r\n    public distance(p: Vec3): number {\r\n        let pp = this.getProjection(p);\r\n        return p.distance(pp);\r\n    }\r\n\r\n    public getProjection(v: Vec3, def?: Vec3): Vec3 {\r\n        return Vec3.proj_b_to_plane(v, this.n, def);\r\n    }\r\n\r\n    public getProjectionPoint(p: Vec3, vh?: Vec3): Vec3 {\r\n        let v = p.sub(this.p),\r\n            n = this.n,\r\n            dist = v.dot(n);\r\n\r\n        if (vh) {\r\n            vh.copy(n.scale(dist));\r\n        } else {\r\n            vh = n.scale(dist);\r\n        }\r\n        return p.sub(vh);\r\n    }\r\n\r\n    public getIntersection(Pn1: Plane, Pn2: Plane, L: Line3): number {\r\n        let u = Pn1.n.cross(Pn2.n);\r\n\r\n        let ax = u.x >= 0 ? u.x : -u.x;\r\n        let ay = u.y >= 0 ? u.y : -u.y;\r\n        let az = u.z >= 0 ? u.z : -u.z;\r\n\r\n        // test if the two planes are parallel\r\n        if (ax + ay + az < EPS5) {\r\n            // Pn1 and Pn2 are near parallel\r\n            // test if disjoint or coincide\r\n            let v = Pn2.p.sub(Pn1.p);\r\n            if (Pn1.n.dot(v) == 0) {\r\n                // Pn2.V0 lies in Pn1\r\n                return COINCIDE; // Pn1 and Pn2 coincide\r\n            } else {\r\n                return DISJOINT; // Pn1 and Pn2 are disjoint\r\n            }\r\n        }\r\n\r\n        // Pn1 and Pn2 intersect in a line\r\n        // first determine max abs coordinate of cross product\r\n        let maxc; // max coordinate\r\n        if (ax > ay) {\r\n            if (ax > az) {\r\n                maxc = 1;\r\n            } else {\r\n                maxc = 3;\r\n            }\r\n        } else {\r\n            if (ay > az) {\r\n                maxc = 2;\r\n            } else {\r\n                maxc = 3;\r\n            }\r\n        }\r\n\r\n        // next, to get a point on the intersect line\r\n        // zero the max coord, and solve for the other two\r\n        let iP = new Vec3(); // intersect point\r\n\r\n        let d1, d2; // the constants in the 2 plane equations\r\n        d1 = -Pn1.n.dot(Pn1.p); // note: could be pre-stored  with plane\r\n        d2 = -Pn2.n.dot(Pn2.p); // ditto\r\n\r\n        // select max coordinate\r\n        if (maxc === 1) {\r\n            // intersect with x=0\r\n            iP.x = 0;\r\n            iP.y = (d2 * Pn1.n.z - d1 * Pn2.n.z) / u.x;\r\n            iP.z = (d1 * Pn2.n.y - d2 * Pn1.n.y) / u.x;\r\n        } else if (maxc === 2) {\r\n            // intersect with y=0\r\n            iP.x = (d1 * Pn2.n.z - d2 * Pn1.n.z) / u.y;\r\n            iP.y = 0;\r\n            iP.z = (d2 * Pn1.n.x - d1 * Pn2.n.x) / u.y;\r\n        } else if (maxc === 3) {\r\n            // intersect with z=0\r\n            iP.x = (d2 * Pn1.n.y - d1 * Pn2.n.y) / u.z;\r\n            iP.y = (d1 * Pn2.n.x - d2 * Pn1.n.x) / u.z;\r\n            iP.z = 0;\r\n        }\r\n        L.p0.copy(iP);\r\n        L.p1.copy(iP.add(u));\r\n        return INTERSECT;\r\n    }\r\n}\r\n\r\nexport {Plane};\r\n","import {EPS10} from \"../math\";\r\nimport {Box} from \"../bv/Box\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Vec3} from \"./Vec3\";\r\nimport {Plane} from \"./Plane\";\r\n\r\n/**\r\n * Represents a ray that extends infinitely from the provided origin in the provided direction.\r\n * @class\r\n * @param {Vec3} origin - The origin of the ray.\r\n * @param {Vec3} direction - The direction of the ray.\r\n */\r\nexport class Ray {\r\n    /**\r\n     * The origin of the ray.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public origin: Vec3;\r\n\r\n    /**\r\n     * The direction of the ray.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public direction: Vec3;\r\n\r\n    constructor(origin: Vec3 = Vec3.ZERO, direction: Vec3 = Vec3.ZERO) {\r\n\r\n        this.origin = origin;\r\n\r\n        this.direction = direction;\r\n    }\r\n\r\n    /** @const */\r\n    static get OUTSIDE() {\r\n        return 0;\r\n    }\r\n\r\n    /** @const */\r\n    static get INSIDE() {\r\n        return 1;\r\n    }\r\n\r\n    /** @const */\r\n    static get INPLANE() {\r\n        return 2;\r\n    }\r\n\r\n    /** @const */\r\n    static get AWAY() {\r\n        return 3;\r\n    }\r\n\r\n    /**\r\n     * Sets a ray parameters.\r\n     * @public\r\n     * @param {Vec3} origin - The origin of the ray.\r\n     * @param {Vec3} direction - The direction of the ray.\r\n     * @returns {Ray}\r\n     */\r\n    public set(origin: Vec3, direction: Vec3): Ray {\r\n        this.origin = origin;\r\n        this.direction = direction;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Get a point on the ray at a given distance `t`.\r\n     * @param {number} distance - Distance from the origin along the ray.\r\n     * @returns {Vec3} The point at distance `t`.\r\n     */\r\n    public getPoint(distance: number): Vec3 {\r\n        return Vec3.add(this.origin, this.direction.scaleTo(distance));\r\n    }\r\n\r\n    /**\r\n     * Returns ray hit a triangle result.\r\n     * @public\r\n     * @param {Vec3} v0 - First triangle corner coordinate.\r\n     * @param {Vec3} v1 - Second triangle corner coordinate.\r\n     * @param {Vec3} v2 - Third triangle corner coordinate.\r\n     * @param {Vec3} res - Hit point object pointer that stores hit result.\r\n     * @returns {number} - Hit code, could 0 - og.Ray.OUTSIDE, 1 - og.Ray.INSIDE,\r\n     *      2 - og.Ray.INPLANE and 3 - og.Ray.AWAY(ray goes away from triangle).\r\n     */\r\n    public hitTriangleRes(v0: Vec3, v1: Vec3, v2: Vec3, res: Vec3): number {\r\n        let u = v1.sub(v0);\r\n        let v = v2.sub(v0);\r\n        let n = u.cross(v);\r\n\r\n        let w0 = this.origin.sub(v0);\r\n        let a = -n.dot(w0);\r\n        let b = n.dot(this.direction);\r\n\r\n        // ray is  parallel to triangle plane\r\n        if (Math.abs(b) < EPS10) {\r\n            if (a === 0) {\r\n                res.copy(this.origin);\r\n                // ray lies in triangle plane\r\n                return Ray.INPLANE;\r\n            } else {\r\n                // ray disjoint from plane\r\n                return Ray.OUTSIDE;\r\n            }\r\n        }\r\n\r\n        let r = a / b;\r\n\r\n        // intersect point of ray and plane\r\n        res.copy(this.origin.add(this.direction.scaleTo(r)));\r\n\r\n        // ray goes away from triangle\r\n        if (r < 0.0) {\r\n            return Ray.AWAY;\r\n        }\r\n\r\n        // is res point inside the triangle?\r\n        let uu = u.dot(u);\r\n        let uv = u.dot(v);\r\n        let vv = v.dot(v);\r\n        let w = res.sub(v0);\r\n        let wu = w.dot(u);\r\n        let wv = w.dot(v);\r\n        let D = uv * uv - uu * vv;\r\n\r\n        let s = (uv * wv - vv * wu) / D;\r\n        if (s < 0.0 || s > 1.0) {\r\n            return Ray.OUTSIDE;\r\n        }\r\n\r\n        let t = (uv * wu - uu * wv) / D;\r\n        if (t < 0.0 || s + t > 1.0) {\r\n            return Ray.OUTSIDE;\r\n        }\r\n\r\n        return Ray.INSIDE;\r\n    }\r\n\r\n    // /**\r\n    //  * Gets a ray hit a plane result. If the ray cross the plane returns 1 - og.Ray.INSIDE otherwise returns 0 - og.Ray.OUTSIDE.\r\n    //  * @public\r\n    //  * @param {Vec3} v0 - First plane point.\r\n    //  * @param {Vec3} v1 - Second plane point.\r\n    //  * @param {Vec3} v2 - Third plane point.\r\n    //  * @param {Vec3} res - Hit point object pointer that stores hit result.\r\n    //  * @returns {number}\r\n    //  */\r\n    // public hitPlaneRes(v0: Vec3, v1: Vec3, v2: Vec3, res: Vec3): number {\r\n    //     let u = Vec3.sub(v1, v0);\r\n    //     let v = Vec3.sub(v2, v0);\r\n    //     let n = u.cross(v);\r\n    //\r\n    //     let w0 = Vec3.sub(this.origin, v0);\r\n    //     let a = -n.dot(w0);\r\n    //     let b = n.dot(this.direction);\r\n    //\r\n    //     // ray is  parallel to the plane\r\n    //     if (Math.abs(b) < EPS10) {\r\n    //         if (a === 0) {\r\n    //             return Ray.OUTSIDE;\r\n    //         }\r\n    //     }\r\n    //\r\n    //     let r = a / b;\r\n    //\r\n    //     if (r < 0) {\r\n    //         return Ray.OUTSIDE;\r\n    //     }\r\n    //\r\n    //     let d = this.direction.scaleTo(r);\r\n    //\r\n    //     // intersect point of ray and plane\r\n    //     res.x = this.origin.x + d.x;\r\n    //     res.y = this.origin.y + d.y;\r\n    //     res.z = this.origin.z + d.z;\r\n    //\r\n    //     return Ray.INSIDE;\r\n    // }\r\n\r\n    /**\r\n     * Finds the intersection of the ray with a plane.\r\n     * @param {Plane} plane - The plane to intersect with.\r\n     * @returns {Vec3 | null} The intersection point or null if no intersection.\r\n     */\r\n    public hitPlaneRes(plane: Plane, res: Vec3): number {\r\n        const d = this.direction.dot(plane.n);\r\n\r\n        if (Math.abs(d) < EPS10) {\r\n            return Ray.OUTSIDE;\r\n        }\r\n\r\n        const t = plane.p.sub(this.origin).dot(plane.n) / d;\r\n\r\n        if (t < 0) {\r\n            return Ray.AWAY;\r\n        }\r\n\r\n        res.copy(this.getPoint(t));\r\n\r\n        return Ray.INSIDE;\r\n    }\r\n\r\n    /**\r\n     * Returns a ray hit sphere coordinates. If there isn't hit returns null.\r\n     * @public\r\n     * @param {Sphere} sphere - Sphere object.\r\n     * @returns {Vec3}\r\n     */\r\n    public hitSphere(sphere: Sphere) {\r\n        const oc = Vec3.sub(this.origin, sphere.center);\r\n        const a = this.direction.dot(this.direction);\r\n        const b = 2.0 * oc.dot(this.direction);\r\n        const c = oc.dot(oc) - sphere.radius * sphere.radius;\r\n        const discriminant = b * b - 4 * a * c;\r\n\r\n        if (discriminant < 0) {\r\n            return null;\r\n        }\r\n\r\n        const sqrtDisc = Math.sqrt(discriminant);\r\n        const t1 = (-b - sqrtDisc) / (2.0 * a);\r\n        const t2 = (-b + sqrtDisc) / (2.0 * a);\r\n\r\n        let t = t1;\r\n        if (t < 0) t = t2;\r\n        if (t < 0) return null;\r\n\r\n        return Vec3.add(this.origin, this.direction.scaleTo(t));\r\n    }\r\n\r\n    public hitBox(box: Box) {\r\n        //\r\n        // TODO\r\n        //\r\n    }\r\n}","import type {NumberArray3} from \"../math/Vec3\";\r\n\r\nexport interface IObjGeometryData {\r\n    vertices: number[];\r\n    texCoords: number[];\r\n    normals: number[];\r\n}\r\n\r\nexport interface IObjGeometry {\r\n    object: string;\r\n    groups: string[];\r\n    material: string;\r\n    data: IObjGeometryData\r\n}\r\n\r\nexport interface IObjMaterial {\r\n    ambient?: NumberArray3;\r\n    diffuse?: NumberArray3; // baseDiffuseFactor\r\n    specular?: NumberArray3; // metalicFactor, specularFactor\r\n    shininess?: number; // roughnessFactor, glossinessFactor\r\n    color?: NumberArray3; // baseColorFactor\r\n    opacity?: number;\r\n    illum?: number\r\n    colorTexture?: string; // baseColorTexture\r\n    normalTexture?: string; // normalTexture\r\n    metallicRoughnessTexture?: string;//R - roughness, B - metallic; specular glossiness or glossinessTexture\r\n}\r\n\r\ntype MaterialMap = Record<string, IObjMaterial>;\r\n\r\nexport interface IObj {\r\n    geometries: IObjGeometry[];\r\n    materials: MaterialMap;\r\n}\r\n\r\nfunction getTexturePath(path: string) {\r\n    let p = path.split('/');\r\n    let filename = p[p.length - 1];\r\n    let folder = p[p.length - 2];\r\n    return `${folder ? folder + \"/\" : \"\"}${filename}`;\r\n}\r\n\r\nexport class Obj {\r\n\r\n    public objPositions: number[][];\r\n    public objTexcoords: number[][];\r\n    public objNormals: number[][];\r\n    public objVertexData: [number[][], number[][], number[][]];\r\n    public vertexData: [number[], number[], number[]];\r\n\r\n    public _materialLibs: string[];\r\n    public geometries: IObjGeometry[];\r\n    public geometry: IObjGeometry | null;\r\n    public materials: MaterialMap;\r\n    public material: IObjMaterial;\r\n\r\n    public object: string;\r\n    public groups: string[];\r\n\r\n    public keywords: Record<string, (parts: string[], unparsedArgs: string) => void>;\r\n\r\n    protected _path: string;\r\n\r\n    constructor() {\r\n\r\n        this.objPositions = [];\r\n        this.objTexcoords = [];\r\n        this.objNormals = [];\r\n\r\n        // same order as `f` indices\r\n        this.objVertexData = [\r\n            this.objPositions,\r\n            this.objTexcoords,\r\n            this.objNormals,\r\n        ];\r\n\r\n        // same order as `f` indices\r\n        this.vertexData = [\r\n            [],   // positions\r\n            [],   // texcoords\r\n            [],   // normals\r\n        ];\r\n\r\n        this._materialLibs = [];\r\n        this.geometries = [];\r\n        this.geometry = null;\r\n        this.materials = {};\r\n        this.material = {};\r\n\r\n        this.object = 'default';\r\n        this.groups = ['default'];\r\n\r\n        this._path = \"\";\r\n\r\n        this.keywords = {\r\n            v: (parts: string[]) => {\r\n                this.objPositions.push(parts.map(parseFloat));\r\n            },\r\n            vn: (parts: string[]) => {\r\n                this.objNormals.push(parts.map(parseFloat));\r\n            },\r\n            vt: (parts: string[]) => {\r\n                // should check for missing v and extra w?\r\n                this.objTexcoords.push([parseFloat(parts[0]), 1.0 - parseFloat(parts[1])]);\r\n            },\r\n            f: (parts: string[]) => {\r\n                this.setGeometry();\r\n                const numTriangles = parts.length - 2;\r\n                for (let tri = 0; tri < numTriangles; ++tri) {\r\n                    this.addVertex(parts[0]);\r\n                    this.addVertex(parts[tri + 1]);\r\n                    this.addVertex(parts[tri + 2]);\r\n                }\r\n            },\r\n            s: () => {\r\n                // skip texture scale\r\n            },\r\n            mtllib: (parts: string[], unparsedArgs: string) => {\r\n                // the spec says there can be multiple filenames here\r\n                // but many exist with spaces in a single filename\r\n                this._materialLibs.push(unparsedArgs);\r\n            },\r\n            usemtl: (parts: string[], unparsedArgs: string) => {\r\n                this.newGeometry();\r\n                this.setGeometry();\r\n                if (this.geometry) {\r\n                    this.geometry.material = unparsedArgs;\r\n                }\r\n            },\r\n            g: (parts: string[]) => {\r\n                this.groups = parts;\r\n                this.newGeometry();\r\n            },\r\n            o: (parts: string[], unparsedArgs: string) => {\r\n                this.object = unparsedArgs;\r\n                this.newGeometry();\r\n            },\r\n            newmtl: (parts: string[], unparsedArgs: string) => {\r\n                const material = {};\r\n                this.material = material;\r\n                this.materials[unparsedArgs] = material;\r\n            },\r\n            Ns: (parts: string[], unparsedArgs: string) => {\r\n                this.material.shininess = parseFloat(unparsedArgs);\r\n            },\r\n            Ni: (parts: string[], unparsedArgs: string) => {\r\n                // skip refraction\r\n            },\r\n            Ka: (parts: string[], unparsedArgs: string) => {\r\n                this.material.ambient = parts.map(v => parseFloat(v)) as NumberArray3;\r\n            },\r\n            Kd: (parts: string[], unparsedArgs: string) => {\r\n                this.material.diffuse = parts.map(v => parseFloat(v)) as NumberArray3;\r\n            },\r\n            Ks: (parts: string[], unparsedArgs: string) => {\r\n                this.material.specular = parts.map(v => parseFloat(v)) as NumberArray3;\r\n            },\r\n            Ke: (parts: string[], unparsedArgs: string) => {\r\n                this.material.color = parts.map(v => parseFloat(v)) as NumberArray3;\r\n            },\r\n            illum: (parts: string[], unparsedArgs: string) => {\r\n                this.material.illum = parseFloat(unparsedArgs);\r\n            },\r\n            d: (parts: string[], unparsedArgs: string) => {\r\n                this.material.opacity = parseFloat(unparsedArgs);\r\n            },\r\n            Tr: (parts: string[], unparsedArgs: string) => {\r\n                this.material.opacity = parseFloat(unparsedArgs);\r\n            },\r\n            Tf: (parts: string[], unparsedArgs: string) => {\r\n                // skip transmission filter\r\n            },\r\n            map_Ka: (parts: string[], unparsedArgs: string) => {\r\n                // skip ambient texture\r\n            },\r\n            map_Kd: (parts: string[], unparsedArgs: string) => {\r\n                this.material.colorTexture = `${this._path}/${getTexturePath(unparsedArgs)}`;\r\n            },\r\n            map_Bump: (parts: string[], unparsedArgs: string) => {\r\n                this.material.normalTexture = `${this._path}/${getTexturePath(unparsedArgs)}`;\r\n            },\r\n            map_Ns: (parts: string[], unparsedArgs: string) => {\r\n                this.material.metallicRoughnessTexture = `${this._path}/${getTexturePath(unparsedArgs)}`;\r\n            },\r\n        };\r\n    }\r\n\r\n    public newGeometry() {\r\n        // If there is an existing geometry and it's\r\n        // not empty then start a new one.\r\n        if (this.geometry && this.geometry.data.vertices.length) {\r\n            this.geometry = null;\r\n        }\r\n    }\r\n\r\n    public setGeometry() {\r\n        if (!this.geometry) {\r\n\r\n            const vertices: number[] = [];\r\n            const texCoords: number[] = [];\r\n            const normals: number[] = [];\r\n\r\n            this.vertexData = [\r\n                vertices,\r\n                texCoords,\r\n                normals,\r\n            ];\r\n\r\n            this.geometry = {\r\n                object: this.object,\r\n                groups: this.groups,\r\n                material: \"\",\r\n                data: {\r\n                    vertices,\r\n                    texCoords,\r\n                    normals,\r\n                },\r\n            };\r\n\r\n            this.geometries.push(this.geometry!);\r\n        }\r\n    }\r\n\r\n    public addVertex(vert: string) {\r\n        let ptn = vert.split('/');\r\n        for (let i = 0; i < ptn.length; i++) {\r\n            let objIndexStr = ptn[i];\r\n            if (!objIndexStr) {\r\n                continue;\r\n            }\r\n            let index = parseInt(objIndexStr) - 1;\r\n\r\n            let v = this.vertexData[i];\r\n            let len = v.length;\r\n            let d = this.objVertexData[i][index];\r\n            let dlen = d.length;\r\n\r\n            this.vertexData[i].length = len + dlen;\r\n            for (let j = 0; j < dlen; j++) {\r\n                v[len + j] = d[j];\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _innerParser(text: string, fileName: string) {\r\n        const keywordRE = /(\\w*)(?: )*(.*)/;\r\n        const lines = text.split('\\n');\r\n        for (let lineNo = 0; lineNo < lines.length; ++lineNo) {\r\n            const line = lines[lineNo].trim();\r\n            if (line === '' || line.startsWith('#')) {\r\n                continue;\r\n            }\r\n            const m = keywordRE.exec(line);\r\n            if (!m) {\r\n                continue;\r\n            }\r\n            const [, keyword, unparsedArgs] = m;\r\n            const parts = line.split(/\\s+/).slice(1);\r\n            const handler = this.keywords[keyword];\r\n            if (!handler) {\r\n                console.warn(`Unknown keyword '${keyword}' in '${fileName}:${lineNo}'`);  // eslint-disable-line no-console\r\n                continue;\r\n            }\r\n            handler(parts, unparsedArgs);\r\n        }\r\n    }\r\n\r\n    get data(): IObj {\r\n        return {\r\n            geometries: this.geometries,\r\n            materials: this.materials\r\n        }\r\n    }\r\n\r\n    public async load(src: string) {\r\n\r\n        this._path = src.substring(0, src.lastIndexOf(\"/\"));\r\n\r\n        const response = await fetch(src);\r\n        if (!response.ok) {\r\n            throw new Error(`Unable to load '${src}'`);\r\n        }\r\n\r\n        const reader = response.body!.getReader();\r\n        const decoder = new TextDecoder();\r\n        let {value, done} = await reader.read();\r\n        let partialLine = '';\r\n\r\n        while (!done) {\r\n            const text = decoder.decode(value, {stream: true});\r\n            const lines = (partialLine + text).split('\\n');\r\n            partialLine = lines.pop()!;\r\n            for (const line of lines) {\r\n                this._innerParser(line, src);\r\n            }\r\n            ({value, done} = await reader.read());\r\n        }\r\n\r\n        if (partialLine) {\r\n            this._innerParser(partialLine, src);\r\n        }\r\n\r\n        this._cleanupGeometryArrays();\r\n\r\n        let defArr = this._materialLibs.map(filename => {\r\n            filename = `${this._path}/${filename}`;\r\n            return fetch(filename)\r\n                .then((response) => response.text())\r\n                .then((text: string) => {\r\n                    return {text, filename}\r\n                })\r\n        });\r\n\r\n        await Promise.all(defArr).then((mtlArr) => {\r\n            mtlArr.forEach(mtl => this._innerParser(mtl.text, mtl.filename));\r\n        });\r\n\r\n        return this.data;\r\n    }\r\n\r\n    protected async _readAndParse(file: File) {\r\n        const stream = file.stream();\r\n        const reader = stream.getReader();\r\n        const decoder = new TextDecoder();\r\n        let {value, done} = await reader.read();\r\n        let partialLine = \"\";\r\n\r\n        while (!done) {\r\n            const text = decoder.decode(value, {stream: true});\r\n            const lines = (partialLine + text).split(\"\\n\");\r\n            partialLine = lines.pop()!;\r\n\r\n            for (const line of lines) {\r\n                this._innerParser(line, file.name);\r\n            }\r\n\r\n            ({value, done} = await reader.read());\r\n        }\r\n\r\n        if (partialLine) {\r\n            this._innerParser(partialLine, file.name);\r\n        }\r\n    }\r\n\r\n    public async readFile(objFile: File, mtlFile?: File | null) {\r\n        this._path = \"\";\r\n\r\n        await this._readAndParse(objFile);\r\n\r\n        this._cleanupGeometryArrays();\r\n\r\n        if (mtlFile) {\r\n            await this._readAndParse(mtlFile);\r\n        }\r\n\r\n        return this.data;\r\n    }\r\n\r\n    protected _cleanupGeometryArrays() {\r\n        for (const geometry of this.geometries) {\r\n            geometry.data = Object.fromEntries(\r\n                Object.entries(geometry.data).filter(([key, array]) => array.length > 0)\r\n            ) as IObjGeometryData;\r\n        }\r\n    }\r\n}\r\n\r\n\r\nfunction rotateObject(obj: IObjGeometryData, angle: number): { vertices: number[], normals: number[] } {\r\n    const cosA = Math.cos(angle);\r\n    const sinA = Math.sin(angle);\r\n\r\n    const vertices = obj.vertices;\r\n    const normals = obj.normals;\r\n\r\n    for (let i = 0; i < vertices.length; i += 3) {\r\n        const x = vertices[i];\r\n        const y = vertices[i + 1];\r\n        const z = vertices[i + 2];\r\n\r\n        vertices[i] = x * cosA + z * sinA;\r\n        vertices[i + 1] = y;\r\n        vertices[i + 2] = -x * sinA + z * cosA;\r\n\r\n        const nx = normals[i];\r\n        const ny = normals[i + 1];\r\n        const nz = normals[i + 2];\r\n\r\n        normals[i] = nx * cosA + nz * sinA;\r\n        normals[i + 1] = ny;\r\n        normals[i + 2] = -nx * sinA + nz * cosA;\r\n    }\r\n\r\n    return {\r\n        vertices: vertices,\r\n        normals: normals\r\n    };\r\n}\r\n\r\n","import {htmlColorToFloat32Array} from './utils/shared';\r\nimport type {TypedArray} from './utils/shared';\r\nimport {Vec3} from './math/Vec3';\r\nimport type {NumberArray3} from './math/Vec3';\r\nimport {DEGREES_DOUBLE, MAX, MIN, RADIANS_HALF} from './math';\r\nimport {Mat4} from \"./math/Mat4\";\r\nimport {Obj} from \"./utils/objParser\";\r\nimport type {IObjGeometry} from \"./utils/objParser\";\r\n\r\nfunction getColor(color?: number[] | TypedArray | string): Float32Array {\r\n    if (color instanceof Array) {\r\n        return new Float32Array(color);\r\n    } else if (typeof color === 'string') {\r\n        return htmlColorToFloat32Array(color);\r\n    }\r\n    return new Float32Array([1.0, 1.0, 1.0, 1.0]);\r\n}\r\n\r\nfunction getColor3v(color?: NumberArray3 | TypedArray | string): Float32Array {\r\n    let res = new Float32Array([1.0, 1.0, 1.0]);\r\n    if (color instanceof Array) {\r\n        res[0] = color[0];\r\n        res[1] = color[1];\r\n        res[2] = color[2];\r\n    } else if (typeof color === 'string') {\r\n        let c = htmlColorToFloat32Array(color);\r\n        res[0] = c[0];\r\n        res[1] = c[1];\r\n        res[2] = c[2];\r\n    }\r\n    return res;\r\n}\r\n\r\ninterface IObject3dParams {\r\n    name?: string;\r\n    vertices?: number[];\r\n    texCoords?: number[];\r\n    indices?: number[];\r\n    normals?: number[];\r\n    center?: boolean;\r\n    color?: number[] | TypedArray | string;\r\n    scale?: number | Vec3;\r\n    ambient?: string | NumberArray3;\r\n    diffuse?: string | NumberArray3;\r\n    specular?: string | NumberArray3;\r\n    shininess?: number;\r\n    colorTexture?: string;\r\n    normalTexture?: string;\r\n    metallicRoughnessTexture?: string;\r\n}\r\n\r\ntype MaterialParams = Pick<IObject3dParams, 'ambient' | 'diffuse' | 'specular' | 'shininess'>;\r\n\r\n\r\nclass Object3d {\r\n\r\n    protected _name: string;\r\n    protected _vertices: number[];\r\n    protected _numVertices: number;\r\n    protected _texCoords: number[];\r\n\r\n    protected _indices: number[];\r\n    protected _normals: number[];\r\n\r\n    public color: Float32Array;\r\n    public ambient: Float32Array;\r\n    public diffuse: Float32Array;\r\n    public specular: Float32Array;\r\n    public shininess: number;\r\n    public colorTexture: string;\r\n    public normalTexture: string;\r\n    public metallicRoughnessTexture: string;\r\n    public center: Vec3;\r\n\r\n    constructor(data: IObject3dParams = {}) {\r\n\r\n        this._name = data.name || \"noname\";\r\n        this._vertices = data.vertices || [];\r\n        this._numVertices = this._vertices.length / 3;\r\n        this._texCoords = data.texCoords || new Array(2 * this._numVertices);\r\n        // if (data.texCoords) {\r\n        //     this._texCoords = data.texCoords;\r\n        // } else {\r\n        //     this._texCoords = Array.from({length: 2 * this._numVertices}, (_, i) => 0);\r\n        // }\r\n\r\n\r\n        this.color = getColor(data.color);\r\n        this.ambient = getColor3v(data.ambient);\r\n        this.diffuse = getColor3v(data.diffuse);\r\n        this.specular = getColor3v(data.specular);\r\n        this.shininess = data.shininess || 100;\r\n        this.colorTexture = data.colorTexture || \"\";\r\n        this.normalTexture = data.normalTexture || \"\";\r\n        this.metallicRoughnessTexture = data.metallicRoughnessTexture || \"\";\r\n\r\n        if (data.scale) {\r\n            let s = data.scale;\r\n            let scale: Vec3;\r\n            if (typeof s === 'number') {\r\n                scale = new Vec3(s, s, s);\r\n            } else {\r\n                scale = s;\r\n            }\r\n            Object3d.scale(this._vertices, scale);\r\n        }\r\n\r\n        if (data.center) {\r\n            Object3d.centering(this._vertices);\r\n        }\r\n\r\n        this.center = Object3d.getCenter(this._vertices);\r\n\r\n        if (data.indices) {\r\n            this._indices = data.indices;\r\n            this._normals = data.normals || [];\r\n        } else {\r\n            this._normals = data.normals || Object3d.getNormals(this._vertices);\r\n            this._indices = new Array(this._vertices.length / 3);\r\n            for (let i = 0, len = this._indices.length; i < len; i++) {\r\n                this._indices[i] = i;\r\n            }\r\n        }\r\n    }\r\n\r\n    static getCenter(verts: number[]): Vec3 {\r\n\r\n        let min_x = MAX, min_y = MAX, min_z = MAX,\r\n            max_x = MIN, max_y = MIN, max_z = MIN;\r\n\r\n        for (let i = 0, len = verts.length; i < len; i += 3) {\r\n            let x = verts[i], y = verts[i + 1], z = verts[i + 2];\r\n            if (x < min_x) min_x = x;\r\n            if (y < min_y) min_y = y;\r\n            if (z < min_z) min_z = z;\r\n            if (x > max_x) max_x = x;\r\n            if (y > max_y) max_y = y;\r\n            if (z > max_z) max_z = z;\r\n        }\r\n\r\n        return new Vec3(\r\n            min_x + (max_x - min_x) * 0.5,\r\n            min_y + (max_y - min_y) * 0.5,\r\n            min_z + (max_z - min_z) * 0.5\r\n        );\r\n    }\r\n\r\n    static centering(verts: number[]) {\r\n        let c = Object3d.getCenter(verts);\r\n        for (let i = 0, len = verts.length; i < len; i += 3) {\r\n            verts[i] -= c.x;\r\n            verts[i + 1] -= c.y;\r\n            verts[i + 2] -= c.z;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets the material properties for the 3D object.\r\n     *\r\n     * @param {MaterialParams} data - An object containing material properties.\r\n     * @param {string | NumberArray3} [data.ambient] - Ambient color of the material, as a hex string (e.g., \"#ffffff\") or an array of three numbers [r, g, b].\r\n     * @param {string | NumberArray3} [data.diffuse] - Diffuse color of the material.\r\n     * @param {string | NumberArray3} [data.specular] - Specular color of the material.\r\n     * @param {number} [data.shininess=100] - Shininess coefficient of the material, controlling specular highlight size.\r\n     */\r\n    public setMaterial(data: MaterialParams) {\r\n        if (data.ambient) {\r\n            this.ambient = getColor3v(data.ambient);\r\n        }\r\n        if (data.diffuse) {\r\n            this.diffuse = getColor3v(data.diffuse);\r\n        }\r\n        if (data.specular) {\r\n            this.specular = getColor3v(data.specular);\r\n        }\r\n        if (data.shininess !== undefined) {\r\n            this.shininess = data.shininess;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public centering(): this {\r\n        Object3d.centering(this._vertices);\r\n        return this;\r\n    }\r\n\r\n    public applyMat4(m: Mat4): this {\r\n        for (let i = 0, len = this._vertices.length; i < len; i += 3) {\r\n            let v = new Vec3(this._vertices[i], this._vertices[i + 1], this._vertices[i + 2]),\r\n                n = new Vec3(this._normals[i], this._normals[i + 1], this._normals[i + 2]);\r\n\r\n            v = m.mulVec3(v);\r\n            n = m.mulVec3(n);\r\n\r\n            this._vertices[i] = v.x;\r\n            this._vertices[i + 1] = v.y;\r\n            this._vertices[i + 2] = v.z;\r\n\r\n            this._normals[i] = n.x;\r\n            this._normals[i + 1] = n.y;\r\n            this._normals[i + 2] = n.z;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public scale(s: Vec3): this {\r\n        Object3d.scale(this._vertices, s);\r\n        return this;\r\n    }\r\n\r\n    public translate(v: Vec3): this {\r\n        for (let i = 0, len = this._vertices.length; i < len; i += 3) {\r\n            this._vertices[i] += v.x;\r\n            this._vertices[i + 1] += v.y;\r\n            this._vertices[i + 2] += v.z;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    public get vertices(): number[] {\r\n        return this._vertices;\r\n    }\r\n\r\n    public get normals(): number[] {\r\n        return this._normals;\r\n    }\r\n\r\n    public get indices(): number[] {\r\n        return this._indices;\r\n    }\r\n\r\n    public get texCoords(): number[] {\r\n        return this._texCoords;\r\n    }\r\n\r\n    public get numVertices(): number {\r\n        return this._numVertices;\r\n    }\r\n\r\n    static scale(vertices: number[], s: Vec3) {\r\n        for (let i = 0; i < vertices.length; i += 3) {\r\n            vertices[i] *= s.x;\r\n            vertices[i + 1] *= s.y;\r\n            vertices[i + 2] *= s.z;\r\n        }\r\n    }\r\n\r\n    static centroid(vertices: number[]) {\r\n        let minX = 1000.0, minY = 1000.0, minZ = 1000.0, maxX = -1000.0, maxY = -1000.0, maxZ = -1000.0;\r\n\r\n        for (let i = 0; i < vertices.length; i += 3) {\r\n            let x = vertices[i], y = vertices[i + 1], z = vertices[i + 2];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (z < minZ) minZ = z;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n            if (z > maxZ) maxZ = z;\r\n        }\r\n\r\n        return [minX + (maxX - minX) * 0.5, minY + (maxY - minY) * 0.5, minZ + (maxZ - minZ) * 0.5];\r\n    }\r\n\r\n    static translate(vertices: number[], v: NumberArray3) {\r\n        for (let i = 0; i < vertices.length; i += 3) {\r\n            vertices[i] += v[0];\r\n            vertices[i + 1] += v[1];\r\n            vertices[i + 2] += v[2];\r\n        }\r\n    }\r\n\r\n    static getNormals(vertices: number[]): number[] {\r\n        let res = new Array(vertices.length);\r\n\r\n        for (let i = 0; i < vertices.length; i += 9) {\r\n\r\n            let t03 = i, t13 = i + 3, t23 = i + 6, v0_x = vertices[t03], v0_y = vertices[t03 + 1],\r\n                v0_z = vertices[t03 + 2], v1_x = vertices[t13], v1_y = vertices[t13 + 1], v1_z = vertices[t13 + 2],\r\n                v2_x = vertices[t23], v2_y = vertices[t23 + 1], v2_z = vertices[t23 + 2], vv0_x = v1_x - v0_x,\r\n                vv0_y = v1_y - v0_y, vv0_z = v1_z - v0_z, vv1_x = v2_x - v0_x, vv1_y = v2_y - v0_y, vv1_z = v2_z - v0_z,\r\n                n_x = vv0_y * vv1_z - vv0_z * vv1_y, n_y = vv0_z * vv1_x - vv0_x * vv1_z,\r\n                n_z = vv0_x * vv1_y - vv0_y * vv1_x;\r\n\r\n            let l = Math.sqrt(n_x * n_x + n_y * n_y + n_z * n_z);\r\n\r\n            n_x /= l;\r\n            n_y /= l;\r\n            n_z /= l;\r\n\r\n            res[t03] = n_x;\r\n            res[t03 + 1] = n_y;\r\n            res[t03 + 2] = n_z;\r\n\r\n            res[t13] = n_x;\r\n            res[t13 + 1] = n_y;\r\n            res[t13 + 2] = n_z;\r\n\r\n            res[t23] = n_x;\r\n            res[t23 + 1] = n_y;\r\n            res[t23 + 2] = n_z;\r\n        }\r\n\r\n        return res;\r\n    }\r\n\r\n    static createSphere(lonBands: number = 16, latBands: number = 16, radius: number = 1.0,\r\n                        offsetX: number = 0, offsetY: number = 0, offsetZ: number = 0): Object3d {\r\n\r\n        let vertices = [], indices = [], normals = [];\r\n\r\n        for (let latNumber = 0; latNumber <= latBands; latNumber++) {\r\n            let theta = latNumber * Math.PI / latBands;\r\n            let sinTheta = Math.sin(theta);\r\n            let cosTheta = Math.cos(theta);\r\n\r\n            for (let longNumber = 0; longNumber <= lonBands; longNumber++) {\r\n                let phi = longNumber * 2 * Math.PI / lonBands;\r\n                let sinPhi = Math.sin(phi);\r\n                let cosPhi = Math.cos(phi);\r\n                let x = cosPhi * sinTheta + offsetX;\r\n                let y = cosTheta + offsetY;\r\n                let z = sinPhi * sinTheta + offsetZ;\r\n                //var u = 1 - (longNumber / lonBands);\r\n                //var v = latNumber / latBands;\r\n                normals.push(x);\r\n                normals.push(y);\r\n                normals.push(z);\r\n                //texCoords.push(u);\r\n                //texCoords.push(v);\r\n                vertices.push(radius * x);\r\n                vertices.push(radius * y);\r\n                vertices.push(radius * z);\r\n            }\r\n        }\r\n\r\n        for (let latNumber = 0; latNumber < latBands; latNumber++) {\r\n            for (let longNumber = 0; longNumber < lonBands; longNumber++) {\r\n                let first = (latNumber * (lonBands + 1)) + longNumber;\r\n                let second = first + lonBands + 1;\r\n\r\n                indices.push(first);\r\n                indices.push(first + 1);\r\n                indices.push(second);\r\n\r\n                indices.push(second);\r\n                indices.push(first + 1);\r\n                indices.push(second + 1);\r\n            }\r\n        }\r\n\r\n        return new Object3d({\r\n            'vertices': vertices, 'normals': normals, 'indices': indices\r\n        });\r\n    }\r\n\r\n    static createDisc(radius: number = 1.0, height: number = 0.0,\r\n                      radialSegments: number = 8, isTop: boolean = true, startIndex: number = 0,\r\n                      offsetX: number = 0, offsetY: number = 0, offsetZ: number = 0\r\n    ): Object3d {\r\n\r\n        let vertices = [], indices = [], normals = [];\r\n\r\n        let thetaStart = 0.0, thetaLength = Math.PI * 2;\r\n\r\n        let sign = isTop ? 1.0 : -1.0;\r\n\r\n        let centerIndexStart = startIndex;\r\n\r\n        for (let x = 1; x <= radialSegments; x++) {\r\n            vertices.push(offsetX, height * sign + offsetY, offsetZ);\r\n            normals.push(0, sign, 0);\r\n            //texCoords.push(0.5, 0.5);\r\n            startIndex++;\r\n        }\r\n\r\n        let centerIndexEnd = startIndex;\r\n\r\n        for (let x = 0; x <= radialSegments; x++) {\r\n\r\n            let u = x / radialSegments;\r\n            let theta = u * thetaLength + thetaStart;\r\n\r\n            let cosTheta = Math.cos(theta);\r\n            let sinTheta = Math.sin(theta);\r\n\r\n            vertices.push(radius * sinTheta + offsetX, height * sign + offsetY, radius * cosTheta + offsetZ);\r\n            normals.push(0, sign, 0);\r\n            //texCoords.push((cosTheta * 0.5) + 0.5, (sinTheta * 0.5 * sign) + 0.5);\r\n\r\n            startIndex++;\r\n        }\r\n\r\n        for (let x = 0; x < radialSegments; x++) {\r\n            let c = centerIndexStart + x, i = centerIndexEnd + x;\r\n            if (isTop) {\r\n                indices.push(i, i + 1, c);\r\n            } else {\r\n                indices.push(i + 1, i, c);\r\n            }\r\n        }\r\n\r\n        return new Object3d({\r\n            'vertices': vertices, 'normals': normals, 'indices': indices\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Returns scale parameters for a frustum geoObject created with only Object3d.createFrustum();\r\n     * @param length\r\n     * @param horizontalAngle\r\n     * @param verticalAngle\r\n     */\r\n    static getFrustumScaleByCameraAngles(length: number, horizontalAngle: number, verticalAngle: number): Vec3 {\r\n        return new Vec3(\r\n            2.0 * length * Math.tan(RADIANS_HALF * horizontalAngle),\r\n            2.0 * length * Math.tan(RADIANS_HALF * verticalAngle),\r\n            length\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns scale parameters for a frustum geoObject created with only Object3d.createFrustum();\r\n     * @param length\r\n     * @param horizontalAngle\r\n     * @param aspectRatio\r\n     */\r\n    static getFrustumScaleByCameraAspectRatio(length: number, horizontalAngle: number, aspectRatio: number): Vec3 {\r\n        let vAngle = DEGREES_DOUBLE * Math.atan(Math.tan(RADIANS_HALF * horizontalAngle) / aspectRatio);\r\n        return Object3d.getFrustumScaleByCameraAngles(length, horizontalAngle, vAngle);\r\n    }\r\n\r\n    static createFrustum(length: number = 1, width: number = 1, height: number = 1,\r\n                         xOffset: number = 0, yOffset: number = 0, zOffset: number = 0): Object3d {\r\n\r\n        width *= 0.5;\r\n        height *= 0.5;\r\n\r\n        return new Object3d({\r\n            vertices: [\r\n                //\r\n                //inside\r\n                //\r\n                //top\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                -1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                //bottop\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                -1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                //right\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                //left\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                -1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                -1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                //\r\n                // outside\r\n                //\r\n                //top\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                -1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                //bottop\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                -1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                //right\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset,\r\n                1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                //left\r\n                0 + xOffset, 0 + yOffset, 0 + zOffset,\r\n                -1 * width + xOffset, 1 * height + yOffset, -1 * length + zOffset,\r\n                -1 * width + xOffset, -1 * height + yOffset, -1 * length + zOffset\r\n            ]\r\n        });\r\n    }\r\n\r\n    static createCylinder(radiusTop: number = 1.0, radiusBottom: number = 1.0, height: number = 1.0,\r\n                          radialSegments: number = 32, heightSegments: number = 1.0, isTop: boolean = true,\r\n                          isBottom: boolean = true, offsetX: number = 0, offsetY: number = 0, offsetZ: number = 0): Object3d {\r\n\r\n        let vertices: number[] = [],\r\n            indices: number[] = [],\r\n            normals: number[] = [];\r\n\r\n        let thetaStart = 0.0, thetaLength = Math.PI * 2;\r\n\r\n        let index = 0;\r\n        let indexArray = [];\r\n\r\n        let normal = new Vec3();\r\n\r\n        let slope = (radiusBottom - radiusTop) / height;\r\n\r\n        for (let y = 0; y <= heightSegments; y++) {\r\n\r\n            let indexRow = [];\r\n\r\n            let v = y / heightSegments;\r\n\r\n            let radius = v * (radiusBottom - radiusTop) + radiusTop;\r\n\r\n            for (let x = 0; x <= radialSegments; x++) {\r\n\r\n                let u = x / radialSegments;\r\n\r\n                let theta = u * thetaLength + thetaStart;\r\n\r\n                let sinTheta = Math.sin(theta), cosTheta = Math.cos(theta);\r\n\r\n                vertices.push(radius * sinTheta + offsetX, -v * height + height + offsetY, radius * cosTheta + offsetZ);\r\n\r\n                normal.set(sinTheta, slope, cosTheta).normalize();\r\n                normals.push(normal.x, normal.y, normal.z);\r\n\r\n                //texCoords.push(u, 1 - v);\r\n\r\n                indexRow.push(index++);\r\n            }\r\n            indexArray.push(indexRow);\r\n        }\r\n\r\n        for (let x = 0; x < radialSegments; x++) {\r\n            for (let y = 0; y < heightSegments; y++) {\r\n\r\n                let a = indexArray[y][x], b = indexArray[y + 1][x], c = indexArray[y + 1][x + 1],\r\n                    d = indexArray[y][x + 1];\r\n\r\n                indices.push(a, b, d);\r\n                indices.push(b, c, d);\r\n            }\r\n        }\r\n\r\n        if (radiusTop !== 0.0 && isTop) {\r\n            let cap = Object3d.createDisc(radiusTop, height, radialSegments, true, index, offsetX, offsetY, offsetZ);\r\n            vertices.push(...cap.vertices);\r\n            normals.push(...cap.normals);\r\n            indices.push(...cap.indices);\r\n        }\r\n\r\n        if (radiusBottom !== 0.0 && isBottom) {\r\n            let cap = Object3d.createDisc(radiusBottom, 0, radialSegments, false, index + (isTop ? (1 + 2 * radialSegments) : 0), offsetX, offsetY, offsetZ);\r\n            vertices.push(...cap.vertices);\r\n            normals.push(...cap.normals);\r\n            indices.push(...cap.indices);\r\n        }\r\n\r\n        return new Object3d({\r\n            vertices: vertices,\r\n            normals: normals,\r\n            indices: indices\r\n        });\r\n    }\r\n\r\n    static createCube(length: number = 1, height: number = 1, depth: number = 1,\r\n                      xOffset: number = 0, yOffset: number = 0, zOffset: number = 0): Object3d {\r\n        let l = length * 0.5 + xOffset, h = height * 0.5 + yOffset, d = depth * 0.5 + zOffset;\r\n\r\n        return new Object3d({\r\n            vertices: [//bottom\r\n                -l, -h, d, l, -h, -d, l, -h, d, -l, -h, d, -l, -h, -d, l, -h, -d,\r\n\r\n                //top\r\n                -l, h, d, l, h, d, l, h, -d, -l, h, d, l, h, -d, -l, h, -d,\r\n\r\n                //front\r\n                -l, -h, d, l, -h, d, -l, h, d, -l, h, d, l, -h, d, l, h, d,\r\n\r\n                //back\r\n                -l, -h, -d, -l, h, -d, l, -h, -d, -l, h, -d, l, h, -d, l, -h, -d,\r\n\r\n                //left\r\n                l, -h, d, l, -h, -d, l, h, d, l, h, d, l, -h, -d, l, h, -d,\r\n\r\n                //right\r\n                -l, -h, d, -l, h, d, -l, -h, -d, -l, h, d, -l, h, -d, -l, -h, -d]\r\n        });\r\n    }\r\n\r\n    static createPlane(width: number = 1, height: number = 1, xOffset: number = 0, yOffset: number = 0, zOffset: number = 0): Object3d {\r\n        let sx = width * 0.5, sy = yOffset, sz = height * 0.5;\r\n\r\n        return new Object3d({\r\n            vertices: [\r\n                //bottom\r\n                -sx + xOffset, sy, sz + zOffset, sx + xOffset, sy, -sz + zOffset, sx + xOffset, sy, sz + zOffset, -sx + xOffset, sy, sz + zOffset, -sx + xOffset, sy, -sz + zOffset, sx + xOffset, sy, -sz + zOffset,\r\n                //top\r\n                -sx + xOffset, sy, sz + zOffset, sx + xOffset, sy, sz + zOffset, sx + xOffset, sy, -sz + zOffset, -sx + xOffset, sy, sz + zOffset, sx + xOffset, sy, -sz + zOffset, -sx + xOffset, sy, -sz + zOffset\r\n            ]\r\n        });\r\n    }\r\n\r\n    static createArrow(back: number = 0.0, height: number = 2.1, front: number = -15): Object3d {\r\n        return new Object3d({\r\n            vertices: [0, height, 0, 7, 0, 6, 0, 0, front,\r\n                0, 0, back, 7, 0, 6, 0, height, 0,\r\n                -7, 0, 6, 0, 0, back, 0, height, 0,\r\n                -7, 0, 6, 0, height, 0, 0, 0, front,\r\n                -7, 0, 6, 0, 0, front, 0, 0, back, 0, 0, back, 0, 0, front, 7, 0, 6]\r\n        });\r\n    }\r\n\r\n    static async readFileObj(objFile: File, mtlFile?: File | null, baseUrl?: string): Promise<Object3d[]> {\r\n\r\n        let obj = new Obj();\r\n\r\n        const res = await obj.readFile(objFile, mtlFile);\r\n\r\n        let materials = res.materials;\r\n\r\n        return res.geometries.map(\r\n            (obj: IObjGeometry) => {\r\n                let mat = materials[obj.material] || {};\r\n                return new Object3d({\r\n                    name: obj.object,\r\n                    vertices: obj.data.vertices,\r\n                    normals: obj.data.normals,\r\n                    texCoords: obj.data.texCoords,\r\n                    ambient: mat.ambient,\r\n                    diffuse: mat.diffuse,\r\n                    specular: mat.specular,\r\n                    shininess: mat.shininess,\r\n                    color: mat.color,\r\n                    colorTexture: baseUrl ? `${baseUrl}/${mat.colorTexture}` : mat.colorTexture,\r\n                    normalTexture: baseUrl ? `${baseUrl}/${mat.normalTexture}` : mat.normalTexture,\r\n                    metallicRoughnessTexture: baseUrl ? `${baseUrl}/${mat.metallicRoughnessTexture}` : mat.metallicRoughnessTexture\r\n                })\r\n            }\r\n        );\r\n    }\r\n\r\n    static async loadObj(src: string): Promise<Object3d[]> {\r\n\r\n        let obj = new Obj();\r\n\r\n        const res = await obj.load(src);\r\n\r\n        let materials = res.materials;\r\n\r\n        return res.geometries.map(\r\n            (obj: IObjGeometry) => {\r\n                let mat = materials[obj.material] || {};\r\n                return new Object3d({\r\n                    name: obj.object,\r\n                    vertices: obj.data.vertices,\r\n                    normals: obj.data.normals,\r\n                    texCoords: obj.data.texCoords,\r\n                    ambient: mat.ambient,\r\n                    diffuse: mat.diffuse,\r\n                    specular: mat.specular,\r\n                    shininess: mat.shininess,\r\n                    color: mat.color,\r\n                    colorTexture: mat.colorTexture,\r\n                    normalTexture: mat.normalTexture,\r\n                    metallicRoughnessTexture: mat.metallicRoughnessTexture\r\n                })\r\n            }\r\n        );\r\n    }\r\n\r\n    public merge(other: Object3d): Object3d {\r\n        const offset = this._vertices.length / 3;\r\n\r\n        let temp = this._vertices.length;\r\n        this._vertices.length = temp + other._vertices.length;\r\n        for (let i = 0; i < other._vertices.length; i++) {\r\n            this._vertices[temp + i] = other._vertices[i];\r\n        }\r\n\r\n        temp = this._normals.length;\r\n        this._normals.length = temp + other._normals.length;\r\n        for (let i = 0; i < other._normals.length; i++) {\r\n            this._normals[temp + i] = other._normals[i];\r\n        }\r\n\r\n        temp = this._texCoords.length;\r\n        this._texCoords.length = temp + other._texCoords.length;\r\n        for (let i = 0; i < other._texCoords.length; i++) {\r\n            this._texCoords[temp + i] = other._texCoords[i];\r\n        }\r\n\r\n        temp = this._indices.length;\r\n        this._indices.length = temp + other._indices.length;\r\n        for (let i = 0; i < other._indices.length; i++) {\r\n            this._indices[temp + i] = other._indices[i] + offset;\r\n        }\r\n\r\n        this._numVertices = this._vertices.length / 3;\r\n\r\n        return this;\r\n    }\r\n\r\n    static merge(objects: Object3d[], maxSize?: number): Object3d {\r\n        let res = new Object3d();\r\n        let size = maxSize ? maxSize : objects.length;\r\n        for (let i = 0; i < size; i++) {\r\n            res.merge(objects[i]);\r\n        }\r\n        return res;\r\n    }\r\n}\r\n\r\nexport {Object3d};","import * as utils from \"../utils/shared\";\r\nimport {Entity} from \"./Entity\";\r\nimport {Quat, Vec3, Vec4} from \"../math/index\";\r\nimport {GeoObjectHandler} from \"./GeoObjectHandler\";\r\nimport {InstanceData} from \"./InstanceData\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {Object3d} from \"../Object3d\";\r\n\r\nexport const LOCAL_FORWARD = new Vec3(0.0, 0.0, -1.0);\r\n\r\n/**\r\n * Interface for GeoObject parameters.\r\n * @typedef {Object} IGeoObjectParams\r\n * @property {Object3d} [object3d] - 3D object associated with the geo object.\r\n * @property {string} [objSrc] - Source url of the 3D object.\r\n * @property {string} [tag] - Unique instancing drawing identifier tag.\r\n * @property {Vec3 | NumberArray3} [position] - Position in Cartesian coordinates.\r\n * @property {number | Vec3 | NumberArray3} [scale] - Scale of the object.\r\n * @property {Vec3 | NumberArray3} [translate] - Translation offset.\r\n * @property {Vec4 | NumberArray4 | string} [color] - RGBA color or HTML color string.\r\n * @property {boolean} [visibility] - Visibility flag.\r\n */\r\nexport interface IGeoObjectParams {\r\n    object3d?: Object3d;\r\n    objSrc?: string;\r\n    tag?: string;\r\n    position?: Vec3 | NumberArray3;\r\n    scale?: number | Vec3 | NumberArray3;\r\n    translate?: Vec3 | NumberArray3;\r\n    color?: Vec4 | NumberArray4 | string;\r\n    visibility?: boolean;\r\n}\r\n\r\n/**\r\n * Represents 3D object on the the globe or 3d space\r\n * @class\r\n * @param {IGeoObjectParams} options -  Geo object parameters:\r\n * @param {Object3d} [options.object3d] - 3D object associated with the geo object.\r\n * @param {string} [options.objSrc] - Source url of the 3D object.\r\n * @param {string} [options.tag] - Unique instancing drawing identifier tag.\r\n * @param {Vec3 | NumberArray3} [options.position] - Position in Cartesian coordinates.\r\n * @param {number | Vec3 | NumberArray3} [options.scale=1] - Scale of the object.\r\n * @param {Vec3 | NumberArray3} [options.translate] - Translation offset.\r\n * @param {Vec4 | NumberArray4 | string} [options.color] - RGBA color or HTML color string.\r\n * @param {boolean} [options.visibility=true] - Visibility flag.\r\n *\r\n * @todo: GeoObject and GeoObjectHandler provides instanced objects only.\r\n * It would be nice if it could provide not instanced rendering loop too.\r\n */\r\nclass GeoObject {\r\n    protected _tag: string;\r\n\r\n    static __counter__: number = 0;\r\n\r\n    /**\r\n     * Entity instance that holds this geo object.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public _entity: Entity | null;\r\n\r\n    /**\r\n     * Geo object center cartesian position.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    protected _position: Vec3;\r\n    public _rtcPositionHigh: Vec3;\r\n    public _rtcPositionLow: Vec3;\r\n\r\n    protected _scale: Vec3;\r\n    protected _translate: Vec3;\r\n    protected _localPosition: Vec3;\r\n\r\n    /**\r\n     * RGBA color.\r\n     * @public\r\n     * @type {Vec4}\r\n     */\r\n    public _color: Vec4;\r\n\r\n    protected _qFrame: Quat;\r\n    public _qRot: Quat;\r\n    protected _direction: Vec3;\r\n\r\n    public _handler: GeoObjectHandler | null;\r\n    public _handlerIndex = -1;\r\n\r\n    public _tagData: InstanceData | null;\r\n    public _tagDataIndex: number;\r\n\r\n    protected _object3d: Object3d;\r\n    public _objectSrc?: string;\r\n\r\n    protected _visibility: boolean;\r\n\r\n    protected _children: GeoObject[];\r\n\r\n    constructor(options: IGeoObjectParams) {\r\n\r\n        this._tag = options.tag || `tag_${GeoObject.__counter__++}`;\r\n\r\n        this._entity = null;\r\n\r\n        this._position = utils.createVector3(options.position);\r\n\r\n        this._rtcPositionHigh = new Vec3();\r\n        this._rtcPositionLow = new Vec3();\r\n\r\n        this._scale = utils.createVector3(options.scale, new Vec3(1, 1, 1));\r\n        this._translate = utils.createVector3(options.translate, new Vec3());\r\n\r\n        this._localPosition = new Vec3();\r\n\r\n        this._color = utils.createColorRGBA(options.color, new Vec4(0.15, 0.15, 0.15, 1.0));\r\n\r\n        this._handler = null;\r\n        this._handlerIndex = -1;\r\n\r\n        this._tagData = null;\r\n        this._tagDataIndex = -1;\r\n        let object3d = options.object3d;\r\n        if ((!options.object3d || options.object3d?.vertices.length === 0)) {\r\n            object3d = new Object3d();\r\n        }\r\n        if (options.objSrc) {\r\n            this.setObjectSrc(options.objSrc)\r\n            this._objectSrc = options.objSrc;\r\n        }\r\n\r\n        this._object3d = object3d as Object3d;\r\n\r\n        // if (options.colorTexture) {\r\n        //     this.setColorTexture(options.colorTexture)\r\n        // }\r\n\r\n        this._visibility = (options.visibility != undefined ? options.visibility : true);\r\n\r\n        this._children = [];\r\n\r\n        this._direction = new Vec3();\r\n\r\n        this._qFrame = new Quat();\r\n\r\n        this._qRot = Quat.IDENTITY;\r\n    }\r\n\r\n    /**\r\n     * Gets the unique tag of the geo object.\r\n     * @returns {string}\r\n     */\r\n    public get tag() {\r\n        return this._tag;\r\n    }\r\n\r\n    /**\r\n     * Gets the position of the geo object.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getPosition(): Vec3 {\r\n        return this._position;\r\n    }\r\n\r\n    /**\r\n     * Gets the 3D object associated with this geo object.\r\n     * @public\r\n     * @returns {Object3d}\r\n     */\r\n    public get object3d(): Object3d {\r\n        return this._object3d;\r\n    }\r\n\r\n    /**\r\n     * Gets geometry mesh vertices.\r\n     * @public\r\n     * @returns {number[]}\r\n     */\r\n    public get vertices(): number[] {\r\n        return this._object3d.vertices;\r\n    }\r\n\r\n    /**\r\n     * Gets geometry mesh normals.\r\n     * @public\r\n     * @returns {number[]}\r\n     */\r\n    public get normals(): number[] {\r\n        return this._object3d.normals;\r\n    }\r\n\r\n    /**\r\n     * Gets geometry mesh texture coordinates.\r\n     * @public\r\n     * @returns {number[]}\r\n     */\r\n    public get texCoords(): number[] {\r\n        return this._object3d.texCoords;\r\n    }\r\n\r\n    /**\r\n     * Gets geometry mesh indices.\r\n     * @public\r\n     * @returns {number[]}\r\n     */\r\n    public get indices(): number[] {\r\n        return this._object3d.indices;\r\n    }\r\n\r\n    /**\r\n     * Sets the opacity of the geo object.\r\n     * @param {number} a - Opacity value (0 to 1).\r\n     */\r\n    public setOpacity(a: number) {\r\n        this._color.w = a;\r\n        this.setColor(this._color.x, this._color.y, this._color.z, a);\r\n    }\r\n\r\n    /**\r\n     * Gets the opacity of the geo object.\r\n     * @returns {number}\r\n     */\r\n    public getOpacity(): number {\r\n        return this._color.w;\r\n    }\r\n\r\n    /**\r\n     * Sets the color of the geo object.\r\n     * @param {number} r - Red component.\r\n     * @param {number} g - Green component.\r\n     * @param {number} b - Blue component.\r\n     * @param {number} [a] - Alpha component.\r\n     */\r\n    public setColor(r: number, g: number, b: number, a?: number) {\r\n        this._color.x = r;\r\n        this._color.y = g;\r\n        this._color.z = b;\r\n        a != undefined && (this._color.w = a);\r\n        this._handler && this._handler.setRgbaArr(this._tagData!, this._tagDataIndex, this._color);\r\n    }\r\n\r\n    /**\r\n     * Sets color.\r\n     * @public\r\n     * @param {Vec3 | Vec4} color - RGBA vector.\r\n     */\r\n    public setColor4v(color: Vec3 | Vec4) {\r\n        this._color.x = color.x;\r\n        this._color.y = color.y;\r\n        this._color.z = color.z;\r\n        (color as Vec4).w != undefined && (this._color.w = (color as Vec4).w);\r\n        this._handler && this._handler.setRgbaArr(this._tagData!, this._tagDataIndex, this._color);\r\n    }\r\n\r\n    /**\r\n     * Sets geo object visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Visibility flag.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this._visibility = visibility;\r\n        this._handler && this._handler.setVisibility(this._tagData!, this._tagDataIndex, visibility);\r\n    }\r\n\r\n    /**\r\n     * Returns geo object visibility.\r\n     * @public\r\n     * @returns {boolean}\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    /**\r\n     * Sets geo object position.\r\n     * @public\r\n     * @param {number} x - X coordinate.\r\n     * @param {number} y - Y coordinate.\r\n     * @param {number} z - Z coordinate.\r\n     */\r\n    public setPosition(x: number, y: number, z: number) {\r\n        this._position.x = x;\r\n        this._position.y = y;\r\n        this._position.z = z;\r\n        this.updateRTCPosition();\r\n        this.updateRotation();\r\n    }\r\n\r\n    public updateRTCPosition() {\r\n        //Vec3.doubleToTwoFloats(this._position, this._rtcPositionHigh, this._rtcPositionLow);\r\n        if (this._handler) {\r\n            this._handler.getRTCPosition(this._position, this._rtcPositionHigh, this._rtcPositionLow);\r\n            this._handler.setRTCPositionArr(this._tagData!, this._tagDataIndex, this._rtcPositionHigh, this._rtcPositionLow);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets geo object position.\r\n     * @public\r\n     * @param {Vec3} position - Cartesian coordinates.\r\n     */\r\n    public setPosition3v(position: Vec3) {\r\n        this.setPosition(position.x, position.y, position.z);\r\n    }\r\n\r\n    /**\r\n     * Sets Object3d for the object\r\n     * @param {Object3d} object\r\n     */\r\n    public setObject(object: Object3d) {\r\n        this._object3d = object;\r\n    }\r\n\r\n    /**\r\n     * Sets the object url source.\r\n     * @param {string} src\r\n     */\r\n    public setObjectSrc(src: string) {\r\n        this._objectSrc = src;\r\n        this._handler && this._handler.setObjectSrc(src, this.tag);\r\n    }\r\n\r\n    /**\r\n     * Sets object HTML color.\r\n     * @param {string} color\r\n     */\r\n    public setColorHTML(color: string) {\r\n        this.setColor4v(utils.htmlColorToRgba(color));\r\n    }\r\n\r\n    /**\r\n     * Sets scales.\r\n     * @public\r\n     * @param {number} scale\r\n     */\r\n    public setScale(scale: number) {\r\n        this._scale.x = this._scale.y = this._scale.z = scale;\r\n        this._handler && this._handler.setScaleArr(this._tagData!, this._tagDataIndex, this._scale);\r\n    }\r\n\r\n    /**\r\n     * Sets X, Y, Z axis scales\r\n     * @public\r\n     * @param {Vec3} scale\r\n     */\r\n    public setScale3v(scale: Vec3) {\r\n        this._scale.copy(scale);\r\n        this._handler && this._handler.setScaleArr(this._tagData!, this._tagDataIndex, scale);\r\n    }\r\n\r\n    /**\r\n     * Gets scale.\r\n     * @publci\r\n     * @returns {Vec3}\r\n     */\r\n    public getScale(): Vec3 {\r\n        return this._scale;\r\n    }\r\n\r\n    public setTranslate3v(translate: Vec3) {\r\n        this._translate.copy(translate);\r\n        this._handler && this._handler.setTranslateArr(this._tagData!, this._tagDataIndex, translate);\r\n    }\r\n\r\n    public getTranslate(): Vec3 {\r\n        return this._translate.clone();\r\n    }\r\n\r\n    /**\r\n     * Sets local offset position.\r\n     * @param {Vec3} localPosition\r\n     */\r\n    public setLocalPosition3v(localPosition: Vec3) {\r\n        this._localPosition.copy(localPosition);\r\n        this._handler && this._handler.setLocalPositionArr(this._tagData!, this._tagDataIndex, localPosition);\r\n    }\r\n\r\n    /**\r\n     * Gets local offset position.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getLocalPosition(): Vec3 {\r\n        return this._localPosition.clone();\r\n    }\r\n\r\n    /**\r\n     * Removes the geo object from the handler.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._entity = null;\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    /**\r\n     * Sets billboard picking color.\r\n     * @public\r\n     * @param {Vec3} color - Picking color.\r\n     */\r\n    public setPickingColor3v(color: Vec3) {\r\n        this._handler && this._handler.setPickingColorArr(this._tagData!, this._tagDataIndex, color);\r\n    }\r\n\r\n    /**\r\n     * Sets the rotation quaternion.\r\n     * @public\r\n     * @param {Quat} qRot - Rotation quaternion.\r\n     */\r\n    public setRotation(qRot: Quat) {\r\n        this._qRot.copy(qRot);\r\n        this._qRot.mulVec3Res(LOCAL_FORWARD, this._direction).normalize();\r\n        this.updateRotation();\r\n    }\r\n\r\n    /**\r\n     * Returns orientation quaternion.\r\n     * @public\r\n     * @returns {Quat}\r\n     */\r\n    public getRotation(): Quat {\r\n        return this._qRot;\r\n    }\r\n\r\n    /**\r\n     * Update object rotation\r\n     */\r\n    public updateRotation() {\r\n        this._handler && this._handler.setQRotArr(this._tagData!, this._tagDataIndex, this._qRot);\r\n    }\r\n\r\n    /**\r\n     * Returns object direction\r\n     * @publcu\r\n     * @returns {Vec3}\r\n     */\r\n    public getDirection(): Vec3 {\r\n        return this._direction.clone();\r\n    }\r\n}\r\n\r\nexport {GeoObject};\r\n","import * as utils from \"../utils/shared\";\r\nimport {BaseBillboard} from \"./BaseBillboard\";\r\nimport type {IBaseBillboardParams} from \"./BaseBillboard\";\r\nimport {LOCK_FREE, LOCK_UPDATE} from \"./LabelWorker\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {FontAtlas} from \"../utils/FontAtlas\";\r\nimport {LabelHandler} from \"./LabelHandler\";\r\n\r\nexport interface ILabelParams extends IBaseBillboardParams {\r\n    text?: string;\r\n    face?: string;\r\n    size?: number;\r\n    opacity?: number;\r\n    outline?: number;\r\n    outlineColor?: string | NumberArray4 | Vec4;\r\n    align?: string;\r\n    isRTL?: boolean;\r\n    letterSpacing?: number;\r\n}\r\n\r\nconst ALIGN: Record<string, number> = {\r\n    RIGHT: 0,\r\n    LEFT: 1,\r\n    CENTER: 2\r\n};\r\n\r\n/**\r\n * Text align options.\r\n * @readonly\r\n * @enum {number}\r\n */\r\nconst STR2ALIGN: Record<string, number> = {\r\n    left: ALIGN.LEFT,\r\n    right: ALIGN.RIGHT,\r\n    center: ALIGN.CENTER\r\n};\r\n\r\n/**\r\n * Billboard text label.\r\n * @class\r\n * @extends {BaseBillboard}\r\n * @param {Object} [options] - Label options:\r\n * @param {Vec3|Array.<number>} [options.position] - Billboard spatial position.\r\n * @param {number} [options.rotation] - Screen angle rotation.\r\n * @param {Vec4|string|Array.<number>} [options.color] - Billboard color.\r\n * @param {Vec3|Array.<number>} [options.alignedAxis] - Billboard aligned vector.\r\n * @param {Vec3|Array.<number>} [options.offset] - Billboard center screen offset.\r\n * @param {boolean} [options.visibility] - Visibility.\r\n * @param {string} [options.text] - Text string.\r\n * @param {string} [options.face] - HTML5 font face.\r\n * @param {number} [options.size] - Font size in pixels.\r\n * @param {string} [options.style] - HTML5 font style. Example 'normal', 'italic'.\r\n * @param {string} [options.weight] - HTML5 font weight. Example 'normal', 'bold'.\r\n * @param {number} [options.outline] - Text outline size. 0 - no outline, 1 - maximum outline. Default 0.58.\r\n * @param {Vec4|string|Array.<number>} [options.outlineColor] - Outline color.\r\n * @param {string} [options.align] - Text horizontal align: \"left\", \"right\" and \"center\".\r\n */\r\nclass Label extends BaseBillboard {\r\n\r\n    public override _handler: LabelHandler | null;\r\n\r\n    /**\r\n     * Label text string.\r\n     * @protected\r\n     * @type {string}\r\n     */\r\n    protected _text: string;\r\n\r\n    /**\r\n     * HTML5 font face.\r\n     * @private\r\n     * @type {string}\r\n     */\r\n    protected _face: string;\r\n\r\n    /**\r\n     * Font size in pixels.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _size: number;\r\n\r\n    /**\r\n     * Label outline.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _outline: number;\r\n\r\n    /**\r\n     * Label outline color.\r\n     * @protected\r\n     * @type {Vec4}\r\n     */\r\n    protected _outlineColor: Vec4;\r\n\r\n    /**\r\n     * Text horizontal align: \"left\", \"right\" and \"center\".\r\n     * @private\r\n     * @type {Label.ALIGN}\r\n     */\r\n    protected _align: number;\r\n\r\n    /**\r\n     * Label font atlas index.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _fontIndex: number;\r\n\r\n    /**\r\n     * Font atlas pointer.\r\n     * @private\r\n     * @type {FontAtlas}\r\n     */\r\n    protected _fontAtlas: FontAtlas | null;\r\n\r\n    protected _isRTL: boolean;\r\n\r\n    protected _letterSpacing: number;\r\n\r\n    constructor(options: ILabelParams = {}) {\r\n        super(options);\r\n\r\n        this._handler = null;\r\n\r\n        this._text = options.text || \"\";\r\n\r\n        this._face = utils.defaultString(options.face, \"arial\");\r\n\r\n        this._size = options.size || 24;\r\n\r\n        this._outline = options.outline != undefined ? options.outline : 0.0;\r\n\r\n        this._outlineColor = utils.createColorRGBA(\r\n            options.outlineColor,\r\n            new Vec4(0.0, 0.0, 0.0, 1.0)\r\n        );\r\n\r\n        this._align = options.align ? STR2ALIGN[options.align.trim().toLowerCase()] as number || ALIGN.RIGHT : ALIGN.RIGHT;\r\n\r\n        this._fontIndex = 0;\r\n\r\n        this._fontAtlas = null;\r\n\r\n        this._isRTL = options.isRTL || false;\r\n\r\n        this._letterSpacing = options.letterSpacing || 0;\r\n    }\r\n\r\n    /**\r\n     * Set label text.\r\n     * @public\r\n     * @param {string} text - Text string.\r\n     * It can't be bigger than maximum labelHandler _maxLetters value.\r\n     */\r\n    public setText(text: string) {\r\n        this._text = text.toString();\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setText(this._handlerIndex, text, this._fontIndex, this._align, this._letterSpacing, this._isRTL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set text letter spacing.\r\n     * @public\r\n     * @param {number} spacing - Letter spacing.\r\n     */\r\n    public setLetterSpacing(letterSpacing: number) {\r\n        this._letterSpacing = letterSpacing;\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setText(this._handlerIndex, this._text, this._fontIndex, this._align, letterSpacing, this._isRTL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns label text letter spacing.\r\n     * @public\r\n     * @param {number} spacing - Letter spacing.\r\n     */\r\n    public getLetterSpacing(): number {\r\n        return this._letterSpacing;\r\n    }\r\n\r\n    /**\r\n     * Change text direction.\r\n     * @public\r\n     * @param {boolean} isRTL - Text string.\r\n     */\r\n    public setRtl(isRTL: boolean) {\r\n        this._isRTL = isRTL;\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setText(this._handlerIndex, this._text, this._fontIndex, this._align, this._letterSpacing, this._isRTL);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets current text string.\r\n     * @public\r\n     * @returns {string}\r\n     */\r\n    public getText(): string {\r\n        return this._text;\r\n    }\r\n\r\n    /**\r\n     * Sets label text align. Could be center, left or right. Left is default.\r\n     * @public\r\n     * @param {string} align - Text align.\r\n     */\r\n    public setAlign(align: string) {\r\n        this._align = STR2ALIGN[align.trim().toLowerCase()] as number;\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setText(this._handlerIndex, this._text, this._fontIndex, this._align, this._letterSpacing, this._isRTL);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets label text current alignment.\r\n     * @public\r\n     * @returns {string}\r\n     */\r\n    public getAlign(): number {\r\n        return this._align;\r\n    }\r\n\r\n    /**\r\n     * Sets font face family.\r\n     * @public\r\n     * @param {string} face - Font face family.\r\n     */\r\n    public setFace(face: string) {\r\n        this._face = face.trim();\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * Gets current font face.\r\n     * @public\r\n     * @returns {string}\r\n     */\r\n    public getFace(): string {\r\n        return this._face;\r\n    }\r\n\r\n    /**\r\n     * Sets label font size in pixels.\r\n     * @public\r\n     * @param {number} size - Label size in pixels.\r\n     */\r\n    public setSize(size: number) {\r\n        if (size !== this._size) {\r\n            this._size = size;\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setSizeArr(this._handlerIndex, size);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets label size in pixels.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getSize(): number {\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * Sets text outline border size. Where 0 - is no outline, and 1 - is the maximum outline size.\r\n     * @public\r\n     * @param {number} outline - Text outline size.\r\n     */\r\n    public setOutline(outline: number) {\r\n        this._outline = outline;\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setOutlineArr(this._handlerIndex, outline);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets text current outline size.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getOutline(): number {\r\n        return this._outline;\r\n    }\r\n\r\n    /**\r\n     * Sets label opacity.\r\n     * @public\r\n     * @param {number} a - Label opacity.\r\n     */\r\n    public override setOpacity(a: number) {\r\n        super.setOpacity(a);\r\n        this.setOutlineOpacity(a);\r\n    }\r\n\r\n    /**\r\n     * Sets text outline color.\r\n     * @public\r\n     * @param {number} r - Red.\r\n     * @param {number} g - Green.\r\n     * @param {number} b - Blue.\r\n     * @param {number} a - Alpha.\r\n     */\r\n    public setOutlineColor(r: number, g: number, b: number, a: number) {\r\n        if (a !== this._outlineColor.w || r !== this._outlineColor.x || g !== this._outlineColor.y || b !== this._outlineColor.z) {\r\n            this._outlineColor.x = r;\r\n            this._outlineColor.y = g;\r\n            this._outlineColor.z = b;\r\n            this._outlineColor.w = a;\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setOutlineColorArr(this._handlerIndex, this._outlineColor);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets text outline color.\r\n     * @public\r\n     * @param {Vec4} rgba - Color vector.\r\n     */\r\n    public setOutlineColor4v(rgba: Vec4) {\r\n        this.setOutlineColor(rgba.x, rgba.y, rgba.z, rgba.w);\r\n    }\r\n\r\n    /**\r\n     * Sets text outline color HTML string.\r\n     * @public\r\n     * @param {string} color - HTML string color.\r\n     */\r\n    public setOutlineColorHTML(color: string) {\r\n        this.setOutlineColor4v(utils.htmlColorToRgba(color));\r\n    }\r\n\r\n    /**\r\n     * Gets outline color vector.\r\n     * @public\r\n     * @returns {Vec4}\r\n     */\r\n    public getOutlineColor(): Vec4 {\r\n        return this._outlineColor;\r\n    }\r\n\r\n    /**\r\n     * Sets outline opacity. Actually outline color alpha value.\r\n     * @public\r\n     * @param {number} opacity - Outline opacity.\r\n     */\r\n    public setOutlineOpacity(opacity: number) {\r\n        if (opacity !== this._outlineColor.w) {\r\n            this._outlineColor.w = opacity;\r\n            if (this._isReady && this._handler) {\r\n                this._handler.setOutlineColorArr(this._handlerIndex, this._outlineColor);\r\n            } else if (this._lockId !== LOCK_FREE) {\r\n                this._lockId = LOCK_UPDATE;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets outline opacity value.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getOutlineOpacity(): number {\r\n        return this._outlineColor.w;\r\n    }\r\n\r\n    /**\r\n     * Updates label parameters.\r\n     * @public\r\n     */\r\n    public async update() {\r\n        if (this._fontAtlas) {\r\n            const fontIndex = await this._fontAtlas.getFontIndex(this._face);\r\n            this._applyFontIndex(fontIndex);\r\n        }\r\n    }\r\n\r\n    protected _applyFontIndex(fontIndex: number) {\r\n        this._fontIndex = fontIndex;\r\n        if (this._isReady && this._handler) {\r\n            this._handler.setFontIndexArr(this._handlerIndex, this._fontIndex);\r\n            this._handler.setText(this._handlerIndex, this._text, this._fontIndex, this._align, this._letterSpacing, this._isRTL);\r\n        } else if (this._lockId !== LOCK_FREE) {\r\n            this._lockId = LOCK_UPDATE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Assigns font atlas and update.\r\n     * @public\r\n     * @param {FontAtlas} fontAtlas - Font atlas.\r\n     */\r\n    public assignFontAtlas(fontAtlas: FontAtlas) {\r\n        if (!this._fontAtlas) {\r\n            this._fontAtlas = fontAtlas;\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    public override serializeWorkerData(workerId: number): Float32Array | null {\r\n        if (this._handler) {\r\n            return new Float32Array([\r\n                /*0*/workerId,\r\n                /*1*/this._handler!._maxLetters,\r\n                /*2*/this.getVisibility() ? 1 : 0,\r\n                /*3, 4, 5*/this._positionHigh.x, this._positionHigh.y, this._positionHigh.z,\r\n                /*6, 7, 8*/this._positionLow.x, this._positionLow.y, this._positionLow.z,\r\n                /*9*/this._size,\r\n                /*10, 11, 12*/this._offset.x, this._offset.y, this._offset.z,\r\n                /*13, 14, 15, 16*/this._color.x, this._color.y, this._color.z, this._color.w,\r\n                /*17*/this._rotation,\r\n                /*18, 19, 20*/this._alignedAxis.x, this._alignedAxis.y, this._alignedAxis.z,\r\n                /*21*/this._fontIndex,\r\n                /*22*/this._outline,\r\n                /*23, 24, 25, 26*/this._outlineColor.x, this._outlineColor.y, this._outlineColor.z, this._outlineColor.w,\r\n                /*27, 28, 29*/this._entity!._pickingColor.x, this._entity!._pickingColor.y, this._entity!._pickingColor.z\r\n            ]);\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n\r\nexport {Label, ALIGN};\r\n","import {Entity} from \"./Entity\";\r\nimport {PointCloudHandler} from \"./PointCloudHandler\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\n\r\nexport interface IPointCloudParams {\r\n    visibility?: boolean;\r\n    pointSize?: number;\r\n    pickingScale?: number;\r\n    points?: Poi[];\r\n}\r\n\r\ntype Poi = [number, number, number, number, number, number, number, any | undefined];\r\n\r\ninterface IPoint {\r\n    _entity: Entity | null;\r\n    _pickingColor: Vec3;\r\n    _entityCollection: EntityCollection | null;\r\n    index: number;\r\n    position: Vec3;\r\n    color: Vec4;\r\n    pointCloud: PointCloud;\r\n    properties: any\r\n}\r\n\r\nconst COORDINATES_BUFFER = 0;\r\nconst COLOR_BUFFER = 1;\r\nconst PICKING_COLOR_BUFFER = 2;\r\n\r\n/**\r\n * PointCloud object.\r\n * @class\r\n * @param {*} [options] - Point cloud options:\r\n * @param {Array.<Array.<number>>} [options.points] - Points cartesian coordinates array,\r\n * where first three is cartesian coordinates, next fourth is an RGBA color, and last is a point properties.\r\n * @param {number} [options.pointSize] - Point screen size in pixels.\r\n * @param {number} [options.pickingScale] - Point border picking size in screen pixels.\r\n * @param {boolean} [options.visibility] - Point cloud visibility.\r\n * @example <caption>Creates point cloud with two ten pixel size points</caption>\r\n * new og.Entity({\r\n *     pointCloud: {\r\n *         pointSize: 10,\r\n *         points: [\r\n *             [0, 0, 0, 255, 255, 255, 255, { 'name': 'White point' }],\r\n *             [100, 100, 0, 255, 0, 0, 255, { 'name': 'Red point' }]\r\n *         ]\r\n *     }\r\n * });\r\n */\r\nclass PointCloud {\r\n    static __counter__: number = 0;\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Cloud visibility.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public visibility: boolean;\r\n\r\n    /**\r\n     * Point screen size in pixels.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public pointSize: number;\r\n\r\n    /**\r\n     * Point picking border size in pixels.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public pickingScale: number;\r\n\r\n    /**\r\n     * Parent collection render node.\r\n     * @protected\r\n     * @type {RenderNode | null}\r\n     */\r\n    protected _renderNode: RenderNode | null;\r\n\r\n    /**\r\n     * Entity instance that holds this point cloud.\r\n     * @public\r\n     * @type {Entity | null}\r\n     */\r\n    public _entity: Entity | null;\r\n\r\n    /**\r\n     * Points properties.\r\n     * @protected\r\n     * @type {IPoint[]}\r\n     */\r\n    protected _points: IPoint[];\r\n\r\n    /**\r\n     * Coordinates array.\r\n     * @protected\r\n     * @type {number[]}\r\n     */\r\n    protected _coordinatesData: number[];\r\n\r\n    /**\r\n     * Color array.\r\n     * @protected\r\n     * @type {number[]}\r\n     */\r\n    protected _colorData: number[];\r\n\r\n    /**\r\n     * Picking color array.\r\n     * @protected\r\n     * @type {number[]}\r\n     */\r\n    protected _pickingColorData: number[];\r\n\r\n    protected _coordinatesBuffer: WebGLBufferExt | null;\r\n    protected _colorBuffer: WebGLBufferExt | null;\r\n    protected _pickingColorBuffer: WebGLBufferExt | null;\r\n\r\n    /**\r\n     * Handler that stores and renders this object.\r\n     * @public\r\n     * @type {PointCloudHandler}\r\n     */\r\n    public _handler: PointCloudHandler | null;\r\n    public _handlerIndex: number;\r\n\r\n    protected _buffersUpdateCallbacks: Function[];\r\n    protected _changedBuffers: boolean[];\r\n\r\n    constructor(options: IPointCloudParams = {}) {\r\n\r\n        this.__id = PointCloud.__counter__++;\r\n\r\n        /**\r\n         * Cloud visibility.\r\n         * @public\r\n         * @type {boolean}\r\n         */\r\n        this.visibility = options.visibility != undefined ? options.visibility : true;\r\n\r\n        /**\r\n         * Point screen size in pixels.\r\n         * @public\r\n         * @type {number}\r\n         */\r\n        this.pointSize = options.pointSize || 3;\r\n\r\n        /**\r\n         * Point picking border size in pixels.\r\n         * @public\r\n         * @type {number}\r\n         */\r\n        this.pickingScale = options.pickingScale || 0;\r\n\r\n        /**\r\n         * Parent collection render node.\r\n         * @private\r\n         * @type {RenderNode}\r\n         */\r\n        this._renderNode = null;\r\n\r\n        /**\r\n         * Entity instance that holds this point cloud.\r\n         * @private\r\n         * @type {Entity}\r\n         */\r\n        this._entity = null;\r\n\r\n        /**\r\n         * Points properties.\r\n         * @private\r\n         * @type {IPoint[]}\r\n         */\r\n        this._points = [];\r\n\r\n        /**\r\n         * Coordinates array.\r\n         * @private\r\n         * @type {Array.<number>}\r\n         */\r\n        this._coordinatesData = [];\r\n\r\n        /**\r\n         * Color array.\r\n         * @private\r\n         * @type {Array.<number>}\r\n         */\r\n        this._colorData = [];\r\n\r\n        /**\r\n         * Picking color array.\r\n         * @private\r\n         * @type {Array.<number>}\r\n         */\r\n        this._pickingColorData = [];\r\n\r\n        this._coordinatesBuffer = null;\r\n        this._colorBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n\r\n        /**\r\n         * Handler that stores and renders this object.\r\n         * @private\r\n         * @type {PointCloudHandler}\r\n         */\r\n        this._handler = null;\r\n        this._handlerIndex = -1;\r\n\r\n        this._buffersUpdateCallbacks = [];\r\n        this._buffersUpdateCallbacks[COORDINATES_BUFFER] = this._createCoordinatesBuffer;\r\n        this._buffersUpdateCallbacks[COLOR_BUFFER] = this._createColorBuffer;\r\n        this._buffersUpdateCallbacks[PICKING_COLOR_BUFFER] = this._createPickingColorBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n\r\n        if (options.points) {\r\n            this.setPoints(options.points);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clears point cloud data\r\n     * @public\r\n     */\r\n    public clear() {\r\n        this._points.length = 0;\r\n        this._points = [];\r\n\r\n        this._coordinatesData.length = 0;\r\n        this._coordinatesData = [];\r\n\r\n        this._colorData.length = 0;\r\n        this._colorData = [];\r\n\r\n        this._pickingColorData.length = 0;\r\n        this._pickingColorData = [];\r\n\r\n        this._deleteBuffers();\r\n    }\r\n\r\n    /**\r\n     * Sets cloud visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Visibility flag.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this.visibility = visibility;\r\n    }\r\n\r\n    /**\r\n     * @return {boolean} Point cloud visibility.\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this.visibility;\r\n    }\r\n\r\n    /**\r\n     * Assign rendering scene node.\r\n     * @public\r\n     * @param {RenderNode}  renderNode - Assigned render node.\r\n     */\r\n    public setRenderNode(renderNode: RenderNode) {\r\n        this._renderNode = renderNode;\r\n        this._setPickingColors();\r\n    }\r\n\r\n    /**\r\n     * Removes from entity.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._entity = null;\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    /**\r\n     * Adds points to render.\r\n     * @public\r\n     * @param { Poi[]} points - Point cloud array.\r\n     * @example\r\n     * var points = [[0, 0, 0, 255, 255, 255, 255, { 'name': 'White point' }], [100, 100, 0, 255, 0, 0, 255, { 'name': 'Red point' }]];\r\n     */\r\n    public setPoints(points: Poi[]) {\r\n        this.clear();\r\n        for (let i = 0; i < points.length; i++) {\r\n            let pi = points[i];\r\n\r\n            let pos = new Vec3(pi[0], pi[1], pi[2]),\r\n                col = new Vec4(pi[3], pi[4], pi[5], pi[6] == undefined ? 255.0 : pi[6]);\r\n\r\n            this._coordinatesData.push(pos.x, pos.y, pos.z);\r\n\r\n            this._colorData.push(col.x / 255.0, col.y / 255.0, col.z / 255.0, col.w / 255.0);\r\n\r\n            let p = {\r\n                _entity: this._entity,\r\n                _pickingColor: new Vec3(),\r\n                _entityCollection: this._entity ? this._entity._entityCollection : null,\r\n                index: i,\r\n                position: pos,\r\n                color: col,\r\n                pointCloud: this,\r\n                properties: pi[7] || {}\r\n            };\r\n\r\n            this._points.push(p);\r\n\r\n            if (this._renderNode && this._renderNode.renderer) {\r\n                this._renderNode.renderer.assignPickingColor<IPoint>(p);\r\n                this._pickingColorData.push(\r\n                    p._pickingColor.x / 255.0,\r\n                    p._pickingColor.y / 255.0,\r\n                    p._pickingColor.z / 255.0,\r\n                    1.0\r\n                );\r\n            }\r\n        }\r\n\r\n        this._changedBuffers[COORDINATES_BUFFER] = true;\r\n        this._changedBuffers[COLOR_BUFFER] = true;\r\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\r\n    }\r\n\r\n    public setPointPosition(index: number, x: number, y: number, z: number) {\r\n        // TODO: ...\r\n        this._changedBuffers[COORDINATES_BUFFER] = true;\r\n    }\r\n\r\n    public setPointColor(index: number, r: number, g: number, b: number, a: number) {\r\n        // TODO: ...\r\n        this._changedBuffers[COLOR_BUFFER] = true;\r\n    }\r\n\r\n    public addPoints(points: Poi[]) {\r\n        // TODO: ...\r\n        this._changedBuffers[COORDINATES_BUFFER] = true;\r\n        this._changedBuffers[COLOR_BUFFER] = true;\r\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\r\n    }\r\n\r\n    public addPoint(index: number, point: Poi) {\r\n        // TODO: ...\r\n        this._changedBuffers[COORDINATES_BUFFER] = true;\r\n        this._changedBuffers[COLOR_BUFFER] = true;\r\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\r\n    }\r\n\r\n    /**\r\n     * Returns specific point by index.\r\n     * @public\r\n     * @param {number} index - Point index.\r\n     * @return {Poi} Specific point\r\n     */\r\n    public getPoint(index: number): IPoint {\r\n        return this._points[index];\r\n    }\r\n\r\n    public removePoint(index: number) {\r\n        // TODO: ...\r\n        this._changedBuffers[COORDINATES_BUFFER] = true;\r\n        this._changedBuffers[COLOR_BUFFER] = true;\r\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\r\n    }\r\n\r\n    public insertPoint(index: number, point: Poi) {\r\n        // TODO: ...\r\n        this._changedBuffers[COORDINATES_BUFFER] = true;\r\n        this._changedBuffers[COLOR_BUFFER] = true;\r\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\r\n    }\r\n\r\n    public draw() {\r\n        if (this.visibility && this._coordinatesData.length) {\r\n            this._update();\r\n\r\n            let rn = this._renderNode!;\r\n            let r = rn.renderer!;\r\n            let sh = r.handler.programs.pointCloud;\r\n            let p = sh._program;\r\n            let gl = r.handler.gl!,\r\n                sha = p.attributes,\r\n                shu = p.uniforms;\r\n\r\n            // gl.polygonOffset(\r\n            //     this._handler._entityCollection.polygonOffsetFactor,\r\n            //     this._handler._entityCollection.polygonOffsetUnits\r\n            // );\r\n\r\n            sh.activate();\r\n\r\n            gl.uniformMatrix4fv(shu.projectionViewMatrix, false, r.activeCamera!.getProjectionViewMatrix());\r\n\r\n            gl.uniform1f(shu.opacity, this._handler!._entityCollection._fadingOpacity);\r\n            gl.uniform1f(shu.pointSize, this.pointSize);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._coordinatesBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.coordinates, this._coordinatesBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._colorBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.colors, this._colorBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.drawArrays(gl.POINTS, 0, this._coordinatesBuffer!.numItems);\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this.visibility && this._coordinatesData.length) {\r\n            let rn = this._renderNode!;\r\n            let r = rn.renderer!;\r\n            let sh = r.handler.programs.pointCloud;\r\n            let p = sh._program;\r\n            let gl = r.handler.gl!,\r\n                sha = p.attributes,\r\n                shu = p.uniforms;\r\n\r\n            sh.activate();\r\n\r\n            // gl.polygonOffset(\r\n            //     this._handler._entityCollection.polygonOffsetFactor,\r\n            //     this._handler._entityCollection.polygonOffsetUnits\r\n            // );\r\n\r\n            gl.uniformMatrix4fv(shu.projectionViewMatrix, false, r.activeCamera!.getProjectionViewMatrix());\r\n\r\n            gl.uniform1f(shu.opacity, this._handler!._entityCollection._fadingOpacity);\r\n            gl.uniform1f(shu.pointSize, this.pointSize + this.pickingScale);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._coordinatesBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.coordinates, this._coordinatesBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._pickingColorBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.colors, this._pickingColorBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.drawArrays(gl.POINTS, 0, this._coordinatesBuffer!.numItems);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update gl buffers.\r\n     * @protected\r\n     */\r\n    protected _update() {\r\n        if (this._renderNode) {\r\n            let i = this._changedBuffers.length;\r\n            while (i--) {\r\n                if (this._changedBuffers[i]) {\r\n                    this._buffersUpdateCallbacks[i].call(this);\r\n                    this._changedBuffers[i] = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete buffers\r\n     * @public\r\n     */\r\n    public _deleteBuffers() {\r\n        if (this._renderNode) {\r\n            let r = this._renderNode.renderer!,\r\n                gl = r.handler.gl!;\r\n\r\n            gl.deleteBuffer(this._coordinatesBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._colorBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._pickingColorBuffer as WebGLBuffer);\r\n        }\r\n\r\n        this._coordinatesBuffer = null;\r\n        this._colorBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n    }\r\n\r\n    protected _createCoordinatesBuffer() {\r\n        let h = this._renderNode!.renderer!.handler;\r\n        h.gl!.deleteBuffer(this._coordinatesBuffer as WebGLBuffer);\r\n        this._coordinatesBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._coordinatesData),\r\n            3,\r\n            this._coordinatesData.length / 3\r\n        );\r\n    }\r\n\r\n    protected _createColorBuffer() {\r\n        let h = this._renderNode!.renderer!.handler;\r\n        h.gl!.deleteBuffer(this._colorBuffer as WebGLBuffer);\r\n        this._colorBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._colorData),\r\n            4,\r\n            this._colorData.length / 4\r\n        );\r\n    }\r\n\r\n    protected _createPickingColorBuffer() {\r\n        let h = this._renderNode!.renderer!.handler;\r\n        h.gl!.deleteBuffer(this._pickingColorBuffer as WebGLBuffer);\r\n        this._pickingColorBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._pickingColorData),\r\n            4,\r\n            this._pickingColorData.length / 4\r\n        );\r\n    }\r\n\r\n    protected _setPickingColors() {\r\n        if (this._renderNode && this._renderNode.renderer) {\r\n            for (let i = 0; i < this._points.length; i++) {\r\n                let p = this._points[i];\r\n                p._entity = this._entity;\r\n                p._entityCollection = this._entity!._entityCollection;\r\n                this._renderNode.renderer.assignPickingColor<IPoint>(p);\r\n                this._pickingColorData.push(\r\n                    p._pickingColor.x / 255.0,\r\n                    p._pickingColor.y / 255.0,\r\n                    p._pickingColor.z / 255.0,\r\n                    1.0\r\n                );\r\n            }\r\n            this._changedBuffers[PICKING_COLOR_BUFFER] = true;\r\n        }\r\n    }\r\n}\r\n\r\nexport {PointCloud};\r\n","import {Entity} from \"./Entity\";\r\nimport {Extent} from \"../Extent\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {PolylineHandler} from \"./PolylineHandler\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\nimport {\r\n    cloneArray,\r\n    createVector3,\r\n    htmlColorToFloat32Array,\r\n    htmlColorToRgba,\r\n    makeArray,\r\n    makeArrayTyped\r\n} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {Ellipsoid} from \"../ellipsoid/Ellipsoid\";\r\n\r\nconst VERTICES_BUFFER = 0;\r\nconst INDEX_BUFFER = 1;\r\nconst COLORS_BUFFER = 2;\r\n\r\nconst DEFAULT_COLOR = \"#0000FF\";\r\n\r\nconst R = 0;\r\nconst G = 1;\r\nconst B = 2;\r\nconst A = 3;\r\n\r\nexport type Geodetic = LonLat | NumberArray2 | NumberArray3\r\nexport type Cartesian = Vec3 | NumberArray3;\r\n\r\nexport type SegmentPath3vExt = Cartesian[];\r\nexport type SegmentPathLonLatExt = Geodetic[];\r\n\r\nexport type SegmentPathColor = NumberArray4[];\r\n\r\nexport type SegmentPath3v = Vec3[];\r\nexport type SegmentPathLonLat = LonLat[];\r\n\r\n\r\nexport interface IPolylineParams {\r\n    altitude?: number;\r\n    thickness?: number;\r\n    opacity?: number;\r\n    color?: string;\r\n    visibility?: boolean;\r\n    isClosed?: boolean;\r\n    pathColors?: SegmentPathColor[];\r\n    path3v?: SegmentPath3vExt[];\r\n    pathLonLat?: SegmentPathLonLatExt[];\r\n    visibleSpherePosition?: Cartesian,\r\n    visibleSphereRadius?: number\r\n}\r\n\r\n/**\r\n * Polyline object.\r\n * @class\r\n * @param {Object} [options] - Polyline options:\r\n * @param {number} [options.thickness] - Thickness in screen pixels 1.5 is default.\r\n * @param {Number} [options.altitude] - Relative to ground layers altitude value.\r\n * @param {Vec4} [options.color] - RGBA color.\r\n * @param {Boolean} [options.opacity] - Line opacity.\r\n * @param {Boolean} [options.visibility] - Polyline visibility. True default.\r\n * @param {Boolean} [options.isClosed] - Closed geometry type identification.\r\n * @param {SegmentPathLonLatExt[]} [options.pathLonLat] - Polyline geodetic coordinates array. [[[0,0,0], [1,1,1],...]]\r\n * @param {SegmentPath3vExt[]} [options.path3v] - LinesString cartesian coordinates array. [[[0,0,0], [1,1,1],...]]\r\n * @param {SegmentPathColor[]} [options.pathColors] - Coordinates color. [[[1,0,0,1], [0,1,0,1],...]] for right and green colors.\r\n */\r\nclass Polyline {\r\n    static __counter__: number = 0;\r\n\r\n    /**\r\n     * Object uniq identifier.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected __id: number;\r\n\r\n    public altitude: number;\r\n\r\n    /**\r\n     * Polyline thickness in screen pixels.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public thickness: number;\r\n\r\n    protected _opacity: number;\r\n\r\n    /**\r\n     * Polyline RGBA color.\r\n     * @protected\r\n     * @type {Float32Array}\r\n     */\r\n    protected _defaultColor: Float32Array | NumberArray4;\r\n\r\n    /**\r\n     * Polyline visibility.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public visibility: boolean;\r\n\r\n    /**\r\n     * Polyline geometry ring type identification.\r\n     * @protected\r\n     * @type {Boolean}\r\n     */\r\n    protected _closedLine: boolean;\r\n\r\n    /**\r\n     * Polyline cartesian coordinates.\r\n     * @public\r\n     * @type {Array.<Vec3>}\r\n     */\r\n    public _path3v: SegmentPath3vExt[];\r\n\r\n    protected _pathLengths: number[];\r\n\r\n    /**\r\n     * Polyline geodetic degrees coordinates.\r\n     * @private\r\n     * @type {Array.<LonLat>}\r\n     */\r\n    protected _pathLonLat: SegmentPathLonLatExt[];\r\n\r\n    /**\r\n     * Polyline geodetic mercator coordinates.\r\n     * @public\r\n     * @type {Array.<LonLat>}\r\n     */\r\n    public _pathLonLatMerc: LonLat[][];\r\n\r\n    protected _pathColors: SegmentPathColor[];\r\n\r\n    /**\r\n     * Polyline geodetic extent.\r\n     * @protected\r\n     * @type {Extent}\r\n     */\r\n    public _extent: Extent;\r\n    protected _verticesHigh: TypedArray | number[];\r\n    protected _verticesLow: TypedArray | number[];\r\n    protected _orders: TypedArray | number[];\r\n    protected _indexes: TypedArray | number[];\r\n    protected _colors: TypedArray | number[];\r\n\r\n    protected _verticesHighBuffer: WebGLBufferExt | null;\r\n    protected _verticesLowBuffer: WebGLBufferExt | null;\r\n    protected _ordersBuffer: WebGLBufferExt | null;\r\n    protected _indexesBuffer: WebGLBufferExt | null;\r\n    protected _colorsBuffer: WebGLBufferExt | null;\r\n\r\n    protected _pickingColor: NumberArray3;\r\n\r\n    protected _renderNode: RenderNode | null;\r\n\r\n    /**\r\n     * Entity instance that holds this Polyline.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public _entity: Entity | null;\r\n\r\n    /**\r\n     * Handler that stores and renders this Polyline object.\r\n     * @public\r\n     * @type {PolylineHandler | null}\r\n     */\r\n    public _handler: PolylineHandler | null;\r\n    public _handlerIndex: number;\r\n    protected _buffersUpdateCallbacks: Function[];\r\n    protected _changedBuffers: boolean[];\r\n\r\n    protected _visibleSphere: Float32Array;\r\n\r\n    public __doubleToTwoFloats: (pos: Vec3, highPos: Vec3, lowPos: Vec3) => void;\r\n\r\n    constructor(options: IPolylineParams = {}) {\r\n\r\n        this.__id = Polyline.__counter__++;\r\n\r\n        this.__doubleToTwoFloats = Vec3.doubleToTwoFloats;\r\n\r\n        this.altitude = options.altitude || 0.0;\r\n\r\n        this.thickness = options.thickness || 1.5;\r\n\r\n        this._opacity = options.opacity != undefined ? options.opacity : 1.0;\r\n\r\n        this._defaultColor = htmlColorToFloat32Array(\r\n            options.color || DEFAULT_COLOR,\r\n            options.opacity\r\n        );\r\n\r\n        this.visibility = options.visibility != undefined ? options.visibility : true;\r\n\r\n        this._closedLine = options.isClosed || false;\r\n\r\n        this._path3v = [];\r\n\r\n        this._pathLengths = [];\r\n\r\n        this._pathLonLat = [];\r\n\r\n        this._pathLonLatMerc = [];\r\n\r\n        this._pathColors = options.pathColors ? cloneArray(options.pathColors) : [];\r\n\r\n        this._extent = new Extent();\r\n\r\n        this._verticesHigh = [];\r\n        this._verticesLow = [];\r\n        this._orders = [];\r\n        this._indexes = [];\r\n        this._colors = [];\r\n\r\n        this._verticesHighBuffer = null;\r\n        this._verticesLowBuffer = null;\r\n        this._ordersBuffer = null;\r\n        this._indexesBuffer = null;\r\n        this._colorsBuffer = null;\r\n\r\n        this._pickingColor = [0, 0, 0];\r\n\r\n        this._renderNode = null;\r\n\r\n        this._entity = null;\r\n\r\n\r\n        this._handler = null;\r\n        this._handlerIndex = -1;\r\n\r\n        this._buffersUpdateCallbacks = [];\r\n        this._buffersUpdateCallbacks[VERTICES_BUFFER] = this._createVerticesBuffer;\r\n        this._buffersUpdateCallbacks[INDEX_BUFFER] = this._createIndexBuffer;\r\n        this._buffersUpdateCallbacks[COLORS_BUFFER] = this._createColorsBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n\r\n        let c = createVector3(options.visibleSpherePosition).toArray();\r\n        let r = options.visibleSphereRadius || 0;\r\n        this._visibleSphere = new Float32Array([...c, r]);\r\n\r\n        // create path\r\n        if (options.pathLonLat) {\r\n            this.setPathLonLat(options.pathLonLat);\r\n        } else if (options.path3v) {\r\n            this.setPath3v(options.path3v);\r\n        }\r\n\r\n        this._refresh();\r\n    }\r\n\r\n    /**\r\n     * Appends to the line array new cartesian coordinates line data.\r\n     */\r\n    protected __appendLineData3v(\r\n        path3v: SegmentPath3vExt[],\r\n        pathColors: SegmentPathColor[],\r\n        defaultColor: NumberArray4,\r\n        isClosed: boolean,\r\n        outVerticesHigh: number[],\r\n        outVerticesLow: number[],\r\n        outOrders: number[],\r\n        outIndexes: number[],\r\n        ellipsoid: Ellipsoid,\r\n        outTransformedPathLonLat: SegmentPathLonLatExt[],\r\n        outPath3v: SegmentPath3vExt[],\r\n        outTransformedPathMerc: LonLat[][],\r\n        outExtent: Extent,\r\n        outColors: number[]\r\n    ) {\r\n        var index = 0;\r\n\r\n        var v_high = new Vec3(),\r\n            v_low = new Vec3();\r\n\r\n        if (outExtent) {\r\n            outExtent.southWest.set(180.0, 90.0);\r\n            outExtent.northEast.set(-180.0, -90.0);\r\n        }\r\n\r\n        if (outIndexes.length > 0) {\r\n            index = outIndexes[outIndexes.length - 5] + 9;\r\n            outIndexes.push(index, index);\r\n        } else {\r\n            outIndexes.push(0, 0);\r\n        }\r\n\r\n        for (let j = 0, len = path3v.length; j < len; j++) {\r\n            var path = path3v[j],\r\n                pathColors_j = pathColors[j];\r\n\r\n            outTransformedPathLonLat[j] = [];\r\n            outTransformedPathMerc[j] = [];\r\n            outPath3v[j] = [];\r\n\r\n            if (path.length === 0) {\r\n                continue;\r\n            }\r\n\r\n            var startIndex = index;\r\n\r\n            var last;\r\n\r\n            if (isClosed) {\r\n                last = path[path.length - 1];\r\n                if (last instanceof Array) {\r\n                    last = new Vec3(last[0], last[1], last[2]);\r\n                }\r\n            } else {\r\n                var p0 = path[0],\r\n                    p1 = path[1] || p0;\r\n                if (p0 instanceof Array) {\r\n                    p0 = new Vec3(p0[0], p0[1], p0[2]);\r\n                }\r\n                if (p1 instanceof Array) {\r\n                    p1 = new Vec3(p1[0], p1[1], p1[2]);\r\n                }\r\n\r\n                p0 = p0 as Vec3;\r\n                p1 = p1 as Vec3;\r\n\r\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n            }\r\n\r\n            let color = defaultColor;\r\n\r\n            if (pathColors_j && pathColors_j[0]) {\r\n                color = pathColors_j[0];\r\n            }\r\n\r\n            this.__doubleToTwoFloats(last as Vec3, v_high, v_low);\r\n            outVerticesHigh.push(\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z\r\n            );\r\n            outVerticesLow.push(\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z\r\n            );\r\n\r\n            let r = color[R],\r\n                g = color[G],\r\n                b = color[B],\r\n                a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n            if (j > 0) {\r\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n            }\r\n\r\n            outOrders.push(1, -1, 2, -2);\r\n\r\n            for (let i = 0, len = path.length; i < len; i++) {\r\n                var cur = path[i];\r\n\r\n                if (cur instanceof Array) {\r\n                    cur = new Vec3(cur[0], cur[1], cur[2]);\r\n                }\r\n\r\n                outPath3v[j].push(cur as Vec3);\r\n\r\n                if (ellipsoid) {\r\n                    var lonLat = ellipsoid.cartesianToLonLat(cur as Vec3);\r\n                    outTransformedPathLonLat[j].push(lonLat);\r\n                    outTransformedPathMerc[j].push(lonLat.forwardMercator());\r\n\r\n                    if (lonLat.lon < outExtent.southWest.lon) {\r\n                        outExtent.southWest.lon = lonLat.lon;\r\n                    }\r\n                    if (lonLat.lat < outExtent.southWest.lat) {\r\n                        outExtent.southWest.lat = lonLat.lat;\r\n                    }\r\n                    if (lonLat.lon > outExtent.northEast.lon) {\r\n                        outExtent.northEast.lon = lonLat.lon;\r\n                    }\r\n                    if (lonLat.lat > outExtent.northEast.lat) {\r\n                        outExtent.northEast.lat = lonLat.lat;\r\n                    }\r\n                }\r\n\r\n                if (pathColors_j && pathColors_j[i]) {\r\n                    color = pathColors_j[i];\r\n                }\r\n\r\n                r = color[R];\r\n                g = color[G];\r\n                b = color[B];\r\n                a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n                this.__doubleToTwoFloats(cur as Vec3, v_high, v_low);\r\n                outVerticesHigh.push(\r\n                    v_high.x, v_high.y, v_high.z,\r\n                    v_high.x, v_high.y, v_high.z,\r\n                    v_high.x, v_high.y, v_high.z,\r\n                    v_high.x, v_high.y, v_high.z\r\n                );\r\n                outVerticesLow.push(\r\n                    v_low.x, v_low.y, v_low.z,\r\n                    v_low.x, v_low.y, v_low.z,\r\n                    v_low.x, v_low.y, v_low.z,\r\n                    v_low.x, v_low.y, v_low.z\r\n                );\r\n\r\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n\r\n                outOrders.push(1, -1, 2, -2);\r\n                outIndexes.push(index++, index++, index++, index++);\r\n            }\r\n\r\n            var first;\r\n            if (isClosed) {\r\n                first = path[0];\r\n                if (first instanceof Array) {\r\n                    first = new Vec3(first[0], first[1], first[2]);\r\n                }\r\n                outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\r\n            } else {\r\n                let p0 = path[path.length - 1],\r\n                    p1 = path[path.length - 2] || p0;\r\n\r\n                if (p0 instanceof Array) {\r\n                    p0 = new Vec3(p0[0], p0[1], p0[2]);\r\n                } else {\r\n                    p0 = p0 as Vec3;\r\n                }\r\n\r\n                if (p1 instanceof Array) {\r\n                    p1 = new Vec3(p1[0], p1[1], p1[2]);\r\n                } else {\r\n                    p1 = p1 as Vec3;\r\n                }\r\n\r\n                first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n                outIndexes.push(index - 1, index - 1, index - 1, index - 1);\r\n            }\r\n\r\n            if (pathColors_j && pathColors_j[path.length - 1]) {\r\n                color = pathColors_j[path.length - 1];\r\n            }\r\n\r\n            r = color[R];\r\n            g = color[G];\r\n            b = color[B];\r\n            a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n            this.__doubleToTwoFloats(first as Vec3, v_high, v_low);\r\n            outVerticesHigh.push(\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z\r\n            );\r\n            outVerticesLow.push(\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z\r\n            );\r\n\r\n            outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n\r\n            outOrders.push(1, -1, 2, -2);\r\n\r\n            if (j < path3v.length - 1 && path3v[j + 1].length !== 0) {\r\n                index += 8;\r\n                outIndexes.push(index, index);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Appends to the line new cartesian coordinates point data.\r\n     */\r\n    protected __appendPoint3v(\r\n        path3v: SegmentPath3vExt[],\r\n        point3v: Vec3,\r\n        pathColors: SegmentPathColor[],\r\n        color: NumberArray4,\r\n        isClosed: boolean,\r\n        outVerticesHigh: number[],\r\n        outVerticesLow: number[],\r\n        outColors: number[],\r\n        outOrders: number[],\r\n        outIndexes: number[],\r\n        ellipsoid: Ellipsoid | null,\r\n        outTransformedPathLonLat: SegmentPathLonLatExt[],\r\n        outTransformedPathMerc: LonLat[][],\r\n        outExtent: Extent\r\n    ) {\r\n        var v_high = new Vec3(),\r\n            v_low = new Vec3();\r\n\r\n        var ii = outIndexes.length - 4,\r\n            index = outIndexes[ii - 1] + 1;\r\n\r\n        if (path3v.length === 0) {\r\n            path3v.push([]);\r\n            if (!pathColors[0]) {\r\n                pathColors[0] = [];\r\n            }\r\n        } else if (!pathColors[path3v.length - 1]) {\r\n            pathColors[path3v.length - 1] = [];\r\n        }\r\n\r\n        var path = path3v[path3v.length - 1],\r\n            len = path.length;\r\n\r\n        path.push(point3v);\r\n\r\n        let r = color[R],\r\n            g = color[G],\r\n            b = color[B],\r\n            a = color[A] != undefined ? color[A] : 1.0,\r\n            pathColors_last = pathColors[path3v.length - 1];\r\n\r\n        if (pathColors_last[len]) {\r\n            pathColors_last[len][R] = r;\r\n            pathColors_last[len][G] = g;\r\n            pathColors_last[len][B] = b;\r\n            pathColors_last[len][A] = a;\r\n        } else {\r\n            pathColors_last.push(color);\r\n        }\r\n\r\n        if (len === 1) {\r\n            var last;\r\n            if (isClosed) {\r\n                last = path[len - 1];\r\n                if (last instanceof Array) {\r\n                    last = new Vec3(last[0], last[1], last[2]);\r\n                }\r\n            } else {\r\n                let p0 = path[0],\r\n                    p1 = path[1] || p0;\r\n\r\n                if (p0 instanceof Array) {\r\n                    p0 = new Vec3(p0[0], p0[1], p0[2]);\r\n                } else {\r\n                    p0 = p0 as Vec3;\r\n                }\r\n\r\n                if (p1 instanceof Array) {\r\n                    p1 = new Vec3(p1[0], p1[1], p1[2]);\r\n                } else {\r\n                    p1 = p1 as Vec3;\r\n                }\r\n\r\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n            }\r\n\r\n            this.__doubleToTwoFloats(last as Vec3, v_high, v_low);\r\n\r\n            let vi = outVerticesHigh.length - 3 * 12;\r\n\r\n            outVerticesHigh[vi] = v_high.x;\r\n            outVerticesHigh[vi + 1] = v_high.y;\r\n            outVerticesHigh[vi + 2] = v_high.z;\r\n            outVerticesHigh[vi + 3] = v_high.x;\r\n            outVerticesHigh[vi + 4] = v_high.y;\r\n            outVerticesHigh[vi + 5] = v_high.z;\r\n            outVerticesHigh[vi + 6] = v_high.x;\r\n            outVerticesHigh[vi + 7] = v_high.y;\r\n            outVerticesHigh[vi + 8] = v_high.z;\r\n            outVerticesHigh[vi + 9] = v_high.x;\r\n            outVerticesHigh[vi + 10] = v_high.y;\r\n            outVerticesHigh[vi + 11] = v_high.z;\r\n\r\n            outVerticesLow[vi] = v_low.x;\r\n            outVerticesLow[vi + 1] = v_low.y;\r\n            outVerticesLow[vi + 2] = v_low.z;\r\n            outVerticesLow[vi + 3] = v_low.x;\r\n            outVerticesLow[vi + 4] = v_low.y;\r\n            outVerticesLow[vi + 5] = v_low.z;\r\n            outVerticesLow[vi + 6] = v_low.x;\r\n            outVerticesLow[vi + 7] = v_low.y;\r\n            outVerticesLow[vi + 8] = v_low.z;\r\n            outVerticesLow[vi + 9] = v_low.x;\r\n            outVerticesLow[vi + 10] = v_low.y;\r\n            outVerticesLow[vi + 11] = v_low.z;\r\n        }\r\n\r\n        var startIndex = index;\r\n\r\n        if (ellipsoid) {\r\n            if (outTransformedPathLonLat.length === 0) {\r\n                outTransformedPathLonLat.push([]);\r\n            }\r\n\r\n            if (outTransformedPathMerc.length === 0) {\r\n                outTransformedPathMerc.push([]);\r\n            }\r\n\r\n            var transformedPathLonLat = outTransformedPathLonLat[outTransformedPathLonLat.length - 1],\r\n                transformedPathMerc = outTransformedPathMerc[outTransformedPathMerc.length - 1];\r\n\r\n            let lonLat = ellipsoid.cartesianToLonLat(point3v);\r\n            transformedPathLonLat.push(lonLat);\r\n            transformedPathMerc.push(lonLat.forwardMercator());\r\n\r\n            if (lonLat.lon < outExtent.southWest.lon) {\r\n                outExtent.southWest.lon = lonLat.lon;\r\n            }\r\n            if (lonLat.lat < outExtent.southWest.lat) {\r\n                outExtent.southWest.lat = lonLat.lat;\r\n            }\r\n            if (lonLat.lon > outExtent.northEast.lon) {\r\n                outExtent.northEast.lon = lonLat.lon;\r\n            }\r\n            if (lonLat.lat > outExtent.northEast.lat) {\r\n                outExtent.northEast.lat = lonLat.lat;\r\n            }\r\n        }\r\n\r\n        this.__doubleToTwoFloats(point3v, v_high, v_low);\r\n\r\n        let vi = outVerticesHigh.length - 12;\r\n\r\n        outVerticesHigh[vi] = v_high.x;\r\n        outVerticesHigh[vi + 1] = v_high.y;\r\n        outVerticesHigh[vi + 2] = v_high.z;\r\n        outVerticesHigh[vi + 3] = v_high.x;\r\n        outVerticesHigh[vi + 4] = v_high.y;\r\n        outVerticesHigh[vi + 5] = v_high.z;\r\n        outVerticesHigh[vi + 6] = v_high.x;\r\n        outVerticesHigh[vi + 7] = v_high.y;\r\n        outVerticesHigh[vi + 8] = v_high.z;\r\n        outVerticesHigh[vi + 9] = v_high.x;\r\n        outVerticesHigh[vi + 10] = v_high.y;\r\n        outVerticesHigh[vi + 11] = v_high.z;\r\n\r\n        outVerticesLow[vi] = v_low.x;\r\n        outVerticesLow[vi + 1] = v_low.y;\r\n        outVerticesLow[vi + 2] = v_low.z;\r\n        outVerticesLow[vi + 3] = v_low.x;\r\n        outVerticesLow[vi + 4] = v_low.y;\r\n        outVerticesLow[vi + 5] = v_low.z;\r\n        outVerticesLow[vi + 6] = v_low.x;\r\n        outVerticesLow[vi + 7] = v_low.y;\r\n        outVerticesLow[vi + 8] = v_low.z;\r\n        outVerticesLow[vi + 9] = v_low.x;\r\n        outVerticesLow[vi + 10] = v_low.y;\r\n        outVerticesLow[vi + 11] = v_low.z;\r\n\r\n        let ci = outColors.length - 16;\r\n\r\n        outColors[ci] = r;\r\n        outColors[ci + 1] = g;\r\n        outColors[ci + 2] = b;\r\n        outColors[ci + 3] = a;\r\n        outColors[ci + 4] = r;\r\n        outColors[ci + 5] = g;\r\n        outColors[ci + 6] = b;\r\n        outColors[ci + 7] = a;\r\n        outColors[ci + 8] = r;\r\n        outColors[ci + 9] = g;\r\n        outColors[ci + 10] = b;\r\n        outColors[ci + 11] = a;\r\n        outColors[ci + 12] = r;\r\n        outColors[ci + 13] = g;\r\n        outColors[ci + 14] = b;\r\n        outColors[ci + 15] = a;\r\n\r\n        outIndexes[ii] = index++;\r\n        outIndexes[ii + 1] = index++;\r\n        outIndexes[ii + 2] = index++;\r\n        outIndexes[ii + 3] = index++;\r\n\r\n        //\r\n        // Close path\r\n        //\r\n        var first;\r\n        if (isClosed) {\r\n            first = path[0] as Vec3;\r\n            outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\r\n        } else {\r\n            let p0 = path[path.length - 1] as Vec3,\r\n                p1 = path[path.length - 2] as Vec3 || p0;\r\n\r\n            first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n            outIndexes.push(index - 1, index - 1, index - 1, index - 1);\r\n        }\r\n\r\n        this.__doubleToTwoFloats(first, v_high, v_low);\r\n        outVerticesHigh.push(\r\n            v_high.x, v_high.y, v_high.z,\r\n            v_high.x, v_high.y, v_high.z,\r\n            v_high.x, v_high.y, v_high.z,\r\n            v_high.x, v_high.y, v_high.z\r\n        );\r\n        outVerticesLow.push(\r\n            v_low.x, v_low.y, v_low.z,\r\n            v_low.x, v_low.y, v_low.z,\r\n            v_low.x, v_low.y, v_low.z,\r\n            v_low.x, v_low.y, v_low.z\r\n        );\r\n\r\n        outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n\r\n        outOrders.push(1, -1, 2, -2);\r\n    }\r\n\r\n    static setPathColors(\r\n        pathLonLat: SegmentPathLonLatExt[],\r\n        pathColors: SegmentPathColor[],\r\n        defaultColor: NumberArray4,\r\n        outColors: number[]\r\n    ) {\r\n        for (let j = 0, len = pathLonLat.length; j < len; j++) {\r\n            var path = pathLonLat[j],\r\n                pathColors_j = pathColors[j];\r\n\r\n            if (path.length === 0) {\r\n                continue;\r\n            }\r\n\r\n            let color = defaultColor;\r\n            if (pathColors_j && pathColors_j[0]) {\r\n                color = pathColors_j[0];\r\n            }\r\n\r\n            let r = color[R],\r\n                g = color[G],\r\n                b = color[B],\r\n                a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n            if (j > 0) {\r\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n            }\r\n\r\n            for (let i = 0, len = path.length; i < len; i++) {\r\n                var cur = path[i];\r\n\r\n                if (cur instanceof Array) {\r\n                    cur = new LonLat(cur[0], cur[1], cur[2]);\r\n                }\r\n\r\n                if (pathColors_j && pathColors_j[i]) {\r\n                    color = pathColors_j[i];\r\n                }\r\n\r\n                r = color[R];\r\n                g = color[G];\r\n                b = color[B];\r\n                a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n\r\n            }\r\n\r\n            if (pathColors_j && pathColors_j[path.length - 1]) {\r\n                color = pathColors_j[path.length - 1];\r\n            }\r\n\r\n            r = color[R];\r\n            g = color[G];\r\n            b = color[B];\r\n            a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n            outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Appends to the line array new geodetic coordinates line data.\r\n     * @static\r\n     */\r\n    protected __appendLineDataLonLat(\r\n        pathLonLat: SegmentPathLonLatExt[],\r\n        pathColors: SegmentPathColor[],\r\n        defaultColor: NumberArray4,\r\n        isClosed: boolean,\r\n        outVerticesHigh: number[],\r\n        outVerticesLow: number[],\r\n        outOrders: number[],\r\n        outIndexes: number[],\r\n        ellipsoid: Ellipsoid,\r\n        outTransformedPathCartesian: SegmentPath3vExt[],\r\n        outPathLonLat: SegmentPathLonLatExt[],\r\n        outTransformedPathMerc: LonLat[][],\r\n        outExtent: Extent,\r\n        outColors: number[]\r\n    ) {\r\n        var index = 0;\r\n\r\n        var v_high = new Vec3(),\r\n            v_low = new Vec3();\r\n\r\n        if (outExtent) {\r\n            outExtent.southWest.set(180.0, 90.0);\r\n            outExtent.northEast.set(-180.0, -90.0);\r\n        }\r\n\r\n        if (outIndexes.length > 0) {\r\n            index = outIndexes[outIndexes.length - 5] + 9;\r\n            outIndexes.push(index);\r\n        } else {\r\n            outIndexes.push(0);\r\n        }\r\n\r\n        for (let j = 0, len = pathLonLat.length; j < len; j++) {\r\n            var path = pathLonLat[j],\r\n                pathColors_j = pathColors[j];\r\n\r\n            outTransformedPathCartesian[j] = [];\r\n            outTransformedPathMerc[j] = [];\r\n            outPathLonLat[j] = [];\r\n\r\n            if (path.length === 0) {\r\n                continue;\r\n            }\r\n\r\n            var startIndex = index;\r\n\r\n            var last;\r\n\r\n            if (isClosed) {\r\n                let pp = path[path.length - 1];\r\n                if (pp instanceof Array) {\r\n                    last = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\r\n                } else {\r\n                    last = ellipsoid.lonLatToCartesian(pp as LonLat);\r\n                }\r\n            } else {\r\n                let p0, p1;\r\n                let pp = path[0];\r\n                if (pp instanceof Array) {\r\n                    p0 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\r\n                } else {\r\n                    p0 = ellipsoid.lonLatToCartesian(pp as LonLat);\r\n                }\r\n\r\n                pp = path[1];\r\n\r\n                if (!pp) {\r\n                    pp = path[0];\r\n                }\r\n\r\n                if (pp instanceof Array) {\r\n                    p1 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\r\n                } else {\r\n                    p1 = ellipsoid.lonLatToCartesian(pp as LonLat);\r\n                }\r\n\r\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n            }\r\n\r\n            let color = defaultColor;\r\n\r\n            if (pathColors_j && pathColors_j[0]) {\r\n                color = pathColors_j[0];\r\n            }\r\n\r\n            this.__doubleToTwoFloats(last, v_high, v_low);\r\n            outVerticesHigh.push(\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z\r\n            );\r\n            outVerticesLow.push(\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z\r\n            );\r\n\r\n            let r = color[R],\r\n                g = color[G],\r\n                b = color[B],\r\n                a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n            if (j > 0) {\r\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n            }\r\n\r\n            outOrders.push(1, -1, 2, -2);\r\n\r\n            for (let i = 0, len = path.length; i < len; i++) {\r\n                var cur = path[i];\r\n\r\n                if (cur instanceof Array) {\r\n                    cur = new LonLat(cur[0], cur[1], cur[2]);\r\n                }\r\n\r\n                if (pathColors_j && pathColors_j[i]) {\r\n                    color = pathColors_j[i];\r\n                }\r\n\r\n                r = color[R];\r\n                g = color[G];\r\n                b = color[B];\r\n                a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n                var cartesian = ellipsoid.lonLatToCartesian(cur as LonLat);\r\n                outTransformedPathCartesian[j].push(cartesian);\r\n                outPathLonLat[j].push(cur as LonLat);\r\n                outTransformedPathMerc[j].push((cur as LonLat).forwardMercator());\r\n\r\n                this.__doubleToTwoFloats(cartesian, v_high, v_low);\r\n                outVerticesHigh.push(\r\n                    v_high.x, v_high.y, v_high.z,\r\n                    v_high.x, v_high.y, v_high.z,\r\n                    v_high.x, v_high.y, v_high.z,\r\n                    v_high.x, v_high.y, v_high.z\r\n                );\r\n                outVerticesLow.push(\r\n                    v_low.x, v_low.y, v_low.z,\r\n                    v_low.x, v_low.y, v_low.z,\r\n                    v_low.x, v_low.y, v_low.z,\r\n                    v_low.x, v_low.y, v_low.z\r\n                );\r\n\r\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n\r\n                outOrders.push(1, -1, 2, -2);\r\n                outIndexes.push(index++, index++, index++, index++);\r\n\r\n                if ((cur as LonLat).lon < outExtent.southWest.lon) {\r\n                    outExtent.southWest.lon = (cur as LonLat).lon;\r\n                }\r\n                if ((cur as LonLat).lat < outExtent.southWest.lat) {\r\n                    outExtent.southWest.lat = (cur as LonLat).lat;\r\n                }\r\n                if ((cur as LonLat).lon > outExtent.northEast.lon) {\r\n                    outExtent.northEast.lon = (cur as LonLat).lon;\r\n                }\r\n                if ((cur as LonLat).lat > outExtent.northEast.lat) {\r\n                    outExtent.northEast.lat = (cur as LonLat).lat;\r\n                }\r\n            }\r\n\r\n            var first;\r\n            if (isClosed) {\r\n                let pp = path[0];\r\n                if (pp instanceof Array) {\r\n                    first = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\r\n                } else {\r\n                    first = ellipsoid.lonLatToCartesian(pp as LonLat);\r\n                }\r\n                outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\r\n            } else {\r\n                let p0, p1;\r\n                let pp = path[path.length - 1];\r\n                if (pp instanceof Array) {\r\n                    p0 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\r\n                } else {\r\n                    p0 = ellipsoid.lonLatToCartesian(pp as LonLat);\r\n                }\r\n\r\n                pp = path[path.length - 2];\r\n\r\n                if (!pp) {\r\n                    pp = path[0];\r\n                }\r\n\r\n                if (pp instanceof Array) {\r\n                    p1 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\r\n                } else {\r\n                    p1 = ellipsoid.lonLatToCartesian(pp as LonLat);\r\n                }\r\n                first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n                outIndexes.push(index - 1, index - 1, index - 1, index - 1);\r\n            }\r\n\r\n            if (pathColors_j && pathColors_j[path.length - 1]) {\r\n                color = pathColors_j[path.length - 1];\r\n            }\r\n\r\n            r = color[R];\r\n            g = color[G];\r\n            b = color[B];\r\n            a = color[A] != undefined ? color[A] : 1.0;\r\n\r\n            this.__doubleToTwoFloats(first, v_high, v_low);\r\n            outVerticesHigh.push(\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z,\r\n                v_high.x, v_high.y, v_high.z\r\n            );\r\n            outVerticesLow.push(\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z,\r\n                v_low.x, v_low.y, v_low.z\r\n            );\r\n\r\n            outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\r\n\r\n            outOrders.push(1, -1, 2, -2);\r\n\r\n            if (j < pathLonLat.length - 1 && pathLonLat[j + 1].length !== 0) {\r\n                index += 8;\r\n                outIndexes.push(index, index);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets polyline path with cartesian coordinates.\r\n     * @protected\r\n     * @param {SegmentPath3vExt[]} path3v - Cartesian coordinates.\r\n     */\r\n    protected _setEqualPath3v(path3v: SegmentPath3vExt[]) {\r\n\r\n        var extent = this._extent;\r\n        extent.southWest.set(180, 90);\r\n        extent.northEast.set(-180, -90);\r\n\r\n        var v_high = new Vec3(),\r\n            v_low = new Vec3();\r\n\r\n        var vh = this._verticesHigh,\r\n            vl = this._verticesLow,\r\n            l = this._pathLonLat,\r\n            m = this._pathLonLatMerc,\r\n            k = 0;\r\n\r\n        var ellipsoid = (this._renderNode as Planet).ellipsoid;\r\n\r\n        for (let j = 0; j < path3v.length; j++) {\r\n            var path = path3v[j] as Vec3[];\r\n\r\n            var last;\r\n            if (this._closedLine) {\r\n                last = path[path.length - 1];\r\n            } else {\r\n                last = new Vec3(\r\n                    path[0].x + path[0].x - path[1].x,\r\n                    path[0].y + path[0].y - path[1].y,\r\n                    path[0].z + path[0].z - path[1].z\r\n                );\r\n            }\r\n\r\n            this.__doubleToTwoFloats(last, v_high, v_low);\r\n\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n\r\n            for (let i = 0; i < path.length; i++) {\r\n                var cur = path[i] as Vec3,\r\n                    pji = this._path3v[j][i] as Vec3;\r\n\r\n                pji.x = cur.x;\r\n                pji.y = cur.y;\r\n                pji.z = cur.z;\r\n\r\n                if (ellipsoid) {\r\n                    var lonLat = ellipsoid.cartesianToLonLat(cur);\r\n\r\n                    this._pathLonLat[j][i] = lonLat;\r\n\r\n                    l[j][i] = lonLat;\r\n                    m[j][i] = lonLat.forwardMercator();\r\n\r\n                    if (lonLat.lon < extent.southWest.lon) {\r\n                        extent.southWest.lon = lonLat.lon;\r\n                    }\r\n                    if (lonLat.lat < extent.southWest.lat) {\r\n                        extent.southWest.lat = lonLat.lat;\r\n                    }\r\n                    if (lonLat.lon > extent.northEast.lon) {\r\n                        extent.northEast.lon = lonLat.lon;\r\n                    }\r\n                    if (lonLat.lat > extent.northEast.lat) {\r\n                        extent.northEast.lat = lonLat.lat;\r\n                    }\r\n                }\r\n\r\n                this.__doubleToTwoFloats(cur, v_high, v_low);\r\n\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n            }\r\n\r\n            var first;\r\n            if (this._closedLine) {\r\n                first = path[0];\r\n            } else {\r\n                var l1 = path.length - 1;\r\n                first = new Vec3(\r\n                    path[l1].x + path[l1].x - path[l1 - 1].x,\r\n                    path[l1].y + path[l1].y - path[l1 - 1].y,\r\n                    path[l1].z + path[l1].z - path[l1 - 1].z\r\n                );\r\n            }\r\n\r\n            this.__doubleToTwoFloats(first as Vec3, v_high, v_low);\r\n\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets polyline with geodetic coordinates.\r\n     * @protected\r\n     * @param {SegmentPathLonLat[]} pathLonLat - Geodetic polyline path coordinates.\r\n     */\r\n    protected _setEqualPathLonLat(pathLonLat: SegmentPathLonLat[]) {\r\n        var extent = this._extent;\r\n        extent.southWest.set(180.0, 90.0);\r\n        extent.northEast.set(-180.0, -90.0);\r\n\r\n        var v_high = new Vec3(),\r\n            v_low = new Vec3();\r\n\r\n        var vh = this._verticesHigh,\r\n            vl = this._verticesLow,\r\n            l = this._pathLonLat,\r\n            m = this._pathLonLatMerc,\r\n            c = this._path3v,\r\n            k = 0;\r\n\r\n        var ellipsoid = (this._renderNode as Planet).ellipsoid;\r\n\r\n        for (let j = 0; j < pathLonLat.length; j++) {\r\n            var path = pathLonLat[j] as LonLat[];\r\n\r\n            var last;\r\n            if (this._closedLine) {\r\n                last = ellipsoid.lonLatToCartesian(path[path.length - 1]);\r\n            } else {\r\n                let p0 = ellipsoid.lonLatToCartesian(path[0]),\r\n                    p1 = ellipsoid.lonLatToCartesian(path[1]);\r\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n            }\r\n\r\n            this.__doubleToTwoFloats(last, v_high, v_low);\r\n\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n\r\n            for (let i = 0; i < path.length; i++) {\r\n                var cur = path[i] as LonLat;\r\n                var cartesian = ellipsoid.lonLatToCartesian(cur);\r\n                c[j][i] = cartesian;\r\n                m[j][i] = cur.forwardMercator();\r\n                l[j][i] = cur;\r\n\r\n                this.__doubleToTwoFloats(cartesian, v_high, v_low);\r\n\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n                vh[k] = v_high.x;\r\n                vl[k++] = v_low.x;\r\n                vh[k] = v_high.y;\r\n                vl[k++] = v_low.y;\r\n                vh[k] = v_high.z;\r\n                vl[k++] = v_low.z;\r\n\r\n                if (cur.lon < extent.southWest.lon) {\r\n                    extent.southWest.lon = cur.lon;\r\n                }\r\n                if (cur.lat < extent.southWest.lat) {\r\n                    extent.southWest.lat = cur.lat;\r\n                }\r\n                if (cur.lon > extent.northEast.lon) {\r\n                    extent.northEast.lon = cur.lon;\r\n                }\r\n                if (cur.lat > extent.northEast.lat) {\r\n                    extent.northEast.lat = cur.lat;\r\n                }\r\n            }\r\n\r\n            var first;\r\n            if (this._closedLine) {\r\n                first = ellipsoid.lonLatToCartesian(path[0]);\r\n            } else {\r\n                let p0 = ellipsoid.lonLatToCartesian(path[path.length - 1]),\r\n                    p1 = ellipsoid.lonLatToCartesian(path[path.length - 2]);\r\n                first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\r\n            }\r\n\r\n            this.__doubleToTwoFloats(first, v_high, v_low);\r\n\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n            vh[k] = v_high.x;\r\n            vl[k++] = v_low.x;\r\n            vh[k] = v_high.y;\r\n            vl[k++] = v_low.y;\r\n            vh[k] = v_high.z;\r\n            vl[k++] = v_low.z;\r\n        }\r\n    }\r\n\r\n    public setPointLonLat(lonlat: LonLat, index: number, segmentIndex: number) {\r\n        if (this._renderNode && (this._renderNode as Planet).ellipsoid) {\r\n            let l = this._pathLonLat,\r\n                m = this._pathLonLatMerc;\r\n\r\n            l[segmentIndex][index] = lonlat;\r\n            m[segmentIndex][index] = lonlat.forwardMercator();\r\n\r\n            //\r\n            // Apply new extent(TODO: think about optimization)\r\n            //\r\n            var extent = this._extent;\r\n            extent.southWest.set(180.0, 90.0);\r\n            extent.northEast.set(-180.0, -90.0);\r\n            for (let i = 0; i < l.length; i++) {\r\n                var pi = l[i] as LonLat[];\r\n                for (let j = 0; j < pi.length; j++) {\r\n                    var lon = pi[j].lon,\r\n                        lat = pi[j].lat;\r\n                    if (lon > extent.northEast.lon) {\r\n                        extent.northEast.lon = lon;\r\n                    }\r\n                    if (lat > extent.northEast.lat) {\r\n                        extent.northEast.lat = lat;\r\n                    }\r\n                    if (lon < extent.southWest.lon) {\r\n                        extent.southWest.lon = lon;\r\n                    }\r\n                    if (lat < extent.southWest.lat) {\r\n                        extent.southWest.lat = lat;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.setPoint3v(\r\n                (this._renderNode as Planet).ellipsoid.lonLatToCartesian(lonlat),\r\n                index,\r\n                segmentIndex,\r\n                true\r\n            );\r\n        } else {\r\n            let path = this._pathLonLat[segmentIndex] as LonLat[];\r\n            path[index].lon = lonlat.lon;\r\n            path[index].lat = lonlat.lat;\r\n            path[index].height = lonlat.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Changes cartesian point coordinates of the path\r\n     * @param {Vec3} coordinates - New coordinates\r\n     * @param {number} [index=0] - Path segment index\r\n     * @param {number} [segmentIndex=0] - Index of the point in the path segment\r\n     * @param {boolean} [skipLonLat=false] - Do not update geodetic coordinates\r\n     */\r\n    public setPoint3v(coordinates: Vec3, index: number = 0, segmentIndex: number = 0, skipLonLat: boolean = false) {\r\n\r\n        if (this._renderNode) {\r\n            var v_high = new Vec3(),\r\n                v_low = new Vec3();\r\n\r\n            var vh = this._verticesHigh,\r\n                vl = this._verticesLow,\r\n                l = this._pathLonLat,\r\n                m = this._pathLonLatMerc,\r\n                k = 0,\r\n                kk = 0;\r\n\r\n            //for (let i = 0; i < segmentIndex; i++) {\r\n            //    kk += this._path3v[i].length * 12 + 24;\r\n            //}\r\n            kk = this._pathLengths[segmentIndex] * 12 + 24 * segmentIndex;\r\n\r\n            let path = this._path3v[segmentIndex] as Vec3[];\r\n\r\n            path[index].x = coordinates.x;\r\n            path[index].y = coordinates.y;\r\n            path[index].z = coordinates.z;\r\n\r\n            let _closedLine = this._closedLine || path.length === 1;\r\n\r\n            if (index === 0 || index === 1) {\r\n                var last;\r\n                if (_closedLine) {\r\n                    last = path[path.length - 1];\r\n                } else {\r\n                    last = new Vec3(\r\n                        path[0].x + path[0].x - path[1].x,\r\n                        path[0].y + path[0].y - path[1].y,\r\n                        path[0].z + path[0].z - path[1].z\r\n                    );\r\n                }\r\n\r\n                k = kk;\r\n\r\n                this.__doubleToTwoFloats(last, v_high, v_low);\r\n\r\n                vh[k] = v_high.x;\r\n                vh[k + 1] = v_high.y;\r\n                vh[k + 2] = v_high.z;\r\n                vh[k + 3] = v_high.x;\r\n                vh[k + 4] = v_high.y;\r\n                vh[k + 5] = v_high.z;\r\n                vh[k + 6] = v_high.x;\r\n                vh[k + 7] = v_high.y;\r\n                vh[k + 8] = v_high.z;\r\n                vh[k + 9] = v_high.x;\r\n                vh[k + 10] = v_high.y;\r\n                vh[k + 11] = v_high.z;\r\n\r\n                vl[k] = v_low.x;\r\n                vl[k + 1] = v_low.y;\r\n                vl[k + 2] = v_low.z;\r\n                vl[k + 3] = v_low.x;\r\n                vl[k + 4] = v_low.y;\r\n                vl[k + 5] = v_low.z;\r\n                vl[k + 6] = v_low.x;\r\n                vl[k + 7] = v_low.y;\r\n                vl[k + 8] = v_low.z;\r\n                vl[k + 9] = v_low.x;\r\n                vl[k + 10] = v_low.y;\r\n                vl[k + 11] = v_low.z;\r\n            }\r\n\r\n            if (!skipLonLat && (this._renderNode as Planet).ellipsoid) {\r\n                var lonLat = (this._renderNode as Planet).ellipsoid.cartesianToLonLat(coordinates);\r\n                l[segmentIndex][index] = lonLat;\r\n                m[segmentIndex][index] = lonLat.forwardMercator();\r\n\r\n                //\r\n                // Apply new extent(TODO: think about optimization)\r\n                //\r\n                var extent = this._extent;\r\n                extent.southWest.set(180.0, 90.0);\r\n                extent.northEast.set(-180.0, -90.0);\r\n                for (let i = 0; i < l.length; i++) {\r\n                    var pi = l[i] as LonLat[];\r\n                    for (let j = 0; j < pi.length; j++) {\r\n                        var lon = pi[j].lon,\r\n                            lat = pi[j].lat;\r\n                        if (lon > extent.northEast.lon) {\r\n                            extent.northEast.lon = lon;\r\n                        }\r\n                        if (lat > extent.northEast.lat) {\r\n                            extent.northEast.lat = lat;\r\n                        }\r\n                        if (lon < extent.southWest.lon) {\r\n                            extent.southWest.lon = lon;\r\n                        }\r\n                        if (lat < extent.southWest.lat) {\r\n                            extent.southWest.lat = lat;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            k = kk + index * 12 + 12;\r\n\r\n            this.__doubleToTwoFloats(coordinates, v_high, v_low);\r\n\r\n            vh[k] = v_high.x;\r\n            vh[k + 1] = v_high.y;\r\n            vh[k + 2] = v_high.z;\r\n            vh[k + 3] = v_high.x;\r\n            vh[k + 4] = v_high.y;\r\n            vh[k + 5] = v_high.z;\r\n            vh[k + 6] = v_high.x;\r\n            vh[k + 7] = v_high.y;\r\n            vh[k + 8] = v_high.z;\r\n            vh[k + 9] = v_high.x;\r\n            vh[k + 10] = v_high.y;\r\n            vh[k + 11] = v_high.z;\r\n\r\n            vl[k] = v_low.x;\r\n            vl[k + 1] = v_low.y;\r\n            vl[k + 2] = v_low.z;\r\n            vl[k + 3] = v_low.x;\r\n            vl[k + 4] = v_low.y;\r\n            vl[k + 5] = v_low.z;\r\n            vl[k + 6] = v_low.x;\r\n            vl[k + 7] = v_low.y;\r\n            vl[k + 8] = v_low.z;\r\n            vl[k + 9] = v_low.x;\r\n            vl[k + 10] = v_low.y;\r\n            vl[k + 11] = v_low.z;\r\n\r\n            if (index === path.length - 1 || index === path.length - 2) {\r\n                var first;\r\n                if (_closedLine) {\r\n                    first = path[0];\r\n                } else {\r\n                    var l1 = path.length - 1;\r\n                    first = new Vec3(\r\n                        path[l1].x + path[l1].x - path[l1 - 1].x,\r\n                        path[l1].y + path[l1].y - path[l1 - 1].y,\r\n                        path[l1].z + path[l1].z - path[l1 - 1].z\r\n                    );\r\n                }\r\n\r\n                k = kk + path.length * 12 + 12;\r\n\r\n                this.__doubleToTwoFloats(first, v_high, v_low);\r\n\r\n                vh[k] = v_high.x;\r\n                vh[k + 1] = v_high.y;\r\n                vh[k + 2] = v_high.z;\r\n                vh[k + 3] = v_high.x;\r\n                vh[k + 4] = v_high.y;\r\n                vh[k + 5] = v_high.z;\r\n                vh[k + 6] = v_high.x;\r\n                vh[k + 7] = v_high.y;\r\n                vh[k + 8] = v_high.z;\r\n                vh[k + 9] = v_high.x;\r\n                vh[k + 10] = v_high.y;\r\n                vh[k + 11] = v_high.z;\r\n\r\n                vl[k] = v_low.x;\r\n                vl[k + 1] = v_low.y;\r\n                vl[k + 2] = v_low.z;\r\n                vl[k + 3] = v_low.x;\r\n                vl[k + 4] = v_low.y;\r\n                vl[k + 5] = v_low.z;\r\n                vl[k + 6] = v_low.x;\r\n                vl[k + 7] = v_low.y;\r\n                vl[k + 8] = v_low.z;\r\n                vl[k + 9] = v_low.x;\r\n                vl[k + 10] = v_low.y;\r\n                vl[k + 11] = v_low.z;\r\n            }\r\n\r\n            this._changedBuffers[VERTICES_BUFFER] = true;\r\n        } else {\r\n            let path = this._path3v[segmentIndex] as Vec3[];\r\n            path[index].x = coordinates.x;\r\n            path[index].y = coordinates.y;\r\n            path[index].z = coordinates.z;\r\n        }\r\n    }\r\n\r\n    protected _resizePathLengths(index: number = 0) {\r\n        this._pathLengths[0] = 0;\r\n        for (let i = index + 1, len = this._path3v.length; i <= len; i++) {\r\n            this._pathLengths[i] = this._pathLengths[i - 1] + this._path3v[i - 1].length;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove path segment\r\n     * @param {number} index - Path segment index\r\n     */\r\n    public removeSegment(index: number) {\r\n        this._path3v.splice(index, 1);\r\n        this.setPath3v(([] as SegmentPath3vExt[]).concat(this._path3v));\r\n    }\r\n\r\n    /**\r\n     * Remove point from the path\r\n     * @param {number} index - Point index in a path segment\r\n     * @param {number} [multiLineIndex=0] - Segment path index\r\n     */\r\n    public removePoint(index: number, multiLineIndex: number = 0) {\r\n        this._path3v[multiLineIndex].splice(index, 1);\r\n        if (this._path3v[multiLineIndex].length === 0) {\r\n            this._path3v.splice(multiLineIndex, 1);\r\n        }\r\n        this.setPath3v(([] as SegmentPath3vExt[]).concat(this._path3v));\r\n    }\r\n\r\n    /**\r\n     * Insert point coordinates in a path segment\r\n     * @param {Vec3} point3v - Point coordinates\r\n     * @param {number} [index=0] - Index in the path\r\n     * @param {NumberArray4} [color] - Point color\r\n     * @param {number} [multilineIndex=0] - Path segment index\r\n     */\r\n    public insertPoint3v(point3v: Vec3, index: number = 0, color?: NumberArray4, multilineIndex: number = 0) {\r\n        let p = ([] as SegmentPath3vExt[]).concat(this._path3v),\r\n            pp = p[multilineIndex];\r\n        if (pp) {\r\n            let c = ([] as SegmentPathColor[]).concat(this._pathColors);\r\n\r\n            pp.splice(index, 0, point3v);\r\n\r\n            if (color) {\r\n                let cc = c[multilineIndex];\r\n                if (!cc) {\r\n                    cc = new Array(pp.length);\r\n                }\r\n                cc.splice(index, 0, color);\r\n            }\r\n\r\n            this.setPath3v(p, c);\r\n        } else {\r\n            this.addPoint3v(point3v, multilineIndex);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds a new cartesian point in the end of the path in a last line segment.\r\n     * @public\r\n     * @param {Vec3} point3v - New coordinates.\r\n     * @param {NumberArray4} [color] -\r\n     * @param {boolean} [skipEllipsoid] -\r\n     */\r\n    public appendPoint3v(point3v: Vec3, color?: NumberArray4, skipEllipsoid?: boolean) {\r\n        if (this._path3v.length === 0 || !this._renderNode) {\r\n            this._pathColors.push([color || this._defaultColor as NumberArray4]);\r\n            this.addPoint3v(point3v);\r\n        } else {\r\n            //\r\n            // Making typedArrays suitable for appendPoint function\r\n            //\r\n            this._verticesHigh = makeArray(this._verticesHigh);\r\n            this._verticesLow = makeArray(this._verticesLow);\r\n            this._colors = makeArray(this._colors);\r\n            this._orders = makeArray(this._orders);\r\n            this._indexes = makeArray(this._indexes);\r\n\r\n            this.__appendPoint3v(\r\n                this._path3v,\r\n                point3v,\r\n                this._pathColors,\r\n                color || this._defaultColor as NumberArray4,\r\n                this._closedLine,\r\n                this._verticesHigh,\r\n                this._verticesLow,\r\n                this._colors,\r\n                this._orders,\r\n                this._indexes,\r\n                !skipEllipsoid ? (this._renderNode as Planet).ellipsoid : null,\r\n                this._pathLonLat,\r\n                this._pathLonLatMerc,\r\n                this._extent\r\n            );\r\n\r\n            this._pathLengths[this._path3v.length] += 1;\r\n\r\n            this._changedBuffers[VERTICES_BUFFER] = true;\r\n            this._changedBuffers[COLORS_BUFFER] = true;\r\n            this._changedBuffers[INDEX_BUFFER] = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Append new point in the end of the path.\r\n     * @public\r\n     * @param {Vec3} point3v - New point coordinates.\r\n     * @param {number} [multiLineIndex=0] - Path segment index, first by default.\r\n     */\r\n    public addPoint3v(point3v: Vec3, multiLineIndex: number = 0) {\r\n        //\r\n        // TODO: could be optimized\r\n        //\r\n        if (multiLineIndex >= this._path3v.length) {\r\n            this._path3v.push([]);\r\n        }\r\n        this._path3v[multiLineIndex].push(point3v);\r\n        this.setPath3v(([] as SegmentPath3vExt[]).concat(this._path3v));\r\n    }\r\n\r\n    /**\r\n     * Append new geodetic point in the end of the path.\r\n     * @public\r\n     * @param {LonLat} lonLat - New coordinate.\r\n     * @param {number} [multiLineIndex=0] - Path segment index, first by default.\r\n     */\r\n    public addPointLonLat(lonLat: LonLat, multiLineIndex: number = 0) {\r\n        //\r\n        // TODO: could be optimized\r\n        //\r\n        if (multiLineIndex >= this._pathLonLat.length) {\r\n            this._pathLonLat.push([]);\r\n        }\r\n        this._pathLonLat[multiLineIndex].push(lonLat);\r\n        this.setPathLonLat(([] as SegmentPathLonLatExt[]).concat(this._pathLonLat));\r\n    }\r\n\r\n    /**\r\n     * Clear polyline data.\r\n     * @public\r\n     */\r\n    public clear() {\r\n        this._clearData();\r\n    }\r\n\r\n    /**\r\n     * Change path point color\r\n     * @param {NumberArray4} color - New color\r\n     * @param {number} [index=0] - Point index\r\n     * @param {number} [segmentIndex=0] - Path segment index\r\n     */\r\n    public setPointColor(color: NumberArray4, index: number = 0, segmentIndex: number = 0) {\r\n        if (this._renderNode && index < this._path3v[segmentIndex].length) {\r\n            let colors = this._pathColors[segmentIndex];\r\n\r\n            if (!colors) {\r\n                if (this._path3v[segmentIndex] && index < this._path3v[segmentIndex].length) {\r\n                    this._pathColors[segmentIndex] = new Array(this._path3v[segmentIndex].length);\r\n                } else {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (!colors[index]) {\r\n                colors[index] = [color[R], color[G], color[B], color[A] || 1.0];\r\n            } else {\r\n                colors[index][R] = color[R];\r\n                colors[index][G] = color[G];\r\n                colors[index][B] = color[B];\r\n                colors[index][A] = color[A] || 1.0;\r\n            }\r\n\r\n            let c = this._colors;\r\n\r\n            //optimized with this._pathLengths\r\n            //for (let i = 0; i < segmentIndex; i++) {\r\n            //    kk += this._path3v[i].length * 16 + 32;\r\n            //}\r\n\r\n            let k = index * 16 + this._pathLengths[segmentIndex] * 16 + 32 * segmentIndex;\r\n\r\n            c[k] = c[k + 4] = c[k + 8] = c[k + 12] = color[R];\r\n            c[k + 1] = c[k + 5] = c[k + 9] = c[k + 13] = color[G];\r\n            c[k + 2] = c[k + 6] = c[k + 10] = c[k + 14] = color[B];\r\n            c[k + 3] = c[k + 7] = c[k + 11] = c[k + 15] = color[A] || 1.0;\r\n\r\n            this._changedBuffers[COLORS_BUFFER] = true;\r\n        } else {\r\n            let pathColors = this._pathColors[segmentIndex];\r\n            pathColors[index] = color;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets polyline opacity.\r\n     * @public\r\n     * @param {number} opacity - Opacity.\r\n     */\r\n    public setOpacity(opacity: number) {\r\n        this._opacity = opacity;\r\n    }\r\n\r\n    /**\r\n     * Gets polyline opacity.\r\n     * @public\r\n     * @param {number} opacity - Opacity.\r\n     */\r\n    public getOpacity(): number {\r\n        return this._opacity;\r\n    }\r\n\r\n    /**\r\n     * Sets Polyline thickness in screen pixels.\r\n     * @public\r\n     * @param {number} thickness - Thickness.\r\n     */\r\n    public setAltitude(altitude: number) {\r\n        this.altitude = altitude;\r\n    }\r\n\r\n    /**\r\n     * Sets Polyline thickness in screen pixels.\r\n     * @public\r\n     * @param {number} thickness - Thickness.\r\n     */\r\n    public setThickness(thickness: number) {\r\n        this.thickness = thickness;\r\n    }\r\n\r\n    /**\r\n     * Returns thickness.\r\n     * @public\r\n     * @return {number} Thickness in screen pixels.\r\n     */\r\n    public getThickness(): number {\r\n        return this.thickness;\r\n    }\r\n\r\n    /**\r\n     * Sets visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Polyline visibility.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this.visibility = visibility;\r\n    }\r\n\r\n    /**\r\n     * Gets Polyline visibility.\r\n     * @public\r\n     * @return {boolean} Polyline visibility.\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this.visibility;\r\n    }\r\n\r\n    /**\r\n     * Assign with render node.\r\n     * @public\r\n     * @param {RenderNode} renderNode -\r\n     */\r\n    public setRenderNode(renderNode: RenderNode) {\r\n        if (renderNode) {\r\n            this._renderNode = renderNode;\r\n            if (this._pathLonLat.length) {\r\n                this._createDataLonLat(([] as SegmentPathLonLatExt[]).concat(this._pathLonLat));\r\n            } else {\r\n                this._createData3v(([] as SegmentPath3vExt[]).concat(this._path3v));\r\n            }\r\n            this._refresh();\r\n            if (renderNode.renderer && renderNode.renderer.isInitialized()) {\r\n                this._update();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _clearData() {\r\n        //@ts-ignore\r\n        this._verticesHigh = null;\r\n        //@ts-ignore\r\n        this._verticesLow = null;\r\n        //@ts-ignore\r\n        this._orders = null;\r\n        //@ts-ignore\r\n        this._indexes = null;\r\n        //@ts-ignore\r\n        this._colors = null;\r\n\r\n        this._verticesHigh = [];\r\n        this._verticesLow = [];\r\n        this._orders = [];\r\n        this._indexes = [];\r\n        this._colors = [];\r\n\r\n        this._path3v.length = 0;\r\n        this._pathLonLat.length = 0;\r\n        this._pathLonLatMerc.length = 0;\r\n\r\n        this._path3v = [];\r\n        this._pathLonLat = [];\r\n        this._pathLonLatMerc = [];\r\n    }\r\n\r\n    protected _createData3v(path3v: SegmentPath3vExt[]) {\r\n        this._clearData();\r\n        this.__appendLineData3v(\r\n            path3v,\r\n            this._pathColors,\r\n            this._defaultColor as NumberArray4,\r\n            this._closedLine,\r\n            this._verticesHigh as number[],\r\n            this._verticesLow as number[],\r\n            this._orders as number[],\r\n            this._indexes as number[],\r\n            (this._renderNode as Planet).ellipsoid,\r\n            this._pathLonLat,\r\n            this._path3v,\r\n            this._pathLonLatMerc,\r\n            this._extent,\r\n            this._colors as number[]\r\n        );\r\n        this._resizePathLengths(0);\r\n    }\r\n\r\n    protected _createDataLonLat(pathLonlat: SegmentPathLonLatExt[]) {\r\n        this._clearData();\r\n        this.__appendLineDataLonLat(\r\n            pathLonlat,\r\n            this._pathColors,\r\n            this._defaultColor as NumberArray4,\r\n            this._closedLine,\r\n            this._verticesHigh as number[],\r\n            this._verticesLow as number[],\r\n            this._orders as number[],\r\n            this._indexes as number[],\r\n            (this._renderNode as Planet).ellipsoid,\r\n            this._path3v,\r\n            this._pathLonLat,\r\n            this._pathLonLatMerc,\r\n            this._extent,\r\n            this._colors as number[]\r\n        );\r\n        this._resizePathLengths(0);\r\n    }\r\n\r\n    /**\r\n     * Removes from an entity.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._entity = null;\r\n\r\n        this._pathColors.length = 0;\r\n        this._pathColors = [];\r\n\r\n        //@ts-ignore\r\n        this._verticesHigh = null;\r\n        //@ts-ignore\r\n        this._verticesLow = null;\r\n        //@ts-ignore\r\n        this._orders = null;\r\n        //@ts-ignore\r\n        this._indexes = null;\r\n        //@ts-ignore\r\n        this._colors = null;\r\n\r\n        this._verticesHigh = [];\r\n        this._verticesLow = [];\r\n        this._orders = [];\r\n        this._indexes = [];\r\n        this._colors = [];\r\n\r\n        this._deleteBuffers();\r\n\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    public setPickingColor3v(color: Vec3) {\r\n        this._pickingColor[0] = color.x / 255.0;\r\n        this._pickingColor[1] = color.y / 255.0;\r\n        this._pickingColor[2] = color.z / 255.0;\r\n    }\r\n\r\n    /**\r\n     * Returns polyline geodetic extent.\r\n     * @public\r\n     * @returns {Extent} - Geodetic extent\r\n     */\r\n    public getExtent(): Extent {\r\n        return this._extent.clone();\r\n    }\r\n\r\n    /**\r\n     * Returns path cartesian coordinates.\r\n     * @return {SegmentPath3vExt[]} Polyline path.\r\n     */\r\n    public getPath3v(): SegmentPath3vExt[] {\r\n        return this._path3v;\r\n    }\r\n\r\n    /**\r\n     * Returns geodetic path coordinates.\r\n     * @return {SegmentPathLonLatExt[]} Polyline path.\r\n     */\r\n    public getPathLonLat(): SegmentPathLonLatExt[] {\r\n        return this._pathLonLat;\r\n    }\r\n\r\n    public getPathColors(): NumberArray4[][] {\r\n        return this._pathColors;\r\n    }\r\n\r\n    /**\r\n     * Sets polyline colors.\r\n     * @todo - Test the function.\r\n     * @param {NumberArray4[][]} pathColors\r\n     */\r\n    setPathColors(pathColors: SegmentPathColor[]) {\r\n        if (pathColors) {\r\n            this._colors = [];\r\n            this._pathColors = ([] as SegmentPathColor[]).concat(pathColors);\r\n            Polyline.setPathColors(\r\n                this._pathLonLat,\r\n                pathColors,\r\n                this._defaultColor as NumberArray4,\r\n                this._colors\r\n            );\r\n            // Mark the colors buffer as changed\r\n            this._changedBuffers[COLORS_BUFFER] = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets polyline color\r\n     * @param {string} htmlColor- HTML color\r\n     */\r\n    public setColorHTML(htmlColor: string) {\r\n        this._defaultColor = htmlColorToFloat32Array(htmlColor);\r\n\r\n        let color = htmlColorToRgba(htmlColor),\r\n            p = this._pathColors;\r\n\r\n        for (let i = 0, len = p.length; i < len; i++) {\r\n            let s = p[i];\r\n            for (let j = 0, slen = s.length; j < slen; j++) {\r\n                s[j][0] = color.x;\r\n                s[j][1] = color.y;\r\n                s[j][2] = color.z;\r\n                s[j][3] = color.w;\r\n            }\r\n        }\r\n\r\n        let c = this._colors;\r\n        for (let i = 0, len = c.length; i < len; i += 4) {\r\n            c[i] = color.x;\r\n            c[i + 1] = color.y;\r\n            c[i + 2] = color.z;\r\n            c[i + 3] = color.w;\r\n        }\r\n\r\n        this._changedBuffers[COLORS_BUFFER] = true;\r\n    }\r\n\r\n    public setPathLonLatFast(pathLonLat: SegmentPathLonLatExt[], pathColors?: SegmentPathColor[]) {\r\n        this.setPathLonLat(pathLonLat, pathColors, true);\r\n    }\r\n\r\n    public setPath3vFast(path3v: SegmentPath3vExt[], pathColors?: SegmentPathColor[]) {\r\n        this.setPath3v(path3v, pathColors, true);\r\n    }\r\n\r\n    /**\r\n     * Sets polyline geodetic coordinates.\r\n     * @public\r\n     * @param {SegmentPathLonLat[]} pathLonLat - Polyline path cartesian coordinates.\r\n     * @param {Boolean} [forceEqual=false] - OPTIMIZATION FLAG: Makes assigning faster for size equal coordinates array.\r\n     */\r\n    public setPathLonLat(pathLonLat: SegmentPathLonLatExt[], pathColors?: SegmentPathColor[], forceEqual: boolean = false) {\r\n\r\n        if (pathColors) {\r\n            this._pathColors = ([] as SegmentPathColor[]).concat(pathColors);\r\n        }\r\n\r\n        if (this._renderNode && (this._renderNode as Planet).ellipsoid) {\r\n            if (forceEqual) {\r\n                this._setEqualPathLonLat(pathLonLat as SegmentPathLonLat[]);\r\n                this._changedBuffers[VERTICES_BUFFER] = true;\r\n                this._changedBuffers[COLORS_BUFFER] = true;\r\n            } else {\r\n                this._createDataLonLat(pathLonLat);\r\n                this._changedBuffers[VERTICES_BUFFER] = true;\r\n                this._changedBuffers[INDEX_BUFFER] = true;\r\n                this._changedBuffers[COLORS_BUFFER] = true;\r\n            }\r\n        } else {\r\n            this._pathLonLat = ([] as SegmentPathLonLatExt[]).concat(pathLonLat);\r\n        }\r\n    }\r\n\r\n    public getSize(index: number = 0): number {\r\n        return this._path3v[index].length;\r\n    }\r\n\r\n    /**\r\n     * Sets Polyline cartesian coordinates.\r\n     * @public\r\n     * @param {SegmentPath3vExt[]} path3v - Polyline path cartesian coordinates. (exactly 3 entries)\r\n     * @param {SegmentPathColor[]} [pathColors] - Polyline path cartesian coordinates. (exactly 3 entries)\r\n     * @param {Boolean} [forceEqual=false] - Makes assigning faster for size equal coordinates array.\r\n     */\r\n    public setPath3v(path3v: SegmentPath3vExt[], pathColors?: SegmentPathColor[], forceEqual: boolean = false) {\r\n        if (pathColors) {\r\n            this._pathColors = ([] as SegmentPathColor[]).concat(pathColors);\r\n        }\r\n\r\n        if (this._renderNode) {\r\n            if (forceEqual) {\r\n                this._setEqualPath3v(path3v);\r\n                this._changedBuffers[VERTICES_BUFFER] = true;\r\n                this._changedBuffers[COLORS_BUFFER] = true;\r\n            } else {\r\n                this._createData3v(path3v);\r\n                this._changedBuffers[VERTICES_BUFFER] = true;\r\n                this._changedBuffers[INDEX_BUFFER] = true;\r\n                this._changedBuffers[COLORS_BUFFER] = true;\r\n            }\r\n        } else {\r\n            this._path3v = ([] as SegmentPath3vExt[]).concat(path3v);\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        if (this.visibility && this._path3v.length) {\r\n            this._update();\r\n\r\n            let rn = this._renderNode!;\r\n            let r = rn.renderer!;\r\n            let sh = r.handler.programs.polyline_screen;\r\n            let p = sh._program;\r\n            let gl = r.handler.gl!,\r\n                sha = p.attributes,\r\n                shu = p.uniforms;\r\n\r\n            let ec = this._handler!._entityCollection;\r\n\r\n            sh.activate();\r\n\r\n            gl.disable(gl.CULL_FACE);\r\n            gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n            gl.uniformMatrix4fv(shu.proj, false, r.activeCamera!.getProjectionMatrix());\r\n            gl.uniformMatrix4fv(shu.view, false, r.activeCamera!.getViewMatrix());\r\n\r\n            // gl.uniform4fv(shu.color, [this.color.x, this.color.y, this.color.z, this.color.w * this._handler._entityCollection._fadingOpacity]);\r\n\r\n            gl.uniform3fv(shu.rtcEyePositionHigh, this._handler!._rtcEyePositionHigh);\r\n            gl.uniform3fv(shu.rtcEyePositionLow, this._handler!._rtcEyePositionLow);\r\n\r\n            gl.uniform4fv(shu.visibleSphere, this._visibleSphere);\r\n\r\n            //gl.uniform2fv(shu.uFloatParams, [(rn as Planet)._planetRadius2 || 0.0, r.activeCamera!._tanViewAngle_hradOneByHeight]);\r\n            gl.uniform2fv(shu.viewport, [r.handler.canvas!.width, r.handler.canvas!.height]);\r\n            gl.uniform1f(shu.thickness, this.thickness * 0.5);\r\n            gl.uniform1f(shu.opacity, this._opacity * ec._fadingOpacity);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._colorsBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.color, this._colorsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            let v = this._verticesHighBuffer!;\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\r\n            gl.vertexAttribPointer(sha.prevHigh, v.itemSize, gl.FLOAT, false, 12, 0);\r\n            gl.vertexAttribPointer(sha.currentHigh, v.itemSize, gl.FLOAT, false, 12, 48);\r\n            gl.vertexAttribPointer(sha.nextHigh, v.itemSize, gl.FLOAT, false, 12, 96);\r\n\r\n            v = this._verticesLowBuffer!;\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\r\n            gl.vertexAttribPointer(sha.prevLow, v.itemSize, gl.FLOAT, false, 12, 0);\r\n            gl.vertexAttribPointer(sha.currentLow, v.itemSize, gl.FLOAT, false, 12, 48);\r\n            gl.vertexAttribPointer(sha.nextLow, v.itemSize, gl.FLOAT, false, 12, 96);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._ordersBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.order, this._ordersBuffer!.itemSize, gl.FLOAT, false, 4, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexesBuffer as WebGLBuffer);\r\n            gl.drawElements(gl.TRIANGLE_STRIP, this._indexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n\r\n            gl.enable(gl.CULL_FACE);\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this.visibility && this._path3v.length) {\r\n            let rn = this._renderNode!;\r\n            let r = rn.renderer!;\r\n            let sh = r.handler.programs.polyline_picking;\r\n            let p = sh._program;\r\n            let gl = r.handler.gl!,\r\n                sha = p.attributes,\r\n                shu = p.uniforms;\r\n\r\n            let ec = this._handler!._entityCollection;\r\n\r\n            sh.activate();\r\n\r\n            gl.disable(gl.CULL_FACE);\r\n\r\n            gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n            gl.uniformMatrix4fv(shu.proj, false, r.activeCamera!.getProjectionMatrix());\r\n            gl.uniformMatrix4fv(shu.view, false, r.activeCamera!.getViewMatrix());\r\n\r\n            gl.uniform4fv(shu.color, [\r\n                this._pickingColor[0],\r\n                this._pickingColor[1],\r\n                this._pickingColor[2],\r\n                1.0\r\n            ]);\r\n\r\n            gl.uniform3fv(shu.rtcEyePositionHigh, this._handler!._rtcEyePositionHigh);\r\n            gl.uniform3fv(shu.rtcEyePositionLow, this._handler!._rtcEyePositionLow);\r\n\r\n            gl.uniform4fv(shu.visibleSphere, this._visibleSphere);\r\n\r\n            gl.uniform2fv(shu.viewport, [r.handler.canvas!.width, r.handler.canvas!.height]);\r\n            gl.uniform1f(shu.thickness, this.thickness * 0.5 * ec.pickingScale[0]);\r\n\r\n            let v = this._verticesHighBuffer!;\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\r\n            gl.vertexAttribPointer(sha.prevHigh, v.itemSize, gl.FLOAT, false, 12, 0);\r\n            gl.vertexAttribPointer(sha.currentHigh, v.itemSize, gl.FLOAT, false, 12, 48);\r\n            gl.vertexAttribPointer(sha.nextHigh, v.itemSize, gl.FLOAT, false, 12, 96);\r\n\r\n            v = this._verticesLowBuffer!;\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\r\n            gl.vertexAttribPointer(sha.prevLow, v.itemSize, gl.FLOAT, false, 12, 0);\r\n            gl.vertexAttribPointer(sha.currentLow, v.itemSize, gl.FLOAT, false, 12, 48);\r\n            gl.vertexAttribPointer(sha.nextLow, v.itemSize, gl.FLOAT, false, 12, 96);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._ordersBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(sha.order, this._ordersBuffer!.itemSize, gl.FLOAT, false, 4, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexesBuffer as WebGLBuffer);\r\n            gl.drawElements(gl.TRIANGLE_STRIP, this._indexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n\r\n            gl.enable(gl.CULL_FACE);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh buffers.\r\n     * @protected\r\n     */\r\n    protected _refresh() {\r\n        let i = this._changedBuffers.length;\r\n        while (i--) {\r\n            this._changedBuffers[i] = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates render buffers.\r\n     * @protected\r\n     */\r\n    protected _update() {\r\n        if (this._renderNode) {\r\n            let i = this._changedBuffers.length;\r\n            while (i--) {\r\n                if (this._changedBuffers[i]) {\r\n                    this._buffersUpdateCallbacks[i].call(this);\r\n                    this._changedBuffers[i] = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear GL buffers.\r\n     * @public\r\n     */\r\n    public _deleteBuffers() {\r\n        if (this._renderNode) {\r\n            let r = this._renderNode.renderer!,\r\n                gl = r.handler.gl!;\r\n\r\n            gl.deleteBuffer(this._verticesHighBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._verticesLowBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._ordersBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._indexesBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._colorsBuffer as WebGLBuffer);\r\n\r\n            this._verticesHighBuffer = null;\r\n            this._verticesLowBuffer = null;\r\n            this._ordersBuffer = null;\r\n            this._indexesBuffer = null;\r\n            this._colorsBuffer = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates vertices buffers.\r\n     * @protected\r\n     */\r\n    protected _createVerticesBuffer() {\r\n        let h = this._renderNode!.renderer!.handler;\r\n\r\n        let numItems = this._verticesHigh.length / 3;\r\n\r\n        if (!this._verticesHighBuffer || this._verticesHighBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._verticesHighBuffer as WebGLBuffer);\r\n            h.gl!.deleteBuffer(this._verticesLowBuffer as WebGLBuffer);\r\n            this._verticesHighBuffer = h.createStreamArrayBuffer(3, numItems);\r\n            this._verticesLowBuffer = h.createStreamArrayBuffer(3, numItems);\r\n        }\r\n\r\n        this._verticesHigh = makeArrayTyped(this._verticesHigh);\r\n        this._verticesLow = makeArrayTyped(this._verticesLow);\r\n\r\n        h.setStreamArrayBuffer(this._verticesHighBuffer!, this._verticesHigh as Float32Array);\r\n        h.setStreamArrayBuffer(this._verticesLowBuffer!, this._verticesLow as Float32Array);\r\n    }\r\n\r\n    /**\r\n     * Creates gl index and order buffer.\r\n     * @protected\r\n     */\r\n    protected _createIndexBuffer() {\r\n        let h = this._renderNode!.renderer!.handler;\r\n        h.gl!.deleteBuffer(this._ordersBuffer as WebGLBuffer);\r\n        h.gl!.deleteBuffer(this._indexesBuffer as WebGLBuffer);\r\n\r\n        this._orders = makeArrayTyped(this._orders);\r\n        this._ordersBuffer = h.createArrayBuffer(this._orders as Uint8Array, 1, this._orders.length / 2);\r\n\r\n        this._indexes = makeArrayTyped(this._indexes, Uint32Array);\r\n        this._indexesBuffer = h.createElementArrayBuffer(this._indexes as Uint32Array, 1, this._indexes.length);\r\n    }\r\n\r\n    protected _createColorsBuffer() {\r\n        let h = this._renderNode!.renderer!.handler;\r\n        h.gl!.deleteBuffer(this._colorsBuffer as WebGLBuffer);\r\n\r\n        this._colors = makeArrayTyped(this._colors);\r\n        this._colorsBuffer = h.createArrayBuffer(new Float32Array(this._colors), 4, this._colors.length / 4);\r\n    }\r\n\r\n    public setVisibleSphere(p: Vec3, r: number) {\r\n        if (this._handler) {\r\n            this._visibleSphere[0] = p.x - this._handler._relativeCenter.x;\r\n            this._visibleSphere[1] = p.y - this._handler._relativeCenter.y;\r\n            this._visibleSphere[2] = p.z - this._handler._relativeCenter.z;\r\n        }\r\n        this._visibleSphere[3] = r;\r\n    }\r\n\r\n    public updateRTCPosition() {\r\n        if (this._handler && this._renderNode) {\r\n            this._visibleSphere[0] = this._visibleSphere[0] - this._handler._relativeCenter.x;\r\n            this._visibleSphere[1] = this._visibleSphere[1] - this._handler._relativeCenter.y;\r\n            this._visibleSphere[2] = this._visibleSphere[2] - this._handler._relativeCenter.z;\r\n            this._setEqualPath3v(this._path3v);\r\n        }\r\n        this._changedBuffers[VERTICES_BUFFER] = true;\r\n    }\r\n\r\n}\r\n\r\nexport {Polyline};\r\n","import * as utils from \"../utils/shared\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {Entity} from \"./Entity\";\r\nimport {RayHandler} from \"./RayHandler\";\r\n\r\nexport interface IRayParams {\r\n    thickness?: number;\r\n    startPosition?: Vec3 | NumberArray3;\r\n    endPosition?: Vec3 | NumberArray3;\r\n    startColor?: string | NumberArray4;\r\n    endColor?: string | NumberArray4;\r\n    visibility?: boolean;\r\n\r\n}\r\n\r\n/**\r\n * Ray class.\r\n * @class\r\n * @param {Object} [options] - Options:\r\n * @param {Vec3|Array.<number>} [options.startPosition] - Ray start point position.\r\n * @param {Vec3|Array.<number>} [options.endPosition] - Ray end point position.\r\n * @param {Vec3|Array.<number>} [options.startColor] - Ray start point color.\r\n * @param {Vec3|Array.<number>} [options.endColor] - Ray end point color.\r\n * @param {boolean} [options.visibility] - Visibility.\r\n */\r\nclass Ray {\r\n\r\n    static __counter__: number = 0;\r\n    /**\r\n     * Object uniq identifier.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected __id: number;\r\n\r\n    public _thickness: number;\r\n\r\n    protected _startPosition: Vec3;\r\n    public _startPositionHigh: Vec3;\r\n    public _startPositionLow: Vec3;\r\n\r\n    // RTE end position\r\n    protected _endPosition: Vec3;\r\n    public _endPositionHigh: Vec3;\r\n    public _endPositionLow: Vec3;\r\n\r\n    // start end point colors\r\n    public _startColor: Vec4;\r\n    public _endColor: Vec4;\r\n\r\n    /**\r\n     * Ray visibility.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _visibility: boolean;\r\n\r\n    /**\r\n     * Entity instance that holds this billboard.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public _entity: Entity | null;\r\n\r\n    /**\r\n     * Handler that stores and renders this billboard object.\r\n     * @public\r\n     * @type {BillboardHandler}\r\n     */\r\n    public _handler: RayHandler | null;\r\n\r\n    /**\r\n     * Billboard handler array index.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _handlerIndex: number;\r\n\r\n    constructor(options: IRayParams = {}) {\r\n\r\n        this.__id = Ray.__counter__++;\r\n\r\n        this._thickness = options.thickness || 2.0;\r\n\r\n        this._startPosition = utils.createVector3(options.startPosition);\r\n        this._startPositionHigh = new Vec3();\r\n        this._startPositionLow = new Vec3();\r\n        Vec3.doubleToTwoFloats(\r\n            this._startPosition,\r\n            this._startPositionHigh,\r\n            this._startPositionLow\r\n        );\r\n\r\n        this._endPosition = utils.createVector3(options.endPosition);\r\n        this._endPositionHigh = new Vec3();\r\n        this._endPositionLow = new Vec3();\r\n        Vec3.doubleToTwoFloats(this._endPosition, this._endPositionHigh, this._endPositionLow);\r\n\r\n        this._startColor = utils.createColorRGBA(options.startColor);\r\n        this._endColor = utils.createColorRGBA(options.endColor);\r\n\r\n        this._visibility = options.visibility != undefined ? options.visibility : true;\r\n\r\n        this._entity = null;\r\n\r\n        this._handler = null;\r\n\r\n        this._handlerIndex = -1;\r\n    }\r\n\r\n    /**\r\n     * Sets ray start position.\r\n     * @public\r\n     * @param {number} x - X coordinate.\r\n     * @param {number} y - Y coordinate.\r\n     * @param {number} z - Z coordinate.\r\n     */\r\n    public setStartPosition(x: number, y: number, z: number) {\r\n        this._startPosition.x = x;\r\n        this._startPosition.y = y;\r\n        this._startPosition.z = z;\r\n        Vec3.doubleToTwoFloats(\r\n            this._startPosition,\r\n            this._startPositionHigh,\r\n            this._startPositionLow\r\n        );\r\n        this._handler &&\r\n        this._handler.setStartPositionArr(\r\n            this._handlerIndex,\r\n            this._startPositionHigh,\r\n            this._startPositionLow\r\n        );\r\n    }\r\n\r\n    public getLength(): number {\r\n        return this._startPosition.distance(this._endPosition);\r\n    }\r\n\r\n    /**\r\n     * Sets ray start position.\r\n     * @public\r\n     * @param {Vec3} position - Cartesian coordinates.\r\n     */\r\n    public setStartPosition3v(position: Vec3) {\r\n        this._startPosition.x = position.x;\r\n        this._startPosition.y = position.y;\r\n        this._startPosition.z = position.z;\r\n        Vec3.doubleToTwoFloats(\r\n            this._startPosition,\r\n            this._startPositionHigh,\r\n            this._startPositionLow\r\n        );\r\n        this._handler &&\r\n        this._handler.setStartPositionArr(\r\n            this._handlerIndex,\r\n            this._startPositionHigh,\r\n            this._startPositionLow\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Sets ray end position.\r\n     * @public\r\n     * @param {number} x - X coordinate.\r\n     * @param {number} y - Y coordinate.\r\n     * @param {number} z - Z coordinate.\r\n     */\r\n    public setEndPosition(x: number, y: number, z: number) {\r\n        this._endPosition.x = x;\r\n        this._endPosition.y = y;\r\n        this._endPosition.z = z;\r\n        Vec3.doubleToTwoFloats(this._endPosition, this._endPositionHigh, this._endPositionLow);\r\n        this._handler &&\r\n        this._handler.setEndPositionArr(\r\n            this._handlerIndex,\r\n            this._endPositionHigh,\r\n            this._endPositionLow\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Sets ray end position.\r\n     * @public\r\n     * @param {Vec3} position - Cartesian coordinates.\r\n     */\r\n    public setEndPosition3v(position: Vec3) {\r\n        this._endPosition.x = position.x;\r\n        this._endPosition.y = position.y;\r\n        this._endPosition.z = position.z;\r\n        Vec3.doubleToTwoFloats(this._endPosition, this._endPositionHigh, this._endPositionLow);\r\n        this._handler &&\r\n        this._handler.setEndPositionArr(\r\n            this._handlerIndex,\r\n            this._endPositionHigh,\r\n            this._endPositionLow\r\n        );\r\n    }\r\n\r\n    public setThickness(thickness: number) {\r\n        this._thickness = thickness;\r\n        this._handler && this._handler.setThicknessArr(this._handlerIndex, thickness);\r\n    }\r\n\r\n    public setColors4v(startColor?: Vec4, endColor?: Vec4) {\r\n        if (startColor) {\r\n            this._startColor.x = startColor.x;\r\n            this._startColor.y = startColor.y;\r\n            this._startColor.z = startColor.z;\r\n            this._startColor.w = startColor.w;\r\n        }\r\n\r\n        if (endColor) {\r\n            this._endColor.x = endColor.x;\r\n            this._endColor.y = endColor.y;\r\n            this._endColor.z = endColor.z;\r\n            this._endColor.w = endColor.w;\r\n        }\r\n\r\n        this._handler &&\r\n        this._handler.setRgbaArr(this._handlerIndex, this._startColor, this._endColor);\r\n    }\r\n\r\n    public setColorsHTML(startColor?: string, endColor?: string) {\r\n        if (startColor) {\r\n            this._startColor = utils.htmlColorToRgba(startColor);\r\n        }\r\n\r\n        if (endColor) {\r\n            this._endColor = utils.htmlColorToRgba(endColor);\r\n        }\r\n\r\n        this._handler && this._handler.setRgbaArr(this._handlerIndex, this._startColor, this._endColor);\r\n    }\r\n\r\n    /**\r\n     * Returns ray start position.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getStartPosition(): Vec3 {\r\n        return this._startPosition;\r\n    }\r\n\r\n    /**\r\n     * Returns ray end position.\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getEndPosition(): Vec3 {\r\n        return this._endPosition;\r\n    }\r\n\r\n    /**\r\n     * Sets visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Visibility flag.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this._visibility = visibility;\r\n        this._handler && this._handler.setVisibility(this._handlerIndex, visibility);\r\n    }\r\n\r\n    /**\r\n     * Returns visibility.\r\n     * @public\r\n     * @returns {boolean}\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    /**\r\n     * Remove from handler.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._entity = null;\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    /**\r\n     * Set picking color.\r\n     * @public\r\n     * @param {Vec3} color - Picking color.\r\n     */\r\n    public setPickingColor3v(color: Vec3) {\r\n        this._handler && this._handler.setPickingColorArr(this._handlerIndex, color);\r\n    }\r\n}\r\n\r\nexport {Ray};\r\n","import * as utils from \"../utils/shared\";\r\nimport {Entity} from \"./Entity\";\r\nimport {Line3} from \"../math/Line3\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {StripHandler} from \"./StripHandler\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\n\r\ntype TPoiExt = Vec3 | NumberArray3;\r\ntype TStripExt = [TPoiExt, TPoiExt];\r\n\r\ntype TPoi = Vec3;\r\ntype TStrip = [TPoi, TPoi];\r\n\r\n//type TStrip = TEdge[];\r\nexport interface IStripParams {\r\n    visibility?: boolean;\r\n    color?: string | NumberArray4 | Vec4;\r\n    opacity?: number;\r\n    path?: TStrip[];\r\n}\r\n\r\nlet _tempHigh = new Vec3(),\r\n    _tempLow = new Vec3();\r\n\r\n/**\r\n * Strip object.\r\n * @class\r\n * @param {*} [options] - Strip options:\r\n * @param {boolean} [options.visibility] - Strip visibility.\r\n * @example <caption>Stripe example</caption>\r\n * new og.Entity({\r\n *     strip: {\r\n *         gridSize: 10,\r\n *         path: [\r\n *             [[],[]],\r\n *             [[],[]]\r\n *         ]\r\n *     }\r\n * });\r\n */\r\nclass Strip {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Strip visibility.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public visibility: boolean;\r\n\r\n    public color: Float32Array;\r\n\r\n    /**\r\n     * Parent collection render node.\r\n     * @protected\r\n     * @type {RenderNode}\r\n     */\r\n    protected _renderNode: RenderNode | null;\r\n\r\n    /**\r\n     * Entity instance that holds this strip.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public _entity: Entity | null;\r\n    protected _verticesHighBuffer: WebGLBufferExt | null;\r\n    protected _verticesLowBuffer: WebGLBufferExt | null;\r\n    protected _indexBuffer: WebGLBufferExt | null;\r\n    protected _verticesHigh: number[];\r\n    protected _verticesLow: number[];\r\n    protected _indexes: number[];\r\n    protected _path: TStrip[];\r\n\r\n    protected _pickingColor: Float32Array;\r\n\r\n    protected _gridSize: number;\r\n\r\n    /**\r\n     * Handler that stores and renders this object.\r\n     * @public\r\n     * @type {StripHandler | null}\r\n     */\r\n    public _handler: StripHandler | null;\r\n    public _handlerIndex: number;\r\n\r\n    constructor(options: IStripParams = {}) {\r\n\r\n        this.__id = Strip.__counter__++;\r\n\r\n        this.visibility = options.visibility != undefined ? options.visibility : true;\r\n\r\n        this.color = new Float32Array([1.0, 1.0, 1.0, 0.5]);\r\n\r\n        if (options.color) {\r\n            let color = utils.createColorRGBA(options.color);\r\n            this.setColor(color.x, color.y, color.z, color.w);\r\n        }\r\n\r\n        if (options.opacity) {\r\n            this.setOpacity(options.opacity);\r\n        }\r\n\r\n        /**\r\n         * Parent collection render node.\r\n         * @protected\r\n         * @type {RenderNode}\r\n         */\r\n        this._renderNode = null;\r\n\r\n        /**\r\n         * Entity instance that holds this strip.\r\n         * @protected\r\n         * @type {Entity}\r\n         */\r\n        this._entity = null;\r\n\r\n        this._verticesHighBuffer = null;\r\n        this._verticesLowBuffer = null;\r\n\r\n        this._indexBuffer = null;\r\n\r\n        this._verticesHigh = [];\r\n        this._verticesLow = [];\r\n\r\n        this._indexes = [];\r\n\r\n        this._path = [];\r\n\r\n        this._pickingColor = new Float32Array(4);\r\n\r\n        this._gridSize = 1;\r\n\r\n        /**\r\n         * Handler that stores and renders this object.\r\n         * @protected\r\n         * @type {StripHandler}\r\n         */\r\n        this._handler = null;\r\n        this._handlerIndex = -1;\r\n\r\n        if (options.path) {\r\n            this.setPath(options.path);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Assign picking color.\r\n     * @public\r\n     * @param {Vec3} color - Picking RGB color.\r\n     */\r\n    public setPickingColor3v(color: Vec3) {\r\n        this._pickingColor[0] = color.x / 255.0;\r\n        this._pickingColor[1] = color.y / 255.0;\r\n        this._pickingColor[2] = color.z / 255.0;\r\n        this._pickingColor[3] = 1.0;\r\n    }\r\n\r\n    /**\r\n     * Clears object\r\n     * @public\r\n     */\r\n    public clear() {\r\n        this._path.length = 0;\r\n        this._path = [];\r\n\r\n        this._verticesHigh.length = 0;\r\n        this._verticesHigh = [];\r\n\r\n        this._verticesLow.length = 0;\r\n        this._verticesLow = [];\r\n\r\n        this._indexes.length = 0;\r\n        this._indexes = [];\r\n\r\n        this._deleteBuffers();\r\n    }\r\n\r\n    /**\r\n     * Sets RGBA color. Each channel from 0.0 to 1.0.\r\n     * @public\r\n     * @param {Vec4} color - RGBA vector.\r\n     */\r\n    public setColor4v(color: Vec4) {\r\n        this.setColor(color.x, color.y, color.z, color.w);\r\n    }\r\n\r\n    /**\r\n     * Sets strip color.\r\n     * @public\r\n     * @param {string} color - HTML style color.\r\n     */\r\n    public setColorHTML(color: string) {\r\n        this.setColor4v(utils.htmlColorToRgba(color));\r\n    }\r\n\r\n    public setColor(r: number, g: number, b: number, a?: number) {\r\n        a = a || this.color[3];\r\n        this.color[0] = r;\r\n        this.color[1] = g;\r\n        this.color[2] = b;\r\n        this.color[3] = a;\r\n    }\r\n\r\n    /**\r\n     * Set strip opacity.\r\n     * @public\r\n     * @param {number} opacity - opacity.\r\n     */\r\n    public setOpacity(opacity: number) {\r\n        this.color[3] = opacity || 0;\r\n    }\r\n\r\n    /**\r\n     * Sets cloud visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Visibility flag.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this.visibility = visibility;\r\n    }\r\n\r\n    /**\r\n     * @return {boolean} Strip visibility.\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this.visibility;\r\n    }\r\n\r\n    /**\r\n     * Assign rendering scene node.\r\n     * @public\r\n     * @param {RenderNode}  renderNode - Assigned render node.\r\n     */\r\n    public setRenderNode(renderNode: RenderNode) {\r\n        this._renderNode = renderNode;\r\n        this._createBuffers();\r\n    }\r\n\r\n    /**\r\n     * Removes from entity.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._entity = null;\r\n        this._handler && this._handler.remove(this);\r\n    }\r\n\r\n    public draw() {\r\n        if (this.visibility && this._verticesHigh.length) {\r\n            let r = this._renderNode!.renderer!;\r\n\r\n            let gl = r.handler.gl!;\r\n\r\n            let sh = r.handler.programs.strip,\r\n                p = sh._program,\r\n                sha = p.attributes,\r\n                shu = p.uniforms;\r\n\r\n            sh.activate();\r\n\r\n            gl.disable(gl.CULL_FACE);\r\n\r\n            gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera!.getViewMatrix());\r\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera!.getProjectionMatrix());\r\n\r\n            gl.uniform3fv(shu.eyePositionHigh, r.activeCamera!.eyeHigh);\r\n            gl.uniform3fv(shu.eyePositionLow, r.activeCamera!.eyeLow);\r\n\r\n            gl.uniform4fv(shu.uColor, this.color);\r\n\r\n            gl.uniform1f(shu.uOpacity, this._entity!._entityCollection!._fadingOpacity);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesHighBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(\r\n                sha.aVertexPositionHigh,\r\n                this._verticesHighBuffer!.itemSize,\r\n                gl.FLOAT,\r\n                false,\r\n                0,\r\n                0\r\n            );\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesLowBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(\r\n                sha.aVertexPositionLow,\r\n                this._verticesLowBuffer!.itemSize,\r\n                gl.FLOAT,\r\n                false,\r\n                0,\r\n                0\r\n            );\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer as WebGLBuffer);\r\n            gl.drawElements(\r\n                r.handler.gl!.TRIANGLE_STRIP,\r\n                this._indexBuffer!.numItems,\r\n                gl.UNSIGNED_INT,\r\n                0\r\n            );\r\n\r\n            gl.enable(gl.CULL_FACE);\r\n        }\r\n    }\r\n\r\n    drawPicking() {\r\n        if (this.visibility && this._verticesHigh.length) {\r\n            let r = this._renderNode!.renderer!;\r\n\r\n            let gl = r.handler.gl!;\r\n\r\n            let sh = r.handler.programs.strip,\r\n                p = sh._program,\r\n                sha = p.attributes,\r\n                shu = p.uniforms;\r\n\r\n            sh.activate();\r\n\r\n            gl.disable(gl.CULL_FACE);\r\n\r\n            gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera!.getViewMatrix());\r\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera!.getProjectionMatrix());\r\n\r\n            gl.uniform3fv(shu.eyePositionHigh, r.activeCamera!.eyeHigh);\r\n            gl.uniform3fv(shu.eyePositionLow, r.activeCamera!.eyeLow);\r\n\r\n            gl.uniform1f(shu.uOpacity, this._entity!._entityCollection!._fadingOpacity != 0 ? 1 : 0);\r\n\r\n            gl.uniform4fv(shu.uColor, this._pickingColor);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesHighBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(\r\n                sha.aVertexPositionHigh,\r\n                this._verticesHighBuffer!.itemSize,\r\n                gl.FLOAT,\r\n                false,\r\n                0,\r\n                0\r\n            );\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesLowBuffer as WebGLBuffer);\r\n            gl.vertexAttribPointer(\r\n                sha.aVertexPositionLow,\r\n                this._verticesLowBuffer!.itemSize,\r\n                gl.FLOAT,\r\n                false,\r\n                0,\r\n                0\r\n            );\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer as WebGLBuffer);\r\n            gl.drawElements(\r\n                r.handler.gl!.TRIANGLE_STRIP,\r\n                this._indexBuffer!.numItems,\r\n                gl.UNSIGNED_INT,\r\n                0\r\n            );\r\n\r\n            gl.enable(gl.CULL_FACE);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Delete buffers\r\n     * @public\r\n     */\r\n    public _deleteBuffers() {\r\n        if (this._renderNode && this._renderNode.renderer) {\r\n            let r = this._renderNode.renderer,\r\n                gl = r.handler.gl!;\r\n\r\n            gl.deleteBuffer(this._indexBuffer!);\r\n            gl.deleteBuffer(this._verticesHighBuffer!);\r\n            gl.deleteBuffer(this._verticesLowBuffer!);\r\n        }\r\n        this._verticesHighBuffer = null;\r\n        this._verticesLowBuffer = null;\r\n        this._indexBuffer = null;\r\n    }\r\n\r\n    protected _createBuffers() {\r\n        if (this._renderNode && this._renderNode.renderer && this._renderNode.renderer.isInitialized()) {\r\n            let gl = this._renderNode.renderer.handler.gl!;\r\n\r\n            gl.deleteBuffer(this._indexBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._verticesHighBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._verticesLowBuffer as WebGLBuffer);\r\n\r\n            this._verticesHighBuffer = this._renderNode.renderer.handler.createArrayBuffer(\r\n                new Float32Array(this._verticesHigh),\r\n                3,\r\n                this._verticesHigh.length / 3\r\n            );\r\n            this._verticesLowBuffer = this._renderNode.renderer.handler.createArrayBuffer(\r\n                new Float32Array(this._verticesLow),\r\n                3,\r\n                this._verticesLow.length / 3\r\n            );\r\n            this._indexBuffer = this._renderNode.renderer.handler.createElementArrayBuffer(\r\n                new Uint32Array(this._indexes),\r\n                1,\r\n                this._indexes.length\r\n            );\r\n        }\r\n    }\r\n\r\n    public addEdge3v(p2: Vec3, p3: Vec3) {\r\n        let length = this._path.length;\r\n\r\n        if (length === 0) {\r\n            this._path.push([p2.clone(), p3.clone()]);\r\n        } else {\r\n            let p0 = this._path[length - 1][0],\r\n                p1 = this._path[length - 1][1];\r\n\r\n            this._path.push([p2.clone(), p3.clone()]);\r\n\r\n            let vHigh = this._verticesHigh,\r\n                vLow = this._verticesLow;\r\n\r\n            let gs = this._gridSize,\r\n                gs1 = gs + 1;\r\n\r\n            let p = new Vec3();\r\n\r\n            let last = this._verticesHigh.length / 3,\r\n                ind = last;\r\n\r\n            let d = Math.abs(p0.sub(p1).normal().dot(p2.sub(p0).normal()));\r\n\r\n            for (let i = 0; i < gs1; i++) {\r\n                let di = i / gs;\r\n                let p02 = p0.lerp(p2, di),\r\n                    p13 = p1.lerp(p3, di);\r\n\r\n                for (let j = 0; j < gs1; j++) {\r\n                    let dj = j / gs;\r\n                    let p01 = p0.lerp(p1, dj),\r\n                        p23 = p2.lerp(p3, dj);\r\n\r\n                    if (d !== 1.0) {\r\n                        new Line3(p02, p13).intersects(new Line3(p01, p23), p);\r\n                    } else {\r\n                        p = p23;\r\n                    }\r\n\r\n                    ind = last + i * gs1 + j;\r\n\r\n                    Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\r\n\r\n                    let ind3 = ind * 3;\r\n\r\n                    vHigh[ind3] = _tempHigh.x;\r\n                    vHigh[ind3 + 1] = _tempHigh.y;\r\n                    vHigh[ind3 + 2] = _tempHigh.z;\r\n\r\n                    vLow[ind3] = _tempLow.x;\r\n                    vLow[ind3 + 1] = _tempLow.y;\r\n                    vLow[ind3 + 2] = _tempLow.z;\r\n\r\n                    if (i < gs) {\r\n                        this._indexes.push(ind, ind + gs1);\r\n                    }\r\n                }\r\n\r\n                if (i < gs) {\r\n                    this._indexes.push(ind + gs1, ind + 1);\r\n                }\r\n            }\r\n\r\n            this._createBuffers();\r\n        }\r\n    }\r\n\r\n    public setEdge3v(p2: Vec3, p3: Vec3, index: number) {\r\n        if (index === this._path.length) {\r\n            this.addEdge3v(p2, p3);\r\n            return;\r\n        }\r\n        if (this._path[index]) {\r\n            this._path[index][0] = p2;\r\n            this._path[index][1] = p3;\r\n\r\n            if (this._path.length > 1) {\r\n                let gs = this._gridSize,\r\n                    gs1 = gs + 1;\r\n\r\n                let vSize = gs1 * gs1;\r\n\r\n                let p = new Vec3();\r\n\r\n                let vHigh = this._verticesHigh,\r\n                    vLow = this._verticesLow;\r\n\r\n                if (index === this._path.length - 1) {\r\n                    let p0 = this._path[index - 1][0],\r\n                        p1 = this._path[index - 1][1];\r\n\r\n                    let prev = this._verticesHigh.length / 3 - vSize,\r\n                        ind = prev;\r\n\r\n                    let d = Math.abs(p0.sub(p1).normal().dot(p2.sub(p0).normal()));\r\n\r\n                    for (let i = 0; i < gs1; i++) {\r\n                        let di = i / gs;\r\n                        let p02 = p0.lerp(p2, di),\r\n                            p13 = p1.lerp(p3, di);\r\n\r\n                        for (let j = 0; j < gs1; j++) {\r\n                            let dj = j / gs;\r\n                            let p01 = p0.lerp(p1, dj),\r\n                                p23 = p2.lerp(p3, dj);\r\n\r\n                            if (d !== 1.0) {\r\n                                new Line3(p02, p13).intersects(new Line3(p01, p23), p);\r\n                            } else {\r\n                                p = p23;\r\n                            }\r\n\r\n                            ind = prev + i * gs1 + j;\r\n\r\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\r\n\r\n                            let ind3 = ind * 3;\r\n\r\n                            vHigh[ind3] = _tempHigh.x;\r\n                            vHigh[ind3 + 1] = _tempHigh.y;\r\n                            vHigh[ind3 + 2] = _tempHigh.z;\r\n\r\n                            vLow[ind3] = _tempLow.x;\r\n                            vLow[ind3 + 1] = _tempLow.y;\r\n                            vLow[ind3 + 2] = _tempLow.z;\r\n                        }\r\n                    }\r\n                } else if (index === 0) {\r\n                    let ind = 0;\r\n\r\n                    let p0 = p2,\r\n                        p1 = p3;\r\n\r\n                    p2 = this._path[1][0];\r\n                    p3 = this._path[1][1];\r\n\r\n                    for (let i = 0; i < gs1; i++) {\r\n                        let di = i / gs;\r\n                        let p02 = p0.lerp(p2, di),\r\n                            p13 = p1.lerp(p3, di);\r\n\r\n                        for (let j = 0; j < gs1; j++) {\r\n                            let dj = j / gs;\r\n                            let p01 = p0.lerp(p1, dj),\r\n                                p23 = p2.lerp(p3, dj);\r\n\r\n                            new Line3(p02, p13).intersects(new Line3(p01, p23), p);\r\n\r\n                            ind = i * gs1 + j;\r\n\r\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\r\n\r\n                            let ind3 = ind * 3;\r\n\r\n                            vHigh[ind3] = _tempHigh.x;\r\n                            vHigh[ind3 + 1] = _tempHigh.y;\r\n                            vHigh[ind3 + 2] = _tempHigh.z;\r\n\r\n                            vLow[ind3] = _tempLow.x;\r\n                            vLow[ind3 + 1] = _tempLow.y;\r\n                            vLow[ind3 + 2] = _tempLow.z;\r\n                        }\r\n                    }\r\n                } else if (index > 0 && index < this._path.length) {\r\n                    let p0 = this._path[index - 1][0],\r\n                        p1 = this._path[index - 1][1];\r\n\r\n                    let p4 = this._path[index + 1][0],\r\n                        p5 = this._path[index + 1][1];\r\n\r\n                    let next = index * vSize,\r\n                        prev = (index - 1) * vSize,\r\n                        ind = prev;\r\n\r\n                    for (let i = 0; i < gs1; i++) {\r\n                        let di = i / gs;\r\n                        let p02 = p0.lerp(p2, di),\r\n                            p35 = p3.lerp(p5, di),\r\n                            p24 = p2.lerp(p4, di),\r\n                            p13 = p1.lerp(p3, di);\r\n\r\n                        for (let j = 0; j < gs1; j++) {\r\n                            let dj = j / gs;\r\n                            let p01 = p0.lerp(p1, dj),\r\n                                p23 = p2.lerp(p3, dj);\r\n\r\n                            // prev\r\n                            new Line3(p02, p13).intersects(new Line3(p01, p23), p);\r\n\r\n                            let ij = i * gs1 + j;\r\n\r\n                            ind = prev + ij;\r\n\r\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\r\n\r\n                            let ind3 = ind * 3;\r\n\r\n                            vHigh[ind3] = _tempHigh.x;\r\n                            vHigh[ind3 + 1] = _tempHigh.y;\r\n                            vHigh[ind3 + 2] = _tempHigh.z;\r\n\r\n                            vLow[ind3] = _tempLow.x;\r\n                            vLow[ind3 + 1] = _tempLow.y;\r\n                            vLow[ind3 + 2] = _tempLow.z;\r\n\r\n                            // next\r\n                            let p45 = p4.lerp(p5, dj);\r\n\r\n                            p23 = p2.lerp(p3, dj);\r\n\r\n                            new Line3(p24, p35).intersects(new Line3(p23, p45), p);\r\n\r\n                            ind = next + ij;\r\n\r\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\r\n\r\n                            ind3 = ind * 3;\r\n\r\n                            vHigh[ind3] = _tempHigh.x;\r\n                            vHigh[ind3 + 1] = _tempHigh.y;\r\n                            vHigh[ind3 + 2] = _tempHigh.z;\r\n\r\n                            vLow[ind3] = _tempLow.x;\r\n                            vLow[ind3 + 1] = _tempLow.y;\r\n                            vLow[ind3 + 2] = _tempLow.z;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                this._createBuffers();\r\n            }\r\n        } else {\r\n            console.warn(`strip index ${index} is out of range`);\r\n        }\r\n    }\r\n\r\n    public removeEdge(index: number) {\r\n        this._path.splice(index, 1);\r\n        this.setPath(([] as TStrip[]).concat(this._path));\r\n    }\r\n\r\n    public setGridSize(gridSize: number) {\r\n        this._gridSize = gridSize;\r\n        this.setPath(([] as TStrip[]).concat(this._path));\r\n    }\r\n\r\n    public getPath(): TStrip[] {\r\n        return this._path;\r\n    }\r\n\r\n    public setPath(path: TStripExt[] | TStrip[]) {\r\n        this._verticesHigh = [];\r\n        this._verticesLow = [];\r\n        this._indexes = [];\r\n        this._path = [];\r\n\r\n        for (let i = 0; i < path.length; i++) {\r\n            let p0 = path[i][0],\r\n                p1 = path[i][1];\r\n\r\n            if (p0 instanceof Array) {\r\n                p0 = new Vec3(p0[0], p0[1], p0[2]);\r\n            }\r\n\r\n            if (p1 instanceof Array) {\r\n                p1 = new Vec3(p1[0], p1[1], p1[2]);\r\n            }\r\n\r\n            this.addEdge3v(p0 as Vec3, p1 as Vec3);\r\n        }\r\n    }\r\n\r\n    public insertEdge3v(p0: Vec3, p1: Vec3, index: number) {\r\n        if (index < this._path.length) {\r\n            let p: TStrip[] = ([] as TStrip[]).concat(this._path);\r\n            p.splice(index, 0, [p0, p1]);\r\n            this.setPath(p);\r\n        } else if (index === this._path.length) {\r\n            this.addEdge3v(p0, p1);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Strip};\r\n","import * as mercator from \"../mercator\";\r\nimport * as utils from \"../utils/shared\";\r\nimport {Billboard} from \"./Billboard\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport type {IBillboardParams} from \"./Billboard\";\r\nimport type {EntityCollectionEvents} from \"./EntityCollection\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Geometry} from \"./Geometry\";\r\nimport {GeoObject} from \"./GeoObject\";\r\nimport type {IGeometryParams} from \"./Geometry\";\r\nimport type {IGeoObjectParams} from \"./GeoObject\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Label} from \"./Label\";\r\nimport type {ILabelParams} from \"./Label\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {PointCloud} from \"./PointCloud\";\r\nimport {Polyline} from \"./Polyline\";\r\nimport type {IPointCloudParams} from \"./PointCloud\";\r\nimport type {IPolylineParams} from \"./Polyline\";\r\nimport {Ray} from \"./Ray\";\r\nimport type {IRayParams} from \"./Ray\";\r\nimport {Strip} from \"./Strip\";\r\nimport type {IStripParams} from \"./Strip\";\r\nimport {Vector} from \"../layer/Vector\";\r\nimport type {VectorEventsType} from \"../layer/Vector\";\r\nimport {EntityCollectionNode} from \"../quadTree/EntityCollectionNode\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {clamp} from \"../math\";\r\n\r\n/**\r\n * Interface for Entity parameters.\r\n * @typedef {Object} IEntityParams\r\n * @property {string} [name] - Name of the entity.\r\n * @property {any} [properties] - Additional properties of the entity.\r\n * @property {Vec3 | NumberArray3} [cartesian] - Cartesian position.\r\n * @property {LonLat | NumberArray3 | NumberArray2} [lonlat] - Geographic coordinates.\r\n * @property {number} [altitude] - Altitude.\r\n * @property {boolean} [visibility] - Visibility flag.\r\n * @property {Billboard | IBillboardParams} [billboard] - Billboard object or parameters.\r\n * @property {Label | ILabelParams} [label] - Label object or parameters.\r\n * @property {Polyline | IPolylineParams} [polyline] - Polyline object or parameters.\r\n * @property {Ray | IRayParams} [ray] - Ray object or parameters.\r\n * @property {PointCloud | IPointCloudParams} [pointCloud] - Point cloud object or parameters.\r\n * @property {Geometry | IGeometryParams} [geometry] - Geometry object or parameters.\r\n * @property {GeoObject | IGeoObjectParams} [geoObject] - Geo object or parameters.\r\n * @property {Strip | IStripParams} [strip] - Strip object or parameters.\r\n * @property {boolean} [independentPicking] - Independent picking flag.\r\n * @property {boolean} [relativePosition] - Parent relative position flag, otherwise position is absolute.\r\n * @property {number} [pitch] - Rotation around local X-axis.\r\n * @property {number} [yaw] - Rotation around local Y-axis.\r\n * @property {number} [roll] - Rotation around local Z-axis.\r\n * @property {number | Vec3 | NumberArray3} [scale] - Scaling factor.\r\n * @property {boolean} [forceGlobalPosition] - Forces global position for entity make the same position as its parent.\r\n * @property {boolean} [forceGlobalRotation] - Forces global rotation for the entity make the same rotation as its parent.\r\n */\r\nexport interface IEntityParams {\r\n    name?: string;\r\n    properties?: any;\r\n    cartesian?: Vec3 | NumberArray3;\r\n    lonlat?: LonLat | NumberArray3 | NumberArray2;\r\n    altitude?: number;\r\n    visibility?: boolean;\r\n    billboard?: Billboard | IBillboardParams;\r\n    label?: Label | ILabelParams;\r\n    polyline?: Polyline | IPolylineParams;\r\n    ray?: Ray | IRayParams;\r\n    pointCloud?: PointCloud | IPointCloudParams;\r\n    geometry?: Geometry | IGeometryParams;\r\n    geoObject?: GeoObject | IGeoObjectParams;\r\n    strip?: Strip | IStripParams;\r\n    independentPicking?: boolean;\r\n    relativePosition?: boolean;\r\n    pitch?: number;\r\n    yaw?: number;\r\n    roll?: number;\r\n    scale?: number | Vec3 | NumberArray3;\r\n    forceGlobalPosition?: boolean;\r\n    forceGlobalRotation?: boolean;\r\n    forceGlobalScale?: boolean;\r\n    localPosition?: Vec3 | NumberArray3;\r\n}\r\n\r\n/**\r\n * Entity instances aggregate multiple forms of visualization into a single high-level object.\r\n * They can be created manually and added to entity collection.\r\n *\r\n * @class\r\n * @param {IEntityParams} [options] - Entity options:\r\n * @param {string} [options.name] - Name of the entity.\r\n * @param {any} [options.properties] - Additional properties of the entity.\r\n * @param {Vec3 | NumberArray3} [options.cartesian] - Cartesian position.\r\n * @param {LonLat | NumberArray3 | NumberArray2} [options.lonlat] - Geographic coordinates.\r\n * @param {number} [options.altitude] - Altitude.\r\n * @param {boolean} [options.visibility] - Visibility flag.\r\n * @param {Billboard | IBillboardParams} [options.billboard] - Billboard object or parameters.\r\n * @param {Label | ILabelParams} [options.label] - Label object or parameters.\r\n * @param {Polyline | IPolylineParams} [options.polyline] - Polyline object or parameters.\r\n * @param {Ray | IRayParams} [options.ray] - Ray object or parameters.\r\n * @param {PointCloud | IPointCloudParams} [options.pointCloud] - Point cloud object or parameters.\r\n * @param {Geometry | IGeometryParams} [options.geometry] - Geometry object or parameters.\r\n * @param {GeoObject | IGeoObjectParams} [options.geoObject] - Geo object or parameters.\r\n * @param {Strip | IStripParams} [options.strip] - Strip object or parameters.\r\n * @param {boolean} [options.independentPicking] - Independent picking flag.\r\n * @param {boolean} [options.relativePosition] - Parent relative position flag, otherwise position is absolute.\r\n * @param {number} [options.pitch] - Rotation around local X-axis in radians.\r\n * @param {number} [options.yaw] - Rotation around local Y-axis in radians.\r\n * @param {number} [options.roll] - Rotation around local Z-axis in radians.\r\n * @param {number | Vec3 | NumberArray3} [options.scale] - Scaling factor.\r\n * @param {boolean} [options.forceGlobalPosition] - Forces global position for the entity make the same position as its parent.\r\n * @param {boolean} [options.forceGlobalRotation] - Forces global rotation for the entity make the same rotation as its parent.\r\n * @param {boolean} [options.forceGlobalScale] - Forces global scale for the entity make the same scale as its parent.\r\n */\r\nclass Entity {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    /**\r\n     * Uniq identifier.\r\n     * @public\r\n     * @readonly\r\n     */\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Entity user defined properties.\r\n     * @public\r\n     * @type {Object}\r\n     */\r\n    public properties: any;\r\n\r\n\r\n    /**\r\n     * Children entities.\r\n     * @public\r\n     * @type {Array.<Entity>}\r\n     */\r\n    public childEntities: Entity[];\r\n\r\n    public forceGlobalPosition: boolean;\r\n\r\n    public forceGlobalRotation: boolean;\r\n\r\n    public forceGlobalScale: boolean;\r\n\r\n    /**\r\n     * Parent entity.\r\n     * @public\r\n     * @type {Entity}\r\n     */\r\n    public parent: Entity | null;\r\n\r\n    /**\r\n     * Entity cartesian position.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    public _cartesian: Vec3;\r\n\r\n    /**\r\n     * Entity cartesian is equal root entity absolute cartesian.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    protected _rootCartesian: Vec3;\r\n\r\n    protected _localPosition: Vec3;\r\n    protected _absoluteLocalPosition: Vec3;\r\n\r\n    /**\r\n     * Geodetic entity coordinates.\r\n     * @public\r\n     * @type {LonLat}\r\n     */\r\n    public _lonLat: LonLat;\r\n\r\n    /**\r\n     * World Mercator entity coordinates.\r\n     * @public\r\n     * @type {LonLat}\r\n     */\r\n    public _lonLatMerc: LonLat;\r\n\r\n    /**\r\n     * Entity visible terrain altitude.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _altitude: number;\r\n\r\n    /**\r\n     * Visibility flag.\r\n     * @protected\r\n     * @type {boolean}\r\n     */\r\n    protected _visibility: boolean;\r\n\r\n    /**\r\n     * Entity collection that this entity belongs to.\r\n     * @public\r\n     * @type {EntityCollection}\r\n     */\r\n    public _entityCollection: EntityCollection | null;\r\n\r\n    /**\r\n     * Entity collection array store index.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _entityCollectionIndex: number;\r\n\r\n    /**\r\n     * Assigned vector layer pointer.\r\n     * @public\r\n     * @type {Vector}\r\n     */\r\n    public _layer: Vector | null;\r\n\r\n    /**\r\n     * Assigned vector layer entity array index.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _layerIndex: number;\r\n\r\n    /**\r\n     * Picking color.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public _pickingColor: Vec3;\r\n\r\n    public _independentPicking: boolean;\r\n\r\n    protected _featureConstructorArray: Record<string, [any, Function]>;\r\n\r\n    /**\r\n     * Billboard entity.\r\n     * @public\r\n     * @type {Billboard | null}\r\n     */\r\n    public billboard: Billboard | null;\r\n\r\n    /**\r\n     * Text label entity.\r\n     * @public\r\n     * @type {Label | null}\r\n     */\r\n    public label: Label | null;\r\n\r\n    /**\r\n     * Polyline entity.\r\n     * @public\r\n     * @type {Polyline | null}\r\n     */\r\n    public polyline: Polyline | null;\r\n\r\n    /**\r\n     * Ray entity.\r\n     * @public\r\n     * @type {Ray | null}\r\n     */\r\n    public ray: Ray | null;\r\n\r\n    /**\r\n     * PointCloud entity.\r\n     * @public\r\n     * @type {PointCloud | null}\r\n     */\r\n    public pointCloud: PointCloud | null;\r\n\r\n    /**\r\n     * Geometry entity(available for vector layer only).\r\n     * @public\r\n     * @type {Geometry | null}\r\n     */\r\n    public geometry: Geometry | null;\r\n\r\n    /**\r\n     * Geo object entity\r\n     * @public\r\n     * @type {Geometry | null}\r\n     */\r\n    public geoObject: GeoObject | null;\r\n\r\n    /**\r\n     * Strip entity.\r\n     * @public\r\n     * @type {Strip | null}\r\n     */\r\n    public strip: Strip | null;\r\n\r\n    public _nodePtr?: EntityCollectionNode;\r\n\r\n    protected _relativePosition: boolean;\r\n    protected _pitchRad: number;\r\n    protected _yawRad: number;\r\n    protected _rollRad: number;\r\n    protected _scale: Vec3;\r\n    protected _qFrame: Quat;\r\n    protected _qRot: Quat;\r\n    public _absoluteQRot: Quat;\r\n\r\n    constructor(options: IEntityParams = {}) {\r\n\r\n        options.properties = options.properties || {};\r\n\r\n        this.__id = Entity.__counter__++;\r\n\r\n        this.properties = options.properties || {};\r\n\r\n        this.properties.name = this.properties.name != undefined ? this.properties.name : \"\";\r\n\r\n        this.childEntities = [];\r\n\r\n        this.parent = null;\r\n\r\n        this.forceGlobalPosition = options.forceGlobalPosition || false;\r\n\r\n        this.forceGlobalRotation = options.forceGlobalRotation || false;\r\n\r\n        this.forceGlobalScale = options.forceGlobalScale || false;\r\n\r\n        this._cartesian = utils.createVector3(options.cartesian);\r\n\r\n        this._rootCartesian = new Vec3();\r\n\r\n        this._localPosition = utils.createVector3(options.localPosition);\r\n        this._absoluteLocalPosition = new Vec3();\r\n\r\n        this._lonLat = utils.createLonLat(options.lonlat);\r\n\r\n        this._lonLatMerc = new LonLat();\r\n\r\n        this._altitude = options.altitude || 0.0;\r\n\r\n        this._visibility = options.visibility != undefined ? options.visibility : true;\r\n\r\n        this._entityCollection = null;\r\n\r\n        this._entityCollectionIndex = -1;\r\n\r\n        this._layer = null;\r\n\r\n        this._layerIndex = -1;\r\n\r\n        this._pickingColor = new Vec3(0, 0, 0);\r\n\r\n        this._independentPicking = options.independentPicking || false;\r\n\r\n        this._relativePosition = options.relativePosition || false;\r\n\r\n        this._pitchRad = options.pitch || 0;\r\n        this._yawRad = options.yaw || 0;\r\n        this._rollRad = options.roll || 0;\r\n\r\n        this._scale = utils.createVector3(options.scale, new Vec3(1, 1, 1));\r\n\r\n        this._qFrame = Quat.IDENTITY;\r\n        this._qRot = Quat.IDENTITY;\r\n        this._absoluteQRot = Quat.IDENTITY;\r\n\r\n        this._featureConstructorArray = {\r\n            billboard: [Billboard, this.setBillboard],\r\n            label: [Label, this.setLabel],\r\n            polyline: [Polyline, this.setPolyline],\r\n            pointCloud: [PointCloud, this.setPointCloud],\r\n            geometry: [Geometry, this.setGeometry],\r\n            geoObject: [GeoObject, this.setGeoObject],\r\n            strip: [Strip, this.setStrip],\r\n            ray: [Ray, this.setRay]\r\n        };\r\n\r\n        this.billboard = this._createOptionFeature<Billboard, IBillboardParams>(\"billboard\", options.billboard);\r\n\r\n        this.label = this._createOptionFeature<Label, ILabelParams>(\"label\", options.label);\r\n\r\n        this.polyline = this._createOptionFeature<Polyline, IPolylineParams>(\"polyline\", options.polyline);\r\n\r\n        this.ray = this._createOptionFeature<Ray, IRayParams>(\"ray\", options.ray);\r\n\r\n        this.pointCloud = this._createOptionFeature<PointCloud, IPolylineParams>(\"pointCloud\", options.pointCloud);\r\n\r\n        this.geometry = this._createOptionFeature<Geometry, IGeometryParams>(\"geometry\", options.geometry);\r\n\r\n        this.geoObject = this._createOptionFeature<GeoObject, IGeoObjectParams>(\"geoObject\", options.geoObject);\r\n\r\n        this.strip = this._createOptionFeature<Strip, IStripParams>(\"strip\", options.strip);\r\n    }\r\n\r\n    /**\r\n     * Returns root entity object.\r\n     * @public\r\n     * @return {Entity}\r\n     */\r\n    public get rootEntity(): Entity {\r\n        let pn: Entity | null = this;\r\n        while (pn) {\r\n            if (!pn.parent) {\r\n                return pn;\r\n            }\r\n            pn = pn.parent;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets relative position property\r\n     * @param isRelative\r\n     */\r\n    public set relativePosition(isRelative: boolean) {\r\n\r\n        if (isRelative !== this._relativePosition) {\r\n\r\n            let cart = this.getAbsoluteCartesian(),\r\n                pitch = this.getAbsolutePitch(),\r\n                yaw = this.getAbsoluteYaw(),\r\n                roll = this.getAbsoluteRoll();\r\n\r\n            this._relativePosition = isRelative;\r\n\r\n            // probably need to take root this.rootEntity\r\n            if (this.parent) {\r\n                this._rootCartesian.copy(this.parent._rootCartesian);\r\n            }\r\n\r\n            if (!isRelative) {\r\n                this.setCartesian3v(cart);\r\n                this.setPitch(pitch);\r\n                this.setYaw(yaw);\r\n                this.setRoll(roll);\r\n            } else if (this.parent) {\r\n                this.setAbsoluteCartesian3v(cart);\r\n                this.setAbsolutePitch(pitch);\r\n                this.setAbsoluteYaw(yaw);\r\n                this.setAbsoluteRoll(roll);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets relative position property\r\n     * @public\r\n     * @returns{boolean}\r\n     */\r\n    public get relativePosition(): boolean {\r\n        return this._relativePosition;\r\n    }\r\n\r\n    /**\r\n     * Gets current entity collection container.\r\n     * @public\r\n     * @returns {EntityCollection | null}\r\n     */\r\n    public get entityCollection(): EntityCollection | null {\r\n        return this._entityCollection;\r\n    }\r\n\r\n    /**\r\n     * Gets entity uniq id\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public get id(): number {\r\n        return this.__id;\r\n    }\r\n\r\n    /**\r\n     * Checks if the given entity is equal to the current entity.\r\n     * @param {Entity} entity - The entity to compare.\r\n     * @returns {boolean} True if entities are equal, otherwise false.\r\n     */\r\n    public isEqual(entity: Entity): boolean {\r\n        return this.__id === entity.__id;\r\n    }\r\n\r\n    /**\r\n     * Gets the layer index of the entity.\r\n     * @returns {number} The layer index.\r\n     */\r\n    public get layerIndex(): number {\r\n        return this._layerIndex;\r\n    }\r\n\r\n    /**\r\n     * Gets the instance class name of the entity.\r\n     * @returns {string} The instance name \"Entity\".\r\n     */\r\n    public get instanceName(): string {\r\n        return \"Entity\";\r\n    }\r\n\r\n    protected _createOptionFeature<T, K>(\r\n        featureName: string,\r\n        options?: T | K\r\n    ): T | null {\r\n        if (options) {\r\n            let c = this._featureConstructorArray[featureName];\r\n            return c[1].call(this, new c[0](options)) as T;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Gets the collection index of the entity.\r\n     * @returns {number} The entity collection index.\r\n     */\r\n    public getCollectionIndex(): number {\r\n        return this._entityCollectionIndex;\r\n    }\r\n\r\n    /**\r\n     * Adds current entity into the specified entity collection.\r\n     * @public\r\n     * @param {EntityCollection | Vector} collection - Specified entity collection or vector layer.\r\n     * @param {boolean} [rightNow=false] - Entity insertion option for vector layer.\r\n     * @returns {Entity} - This object.\r\n     */\r\n    public addTo(collection: EntityCollection | Vector, rightNow: boolean = false): Entity {\r\n        collection.add(this, rightNow);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Removes current entity from its collection or layer.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        this._layer && this._layer.removeEntity(this);\r\n        this._entityCollection && this._entityCollection.removeEntity(this);\r\n    }\r\n\r\n    /**\r\n     * Sets the entity visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Entity visibility.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this._visibility = visibility;\r\n\r\n        // billboards\r\n        this.billboard && this.billboard.setVisibility(visibility);\r\n\r\n        // geoObject\r\n        this.geoObject && this.geoObject.setVisibility(visibility);\r\n\r\n        // labels\r\n        this.label && this.label.setVisibility(visibility);\r\n\r\n        // polyline\r\n        this.polyline && this.polyline.setVisibility(visibility);\r\n\r\n        // ray\r\n        this.ray && this.ray.setVisibility(visibility);\r\n\r\n        // geometry\r\n        this.geometry && this.geometry.setVisibility(visibility);\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            this.childEntities[i].setVisibility(visibility);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns entity visibility.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public getVisibility() {\r\n        return this._visibility;\r\n    }\r\n\r\n    /**\r\n     * Sets entity cartesian position.\r\n     * @public\r\n     * @param {Vec3} cartesian - Cartesian position in 3d space.\r\n     */\r\n    public setCartesian3v(cartesian: Vec3) {\r\n        this.setCartesian(cartesian.x, cartesian.y, cartesian.z);\r\n    }\r\n\r\n    /**\r\n     * Gets scale factor\r\n     * @public\r\n     * @returns {Vec3}\r\n     */\r\n    public getScale(): Vec3 {\r\n        return this._scale;\r\n    }\r\n\r\n    /**\r\n     * Sets XYZ axis scale for the inner object such as GeoObject\r\n     * @public\r\n     * @param {Vec3} scale - Scale factor\r\n     */\r\n    public setScale3v(scale: Vec3) {\r\n\r\n        this._scale.copy(scale);\r\n\r\n        this.geoObject && this.geoObject.setScale3v(this._scale);\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            let chi = this.childEntities[i];\r\n            if (chi.forceGlobalScale) {\r\n                chi.setScale3v(this._scale);\r\n            } else {\r\n                chi.setScale3v(this.childEntities[i].getScale());\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets scale for the inner object such as GeoObject\r\n     * @public\r\n     * @param {number} val - Scale factor\r\n     */\r\n    public setScale(val: number) {\r\n\r\n        this._scale.set(val, val, val);\r\n\r\n        this.geoObject && this.geoObject.setScale(val);\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            let chi = this.childEntities[i];\r\n            if (chi.forceGlobalScale) {\r\n                chi.setScale(val);\r\n            } else {\r\n                chi.setScale3v(this.childEntities[i].getScale());\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the absolute rotation direction of the entity.\r\n     * @public\r\n     * @returns {Quat} The absolute rotation quaternion.\r\n     */\r\n    public getAbsoluteRotation(): Quat {\r\n        return this._absoluteQRot.clone();\r\n    }\r\n\r\n    /**\r\n     * Gets the local rotation of the entity. For the root entity it is equal to the absolute rotation.\r\n     * @public\r\n     * @returns {Quat} The rotation quaternion.\r\n     */\r\n    public getRotation(): Quat {\r\n        return this._qRot;\r\n    }\r\n\r\n    /**\r\n     * Rotates the entity to look at a given point in world coordinates.\r\n     * @public\r\n     * @param {Vec3} cart - The target position to look at.\r\n     */\r\n    public setLook3v(cart: Vec3) {\r\n        let lq = new Quat();\r\n        let p0 = this.getAbsoluteCartesian();\r\n        let rot;\r\n        if (this._entityCollection) {\r\n            let up = (this._entityCollection.renderNode as Planet).ellipsoid.getSurfaceNormal3v(p0);\r\n            rot = lq.setLookRotation(cart.sub(p0), up).conjugate();\r\n\r\n        } else {\r\n            rot = lq.setLookRotation(cart.sub(p0), Vec3.UP).conjugate();\r\n        }\r\n        this.setAbsoluteRotation(rot);\r\n    }\r\n\r\n    /**\r\n     * Rotates the entity to look at a given geographic coordinate.\r\n     * @public\r\n     * @param {LonLat} lonLat - The longitude and latitude to look at.\r\n     */\r\n    public setLookLonLat(lonLat: LonLat) {\r\n        if (this._entityCollection) {\r\n            let cart = (this._entityCollection.renderNode as Planet).ellipsoid.lonLatToCartesian(lonLat);\r\n            this.setLook3v(cart);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets the absolute rotation of the entity.\r\n     * @public\r\n     * @param {Quat} rot - The new absolute rotation quaternion.\r\n     */\r\n    public setAbsoluteRotation(rot: Quat) {\r\n        this._absoluteQRot.copy(rot);\r\n        this._updatePitchYawRoll();\r\n    }\r\n\r\n    /**\r\n     * Sets the local rotation of the entity.\r\n     * @param {Quat} rot - The new rotation quaternion.\r\n     */\r\n    public setRotation(rot: Quat) {\r\n        //this._qRot.copy(rot);\r\n        //\r\n        //@todo when necessary\r\n        //\r\n    }\r\n\r\n    /**\r\n     * Sets the pitch rotation of the entity.\r\n     * @param {number} val - The new pitch angle in radians.\r\n     */\r\n    public setPitch(val: number) {\r\n        this._pitchRad = val;\r\n        this._updateAbsolutePosition();\r\n    }\r\n\r\n    /**\r\n     * Sets the yaw rotation of the entity.\r\n     * @param {number} val - The new yaw angle in radians.\r\n     */\r\n    public setYaw(val: number) {\r\n        this._yawRad = val;\r\n        this._updateAbsolutePosition();\r\n    }\r\n\r\n    /**\r\n     * Sets the roll rotation of the entity.\r\n     * @public\r\n     * @param {number} val - The new roll angle in radians.\r\n     */\r\n    public setRoll(val: number) {\r\n        this._rollRad = val;\r\n        this._updateAbsolutePosition();\r\n    }\r\n\r\n    /**\r\n     * Gets the pitch angle of the entity.\r\n     * @public\r\n     * @returns {number} The pitch angle in radians.\r\n     */\r\n    public getPitch(): number {\r\n        return this._pitchRad;\r\n    }\r\n\r\n    /**\r\n     * Gets the yaw angle of the entity.\r\n     * @public\r\n     * @returns {number} The yaw angle in radians.\r\n     */\r\n    public getYaw(): number {\r\n        return this._yawRad;\r\n    }\r\n\r\n    /**\r\n     * Gets the roll angle of the entity.\r\n     * @public\r\n     * @returns {number} The roll angle in radians.\r\n     */\r\n    public getRoll(): number {\r\n        return this._rollRad;\r\n    }\r\n\r\n    /**\r\n     * Sets the absolute pitch of the entity.\r\n     * @public\r\n     * @param {number} val - The absolute pitch angle in radians.\r\n     */\r\n    public setAbsolutePitch(val: number) {\r\n        if (this._relativePosition) {\r\n            this._absoluteQRot.setPitchYawRoll(val, this.getAbsoluteYaw(), this.getAbsoluteRoll(), this._qFrame);\r\n            this._updatePitchYawRoll();\r\n        } else {\r\n            this.setPitch(val);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets the absolute yaw of the entity.\r\n     * @public\r\n     * @param {number} val - The absolute yaw angle in radians.\r\n     */\r\n    public setAbsoluteYaw(val: number) {\r\n        if (this._relativePosition) {\r\n            this._absoluteQRot.setPitchYawRoll(this.getAbsolutePitch(), val, this.getAbsoluteRoll(), this._qFrame);\r\n            this._updatePitchYawRoll();\r\n        } else {\r\n            this.setYaw(val);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets the absolute roll of the entity.\r\n     * @public\r\n     * @param {number} val - The absolute roll angle in radians.\r\n     */\r\n    public setAbsoluteRoll(val: number) {\r\n        if (this._relativePosition) {\r\n            this._absoluteQRot.setPitchYawRoll(this.getAbsolutePitch(), this.getAbsoluteYaw(), val, this._qFrame);\r\n            this._updatePitchYawRoll();\r\n        } else {\r\n            this.setRoll(val);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the absolute pitch angle of the entity.\r\n     * @public\r\n     * @returns {number} The absolute pitch angle in radians.\r\n     */\r\n    public getAbsolutePitch(): number {\r\n        if (this.parent && this._relativePosition) {\r\n            return this._qFrame.conjugate().inverse().mul(this._absoluteQRot).getPitch();\r\n        }\r\n\r\n        return this._pitchRad;\r\n    }\r\n\r\n    /**\r\n     * Gets the absolute yaw angle of the entity.\r\n     * @public\r\n     * @returns {number} The absolute yaw angle in radians.\r\n     */\r\n    public getAbsoluteYaw(): number {\r\n        if (this.parent && this._relativePosition) {\r\n            return this._qFrame.conjugate().inverse().mul(this._absoluteQRot).getYaw();\r\n        }\r\n        return this._yawRad;\r\n    }\r\n\r\n    /**\r\n     * Gets the absolute roll angle of the entity.\r\n     * @public\r\n     * @returns {number} The absolute roll angle in radians.\r\n     */\r\n    public getAbsoluteRoll(): number {\r\n        if (this.parent && this._relativePosition) {\r\n            return this._qFrame.conjugate().inverse().mul(this._absoluteQRot).getRoll();\r\n        }\r\n        return this._rollRad;\r\n    }\r\n\r\n    protected _getScaleByDistance(): number {\r\n        let scd = 1;\r\n        if (this._entityCollection) {\r\n            let scaleByDistance = this._entityCollection.scaleByDistance;\r\n            let lookLength = 1;\r\n            if (this._entityCollection.renderNode && this._entityCollection.renderNode.renderer) {\r\n                lookLength = this._entityCollection.renderNode.renderer.activeCamera.eye.distance(this._rootCartesian);\r\n            }\r\n            //the same in the shader\r\n            scd = scaleByDistance[2] * clamp(lookLength, scaleByDistance[0], scaleByDistance[1]) / scaleByDistance[0];\r\n        }\r\n        return scd;\r\n    }\r\n\r\n    /**\r\n     * Sets the absolute cartesian position of the entity.\r\n     * @public\r\n     * @param {number} x - X coordinate.\r\n     * @param {number} y - Y coordinate.\r\n     * @param {number} z - Z coordinate.\r\n     */\r\n    public setAbsoluteCartesian(x: number, y: number, z: number) {\r\n        this.setAbsoluteCartesian3v(new Vec3(x, y, z));\r\n    }\r\n\r\n    /**\r\n     * Sets the absolute cartesian position of the entity using a Vec3.\r\n     * @public\r\n     * @param {Vec3} absolutCartesian - The absolute cartesian position.\r\n     */\r\n    public setAbsoluteCartesian3v(absolutCartesian: Vec3) {\r\n        let pos = absolutCartesian;\r\n\r\n        if (this.parent && this._relativePosition) {\r\n            let scd = this._getScaleByDistance();\r\n            pos = absolutCartesian.sub(this.parent.getAbsoluteCartesian()).scale(1 / scd);\r\n            pos = this.parent._absoluteQRot.conjugate().mulVec3(pos);\r\n        }\r\n\r\n        this.setCartesian3v(pos);\r\n    }\r\n\r\n    /**\r\n     * Returns absolute cartesian position.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public getAbsoluteCartesian(): Vec3 {\r\n        if (this.parent && this._relativePosition) {\r\n            let scd = this._getScaleByDistance();\r\n            return this._rootCartesian.add(this._absoluteLocalPosition.scaleTo(scd));\r\n        }\r\n        return this._cartesian.clone();\r\n    }\r\n\r\n    /**\r\n     * Sets entity cartesian position.\r\n     * @public\r\n     * @param {number} x - 3d space X - position.\r\n     * @param {number} y - 3d space Y - position.\r\n     * @param {number} z - 3d space Z - position.\r\n     */\r\n    public setCartesian(x: number, y: number, z: number) {\r\n\r\n        this._cartesian.set(x, y, z);\r\n\r\n        this._updateAbsolutePosition();\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            let chi = this.childEntities[i];\r\n            if (chi._relativePosition) {\r\n                chi.setCartesian3v(chi.getCartesian());\r\n            } else if (chi.forceGlobalPosition) {\r\n                chi.setCartesian(x, y, z);\r\n            }\r\n        }\r\n\r\n        this._updateLonLat();\r\n\r\n        //ec && ec.events.dispatch(ec.events.entitymove, this);\r\n    }\r\n\r\n    protected _updatePitchYawRoll() {\r\n        if (this.parent) {\r\n            this._qRot = this.parent._absoluteQRot.conjugate().mul(this._absoluteQRot);\r\n\r\n            this._pitchRad = this._qRot.getPitch();\r\n            this._yawRad = this._qRot.getYaw();\r\n            this._rollRad = this._qRot.getRoll();\r\n\r\n            // this._pitch = this._pitchRad * DEGREES;\r\n            // this._yaw = this._yawRad * DEGREES;\r\n            // this._roll = this._rollRad * DEGREES;\r\n\r\n            if (this.geoObject) {\r\n                this.geoObject.setRotation(this._absoluteQRot);\r\n            }\r\n\r\n            for (let i = 0; i < this.childEntities.length; i++) {\r\n                this.childEntities[i]._updateAbsolutePosition();\r\n            }\r\n        }\r\n    }\r\n\r\n    public _updateAbsolutePosition() {\r\n\r\n        let parent = this.parent;\r\n\r\n        if (parent && this._relativePosition) {\r\n            this._qFrame.copy(parent._qFrame);\r\n            this._rootCartesian.copy(parent._rootCartesian);\r\n\r\n            this._qRot.setPitchYawRoll(this._pitchRad, this._yawRad, this._rollRad);\r\n            parent._absoluteQRot.mulRes(this._qRot, this._absoluteQRot);\r\n\r\n            let rotCart = parent._absoluteQRot.mulVec3(this._cartesian.add(this._localPosition));\r\n            parent._absoluteLocalPosition.addRes(rotCart, this._absoluteLocalPosition);\r\n        } else {\r\n            this._qFrame = Quat.IDENTITY;\r\n            if (this._entityCollection && this._entityCollection.renderNode) {\r\n                this._qFrame = this._entityCollection.renderNode.getFrameRotation(this._cartesian);\r\n            }\r\n            if (parent && this.forceGlobalRotation) {\r\n                this._qRot.setPitchYawRoll(parent._pitchRad, parent._yawRad, parent._rollRad, this._qFrame);\r\n            } else {\r\n                this._qRot.setPitchYawRoll(this._pitchRad, this._yawRad, this._rollRad, this._qFrame);\r\n            }\r\n            this._absoluteQRot.copy(this._qRot);\r\n            this._rootCartesian.copy(this._cartesian);\r\n            this._absoluteLocalPosition.copy(this._localPosition);\r\n        }\r\n\r\n        if (this.geoObject) {\r\n            this.geoObject.setRotation(this._absoluteQRot);\r\n            this.geoObject.setPosition3v(this._rootCartesian);\r\n            this.geoObject.setLocalPosition3v(this._absoluteLocalPosition);\r\n        }\r\n\r\n        this.billboard && this.billboard.setPosition3v(this._rootCartesian);\r\n        this.label && this.label.setPosition3v(this._rootCartesian);\r\n\r\n        for (let i = 0, len = this.childEntities.length; i < len; i++) {\r\n            this.childEntities[i]._updateAbsolutePosition();\r\n        }\r\n\r\n        this._updateLonLat();\r\n    }\r\n\r\n    /**\r\n     * Sets entity cartesian position without event dispatching.\r\n     * @public\r\n     * @param {Vec3} cartesian - Cartesian position in 3d space.\r\n     * @param {boolean} skipLonLat - skip geodetic calculation.\r\n     */\r\n    public _setCartesian3vSilent(cartesian: Vec3, skipLonLat: boolean = false) {\r\n\r\n        this._cartesian.copy(cartesian);\r\n\r\n        this._updateAbsolutePosition();\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            this.childEntities[i].setCartesian(this._cartesian.x, this._cartesian.y, this._cartesian.z);\r\n        }\r\n\r\n        if (!skipLonLat) {\r\n            this._updateLonLat();\r\n        }\r\n    }\r\n\r\n    protected _updateLonLat() {\r\n        let ec = this._entityCollection;\r\n\r\n        if (ec && ec.renderNode && (ec.renderNode as Planet).ellipsoid) {\r\n            //let cart = this._rootCartesian.add(this._absoluteLocalPosition);\r\n            this._lonLat = (ec.renderNode as Planet).ellipsoid.cartesianToLonLat(this.getAbsoluteCartesian());\r\n\r\n            if (Math.abs(this._lonLat.lat) < mercator.MAX_LAT) {\r\n                this._lonLatMerc = this._lonLat.forwardMercator();\r\n            } else {\r\n                this._lonLatMerc.lon = this._lonLatMerc.lat = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets entity geodetic coordinates.\r\n     * @public\r\n     * @returns {LonLat} -\r\n     */\r\n    public getLonLat(): LonLat {\r\n        return this._lonLat.clone();\r\n    }\r\n\r\n    /**\r\n     * Sets geodetic coordinates of the entity point object.\r\n     * @public\r\n     * @param {LonLat} lonlat - coordinates.\r\n     */\r\n    public setLonLat(lonlat: LonLat) {\r\n        let l = this._lonLat;\r\n\r\n        l.lon = lonlat.lon;\r\n        l.lat = lonlat.lat;\r\n        l.height = lonlat.height;\r\n\r\n        let ec = this._entityCollection;\r\n        if (ec && ec.renderNode && (ec.renderNode as Planet).ellipsoid) {\r\n            if (Math.abs(l.lat) < mercator.MAX_LAT) {\r\n                this._lonLatMerc = l.forwardMercator();\r\n            } else {\r\n                //this._lonLatMerc = null;\r\n            }\r\n\r\n            let temp = new Vec3();\r\n            (ec.renderNode as Planet).ellipsoid.lonLatToCartesianRes(l, temp);\r\n\r\n            this.setAbsoluteCartesian3v(temp);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets geodetic coordinates of the entity point object.\r\n     * @public\r\n     * @param {number} lon - Longitude.\r\n     * @param {number} lat - Latitude\r\n     * @param {number} [height] - Height\r\n     */\r\n    public setLonLat2(lon: number, lat: number, height?: number) {\r\n        let l = this._lonLat;\r\n\r\n        l.lon = lon;\r\n        l.lat = lat;\r\n        l.height = height != undefined ? height : l.height;\r\n\r\n        let ec = this._entityCollection;\r\n        if (ec && ec.renderNode && (ec.renderNode as Planet).ellipsoid) {\r\n            if (Math.abs(l.lat) < mercator.MAX_LAT) {\r\n                this._lonLatMerc = l.forwardMercator();\r\n            } else {\r\n                this._lonLatMerc.lon = this._lonLatMerc.lat = this._lonLatMerc.height = 0;\r\n            }\r\n\r\n            let temp = new Vec3();\r\n            (ec.renderNode as Planet).ellipsoid.lonLatToCartesianRes(l, temp);\r\n\r\n            this.setAbsoluteCartesian3v(temp);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets entity altitude over the planet.\r\n     * @public\r\n     * @param {number} altitude - Altitude.\r\n     */\r\n    public setAltitude(altitude: number) {\r\n        this._altitude = altitude;\r\n    }\r\n\r\n    /**\r\n     * Sets entity altitude over the planet.\r\n     * @public\r\n     * @return {number} Altitude.\r\n     */\r\n    public getAltitude(): number {\r\n        return this._altitude;\r\n    }\r\n\r\n    /**\r\n     * Returns cartesian position.\r\n     * @public\r\n     * @returns {Vec3} -\r\n     */\r\n    public getCartesian(): Vec3 {\r\n        return this._cartesian.clone();\r\n    }\r\n\r\n    /**\r\n     * Sets entity billboard.\r\n     * @public\r\n     * @param {Billboard} billboard - Billboard object.\r\n     * @returns {Billboard} -\r\n     */\r\n    public setBillboard(billboard: Billboard): Billboard {\r\n        if (this.billboard) {\r\n            this.billboard.remove();\r\n        }\r\n        this.billboard = billboard;\r\n        this.billboard._entity = this;\r\n        this.billboard.setPosition3v(this._cartesian);\r\n        this.billboard.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.billboardHandler.add(billboard);\r\n        return billboard;\r\n    }\r\n\r\n    /**\r\n     * Sets entity label.\r\n     * @public\r\n     * @param {Label} label - Text label.\r\n     * @returns {Label} -\r\n     */\r\n    public setLabel(label: Label): Label {\r\n        if (this.label) {\r\n            this.label.remove();\r\n        }\r\n        this.label = label;\r\n        this.label._entity = this;\r\n        this.label.setPosition3v(this._cartesian);\r\n        this.label.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.labelHandler.add(label);\r\n        return label;\r\n    }\r\n\r\n    /**\r\n     * Sets entity ray.\r\n     * @public\r\n     * @param {Ray} ray - Ray object.\r\n     * @returns {Ray} -\r\n     */\r\n    public setRay(ray: Ray): Ray {\r\n        if (this.ray) {\r\n            this.ray.remove();\r\n        }\r\n        this.ray = ray;\r\n        this.ray._entity = this;\r\n        this.ray.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.rayHandler.add(ray);\r\n        return ray;\r\n    }\r\n\r\n    /**\r\n     * Sets entity polyline.\r\n     * @public\r\n     * @param {Polyline} polyline - Polyline object.\r\n     * @returns {Polyline} -\r\n     */\r\n    public setPolyline(polyline: Polyline): Polyline {\r\n        if (this.polyline) {\r\n            this.polyline.remove();\r\n        }\r\n        this.polyline = polyline;\r\n        this.polyline._entity = this;\r\n        this.polyline.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.polylineHandler.add(polyline);\r\n        return polyline;\r\n    }\r\n\r\n    /**\r\n     * Sets entity pointCloud.\r\n     * @public\r\n     * @param {PointCloud} pointCloud - PointCloud object.\r\n     * @returns {PointCloud} -\r\n     */\r\n    public setPointCloud(pointCloud: PointCloud): PointCloud {\r\n        if (this.pointCloud) {\r\n            this.pointCloud.remove();\r\n        }\r\n        this.pointCloud = pointCloud;\r\n        this.pointCloud._entity = this;\r\n        this.pointCloud.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.pointCloudHandler.add(pointCloud);\r\n        return pointCloud;\r\n    }\r\n\r\n    /**\r\n     * Sets entity geometry.\r\n     * @public\r\n     * @param {Geometry} geometry - Geometry object.\r\n     * @returns {Geometry} -\r\n     */\r\n    public setGeometry(geometry: Geometry): Geometry {\r\n        if (this.geometry) {\r\n            this.geometry.remove();\r\n        }\r\n        this.geometry = geometry;\r\n        this.geometry._entity = this;\r\n        this.geometry.setVisibility(this._visibility);\r\n        let layer = this._layer;\r\n        if (this._layer) {\r\n            this._layer.removeEntity(this);\r\n        }\r\n        layer && layer.add(this);\r\n        return geometry;\r\n    }\r\n\r\n    /**\r\n     * Sets entity geoObject.\r\n     * @public\r\n     * @param {GeoObject} geoObject - GeoObject.\r\n     * @returns {GeoObject} -\r\n     */\r\n    public setGeoObject(geoObject: GeoObject): GeoObject {\r\n        if (this.geoObject) {\r\n            this.geoObject.remove();\r\n        }\r\n        this.geoObject = geoObject;\r\n        this.geoObject._entity = this;\r\n        this.geoObject.setPosition3v(this._cartesian);\r\n        this.geoObject.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.geoObjectHandler.add(geoObject);\r\n        return geoObject;\r\n    }\r\n\r\n    /**\r\n     * Sets entity strip.\r\n     * @public\r\n     * @param {Strip} strip - Strip object.\r\n     * @returns {Strip} -\r\n     */\r\n    public setStrip(strip: Strip): Strip {\r\n        if (this.strip) {\r\n            this.strip.remove();\r\n        }\r\n        this.strip = strip;\r\n        this.strip._entity = this;\r\n        this.strip.setVisibility(this._visibility);\r\n        this._entityCollection && this._entityCollection.stripHandler.add(strip);\r\n        return strip;\r\n    }\r\n\r\n    /**\r\n     * Gets layer container\r\n     * @public\r\n     * @returns {Vector | null}\r\n     */\r\n    public get layer(): Vector | null {\r\n        return this._layer;\r\n    }\r\n\r\n    public get rendererEvents(): VectorEventsType | EntityCollectionEvents | null {\r\n        if (this._layer) {\r\n            return this._layer.events;\r\n        } else if (this._entityCollection) {\r\n            return this._entityCollection.events;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Append child entity.\r\n     * @public\r\n     * @param {Entity} entity - Child entity.\r\n     */\r\n    public appendChild(entity: Entity) {\r\n        entity._entityCollection = this._entityCollection;\r\n        if (!entity._independentPicking) {\r\n            entity._pickingColor = this._pickingColor;\r\n        }\r\n        entity.parent = this;\r\n        this.childEntities.push(entity);\r\n        this._entityCollection && this._entityCollection.appendChildEntity(entity);\r\n    }\r\n\r\n    /**\r\n     * Appends entity items(billboard, label etc.) picking color.\r\n     * @public\r\n     */\r\n    public setPickingColor() {\r\n        let c = this._pickingColor;\r\n\r\n        this.billboard && this.billboard.setPickingColor3v(c);\r\n\r\n        this.label && this.label.setPickingColor3v(c);\r\n\r\n        this.polyline && this.polyline.setPickingColor3v(c);\r\n\r\n        this.ray && this.ray.setPickingColor3v(c);\r\n\r\n        this.strip && this.strip.setPickingColor3v(c);\r\n\r\n        this.geoObject && this.geoObject.setPickingColor3v(c);\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            this.childEntities[i].setPickingColor();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return geodetic extent.\r\n     * @public\r\n     * @returns {Extent} -\r\n     */\r\n    public getExtent(): Extent {\r\n\r\n        let res;\r\n        let c = this._lonLat;\r\n\r\n        if (this.billboard || this.label) {\r\n            res = new Extent(new LonLat(c.lon, c.lat), new LonLat(c.lon, c.lat));\r\n        } else {\r\n            res = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\r\n        }\r\n\r\n        let sw = res.southWest,\r\n            ne = res.northEast;\r\n\r\n        if (this.polyline) {\r\n            let e = this.polyline.getExtent();\r\n            if (e.southWest.lon < sw.lon) sw.lon = e.southWest.lon;\r\n            if (e.southWest.lat < sw.lat) sw.lat = e.southWest.lat;\r\n            if (e.northEast.lon > ne.lon) ne.lon = e.northEast.lon;\r\n            if (e.northEast.lat > ne.lat) ne.lat = e.northEast.lat;\r\n        }\r\n\r\n        if (this.geometry) {\r\n            let e = this.geometry.getExtent();\r\n            if (e.southWest.lon < sw.lon) sw.lon = e.southWest.lon;\r\n            if (e.southWest.lat < sw.lat) sw.lat = e.southWest.lat;\r\n            if (e.northEast.lon > ne.lon) ne.lon = e.northEast.lon;\r\n            if (e.northEast.lat > ne.lat) ne.lat = e.northEast.lat;\r\n        }\r\n\r\n        for (let i = 0; i < this.childEntities.length; i++) {\r\n            let e = this.childEntities[i].getExtent();\r\n            if (e.southWest.lon < sw.lon) sw.lon = e.southWest.lon;\r\n            if (e.southWest.lat < sw.lat) sw.lat = e.southWest.lat;\r\n            if (e.northEast.lon > ne.lon) ne.lon = e.northEast.lon;\r\n            if (e.northEast.lat > ne.lat) ne.lat = e.northEast.lat;\r\n        }\r\n\r\n        return res;\r\n    }\r\n}\r\n\r\nexport {Entity};\r\n","/**\r\n * Scene node base class.\r\n * @class\r\n * @param {string} name - Node name.\r\n */\r\nclass BaseNode {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Node name.\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    protected _name: string;\r\n\r\n    /**\r\n     * Top scene tree node pointer.\r\n     * @public\r\n     * @type {BaseNode}\r\n     */\r\n    public topNode: BaseNode;\r\n\r\n    protected _dictionary: Record<string, BaseNode>;\r\n\r\n    /**\r\n     * Children nodes.\r\n     * @public\r\n     * @type {Array.<BaseNode>}\r\n     */\r\n    public childNodes: BaseNode[];\r\n\r\n    /**\r\n     * Parent node pointer.\r\n     * @public\r\n     * @type {BaseNode}\r\n     */\r\n    public parentNode: BaseNode | null;\r\n\r\n    constructor(name?: string) {\r\n\r\n        this.__id = BaseNode.__counter__++;\r\n\r\n        this._name = name || `nonameNode:${this.__id}`;\r\n\r\n        this.topNode = this;\r\n\r\n        this._dictionary = {};\r\n        this._dictionary[this._name] = this;\r\n\r\n        this.childNodes = [];\r\n\r\n        this.parentNode = null;\r\n    }\r\n\r\n    public get name(): string {\r\n        return this._name;\r\n    }\r\n\r\n    /**\r\n     * Adds node to the current hierarchy.\r\n     * @public\r\n     * @type {BaseNode}\r\n     */\r\n    public addNode(node: BaseNode) {\r\n        if (this.parentNode == null) {\r\n            node.topNode = this;\r\n        } else {\r\n            node.topNode = this.topNode;\r\n        }\r\n        node.parentNode = this;\r\n        node._dictionary = this.topNode._dictionary;\r\n        this.childNodes.push(node);\r\n        this.topNode._dictionary[node.name] = node;\r\n    }\r\n\r\n    /**\r\n     * Destroy node.\r\n     * @public\r\n     */\r\n    public destroy() {\r\n        for (let i = 0; i < this.childNodes.length; i++) {\r\n            this.childNodes[i].destroy();\r\n        }\r\n        this._clear();\r\n    }\r\n\r\n    /**\r\n     * Gets node by name in the current.\r\n     * @public\r\n     * @param {string} name - Node name.\r\n     * @return {RenderNode} Node object in the current node.\r\n     */\r\n    public getNodeByName(name: string): BaseNode {\r\n        return this._dictionary[name];\r\n    }\r\n\r\n    /**\r\n     * Clear current node.\r\n     * @protected\r\n     */\r\n    protected _clear() {\r\n        this.parentNode = null;\r\n        this.topNode = this;\r\n        this.childNodes.length = 0;\r\n    }\r\n\r\n    public isEqual(node: BaseNode): boolean {\r\n        return node.__id === this.__id;\r\n    }\r\n}\r\n\r\nexport {BaseNode};\r\n","import {BaseNode} from \"./BaseNode\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {LightSource} from \"../light/LightSource\";\r\nimport {EntityCollection} from \"../entity/EntityCollection\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Planet} from \"./Planet\";\r\n\r\n/**\r\n * Render node is a logical part of a render mechanism. Represents scene rendering.\r\n * For example one scene node for rendering the Earth, another one for rendering the Moon, another node for rendering stars etc.\r\n * Each render node has own model view space defined with matrices(scale, rotation, translation, transformation).\r\n * There are collections of light sources, entities and so on in the node.\r\n * Access to the node is renderer.renderNodes[\"Earth\"]\r\n * @class\r\n * @extends {BaseNode}\r\n * @param {string} name - Node name.\r\n */\r\n\r\nclass RenderNode extends BaseNode {\r\n\r\n    /**\r\n     * Renderer that calls frame() callback.\r\n     * @public\r\n     * @type {Renderer}\r\n     */\r\n    public renderer: Renderer | null;\r\n\r\n    public drawMode: number;\r\n\r\n    /** Show rendering.\r\n     * @public\r\n     */\r\n    public show: boolean;\r\n\r\n    protected _isActive: boolean;\r\n\r\n    public override childNodes: RenderNode[];\r\n\r\n    /**\r\n     * Lighting calculations.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public lightEnabled: boolean;\r\n\r\n    /**\r\n     * Point light array.\r\n     * @public\r\n     * @type {Array.<LightSource>}\r\n     */\r\n    public _lightPosition: Float32Array;\r\n    public _lightParams: Float32Array;\r\n    public _lightShininess: number;\r\n\r\n    /**\r\n     * Entity collection array.\r\n     * @public\r\n     * @type {Array.<EntityCollection>}\r\n     */\r\n    public entityCollections: EntityCollection[];\r\n\r\n    protected _entityCollectionsByDepthOrder: EntityCollection[][];\r\n\r\n    protected _pickingId: number;\r\n\r\n    constructor(name?: string) {\r\n        super(name);\r\n\r\n        this.childNodes = [];\r\n\r\n        this.renderer = null;\r\n\r\n        this.drawMode = 0;\r\n\r\n        this.show = true;\r\n\r\n        this._isActive = true;\r\n\r\n        this.lightEnabled = false;\r\n\r\n        this._lightPosition = new Float32Array([100, 100, 100]);\r\n        this._lightParams = new Float32Array(9);\r\n        this._lightShininess = 100.0;\r\n\r\n        this.entityCollections = [];\r\n\r\n        this._entityCollectionsByDepthOrder = [];\r\n\r\n        this._pickingId = -1;\r\n    }\r\n\r\n    public getFrameRotation(cartesian: Vec3): Quat {\r\n        return Quat.IDENTITY;\r\n    }\r\n\r\n    /**\r\n     * Adds node to the current hierarchy.\r\n     * @public\r\n     * @type {RenderNode}\r\n     */\r\n    public override addNode(node: RenderNode) {\r\n        super.addNode(node);\r\n        this.renderer && node.assign(this.renderer);\r\n    }\r\n\r\n    /**\r\n     * Assign render node with renderer.\r\n     * @public\r\n     * @param {Renderer} renderer - Render node's renderer.\r\n     */\r\n    public assign(renderer: Renderer) {\r\n        this.renderer = renderer;\r\n        this._pickingId = renderer.addPickingCallback(this, this._entityCollectionPickingCallback);\r\n        this.initialize();\r\n    }\r\n\r\n    public initialize() {\r\n        if (this.renderer && this.renderer.isInitialized()) {\r\n            for (let i = 0; i < this.entityCollections.length; i++) {\r\n                this.entityCollections[i].bindRenderNode(this);\r\n            }\r\n            this.init();\r\n        }\r\n    }\r\n\r\n    public init() {\r\n        //virtual\r\n    }\r\n\r\n    public onremove() {\r\n        //virtual\r\n    }\r\n\r\n    public remove() {\r\n        let r = this.renderer,\r\n            n = this.name;\r\n\r\n        if (r) {\r\n            // TODO: replace to renderer\r\n            if (r.renderNodes[n] && r.renderNodes[n].isEqual(this)) {\r\n                // @ts-ignore\r\n                r.renderNodes[n] = null;\r\n                delete r.renderNodes[n];\r\n            }\r\n\r\n            for (let i = 0; i < r._renderNodesArr.length; i++) {\r\n                if (r._renderNodesArr[i].isEqual(this)) {\r\n                    r._renderNodesArr.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            r.removePickingCallback(this._pickingId);\r\n            this._pickingId = -1;\r\n            this.onremove && this.onremove();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds entity collection.\r\n     * @public\r\n     * @param {EntityCollection} entityCollection - Entity collection.\r\n     * @param {boolean} [isHidden] - If it's true that this collection has specific rendering.\r\n     * @returns {RenderNode} -\r\n     */\r\n    public addEntityCollection(entityCollection: EntityCollection, isHidden?: boolean): void {\r\n\r\n        if (!entityCollection.renderNode) {\r\n            entityCollection.renderNode = this;\r\n\r\n            if (!isHidden) {\r\n                this.entityCollections.push(entityCollection);\r\n                this.updateEntityCollectionsDepthOrder();\r\n            }\r\n\r\n            //@ts-ignore\r\n            (this as Planet).ellipsoid && entityCollection._updateGeodeticCoordinates((this as Planet).ellipsoid);\r\n\r\n            entityCollection.bindRenderNode(this);\r\n\r\n            entityCollection.events.dispatch(entityCollection.events.add, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes entity collection.\r\n     * @public\r\n     * @param {EntityCollection} entityCollection - Entity collection for remove.\r\n     */\r\n    public removeEntityCollection(entityCollection: EntityCollection) {\r\n        for (let i = 0; i < this.entityCollections.length; i++) {\r\n            if (this.entityCollections[i].isEqual(entityCollection)) {\r\n                this.entityCollections.splice(i, 1);\r\n                this.updateEntityCollectionsDepthOrder();\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    public updateEntityCollectionsDepthOrder() {\r\n\r\n        let grouped: Record<number, EntityCollection[]> = {0: []};\r\n        for (const ec of this.entityCollections) {\r\n            if (ec.getVisibility()) {\r\n                if (!grouped[ec.depthOrder]) {\r\n                    grouped[ec.depthOrder] = [];\r\n                }\r\n                grouped[ec.depthOrder].push(ec);\r\n            }\r\n        }\r\n\r\n        this._entityCollectionsByDepthOrder.length = 0;\r\n        this._entityCollectionsByDepthOrder = [];\r\n        this._entityCollectionsByDepthOrder = Object.keys(grouped)\r\n            .sort((a, b) => Number(a) - Number(b))\r\n            .map(key => grouped[Number(key)]);\r\n    }\r\n\r\n    /**\r\n     * Adds point light source.\r\n     * @public\r\n     * @param {LightSource} light - Light source.\r\n     * @returns {RenderNode}\r\n     */\r\n    public addLight(light: LightSource): RenderNode {\r\n        light.addTo(this);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Calls render frame node's callback. Used in renderer.\r\n     * @public\r\n     */\r\n    public preDrawNode() {\r\n        this._isActive && this._preDrawNodes();\r\n    }\r\n\r\n\r\n    /**\r\n     * Calls render frame node's callback. Used in renderer.\r\n     * @public\r\n     */\r\n    public drawNode() {\r\n        this._isActive && this._drawNodes();\r\n    }\r\n\r\n    /**\r\n     * Gets render node activity.\r\n     * @public\r\n     * @returns {Boolean} -\r\n     */\r\n    public isActive(): boolean {\r\n        return this._isActive;\r\n    }\r\n\r\n    /**\r\n     * Rendering activation.\r\n     * @public\r\n     * @param {boolean} isActive - Activation flag.\r\n     */\r\n    public setActive(isActive: boolean) {\r\n        this._isActive = isActive;\r\n\r\n        if (this.renderer) {\r\n            if (this._isActive && this._pickingId === -1) {\r\n                // This picking callback MUST be the first picking callback\r\n                // in the rendering queue in the renderer. It affects on blending.\r\n                this._pickingId = this.renderer.addPickingCallback(\r\n                    this,\r\n                    this._entityCollectionPickingCallback\r\n                );\r\n            } else if (!this._isActive && this._pickingId !== -1) {\r\n                this.renderer.removePickingCallback(this._pickingId);\r\n                this._pickingId = -1;\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.childNodes.length; i++) {\r\n            this.childNodes[i].setActive(isActive);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets draw mode\r\n     * @public\r\n     * @param {Number} mode - Draw mode, such as gl.TRIANGLES, gl.TRIANGLE_STRIP, gl.LINES etc.\r\n     */\r\n    public setDrawMode(mode: number) {\r\n        this.drawMode = mode;\r\n        for (let i = 0; i < this.childNodes.length; i++) {\r\n            this.childNodes[i].setDrawMode(mode);\r\n        }\r\n    }\r\n\r\n    // /**\r\n    //  * IMPORTANT: This function have to be called manually in each render node frame callback, before drawing scene geometry.\r\n    //  * @public\r\n    //  */\r\n    // public transformLights() {\r\n    //     // for (let i = 0; i < this._lights.length; i++) {\r\n    //     //     var ii = i * 4;\r\n    //     //     var tp;\r\n    //     //     if (this._lights[i].directional) {\r\n    //     //         tp = r.activeCamera._normalMatrix.mulVec(this._lights[i]._position);\r\n    //     //         this._lightsTransformedPositions[ii + 3] = 0;\r\n    //     //     } else {\r\n    //     //         tp = r.activeCamera._viewMatrix.mulVec3(this._lights[i]._position);\r\n    //     //         this._lightsTransformedPositions[ii + 3] = 1;\r\n    //     //     }\r\n    //     //     this._lightsTransformedPositions[ii] = tp.x;\r\n    //     //     this._lightsTransformedPositions[ii + 1] = tp.y;\r\n    //     //     this._lightsTransformedPositions[ii + 2] = tp.z;\r\n    //     // }\r\n    // }\r\n\r\n    public updateBillboardsTexCoords() {\r\n        for (let i = 0; i < this.entityCollections.length; i++) {\r\n            this.entityCollections[i].billboardHandler.refreshTexCoordsArr();\r\n        }\r\n    }\r\n\r\n    // public updateGeoObjectsTexCoords() {\r\n    //     for (let i = 0; i < this.entityCollections.length; i++) {\r\n    //         this.entityCollections[i].geoObjectHandler.refreshTexCoordsArr();\r\n    //     }\r\n    // }\r\n\r\n    public frame() {\r\n        // virtual\r\n    }\r\n\r\n    public preFrame() {\r\n        // virtual\r\n    }\r\n\r\n    protected _preDrawNodes() {\r\n        for (let i = 0; i < this.childNodes.length; i++) {\r\n            if (this.childNodes[i]._isActive) {\r\n                this.childNodes[i]._preDrawNodes();\r\n            }\r\n        }\r\n\r\n        if (this.show) {\r\n            //this.lightEnabled && this.transformLights();\r\n            this.preFrame();\r\n            for (let i = 0; i < this._entityCollectionsByDepthOrder.length; i++) {\r\n                this.drawEntityCollections(this._entityCollectionsByDepthOrder[i], i);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _drawNodes() {\r\n        for (let i = 0; i < this.childNodes.length; i++) {\r\n            if (this.childNodes[i]._isActive) {\r\n                this.childNodes[i]._drawNodes();\r\n            }\r\n        }\r\n\r\n        if (this.show) {\r\n            this.frame();\r\n        }\r\n    }\r\n\r\n    public drawEntityCollections(ec: EntityCollection[], depthOrder: number = 0) {\r\n        this.renderer!.enqueueEntityCollectionsToDraw(ec, depthOrder);\r\n    }\r\n\r\n    /**\r\n     * Draw entity collections picking frame.\r\n     * @public\r\n     * @param {Array<EntityCollection>} ec - Entity collection array.\r\n     */\r\n    public drawPickingEntityCollections(ec: EntityCollection[]) {\r\n        if (ec.length) {\r\n\r\n            // billboard pass\r\n            let i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].billboardHandler.drawPicking();\r\n            }\r\n\r\n            // geoObject pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].geoObjectHandler.drawPicking();\r\n            }\r\n\r\n            // label pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].labelHandler.drawPicking();\r\n            }\r\n\r\n            // ray pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].rayHandler.drawPicking();\r\n            }\r\n\r\n            // polyline pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._visibility && ec[i].polylineHandler.drawPicking();\r\n            }\r\n\r\n            //Strip pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._visibility && ec[i].stripHandler.drawPicking();\r\n            }\r\n\r\n            // //pointClouds pass\r\n            // i = ec.length;\r\n            // while (i--) {\r\n            //    ec[i]._visibility && ec[i].pointCloudHandler.drawPicking();\r\n            // }\r\n        }\r\n    }\r\n\r\n    protected _entityCollectionPickingCallback() {\r\n        // for (let i = 0; i < this._entityCollectionsByDepthOrder.length; i++) {\r\n        //     this.drawPickingEntityCollections(this._entityCollectionsByDepthOrder[i]);\r\n        // }\r\n    }\r\n}\r\n\r\nexport {RenderNode};\r\n","/**\r\n * Console logging singleton object.\r\n * @class\r\n */\r\nexport class Cons {\r\n\r\n    protected _container: HTMLElement;\r\n    protected _visibility: boolean;\r\n\r\n    constructor() {\r\n        this._container = document.createElement(\"div\");\r\n        this._container.classList.add(\"ogConsole\");\r\n        this._container.style.display = \"none\";\r\n        if (document.body) {\r\n            document.body.appendChild(this._container);\r\n        }\r\n\r\n        this._visibility = false;\r\n    }\r\n\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    public setVisibility(visibility: boolean) {\r\n        if (this._visibility != visibility) {\r\n            this._visibility = visibility;\r\n            if (this._visibility) {\r\n                this.show();\r\n            } else {\r\n                this.hide();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Show console panel.\r\n     * @public\r\n     */\r\n    public show() {\r\n        if (!this._container.parentNode) {\r\n            if (document.body) {\r\n                document.body.appendChild(this._container);\r\n            }\r\n        }\r\n        this._container.style.display = \"block\";\r\n        this._visibility = true;\r\n    }\r\n\r\n    /**\r\n     * Hide console panel.\r\n     * @public\r\n     */\r\n    public hide() {\r\n        this._container.style.display = \"none\";\r\n        this._visibility = false;\r\n    }\r\n\r\n    /**\r\n     * Adds error text in the console.\r\n     * @public\r\n     * @param {string} str - Error text.\r\n     */\r\n    public logErr(str: string) {\r\n        let d = document.createElement(\"div\");\r\n        d.classList.add(\"ogConsole-text\");\r\n        d.classList.add(\"ogConsole-error\");\r\n        d.innerHTML = \"error: \" + str;\r\n        console.trace(d.innerHTML);\r\n        this._container.appendChild(d);\r\n        this.show();\r\n    }\r\n\r\n    /**\r\n     * Adds warning text in the console.\r\n     * @public\r\n     * @param {string} str - Warning text.\r\n     */\r\n    public logWrn(str: string) {\r\n        let d = document.createElement(\"div\");\r\n        d.classList.add(\"ogConsole-text\");\r\n        d.classList.add(\"ogConsole-warning\");\r\n        d.innerHTML = \"warning: \" + str;\r\n        console.trace(d.innerHTML);\r\n        this._container.appendChild(d);\r\n        this.show();\r\n    }\r\n\r\n    /**\r\n     * Adds log text in the console.\r\n     * @public\r\n     * @param {string} str - Log text.\r\n     */\r\n    public log(str: string) {\r\n        let d = document.createElement(\"div\");\r\n        d.classList.add(\"ogConsole-text\");\r\n        d.innerHTML = str;\r\n        console.trace(str);\r\n        this._container.appendChild(d);\r\n        this.show();\r\n    }\r\n}\r\n\r\nexport const cons = new Cons();","/**\r\n * @module og/webgl/types\r\n */\r\n\r\nlet _declarations: string[] = [\r\n    \"FLOAT\", \"DOUBLE\", \"BOOL\", \"INT\", \"UINT\",\r\n    \"VEC2\", \"VEC3\", \"VEC4\", \"DVEC2\",\r\n    \"DVEC3\", \"DVEC4\",\r\n    \"BVEC2\", \"BVEC3\", \"BVEC4\",\r\n    \"IVEC2\", \"IVEC3\", \"IVEC4\",\r\n    \"UVEC2\", \"UVEC3\", \"UVEC4\",\r\n    \"MAT2\", \"DMAT2\", \"MAT3\", \"DMAT3\", \"MAT4\", \"DMAT4\",\r\n    \"MAT2X3\", \"MAT2X4\", \"MAT3X2\", \"MAT3X4\", \"MAT4X2\",\r\n    \"MAT4X3\", \"DMAT2X3\", \"DMAT2X4\", \"DMAT3X2\", \"DMAT3X4\",\r\n    \"DMAT4X2\", \"DMAT4X3\",\r\n    \"SAMPLER1D\", \"SAMPLER2D\", \"SAMPLER3D\", \"SAMPLERCUBE\", \"SAMPLER2DSHADOW\",\r\n    \"SAMPLER2DARRAY\",\r\n    \"INTXX\", \"FLOATXX\"];\r\n\r\nexport const types: { [id: string]: number } = {};\r\n\r\nfor (let i = 0; i < _declarations.length; i++) {\r\n    types[_declarations[i]] = i;\r\n}\r\n\r\nexport const typeStr: { [id: string]: number } = {};\r\nfor (let i = 0; i < _declarations.length; i++) {\r\n    typeStr[_declarations[i].toLowerCase()] = types[_declarations[i]];\r\n}\r\n","/**\r\n * @module og/webgl/variableHandlers\r\n */\r\n\r\nimport {types} from \"./types\";\r\nimport {Program} from \"./Program\";\r\nimport type {WebGLBufferExt} from \"./Handler\";\r\n\r\nexport type VariableHandler = {\r\n    u: { [id: number]: Function },\r\n    a: { [id: number]: Function }\r\n};\r\n\r\nexport type ProgramVariable = {\r\n    type: string | number,\r\n    func: Function,\r\n    _pName: WebGLUniformLocation | number,\r\n    value: number | Float32Array | Int32Array | WebGLBufferExt,\r\n    itemType: string | number,\r\n    normalized: boolean,\r\n    divisor: number\r\n};\r\n\r\n/*=========================\r\n   Uniforms callbacks\r\n =========================*/\r\nexport const variableHandlers: VariableHandler = {\r\n    u: [],\r\n    a: []\r\n};\r\n\r\nvariableHandlers.u[types.MAT4] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniformMatrix4fv(variable._pName, false, variable.value as Float32Array);\r\n};\r\n\r\nvariableHandlers.u[types.MAT3] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniformMatrix3fv(variable._pName, false, variable.value as Float32Array);\r\n};\r\n\r\nvariableHandlers.u[types.FLOAT] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform1f(variable._pName, variable.value as number);\r\n};\r\n\r\nvariableHandlers.u[types.INT] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform1i(variable._pName, variable.value as number);\r\n};\r\n\r\nvariableHandlers.u[types.VEC2] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform2fv(variable._pName, variable.value as Float32Array);\r\n};\r\n\r\nvariableHandlers.u[types.VEC3] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform3fv(variable._pName, variable.value as Float32Array);\r\n};\r\n\r\nvariableHandlers.u[types.VEC4] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform4fv(variable._pName, variable.value as Float32Array);\r\n};\r\n\r\nvariableHandlers.u[types.SAMPLER2D] = function (program: Program, variable: ProgramVariable) {\r\n    let pgl = program.gl!;\r\n    pgl.activeTexture(pgl.TEXTURE0 + program._textureID);\r\n    pgl.bindTexture(pgl.TEXTURE_2D, variable.value);\r\n    pgl.uniform1i(variable._pName, program._textureID);\r\n    program._textureID++;\r\n};\r\n\r\nvariableHandlers.u[types.SAMPLERCUBE] = function (program: Program, variable: ProgramVariable) {\r\n    let pgl = program.gl!;\r\n    pgl.activeTexture(pgl.TEXTURE0 + program._textureID);\r\n    pgl.bindTexture(pgl.TEXTURE_CUBE_MAP, variable.value);\r\n    pgl.uniform1i(variable._pName, program._textureID);\r\n    program._textureID++;\r\n};\r\n\r\nvariableHandlers.u[types.SAMPLER2DARRAY] = function (program: Program, variable: ProgramVariable) {\r\n    let value = variable.value as Int32Array;\r\n    let pgl = program.gl!,\r\n        size = value.length;\r\n    let samplerArr = new Int32Array(size);\r\n    for (let i = 0; i < size; i++) {\r\n        pgl.activeTexture(pgl.TEXTURE0 + program._textureID + i);\r\n        pgl.bindTexture(pgl.TEXTURE_2D, value[i]);\r\n        samplerArr[i] = i;\r\n    }\r\n    pgl.uniform1iv(variable._pName, samplerArr);\r\n};\r\n\r\nvariableHandlers.u[types.INTXX] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform1iv(variable._pName, variable.value as Int32Array);\r\n};\r\n\r\nvariableHandlers.u[types.FLOATXX] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.uniform1fv(variable._pName, variable.value as Float32Array);\r\n};\r\n\r\n/*========================\r\n   Attributes callbacks\r\n ========================*/\r\nvariableHandlers.a[types.FLOAT] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.vertexAttrib1f(variable._pName as number, variable.value as number);\r\n};\r\n\r\nvariableHandlers.a[types.VEC2] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.vertexAttrib2fv(variable._pName as number, variable.value as Float32Array);\r\n};\r\n\r\nvariableHandlers.a[types.VEC3] = function (program: Program, variable: ProgramVariable) {\r\n    program.gl!.vertexAttrib3fv(variable._pName as number, variable.value as Float32Array);\r\n};\r\n\r\n//VariableHandlers.a[types.VEC4] = function (program, variable) {\r\n//    program.gl.vertexAttrib4fv(variable._pName, variable.value);\r\n//};\r\n","import {cons} from \"../cons\";\r\nimport type {ProgramVariable} from \"./variableHandlers\";\r\nimport {variableHandlers} from \"./variableHandlers\";\r\nimport {types, typeStr} from \"./types\";\r\nimport type {WebGLBufferExt} from \"./Handler\";\r\n\r\nconst itemTypes: string[] = [\"BYTE\", \"SHORT\", \"UNSIGNED_BYTE\", \"UNSIGNED_SHORT\", \"FLOAT\", \"HALF_FLOAT\"];\r\n\r\ntype WebGLProgramExt = WebGLProgram & { [id: string]: WebGLUniformLocation };\r\n\r\ntype ProgramMaterial = {\r\n    attributes: Record<string, any>;\r\n    uniforms: Record<string, any>,\r\n    vertexShader: string;\r\n    fragmentShader: string\r\n};\r\n\r\nfunction injectWebGL2Define(src: string, isWebGL2: boolean): string {\r\n    if (!isWebGL2) return src;\r\n\r\n    const lines = src.split('\\n');\r\n    const versionIndex = lines.findIndex(line => line.startsWith('#version'));\r\n\r\n    if (versionIndex !== -1) {\r\n        lines.splice(versionIndex + 1, 0, '#define WEBGL2');\r\n        return lines.join('\\n');\r\n    } else {\r\n        return src;\r\n    }\r\n}\r\n\r\n/**\r\n * Represents more comfortable using WebGL shader program.\r\n * @class\r\n * @param {string} name - Program name.\r\n * @param {ProgramMaterial} material - Object stores uniforms, attributes and program codes:\r\n * @param {Record<string, any>} material.uniforms - Uniforms definition section.\r\n * @param {Record<string, any>} material.attributes - Attributes definition section.\r\n * @param {string} material.vertexShader - Vertex glsl code.\r\n * @param {string} material.fragmentShader - Fragment glsl code.\r\n */\r\nclass Program {\r\n    /**\r\n     * Shader program name.\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public name: string;\r\n\r\n    public attributes: { [id: string]: number };\r\n\r\n    public uniforms: { [id: string]: WebGLUniformLocation };\r\n\r\n    public _attributes: Record<string, ProgramVariable>;\r\n\r\n    public _uniforms: Record<string, ProgramVariable>;\r\n\r\n    public vertexShader: string;\r\n\r\n    public fragmentShader: string;\r\n\r\n    public drawElementsInstanced: Function | null;\r\n    public vertexAttribDivisor: Function | null;\r\n\r\n    /**\r\n     * Webgl context.\r\n     * @public\r\n     * @type {WebGL2RenderingContext | null}\r\n     */\r\n    public gl: WebGL2RenderingContext | null;\r\n\r\n    /**\r\n     * All program variables.\r\n     * @private\r\n     * @type {Record<string, ProgramVariable>}\r\n     */\r\n    protected _variables: Record<string, ProgramVariable>;\r\n\r\n    /**\r\n     * Program pointer.\r\n     * @private\r\n     * @type {WebGLProgramExt | null}\r\n     */\r\n    public _p: WebGLProgramExt | null;\r\n\r\n    /**\r\n     * Texture counter.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    public _textureID: number;\r\n\r\n    /**\r\n     * Program attributes array.\r\n     * @private\r\n     * @type {number[]}\r\n     */\r\n    protected _attribArrays: number[];\r\n\r\n    /**\r\n     * Program attributes divisors.\r\n     * @protected\r\n     * @type {number[]}\r\n     */\r\n    protected _attribDivisor: number[];\r\n\r\n    constructor(name: string, material: ProgramMaterial) {\r\n\r\n        this.name = name;\r\n\r\n        this._attributes = {};\r\n        for (let t in material.attributes) {\r\n            if (\r\n                typeof material.attributes[t] === \"string\" ||\r\n                typeof material.attributes[t] === \"number\"\r\n            ) {\r\n                this._attributes[t] = {type: material.attributes[t]} as ProgramVariable;\r\n            } else {\r\n                this._attributes[t] = material.attributes[t];\r\n            }\r\n        }\r\n\r\n        this._uniforms = {};\r\n        for (let t in material.uniforms) {\r\n            if (\r\n                typeof material.uniforms[t] === \"string\" ||\r\n                typeof material.uniforms[t] === \"number\"\r\n            ) {\r\n                this._uniforms[t] = {type: material.uniforms[t]} as ProgramVariable;\r\n            } else {\r\n                this._uniforms[t] = material.uniforms[t];\r\n            }\r\n        }\r\n\r\n        this.vertexShader = material.vertexShader;\r\n\r\n        this.fragmentShader = material.fragmentShader;\r\n\r\n        this.gl = null;\r\n\r\n        this._variables = {};\r\n\r\n        this._p = null;\r\n\r\n        this._textureID = 0;\r\n\r\n        this._attribArrays = [];\r\n\r\n        this._attribDivisor = [];\r\n\r\n        this.attributes = {};\r\n\r\n        this.uniforms = {};\r\n\r\n        this.vertexAttribDivisor = null;\r\n        this.drawElementsInstanced = null;\r\n    }\r\n\r\n    /**\r\n     * Bind program buffer.\r\n     * @function\r\n     * @param {Program} program - Used program.\r\n     * @param {Object} variable - Variable represents buffer data.\r\n     */\r\n    static bindBuffer(program: Program, variable: ProgramVariable) {\r\n        let gl = program.gl;\r\n        if (gl) {\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, variable.value);\r\n            gl.vertexAttribPointer(\r\n                variable._pName as number,\r\n                (variable.value as WebGLBufferExt).itemSize,\r\n                variable.itemType as number,\r\n                variable.normalized,\r\n                0,\r\n                0\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets the current program frame.\r\n     * @public\r\n     */\r\n    public use() {\r\n        this.gl && this.gl.useProgram(this._p!);\r\n    }\r\n\r\n    /**\r\n     * Sets program variables.\r\n     * @public\r\n     * @param {Object} material - Variables and values object.\r\n     */\r\n    public set(material: Record<string, any>) {\r\n        this._textureID = 0;\r\n        for (let i in material) {\r\n            this._variables[i].value = material[i];\r\n            this._variables[i].func(this, this._variables[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply current variables.\r\n     * @public\r\n     */\r\n    public apply() {\r\n        this._textureID = 0;\r\n        let v = this._variables;\r\n        for (let i in v) {\r\n            v[i].func(this, v[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Calls drawElements index buffer function.\r\n     * @public\r\n     * @param {number} mode - Draw mode(GL_TRIANGLES, GL_LINESTRING etc.).\r\n     * @param {Object} buffer - Index buffer.\r\n     */\r\n    public drawIndexBuffer(mode: number, buffer: WebGLBufferExt) {\r\n        let gl = this.gl!;\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\r\n        gl.drawElements(mode, buffer.numItems, gl.UNSIGNED_SHORT, 0);\r\n    }\r\n\r\n    /**\r\n     * Calls drawArrays function.\r\n     * @public\r\n     * @param {number} mode - Draw mode GL_TRIANGLES, GL_LINESTRING, etc.\r\n     * @param {number} numItems - Items to draw\r\n     */\r\n    public drawArrays(mode: number, numItems: number) {\r\n        this.gl!.drawArrays(mode, 0, numItems);\r\n    }\r\n\r\n    /**\r\n     * Check and log for a shader compile errors and warnings. Returns True - if no errors otherwise returns False.\r\n     * @private\r\n     * @param {WebGLShader} shader - WebGl shader program.\r\n     * @param {string} src - Shader program source.\r\n     * @returns {boolean} -\r\n     */\r\n    protected _getShaderCompileStatus(shader: WebGLShader, src: string): boolean {\r\n\r\n        if (!this.gl) return false;\r\n\r\n        const isWebGL2 = this.gl instanceof WebGL2RenderingContext;\r\n        this.gl.shaderSource(shader, injectWebGL2Define(src, isWebGL2));\r\n        this.gl.compileShader(shader);\r\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\r\n            cons.logErr(\r\n                `Shader program \"${this.name}\":${this.gl.getShaderInfoLog(shader)}.`\r\n            );\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns compiled vertex shader program pointer.\r\n     * @private\r\n     * @param {string} src - Vertex shader source code.\r\n     * @returns {Object} -\r\n     */\r\n    protected _createVertexShader(src: string): WebGLShader | undefined {\r\n        if (!this.gl) return;\r\n        let shader = this.gl.createShader(this.gl.VERTEX_SHADER);\r\n        if (shader && this._getShaderCompileStatus(shader, src)) {\r\n            return shader;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns compiled fragment shader program pointer.\r\n     * @private\r\n     * @param {string} src - Vertex shader source code.\r\n     * @returns {Object} -\r\n     */\r\n    protected _createFragmentShader(src: string): WebGLShader | undefined {\r\n        if (!this.gl) return;\r\n        let shader = this.gl.createShader(this.gl.FRAGMENT_SHADER);\r\n        if (shader && this._getShaderCompileStatus(shader, src)) {\r\n            return shader;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disable current program vertexAttribArrays.\r\n     * @public\r\n     */\r\n    public disableAttribArrays() {\r\n        let gl = this.gl!;\r\n        let a = this._attribArrays;\r\n        for (let i = 0, len = a.length; i < len; i++) {\r\n            gl.disableVertexAttribArray(a[i]);\r\n            this.vertexAttribDivisor!(a[i], 0);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Enable current program vertexAttribArrays.\r\n     * @public\r\n     */\r\n    public enableAttribArrays() {\r\n        let gl = this.gl!;\r\n        let a = this._attribArrays;\r\n        let d = this._attribDivisor;\r\n        for (let i = 0, len = a.length; i < len; i++) {\r\n            gl.enableVertexAttribArray(a[i]);\r\n            this.vertexAttribDivisor!(a[i], d[i]);\r\n        }\r\n    }\r\n\r\n    // public vertexAttribDivisor(index: number, divisor: number) {\r\n    //     const gl = this.gl!;\r\n    //     gl.vertexAttribDivisor ?\r\n    //         gl.vertexAttribDivisor(index, divisor) :\r\n    //         gl.getExtension('ANGLE_instanced_arrays').vertexAttribDivisorANGLE(index, divisor);\r\n    // }\r\n\r\n    /**\r\n     * Delete program.\r\n     * @public\r\n     */\r\n    public delete() {\r\n        this.gl && this.gl.deleteProgram(this._p!);\r\n    }\r\n\r\n    /**\r\n     * Creates program.\r\n     * @public\r\n     * @param {Object} gl - WebGl context.\r\n     */\r\n    public createProgram(gl: WebGL2RenderingContext) {\r\n        this.gl = gl;\r\n\r\n        this._p = this.gl.createProgram() as WebGLProgramExt;\r\n\r\n        if (!this._p) return;\r\n\r\n        let fs = this._createFragmentShader(this.fragmentShader);\r\n        let vs = this._createVertexShader(this.vertexShader);\r\n\r\n        if (!fs || !vs) return;\r\n\r\n        gl.attachShader(this._p, fs);\r\n        gl.attachShader(this._p, vs);\r\n\r\n        gl.linkProgram(this._p);\r\n\r\n\r\n        if (!this.drawElementsInstanced) {\r\n            if (gl.drawElementsInstanced) {\r\n                this.drawElementsInstanced = gl.drawElementsInstanced.bind(gl);\r\n            } else {\r\n                let ext = gl.getExtension('ANGLE_instanced_arrays');\r\n                if (ext) {\r\n                    this.drawElementsInstanced = ext.drawElementsInstancedANGLE.bind(ext);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!this.vertexAttribDivisor) {\r\n            if (gl.vertexAttribDivisor) {\r\n                this.vertexAttribDivisor = gl.vertexAttribDivisor.bind(gl);\r\n            } else {\r\n                let ext = gl.getExtension('ANGLE_instanced_arrays');\r\n                if (ext) {\r\n                    this.vertexAttribDivisor = ext.vertexAttribDivisorANGLE.bind(ext);\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        if (!gl.getProgramParameter(this._p, gl.LINK_STATUS)) {\r\n            cons.logErr(`Shader program \"${this.name}\": initialization failed. ${gl.getProgramInfoLog(this._p)}.`);\r\n            gl.deleteProgram(this._p);\r\n            return;\r\n        }\r\n\r\n        this.use();\r\n\r\n        for (let a in this._attributes) {\r\n            //this.attributes[a]._name = a;\r\n            this._variables[a] = this._attributes[a];\r\n            this._attributes[a].func = Program.bindBuffer;\r\n\r\n            let t = this._attributes[a].itemType as string;\r\n            let itemTypeStr: string = t ? t.trim().toUpperCase() : \"FLOAT\";\r\n\r\n            if (itemTypes.indexOf(itemTypeStr) == -1) {\r\n                cons.logErr(`Shader program \"${this.name}\": attribute '${a}', item type '${this._attributes[a].itemType}' not exists.`);\r\n                this._attributes[a].itemType = gl.FLOAT;\r\n            } else {\r\n                this._attributes[a].itemType = (gl as any)[itemTypeStr];\r\n            }\r\n\r\n            this._attributes[a].normalized = this._attributes[a].normalized || false;\r\n            this._attributes[a].divisor = this._attributes[a].divisor || 0;\r\n\r\n            this._p[a] = gl.getAttribLocation(this._p, a);\r\n\r\n            if (this._p[a] == undefined) {\r\n                cons.logErr(`Shader program \"${this.name}\":  attribute '${a}' not exists.`);\r\n                gl.deleteProgram(this._p);\r\n                return;\r\n            }\r\n\r\n            let type: string | number = this._attributes[a].type;\r\n            if (typeof type === \"string\") {\r\n                type = typeStr[type.trim().toLowerCase()];\r\n            }\r\n\r\n            let d = this._attributes[a].divisor;\r\n            if (type === types.MAT4) {\r\n                let loc = this._p[a] as number;\r\n                this._attribArrays.push(loc, loc + 1, loc + 2, loc + 3);\r\n                this._attribDivisor.push(d, d, d, d);\r\n            } else {\r\n                this._attribArrays.push(this._p[a] as number);\r\n                this._attribDivisor.push(d);\r\n            }\r\n\r\n            gl.enableVertexAttribArray(this._p[a] as number);\r\n\r\n            this._attributes[a]._pName = this._p[a];\r\n            this.attributes[a] = this._p[a] as number;\r\n        }\r\n\r\n        for (let u in this._uniforms) {\r\n\r\n            if (typeof this._uniforms[u].type === \"string\") {\r\n                let t: string = this._uniforms[u].type as string;\r\n                this._uniforms[u].func = variableHandlers.u[typeStr[t.trim().toLowerCase()]];\r\n            } else {\r\n                this._uniforms[u].func = variableHandlers.u[this._uniforms[u].type as number];\r\n            }\r\n\r\n            this._variables[u] = this._uniforms[u];\r\n            this._p[u] = gl.getUniformLocation(this._p, u)!;\r\n\r\n            if (this._p[u] == undefined) {\r\n                cons.logErr(`Shader program \"${this.name}\": uniform '${u}' not exists.`);\r\n                gl.deleteProgram(this._p);\r\n                return;\r\n            }\r\n\r\n            this._uniforms[u]._pName = this._p[u];\r\n            this.uniforms[u] = this._p[u];\r\n        }\r\n\r\n        gl.detachShader(this._p as WebGLProgram, fs);\r\n        gl.detachShader(this._p as WebGLProgram, vs);\r\n\r\n        gl.deleteShader(fs);\r\n        gl.deleteShader(vs);\r\n    }\r\n}\r\n\r\nexport {Program};\r\n","precision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\nattribute vec2 a_vertices;\r\nattribute vec3 a_positionsHigh;\r\nattribute vec3 a_positionsLow;\r\nattribute vec3 a_offset;\r\nattribute vec2 a_size;\r\nattribute float a_rotation;\r\nattribute vec4 a_rgba;\r\n\r\nvarying vec3 v_rgb;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform vec3 uScaleByDistance;\r\nuniform float opacity;\r\nuniform float planetRadius;\r\nuniform vec2 viewport;\r\nuniform float depthOffset;\r\n\r\nconst vec3 ZERO3 = vec3(0.0);\r\n\r\n\r\nvoid main() {\r\n\r\n    vec3 a_positions = a_positionsHigh + a_positionsLow;\r\n    vec3 cameraPos = eyePositionHigh + eyePositionLow;\r\n\r\n    vec3 look = a_positions - cameraPos;\r\n    float lookDist = length(look);\r\n    v_rgb = a_rgba.rgb;\r\n\r\n    if (opacity * step(lookDist, sqrt(dot(cameraPos, cameraPos) - planetRadius) + sqrt(dot(a_positions, a_positions) - planetRadius)) == 0.0) {\r\n        return;\r\n    }\r\n\r\n    //vec3 up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\r\n    //vec3 right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\r\n\r\n    float scd = (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookDist)) * (1.0 - step(uScaleByDistance[2], lookDist));\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = a_positionsHigh - eyePositionHigh;\r\n    vec3 lowDiff = a_positionsLow - eyePositionLow;\r\n    vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n    vec4 projPos = projectionMatrix * posRTE;\r\n\r\n    float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));\r\n    if (camSlope > 0.5) {\r\n        float dist = dot(look, normalize(cameraPos));\r\n        projPos.z += dist * 0.02;\r\n    } else {\r\n        projPos.z += -(abs(projPos.z)) * 0.002;\r\n    }\r\n\r\n    projPos.z += depthOffset + a_offset.z;\r\n\r\n    vec2 screenPos = project(projPos, viewport);\r\n\r\n    vec2 v = screenPos + rotate2d(a_rotation) * (a_vertices * a_size * scd + a_offset.xy);\r\n\r\n    gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\r\n}","precision highp float;\r\n\r\nvarying vec3 v_rgb;\r\n\r\nvoid main() {\r\n    gl_FragColor = vec4(v_rgb, 1.0);\r\n}","precision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\nattribute vec2 a_vertices;\r\nattribute vec2 a_texCoord;\r\nattribute vec3 a_positionsHigh;\r\nattribute vec3 a_positionsLow;\r\nattribute vec3 a_offset;\r\nattribute vec2 a_size;\r\nattribute float a_rotation;\r\nattribute vec4 a_rgba;\r\n\r\nvarying vec2 v_texCoords;\r\nvarying vec4 v_rgba;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform vec3 uScaleByDistance;\r\nuniform float opacity;\r\nuniform float planetRadius;\r\nuniform vec2 viewport;\r\nuniform float depthOffset;\r\n\r\nconst vec3 ZERO3 = vec3(0.0);\r\n\r\nvoid main() {\r\n\r\n    vec3 a_positions = a_positionsHigh + a_positionsLow;\r\n    vec3 cameraPos = eyePositionHigh + eyePositionLow;\r\n\r\n    v_texCoords = a_texCoord;\r\n    vec3 look = a_positions - cameraPos;\r\n    float lookDist = length(look);\r\n    v_rgba = a_rgba;\r\n\r\n    if (opacity * step(lookDist, sqrt(dot(cameraPos, cameraPos) - planetRadius) + sqrt(dot(a_positions, a_positions) - planetRadius)) == 0.0) {\r\n        return;\r\n    }\r\n\r\n    //vec3 up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\r\n    //vec3 right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\r\n\r\n    float scd = (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookDist)) * (1.0 - step(uScaleByDistance[2], lookDist));\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = a_positionsHigh - eyePositionHigh;\r\n    vec3 lowDiff = a_positionsLow - eyePositionLow;\r\n    vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n    vec4 projPos = projectionMatrix * posRTE;\r\n\r\n    float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));\r\n    if (camSlope > 0.5) {\r\n        float dist = dot(look, normalize(cameraPos));\r\n        projPos.z += dist * 0.02;\r\n    } else {\r\n        projPos.z += -(abs(projPos.z)) * 0.002;\r\n    }\r\n\r\n    projPos.z += depthOffset + a_offset.z;\r\n\r\n    vec2 screenPos = project(projPos, viewport);\r\n\r\n    vec2 v = screenPos + rotate2d(a_rotation) * (a_vertices * a_size * scd + a_offset.xy);\r\n\r\n    gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\r\n}","precision highp float;\r\nuniform sampler2D u_texture;\r\nvarying vec2 v_texCoords;\r\nvarying vec4 v_rgba;\r\nvoid main () {\r\n    vec4 color = texture2D(u_texture, v_texCoords);\r\n    if(color.a < 0.1)\r\n    discard;\r\n    gl_FragColor = color * v_rgba;\r\n}","import {Program} from '../../webgl/Program';\r\n\r\nimport billboard_picking_vert from './billboard_picking.vert.glsl';\r\nimport billboard_picking_frag from './billboard_picking.frag.glsl';\r\n\r\nimport billboard_screen_vert from './billboard_screen.vert.glsl';\r\nimport billboard_screen_frag from './billboard_screen.frag.glsl';\r\n\r\nexport function billboardPicking(): Program {\r\n    return new Program(\"billboardPicking\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            planetRadius: \"float\",\r\n            uScaleByDistance: \"vec3\",\r\n            opacity: \"float\",\r\n            depthOffset: \"float\"\r\n        },\r\n        attributes: {\r\n            a_vertices: \"vec2\",\r\n            a_positionsHigh: \"vec3\",\r\n            a_positionsLow: \"vec3\",\r\n            a_offset: \"vec3\",\r\n            a_size: \"vec2\",\r\n            a_rotation: \"float\",\r\n            a_rgba: \"vec4\"\r\n        },\r\n        vertexShader: billboard_picking_vert,\r\n        fragmentShader: billboard_picking_frag\r\n    });\r\n}\r\n\r\nexport function billboard_screen(): Program {\r\n    return new Program(\"billboard\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            u_texture: \"sampler2d\",\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            planetRadius: \"float\",\r\n            uScaleByDistance: \"vec3\",\r\n            opacity: \"float\",\r\n            depthOffset: \"float\"\r\n        },\r\n        attributes: {\r\n            a_vertices: \"vec2\",\r\n            a_texCoord: \"vec2\",\r\n            a_positionsHigh: \"vec3\",\r\n            a_positionsLow: \"vec3\",\r\n            a_offset: \"vec3\",\r\n            a_size: \"vec2\",\r\n            a_rotation: \"float\",\r\n            a_rgba: \"vec4\",\r\n        },\r\n        vertexShader: billboard_screen_vert,\r\n        fragmentShader: billboard_screen_frag\r\n    });\r\n}","import * as shaders from \"../shaders/billboard/billboard\";\r\nimport {spliceTypedArray} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {LOCK_FREE} from \"./LabelWorker\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\nimport {BaseBillboard} from \"./BaseBillboard\";\r\n\r\nconst PICKINGCOLOR_BUFFER = 0;\r\nconst POSITION_BUFFER = 1;\r\nconst SIZE_BUFFER = 2;\r\nconst OFFSET_BUFFER = 3;\r\nconst RGBA_BUFFER = 4;\r\nconst ROTATION_BUFFER = 5;\r\nconst TEXCOORD_BUFFER = 6;\r\nconst VERTEX_BUFFER = 7;\r\n\r\n/**\r\n * @class BaseBillboardHandler\r\n */\r\nclass BaseBillboardHandler {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    public __id: number;\r\n\r\n    /**\r\n     * Picking rendering option.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public pickingEnabled: boolean;\r\n\r\n    public _entityCollection: EntityCollection;\r\n\r\n    protected _renderer: Renderer | null;\r\n\r\n    protected _billboards: BaseBillboard[];\r\n\r\n    protected _positionHighBuffer: WebGLBufferExt | null;\r\n    protected _positionLowBuffer: WebGLBufferExt | null;\r\n    protected _sizeBuffer: WebGLBufferExt | null;\r\n    protected _offsetBuffer: WebGLBufferExt | null;\r\n    protected _rgbaBuffer: WebGLBufferExt | null;\r\n    protected _rotationBuffer: WebGLBufferExt | null;\r\n    protected _texCoordBuffer: WebGLBufferExt | null;\r\n    protected _vertexBuffer: WebGLBufferExt | null;\r\n\r\n    protected _texCoordArr: Float32Array;\r\n    protected _vertexArr: Float32Array;\r\n    protected _positionHighArr: Float32Array;\r\n    protected _positionLowArr: Float32Array;\r\n    protected _sizeArr: Float32Array;\r\n    protected _offsetArr: Float32Array;\r\n    protected _rgbaArr: Float32Array;\r\n    protected _rotationArr: Float32Array;\r\n\r\n    protected _pickingColorBuffer: WebGLBufferExt | null;\r\n    protected _pickingColorArr: Float32Array;\r\n\r\n    protected _buffersUpdateCallbacks: Function[];\r\n\r\n    protected _changedBuffers: boolean[];\r\n\r\n    constructor(entityCollection: EntityCollection) {\r\n\r\n        this.__id = BaseBillboardHandler.__counter__++;\r\n\r\n        this.pickingEnabled = true;\r\n\r\n        this._entityCollection = entityCollection;\r\n\r\n        this._renderer = null;\r\n\r\n        this._billboards = [];\r\n\r\n        this._positionHighBuffer = null;\r\n        this._positionLowBuffer = null;\r\n        this._sizeBuffer = null;\r\n        this._offsetBuffer = null;\r\n        this._rgbaBuffer = null;\r\n        this._rotationBuffer = null;\r\n        this._texCoordBuffer = null;\r\n        this._vertexBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n\r\n        this._texCoordArr = new Float32Array([]);\r\n        this._vertexArr = new Float32Array([]);\r\n        this._positionHighArr = new Float32Array([]);\r\n        this._positionLowArr = new Float32Array([]);\r\n        this._sizeArr = new Float32Array([]);\r\n        this._offsetArr = new Float32Array([]);\r\n        this._rgbaArr = new Float32Array([]);\r\n        this._rotationArr = new Float32Array([]);\r\n        this._pickingColorArr = new Float32Array([]);\r\n\r\n        this._buffersUpdateCallbacks = [];\r\n        this._buffersUpdateCallbacks[PICKINGCOLOR_BUFFER] = this.createPickingColorBuffer;\r\n        this._buffersUpdateCallbacks[POSITION_BUFFER] = this.createPositionBuffer;\r\n        this._buffersUpdateCallbacks[SIZE_BUFFER] = this.createSizeBuffer;\r\n        this._buffersUpdateCallbacks[OFFSET_BUFFER] = this.createOffsetBuffer;\r\n        this._buffersUpdateCallbacks[RGBA_BUFFER] = this.createRgbaBuffer;\r\n        this._buffersUpdateCallbacks[ROTATION_BUFFER] = this.createRotationBuffer;\r\n        this._buffersUpdateCallbacks[TEXCOORD_BUFFER] = this.createTexCoordBuffer;\r\n        this._buffersUpdateCallbacks[VERTEX_BUFFER] = this.createVertexBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n    }\r\n\r\n    public isEqual(handler: BaseBillboardHandler) {\r\n        return handler && (handler.__id === this.__id);\r\n    }\r\n\r\n    static concArr(dest: number[], curr: number[]) {\r\n        for (let i = 0; i < curr.length; i++) {\r\n            dest.push(curr[i]);\r\n        }\r\n    }\r\n\r\n    public initProgram() {\r\n        if (this._renderer && this._renderer.handler) {\r\n            if (!this._renderer.handler.programs.billboard) {\r\n                this._renderer.handler.addProgram(shaders.billboard_screen());\r\n            }\r\n\r\n            if (!this._renderer.handler.programs.billboardPicking) {\r\n                this._renderer.handler.addProgram(shaders.billboardPicking());\r\n            }\r\n        }\r\n    }\r\n\r\n    public setRenderer(renderer: Renderer) {\r\n        this._renderer = renderer;\r\n        this.initProgram();\r\n    }\r\n\r\n    public refresh() {\r\n        let i = this._changedBuffers.length;\r\n        while (i--) {\r\n            this._changedBuffers[i] = true;\r\n        }\r\n    }\r\n\r\n    protected _removeBillboards() {\r\n        let i = this._billboards.length;\r\n        while (i--) {\r\n            let bi = this._billboards[i];\r\n            bi._handlerIndex = -1;\r\n            bi._handler = null;\r\n            bi._isReady = false;\r\n            bi._lockId = LOCK_FREE;\r\n        }\r\n        this._billboards.length = 0;\r\n        this._billboards = [];\r\n    }\r\n\r\n    public clear() {\r\n        // @ts-ignore\r\n        this._texCoordArr = null;\r\n        // @ts-ignore\r\n        this._vertexArr = null;\r\n        // @ts-ignore\r\n        this._positionHighArr = null;\r\n        // @ts-ignore\r\n        this._positionLowArr = null;\r\n        // @ts-ignore\r\n        this._sizeArr = null;\r\n        // @ts-ignore\r\n        this._offsetArr = null;\r\n        // @ts-ignore\r\n        this._rgbaArr = null;\r\n        // @ts-ignore\r\n        this._rotationArr = null;\r\n        // @ts-ignore\r\n        this._pickingColorArr = null;\r\n\r\n        this._texCoordArr = new Float32Array([]);\r\n        this._vertexArr = new Float32Array([]);\r\n        this._positionHighArr = new Float32Array([]);\r\n        this._positionLowArr = new Float32Array([]);\r\n        this._sizeArr = new Float32Array([]);\r\n        this._offsetArr = new Float32Array([]);\r\n        this._rgbaArr = new Float32Array([]);\r\n        this._rotationArr = new Float32Array([]);\r\n        this._pickingColorArr = new Float32Array([]);\r\n\r\n        this._removeBillboards();\r\n        this._deleteBuffers();\r\n        this.refresh();\r\n    }\r\n\r\n    protected _deleteBuffers() {\r\n        if (this._renderer) {\r\n            let gl = this._renderer.handler.gl!;\r\n            gl.deleteBuffer(this._positionHighBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._positionLowBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._sizeBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._offsetBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._rgbaBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._rotationBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._vertexBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._texCoordBuffer as WebGLBuffer);\r\n            gl.deleteBuffer(this._pickingColorBuffer as WebGLBuffer);\r\n        }\r\n\r\n        this._positionHighBuffer = null;\r\n        this._positionLowBuffer = null;\r\n        this._sizeBuffer = null;\r\n        this._offsetBuffer = null;\r\n        this._rgbaBuffer = null;\r\n        this._rotationBuffer = null;\r\n        this._vertexBuffer = null;\r\n        this._texCoordBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n    }\r\n\r\n    public update() {\r\n        if (this._renderer) {\r\n            let i = this._changedBuffers.length;\r\n            while (i--) {\r\n                if (this._changedBuffers[i]) {\r\n                    this._buffersUpdateCallbacks[i].call(this);\r\n                    this._changedBuffers[i] = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public add(billboard: BaseBillboard) {\r\n        if (billboard._handlerIndex == -1) {\r\n            billboard._isReady = true;\r\n            billboard._handler = this;\r\n            billboard._handlerIndex = this._billboards.length;\r\n            this._billboards.push(billboard);\r\n        }\r\n    }\r\n\r\n    protected _displayPASS() {\r\n        let r = this._renderer!;\r\n        let h = r.handler;\r\n        h.programs.billboard.activate();\r\n        let sh = h.programs.billboard._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        let gl = h.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n        gl.uniform1i(shu.u_texture, 0);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera!.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera!.getProjectionMatrix());\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera!.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera!.eyeLow);\r\n\r\n        gl.uniform3fv(shu.uScaleByDistance, ec.scaleByDistance);\r\n\r\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_texCoord, this._texCoordBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_rgba, this._rgbaBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform1f(shu.planetRadius, (ec.renderNode as Planet)._planetRadius2 || 0);\r\n\r\n        gl.uniform2fv(shu.viewport, [h.canvas!.clientWidth, h.canvas!.clientHeight]);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer!.numItems);\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n    }\r\n\r\n    protected _pickingPASS() {\r\n        let r = this._renderer!;\r\n        let h = r.handler;\r\n        h.programs.billboardPicking.activate();\r\n        let sh = h.programs.billboardPicking._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        let gl = h.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera!.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera!.getProjectionMatrix());\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera!.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera!.eyeLow);\r\n\r\n        gl.uniform3fv(shu.uScaleByDistance, ec.scaleByDistance);\r\n\r\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._pickingColorBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_rgba, this._pickingColorBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform1f(shu.planetRadius, (ec.renderNode as Planet)._planetRadius2 || 0);\r\n\r\n        gl.uniform2fv(shu.viewport, [h.canvas!.clientWidth, h.canvas!.clientHeight]);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer!.numItems);\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n    }\r\n\r\n    public draw() {\r\n        if (this._billboards.length) {\r\n            this.update();\r\n            this._displayPASS();\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this._billboards.length && this.pickingEnabled) {\r\n            this._pickingPASS();\r\n        }\r\n    }\r\n\r\n    public reindexBillboardsArray(startIndex: number) {\r\n        let b = this._billboards;\r\n        for (let i = startIndex; i < b.length; i++) {\r\n            b[i]._handlerIndex = i;\r\n        }\r\n    }\r\n\r\n    protected _removeBillboard(billboard: BaseBillboard) {\r\n\r\n        let bi = billboard._handlerIndex;\r\n\r\n        this._billboards.splice(bi, 1);\r\n\r\n        let i = bi * 24;\r\n        this._rgbaArr = spliceTypedArray(this._rgbaArr, i, 24) as Float32Array;\r\n\r\n        i = bi * 18;\r\n        this._positionHighArr = spliceTypedArray(this._positionHighArr, i, 18) as Float32Array;\r\n        this._positionLowArr = spliceTypedArray(this._positionLowArr, i, 18) as Float32Array;\r\n        this._offsetArr = spliceTypedArray(this._offsetArr, i, 18) as Float32Array;\r\n        //this._alignedAxisArr = spliceTypedArray(this._alignedAxisArr, i, 18) as Float32Array;\r\n        this._pickingColorArr = spliceTypedArray(this._pickingColorArr, i, 18) as Float32Array;\r\n\r\n        i = bi * 12;\r\n        this._vertexArr = spliceTypedArray(this._vertexArr, i, 12) as Float32Array;\r\n        this._sizeArr = spliceTypedArray(this._sizeArr, i, 12) as Float32Array;\r\n        this._texCoordArr = spliceTypedArray(this._texCoordArr, i, 12) as Float32Array;\r\n\r\n        i = bi * 6;\r\n        this._rotationArr = spliceTypedArray(this._rotationArr, i, 6) as Float32Array;\r\n\r\n        this.reindexBillboardsArray(bi);\r\n        this.refresh();\r\n\r\n        billboard._handlerIndex = -1;\r\n        billboard._handler = null;\r\n        billboard._isReady = false;\r\n        billboard._lockId = LOCK_FREE;\r\n    }\r\n\r\n    public setAlignedAxisArr(index: number, alignedAxis: Vec3) {\r\n        //...\r\n    }\r\n\r\n    public remove(billboard: BaseBillboard) {\r\n        if (billboard._handler) {\r\n            if (billboard._isReady && this.__id === billboard._handler.__id) {\r\n                this._removeBillboard(billboard);\r\n            } else {\r\n                billboard._handler = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    public setPositionArr(index: number, positionHigh: Vec3, positionLow: Vec3) {\r\n        let i = index * 18;\r\n\r\n        // High\r\n        let a = this._positionHighArr,\r\n            x = positionHigh.x,\r\n            y = positionHigh.y,\r\n            z = positionHigh.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        // Low\r\n        a = this._positionLowArr;\r\n        x = positionLow.x;\r\n        y = positionLow.y;\r\n        z = positionLow.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        this._changedBuffers[POSITION_BUFFER] = true;\r\n    }\r\n\r\n    public setPickingColorArr(index: number, color: Vec3) {\r\n        let i = index * 18;\r\n        let a = this._pickingColorArr,\r\n            x = color.x / 255,\r\n            y = color.y / 255,\r\n            z = color.z / 255;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        this._changedBuffers[PICKINGCOLOR_BUFFER] = true;\r\n    }\r\n\r\n    public setSizeArr(index: number, width: number, height: number) {\r\n        let i = index * 12;\r\n        let a = this._sizeArr,\r\n            x = width,\r\n            y = height;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n\r\n        a[i + 2] = x;\r\n        a[i + 3] = y;\r\n\r\n        a[i + 4] = x;\r\n        a[i + 5] = y;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n\r\n        a[i + 8] = x;\r\n        a[i + 9] = y;\r\n\r\n        a[i + 10] = x;\r\n        a[i + 11] = y;\r\n\r\n        this._changedBuffers[SIZE_BUFFER] = true;\r\n    }\r\n\r\n    public setOffsetArr(index: number, offset: Vec3) {\r\n        let i = index * 18;\r\n        let a = this._offsetArr,\r\n            x = offset.x,\r\n            y = offset.y,\r\n            z = offset.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        this._changedBuffers[OFFSET_BUFFER] = true;\r\n    }\r\n\r\n    public setRgbaArr(index: number, rgba: Vec4) {\r\n        let i = index * 24;\r\n        let a = this._rgbaArr,\r\n            x = rgba.x,\r\n            y = rgba.y,\r\n            z = rgba.z,\r\n            w = rgba.w;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n        a[i + 3] = w;\r\n\r\n        a[i + 4] = x;\r\n        a[i + 5] = y;\r\n        a[i + 6] = z;\r\n        a[i + 7] = w;\r\n\r\n        a[i + 8] = x;\r\n        a[i + 9] = y;\r\n        a[i + 10] = z;\r\n        a[i + 11] = w;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n        a[i + 15] = w;\r\n\r\n        a[i + 16] = x;\r\n        a[i + 17] = y;\r\n        a[i + 18] = z;\r\n        a[i + 19] = w;\r\n\r\n        a[i + 20] = x;\r\n        a[i + 21] = y;\r\n        a[i + 22] = z;\r\n        a[i + 23] = w;\r\n\r\n        this._changedBuffers[RGBA_BUFFER] = true;\r\n    }\r\n\r\n    public setRotationArr(index: number, rotation: number) {\r\n        let i = index * 6;\r\n        let a = this._rotationArr;\r\n\r\n        a[i] = rotation;\r\n        a[i + 1] = rotation;\r\n        a[i + 2] = rotation;\r\n        a[i + 3] = rotation;\r\n        a[i + 4] = rotation;\r\n        a[i + 5] = rotation;\r\n\r\n        this._changedBuffers[ROTATION_BUFFER] = true;\r\n    }\r\n\r\n    public setTexCoordArr(index: number, tcoordArr: number[] | TypedArray) {\r\n        let i = index * 12;\r\n        let a = this._texCoordArr;\r\n\r\n        a[i] = tcoordArr[0];\r\n        a[i + 1] = tcoordArr[1];\r\n\r\n        a[i + 2] = tcoordArr[2];\r\n        a[i + 3] = tcoordArr[3];\r\n\r\n        a[i + 4] = tcoordArr[4];\r\n        a[i + 5] = tcoordArr[5];\r\n\r\n        a[i + 6] = tcoordArr[6];\r\n        a[i + 7] = tcoordArr[7];\r\n\r\n        a[i + 8] = tcoordArr[8];\r\n        a[i + 9] = tcoordArr[9];\r\n\r\n        a[i + 10] = tcoordArr[10];\r\n        a[i + 11] = tcoordArr[11];\r\n\r\n        this._changedBuffers[TEXCOORD_BUFFER] = true;\r\n    }\r\n\r\n    public setVisibility(index: number, visibility: boolean) {\r\n        let vArr: number[];\r\n        if (visibility) {\r\n            vArr = [-0.5, 0.5, -0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, 0.5, -0.5, 0.5];\r\n        } else {\r\n            vArr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        }\r\n        this.setVertexArr(index, vArr);\r\n    }\r\n\r\n    public setVertexArr(index: number, vertexArr: number[] | Float32Array) {\r\n        let i = index * 12;\r\n        let a = this._vertexArr;\r\n\r\n        a[i] = vertexArr[0];\r\n        a[i + 1] = vertexArr[1];\r\n        a[i + 2] = vertexArr[2];\r\n\r\n        a[i + 3] = vertexArr[3];\r\n        a[i + 4] = vertexArr[4];\r\n        a[i + 5] = vertexArr[5];\r\n\r\n        a[i + 6] = vertexArr[6];\r\n        a[i + 7] = vertexArr[7];\r\n        a[i + 8] = vertexArr[8];\r\n\r\n        a[i + 9] = vertexArr[9];\r\n        a[i + 10] = vertexArr[10];\r\n        a[i + 11] = vertexArr[11];\r\n\r\n        this._changedBuffers[VERTEX_BUFFER] = true;\r\n    }\r\n\r\n    public createPositionBuffer() {\r\n        let h = this._renderer!.handler,\r\n            numItems = this._positionHighArr.length / 3;\r\n\r\n        if (!this._positionHighBuffer || this._positionHighBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._positionHighBuffer as WebGLBuffer);\r\n            h.gl!.deleteBuffer(this._positionLowBuffer as WebGLBuffer);\r\n            this._positionHighBuffer = h.createStreamArrayBuffer(3, numItems);\r\n            this._positionLowBuffer = h.createStreamArrayBuffer(3, numItems);\r\n        }\r\n\r\n        h.setStreamArrayBuffer(this._positionHighBuffer!, this._positionHighArr);\r\n        h.setStreamArrayBuffer(this._positionLowBuffer!, this._positionLowArr);\r\n    }\r\n\r\n    public createSizeBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._sizeBuffer as WebGLBuffer);\r\n        this._sizeBuffer = h.createArrayBuffer(this._sizeArr, 2, this._sizeArr.length / 2);\r\n    }\r\n\r\n    public createOffsetBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._offsetBuffer as WebGLBuffer);\r\n        this._offsetBuffer = h.createArrayBuffer(this._offsetArr, 3, this._offsetArr.length / 3);\r\n    }\r\n\r\n    createRgbaBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._rgbaBuffer as WebGLBuffer);\r\n        this._rgbaBuffer = h.createArrayBuffer(this._rgbaArr, 4, this._rgbaArr.length / 4);\r\n    }\r\n\r\n    public createRotationBuffer() {\r\n        let h = this._renderer!.handler;\r\n\r\n        if (!this._rotationBuffer || this._rotationBuffer.numItems !== this._rotationArr.length) {\r\n            h.gl!.deleteBuffer(this._rotationBuffer as WebGLBuffer);\r\n            this._rotationBuffer = h.createStreamArrayBuffer(1, this._rotationArr.length);\r\n        }\r\n\r\n        h.setStreamArrayBuffer(this._rotationBuffer, this._rotationArr);\r\n    }\r\n\r\n    public createVertexBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._vertexBuffer as WebGLBuffer);\r\n        this._vertexBuffer = h.createArrayBuffer(this._vertexArr, 2, this._vertexArr.length / 2);\r\n    }\r\n\r\n    public createTexCoordBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._texCoordBuffer as WebGLBuffer);\r\n        this._texCoordBuffer = h.createArrayBuffer(this._texCoordArr, 2, this._texCoordArr.length / 2);\r\n    }\r\n\r\n    //createAlignedAxisBuffer() {\r\n    //    var h = this._renderer.handler;\r\n    //    h.gl.deleteBuffer(this._alignedAxisBuffer);\r\n    //    this._alignedAxisBuffer = h.createArrayBuffer(\r\n    //        this._alignedAxisArr,\r\n    //        3,\r\n    //        this._alignedAxisArr.length / 3\r\n    //    );\r\n    //}\r\n\r\n    public createPickingColorBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._pickingColorBuffer as WebGLBuffer);\r\n        this._pickingColorBuffer = h.createArrayBuffer(this._pickingColorArr, 3, this._pickingColorArr.length / 3);\r\n    }\r\n\r\n    public refreshTexCoordsArr() {\r\n    }\r\n}\r\n\r\nexport {BaseBillboardHandler};","import {BaseBillboardHandler} from \"./BaseBillboardHandler\";\r\nimport {Billboard} from \"./Billboard\";\r\nimport {concatTypedArrays} from \"../utils/shared\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\n\r\n/**\r\n * @class BillboardHandler\r\n */\r\nclass BillboardHandler extends BaseBillboardHandler {\r\n\r\n    protected override _billboards: Billboard[];\r\n\r\n    constructor(props: EntityCollection) {\r\n        super(props);\r\n\r\n        this._billboards = [];\r\n    }\r\n\r\n    public override add(billboard: Billboard) {\r\n        if (billboard._handlerIndex == -1) {\r\n            super.add(billboard);\r\n\r\n            this._addBillboardToArrays(billboard);\r\n            this.refresh();\r\n            let src = billboard.getSrc() || (billboard.getImage() && billboard.getImage()!.src);\r\n            if (src) {\r\n                billboard.setSrc(src);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _addBillboardToArrays(billboard: Billboard) {\r\n        if (billboard.getVisibility()) {\r\n            this._vertexArr = concatTypedArrays(\r\n                this._vertexArr,\r\n                [-0.5, 0.5, -0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, 0.5, -0.5, 0.5]\r\n            ) as Float32Array;\r\n        } else {\r\n            this._vertexArr = concatTypedArrays(\r\n                this._vertexArr,\r\n                [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n            ) as Float32Array;\r\n        }\r\n\r\n        this._texCoordArr = concatTypedArrays(\r\n            this._texCoordArr,\r\n            [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\r\n        ) as Float32Array;\r\n\r\n        let x = billboard._positionHigh.x,\r\n            y = billboard._positionHigh.y,\r\n            z = billboard._positionHigh.z,\r\n            w;\r\n        this._positionHighArr = concatTypedArrays(this._positionHighArr, [\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z\r\n        ]) as Float32Array;\r\n\r\n        x = billboard._positionLow.x;\r\n        y = billboard._positionLow.y;\r\n        z = billboard._positionLow.z;\r\n        this._positionLowArr = concatTypedArrays(this._positionLowArr, [\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z\r\n        ]) as Float32Array;\r\n\r\n        x = billboard._width;\r\n        y = billboard._height;\r\n        this._sizeArr = concatTypedArrays(this._sizeArr, [x, y, x, y, x, y, x, y, x, y, x, y]) as Float32Array;\r\n\r\n        x = billboard._offset.x;\r\n        y = billboard._offset.y;\r\n        z = billboard._offset.z;\r\n        this._offsetArr = concatTypedArrays(this._offsetArr, [\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z,\r\n            x, y, z\r\n        ]) as Float32Array;\r\n\r\n        x = billboard._color.x;\r\n        y = billboard._color.y;\r\n        z = billboard._color.z;\r\n        w = billboard._color.w;\r\n        this._rgbaArr = concatTypedArrays(this._rgbaArr, [\r\n            x, y, z, w,\r\n            x, y, z, w,\r\n            x, y, z, w,\r\n            x, y, z, w,\r\n            x, y, z, w,\r\n            x, y, z, w\r\n        ]) as Float32Array;\r\n\r\n        x = billboard._rotation;\r\n        this._rotationArr = concatTypedArrays(this._rotationArr, [x, x, x, x, x, x]) as Float32Array;\r\n\r\n        x = billboard._entity!._pickingColor.x / 255;\r\n        y = billboard._entity!._pickingColor.y / 255;\r\n        z = billboard._entity!._pickingColor.z / 255;\r\n        this._pickingColorArr = concatTypedArrays(this._pickingColorArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]) as Float32Array;\r\n    }\r\n\r\n    public get billboards(): Billboard[] {\r\n        return this._billboards\r\n    }\r\n\r\n    public override refreshTexCoordsArr() {\r\n        let bc = this._entityCollection;\r\n        if (bc && this._renderer) {\r\n            let ta = this._renderer.billboardsTextureAtlas;\r\n            for (let i = 0; i < this._billboards.length; i++) {\r\n                let bi = this._billboards[i];\r\n                let img = bi.getImage();\r\n                if (img) {\r\n                    let imageNode = ta.get(img.__nodeIndex!);\r\n                    if (imageNode) {\r\n                        this.setTexCoordArr(bi._handlerIndex, imageNode.texCoords);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {BillboardHandler};\r\n","precision highp float;\r\n\r\n#include \"../common/qrot.glsl\"\r\n\r\nattribute vec3 aVertexPosition;\r\nattribute vec3 aVertexNormal;\r\n\r\nattribute vec3 aRTCPositionHigh;\r\nattribute vec3 aRTCPositionLow;\r\n\r\nattribute vec4 aColor;\r\nattribute vec3 aScale;\r\nattribute vec3 aTranslate;\r\nattribute float aDispose;\r\nattribute float aUseTexture;\r\nattribute vec2 aTexCoord;\r\nattribute vec4 qRot;\r\nattribute vec3 aLocalPosition;\r\n\r\nuniform vec3 uScaleByDistance;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\n\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\n\r\nuniform vec3 rtcEyePositionHigh;\r\nuniform vec3 rtcEyePositionLow;\r\n\r\nvarying vec3 cameraPosition;\r\nvarying vec3 vNormal;\r\nvarying vec3 v_vertex;\r\nvarying vec4 vColor;\r\nvarying float vDispose;\r\nvarying vec2 vTexCoords;\r\n\r\nvoid main(void) {\r\n\r\n    if (aDispose == 0.0) {\r\n        return;\r\n    }\r\n\r\n    vColor = aColor;\r\n    vTexCoords = aTexCoord;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = aRTCPositionHigh - rtcEyePositionHigh;\r\n    vec3 lowDiff = aRTCPositionLow - rtcEyePositionLow;\r\n\r\n    cameraPosition = eyePositionHigh + eyePositionLow;\r\n\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n\r\n    vec4 positionInViewSpace = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    float lookLength = length(positionInViewSpace.xyz);\r\n\r\n    vNormal = normalize(qRotate(qRot, aVertexNormal));\r\n\r\n    float scd = uScaleByDistance[2] * clamp(lookLength, uScaleByDistance[0], uScaleByDistance[1]) / uScaleByDistance[0];\r\n    vec3 vert = qRotate(qRot, scd * (aVertexPosition * aScale + aTranslate)) + scd * aLocalPosition;\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff + vert, 1.0);\r\n\r\n    v_vertex = positionInViewSpace.xyz + vert;\r\n}","precision highp float;\r\n\r\nuniform vec3 sunPosition;\r\nuniform vec3 materialParams[3];\r\nuniform float materialShininess;\r\nuniform sampler2D uTexture;\r\nuniform float uUseTexture;\r\nuniform float useLighting;\r\n\r\nvarying vec3 cameraPosition;\r\nvarying vec3 v_vertex;\r\nvarying vec4 vColor;\r\nvarying vec3 vNormal;\r\nvarying vec2 vTexCoords;\r\n\r\nvoid main(void) {\r\n\r\n    vec3 lightWeighting = vec3(1.0);\r\n\r\n    if (useLighting != 0.0) {\r\n        vec3 normal = normalize(vNormal);\r\n        vec3 light_dir = normalize(sunPosition);\r\n        vec3 look_dir = normalize(cameraPosition - v_vertex);\r\n\r\n        float diffuse = max(dot(normal, light_dir), 0.0);\r\n\r\n        vec3 refl_dir = reflect(-light_dir, normal);\r\n        float refl = max(dot(refl_dir, look_dir), 0.0);\r\n        float specular = pow(refl, materialShininess) * step(1e-4, diffuse);\r\n\r\n        lightWeighting = vColor.rgb * materialParams[0]\r\n        + materialParams[1] * diffuse\r\n        + materialParams[2] * specular;\r\n    } else {\r\n        lightWeighting = vColor.rgb;\r\n    }\r\n\r\n    if (uUseTexture > 0.0) {\r\n        vec4 texColor = texture2D(uTexture, vTexCoords);\r\n        gl_FragColor = vec4(texColor.rgb * lightWeighting, texColor.a);\r\n    } else {\r\n        gl_FragColor = vec4(lightWeighting, vColor.a);\r\n    }\r\n}","precision highp float;\r\n\r\n#include \"../common/qrot.glsl\"\r\n\r\nattribute vec3 aVertexPosition;\r\nattribute vec3 aRTCPositionHigh;\r\nattribute vec3 aRTCPositionLow;\r\nattribute vec3 aPickingColor;\r\nattribute vec3 aScale;\r\nattribute vec3 aTranslate;\r\nattribute float aDispose;\r\nattribute vec4 qRot;\r\n\r\nattribute vec3 aLocalPosition;\r\n\r\nuniform vec3 rtcEyePositionHigh;\r\nuniform vec3 rtcEyePositionLow;\r\n\r\nuniform vec3 uScaleByDistance;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec3 pickingScale;\r\n\r\nvarying vec3 vColor;\r\n\r\nvoid main(void) {\r\n\r\n    if (aDispose == 0.0) {\r\n        return;\r\n    }\r\n\r\n    vColor = aPickingColor;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = aRTCPositionHigh - rtcEyePositionHigh;\r\n    vec3 lowDiff = aRTCPositionLow - rtcEyePositionLow;\r\n\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n\r\n    vec4 positionInViewSpace = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    float lookLength = length(positionInViewSpace.xyz);\r\n\r\n    float scd = uScaleByDistance[2] * clamp(lookLength, uScaleByDistance[0], uScaleByDistance[1]) / uScaleByDistance[0];\r\n\r\n    vec3 vert = qRotate(qRot, scd * pickingScale * (aVertexPosition * aScale + aTranslate)) + scd * aLocalPosition;\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff + vert, 1.0);\r\n}","precision highp float;\r\nvarying vec3 vColor;\r\n\r\nvoid main() {\r\n    gl_FragColor = vec4(vColor, 1.0);\r\n}","#version 300 es\r\nprecision highp float;\r\n\r\n#include \"../common/qrot.glsl\"\r\n\r\nin vec3 aVertexPosition;\r\nin vec3 aRTCPositionHigh;\r\nin vec3 aRTCPositionLow;\r\nin vec3 aScale;\r\nin vec3 aTranslate;\r\nin float aDispose;\r\nin vec4 qRot;\r\nin vec3 aLocalPosition;\r\n\r\nuniform vec3 rtcEyePositionHigh;\r\nuniform vec3 rtcEyePositionLow;\r\nuniform vec3 uScaleByDistance;\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\n\r\nvoid main(void) {\r\n\r\n    if (aDispose == 0.0) {\r\n        return;\r\n    }\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = aRTCPositionHigh - rtcEyePositionHigh;\r\n    vec3 lowDiff = aRTCPositionLow - rtcEyePositionLow;\r\n\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n\r\n    vec4 positionInViewSpace = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    float lookLength = length(positionInViewSpace.xyz);\r\n\r\n    float scd = uScaleByDistance[2] * clamp(lookLength, uScaleByDistance[0], uScaleByDistance[1]) / uScaleByDistance[0];\r\n\r\n    vec3 vert = qRotate(qRot, scd * (aVertexPosition * aScale + aTranslate)) + scd * aLocalPosition;\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff + vert, 1.0);\r\n}","#version 300 es\r\nprecision highp float;\r\n\r\nuniform float frustumPickingColor;\r\n\r\nlayout (location = 0) out vec4 frustumColor;\r\nlayout (location = 1) out vec4 depthColor;\r\n\r\nvoid main() {\r\n    frustumColor = vec4(frustumPickingColor, frustumPickingColor, frustumPickingColor, 1.0);\r\n    depthColor = vec4(gl_FragCoord.z, gl_FragCoord.z, gl_FragCoord.z, 1.0);\r\n}","import {Program} from \"../../webgl/Program\";\r\nimport geoObjectVert from './geo_object.vert.glsl';\r\nimport geoObjectFrag from './geo_object.frag.glsl';\r\nimport geoObjectPickingVert from './geo_object_picking.vert.glsl';\r\nimport geoObjectPickingFrag from './geo_object_picking.frag.glsl';\r\nimport geoObjectDepthVert from './geo_object_depth.vert.glsl';\r\nimport geoObjectDepthFrag from './geo_object_depth.frag.glsl';\r\n\r\nexport const geo_object = (): Program =>\r\n    new Program(\"geo_object\", {\r\n        uniforms: {\r\n            viewMatrix: \"mat4\",\r\n            projectionMatrix: \"mat4\",\r\n            uScaleByDistance: \"vec3\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            rtcEyePositionHigh: \"vec3\",\r\n            rtcEyePositionLow: \"vec3\",\r\n            sunPosition: \"vec3\",\r\n            materialParams: \"vec3\",\r\n            materialShininess: \"float\",\r\n            uTexture: \"sampler2d\",\r\n            uUseTexture: \"float\",\r\n            useLighting: \"float\"\r\n        },\r\n        attributes: {\r\n            aVertexPosition: \"vec3\",\r\n            aVertexNormal: \"vec3\",\r\n            aTexCoord: \"vec2\",\r\n            aLocalPosition: {type: \"vec3\", divisor: 1},\r\n            aRTCPositionHigh: {type: \"vec3\", divisor: 1},\r\n            aRTCPositionLow: {type: \"vec3\", divisor: 1},\r\n            aColor: {type: \"vec4\", divisor: 1},\r\n            aScale: {type: \"vec3\", divisor: 1},\r\n            aTranslate: {type: \"vec3\", divisor: 1},\r\n            aDispose: {type: \"float\", divisor: 1},\r\n            qRot: {type: \"vec4\", divisor: 1}\r\n        },\r\n        vertexShader: geoObjectVert,\r\n        fragmentShader: geoObjectFrag\r\n    });\r\n\r\nexport const geo_object_picking = (): Program =>\r\n    new Program(\"geo_object_picking\", {\r\n        uniforms: {\r\n            viewMatrix: \"mat4\",\r\n            projectionMatrix: \"mat4\",\r\n            uScaleByDistance: \"vec3\",\r\n            pickingScale: \"vec3\",\r\n            rtcEyePositionHigh: \"vec3\",\r\n            rtcEyePositionLow: \"vec3\",\r\n        },\r\n        attributes: {\r\n            aVertexPosition: \"vec3\",\r\n            aRTCPositionHigh: {type: \"vec3\", divisor: 1},\r\n            aRTCPositionLow: {type: \"vec3\", divisor: 1},\r\n            aPickingColor: {type: \"vec3\", divisor: 1},\r\n            aScale: {type: \"vec3\", divisor: 1},\r\n            aTranslate: {type: \"vec3\", divisor: 1},\r\n            aLocalPosition: {type: \"vec3\", divisor: 1},\r\n            aDispose: {type: \"float\", divisor: 1},\r\n            qRot: {type: \"vec4\", divisor: 1}\r\n        },\r\n        vertexShader: geoObjectPickingVert,\r\n        fragmentShader: geoObjectPickingFrag\r\n    });\r\n\r\nexport const geo_object_depth = (): Program =>\r\n    new Program(\"geo_object_depth\", {\r\n        uniforms: {\r\n            viewMatrix: \"mat4\",\r\n            projectionMatrix: \"mat4\",\r\n            uScaleByDistance: \"vec3\",\r\n            rtcEyePositionHigh: \"vec3\",\r\n            rtcEyePositionLow: \"vec3\",\r\n            frustumPickingColor: \"float\"\r\n        },\r\n        attributes: {\r\n            aVertexPosition: \"vec3\",\r\n            aRTCPositionHigh: {type: \"vec3\", divisor: 1},\r\n            aRTCPositionLow: {type: \"vec3\", divisor: 1},\r\n            aScale: {type: \"vec3\", divisor: 1},\r\n            aTranslate: {type: \"vec3\", divisor: 1},\r\n            aDispose: {type: \"float\", divisor: 1},\r\n            qRot: {type: \"vec4\", divisor: 1},\r\n            aLocalPosition: {type: \"vec3\", divisor: 1},\r\n        },\r\n        vertexShader: geoObjectDepthVert,\r\n        fragmentShader: geoObjectDepthFrag\r\n    });","import {GeoObject} from \"./GeoObject\";\r\nimport type {WebGLBufferExt, WebGLTextureExt} from \"../webgl/Handler\";\r\nimport {makeArrayTyped} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {Program} from \"../webgl/Program\";\r\nimport {GeoObjectHandler} from \"./GeoObjectHandler\";\r\nimport {\r\n    VERTEX_BUFFER,\r\n    RTC_POSITION_BUFFER,\r\n    RGBA_BUFFER,\r\n    NORMALS_BUFFER,\r\n    INDEX_BUFFER,\r\n    QROT_BUFFER,\r\n    SIZE_BUFFER,\r\n    PICKINGCOLOR_BUFFER,\r\n    VISIBLE_BUFFER,\r\n    TEXCOORD_BUFFER,\r\n    TRANSLATE_BUFFER,\r\n    LOCALPOSITION_BUFFER\r\n} from \"./GeoObjectHandler\";\r\n\r\nconst AMBIENT_R = 0;\r\nconst AMBIENT_G = 1;\r\nconst AMBIENT_B = 2;\r\nconst DIFFUSE_R = 3;\r\nconst DIFFUSE_G = 4;\r\nconst DIFFUSE_B = 5;\r\nconst SPECULAR_R = 6;\r\nconst SPECULAR_G = 7;\r\nconst SPECULAR_B = 8;\r\n\r\nexport class InstanceData {\r\n\r\n    public isFree: boolean;\r\n\r\n    public _geoObjectHandler: GeoObjectHandler;\r\n\r\n    public geoObjects: GeoObject[];\r\n\r\n    public numInstances: number;\r\n\r\n    public _colorTexture: WebGLTextureExt | null;\r\n    public _normalTexture: WebGLTextureExt | null;\r\n    public _metallicRoughnessTexture: WebGLTextureExt | null;\r\n\r\n    public _colorTextureSrc: string | null;\r\n    public _normalTextureSrc: string | null;\r\n    public _metallicRoughnessTextureSrc: string | null;\r\n\r\n    public _objectSrc?: string;\r\n\r\n    public _sizeArr: number[] | TypedArray;\r\n    public _translateArr: number[] | TypedArray;\r\n    public _vertexArr: number[] | TypedArray;\r\n\r\n    public _rtcPositionHighArr: number[] | TypedArray;\r\n    public _rtcPositionLowArr: number[] | TypedArray;\r\n\r\n    public _qRotArr: number[] | TypedArray;\r\n    public _rgbaArr: number[] | TypedArray;\r\n    public _normalsArr: number[] | TypedArray;\r\n    public _indicesArr: number[] | TypedArray;\r\n    public _pickingColorArr: number[] | TypedArray;\r\n    public _visibleArr: number[] | TypedArray;\r\n    public _texCoordArr: number[] | TypedArray;\r\n\r\n    public _localPositionArr: number[] | TypedArray;\r\n\r\n    public _sizeBuffer: WebGLBufferExt | null;\r\n    public _translateBuffer: WebGLBufferExt | null;\r\n    public _vertexBuffer: WebGLBufferExt | null;\r\n    public _rtcPositionHighBuffer: WebGLBufferExt | null;\r\n    public _rtcPositionLowBuffer: WebGLBufferExt | null;\r\n    public _qRotBuffer: WebGLBufferExt | null;\r\n    public _rgbaBuffer: WebGLBufferExt | null;\r\n    public _normalsBuffer: WebGLBufferExt | null;\r\n    public _indicesBuffer: WebGLBufferExt | null;\r\n    public _pickingColorBuffer: WebGLBufferExt | null;\r\n    public _visibleBuffer: WebGLBufferExt | null;\r\n    public _texCoordBuffer: WebGLBufferExt | null;\r\n    public _localPositionBuffer: WebGLBufferExt | null;\r\n\r\n    public _buffersUpdateCallbacks: Function[];\r\n\r\n    public _changedBuffers: boolean[];\r\n\r\n    public _materialParams: Float32Array;\r\n    public _materialShininess: number;\r\n\r\n    constructor(geoObjectHandler: GeoObjectHandler) {\r\n\r\n        this.isFree = true;\r\n\r\n        this._geoObjectHandler = geoObjectHandler;\r\n\r\n        this.geoObjects = [];\r\n\r\n        this.numInstances = 0;\r\n\r\n        this._colorTexture = null;\r\n        this._colorTextureSrc = null;\r\n\r\n        this._normalTexture = null;\r\n        this._normalTextureSrc = null;\r\n\r\n        this._metallicRoughnessTexture = null;\r\n        this._metallicRoughnessTextureSrc = null;\r\n\r\n        this._sizeArr = [];\r\n        this._translateArr = [];\r\n        this._vertexArr = [];\r\n        this._rtcPositionHighArr = [];\r\n        this._rtcPositionLowArr = [];\r\n        this._qRotArr = [];\r\n        this._rgbaArr = [];\r\n        this._normalsArr = [];\r\n        this._indicesArr = [];\r\n        this._pickingColorArr = [];\r\n        this._visibleArr = [];\r\n        this._texCoordArr = [];\r\n        this._localPositionArr = [];\r\n\r\n        this._sizeBuffer = null;\r\n        this._translateBuffer = null;\r\n        this._vertexBuffer = null;\r\n        this._rtcPositionHighBuffer = null;\r\n        this._rtcPositionLowBuffer = null;\r\n        this._qRotBuffer = null;\r\n        this._rgbaBuffer = null;\r\n        this._normalsBuffer = null;\r\n        this._indicesBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n        this._visibleBuffer = null;\r\n        this._texCoordBuffer = null;\r\n        this._localPositionBuffer = null;\r\n\r\n        this._materialParams = new Float32Array(9);\r\n        this._materialShininess = 0;\r\n\r\n        this._buffersUpdateCallbacks = [];\r\n        this._buffersUpdateCallbacks[PICKINGCOLOR_BUFFER] = this.createPickingColorBuffer;\r\n        this._buffersUpdateCallbacks[NORMALS_BUFFER] = this.createNormalsBuffer;\r\n        this._buffersUpdateCallbacks[RGBA_BUFFER] = this.createRgbaBuffer;\r\n        this._buffersUpdateCallbacks[INDEX_BUFFER] = this.createIndicesBuffer;\r\n        this._buffersUpdateCallbacks[VERTEX_BUFFER] = this.createVertexBuffer;\r\n        this._buffersUpdateCallbacks[SIZE_BUFFER] = this.createSizeBuffer;\r\n        this._buffersUpdateCallbacks[VISIBLE_BUFFER] = this.createVisibleBuffer;\r\n        this._buffersUpdateCallbacks[TEXCOORD_BUFFER] = this.createTexCoordBuffer;\r\n        this._buffersUpdateCallbacks[QROT_BUFFER] = this.createQRotBuffer;\r\n        this._buffersUpdateCallbacks[TRANSLATE_BUFFER] = this.createTranslateBuffer;\r\n        this._buffersUpdateCallbacks[RTC_POSITION_BUFFER] = this.createRTCPositionBuffer;\r\n        this._buffersUpdateCallbacks[LOCALPOSITION_BUFFER] = this.createLocalPositionBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n    }\r\n\r\n    public setMaterialAmbient(r: number, g: number, b: number) {\r\n        this._materialParams[AMBIENT_R] = r;\r\n        this._materialParams[AMBIENT_G] = g;\r\n        this._materialParams[AMBIENT_B] = b;\r\n    }\r\n\r\n    public setMaterialDiffuse(r: number, g: number, b: number) {\r\n        this._materialParams[DIFFUSE_R] = r;\r\n        this._materialParams[DIFFUSE_G] = g;\r\n        this._materialParams[DIFFUSE_B] = b;\r\n    }\r\n\r\n    public setMaterialSpecular(r: number, g: number, b: number) {\r\n        this._materialParams[SPECULAR_R] = r;\r\n        this._materialParams[SPECULAR_G] = g;\r\n        this._materialParams[SPECULAR_B] = b;\r\n    }\r\n\r\n    public setMaterialShininess(shininess: number) {\r\n        this._materialShininess = shininess;\r\n    }\r\n\r\n    public setMaterialParams(ambient: Float32Array, diffuse: Float32Array, specular: Float32Array, shininess: number) {\r\n        this.setMaterialAmbient(ambient[0], ambient[1], ambient[2]);\r\n        this.setMaterialDiffuse(diffuse[0], diffuse[1], diffuse[2]);\r\n        this.setMaterialSpecular(specular[0], specular[1], specular[2]);\r\n        this.setMaterialShininess(shininess);\r\n    }\r\n\r\n    //\r\n    //  Instance individual data\r\n    //\r\n    public drawOpaque(p: Program) {\r\n\r\n        let gl = p.gl!,\r\n            u = p.uniforms,\r\n            a = p.attributes;\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._qRotBuffer!);\r\n        gl.vertexAttribPointer(a.qRot, this._qRotBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer!);\r\n        gl.vertexAttribPointer(a.aScale, this._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._translateBuffer!);\r\n        gl.vertexAttribPointer(a.aTranslate, this._translateBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._localPositionBuffer!);\r\n        gl.vertexAttribPointer(a.aLocalPosition, this._localPositionBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._visibleBuffer!);\r\n        gl.vertexAttribPointer(a.aDispose, this._visibleBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform1f(u.uUseTexture, this._colorTexture ? 1 : 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer!);\r\n        gl.vertexAttribPointer(a.aColor, this._rgbaBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform3fv(u.materialParams, this._materialParams);\r\n        gl.uniform1f(u.materialShininess, this._materialShininess);\r\n\r\n\r\n        this._drawElementsInstanced(p);\r\n    }\r\n\r\n    //\r\n    //  Instance individual data\r\n    //\r\n    public drawTransparent(p: Program) {\r\n\r\n        let gl = p.gl!,\r\n            u = p.uniforms,\r\n            a = p.attributes;\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._qRotBuffer!);\r\n        gl.vertexAttribPointer(a.qRot, this._qRotBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer!);\r\n        gl.vertexAttribPointer(a.aScale, this._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._translateBuffer!);\r\n        gl.vertexAttribPointer(a.aTranslate, this._translateBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._localPositionBuffer!);\r\n        gl.vertexAttribPointer(a.aLocalPosition, this._localPositionBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._visibleBuffer!);\r\n        gl.vertexAttribPointer(a.aDispose, this._visibleBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform1f(u.uUseTexture, this._colorTexture ? 1 : 0);\r\n\r\n        gl.uniform3fv(u.materialParams, this._materialParams);\r\n        gl.uniform1f(u.materialShininess, this._materialShininess);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer!);\r\n        gl.vertexAttribPointer(a.aColor, this._rgbaBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        this._drawElementsInstanced(p);\r\n    }\r\n\r\n    //\r\n    // Instance common data(could be in VAO)\r\n    //\r\n    protected _drawElementsInstanced(p: Program) {\r\n\r\n        let gl = p.gl!,\r\n            u = p.uniforms,\r\n            a = p.attributes;\r\n\r\n        let r = this._geoObjectHandler!._renderer!;\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rtcPositionHighBuffer!);\r\n        gl.vertexAttribPointer(a.aRTCPositionHigh, this._rtcPositionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rtcPositionLowBuffer!);\r\n        gl.vertexAttribPointer(a.aRTCPositionLow, this._rtcPositionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._normalsBuffer!);\r\n        gl.vertexAttribPointer(a.aVertexNormal, this._normalsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer!);\r\n        gl.vertexAttribPointer(a.aVertexPosition, this._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this._colorTexture || r.handler.defaultTexture);\r\n        gl.uniform1i(u.uTexture, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer!);\r\n        gl.vertexAttribPointer(a.aTexCoord, this._texCoordBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indicesBuffer!);\r\n        p.drawElementsInstanced!(gl.TRIANGLES, this._indicesBuffer!.numItems, gl.UNSIGNED_INT, 0, this.numInstances);\r\n    }\r\n\r\n    public createColorTexture(image: HTMLCanvasElement | ImageBitmap | ImageData | HTMLImageElement) {\r\n        if (this._geoObjectHandler && this._geoObjectHandler._renderer) {\r\n            let h = this._geoObjectHandler._renderer.handler;\r\n            this._colorTexture = h.createTextureDefault(image, null, h.gl!.REPEAT);\r\n        }\r\n    }\r\n\r\n    public createNormalTexture(image: HTMLCanvasElement | ImageBitmap | ImageData | HTMLImageElement) {\r\n        if (this._geoObjectHandler && this._geoObjectHandler._renderer) {\r\n            let h = this._geoObjectHandler._renderer.handler;\r\n            this._normalTexture = h.createTextureDefault(image, null, h.gl!.REPEAT);\r\n        }\r\n    }\r\n\r\n    public createMetallicRoughnessTexture(image: HTMLCanvasElement | ImageBitmap | ImageData | HTMLImageElement) {\r\n        if (this._geoObjectHandler && this._geoObjectHandler._renderer) {\r\n            let h = this._geoObjectHandler._renderer.handler;\r\n            this._metallicRoughnessTexture = h.createTextureDefault(image, null, h.gl!.REPEAT);\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n\r\n        this.numInstances = 0;\r\n\r\n        this.geoObjects = [];\r\n\r\n        this._sizeArr = [];\r\n        this._translateArr = [];\r\n        this._vertexArr = [];\r\n        this._rtcPositionHighArr = [];\r\n        this._rtcPositionLowArr = [];\r\n        this._qRotArr = [];\r\n        this._rgbaArr = [];\r\n        this._normalsArr = [];\r\n        this._indicesArr = [];\r\n        this._pickingColorArr = [];\r\n        this._visibleArr = [];\r\n        this._texCoordArr = [];\r\n        this._localPositionArr = [];\r\n\r\n        this._deleteBuffers();\r\n\r\n        this.isFree = false;\r\n\r\n        //this._geoObjectHandler = null;\r\n    }\r\n\r\n    public _deleteBuffers() {\r\n\r\n        if (this._geoObjectHandler && this._geoObjectHandler._renderer) {\r\n\r\n            let h = this._geoObjectHandler._renderer.handler,\r\n                gl = h.gl!;\r\n\r\n            h.deleteTexture(this._colorTexture);\r\n            h.deleteTexture(this._normalTexture);\r\n            h.deleteTexture(this._metallicRoughnessTexture);\r\n\r\n            this._colorTexture = null;\r\n            this._normalTexture = null;\r\n            this._metallicRoughnessTexture = null;\r\n\r\n            gl.deleteBuffer(this._sizeBuffer!);\r\n            gl.deleteBuffer(this._translateBuffer!);\r\n            gl.deleteBuffer(this._vertexBuffer!);\r\n            gl.deleteBuffer(this._rtcPositionHighBuffer!);\r\n            gl.deleteBuffer(this._rtcPositionLowBuffer!);\r\n            gl.deleteBuffer(this._qRotBuffer!);\r\n            gl.deleteBuffer(this._rgbaBuffer!);\r\n            gl.deleteBuffer(this._normalsBuffer!);\r\n            gl.deleteBuffer(this._indicesBuffer!);\r\n            gl.deleteBuffer(this._pickingColorBuffer!);\r\n            gl.deleteBuffer(this._visibleBuffer!);\r\n            gl.deleteBuffer(this._texCoordBuffer!);\r\n            gl.deleteBuffer(this._localPositionBuffer!);\r\n        }\r\n\r\n        this._sizeBuffer = null;\r\n        this._translateBuffer = null;\r\n        this._vertexBuffer = null;\r\n        this._rtcPositionHighBuffer = null;\r\n        this._rtcPositionLowBuffer = null;\r\n        this._qRotBuffer = null;\r\n        this._rgbaBuffer = null;\r\n        this._normalsBuffer = null;\r\n        this._indicesBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n        this._visibleBuffer = null;\r\n        this._texCoordBuffer = null;\r\n        this._localPositionBuffer = null;\r\n    }\r\n\r\n    public createVertexBuffer() {\r\n        const h = this._geoObjectHandler._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._vertexBuffer!);\r\n        this._vertexArr = makeArrayTyped(this._vertexArr);\r\n        this._vertexBuffer = h.createArrayBuffer(this._vertexArr as Float32Array, 3, this._vertexArr.length / 3);\r\n    }\r\n\r\n    public createVisibleBuffer() {\r\n\r\n        const h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._visibleArr.length;\r\n\r\n        if (!this._visibleBuffer || this._visibleBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._visibleBuffer!);\r\n            this._visibleBuffer = h.createStreamArrayBuffer(1, numItems);\r\n        }\r\n\r\n        this._visibleArr = makeArrayTyped(this._visibleArr);\r\n\r\n        h.setStreamArrayBuffer(this._visibleBuffer, this._visibleArr as Uint8Array);\r\n    }\r\n\r\n    public createSizeBuffer() {\r\n        let h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._sizeArr.length / 3;\r\n\r\n        if (!this._sizeBuffer || this._sizeBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._sizeBuffer!);\r\n            this._sizeBuffer = h.createStreamArrayBuffer(3, numItems);\r\n        }\r\n\r\n        this._sizeArr = makeArrayTyped(this._sizeArr);\r\n\r\n        h.setStreamArrayBuffer(this._sizeBuffer, this._sizeArr as Float32Array);\r\n    }\r\n\r\n    public createTranslateBuffer() {\r\n        let h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._translateArr.length / 3;\r\n\r\n        if (!this._translateBuffer || this._translateBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._translateBuffer!);\r\n            this._translateBuffer = h.createStreamArrayBuffer(3, numItems);\r\n        }\r\n\r\n        this._translateArr = makeArrayTyped(this._translateArr);\r\n\r\n        h.setStreamArrayBuffer(this._translateBuffer, this._translateArr as Float32Array);\r\n    }\r\n\r\n    public createLocalPositionBuffer() {\r\n        let h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._localPositionArr.length / 3;\r\n\r\n        if (!this._localPositionBuffer || this._localPositionBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._localPositionBuffer!);\r\n            this._localPositionBuffer = h.createStreamArrayBuffer(3, numItems);\r\n        }\r\n\r\n        this._localPositionArr = makeArrayTyped(this._localPositionArr);\r\n\r\n        h.setStreamArrayBuffer(this._localPositionBuffer, this._localPositionArr as Float32Array);\r\n    }\r\n\r\n    public createTexCoordBuffer() {\r\n        const h = this._geoObjectHandler._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._texCoordBuffer!);\r\n        this._texCoordArr = makeArrayTyped(this._texCoordArr);\r\n        this._texCoordBuffer = h.createArrayBuffer(this._texCoordArr as Uint8Array, 2, this._texCoordArr.length / 2);\r\n    }\r\n\r\n    public createRTCPositionBuffer() {\r\n        let h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._rtcPositionHighArr.length / 3;\r\n\r\n        if (!this._rtcPositionHighBuffer || this._rtcPositionHighBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._rtcPositionHighBuffer!);\r\n            h.gl!.deleteBuffer(this._rtcPositionLowBuffer!);\r\n            this._rtcPositionHighBuffer = h.createStreamArrayBuffer(3, numItems);\r\n            this._rtcPositionLowBuffer = h.createStreamArrayBuffer(3, numItems);\r\n        }\r\n\r\n        this._rtcPositionHighArr = makeArrayTyped(this._rtcPositionHighArr);\r\n        this._rtcPositionLowArr = makeArrayTyped(this._rtcPositionLowArr);\r\n\r\n        h.setStreamArrayBuffer(this._rtcPositionHighBuffer!, this._rtcPositionHighArr as Float32Array);\r\n        h.setStreamArrayBuffer(this._rtcPositionLowBuffer!, this._rtcPositionLowArr as Float32Array);\r\n    }\r\n\r\n\r\n    public createRgbaBuffer() {\r\n        let h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._rgbaArr.length / 4;\r\n\r\n        if (!this._rgbaBuffer || this._rgbaBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._rgbaBuffer!);\r\n            this._rgbaBuffer = h.createStreamArrayBuffer(4, numItems);\r\n        }\r\n\r\n        this._rgbaArr = makeArrayTyped(this._rgbaArr);\r\n\r\n        h.setStreamArrayBuffer(this._rgbaBuffer, this._rgbaArr as Uint8Array);\r\n    }\r\n\r\n    public createQRotBuffer() {\r\n        let h = this._geoObjectHandler._renderer!.handler,\r\n            numItems = this._qRotArr.length / 4;\r\n\r\n        if (!this._qRotBuffer || this._qRotBuffer.numItems !== numItems) {\r\n            h.gl!.deleteBuffer(this._qRotBuffer!);\r\n            this._qRotBuffer = h.createStreamArrayBuffer(4, numItems);\r\n        }\r\n\r\n        this._qRotArr = makeArrayTyped(this._qRotArr);\r\n\r\n        h.setStreamArrayBuffer(this._qRotBuffer, this._qRotArr as Float32Array);\r\n    }\r\n\r\n    public createNormalsBuffer() {\r\n        const h = this._geoObjectHandler._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._normalsBuffer!);\r\n        this._normalsArr = makeArrayTyped(this._normalsArr);\r\n        this._normalsBuffer = h.createArrayBuffer(this._normalsArr as Uint8Array, 3, this._normalsArr.length / 3);\r\n    }\r\n\r\n    public createIndicesBuffer() {\r\n        const h = this._geoObjectHandler._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._indicesBuffer!);\r\n        this._indicesArr = makeArrayTyped(this._indicesArr, Uint32Array);\r\n        this._indicesBuffer = h.createElementArrayBuffer(this._indicesArr as Uint32Array, 1, this._indicesArr.length);\r\n    }\r\n\r\n    public createPickingColorBuffer() {\r\n        const h = this._geoObjectHandler._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._pickingColorBuffer!);\r\n        this._pickingColorArr = makeArrayTyped(this._pickingColorArr);\r\n        this._pickingColorBuffer = h.createArrayBuffer(this._pickingColorArr as Uint8Array, 3, this._pickingColorArr.length / 3);\r\n    }\r\n\r\n    public refresh() {\r\n        let i = this._changedBuffers.length;\r\n        while (i--) {\r\n            this._changedBuffers[i] = true;\r\n        }\r\n    }\r\n\r\n    public update() {\r\n        if (this._geoObjectHandler._renderer) {\r\n            let i = this._changedBuffers.length;\r\n            while (i--) {\r\n                if (this._changedBuffers[i]) {\r\n                    this._buffersUpdateCallbacks[i].call(this);\r\n                    this._changedBuffers[i] = false;\r\n                }\r\n            }\r\n            this.isFree = true;\r\n        }\r\n    }\r\n}","import * as shaders from \"../shaders/geo_object/geo_object\";\r\nimport {concatArrays, loadImage, spliceArray} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport {GeoObject} from \"./GeoObject\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Object3d} from \"../Object3d\";\r\nimport {InstanceData} from \"./InstanceData\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\n\r\n//@todo: enums, i know...nah...\r\nexport const VERTEX_BUFFER = 0;\r\nexport const RTC_POSITION_BUFFER = 1;\r\nexport const RGBA_BUFFER = 2;\r\nexport const NORMALS_BUFFER = 3;\r\nexport const INDEX_BUFFER = 4;\r\nexport const QROT_BUFFER = 5;\r\nexport const SIZE_BUFFER = 6;\r\nexport const PICKINGCOLOR_BUFFER = 7;\r\nexport const VISIBLE_BUFFER = 8;\r\nexport const TEXCOORD_BUFFER = 9;\r\nexport const TRANSLATE_BUFFER = 10;\r\nexport const LOCALPOSITION_BUFFER = 11;\r\n\r\nfunction setParametersToArray(arr: number[] | TypedArray, index: number = 0, length: number = 0, itemSize: number = 1, ...params: number[]): number[] | TypedArray {\r\n    const currIndex = index * length;\r\n    for (let i = currIndex, len = currIndex + length; i < len; i++) {\r\n        arr[i] = params[i % itemSize];\r\n    }\r\n    return arr;\r\n}\r\n\r\nexport class GeoObjectHandler {\r\n    static __counter__ = 0;\r\n\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Picking rendering option.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public pickingEnabled: boolean;\r\n\r\n    protected _entityCollection: EntityCollection;\r\n\r\n    public _renderNode: RenderNode | null;\r\n    public _renderer: Renderer | null;\r\n\r\n    protected _geoObjects: GeoObject[];\r\n\r\n    protected _instanceDataMap: Map<string, InstanceData>;\r\n    protected _instanceDataMapValues: InstanceData[];\r\n    protected _dataTagUpdateQueue: InstanceData[];\r\n\r\n    protected _relativeCenter: Vec3;\r\n\r\n    protected _rtcEyePositionHigh: Float32Array;\r\n    protected _rtcEyePositionLow: Float32Array;\r\n\r\n    constructor(entityCollection: EntityCollection) {\r\n\r\n        this.__id = GeoObjectHandler.__counter__++;\r\n\r\n        this.pickingEnabled = true;\r\n\r\n        this._entityCollection = entityCollection;\r\n\r\n        this._renderNode = null;\r\n        this._renderer = null;\r\n\r\n        this._geoObjects = [];\r\n\r\n        this._instanceDataMap = new Map<string, InstanceData>();\r\n        this._instanceDataMapValues = [];\r\n\r\n        this._dataTagUpdateQueue = [];\r\n\r\n        this._relativeCenter = new Vec3();\r\n\r\n        this._rtcEyePositionHigh = new Float32Array([0, 0, 0]);\r\n        this._rtcEyePositionLow = new Float32Array([0, 0, 0]);\r\n    }\r\n\r\n    public initProgram() {\r\n        if (this._renderer) {\r\n            if (!this._renderer.handler.programs.geo_object) {\r\n                this._renderer.handler.addProgram(shaders.geo_object());\r\n            }\r\n            if (!this._renderer.handler.programs.geo_object_picking) {\r\n                this._renderer.handler.addProgram(shaders.geo_object_picking());\r\n            }\r\n            if (!this._renderer.handler.programs.geo_object_depth) {\r\n                this._renderer.handler.addProgram(shaders.geo_object_depth());\r\n            }\r\n        }\r\n    }\r\n\r\n    public setRenderNode(renderNode: RenderNode) {\r\n\r\n        this._renderNode = renderNode;\r\n\r\n        this._renderer = renderNode.renderer;\r\n\r\n        this.initProgram();\r\n\r\n        //\r\n        // in case of lazy initialization loading data here\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            this._loadColorTexture(this._instanceDataMapValues[i]);\r\n            this._loadNormalTexture(this._instanceDataMapValues[i]);\r\n            this._loadMetallicRoughnessTexture(this._instanceDataMapValues[i]);\r\n        }\r\n\r\n        for (let i = 0; i < this._geoObjects.length; i++) {\r\n            this._geoObjects[i].updateRotation();\r\n        }\r\n\r\n        this.update();\r\n    }\r\n\r\n    public setColorTextureTag(src: string, tag: string) {\r\n        const tagData = this._instanceDataMap.get(tag);\r\n        if (tagData) {\r\n            tagData._colorTextureSrc = src;\r\n            this._instanceDataMap.set(tag, tagData);\r\n            this._loadColorTexture(tagData);\r\n        }\r\n    }\r\n\r\n    public setNormalTextureTag(src: string, tag: string) {\r\n        const tagData = this._instanceDataMap.get(tag);\r\n        if (tagData) {\r\n            tagData._normalTextureSrc = src;\r\n            this._instanceDataMap.set(tag, tagData);\r\n            this._loadNormalTexture(tagData);\r\n        }\r\n    }\r\n\r\n    public setMetallicRoughnessTextureTag(src: string, tag: string) {\r\n        const tagData = this._instanceDataMap.get(tag);\r\n        if (tagData) {\r\n            tagData._metallicRoughnessTextureSrc = src;\r\n            this._instanceDataMap.set(tag, tagData);\r\n            this._loadMetallicRoughnessTexture(tagData);\r\n        }\r\n    }\r\n\r\n    public setObjectSrc(src: string, tag: string) {\r\n        const tagData = this._instanceDataMap.get(tag);\r\n        if (src) {\r\n            if (tagData && tagData._objectSrc !== src) {\r\n                tagData._objectSrc = src;\r\n\r\n                Object3d.loadObj(src).then((object3d) => {\r\n                    this._updateInstanceData(object3d[0], tag);\r\n                })\r\n            }\r\n        }\r\n    }\r\n\r\n    public _updateInstanceData(object: Object3d, tag: string) {\r\n        const tagData = this._instanceDataMap.get(tag);\r\n        if (tagData) {\r\n            if (object.vertices.length !== tagData._vertexArr.length) {\r\n                tagData._vertexArr = object.vertices;\r\n                tagData._changedBuffers[VERTEX_BUFFER] = true;\r\n            }\r\n            if (object.normals.length !== tagData._normalsArr.length) {\r\n                tagData._normalsArr = object.normals;\r\n                tagData._changedBuffers[NORMALS_BUFFER] = true;\r\n            }\r\n            if (object.indices.length !== tagData._indicesArr.length) {\r\n                tagData._indicesArr = object.indices;\r\n                tagData._changedBuffers[INDEX_BUFFER] = true;\r\n            }\r\n            if (object.texCoords.length !== tagData._texCoordArr.length) {\r\n                tagData._texCoordArr = object.texCoords;\r\n                tagData._changedBuffers[TEXCOORD_BUFFER] = true;\r\n            }\r\n\r\n            tagData._colorTextureSrc = object.colorTexture;\r\n            tagData._normalTextureSrc = object.normalTexture;\r\n            tagData._metallicRoughnessTexture = object.metallicRoughnessTexture;\r\n\r\n            this._loadColorTexture(tagData);\r\n            this._loadNormalTexture(tagData);\r\n            this._loadMetallicRoughnessTexture(tagData);\r\n\r\n            this._updateTag(tagData);\r\n            this._instanceDataMapValues = Array.from(this._instanceDataMap.values());\r\n        }\r\n    }\r\n\r\n    protected _addGeoObjectToArray(geoObject: GeoObject) {\r\n        const tag = geoObject.tag;\r\n\r\n        let tagData = this._instanceDataMap.get(tag);\r\n\r\n        if (!tagData) {\r\n            tagData = new InstanceData(this);\r\n            this._instanceDataMap.set(tag, tagData);\r\n            this._instanceDataMapValues = Array.from(this._instanceDataMap.values());\r\n\r\n            //\r\n            // Setting instanced data\r\n            tagData._vertexArr = geoObject.vertices\r\n            tagData._normalsArr = geoObject.normals;\r\n            tagData._indicesArr = geoObject.indices;\r\n            tagData._texCoordArr = geoObject.texCoords;\r\n\r\n            tagData._colorTextureSrc = geoObject.object3d.colorTexture;\r\n            tagData._normalTextureSrc = geoObject.object3d.normalTexture;\r\n            tagData._metallicRoughnessTextureSrc = geoObject.object3d.metallicRoughnessTexture;\r\n\r\n            tagData.setMaterialParams(\r\n                geoObject.object3d.ambient,\r\n                geoObject.object3d.diffuse,\r\n                geoObject.object3d.specular,\r\n                geoObject.object3d.shininess\r\n            );\r\n\r\n            this._loadColorTexture(tagData);\r\n            this._loadNormalTexture(tagData);\r\n            this._loadMetallicRoughnessTexture(tagData);\r\n        }\r\n\r\n        geoObject._tagDataIndex = tagData.numInstances++;\r\n        geoObject._tagData = tagData;\r\n        tagData.geoObjects.push(geoObject);\r\n\r\n        let itemSize = 3;\r\n\r\n        tagData._visibleArr = concatArrays(tagData._visibleArr, setParametersToArray([], 0, 1, 1, geoObject.getVisibility() ? 1 : 0));\r\n\r\n        //\r\n        // Global coordinates\r\n        this.getRTCPosition(geoObject.getPosition(), geoObject._rtcPositionHigh, geoObject._rtcPositionLow);\r\n\r\n        let x = geoObject._rtcPositionHigh.x,\r\n            y = geoObject._rtcPositionHigh.y,\r\n            z = geoObject._rtcPositionHigh.z,\r\n            w;\r\n\r\n        tagData._rtcPositionHighArr = concatArrays(tagData._rtcPositionHighArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\r\n\r\n        x = geoObject._rtcPositionLow.x;\r\n        y = geoObject._rtcPositionLow.y;\r\n        z = geoObject._rtcPositionLow.z;\r\n        tagData._rtcPositionLowArr = concatArrays(tagData._rtcPositionLowArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\r\n\r\n\r\n        x = geoObject._entity!._pickingColor.x / 255;\r\n        y = geoObject._entity!._pickingColor.y / 255;\r\n        z = geoObject._entity!._pickingColor.z / 255;\r\n        tagData._pickingColorArr = concatArrays(tagData._pickingColorArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\r\n\r\n        itemSize = 4;\r\n\r\n        x = geoObject._qRot.x;\r\n        y = geoObject._qRot.y;\r\n        z = geoObject._qRot.z;\r\n        w = geoObject._qRot.w;\r\n        tagData._qRotArr = concatArrays(tagData._qRotArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z, w));\r\n\r\n        x = geoObject._color.x;\r\n        y = geoObject._color.y;\r\n        z = geoObject._color.z;\r\n        w = geoObject._color.w;\r\n        tagData._rgbaArr = concatArrays(tagData._rgbaArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z, w));\r\n\r\n        itemSize = 3;\r\n        let scale = geoObject.getScale();\r\n        x = scale.x;\r\n        y = scale.y;\r\n        z = scale.z;\r\n        tagData._sizeArr = concatArrays(tagData._sizeArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\r\n\r\n        let translate = geoObject.getTranslate();\r\n        x = translate.x;\r\n        y = translate.y;\r\n        z = translate.z;\r\n        tagData._translateArr = concatArrays(tagData._translateArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\r\n\r\n        let localPosition = geoObject.getLocalPosition();\r\n        x = localPosition.x;\r\n        y = localPosition.y;\r\n        z = localPosition.z;\r\n        tagData._localPositionArr = concatArrays(tagData._localPositionArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\r\n    }\r\n\r\n    //\r\n    // Could be in VAO\r\n    //\r\n    protected _bindCommon() {\r\n\r\n        let r = this._renderer!,\r\n            sh = r.handler.programs.geo_object,\r\n            p = sh._program,\r\n            u = p.uniforms,\r\n            gl = r.handler.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        gl.uniform3fv(u.uScaleByDistance, ec.scaleByDistance);\r\n        gl.uniform1f(u.useLighting, ec._useLighting);\r\n\r\n        gl.uniform3fv(u.eyePositionHigh, r.activeCamera.eyeHigh);\r\n        gl.uniform3fv(u.eyePositionLow, r.activeCamera.eyeLow);\r\n\r\n        gl.uniform3fv(u.rtcEyePositionHigh, this._rtcEyePositionHigh);\r\n        gl.uniform3fv(u.rtcEyePositionLow, this._rtcEyePositionLow);\r\n\r\n        gl.uniformMatrix4fv(u.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\r\n        gl.uniformMatrix4fv(u.viewMatrix, false, r.activeCamera.getViewMatrix());\r\n\r\n        //\r\n        // Global sun position\r\n        gl.uniform3fv(u.sunPosition, this._renderNode!._lightPosition);\r\n\r\n    }\r\n\r\n    public _displayOpaquePASS() {\r\n\r\n        let r = this._renderer!,\r\n            sh = r.handler.programs.geo_object,\r\n            p = sh._program;\r\n\r\n        sh.activate();\r\n\r\n        this._bindCommon();\r\n\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            let instanceData = this._instanceDataMapValues[i];\r\n            instanceData.drawOpaque(p);\r\n        }\r\n    }\r\n\r\n    public _displayTransparentPASS() {\r\n        let r = this._renderer!,\r\n            sh = r.handler.programs.geo_object,\r\n            p = sh._program;\r\n\r\n        sh.activate();\r\n\r\n        //gl.disable(gl.CULL_FACE);\r\n\r\n        this._bindCommon();\r\n\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            this._instanceDataMapValues[i].drawTransparent(p);\r\n        }\r\n    }\r\n\r\n    protected _depthPASS() {\r\n        let r = this._renderer!,\r\n            sh = r.handler.programs.geo_object_depth,\r\n            p = sh._program,\r\n            u = p.uniforms,\r\n            a = p.attributes,\r\n            gl = r.handler.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        let cam = r.activeCamera!;\r\n\r\n        sh.activate();\r\n\r\n        gl.uniform3fv(u.uScaleByDistance, ec.scaleByDistance);\r\n\r\n        gl.uniform3fv(u.rtcEyePositionHigh, this._rtcEyePositionHigh);\r\n        gl.uniform3fv(u.rtcEyePositionLow, this._rtcEyePositionLow);\r\n\r\n        gl.uniformMatrix4fv(u.projectionMatrix, false, r.activeCamera!.getProjectionMatrix());\r\n        gl.uniformMatrix4fv(u.viewMatrix, false, r.activeCamera!.getViewMatrix());\r\n\r\n        gl.uniform1f(u.frustumPickingColor, cam.frustumColorIndex);\r\n\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            let tagData = this._instanceDataMapValues[i];\r\n\r\n            //\r\n            // Instance individual data\r\n            //\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._qRotBuffer!);\r\n            gl.vertexAttribPointer(a.qRot, tagData._qRotBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._sizeBuffer!);\r\n            gl.vertexAttribPointer(a.aScale, tagData._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._translateBuffer!);\r\n            gl.vertexAttribPointer(a.aTranslate, tagData._translateBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._localPositionBuffer!);\r\n            gl.vertexAttribPointer(a.aLocalPosition, tagData._localPositionBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._rtcPositionHighBuffer!);\r\n            gl.vertexAttribPointer(a.aRTCPositionHigh, tagData._rtcPositionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._rtcPositionLowBuffer!);\r\n            gl.vertexAttribPointer(a.aRTCPositionLow, tagData._rtcPositionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._visibleBuffer!);\r\n            gl.vertexAttribPointer(a.aDispose, tagData._visibleBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            //\r\n            // Instance common data(could be in VAO)\r\n            //\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._vertexBuffer!);\r\n            gl.vertexAttribPointer(a.aVertexPosition, tagData._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, tagData._indicesBuffer!);\r\n            p.drawElementsInstanced!(gl.TRIANGLES, tagData._indicesBuffer!.numItems, gl.UNSIGNED_INT, 0, tagData.numInstances);\r\n        }\r\n    }\r\n\r\n    public drawDepth() {\r\n        if (this._geoObjects.length) {\r\n            this._depthPASS();\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this._geoObjects.length && this.pickingEnabled) {\r\n            this._pickingPASS();\r\n        }\r\n    }\r\n\r\n    protected _pickingPASS() {\r\n        let r = this._renderer!,\r\n            sh = r.handler.programs.geo_object_picking,\r\n            p = sh._program,\r\n            u = p.uniforms,\r\n            a = p.attributes,\r\n            gl = r.handler.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        sh.activate();\r\n\r\n        gl.uniform3fv(u.uScaleByDistance, ec.scaleByDistance);\r\n        gl.uniform3fv(u.pickingScale, ec.pickingScale);\r\n\r\n        gl.uniform3fv(u.rtcEyePositionHigh, this._rtcEyePositionHigh);\r\n        gl.uniform3fv(u.rtcEyePositionLow, this._rtcEyePositionLow);\r\n\r\n        gl.uniformMatrix4fv(u.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\r\n        gl.uniformMatrix4fv(u.viewMatrix, false, r.activeCamera.getViewMatrix());\r\n\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            let tagData = this._instanceDataMapValues[i];\r\n\r\n            //\r\n            // Instance individual data\r\n            //\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._qRotBuffer!);\r\n            gl.vertexAttribPointer(a.qRot, tagData._qRotBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._sizeBuffer!);\r\n            gl.vertexAttribPointer(a.aScale, tagData._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._translateBuffer!);\r\n            gl.vertexAttribPointer(a.aTranslate, tagData._translateBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._localPositionBuffer!);\r\n            gl.vertexAttribPointer(a.aLocalPosition, tagData._localPositionBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._pickingColorBuffer!);\r\n            gl.vertexAttribPointer(a.aPickingColor, tagData._pickingColorBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._rtcPositionHighBuffer!);\r\n            gl.vertexAttribPointer(a.aRTCPositionHigh, tagData._rtcPositionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._rtcPositionLowBuffer!);\r\n            gl.vertexAttribPointer(a.aRTCPositionLow, tagData._rtcPositionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._visibleBuffer!);\r\n            gl.vertexAttribPointer(a.aDispose, tagData._visibleBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            //\r\n            // Instance common data(could be in VAO)\r\n            //\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._vertexBuffer!);\r\n            gl.vertexAttribPointer(a.aVertexPosition, tagData._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, tagData._indicesBuffer!);\r\n            p.drawElementsInstanced!(gl.TRIANGLES, tagData._indicesBuffer!.numItems, gl.UNSIGNED_INT, 0, tagData.numInstances);\r\n        }\r\n    }\r\n\r\n    async _loadColorTexture(tagData: InstanceData) {\r\n        if (this._renderer && tagData._colorTextureSrc) {\r\n            const image = await loadImage(tagData._colorTextureSrc);\r\n            tagData.createColorTexture(image);\r\n        }\r\n    }\r\n\r\n    async _loadNormalTexture(tagData: InstanceData) {\r\n        if (this._renderer && tagData._normalTextureSrc) {\r\n            const image = await loadImage(tagData._normalTextureSrc);\r\n            tagData.createNormalTexture(image);\r\n        }\r\n    }\r\n\r\n    async _loadMetallicRoughnessTexture(tagData: InstanceData) {\r\n        if (this._renderer && tagData._metallicRoughnessTextureSrc) {\r\n            const image = await loadImage(tagData._metallicRoughnessTextureSrc);\r\n            tagData.createMetallicRoughnessTexture(image);\r\n        }\r\n    }\r\n\r\n    public setQRotArr(tagData: InstanceData, tagDataIndex: number, qRot: Quat) {\r\n        setParametersToArray(tagData._qRotArr, tagDataIndex, 4, 4, qRot.x, qRot.y, qRot.z, qRot.w);\r\n        tagData._changedBuffers[QROT_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    public setVisibility(tagData: InstanceData, tagDataIndex: number, visibility: boolean) {\r\n        setParametersToArray(tagData._visibleArr, tagDataIndex, 1, 1, visibility ? 1 : 0);\r\n        tagData._changedBuffers[VISIBLE_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    public setRTCPositionArr(tagData: InstanceData, tagDataIndex: number, rtcPositionHigh: Vec3, rtcPositionLow: Vec3) {\r\n        setParametersToArray(tagData._rtcPositionHighArr, tagDataIndex, 3, 3, rtcPositionHigh.x, rtcPositionHigh.y, rtcPositionHigh.z);\r\n        setParametersToArray(tagData._rtcPositionLowArr, tagDataIndex, 3, 3, rtcPositionLow.x, rtcPositionLow.y, rtcPositionLow.z);\r\n        tagData._changedBuffers[RTC_POSITION_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    public setRgbaArr(tagData: InstanceData, tagDataIndex: number, rgba: Vec4) {\r\n        setParametersToArray(tagData._rgbaArr, tagDataIndex, 4, 4, rgba.x, rgba.y, rgba.z, rgba.w);\r\n        tagData._changedBuffers[RGBA_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    public setPickingColorArr(tagData: InstanceData, tagDataIndex: number, color: Vec3) {\r\n        setParametersToArray(tagData._pickingColorArr, tagDataIndex, 3, 3, color.x / 255, color.y / 255, color.z / 255);\r\n        tagData._changedBuffers[PICKINGCOLOR_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    // setTexCoordArr(tagData, tagDataIndex, tcoordArr) {\r\n    //     setParametersToArray(tagData._texCoordArr, tagDataIndex, 2, 2, ...tcoordArr);\r\n    //     tagData._changedBuffers[TEXCOORD_BUFFER] = true;\r\n    //     this._updateTag(tagData);\r\n    // }\r\n\r\n    public setScaleArr(tagData: InstanceData, tagDataIndex: number, scale: Vec3) {\r\n        setParametersToArray(tagData._sizeArr, tagDataIndex, 3, 3, scale.x, scale.y, scale.z);\r\n        tagData._changedBuffers[SIZE_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    public setTranslateArr(tagData: InstanceData, tagDataIndex: number, translate: Vec3) {\r\n        setParametersToArray(tagData._translateArr, tagDataIndex, 3, 3, translate.x, translate.y, translate.z);\r\n        tagData._changedBuffers[TRANSLATE_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    public setLocalPositionArr(tagData: InstanceData, tagDataIndex: number, localPosition: Vec3) {\r\n        setParametersToArray(tagData._localPositionArr, tagDataIndex, 3, 3, localPosition.x, localPosition.y, localPosition.z);\r\n        tagData._changedBuffers[LOCALPOSITION_BUFFER] = true;\r\n        this._updateTag(tagData);\r\n    }\r\n\r\n    protected _updateTag(dataTag: InstanceData) {\r\n        if (dataTag.isFree) {\r\n            dataTag.isFree = false;\r\n            this._dataTagUpdateQueue.push(dataTag);\r\n        }\r\n    }\r\n\r\n    public update() {\r\n\r\n        for (let i = 0, len = this._dataTagUpdateQueue.length; i < len; i++) {\r\n            this._dataTagUpdateQueue[i].update();\r\n        }\r\n        this._dataTagUpdateQueue = [];\r\n    }\r\n\r\n    public _removeAll() {\r\n        let i = this._geoObjects.length;\r\n        while (i--) {\r\n            const gi = this._geoObjects[i];\r\n\r\n            gi._tagDataIndex = -1;\r\n            gi._tagData = null;\r\n\r\n            gi._handlerIndex = -1;\r\n            gi._handler = null;\r\n        }\r\n        this._geoObjects.length = 0;\r\n        this._geoObjects = [];\r\n\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            this._instanceDataMapValues[i].clear();\r\n        }\r\n\r\n        this._instanceDataMap.clear();\r\n        this._instanceDataMapValues = [];\r\n    }\r\n\r\n    public clear() {\r\n        this._removeAll();\r\n    }\r\n\r\n    public getRTCPosition(pos: Vec3, rtcPositionHigh: Vec3, rtcPositionLow: Vec3) {\r\n        let rtcPosition = pos.sub(this._relativeCenter);\r\n        Vec3.doubleToTwoFloats(rtcPosition, rtcPositionHigh, rtcPositionLow);\r\n    }\r\n\r\n    public setRelativeCenter(c: Vec3) {\r\n        this._relativeCenter.copy(c);\r\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\r\n            let instanceData = this._instanceDataMapValues[i];\r\n            let geoObjects = instanceData.geoObjects;\r\n            for (let j = 0; j < geoObjects.length; j++) {\r\n                geoObjects[j].updateRTCPosition();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _updateRTCEyePosition() {\r\n        let r = this._renderer!;\r\n        if (r.activeCamera.isFirstPass) {\r\n            let rtcEyePosition = r.activeCamera.eye.sub(this._relativeCenter);\r\n            Vec3.doubleToTwoFloat32Array(rtcEyePosition, this._rtcEyePositionHigh, this._rtcEyePositionLow);\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        if (this._geoObjects.length) {\r\n            this._updateRTCEyePosition();\r\n            this.update();\r\n            this._displayOpaquePASS();\r\n        }\r\n    }\r\n\r\n    public drawTransparent() {\r\n        if (this._geoObjects.length) {\r\n            this._displayTransparentPASS();\r\n        }\r\n    }\r\n\r\n    public add(geoObject: GeoObject) {\r\n\r\n        if (geoObject._handlerIndex === -1) {\r\n\r\n            geoObject._handler = this;\r\n            geoObject._handlerIndex = this._geoObjects.length;\r\n\r\n            this._geoObjects.push(geoObject);\r\n            this._addGeoObjectToArray(geoObject);\r\n\r\n            geoObject.updateRotation();\r\n\r\n            geoObject._tagData!.refresh();\r\n\r\n            this._updateTag(geoObject._tagData!);\r\n            geoObject.setObjectSrc(geoObject._objectSrc!);\r\n        }\r\n    }\r\n\r\n    public remove(geoObject: GeoObject) {\r\n        if (geoObject._handler && this.__id == geoObject._handler.__id) {\r\n            this._removeGeoObject(geoObject);\r\n        }\r\n    }\r\n\r\n    public _clearDataTagQueue() {\r\n        this._dataTagUpdateQueue = [];\r\n    }\r\n\r\n\r\n    public _removeGeoObject(geoObject: GeoObject) {\r\n\r\n        let tagData = geoObject._tagData!;\r\n        let tag = geoObject.tag;\r\n\r\n        tagData.numInstances--;\r\n\r\n        let isEmpty = false;\r\n        // dataTag becomes empty, remove it from the rendering\r\n        if (tagData.numInstances === 0) {\r\n            tagData.clear();\r\n            this._instanceDataMap.delete(tag);\r\n            this._instanceDataMapValues = [];\r\n            this._clearDataTagQueue();\r\n            isEmpty = true;\r\n        }\r\n\r\n        this._geoObjects.splice(geoObject._handlerIndex, 1);\r\n        for (let i = geoObject._handlerIndex, len = this._geoObjects.length; i < len; i++) {\r\n            let gi = this._geoObjects[i];\r\n            gi._handlerIndex = gi._handlerIndex - 1;\r\n        }\r\n\r\n        let tdi = geoObject._tagDataIndex;\r\n        tagData.geoObjects.splice(tdi, 1);\r\n\r\n        for (let i = geoObject._tagDataIndex, len = tagData.geoObjects.length; i < len; i++) {\r\n            let gi = tagData.geoObjects[i];\r\n            gi._tagDataIndex = gi._tagDataIndex - 1;\r\n        }\r\n\r\n        tagData._rgbaArr = spliceArray(tagData._rgbaArr, tdi * 4, 4);\r\n        tagData._rtcPositionHighArr = spliceArray(tagData._rtcPositionHighArr, tdi * 3, 3);\r\n        tagData._rtcPositionLowArr = spliceArray(tagData._rtcPositionLowArr, tdi * 3, 3);\r\n        tagData._qRotArr = spliceArray(tagData._qRotArr, tdi * 4, 4);\r\n        tagData._pickingColorArr = spliceArray(tagData._pickingColorArr, tdi * 3, 3);\r\n        tagData._sizeArr = spliceArray(tagData._sizeArr, tdi * 3, 3);\r\n        tagData._translateArr = spliceArray(tagData._translateArr, tdi * 3, 3);\r\n        tagData._localPositionArr = spliceArray(tagData._localPositionArr, tdi * 3, 3);\r\n        tagData._visibleArr = spliceArray(tagData._visibleArr, tdi, 1);\r\n\r\n        geoObject._handlerIndex = -1;\r\n        geoObject._handler = null;\r\n\r\n        geoObject._tagDataIndex = -1;\r\n        geoObject._tagData = null;\r\n\r\n        if (!isEmpty) {\r\n            tagData.refresh();\r\n            this._updateTag(tagData);\r\n        }\r\n    }\r\n}\r\n","#version 300 es\r\n\r\n#include \"../billboard/common.glsl\"\r\n\r\nin float a_outline;\r\nin vec4 a_gliphParam;\r\nin vec2 a_vertices;\r\nin vec4 a_texCoord;\r\nin vec3 a_positionsHigh;\r\nin vec3 a_positionsLow;\r\nin vec3 a_offset;\r\nin float a_size;\r\nin float a_rotation;\r\nin vec4 a_rgba;\r\nin float a_fontIndex;\r\n\r\nout vec2 v_uv;\r\nout vec4 v_rgba;\r\nflat out int v_fontIndex;\r\nout vec4 v_outlineColor;\r\nflat out float v_outline;\r\n\r\nuniform vec2 viewport;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float planetRadius;\r\nuniform vec3 scaleByDistance;\r\nuniform float opacity;\r\nuniform float depthOffset;\r\n\r\nconst vec3 ZERO3 = vec3(0.0);\r\n\r\n\r\nvoid main() {\r\n\r\n    if (a_texCoord.w == EMPTY) {\r\n        gl_Position = vec4(0.0);\r\n        v_fontIndex = -1;\r\n        return;\r\n    }\r\n\r\n    vec3 a_positions = a_positionsHigh + a_positionsLow;\r\n    vec3 cameraPos = eyePositionHigh + eyePositionLow;\r\n\r\n    v_outline = a_outline;\r\n\r\n    v_fontIndex = int(a_fontIndex);\r\n    v_uv = a_texCoord.xy;\r\n    vec3 look = a_positions - cameraPos;\r\n    float lookDist = length(look);\r\n    v_rgba = a_rgba;\r\n\r\n    if (opacity * step(lookDist, sqrt(dot(cameraPos, cameraPos) - planetRadius) + sqrt(dot(a_positions, a_positions) - planetRadius)) == 0.0) {\r\n        return;\r\n    }\r\n\r\n    float scd = (1.0 - smoothstep(scaleByDistance[0], scaleByDistance[1], lookDist)) * (1.0 - step(scaleByDistance[2], lookDist));\r\n\r\n    v_rgba.a *= opacity;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = a_positionsHigh - eyePositionHigh;\r\n    vec3 lowDiff = a_positionsLow - eyePositionLow;\r\n    vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n    vec4 projPos = projectionMatrix * posRTE;\r\n\r\n    float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));\r\n    if (camSlope > 0.5) {\r\n        float dist = dot(look, normalize(cameraPos));\r\n        projPos.z += dist * 0.02;\r\n    } else {\r\n        projPos.z += -(abs(projPos.z)) * 0.002;\r\n    }\r\n\r\n    projPos.z += depthOffset + a_offset.z;\r\n\r\n    vec2 screenPos = project(projPos, viewport);\r\n\r\n    vec2 vert = a_vertices;\r\n    vec4 gp = a_gliphParam;\r\n    if (a_texCoord.w == RTL) {\r\n        vert.x = step(vert.x * 0.5 + 1.0, 1.0);\r\n        gp.x = -a_gliphParam.x;\r\n        gp.z = -(a_gliphParam.z + a_texCoord.z);\r\n    } else {\r\n        gp.z = a_gliphParam.z + a_texCoord.z;\r\n    }\r\n\r\n    vec2 v = screenPos + rotate2d(a_rotation) * ((vert * gp.xy + gp.zw) * a_size * scd + a_offset.xy);\r\n\r\n    gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\r\n}","#version 300 es\r\n\r\nuniform int isOutlinePass;\r\n\r\nprecision highp float;\r\n\r\nconst int MAX_SIZE = 11;\r\n\r\n// x - ATLAS_WIDTH = 512.0;\r\n// y - ATLAS_HEIGHT = 512.0;\r\n// z - ATLAS_GLYPH_SIZE = 32.0;\r\n// w - ATLAS_FIELD_RANGE = 8.0;\r\n\r\nuniform sampler2D fontTextureArr[MAX_SIZE];\r\nuniform vec4 sdfParamsArr[MAX_SIZE];\r\n\r\nflat in int v_fontIndex;\r\nin vec2 v_uv;\r\nin vec4 v_rgba;\r\n\r\nflat in float v_outline;\r\n\r\nin vec3 v_pickingColor;\r\n\r\nlayout (location = 0) out vec4 outScreen;\r\n\r\nfloat median(float r, float g, float b) {\r\n    return max(min(r, g), min(max(r, g), b));\r\n}\r\n\r\nfloat getDistance() {\r\n    vec3 msdf;\r\n    if (v_fontIndex == 0) {\r\n        msdf = texture(fontTextureArr[0], v_uv).rgb;\r\n    } else if (v_fontIndex == 1) {\r\n        msdf = texture(fontTextureArr[1], v_uv).rgb;\r\n    } else if (v_fontIndex == 2) {\r\n        msdf = texture(fontTextureArr[2], v_uv).rgb;\r\n    } else if (v_fontIndex == 3) {\r\n        msdf = texture(fontTextureArr[3], v_uv).rgb;\r\n    } else if (v_fontIndex == 4) {\r\n        msdf = texture(fontTextureArr[4], v_uv).rgb;\r\n    } else if (v_fontIndex == 5) {\r\n        msdf = texture(fontTextureArr[5], v_uv).rgb;\r\n    } else if (v_fontIndex == 6) {\r\n        msdf = texture(fontTextureArr[6], v_uv).rgb;\r\n    } else if (v_fontIndex == 7) {\r\n        msdf = texture(fontTextureArr[7], v_uv).rgb;\r\n    } else if (v_fontIndex == 8) {\r\n        msdf = texture(fontTextureArr[8], v_uv).rgb;\r\n    } else if (v_fontIndex == 9) {\r\n        msdf = texture(fontTextureArr[9], v_uv).rgb;\r\n    } else if (v_fontIndex == 10) {\r\n        msdf = texture(fontTextureArr[10], v_uv).rgb;\r\n    }\r\n    return median(msdf.r, msdf.g, msdf.b);\r\n}\r\n\r\nvoid main() {\r\n\r\n    if (v_fontIndex == -1) {\r\n        return;\r\n    }\r\n\r\n    vec4 sdfParams = sdfParamsArr[v_fontIndex];\r\n    float sd = getDistance();\r\n    vec2 dxdy = fwidth(v_uv) * sdfParams.xy;\r\n\r\n    if (isOutlinePass == 0) {\r\n        float dist = sd + min(0.001, 0.5 - 1.0 / sdfParams.w) - 0.5;\r\n        float opacity = clamp(dist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);\r\n        if (opacity <= 0.1) {\r\n            discard;\r\n        }\r\n        outScreen = vec4(v_rgba.rgb, opacity * v_rgba.a);\r\n    } else {\r\n        float dist = sd + min(v_outline, 0.5 - 1.0 / sdfParams.w) - 0.5;\r\n        float opacity = clamp(dist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);\r\n        if (opacity <= 0.1) {\r\n            discard;\r\n        }\r\n        outScreen = vec4(v_rgba.rgb, opacity * v_rgba.a);\r\n        //outScreen = v_rgba * strokeAlpha * (0.5 - opacity) * 2.0;\r\n    }\r\n}","#include \"../billboard/common.glsl\"\r\n\r\nattribute float a_outline;\r\nattribute vec4 a_gliphParam;\r\nattribute vec2 a_vertices;\r\nattribute vec4 a_texCoord;\r\nattribute vec3 a_positionsHigh;\r\nattribute vec3 a_positionsLow;\r\nattribute vec3 a_offset;\r\nattribute float a_size;\r\nattribute float a_rotation;\r\nattribute vec4 a_rgba;\r\nattribute float a_fontIndex;\r\n\r\nvarying float v_outline;\r\nvarying vec2 v_uv;\r\nvarying vec4 v_rgba;\r\nvarying float v_fontIndex;\r\n\r\nuniform vec2 viewport;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float planetRadius;\r\nuniform vec3 scaleByDistance;\r\nuniform float opacity;\r\nuniform float depthOffset;\r\n\r\nconst vec3 ZERO3 = vec3(0.0);\r\n\r\nvoid main() {\r\n\r\n    if (a_texCoord.w == EMPTY) {\r\n        gl_Position = vec4(0.0);\r\n        v_fontIndex = -1.0;\r\n        return;\r\n    }\r\n\r\n    vec3 a_positions = a_positionsHigh + a_positionsLow;\r\n    vec3 cameraPos = eyePositionHigh + eyePositionLow;\r\n\r\n    v_outline = a_outline;\r\n    v_uv = vec2(a_texCoord.xy);\r\n    v_rgba = a_rgba;\r\n    v_fontIndex = a_fontIndex;\r\n\r\n    vec3 look = a_positions - cameraPos;\r\n    float lookDist = length(look);\r\n\r\n    if (opacity * step(lookDist, sqrt(dot(cameraPos, cameraPos) - planetRadius) + sqrt(dot(a_positions, a_positions) - planetRadius)) == 0.0) {\r\n        return;\r\n    }\r\n\r\n    float scd = (1.0 - smoothstep(scaleByDistance[0], scaleByDistance[1], lookDist)) * (1.0 - step(scaleByDistance[2], lookDist));\r\n\r\n    v_rgba.a *= opacity;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = a_positionsHigh - eyePositionHigh;\r\n    vec3 lowDiff = a_positionsLow - eyePositionLow;\r\n    vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n    vec4 projPos = projectionMatrix * posRTE;\r\n\r\n    float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));\r\n    if (camSlope > 0.5) {\r\n        float dist = dot(look, normalize(cameraPos));\r\n        projPos.z += dist * 0.02;\r\n    } else {\r\n        projPos.z += -(abs(projPos.z)) * 0.002;\r\n    }\r\n\r\n    projPos.z += depthOffset + a_offset.z;\r\n\r\n    vec2 screenPos = project(projPos, viewport);\r\n\r\n    vec2 vert = a_vertices;\r\n    vec4 gp = a_gliphParam;\r\n    if (a_texCoord.w == RTL) {\r\n        vert.x = step(vert.x * 0.5 + 1.0, 1.0);\r\n        gp.x = -a_gliphParam.x;\r\n        gp.z = -(a_gliphParam.z + a_texCoord.z);\r\n    } else {\r\n        gp.z = a_gliphParam.z + a_texCoord.z;\r\n    }\r\n\r\n    vec2 v = screenPos + rotate2d(a_rotation) * ((vert * gp.xy + gp.zw) * a_size * scd + a_offset.xy);\r\n\r\n    gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\r\n}","#extension GL_OES_standard_derivatives: enable\r\n\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nconst int MAX_SIZE = 11;\r\n\r\n// x - ATLAS_WIDTH = 512.0;\r\n// y - ATLAS_HEIGHT = 512.0;\r\n// z - ATLAS_GLYPH_SIZE = 32.0;\r\n// w - ATLAS_FIELD_RANGE = 8.0;\r\n\r\nuniform sampler2D fontTextureArr[MAX_SIZE];\r\nuniform vec4 sdfParamsArr[MAX_SIZE];\r\nuniform int isOutlinePass;\r\n\r\nvarying float v_outline;\r\nvarying vec2 v_uv;\r\nvarying vec4 v_rgba;\r\nvarying float v_fontIndex;\r\n\r\nfloat fontIndex;\r\n\r\nfloat median(float r, float g, float b) {\r\n    return max(min(r, g), min(max(r, g), b));\r\n}\r\n\r\nfloat getDistance() {\r\n    vec3 msdf;\r\n    if (fontIndex >= 0.0 && fontIndex < 1.0) {\r\n        msdf = texture2D(fontTextureArr[0], v_uv).rgb;\r\n    } else if (fontIndex >= 1.0 && fontIndex < 2.0) {\r\n        msdf = texture2D(fontTextureArr[1], v_uv).rgb;\r\n    } else if (fontIndex >= 2.0 && fontIndex < 3.0) {\r\n        msdf = texture2D(fontTextureArr[2], v_uv).rgb;\r\n    } else if (fontIndex >= 3.0 && fontIndex < 4.0) {\r\n        msdf = texture2D(fontTextureArr[3], v_uv).rgb;\r\n    } else if (fontIndex >= 4.0 && fontIndex < 5.0) {\r\n        msdf = texture2D(fontTextureArr[4], v_uv).rgb;\r\n    } else if (fontIndex >= 5.0 && fontIndex < 6.0) {\r\n        msdf = texture2D(fontTextureArr[5], v_uv).rgb;\r\n    } else if (fontIndex >= 6.0 && fontIndex < 7.0) {\r\n        msdf = texture2D(fontTextureArr[6], v_uv).rgb;\r\n    } else if (fontIndex >= 7.0 && fontIndex < 8.0) {\r\n        msdf = texture2D(fontTextureArr[7], v_uv).rgb;\r\n    } else if (fontIndex >= 8.0 && fontIndex < 9.0) {\r\n        msdf = texture2D(fontTextureArr[8], v_uv).rgb;\r\n    } else if (fontIndex >= 9.0 && fontIndex < 10.0) {\r\n        msdf = texture2D(fontTextureArr[9], v_uv).rgb;\r\n    } else if (fontIndex >= 10.0 && fontIndex < 11.0) {\r\n        msdf = texture2D(fontTextureArr[10], v_uv).rgb;\r\n    }\r\n    return median(msdf.r, msdf.g, msdf.b);\r\n}\r\n\r\n\r\nvec4 getSDFParams() {\r\n    if (fontIndex >= 0.0 && fontIndex < 1.0) {\r\n        return sdfParamsArr[0];\r\n    } else if (fontIndex >= 1.0 && fontIndex < 2.0) {\r\n        return sdfParamsArr[1];\r\n    } else if (fontIndex >= 2.0 && fontIndex < 3.0) {\r\n        return sdfParamsArr[2];\r\n    } else if (fontIndex >= 3.0 && fontIndex < 4.0) {\r\n        return sdfParamsArr[3];\r\n    } else if (fontIndex >= 4.0 && fontIndex < 5.0) {\r\n        return sdfParamsArr[4];\r\n    } else if (fontIndex >= 5.0 && fontIndex < 6.0) {\r\n        return sdfParamsArr[5];\r\n    } else if (fontIndex >= 6.0 && fontIndex < 7.0) {\r\n        return sdfParamsArr[6];\r\n    } else if (fontIndex >= 7.0 && fontIndex < 8.0) {\r\n        return sdfParamsArr[7];\r\n    } else if (fontIndex >= 8.0 && fontIndex < 9.0) {\r\n        return sdfParamsArr[8];\r\n    } else if (fontIndex >= 9.0 && fontIndex < 10.0) {\r\n        return sdfParamsArr[9];\r\n    } else if (fontIndex >= 10.0 && fontIndex < 11.0) {\r\n        return sdfParamsArr[10];\r\n    }\r\n}\r\n\r\nvoid main() {\r\n\r\n    fontIndex = v_fontIndex + 0.1;\r\n\r\n    if (v_fontIndex < 0.0) {\r\n        return;\r\n    }\r\n\r\n    vec4 sdfParams = getSDFParams();\r\n    float sd = getDistance();\r\n    vec2 dxdy = fwidth(v_uv) * sdfParams.xy;\r\n    float dist = sd + min(0.001, 0.5 - 1.0 / sdfParams.w) - 0.5;\r\n    float opacity = clamp(dist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);\r\n\r\n    if (isOutlinePass == 0) {\r\n        //gl_FragColor = vec4(v_rgba.rgb, opacity * v_rgba.a);\r\n    } else {\r\n        float strokeDist = sd + min(v_outline, 0.5 - 1.0 / sdfParams.w) - 0.5;\r\n        float strokeAlpha = v_rgba.a * clamp(strokeDist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);\r\n        if (strokeAlpha < 0.1) {\r\n            discard;\r\n        }\r\n        //gl_FragColor = v_rgba * strokeAlpha * (0.5 - opacity) * 2.0;\r\n    }\r\n}","#include \"../billboard/common.glsl\"\r\n\r\nattribute vec4 a_gliphParam;\r\nattribute vec2 a_vertices;\r\nattribute vec4 a_texCoord;\r\nattribute vec3 a_positionsHigh;\r\nattribute vec3 a_positionsLow;\r\nattribute vec3 a_offset;\r\nattribute float a_size;\r\nattribute float a_rotation;\r\nattribute vec4 a_rgba;\r\n\r\nvarying vec4 v_rgba;\r\n\r\nuniform vec2 viewport;\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float planetRadius;\r\nuniform vec3 scaleByDistance;\r\nuniform float opacity;\r\nuniform float depthOffset;\r\n\r\nconst vec3 ZERO3 = vec3(0.0);\r\n\r\nvoid main() {\r\n    vec3 a_positions = a_positionsHigh + a_positionsLow;\r\n    vec3 cameraPos = eyePositionHigh + eyePositionLow;\r\n    v_rgba = a_rgba;\r\n\r\n    if (a_texCoord.w == EMPTY) {\r\n        v_rgba.a = 0.0;\r\n        gl_Position = vec4(0.0);\r\n        return;\r\n    }\r\n\r\n    vec3 look = a_positions - cameraPos;\r\n    float lookDist = length(look);\r\n    if (opacity * step(lookDist, sqrt(dot(cameraPos, cameraPos) - planetRadius) + sqrt(dot(a_positions, a_positions) - planetRadius)) == 0.0) {\r\n        return;\r\n    }\r\n\r\n    float scd = (1.0 - smoothstep(scaleByDistance[0], scaleByDistance[1], lookDist)) * (1.0 - step(scaleByDistance[2], lookDist));\r\n\r\n    v_rgba.a *= opacity;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff = a_positionsHigh - eyePositionHigh;\r\n    vec3 lowDiff = a_positionsLow - eyePositionLow;\r\n    vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n    vec4 projPos = projectionMatrix * posRTE;\r\n\r\n    float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));\r\n    if (camSlope > 0.5) {\r\n        float dist = dot(look, normalize(cameraPos));\r\n        projPos.z += dist * 0.02;\r\n    } else {\r\n        projPos.z += -(abs(projPos.z)) * 0.002;\r\n    }\r\n\r\n    projPos.z += depthOffset + a_offset.z;\r\n\r\n    vec2 screenPos = project(projPos, viewport);\r\n\r\n    vec2 vert = a_vertices;\r\n    vec4 gp = a_gliphParam;\r\n    if (a_texCoord.w == RTL) {\r\n        vert.x = step(vert.x * 0.5 + 1.0, 1.0);\r\n        gp.x = -a_gliphParam.x;\r\n        gp.z = -(a_gliphParam.z + a_texCoord.z);\r\n    } else {\r\n        gp.z = a_gliphParam.z + a_texCoord.z;\r\n    }\r\n\r\n    vec2 v = screenPos + rotate2d(a_rotation) * ((vert * gp.xy + gp.zw) * a_size * scd + a_offset.xy);\r\n\r\n    gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\r\n}","precision highp float;\r\n\r\nvarying vec4 v_rgba;\r\n\r\nvarying vec3 v_pickingColor;\r\n\r\nvoid main() {\r\n\r\n    vec4 color = v_rgba;\r\n    if (color.a < 0.05) {\r\n        return;\r\n    }\r\n\r\n    gl_FragColor = vec4(v_rgba.rgb, v_rgba.a);\r\n}","import {Program} from '../../webgl/Program';\r\n\r\nimport label_webgl2_vert from './label_webgl2.vert.glsl';\r\nimport label_webgl2_frag from './label_webgl2.frag.glsl';\r\n\r\nimport label_webgl1_vert from './label_webgl1.vert.glsl';\r\nimport label_webgl1_frag from './label_webgl1.frag.glsl';\r\n\r\nimport label_picking_vert from './label_picking.vert.glsl';\r\nimport label_picking_frag from './label_picking.frag.glsl';\r\n\r\nexport function label_webgl2(): Program {\r\n    return new Program(\"label\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            fontTextureArr: \"sampler2darray\",\r\n            sdfParamsArr: \"vec4\",\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            planetRadius: \"float\",\r\n            scaleByDistance: \"vec3\",\r\n            opacity: \"float\",\r\n            isOutlinePass: \"int\",\r\n            depthOffset: \"float\"\r\n        },\r\n        attributes: {\r\n            a_outline: \"float\",\r\n            a_gliphParam: \"vec4\",\r\n            a_vertices: \"vec2\",\r\n            a_texCoord: \"vec4\",\r\n            a_positionsHigh: \"vec3\",\r\n            a_positionsLow: \"vec3\",\r\n            a_size: \"float\",\r\n            a_rotation: \"float\",\r\n            a_rgba: \"vec4\",\r\n            a_offset: \"vec3\",\r\n            a_fontIndex: \"float\"\r\n        },\r\n        vertexShader: label_webgl2_vert,\r\n        fragmentShader: label_webgl2_frag\r\n    });\r\n}\r\n\r\nexport function label_screen(): Program {\r\n    return new Program(\"label\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            fontTextureArr: \"sampler2darray\",\r\n            sdfParamsArr: \"vec4\",\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            planetRadius: \"float\",\r\n            scaleByDistance: \"vec3\",\r\n            opacity: \"float\",\r\n            isOutlinePass: \"int\",\r\n            depthOffset: \"float\"\r\n        },\r\n        attributes: {\r\n            a_outline: \"float\",\r\n            a_gliphParam: \"vec4\",\r\n            a_vertices: \"vec2\",\r\n            a_texCoord: \"vec4\",\r\n            a_positionsHigh: \"vec3\",\r\n            a_positionsLow: \"vec3\",\r\n            a_size: \"float\",\r\n            a_rotation: \"float\",\r\n            a_rgba: \"vec4\",\r\n            a_offset: \"vec3\",\r\n            a_fontIndex: \"float\"\r\n        },\r\n        vertexShader: label_webgl1_vert,\r\n        fragmentShader: label_webgl1_frag,\r\n    });\r\n}\r\n\r\nexport function labelPicking(): Program {\r\n    return new Program(\"labelPicking\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            planetRadius: \"float\",\r\n            scaleByDistance: \"vec3\",\r\n            opacity: \"float\",\r\n            depthOffset: \"float\"\r\n        },\r\n        attributes: {\r\n            a_gliphParam: \"vec4\",\r\n            a_vertices: \"vec2\",\r\n            a_texCoord: \"vec4\",\r\n            a_positionsHigh: \"vec3\",\r\n            a_positionsLow: \"vec3\",\r\n            a_offset: \"vec3\",\r\n            a_size: \"float\",\r\n            a_rotation: \"float\",\r\n            a_rgba: \"vec4\"\r\n        },\r\n        vertexShader: label_picking_vert,\r\n        fragmentShader: label_picking_frag,\r\n    });\r\n}","import * as shaders from \"../shaders/label/label\";\r\nimport {ALIGN, Label} from \"./Label\";\r\nimport {BaseBillboardHandler} from \"./BaseBillboardHandler\";\r\nimport {concatTypedArrays, spliceTypedArray} from \"../utils/shared\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport {LOCK_FREE} from \"./LabelWorker\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\n\r\ntype LabelWorkerCallbackData = {\r\n    vertexArr: Float32Array,\r\n    texCoordArr: Float32Array,\r\n    gliphParamArr: Float32Array,\r\n    positionHighArr: Float32Array,\r\n    positionLowArr: Float32Array,\r\n    sizeArr: Float32Array,\r\n    offsetArr: Float32Array,\r\n    rgbaArr: Float32Array,\r\n    rotationArr: Float32Array,\r\n    fontIndexArr: Float32Array,\r\n    outlineArr: Float32Array,\r\n    outlineColorArr: Float32Array,\r\n    pickingColorArr: Float32Array\r\n}\r\n\r\nconst PICKINGCOLOR_BUFFER = 0;\r\nconst POSITION_BUFFER = 1;\r\nconst SIZE_BUFFER = 2;\r\nconst OFFSET_BUFFER = 3;\r\nconst RGBA_BUFFER = 4;\r\nconst ROTATION_BUFFER = 5;\r\nconst TEXCOORD_BUFFER = 6;\r\nconst VERTEX_BUFFER = 7;\r\nconst FONTINDEX_BUFFER = 8;\r\nconst OUTLINE_BUFFER = 9;\r\nconst OUTLINECOLOR_BUFFER = 10;\r\n\r\nconst EMPTY = -1.0;\r\nconst RTL = 1.0;\r\n\r\nclass LabelHandler extends BaseBillboardHandler {\r\n\r\n    protected override _billboards: Label[];\r\n\r\n    protected _gliphParamBuffer: WebGLBufferExt | null;\r\n    protected _fontIndexBuffer: WebGLBufferExt | null;\r\n    protected _outlineBuffer: WebGLBufferExt | null;\r\n    protected _outlineColorBuffer: WebGLBufferExt | null;\r\n\r\n    protected _gliphParamArr: Float32Array;\r\n    protected _fontIndexArr: Float32Array;\r\n    protected _outlineArr: Float32Array;\r\n    protected _outlineColorArr: Float32Array;\r\n\r\n    public _maxLetters: number;\r\n\r\n    constructor(entityCollection: EntityCollection, maxLetters: number = 21) {\r\n        super(entityCollection);\r\n\r\n        this._billboards = [];\r\n\r\n        this._gliphParamBuffer = null;\r\n        this._fontIndexBuffer = null;\r\n        this._outlineBuffer = null;\r\n        this._outlineColorBuffer = null;\r\n\r\n        this._gliphParamArr = new Float32Array([]);\r\n        this._fontIndexArr = new Float32Array([]);\r\n        this._outlineArr = new Float32Array([]);\r\n        this._outlineColorArr = new Float32Array([]);\r\n\r\n        this._buffersUpdateCallbacks[FONTINDEX_BUFFER] = this.createFontIndexBuffer;\r\n        this._buffersUpdateCallbacks[OUTLINE_BUFFER] = this.createOutlineBuffer;\r\n        this._buffersUpdateCallbacks[OUTLINECOLOR_BUFFER] = this.createOutlineColorBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n\r\n        this._maxLetters = maxLetters;\r\n    }\r\n\r\n    public override initProgram() {\r\n        if (this._renderer && this._renderer.handler && this._renderer.handler.gl) {\r\n            if (!this._renderer.handler.programs.label) {\r\n                if (this._renderer.handler.gl.type === \"webgl2\") {\r\n                    this._renderer.handler.addProgram(shaders.label_webgl2());\r\n                } else {\r\n                    this._renderer.handler.addProgram(shaders.label_screen());\r\n                }\r\n            }\r\n\r\n            if (!this._renderer.handler.programs.labelPicking) {\r\n                this._renderer.handler.addProgram(shaders.labelPicking());\r\n            }\r\n        }\r\n    }\r\n\r\n    public get labels(): Label[] {\r\n        return this._billboards;\r\n    }\r\n\r\n    public override add(label: Label) {\r\n        if (!label._handler) {\r\n            label._handler = this;\r\n            this.assignFontAtlas(label);\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    public updateFonts() {\r\n        let l = [...this._billboards];\r\n        this._billboards = [];\r\n        for (let i = 0; i < l.length; i++) {\r\n            this.assignFontAtlas(l[i]);\r\n        }\r\n    }\r\n\r\n    protected _addLabelToArrays(label: Label) {\r\n        this._renderer && this._renderer.labelWorker.make({handler: this, label: label});\r\n    }\r\n\r\n    public assignFontAtlas(label: Label) {\r\n        if (this._entityCollection && this._renderer) {\r\n            label.assignFontAtlas(this._renderer.fontAtlas);\r\n            this._addLabelToArrays(label);\r\n        } else {\r\n            this._billboards.push(label);\r\n        }\r\n    }\r\n\r\n    public workerCallback(data: LabelWorkerCallbackData, label: Label) {\r\n        if (label._lockId !== LOCK_FREE && label._handler && this.isEqual(label._handler)) {\r\n            label._isReady = true;\r\n            label._lockId = LOCK_FREE;\r\n            label._handlerIndex = this._billboards.length;\r\n\r\n            this._billboards.push(label);\r\n\r\n            this._vertexArr = concatTypedArrays(this._vertexArr, data.vertexArr) as Float32Array;\r\n            this._texCoordArr = concatTypedArrays(this._texCoordArr, data.texCoordArr) as Float32Array;\r\n            this._gliphParamArr = concatTypedArrays(this._gliphParamArr, data.gliphParamArr) as Float32Array;\r\n            this._positionHighArr = concatTypedArrays(this._positionHighArr, data.positionHighArr) as Float32Array;\r\n            this._positionLowArr = concatTypedArrays(this._positionLowArr, data.positionLowArr) as Float32Array;\r\n            this._sizeArr = concatTypedArrays(this._sizeArr, data.sizeArr) as Float32Array;\r\n            this._offsetArr = concatTypedArrays(this._offsetArr, data.offsetArr) as Float32Array;\r\n            this._rgbaArr = concatTypedArrays(this._rgbaArr, data.rgbaArr) as Float32Array;\r\n            this._rotationArr = concatTypedArrays(this._rotationArr, data.rotationArr) as Float32Array;\r\n            this._fontIndexArr = concatTypedArrays(this._fontIndexArr, data.fontIndexArr) as Float32Array;\r\n            this._outlineArr = concatTypedArrays(this._outlineArr, data.outlineArr) as Float32Array;\r\n            this._outlineColorArr = concatTypedArrays(this._outlineColorArr, data.outlineColorArr) as Float32Array;\r\n            this._pickingColorArr = concatTypedArrays(this._pickingColorArr, data.pickingColorArr) as Float32Array;\r\n\r\n            label.update();\r\n\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    public override clear() {\r\n        // @ts-ignore\r\n        this._texCoordArr = null;\r\n        // @ts-ignore\r\n        this._gliphParamArr = null;\r\n        // @ts-ignore\r\n        this._vertexArr = null;\r\n        // @ts-ignore\r\n        this._positionHighArr = null;\r\n        // @ts-ignore\r\n        this._positionLowArr = null;\r\n        // @ts-ignore\r\n        this._sizeArr = null;\r\n        // @ts-ignore\r\n        this._offsetArr = null;\r\n        // @ts-ignore\r\n        this._rgbaArr = null;\r\n        // @ts-ignore\r\n        this._rotationArr = null;\r\n        // @ts-ignore\r\n        this._fontIndexArr = null;\r\n        // @ts-ignore\r\n        this._outlineArr = null;\r\n        // @ts-ignore\r\n        this._outlineColorArr = null;\r\n\r\n        this._texCoordArr = new Float32Array([]);\r\n        this._gliphParamArr = new Float32Array([]);\r\n        this._vertexArr = new Float32Array([]);\r\n        this._positionHighArr = new Float32Array([]);\r\n        this._positionLowArr = new Float32Array([]);\r\n        this._sizeArr = new Float32Array([]);\r\n        this._offsetArr = new Float32Array([]);\r\n        this._rgbaArr = new Float32Array([]);\r\n        this._rotationArr = new Float32Array([]);\r\n        this._fontIndexArr = new Float32Array([]);\r\n        this._outlineArr = new Float32Array([]);\r\n        this._outlineColorArr = new Float32Array([]);\r\n\r\n        this._removeBillboards();\r\n        this._deleteBuffers();\r\n        this.refresh();\r\n    }\r\n\r\n    protected override _deleteBuffers() {\r\n        if (this._renderer) {\r\n            let gl = this._renderer.handler.gl!;\r\n            gl.deleteBuffer(this._gliphParamBuffer!);\r\n            gl.deleteBuffer(this._sizeBuffer!);\r\n            gl.deleteBuffer(this._fontIndexBuffer!);\r\n            gl.deleteBuffer(this._texCoordBuffer!);\r\n            gl.deleteBuffer(this._outlineBuffer!);\r\n            gl.deleteBuffer(this._outlineColorBuffer!);\r\n            gl.deleteBuffer(this._positionHighBuffer!);\r\n            gl.deleteBuffer(this._positionLowBuffer!);\r\n            gl.deleteBuffer(this._sizeBuffer!);\r\n            gl.deleteBuffer(this._offsetBuffer!);\r\n            gl.deleteBuffer(this._rgbaBuffer!);\r\n            gl.deleteBuffer(this._rotationBuffer!);\r\n            gl.deleteBuffer(this._vertexBuffer!);\r\n            gl.deleteBuffer(this._texCoordBuffer!);\r\n            gl.deleteBuffer(this._pickingColorBuffer!);\r\n\r\n            this._gliphParamBuffer = null;\r\n            this._sizeBuffer = null;\r\n            this._fontIndexBuffer = null;\r\n            this._texCoordBuffer = null;\r\n            this._outlineBuffer = null;\r\n            this._outlineColorBuffer = null;\r\n            this._positionHighBuffer = null;\r\n            this._positionLowBuffer = null;\r\n            this._sizeBuffer = null;\r\n            this._offsetBuffer = null;\r\n            this._rgbaBuffer = null;\r\n            this._rotationBuffer = null;\r\n            this._vertexBuffer = null;\r\n            this._texCoordBuffer = null;\r\n            this._pickingColorBuffer = null;\r\n        }\r\n    }\r\n\r\n    public override _displayPASS() {\r\n        let r = this._renderer!;\r\n        let h = r.handler;\r\n        h.programs.label.activate();\r\n        let sh = h.programs.label._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        let gl = h.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        gl.uniform1iv(shu.fontTextureArr, r.fontAtlas.samplerArr);\r\n        gl.uniform4fv(shu.sdfParamsArr, r.fontAtlas.sdfParamsArr);\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\r\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\r\n        gl.uniform3fv(shu.scaleByDistance, ec.scaleByDistance);\r\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\r\n        gl.uniform1f(shu.planetRadius, (ec.renderNode as Planet)._planetRadius2 || 0);\r\n        gl.uniform2fv(shu.viewport, [h.canvas!.clientWidth, h.canvas!.clientHeight]);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer!);\r\n        gl.vertexAttribPointer(sha.a_texCoord, this._texCoordBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gliphParamBuffer!);\r\n        gl.vertexAttribPointer(sha.a_gliphParam, this._gliphParamBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer!);\r\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer!);\r\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer!);\r\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer!);\r\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer!);\r\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer!);\r\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._fontIndexBuffer!);\r\n        gl.vertexAttribPointer(sha.a_fontIndex, this._fontIndexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        //\r\n        // outline PASS\r\n        gl.uniform1i(shu.isOutlinePass, 1);\r\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._outlineColorBuffer!);\r\n        gl.vertexAttribPointer(sha.a_rgba, this._outlineColorBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._outlineBuffer!);\r\n        gl.vertexAttribPointer(sha.a_outline, this._outlineBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer!.numItems);\r\n\r\n        //\r\n        // no outline PASS\r\n        gl.depthFunc(gl.EQUAL);\r\n        gl.uniform1i(shu.isOutlinePass, 0);\r\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer!);\r\n        gl.vertexAttribPointer(sha.a_rgba, this._rgbaBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer!.numItems);\r\n\r\n        gl.depthFunc(gl.LESS);\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n    }\r\n\r\n    protected override _pickingPASS() {\r\n        let r = this._renderer!;\r\n        let h = r.handler;\r\n        h.programs.labelPicking.activate();\r\n        let sh = h.programs.labelPicking._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        let gl = h.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        let rn = ec.renderNode;\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\r\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\r\n        gl.uniform3fv(shu.scaleByDistance, ec.scaleByDistance);\r\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\r\n        gl.uniform1f(shu.planetRadius, (rn as Planet)._planetRadius2 || 0);\r\n        gl.uniform2fv(shu.viewport, [h.canvas!.clientWidth, h.canvas!.clientHeight]);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer!);\r\n        gl.vertexAttribPointer(sha.a_texCoord, this._texCoordBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gliphParamBuffer!);\r\n        gl.vertexAttribPointer(sha.a_gliphParam, this._gliphParamBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer!);\r\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer!);\r\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer!);\r\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer!);\r\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer!);\r\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer!);\r\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._pickingColorBuffer!);\r\n        gl.vertexAttribPointer(sha.a_rgba, this._pickingColorBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer!.numItems);\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n    }\r\n\r\n    protected override _removeBillboard(label: Label) {\r\n\r\n        let li = label._handlerIndex;\r\n\r\n        this._billboards.splice(li, 1);\r\n\r\n        let ml = 24 * this._maxLetters;\r\n        let i = li * ml;\r\n        this._rgbaArr = spliceTypedArray<Float32Array>(this._rgbaArr, i, ml);\r\n        this._outlineColorArr = spliceTypedArray<Float32Array>(this._outlineColorArr, i, ml);\r\n        this._texCoordArr = spliceTypedArray<Float32Array>(this._texCoordArr, i, ml);\r\n        this._gliphParamArr = spliceTypedArray<Float32Array>(this._gliphParamArr, i, ml);\r\n\r\n        ml = 18 * this._maxLetters;\r\n        i = li * ml;\r\n        this._positionHighArr = spliceTypedArray<Float32Array>(this._positionHighArr, i, ml);\r\n        this._positionLowArr = spliceTypedArray<Float32Array>(this._positionLowArr, i, ml);\r\n        this._offsetArr = spliceTypedArray<Float32Array>(this._offsetArr, i, ml);\r\n        this._pickingColorArr = spliceTypedArray<Float32Array>(this._pickingColorArr, i, ml);\r\n\r\n        ml = 12 * this._maxLetters;\r\n        i = li * ml;\r\n        this._vertexArr = spliceTypedArray<Float32Array>(this._vertexArr, i, ml);\r\n\r\n        ml = 6 * this._maxLetters;\r\n        i = li * ml;\r\n        this._sizeArr = spliceTypedArray<Float32Array>(this._sizeArr, i, ml);\r\n        this._rotationArr = spliceTypedArray<Float32Array>(this._rotationArr, i, ml);\r\n        this._fontIndexArr = spliceTypedArray<Float32Array>(this._fontIndexArr, i, ml);\r\n        this._outlineArr = spliceTypedArray<Float32Array>(this._outlineArr, i, ml);\r\n\r\n        this.reindexBillboardsArray(li);\r\n        this.refresh();\r\n\r\n        label._handlerIndex = -1;\r\n        label._handler = null;\r\n        label._isReady = false;\r\n    }\r\n\r\n    public setText(index: number, text: string, fontIndex: number, align: number, letterSpacing: number = 0, isRTL: boolean = false) {\r\n\r\n        text = text.normalize('NFKC');\r\n\r\n        let fa = this._renderer!.fontAtlas.atlasesArr[fontIndex];\r\n\r\n        if (!fa) return;\r\n\r\n        let i = index * 24 * this._maxLetters;\r\n        let a = this._texCoordArr,\r\n            g = this._gliphParamArr;\r\n\r\n        let c = 0;\r\n\r\n        let len = Math.min(this._maxLetters, text.length);\r\n        let _rtl_ = 0.0;\r\n        if (isRTL) {\r\n            _rtl_ = RTL;\r\n        }\r\n\r\n        let offset = 0.0;\r\n        let kern = fa.kernings;\r\n\r\n        for (c = 0; c < len; c++) {\r\n            let j = i + c * 24;\r\n            let char = text[c];\r\n            let n = fa.get(char.charCodeAt(0)) || fa.get(\" \".charCodeAt(0))!;\r\n            if (!n) continue;\r\n            let tc = n.texCoords;\r\n\r\n            let m = n.metrics;\r\n\r\n            a[j] = tc[0];\r\n            a[j + 1] = tc[1];\r\n            a[j + 2] = offset;\r\n            a[j + 3] = _rtl_;\r\n\r\n            a[j + 4] = tc[2];\r\n            a[j + 5] = tc[3];\r\n            a[j + 6] = offset;\r\n            a[j + 7] = _rtl_;\r\n\r\n            a[j + 8] = tc[4];\r\n            a[j + 9] = tc[5];\r\n            a[j + 10] = offset;\r\n            a[j + 11] = _rtl_;\r\n\r\n            a[j + 12] = tc[6];\r\n            a[j + 13] = tc[7];\r\n            a[j + 14] = offset;\r\n            a[j + 15] = _rtl_;\r\n\r\n            a[j + 16] = tc[8];\r\n            a[j + 17] = tc[9];\r\n            a[j + 18] = offset;\r\n            a[j + 19] = _rtl_;\r\n\r\n            a[j + 20] = tc[10];\r\n            a[j + 21] = tc[11];\r\n            a[j + 22] = offset;\r\n            a[j + 23] = _rtl_;\r\n\r\n            //\r\n            // Gliph\r\n            //\r\n            g[j] = m.nWidth;\r\n            g[j + 1] = m.nHeight;\r\n            g[j + 2] = m.nXOffset;\r\n            g[j + 3] = m.nYOffset;\r\n\r\n            g[j + 4] = m.nWidth;\r\n            g[j + 5] = m.nHeight;\r\n            g[j + 6] = m.nXOffset;\r\n            g[j + 7] = m.nYOffset;\r\n\r\n            g[j + 8] = m.nWidth;\r\n            g[j + 9] = m.nHeight;\r\n            g[j + 10] = m.nXOffset;\r\n            g[j + 11] = m.nYOffset;\r\n\r\n            g[j + 12] = m.nWidth;\r\n            g[j + 13] = m.nHeight;\r\n            g[j + 14] = m.nXOffset;\r\n            g[j + 15] = m.nYOffset;\r\n\r\n            g[j + 16] = m.nWidth;\r\n            g[j + 17] = m.nHeight;\r\n            g[j + 18] = m.nXOffset;\r\n            g[j + 19] = m.nYOffset;\r\n\r\n            g[j + 20] = m.nWidth;\r\n            g[j + 21] = m.nHeight;\r\n            g[j + 22] = m.nXOffset;\r\n            g[j + 23] = m.nYOffset;\r\n\r\n            let k = kern[char.charCodeAt(0)];\r\n            if (k && text[c + 1]) {\r\n                let kk = k[text[c + 1].charCodeAt(0)];\r\n                if (kk) {\r\n                    offset += m.nAdvance + kk + letterSpacing;\r\n                } else {\r\n                    offset += m.nAdvance + letterSpacing;\r\n                }\r\n            } else {\r\n                offset += m.nAdvance + letterSpacing;\r\n            }\r\n        }\r\n\r\n        // 49/512 - font atlas left border letter offset\r\n        if (align === ALIGN.CENTER) {\r\n            offset *= -0.5;\r\n            for (c = 0; c < len; c++) {\r\n                let j = i + c * 24;\r\n                a[j + 2] += offset;\r\n                a[j + 6] += offset;\r\n                a[j + 10] += offset;\r\n                a[j + 14] += offset;\r\n                a[j + 18] += offset;\r\n                a[j + 22] += offset;\r\n            }\r\n        }\r\n\r\n        for (; c < this._maxLetters; c++) {\r\n            let j = i + c * 24;\r\n            a[j + 3] = EMPTY;\r\n            a[j + 7] = EMPTY;\r\n            a[j + 11] = EMPTY;\r\n            a[j + 15] = EMPTY;\r\n            a[j + 19] = EMPTY;\r\n            a[j + 23] = EMPTY;\r\n        }\r\n\r\n        this._changedBuffers[TEXCOORD_BUFFER] = true;\r\n    }\r\n\r\n    public override setPositionArr(index: number, positionHigh: Vec3, positionLow: Vec3) {\r\n        let i = index * 18 * this._maxLetters;\r\n        let a = this._positionHighArr,\r\n            x = positionHigh.x,\r\n            y = positionHigh.y,\r\n            z = positionHigh.z,\r\n            b = this._positionLowArr,\r\n            xl = positionLow.x,\r\n            yl = positionLow.y,\r\n            zl = positionLow.z;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 18;\r\n            a[j] = x;\r\n            a[j + 1] = y;\r\n            a[j + 2] = z;\r\n\r\n            a[j + 3] = x;\r\n            a[j + 4] = y;\r\n            a[j + 5] = z;\r\n\r\n            a[j + 6] = x;\r\n            a[j + 7] = y;\r\n            a[j + 8] = z;\r\n\r\n            a[j + 9] = x;\r\n            a[j + 10] = y;\r\n            a[j + 11] = z;\r\n\r\n            a[j + 12] = x;\r\n            a[j + 13] = y;\r\n            a[j + 14] = z;\r\n\r\n            a[j + 15] = x;\r\n            a[j + 16] = y;\r\n            a[j + 17] = z;\r\n\r\n            // low\r\n            b[j] = xl;\r\n            b[j + 1] = yl;\r\n            b[j + 2] = zl;\r\n\r\n            b[j + 3] = xl;\r\n            b[j + 4] = yl;\r\n            b[j + 5] = zl;\r\n\r\n            b[j + 6] = xl;\r\n            b[j + 7] = yl;\r\n            b[j + 8] = zl;\r\n\r\n            b[j + 9] = xl;\r\n            b[j + 10] = yl;\r\n            b[j + 11] = zl;\r\n\r\n            b[j + 12] = xl;\r\n            b[j + 13] = yl;\r\n            b[j + 14] = zl;\r\n\r\n            b[j + 15] = xl;\r\n            b[j + 16] = yl;\r\n            b[j + 17] = zl;\r\n        }\r\n\r\n        this._changedBuffers[POSITION_BUFFER] = true;\r\n    }\r\n\r\n    public override setPickingColorArr(index: number, color: Vec3) {\r\n        let i = index * 18 * this._maxLetters;\r\n        let a = this._pickingColorArr,\r\n            x = color.x / 255,\r\n            y = color.y / 255,\r\n            z = color.z / 255;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 18;\r\n            a[j] = x;\r\n            a[j + 1] = y;\r\n            a[j + 2] = z;\r\n\r\n            a[j + 3] = x;\r\n            a[j + 4] = y;\r\n            a[j + 5] = z;\r\n\r\n            a[j + 6] = x;\r\n            a[j + 7] = y;\r\n            a[j + 8] = z;\r\n\r\n            a[j + 9] = x;\r\n            a[j + 10] = y;\r\n            a[j + 11] = z;\r\n\r\n            a[j + 12] = x;\r\n            a[j + 13] = y;\r\n            a[j + 14] = z;\r\n\r\n            a[j + 15] = x;\r\n            a[j + 16] = y;\r\n            a[j + 17] = z;\r\n        }\r\n\r\n        this._changedBuffers[PICKINGCOLOR_BUFFER] = true;\r\n    }\r\n\r\n    public override setSizeArr(index: number, size: number) {\r\n        let i = index * 6 * this._maxLetters;\r\n        let a = this._sizeArr;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 6;\r\n            a[j] = size;\r\n            a[j + 1] = size;\r\n            a[j + 2] = size;\r\n            a[j + 3] = size;\r\n            a[j + 4] = size;\r\n            a[j + 5] = size;\r\n        }\r\n\r\n        this._changedBuffers[SIZE_BUFFER] = true;\r\n    }\r\n\r\n    public override setOffsetArr(index: number, offset: Vec3) {\r\n        let i = index * 18 * this._maxLetters;\r\n        let a = this._offsetArr,\r\n            x = offset.x,\r\n            y = offset.y,\r\n            z = offset.z;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 18;\r\n            a[j] = x;\r\n            a[j + 1] = y;\r\n            a[j + 2] = z;\r\n\r\n            a[j + 3] = x;\r\n            a[j + 4] = y;\r\n            a[j + 5] = z;\r\n\r\n            a[j + 6] = x;\r\n            a[j + 7] = y;\r\n            a[j + 8] = z;\r\n\r\n            a[j + 9] = x;\r\n            a[j + 10] = y;\r\n            a[j + 11] = z;\r\n\r\n            a[j + 12] = x;\r\n            a[j + 13] = y;\r\n            a[j + 14] = z;\r\n\r\n            a[j + 15] = x;\r\n            a[j + 16] = y;\r\n            a[j + 17] = z;\r\n        }\r\n\r\n        this._changedBuffers[OFFSET_BUFFER] = true;\r\n    }\r\n\r\n    public override setRgbaArr(index: number, rgba: Vec4) {\r\n        let i = index * 24 * this._maxLetters;\r\n        let a = this._rgbaArr,\r\n            x = rgba.x,\r\n            y = rgba.y,\r\n            z = rgba.z,\r\n            w = rgba.w;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 24;\r\n\r\n            a[j] = x;\r\n            a[j + 1] = y;\r\n            a[j + 2] = z;\r\n            a[j + 3] = w;\r\n\r\n            a[j + 4] = x;\r\n            a[j + 5] = y;\r\n            a[j + 6] = z;\r\n            a[j + 7] = w;\r\n\r\n            a[j + 8] = x;\r\n            a[j + 9] = y;\r\n            a[j + 10] = z;\r\n            a[j + 11] = w;\r\n\r\n            a[j + 12] = x;\r\n            a[j + 13] = y;\r\n            a[j + 14] = z;\r\n            a[j + 15] = w;\r\n\r\n            a[j + 16] = x;\r\n            a[j + 17] = y;\r\n            a[j + 18] = z;\r\n            a[j + 19] = w;\r\n\r\n            a[j + 20] = x;\r\n            a[j + 21] = y;\r\n            a[j + 22] = z;\r\n            a[j + 23] = w;\r\n        }\r\n\r\n        this._changedBuffers[RGBA_BUFFER] = true;\r\n    }\r\n\r\n    public setOutlineColorArr(index: number, rgba: Vec4) {\r\n        let i = index * 24 * this._maxLetters;\r\n        let a = this._outlineColorArr,\r\n            x = rgba.x,\r\n            y = rgba.y,\r\n            z = rgba.z,\r\n            w = rgba.w;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 24;\r\n\r\n            a[j] = x;\r\n            a[j + 1] = y;\r\n            a[j + 2] = z;\r\n            a[j + 3] = w;\r\n\r\n            a[j + 4] = x;\r\n            a[j + 5] = y;\r\n            a[j + 6] = z;\r\n            a[j + 7] = w;\r\n\r\n            a[j + 8] = x;\r\n            a[j + 9] = y;\r\n            a[j + 10] = z;\r\n            a[j + 11] = w;\r\n\r\n            a[j + 12] = x;\r\n            a[j + 13] = y;\r\n            a[j + 14] = z;\r\n            a[j + 15] = w;\r\n\r\n            a[j + 16] = x;\r\n            a[j + 17] = y;\r\n            a[j + 18] = z;\r\n            a[j + 19] = w;\r\n\r\n            a[j + 20] = x;\r\n            a[j + 21] = y;\r\n            a[j + 22] = z;\r\n            a[j + 23] = w;\r\n        }\r\n\r\n        this._changedBuffers[OUTLINECOLOR_BUFFER] = true;\r\n    }\r\n\r\n    public setOutlineArr(index: number, outline: number) {\r\n        let i = index * 6 * this._maxLetters;\r\n        let a = this._outlineArr;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 6;\r\n            a[j] = outline;\r\n            a[j + 1] = outline;\r\n            a[j + 2] = outline;\r\n            a[j + 3] = outline;\r\n            a[j + 4] = outline;\r\n            a[j + 5] = outline;\r\n        }\r\n\r\n        this._changedBuffers[OUTLINE_BUFFER] = true;\r\n    }\r\n\r\n    public override setRotationArr(index: number, rotation: number) {\r\n        let i = index * 6 * this._maxLetters;\r\n        let a = this._rotationArr;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 6;\r\n            a[j] = rotation;\r\n            a[j + 1] = rotation;\r\n            a[j + 2] = rotation;\r\n            a[j + 3] = rotation;\r\n            a[j + 4] = rotation;\r\n            a[j + 5] = rotation;\r\n        }\r\n\r\n        this._changedBuffers[ROTATION_BUFFER] = true;\r\n    }\r\n\r\n    public override setVisibility(index: number, visibility: boolean) {\r\n        let vArr;\r\n        if (visibility) {\r\n            vArr = [0, 0, 0, -1, 1, -1, 1, -1, 1, 0, 0, 0];\r\n        } else {\r\n            vArr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n        }\r\n        this.setVertexArr(index, vArr);\r\n    }\r\n\r\n    public override setVertexArr(index: number, vertexArr: number[] | Float32Array) {\r\n        let i = index * 12 * this._maxLetters;\r\n        let a = this._vertexArr;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 12;\r\n\r\n            a[j] = vertexArr[0];\r\n            a[j + 1] = vertexArr[1];\r\n\r\n            a[j + 2] = vertexArr[2];\r\n            a[j + 3] = vertexArr[3];\r\n\r\n            a[j + 4] = vertexArr[4];\r\n            a[j + 5] = vertexArr[5];\r\n\r\n            a[j + 6] = vertexArr[6];\r\n            a[j + 7] = vertexArr[7];\r\n\r\n            a[j + 8] = vertexArr[8];\r\n            a[j + 9] = vertexArr[9];\r\n\r\n            a[j + 10] = vertexArr[10];\r\n            a[j + 11] = vertexArr[11];\r\n        }\r\n\r\n        this._changedBuffers[VERTEX_BUFFER] = true;\r\n    }\r\n\r\n    public setFontIndexArr(index: number, fontIndex: number) {\r\n        let i = index * 6 * this._maxLetters;\r\n        let a = this._fontIndexArr;\r\n\r\n        for (let q = 0; q < this._maxLetters; q++) {\r\n            let j = i + q * 6;\r\n            a[j] = fontIndex;\r\n            a[j + 1] = fontIndex;\r\n            a[j + 2] = fontIndex;\r\n            a[j + 3] = fontIndex;\r\n            a[j + 4] = fontIndex;\r\n            a[j + 5] = fontIndex;\r\n        }\r\n\r\n        this._changedBuffers[FONTINDEX_BUFFER] = true;\r\n    }\r\n\r\n    public override createSizeBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._sizeBuffer as WebGLBuffer);\r\n        this._sizeBuffer = h.createArrayBuffer(this._sizeArr, 1, this._sizeArr.length);\r\n    }\r\n\r\n    public createFontIndexBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._fontIndexBuffer as WebGLBuffer);\r\n        this._fontIndexBuffer = h.createArrayBuffer(this._fontIndexArr, 1, this._fontIndexArr.length);\r\n    }\r\n\r\n    public override createTexCoordBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._texCoordBuffer as WebGLBuffer);\r\n        this._texCoordBuffer = h.createArrayBuffer(this._texCoordArr, 4, this._texCoordArr.length / 4);\r\n\r\n        h.gl!.deleteBuffer(this._gliphParamBuffer as WebGLBuffer);\r\n        this._gliphParamBuffer = h.createArrayBuffer(this._gliphParamArr, 4, this._gliphParamArr.length / 4);\r\n    }\r\n\r\n    public createOutlineBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._outlineBuffer as WebGLBuffer);\r\n        this._outlineBuffer = h.createArrayBuffer(this._outlineArr, 1, this._outlineArr.length);\r\n    }\r\n\r\n    public createOutlineColorBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._outlineColorBuffer as WebGLBuffer);\r\n        this._outlineColorBuffer = h.createArrayBuffer(this._outlineColorArr, 4, this._outlineColorArr.length / 4);\r\n    }\r\n\r\n    public setMaxLetters(c: number) {\r\n        this._maxLetters = c;\r\n        // TODO: ...\r\n    }\r\n}\r\n\r\nexport {LabelHandler};\r\n","import { Program } from '../webgl/Program';\r\n\r\n//Picking is the same\r\nexport function pointCloud(): Program {\r\n    return new Program(\"pointCloud\", {\r\n        uniforms: {\r\n            projectionViewMatrix: \"mat4\",\r\n            opacity: \"float\",\r\n            pointSize: \"float\"\r\n        },\r\n        attributes: {\r\n            coordinates: \"vec3\",\r\n            colors: \"vec3\"\r\n        },\r\n        vertexShader:\r\n            `attribute vec3 coordinates;\r\n            attribute vec4 colors;\r\n            uniform mat4 projectionViewMatrix;\r\n            uniform float opacity;\r\n            uniform float pointSize;\r\n            varying vec4 color;\r\n            void main() {\r\n                color = colors;\r\n                color.a *= opacity;\r\n                gl_Position = projectionViewMatrix * vec4(coordinates, 1.0);\r\n                gl_PointSize = pointSize;\r\n            }`,\r\n        fragmentShader:\r\n            `precision highp float;\r\n            varying vec4 color;\r\n            void main(void) {\r\n                gl_FragColor = color;\r\n            }`\r\n    });\r\n}","import * as shaders from \"../shaders/pointCloud\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport {PointCloud} from \"./PointCloud\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\n\r\nclass PointCloudHandler {\r\n    static __counter__: number = 0;\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Picking rendering option.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public pickingEnabled = true;\r\n\r\n    /**\r\n     * Parent collection\r\n     * @public\r\n     * @type {EntityCollection}\r\n     */\r\n    public _entityCollection: EntityCollection;\r\n\r\n    /**\r\n     * Renderer\r\n     * @protected\r\n     * @type {Renderer|null}\r\n     */\r\n    protected _renderer: Renderer | null;\r\n\r\n    /**\r\n     * Point cloud array\r\n     * @protected\r\n     * @type {Array.<PointCloud>}\r\n     */\r\n    protected _pointClouds: PointCloud[];\r\n\r\n    constructor(entityCollection: EntityCollection) {\r\n\r\n        this.__id = PointCloudHandler.__counter__++;\r\n\r\n        this.pickingEnabled = true;\r\n        this._entityCollection = entityCollection;\r\n        this._renderer = null;\r\n        this._pointClouds = [];\r\n    }\r\n\r\n    protected _initProgram() {\r\n        if (this._renderer && this._renderer.handler) {\r\n            if (!this._renderer.handler.programs.pointCloud) {\r\n                this._renderer.handler.addProgram(shaders.pointCloud());\r\n            }\r\n        }\r\n    }\r\n\r\n    public setRenderNode(renderNode: RenderNode) {\r\n        this._renderer = renderNode.renderer;\r\n        this._initProgram();\r\n        for (let i = 0; i < this._pointClouds.length; i++) {\r\n            this._pointClouds[i].setRenderNode(renderNode);\r\n        }\r\n    }\r\n\r\n    public add(pointCloud: PointCloud) {\r\n        if (pointCloud._handlerIndex === -1) {\r\n            pointCloud._handler = this;\r\n            pointCloud._handlerIndex = this._pointClouds.length;\r\n            this._pointClouds.push(pointCloud);\r\n            this._entityCollection &&\r\n            this._entityCollection.renderNode &&\r\n            pointCloud.setRenderNode(this._entityCollection.renderNode);\r\n        }\r\n    }\r\n\r\n    public remove(pointCloud: PointCloud) {\r\n\r\n        let index = pointCloud._handlerIndex;\r\n        if (index !== -1) {\r\n\r\n            pointCloud._deleteBuffers();\r\n\r\n            pointCloud._handlerIndex = -1;\r\n            pointCloud._handler = null;\r\n            this._pointClouds.splice(index, 1);\r\n            this._reindexPointCloudArray(index);\r\n        }\r\n    }\r\n\r\n    protected _reindexPointCloudArray(startIndex: number) {\r\n        let pc = this._pointClouds;\r\n        for (let i = startIndex; i < pc.length; i++) {\r\n            pc[i]._handlerIndex = i;\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        let i = this._pointClouds.length;\r\n        while (i--) {\r\n            this._pointClouds[i].draw();\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this.pickingEnabled) {\r\n            let i = this._pointClouds.length;\r\n            while (i--) {\r\n                this._pointClouds[i].drawPicking();\r\n            }\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        let i = this._pointClouds.length;\r\n        while (i--) {\r\n            this._pointClouds[i]._deleteBuffers();\r\n            this._pointClouds[i]._handler = null;\r\n            this._pointClouds[i]._handlerIndex = -1;\r\n        }\r\n        this._pointClouds.length = 0;\r\n        this._pointClouds = [];\r\n    }\r\n}\r\n\r\nexport {PointCloudHandler};\r\n","precision highp float;\r\n\r\nattribute vec3 prevHigh;\r\nattribute vec3 currentHigh;\r\nattribute vec3 nextHigh;\r\n\r\nattribute vec3 prevLow;\r\nattribute vec3 currentLow;\r\nattribute vec3 nextLow;\r\n\r\nattribute float order;\r\n\r\nattribute vec4 color;\r\n\r\nuniform float thickness;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 viewport;\r\nuniform vec3 rtcEyePositionHigh;\r\nuniform vec3 rtcEyePositionLow;\r\nuniform float opacity;\r\nuniform float depthOffset;\r\n\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vPos;\r\nvarying vec3 uCamPos;\r\n\r\nconst float NEAR = -1.0;\r\n\r\nvec2 getIntersection(vec2 start1, vec2 end1, vec2 start2, vec2 end2) {\r\n    vec2 dir = end2 - start2;\r\n    vec2 perp = vec2(-dir.y, dir.x);\r\n    float d2 = dot(perp, start2);\r\n    float seg = dot(perp, start1) - d2;\r\n    float prl = seg - dot(perp, end1) + d2;\r\n    if (prl > -1.0 && prl < 1.0) {\r\n        return start1;\r\n    }\r\n    float u = seg / prl;\r\n    return start1 + u * (end1 - start1);\r\n}\r\n\r\nvec2 project(vec4 p) {\r\n    return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\r\n}\r\n\r\nvoid main() {\r\n\r\n    uCamPos = rtcEyePositionHigh + rtcEyePositionLow;\r\n    vPos = currentHigh + currentLow;\r\n\r\n    vColor = vec4(color.rgb, color.a * opacity);\r\n\r\n    mat4 viewMatrixRTE = view;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    vec3 highDiff, lowDiff;\r\n\r\n    highDiff = currentHigh - rtcEyePositionHigh;\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n    lowDiff = currentLow - rtcEyePositionLow;\r\n    vec4 vCurrent = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    highDiff = prevHigh - rtcEyePositionHigh;\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n    lowDiff = prevLow - rtcEyePositionLow;\r\n    vec4 vPrev = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    highDiff = nextHigh - rtcEyePositionHigh;\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n    lowDiff = nextLow - rtcEyePositionLow;\r\n    vec4 vNext = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n/*Clip near plane, the point behind view plane*/\r\n    if (vCurrent.z > NEAR) {\r\n        if (vPrev.z < NEAR && abs(order) == 1.0) {\r\n            vCurrent = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\r\n        } else if (vNext.z < NEAR && abs(order) == 2.0) {\r\n            vCurrent = vNext + (vCurrent - vNext) * (NEAR - vNext.z) / (vCurrent.z - vNext.z);\r\n        }\r\n    }\r\n\r\n    vec4 dCurrent = proj * vCurrent;\r\n    vec2 _next = project(proj * vNext);\r\n    vec2 _prev = project(proj * vPrev);\r\n    vec2 _current = project(dCurrent);\r\n\r\n    if (_prev == _current) {\r\n        if (_next == _current) {\r\n            _next = _current + vec2(1.0, 0.0);\r\n            _prev = _current - _next;\r\n        } else {\r\n            _prev = _current + normalize(_current - _next);\r\n        }\r\n    }\r\n\r\n    if (_next == _current) {\r\n        _next = _current + normalize(_current - _prev);\r\n    }\r\n\r\n    vec2 sNext = _next,\r\n    sCurrent = _current,\r\n    sPrev = _prev;\r\n\r\n    vec2 dirNext = normalize(sNext - sCurrent);\r\n    vec2 dirPrev = normalize(sPrev - sCurrent);\r\n    float dotNP = dot(dirNext, dirPrev);\r\n\r\n    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));\r\n    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));\r\n\r\n    float d = thickness * sign(order);\r\n\r\n    vec2 m;\r\n    if (dotNP >= 0.99991) {\r\n        m = sCurrent - normalPrev * d;\r\n    } else {\r\n        m = getIntersection(sCurrent + normalPrev * d, sPrev + normalPrev * d,\r\n                            sCurrent + normalNext * d, sNext + normalNext * d);\r\n\r\n        if (dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0) {\r\n            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);\r\n            if (occw == -1.0) {\r\n                m = sCurrent + normalPrev * d;\r\n            } else if (occw == 1.0) {\r\n                m = sCurrent + normalNext * d;\r\n            } else if (occw == -2.0) {\r\n                m = sCurrent + normalNext * d;\r\n            } else if (occw == 2.0) {\r\n                m = sCurrent + normalPrev * d;\r\n            }\r\n        } else if (distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))) {\r\n            m = sCurrent + normalNext * d;\r\n        }\r\n    }\r\n\r\n    gl_Position = vec4((2.0 * m / viewport - 1.0) * dCurrent.w, dCurrent.z + depthOffset, dCurrent.w);\r\n}","precision highp float;\r\n\r\nuniform vec4 visibleSphere;\r\n\r\nvarying vec3 uCamPos;\r\nvarying vec4 vColor;\r\nvarying vec3 vPos;\r\n\r\n//${UTILS}\r\n\r\nvoid main() {\r\n\r\n    if (visibleSphere.w != 0.0) {\r\n        vec3 cam_dir = normalize(vPos - uCamPos);\r\n        vec3 sph_dir = normalize(vPos - visibleSphere.xyz);\r\n        if (dot(cam_dir, sph_dir) > 0.11) {\r\n            discard;\r\n        }\r\n    }\r\n\r\n    gl_FragColor = vec4(vColor.rgb, vColor.a);\r\n}","precision highp float;\r\n\r\nattribute vec3 prevHigh;\r\nattribute vec3 currentHigh;\r\nattribute vec3 nextHigh;\r\n\r\nattribute vec3 prevLow;\r\nattribute vec3 currentLow;\r\nattribute vec3 nextLow;\r\n\r\nattribute float order;\r\n\r\nuniform float thickness;\r\nuniform vec4 color;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 viewport;\r\nuniform vec3 rtcEyePositionHigh;\r\nuniform vec3 rtcEyePositionLow;\r\nuniform float depthOffset;\r\n\r\nvarying vec4 vColor;\r\nvarying vec3 vPos;\r\nvarying vec3 uCamPos;\r\n\r\n\r\nconst float NEAR = -1.0;\r\n\r\nvec2 getIntersection(vec2 start1, vec2 end1, vec2 start2, vec2 end2) {\r\n    vec2 dir = end2 - start2;\r\n    vec2 perp = vec2(-dir.y, dir.x);\r\n    float d2 = dot(perp, start2);\r\n    float seg = dot(perp, start1) - d2;\r\n    float prl = seg - dot(perp, end1) + d2;\r\n    if (prl > -1.0 && prl < 1.0) {\r\n        return start1;\r\n    }\r\n    float u = seg / prl;\r\n    return start1 + u * (end1 - start1);\r\n}\r\n\r\nvec2 project(vec4 p) {\r\n    return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\r\n}\r\n\r\nvoid main() {\r\n\r\n    uCamPos = rtcEyePositionHigh + rtcEyePositionLow;\r\n    vPos = currentHigh + currentLow;\r\n    vColor = color;\r\n\r\n    vec3 highDiff, lowDiff;\r\n\r\n    mat4 viewMatrixRTE = view;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    highDiff = currentHigh - rtcEyePositionHigh;\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n    lowDiff = currentLow - rtcEyePositionLow;\r\n    vec4 vCurrent = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    highDiff = prevHigh - rtcEyePositionHigh;\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n    lowDiff = prevLow - rtcEyePositionLow;\r\n    vec4 vPrev = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n    highDiff = nextHigh - rtcEyePositionHigh;\r\n    highDiff = highDiff * step(1.0, length(highDiff));\r\n    lowDiff = nextLow - rtcEyePositionLow;\r\n    vec4 vNext = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\r\n\r\n/*Clip near plane*/\r\n    if (vCurrent.z > NEAR) {\r\n        if (vPrev.z < NEAR && abs(order) == 1.0) {\r\n            vCurrent = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\r\n        } else if (vNext.z < NEAR && abs(order) == 2.0) {\r\n            vCurrent = vNext + (vCurrent - vNext) * (NEAR - vNext.z) / (vCurrent.z - vNext.z);\r\n        }\r\n    }\r\n\r\n    vec4 dCurrent = proj * vCurrent;\r\n    vec2 _next = project(proj * vNext);\r\n    vec2 _prev = project(proj * vPrev);\r\n    vec2 _current = project(dCurrent);\r\n    if (_prev == _current) {\r\n        if (_next == _current) {\r\n            _next = _current + vec2(1.0, 0.0);\r\n            _prev = _current - _next;\r\n        } else {\r\n            _prev = _current + normalize(_current - _next);\r\n        }\r\n    }\r\n    if (_next == _current) {\r\n        _next = _current + normalize(_current - _prev);\r\n    }\r\n\r\n    vec2 sNext = _next,\r\n    sCurrent = _current,\r\n    sPrev = _prev;\r\n\r\n    vec2 dirNext = normalize(sNext - sCurrent);\r\n    vec2 dirPrev = normalize(sPrev - sCurrent);\r\n    float dotNP = dot(dirNext, dirPrev);\r\n\r\n    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));\r\n    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));\r\n\r\n    float d = thickness * sign(order);\r\n\r\n    vec2 m;\r\n    if (dotNP >= 0.99991) {\r\n        m = sCurrent - normalPrev * d;\r\n    } else {\r\n        m = getIntersection(sCurrent + normalPrev * d, sPrev + normalPrev * d,\r\n                            sCurrent + normalNext * d, sNext + normalNext * d);\r\n\r\n        if (dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0) {\r\n            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);\r\n            if (occw == -1.0) {\r\n                m = sCurrent + normalPrev * d;\r\n            } else if (occw == 1.0) {\r\n                m = sCurrent + normalNext * d;\r\n            } else if (occw == -2.0) {\r\n                m = sCurrent + normalNext * d;\r\n            } else if (occw == 2.0) {\r\n                m = sCurrent + normalPrev * d;\r\n            }\r\n        }\r\n        else if (distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))) {\r\n            m = sCurrent + normalNext * d;\r\n        }\r\n    }\r\n    gl_Position = vec4((2.0 * m / viewport - 1.0) * dCurrent.w, dCurrent.z + depthOffset, dCurrent.w);\r\n}","precision highp float;\r\n\r\nuniform vec4 visibleSphere;\r\n\r\nvarying vec3 uCamPos;\r\nvarying vec4 vColor;\r\nvarying vec3 vPos;\r\n\r\nvoid main() {\r\n    if(visibleSphere.w != 0.0) {\r\n        vec3 cam_dir = normalize(vPos - uCamPos);\r\n        vec3 sph_dir = normalize(vPos - visibleSphere.xyz);\r\n        if( dot(cam_dir, sph_dir) > 0.11 ){\r\n            discard;\r\n        }\r\n    }\r\n    gl_FragColor = vec4(vColor.rgb, vColor.a);\r\n}","import {Program} from '../../webgl/Program';\r\n\r\nimport polyline_screen_vert from './polyline_screen.vert.glsl';\r\nimport polyline_screen_frag from './polyline_screen.frag.glsl';\r\n\r\nimport polyline_picking_vert from './polyline_picking.vert.glsl';\r\nimport polyline_picking_frag from './polyline_picking.frag.glsl';\r\n\r\nexport function polyline_screen(): Program {\r\n    return new Program(\"polyline_screen\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            proj: \"mat4\",\r\n            view: \"mat4\",\r\n            rtcEyePositionHigh: \"vec3\",\r\n            rtcEyePositionLow: \"vec3\",\r\n            thickness: \"float\",\r\n            opacity: \"float\",\r\n            depthOffset: \"float\",\r\n            visibleSphere: \"vec4\",\r\n        },\r\n        attributes: {\r\n            prevHigh: \"vec3\",\r\n            currentHigh: \"vec3\",\r\n            nextHigh: \"vec3\",\r\n            prevLow: \"vec3\",\r\n            currentLow: \"vec3\",\r\n            nextLow: \"vec3\",\r\n            order: \"float\",\r\n            color: \"vec4\"\r\n        },\r\n        vertexShader: polyline_screen_vert,\r\n        fragmentShader: polyline_screen_frag\r\n    });\r\n}\r\n\r\nexport function polyline_picking(): Program {\r\n    return new Program(\"polyline_picking\", {\r\n        uniforms: {\r\n            viewport: \"vec2\",\r\n            proj: \"mat4\",\r\n            view: \"mat4\",\r\n            rtcEyePositionHigh: \"vec3\",\r\n            rtcEyePositionLow: \"vec3\",\r\n            color: \"vec4\",\r\n            thickness: \"float\",\r\n            depthOffset: \"float\",\r\n            visibleSphere: \"vec4\",\r\n        },\r\n        attributes: {\r\n            prevHigh: \"vec3\",\r\n            currentHigh: \"vec3\",\r\n            nextHigh: \"vec3\",\r\n            prevLow: \"vec3\",\r\n            currentLow: \"vec3\",\r\n            nextLow: \"vec3\",\r\n            order: \"float\"\r\n        },\r\n        vertexShader: polyline_picking_vert,\r\n        fragmentShader: polyline_picking_frag\r\n    });\r\n}","import * as shaders from '../shaders/polyline/polyline';\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport {Polyline} from \"./Polyline\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport {Vec3} from \"../math/Vec3\";\r\n\r\nclass PolylineHandler {\r\n    static __counter__: number = 0;\r\n    protected __id: number;\r\n    public _entityCollection: EntityCollection;\r\n    public pickingEnabled: boolean;\r\n    protected _renderer: Renderer | null;\r\n    protected _polylines: Polyline[];\r\n    public _relativeCenter: Vec3;\r\n    public _rtcEyePositionHigh: Float32Array;\r\n    public _rtcEyePositionLow: Float32Array;\r\n\r\n    constructor(entityCollection: EntityCollection) {\r\n\r\n        this.__id = PolylineHandler.__counter__++;\r\n\r\n        this._entityCollection = entityCollection;\r\n\r\n        this._renderer = null;\r\n\r\n        this._polylines = [];\r\n\r\n        this.pickingEnabled = true;\r\n\r\n        this._relativeCenter = new Vec3();\r\n\r\n        this._rtcEyePositionHigh = new Float32Array([0, 0, 0]);\r\n\r\n        this._rtcEyePositionLow = new Float32Array([0, 0, 0]);\r\n    }\r\n\r\n    protected _initProgram() {\r\n        if (this._renderer && this._renderer.handler) {\r\n            if (!this._renderer.handler.programs.polyline_screen) {\r\n                this._renderer.handler.addProgram(shaders.polyline_screen());\r\n            }\r\n            if (!this._renderer.handler.programs.polyline_picking) {\r\n                this._renderer.handler.addProgram(shaders.polyline_picking());\r\n            }\r\n        }\r\n    }\r\n\r\n    public setRenderNode(renderNode: RenderNode) {\r\n        this._renderer = renderNode.renderer;\r\n        this._initProgram();\r\n        for (let i = 0; i < this._polylines.length; i++) {\r\n            this._polylines[i].setRenderNode(renderNode);\r\n        }\r\n    }\r\n\r\n    public add(polyline: Polyline) {\r\n        if (polyline._handlerIndex === -1) {\r\n            polyline._handler = this;\r\n            polyline._handlerIndex = this._polylines.length;\r\n            polyline.__doubleToTwoFloats = this.getRTCPosition.bind(this);\r\n            this._polylines.push(polyline);\r\n            if (this._entityCollection && this._entityCollection.renderNode) {\r\n                polyline.setRenderNode(this._entityCollection.renderNode);\r\n                polyline.updateRTCPosition();\r\n            }\r\n        }\r\n    }\r\n\r\n    public remove(polyline: Polyline) {\r\n        let index = polyline._handlerIndex;\r\n        if (index !== -1) {\r\n            polyline._deleteBuffers();\r\n            polyline._handlerIndex = -1;\r\n            polyline._handler = null;\r\n            this._polylines.splice(index, 1);\r\n            this.reindexPolylineArray(index);\r\n        }\r\n    }\r\n\r\n    public reindexPolylineArray(startIndex: number) {\r\n        let ls = this._polylines;\r\n        for (let i = startIndex; i < ls.length; i++) {\r\n            ls[i]._handlerIndex = i;\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        this._updateRTCEyePosition();\r\n        let i = this._polylines.length;\r\n        while (i--) {\r\n            this._polylines[i].draw();\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this.pickingEnabled) {\r\n            let i = this._polylines.length;\r\n            while (i--) {\r\n                this._polylines[i].drawPicking();\r\n            }\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        let i = this._polylines.length;\r\n        while (i--) {\r\n            this._polylines[i]._deleteBuffers();\r\n            this._polylines[i]._handler = null;\r\n            this._polylines[i]._handlerIndex = -1;\r\n        }\r\n        this._polylines.length = 0;\r\n        this._polylines = [];\r\n    }\r\n\r\n    public getRTCPosition(pos: Vec3, rtcPositionHigh: Vec3, rtcPositionLow: Vec3) {\r\n        let rtcPosition = pos.sub(this._relativeCenter);\r\n        Vec3.doubleToTwoFloats(rtcPosition, rtcPositionHigh, rtcPositionLow);\r\n    }\r\n\r\n    public setRelativeCenter(c: Vec3) {\r\n        this._relativeCenter.copy(c);\r\n        for (let i = 0; i < this._polylines.length; i++) {\r\n            this._polylines[i].updateRTCPosition();\r\n        }\r\n    }\r\n\r\n    protected _updateRTCEyePosition() {\r\n        let r = this._renderer!;\r\n        if (r.activeCamera.isFirstPass) {\r\n            let rtcEyePosition = r.activeCamera.eye.sub(this._relativeCenter);\r\n            Vec3.doubleToTwoFloat32Array(rtcEyePosition, this._rtcEyePositionHigh, this._rtcEyePositionLow);\r\n        }\r\n    }\r\n}\r\n\r\nexport {PolylineHandler};","precision highp float;\r\n\r\nattribute vec4 a_rgba;\r\nattribute vec3 a_startPosHigh;\r\nattribute vec3 a_startPosLow;\r\nattribute vec3 a_endPosHigh;\r\nattribute vec3 a_endPosLow;\r\nattribute vec2 a_vertices;\r\nattribute float a_thickness;\r\n\r\nvarying vec4 v_rgba;\r\n\r\nuniform mat4 viewMatrix;\r\nuniform mat4 projectionMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float resolution;\r\nuniform float uOpacity;\r\n\r\nvoid main() {\r\n\r\n    v_rgba = vec4(a_rgba.rgb, a_rgba.a * uOpacity);\r\n\r\n    vec3 v = (a_endPosHigh - a_startPosHigh) + (a_endPosLow - a_startPosLow);\r\n\r\n    vec3 look = (a_startPosHigh - eyePositionHigh) + (a_startPosLow - eyePositionLow) + v * a_vertices.y;\r\n    vec3 up = normalize(normalize(v));\r\n    vec3 right = normalize(cross(look,up));\r\n\r\n    float dist = dot(look, vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]));\r\n    float focalSize = 2.0 * dist * resolution;\r\n    vec3 vert = right * a_thickness * focalSize * a_vertices.x;\r\n\r\n    vec3 highDiff;\r\n    if(a_vertices.y == 0.0){\r\n        highDiff = a_startPosHigh - eyePositionHigh;\r\n        vert += a_startPosLow - eyePositionLow;\r\n    }else{\r\n        highDiff = a_endPosHigh - eyePositionHigh;\r\n        vert += a_endPosLow - eyePositionLow;\r\n    }\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    // Hack for iMac M1, looks like it doesnt\r\n    // work correctly with zeroes in highDiff\r\n    // if(length(highDiff) < 1.0){\r\n    //     highDiff = vec3(0.0);\r\n    // }\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + vert, 1.0);\r\n}","precision highp float;\r\nvarying vec4 v_rgba;\r\nvoid main () {\r\n    gl_FragColor = v_rgba;\r\n}","import {Program} from '../../webgl/Program';\r\n\r\nimport ray_vert from './ray.vert.glsl';\r\nimport ray_frag from './ray.frag.glsl';\r\n\r\nexport function rayScreen(): Program {\r\n    return new Program(\"rayScreen\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            resolution: \"float\",\r\n            uOpacity: \"float\"\r\n        },\r\n        attributes: {\r\n            a_vertices: \"vec2\",\r\n            a_startPosHigh: \"vec3\",\r\n            a_startPosLow: \"vec3\",\r\n            a_endPosHigh: \"vec3\",\r\n            a_endPosLow: \"vec3\",\r\n            a_thickness: \"float\",\r\n            a_rgba: \"vec4\"\r\n        },\r\n        vertexShader: ray_vert,\r\n        fragmentShader: ray_frag\r\n    });\r\n}\r\n","import * as shaders from \"../shaders/ray/ray\";\r\nimport {concatArrays, makeArrayTyped, spliceArray} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {EntityCollection} from \"./EntityCollection\";\r\nimport {Ray} from \"./Ray\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\n\r\nconst PICKINGCOLOR_BUFFER = 0;\r\nconst START_POSITION_BUFFER = 1;\r\nconst END_POSITION_BUFFER = 2;\r\nconst RGBA_BUFFER = 3;\r\nconst THICKNESS_BUFFER = 4;\r\nconst VERTEX_BUFFER = 5;\r\n\r\n/*\r\n * og.RayHandler\r\n *\r\n *\r\n */\r\nclass RayHandler {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Picking rendering option.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public pickingEnabled: boolean;\r\n\r\n    protected _entityCollection: EntityCollection;\r\n\r\n    protected _renderer: Renderer | null;\r\n\r\n    protected _rays: Ray[];\r\n\r\n    protected _vertexBuffer: WebGLBufferExt | null;\r\n    protected _startPositionHighBuffer: WebGLBufferExt | null;\r\n    protected _startPositionLowBuffer: WebGLBufferExt | null;\r\n    protected _endPositionHighBuffer: WebGLBufferExt | null;\r\n    protected _endPositionLowBuffer: WebGLBufferExt | null;\r\n    protected _thicknessBuffer: WebGLBufferExt | null;\r\n    protected _rgbaBuffer: WebGLBufferExt | null;\r\n    protected _pickingColorBuffer: WebGLBufferExt | null;\r\n\r\n    protected _vertexArr: TypedArray | number[];\r\n    protected _startPositionHighArr: TypedArray | number[];\r\n    protected _startPositionLowArr: TypedArray | number[];\r\n    protected _endPositionHighArr: TypedArray | number[];\r\n    protected _endPositionLowArr: TypedArray | number[];\r\n    protected _thicknessArr: TypedArray | number[];\r\n    protected _rgbaArr: TypedArray | number[];\r\n    protected _pickingColorArr: TypedArray | number[];\r\n\r\n    protected _buffersUpdateCallbacks: Function[];\r\n    protected _changedBuffers: boolean[];\r\n\r\n    constructor(entityCollection: EntityCollection) {\r\n\r\n        this.__id = RayHandler.__counter__++;\r\n\r\n        /**\r\n         * Picking rendering option.\r\n         * @public\r\n         * @type {boolean}\r\n         */\r\n        this.pickingEnabled = true;\r\n\r\n        this._entityCollection = entityCollection;\r\n\r\n        this._renderer = null;\r\n\r\n        this._rays = [];\r\n\r\n        this._vertexBuffer = null;\r\n        this._startPositionHighBuffer = null;\r\n        this._startPositionLowBuffer = null;\r\n        this._endPositionHighBuffer = null;\r\n        this._endPositionLowBuffer = null;\r\n        this._thicknessBuffer = null;\r\n        this._rgbaBuffer = null;\r\n        this._pickingColorBuffer = null;\r\n\r\n        this._vertexArr = [];\r\n        this._startPositionHighArr = [];\r\n        this._startPositionLowArr = [];\r\n        this._endPositionHighArr = [];\r\n        this._endPositionLowArr = [];\r\n        this._thicknessArr = [];\r\n        this._rgbaArr = [];\r\n        this._pickingColorArr = [];\r\n\r\n        this._buffersUpdateCallbacks = [];\r\n        this._buffersUpdateCallbacks[VERTEX_BUFFER] = this.createVertexBuffer;\r\n        this._buffersUpdateCallbacks[START_POSITION_BUFFER] = this.createStartPositionBuffer;\r\n        this._buffersUpdateCallbacks[END_POSITION_BUFFER] = this.createEndPositionBuffer;\r\n        this._buffersUpdateCallbacks[THICKNESS_BUFFER] = this.createThicknessBuffer;\r\n        this._buffersUpdateCallbacks[RGBA_BUFFER] = this.createRgbaBuffer;\r\n        this._buffersUpdateCallbacks[PICKINGCOLOR_BUFFER] = this.createPickingColorBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n    }\r\n\r\n    static concArr(dest: number[], curr: number[]) {\r\n        for (let i = 0; i < curr.length; i++) {\r\n            dest.push(curr[i]);\r\n        }\r\n    }\r\n\r\n    public initProgram() {\r\n        if (this._renderer && this._renderer.handler) {\r\n            if (!this._renderer.handler.programs.rayScreen) {\r\n                this._renderer.handler.addProgram(shaders.rayScreen());\r\n            }\r\n\r\n            // @todo: ray picking\r\n            // if (!this._renderer.handler.programs.billboardPicking) {\r\n            //     this._renderer.handler.addProgram(shaders.billboardPicking());\r\n            // }\r\n        }\r\n    }\r\n\r\n    public setRenderer(renderer: Renderer) {\r\n        this._renderer = renderer;\r\n        this.initProgram();\r\n    }\r\n\r\n    public refresh() {\r\n        let i = this._changedBuffers.length;\r\n        while (i--) {\r\n            this._changedBuffers[i] = true;\r\n        }\r\n    }\r\n\r\n    protected _removeRays() {\r\n        let i = this._rays.length;\r\n        while (i--) {\r\n            let ri = this._rays[i];\r\n            ri._handlerIndex = -1;\r\n            ri._handler = null;\r\n        }\r\n        this._rays.length = 0;\r\n        this._rays = [];\r\n    }\r\n\r\n    public clear() {\r\n        //@ts-ignore\r\n        this._vertexArr = null;\r\n        //@ts-ignore\r\n        this._startPositionHighArr = null;\r\n        //@ts-ignore\r\n        this._startPositionLowArr = null;\r\n        //@ts-ignore\r\n        this._endPositionHighArr = null;\r\n        //@ts-ignore\r\n        this._endPositionLowArr = null;\r\n        //@ts-ignore\r\n        this._thicknessArr = null;\r\n        //@ts-ignore\r\n        this._rgbaArr = null;\r\n\r\n        this._vertexArr = new Float32Array([]);\r\n        this._startPositionHighArr = new Float32Array([]);\r\n        this._startPositionLowArr = new Float32Array([]);\r\n        this._endPositionHighArr = new Float32Array([]);\r\n        this._endPositionLowArr = new Float32Array([]);\r\n        this._thicknessArr = new Float32Array([]);\r\n        this._rgbaArr = new Float32Array([]);\r\n\r\n        this._removeRays();\r\n        this._deleteBuffers();\r\n        this.refresh();\r\n    }\r\n\r\n    protected _deleteBuffers() {\r\n        if (this._renderer) {\r\n            let gl = this._renderer.handler.gl;\r\n\r\n            if (gl) {\r\n                gl.deleteBuffer(this._startPositionHighBuffer as WebGLBuffer);\r\n                gl.deleteBuffer(this._startPositionLowBuffer as WebGLBuffer);\r\n                gl.deleteBuffer(this._endPositionHighBuffer as WebGLBuffer);\r\n                gl.deleteBuffer(this._endPositionLowBuffer as WebGLBuffer);\r\n                gl.deleteBuffer(this._thicknessBuffer as WebGLBuffer);\r\n                gl.deleteBuffer(this._rgbaBuffer as WebGLBuffer);\r\n                gl.deleteBuffer(this._vertexBuffer as WebGLBuffer);\r\n            }\r\n\r\n            this._startPositionHighBuffer = null;\r\n            this._startPositionLowBuffer = null;\r\n            this._endPositionHighBuffer = null;\r\n            this._endPositionLowBuffer = null;\r\n            this._thicknessBuffer = null;\r\n            this._rgbaBuffer = null;\r\n            this._vertexBuffer = null;\r\n        }\r\n    }\r\n\r\n    public update() {\r\n        if (this._renderer) {\r\n            let i = this._changedBuffers.length;\r\n            while (i--) {\r\n                if (this._changedBuffers[i]) {\r\n                    this._buffersUpdateCallbacks[i].call(this);\r\n                    this._changedBuffers[i] = false;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public add(ray: Ray) {\r\n        if (ray._handlerIndex == -1) {\r\n            ray._handler = this;\r\n            ray._handlerIndex = this._rays.length;\r\n            this._rays.push(ray);\r\n            this._addRayToArrays(ray);\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    protected _addRayToArrays(ray: Ray) {\r\n        if (ray.getVisibility()) {\r\n            this._vertexArr = concatArrays(\r\n                this._vertexArr,\r\n                [-0.5, 1.0, -0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 1.0, -0.5, 1.0]\r\n            );\r\n        } else {\r\n            this._vertexArr = concatArrays(\r\n                this._vertexArr,\r\n                [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]\r\n            );\r\n        }\r\n\r\n        let x = ray._startPositionHigh.x,\r\n            y = ray._startPositionHigh.y,\r\n            z = ray._startPositionHigh.z;\r\n        this._startPositionHighArr = concatArrays(this._startPositionHighArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\r\n\r\n        x = ray._startPositionLow.x;\r\n        y = ray._startPositionLow.y;\r\n        z = ray._startPositionLow.z;\r\n        this._startPositionLowArr = concatArrays(this._startPositionLowArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\r\n\r\n        x = ray._endPositionHigh.x;\r\n        y = ray._endPositionHigh.y;\r\n        z = ray._endPositionHigh.z;\r\n        this._endPositionHighArr = concatArrays(this._endPositionHighArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\r\n\r\n        x = ray._endPositionLow.x;\r\n        y = ray._endPositionLow.y;\r\n        z = ray._endPositionLow.z;\r\n        this._endPositionLowArr = concatArrays(this._endPositionLowArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\r\n\r\n        x = ray._thickness;\r\n        this._thicknessArr = concatArrays(this._thicknessArr, [x, x, x, x, x, x]);\r\n\r\n        let r0 = ray._startColor.x,\r\n            g0 = ray._startColor.y,\r\n            b0 = ray._startColor.z,\r\n            a0 = ray._startColor.w,\r\n            r1 = ray._endColor.x,\r\n            g1 = ray._endColor.y,\r\n            b1 = ray._endColor.z,\r\n            a1 = ray._endColor.w;\r\n        this._rgbaArr = concatArrays(this._rgbaArr, [\r\n            r1, g1, b1, a1,\r\n            r0, g0, b0, a0,\r\n            r0, g0, b0, a0,\r\n            r0, g0, b0, a0,\r\n            r1, g1, b1, a1,\r\n            r1, g1, b1, a1\r\n        ]);\r\n\r\n        x = ray._entity!._pickingColor.x / 255;\r\n        y = ray._entity!._pickingColor.y / 255;\r\n        z = ray._entity!._pickingColor.z / 255;\r\n        this._pickingColorArr = concatArrays(this._pickingColorArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\r\n    }\r\n\r\n    protected _displayPASS() {\r\n        let r = this._renderer!;\r\n        let h = r.handler;\r\n        h.programs.rayScreen.activate();\r\n        let sh = h.programs.rayScreen._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        let gl = h.gl!,\r\n            ec = this._entityCollection;\r\n\r\n        //gl.polygonOffset(ec.polygonOffsetFactor, ec.polygonOffsetUnits);\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        gl.uniform1f(shu.uOpacity, ec._fadingOpacity);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera!.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera!.getProjectionMatrix());\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera!.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera!.eyeLow);\r\n\r\n        gl.uniform1f(shu.resolution, r.activeCamera!._tanViewAngle_hradOneByHeight);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._startPositionHighBuffer!);\r\n        gl.vertexAttribPointer(sha.a_startPosHigh, this._startPositionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._startPositionLowBuffer!);\r\n        gl.vertexAttribPointer(sha.a_startPosLow, this._startPositionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._endPositionHighBuffer!);\r\n        gl.vertexAttribPointer(sha.a_endPosHigh, this._endPositionHighBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._endPositionLowBuffer!);\r\n        gl.vertexAttribPointer(sha.a_endPosLow, this._endPositionLowBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer!);\r\n        gl.vertexAttribPointer(sha.a_rgba, this._rgbaBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._thicknessBuffer!);\r\n        gl.vertexAttribPointer(sha.a_thickness, this._thicknessBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer!);\r\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer!.numItems);\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n    }\r\n\r\n    protected _pickingPASS() {\r\n        // ...\r\n    }\r\n\r\n    public draw() {\r\n        if (this._rays.length) {\r\n            this.update();\r\n            this._displayPASS();\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this._rays.length && this.pickingEnabled) {\r\n            this._pickingPASS();\r\n        }\r\n    }\r\n\r\n    public reindexRaysArray(startIndex: number) {\r\n        let r = this._rays;\r\n        for (let i = startIndex; i < r.length; i++) {\r\n            r[i]._handlerIndex = i;\r\n        }\r\n    }\r\n\r\n    protected _removeRay(ray: Ray) {\r\n\r\n        let ri = ray._handlerIndex;\r\n\r\n        this._rays.splice(ri, 1);\r\n\r\n        let i = ri * 24;\r\n        this._rgbaArr = spliceArray(this._rgbaArr, i, 24);\r\n\r\n        i = ri * 18;\r\n        this._startPositionHighArr = spliceArray(this._startPositionHighArr, i, 18);\r\n        this._startPositionLowArr = spliceArray(this._startPositionLowArr, i, 18);\r\n        this._endPositionHighArr = spliceArray(this._endPositionHighArr, i, 18);\r\n        this._endPositionLowArr = spliceArray(this._endPositionLowArr, i, 18);\r\n        this._pickingColorArr = spliceArray(this._pickingColorArr, i, 18);\r\n\r\n        i = ri * 12;\r\n        this._vertexArr = spliceArray(this._vertexArr, i, 12);\r\n\r\n        i = ri * 6;\r\n        this._thicknessArr = spliceArray(this._thicknessArr, i, 6);\r\n\r\n        this.reindexRaysArray(ri);\r\n        this.refresh();\r\n\r\n        ray._handlerIndex = -1;\r\n        ray._handler = null;\r\n    }\r\n\r\n    public remove(ray: Ray) {\r\n        if (ray._handler && this.__id === ray._handler.__id) {\r\n            this._removeRay(ray);\r\n        }\r\n    }\r\n\r\n    public setStartPositionArr(index: number, positionHigh: Vec3, positionLow: Vec3) {\r\n        let i = index * 18;\r\n\r\n        // High\r\n        let a = this._startPositionHighArr,\r\n            x = positionHigh.x,\r\n            y = positionHigh.y,\r\n            z = positionHigh.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        // Low\r\n        a = this._startPositionLowArr;\r\n        x = positionLow.x;\r\n        y = positionLow.y;\r\n        z = positionLow.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        this._changedBuffers[START_POSITION_BUFFER] = true;\r\n    }\r\n\r\n    public setEndPositionArr(index: number, positionHigh: Vec3, positionLow: Vec3) {\r\n        let i = index * 18;\r\n\r\n        // High\r\n        let a = this._endPositionHighArr,\r\n            x = positionHigh.x,\r\n            y = positionHigh.y,\r\n            z = positionHigh.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        // Low\r\n        a = this._endPositionLowArr;\r\n        x = positionLow.x;\r\n        y = positionLow.y;\r\n        z = positionLow.z;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        this._changedBuffers[END_POSITION_BUFFER] = true;\r\n    }\r\n\r\n    public setPickingColorArr(index: number, color: Vec3) {\r\n        let i = index * 18;\r\n        let a = this._pickingColorArr,\r\n            x = color.x / 255,\r\n            y = color.y / 255,\r\n            z = color.z / 255;\r\n\r\n        a[i] = x;\r\n        a[i + 1] = y;\r\n        a[i + 2] = z;\r\n\r\n        a[i + 3] = x;\r\n        a[i + 4] = y;\r\n        a[i + 5] = z;\r\n\r\n        a[i + 6] = x;\r\n        a[i + 7] = y;\r\n        a[i + 8] = z;\r\n\r\n        a[i + 9] = x;\r\n        a[i + 10] = y;\r\n        a[i + 11] = z;\r\n\r\n        a[i + 12] = x;\r\n        a[i + 13] = y;\r\n        a[i + 14] = z;\r\n\r\n        a[i + 15] = x;\r\n        a[i + 16] = y;\r\n        a[i + 17] = z;\r\n\r\n        this._changedBuffers[PICKINGCOLOR_BUFFER] = true;\r\n    }\r\n\r\n    public setRgbaArr(index: number, startColor: Vec4, endColor: Vec4) {\r\n        let i = index * 24;\r\n        let a = this._rgbaArr,\r\n            r0 = startColor.x,\r\n            g0 = startColor.y,\r\n            b0 = startColor.z,\r\n            a0 = startColor.w,\r\n            r1 = endColor.x,\r\n            g1 = endColor.y,\r\n            b1 = endColor.z,\r\n            a1 = endColor.w;\r\n\r\n        a[i] = r1;\r\n        a[i + 1] = g1;\r\n        a[i + 2] = b1;\r\n        a[i + 3] = a1;\r\n\r\n        a[i + 4] = r0;\r\n        a[i + 5] = g0;\r\n        a[i + 6] = b0;\r\n        a[i + 7] = a0;\r\n\r\n        a[i + 8] = r0;\r\n        a[i + 9] = g0;\r\n        a[i + 10] = b0;\r\n        a[i + 11] = a0;\r\n\r\n        a[i + 12] = r0;\r\n        a[i + 13] = g0;\r\n        a[i + 14] = b0;\r\n        a[i + 15] = a0;\r\n\r\n        a[i + 16] = r1;\r\n        a[i + 17] = g1;\r\n        a[i + 18] = b1;\r\n        a[i + 19] = a1;\r\n\r\n        a[i + 20] = r1;\r\n        a[i + 21] = g1;\r\n        a[i + 22] = b1;\r\n        a[i + 23] = a1;\r\n\r\n        this._changedBuffers[RGBA_BUFFER] = true;\r\n    }\r\n\r\n    public setThicknessArr(index: number, thickness: number) {\r\n        let i = index * 6;\r\n        let a = this._thicknessArr;\r\n\r\n        a[i] = thickness;\r\n        a[i + 1] = thickness;\r\n        a[i + 2] = thickness;\r\n        a[i + 3] = thickness;\r\n        a[i + 4] = thickness;\r\n        a[i + 5] = thickness;\r\n\r\n        this._changedBuffers[THICKNESS_BUFFER] = true;\r\n    }\r\n\r\n    public setVisibility(index: number, visibility: boolean) {\r\n        let vArr: number[];\r\n        if (visibility) {\r\n            vArr = [-0.5, 1.0, -0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 1.0, -0.5, 1.0];\r\n        } else {\r\n            vArr = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];\r\n        }\r\n        this.setVertexArr(index, vArr);\r\n    }\r\n\r\n    public setVertexArr(index: number, vertexArr: number[]) {\r\n        let i = index * 12;\r\n        let a = this._vertexArr;\r\n\r\n        a[i] = vertexArr[0];\r\n        a[i + 1] = vertexArr[1];\r\n        a[i + 2] = vertexArr[2];\r\n\r\n        a[i + 3] = vertexArr[3];\r\n        a[i + 4] = vertexArr[4];\r\n        a[i + 5] = vertexArr[5];\r\n\r\n        a[i + 6] = vertexArr[6];\r\n        a[i + 7] = vertexArr[7];\r\n        a[i + 8] = vertexArr[8];\r\n\r\n        a[i + 9] = vertexArr[9];\r\n        a[i + 10] = vertexArr[10];\r\n        a[i + 11] = vertexArr[11];\r\n\r\n        this._changedBuffers[VERTEX_BUFFER] = true;\r\n    }\r\n\r\n    public createStartPositionBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._startPositionHighBuffer as WebGLBuffer);\r\n        this._startPositionHighArr = makeArrayTyped(this._startPositionHighArr);\r\n        this._startPositionHighBuffer = h.createArrayBuffer(\r\n            this._startPositionHighArr as Float32Array,\r\n            3,\r\n            this._startPositionHighArr.length / 3,\r\n            h.gl!.DYNAMIC_DRAW\r\n        );\r\n        h.gl!.deleteBuffer(this._startPositionLowBuffer as WebGLBuffer);\r\n        this._startPositionLowArr = makeArrayTyped(this._startPositionLowArr);\r\n\r\n        this._startPositionLowBuffer = h.createArrayBuffer(\r\n            this._startPositionLowArr as Float32Array,\r\n            3,\r\n            this._startPositionLowArr.length / 3,\r\n            h.gl!.DYNAMIC_DRAW\r\n        );\r\n    }\r\n\r\n    public createEndPositionBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._endPositionHighBuffer as WebGLBuffer);\r\n        this._endPositionHighArr = makeArrayTyped(this._endPositionHighArr);\r\n        this._endPositionHighBuffer = h.createArrayBuffer(\r\n            this._endPositionHighArr as Float32Array,\r\n            3,\r\n            this._endPositionHighArr.length / 3,\r\n            h.gl!.DYNAMIC_DRAW\r\n        );\r\n        h.gl!.deleteBuffer(this._endPositionLowBuffer as WebGLBuffer);\r\n        this._endPositionLowArr = makeArrayTyped(this._endPositionLowArr);\r\n        this._endPositionLowBuffer = h.createArrayBuffer(\r\n            this._endPositionLowArr as Float32Array,\r\n            3,\r\n            this._endPositionLowArr.length / 3,\r\n            h.gl!.DYNAMIC_DRAW\r\n        );\r\n    }\r\n\r\n    public createRgbaBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._rgbaBuffer as WebGLBuffer);\r\n        this._rgbaArr = makeArrayTyped(this._rgbaArr);\r\n        this._rgbaBuffer = h.createArrayBuffer(this._rgbaArr as Float32Array, 4, this._rgbaArr.length / 4);\r\n    }\r\n\r\n    public createThicknessBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._thicknessBuffer as WebGLBuffer);\r\n        this._thicknessArr = makeArrayTyped(this._thicknessArr);\r\n        this._thicknessBuffer = h.createArrayBuffer(\r\n            this._thicknessArr as Float32Array,\r\n            1,\r\n            this._thicknessArr.length,\r\n            h.gl!.DYNAMIC_DRAW\r\n        );\r\n    }\r\n\r\n    public createVertexBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._vertexBuffer as WebGLBuffer);\r\n        this._vertexArr = makeArrayTyped(this._vertexArr);\r\n        this._vertexBuffer = h.createArrayBuffer(\r\n            this._vertexArr as Float32Array,\r\n            2,\r\n            this._vertexArr.length / 2,\r\n            h.gl!.DYNAMIC_DRAW\r\n        );\r\n    }\r\n\r\n    public createPickingColorBuffer() {\r\n        let h = this._renderer!.handler;\r\n        h.gl!.deleteBuffer(this._pickingColorBuffer as WebGLBuffer);\r\n        this._pickingColorArr = makeArrayTyped(this._pickingColorArr);\r\n        this._pickingColorBuffer = h.createArrayBuffer(\r\n            this._pickingColorArr as Float32Array,\r\n            3,\r\n            this._pickingColorArr.length / 3\r\n        );\r\n    }\r\n}\r\n\r\nexport {RayHandler};\r\n","import {EntityCollection} from \"./EntityCollection\";\r\nimport {Program} from \"../webgl/Program\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport {Strip} from \"./Strip\";\r\n\r\nclass StripHandler {\r\n\r\n    static __counter__: number = 0;\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Picking rendering option.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public pickingEnabled: boolean;\r\n\r\n    /**\r\n     * Parent collection\r\n     * @protected\r\n     * @type {EntityCollection}\r\n     */\r\n    protected _entityCollection: EntityCollection;\r\n\r\n    /**\r\n     * Renderer\r\n     * @protected\r\n     * @type {Renderer | null}\r\n     */\r\n    protected _renderer: Renderer | null;\r\n\r\n    /**\r\n     * Strip objects array\r\n     * @protected\r\n     * @type {Array.<Strip>}\r\n     */\r\n    protected _strips: Strip[];\r\n\r\n    constructor(entityCollection: EntityCollection) {\r\n\r\n        this.__id = StripHandler.__counter__++;\r\n\r\n        this.pickingEnabled = true;\r\n\r\n        this._entityCollection = entityCollection;\r\n\r\n        this._renderer = null;\r\n\r\n        this._strips = [];\r\n    }\r\n\r\n    protected _initProgram() {\r\n        if (this._renderer && this._renderer.handler) {\r\n            !this._renderer.handler.programs.strip &&\r\n            this._renderer.handler.addProgram(\r\n                new Program(\"strip\", {\r\n                    uniforms: {\r\n                        projectionMatrix: {type: \"mat4\"},\r\n                        viewMatrix: {type: \"mat4\"},\r\n                        eyePositionHigh: \"vec3\",\r\n                        eyePositionLow: \"vec3\",\r\n                        uColor: {type: \"vec4\"},\r\n                        uOpacity: {type: \"float\"}\r\n                    },\r\n                    attributes: {\r\n                        aVertexPositionHigh: {type: \"vec3\"},\r\n                        aVertexPositionLow: {type: \"vec3\"}\r\n                    },\r\n                    vertexShader: `attribute vec3 aVertexPositionHigh;\r\n                        attribute vec3 aVertexPositionLow;\r\n                        uniform mat4 projectionMatrix;\r\n                        uniform mat4 viewMatrix;\r\n                        uniform vec3 eyePositionHigh;\r\n                        uniform vec3 eyePositionLow;\r\n                        void main(void) {\r\n\r\n                            vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n                            vec3 lowDiff = aVertexPositionLow - eyePositionLow;\r\n\r\n                            mat4 viewMatrixRTE = viewMatrix;\r\n                            viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n                            gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n                        }`,\r\n                    fragmentShader: `precision highp float;\r\n                        uniform vec4 uColor;\r\n                        uniform float uOpacity;\r\n                        void main(void) {\r\n                            gl_FragColor = vec4(uColor.rgb, uColor.a * uOpacity);\r\n                        }`\r\n                })\r\n            );\r\n        }\r\n    }\r\n\r\n    public setRenderNode(renderNode: RenderNode) {\r\n        this._renderer = renderNode.renderer;\r\n        this._initProgram();\r\n        for (let i = 0; i < this._strips.length; i++) {\r\n            this._strips[i].setRenderNode(renderNode);\r\n        }\r\n    }\r\n\r\n    public add(strip: Strip) {\r\n        if (strip._handlerIndex === -1) {\r\n            strip._handler = this;\r\n            strip._handlerIndex = this._strips.length;\r\n            this._strips.push(strip);\r\n            this._entityCollection &&\r\n            this._entityCollection.renderNode &&\r\n            strip.setRenderNode(this._entityCollection.renderNode);\r\n        }\r\n    }\r\n\r\n    public remove(strip: Strip) {\r\n        let index = strip._handlerIndex;\r\n        if (index !== -1) {\r\n            strip._deleteBuffers();\r\n            strip._handlerIndex = -1;\r\n            strip._handler = null;\r\n            this._strips.splice(index, 1);\r\n            this.reindexStripArray(index);\r\n        }\r\n    }\r\n\r\n    public reindexStripArray(startIndex: number) {\r\n        let pc = this._strips;\r\n        for (let i = startIndex; i < pc.length; i++) {\r\n            pc[i]._handlerIndex = i;\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        let i = this._strips.length;\r\n        while (i--) {\r\n            this._strips[i].draw();\r\n        }\r\n    }\r\n\r\n    public drawPicking() {\r\n        if (this.pickingEnabled) {\r\n            let i = this._strips.length;\r\n            while (i--) {\r\n                this._strips[i].drawPicking();\r\n            }\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        let i = this._strips.length;\r\n        while (i--) {\r\n            this._strips[i]._deleteBuffers();\r\n            this._strips[i]._handler = null;\r\n            this._strips[i]._handlerIndex = -1;\r\n        }\r\n        this._strips.length = 0;\r\n        this._strips = [];\r\n    }\r\n}\r\n\r\nexport {StripHandler};\r\n","import * as math from \"../math\";\r\nimport {BillboardHandler} from \"./BillboardHandler\";\r\nimport {createEvents} from \"../Events\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {Entity} from \"./Entity\";\r\nimport {Ellipsoid} from \"../ellipsoid/Ellipsoid\";\r\nimport {EntityCollectionNode} from \"../quadTree/EntityCollectionNode\";\r\nimport {GeoObjectHandler} from \"./GeoObjectHandler\";\r\nimport {LabelHandler} from \"./LabelHandler\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {PointCloudHandler} from \"./PointCloudHandler\";\r\nimport {PolylineHandler} from \"./PolylineHandler\";\r\nimport {RayHandler} from \"./RayHandler\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport {StripHandler} from \"./StripHandler\";\r\nimport {Vector} from \"../layer/Vector\";\r\n\r\nexport type EntityCollectionEvents = EventsHandler<EntityCollectionEventList>;\r\n\r\ninterface IEntityCollectionParams {\r\n    polygonOffsetUnits?: number;\r\n    visibility?: boolean;\r\n    labelMaxLetters?: number;\r\n    pickingEnabled?: boolean;\r\n    scaleByDistance?: NumberArray3;\r\n    pickingScale?: number | NumberArray3;\r\n    opacity?: number;\r\n    useLighting?: boolean;\r\n    entities?: Entity[];\r\n    depthOrder?: number;\r\n}\r\n\r\n/**\r\n * An observable collection of og.Entity instances where each entity has a unique id.\r\n * Entity collection provide handlers for each type of entity like billboard, label or 3ds object.\r\n * @constructor\r\n * @param {Object} [options] - Entity options:\r\n * @param {Array.<Entity>} [options.entities] - Entities array.\r\n * @param {boolean} [options.visibility=true] - Entity visibility.\r\n * @param {Array.<number>} [options.scaleByDistance] - Entity scale by distance parameters. (exactly 3 entries)\r\n * First index - near distance to the entity, after entity becomes full scale.\r\n * Second index - far distance to the entity, when entity becomes zero scale.\r\n * Third index - far distance to the entity, when entity becomes invisible.\r\n * @param {number} [options.opacity] - Entity global opacity.\r\n * @param {boolean} [options.pickingEnabled=true] - Entity picking enable.\r\n * @param {Number} [options.polygonOffsetUnits=0.0] - The multiplier by which an implementation-specific value is multiplied with to create a constant depth offset. The default value is 0.\r\n * //@fires EntityCollection#entitymove\r\n * @fires EntityCollection#draw\r\n * @fires EntityCollection#drawend\r\n * @fires EntityCollection#add\r\n * @fires EntityCollection#remove\r\n * @fires EntityCollection#entityadd\r\n * @fires EntityCollection#entityremove\r\n * @fires EntityCollection#visibilitychange\r\n * @fires EntityCollection#mousemove\r\n * @fires EntityCollection#mouseenter\r\n * @fires EntityCollection#mouseleave\r\n * @fires EntityCollection#lclick\r\n * @fires EntityCollection#rclick\r\n * @fires EntityCollection#mclick\r\n * @fires EntityCollection#ldblclick\r\n * @fires EntityCollection#rdblclick\r\n * @fires EntityCollection#mdblclick\r\n * @fires EntityCollection#lup\r\n * @fires EntityCollection#rup\r\n * @fires EntityCollection#mup\r\n * @fires EntityCollection#ldown\r\n * @fires EntityCollection#rdown\r\n * @fires EntityCollection#mdown\r\n * @fires EntityCollection#lhold\r\n * @fires EntityCollection#rhold\r\n * @fires EntityCollection#mhold\r\n * @fires EntityCollection#mousewheel\r\n * @fires EntityCollection#touchmove\r\n * @fires EntityCollection#touchstart\r\n * @fires EntityCollection#touchend\r\n * @fires EntityCollection#doubletouch\r\n * @fires EntityCollection#touchleave\r\n * @fires EntityCollection#touchenter\r\n */\r\nclass EntityCollection {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    /**\r\n     * Uniq identifier.\r\n     * @public\r\n     * @readonly\r\n     */\r\n    protected __id: number;\r\n\r\n    /**\r\n     * Render node context.\r\n     * @public\r\n     * @type {RenderNode}\r\n     */\r\n    public renderNode: RenderNode | null;\r\n\r\n    /**\r\n     * Visibility option.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public _visibility: boolean;\r\n\r\n    /**\r\n     * Specifies the scale Units for gl.polygonOffset function to calculate depth values, 0.0 is default.\r\n     * @public\r\n     * @type {Number}\r\n     */\r\n    public polygonOffsetUnits: number;\r\n\r\n    /**\r\n     * Billboards handler\r\n     * @public\r\n     * @type {BillboardHandler}\r\n     */\r\n    public billboardHandler: BillboardHandler;\r\n\r\n    /**\r\n     * Labels handler\r\n     * @public\r\n     * @type {LabelHandler}\r\n     */\r\n    public labelHandler: LabelHandler;\r\n\r\n    /**\r\n     * Polyline handler\r\n     * @public\r\n     * @type {PolylineHandler}\r\n     */\r\n    public polylineHandler: PolylineHandler;\r\n\r\n    /**\r\n     * Ray handler\r\n     * @public\r\n     * @type {RayHandler}\r\n     */\r\n    public rayHandler: RayHandler;\r\n\r\n    /**\r\n     * PointCloud handler\r\n     * @public\r\n     * @type {PointCloudHandler}\r\n     */\r\n    public pointCloudHandler: PointCloudHandler;\r\n\r\n    /**\r\n     * Strip handler\r\n     * @public\r\n     * @type {StripHandler}\r\n     */\r\n    public stripHandler: StripHandler;\r\n\r\n    /**\r\n     * Geo object handler\r\n     * @public\r\n     * @type {GeoObjectHandler}\r\n     */\r\n    public geoObjectHandler: GeoObjectHandler;\r\n\r\n    /**\r\n     * Entities array.\r\n     * @public\r\n     * @type {Array.<Entity>}\r\n     */\r\n    public _entities: Entity[];\r\n\r\n    /**\r\n     * First index - near distance to the entity, after entity becomes full scale.\r\n     * Second index - far distance to the entity, when entity becomes zero scale.\r\n     * Third index - far distance to the entity, when entity becomes invisible.\r\n     * @public\r\n     * @type {Array.<number>}\r\n     */\r\n    public scaleByDistance: NumberArray3;\r\n\r\n    public pickingScale: Float32Array;\r\n\r\n    /**\r\n     * Global opacity.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _opacity: number;\r\n\r\n    /**\r\n     * Opacity state during the animated opacity.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _fadingOpacity: number;\r\n\r\n    /**\r\n     * Entity collection events handler.\r\n     * @public\r\n     * @type {EntityCollectionEvents}\r\n     */\r\n    public events: EntityCollectionEvents;\r\n\r\n    public rendererEvents: EntityCollectionEvents;\r\n\r\n    /**\r\n     * Used in EntityCollectionNode, also could be merged with _quadNode\r\n     */\r\n    public _layer?: Vector;\r\n    public _quadNode?: EntityCollectionNode;\r\n\r\n    public _useLighting: number;\r\n\r\n    protected _depthOrder: number;\r\n\r\n    constructor(options: IEntityCollectionParams = {}) {\r\n\r\n        this.__id = EntityCollection.__counter__++;\r\n\r\n        this.renderNode = null;\r\n\r\n        this._visibility = options.visibility == undefined ? true : options.visibility;\r\n\r\n        this.polygonOffsetUnits =\r\n            options.polygonOffsetUnits != undefined ? options.polygonOffsetUnits : 0.0;\r\n\r\n        this.billboardHandler = new BillboardHandler(this);\r\n\r\n        this.labelHandler = new LabelHandler(this, options.labelMaxLetters);\r\n\r\n        this.polylineHandler = new PolylineHandler(this);\r\n\r\n        this.rayHandler = new RayHandler(this);\r\n\r\n        this.pointCloudHandler = new PointCloudHandler(this);\r\n\r\n        this.stripHandler = new StripHandler(this);\r\n\r\n        this.geoObjectHandler = new GeoObjectHandler(this);\r\n\r\n        if (options.pickingEnabled != undefined) {\r\n            this.setPickingEnabled(options.pickingEnabled);\r\n        }\r\n\r\n        this._entities = [];\r\n\r\n        this.scaleByDistance = options.scaleByDistance || [1.0, 1.0, 1.0];\r\n\r\n        let pickingScale: Float32Array = new Float32Array([1.0, 1.0, 1.0]);\r\n        if (options.pickingScale !== undefined) {\r\n            if (options.pickingScale instanceof Array) {\r\n                pickingScale[0] = options.pickingScale[0] || pickingScale[0];\r\n                pickingScale[1] = options.pickingScale[1] || pickingScale[1];\r\n                pickingScale[2] = options.pickingScale[2] || pickingScale[2];\r\n            } else if (typeof options.pickingScale === 'number') {\r\n                pickingScale[0] = options.pickingScale;\r\n                pickingScale[1] = options.pickingScale;\r\n                pickingScale[2] = options.pickingScale;\r\n            }\r\n        }\r\n\r\n        this._depthOrder = options.depthOrder || 0;\r\n\r\n        this.pickingScale = pickingScale;\r\n\r\n        this._opacity = options.opacity == undefined ? 1.0 : options.opacity;\r\n\r\n        this._fadingOpacity = this._opacity;\r\n\r\n        this.events = this.rendererEvents = createEvents<EntityCollectionEventList>(ENTITYCOLLECTION_EVENTS, this);\r\n\r\n        this._useLighting = options.useLighting != undefined ? (options.useLighting ? 1.0 : 0.0) : 1.0;\r\n\r\n        // initialize current entities\r\n        if (options.entities) {\r\n            this.addEntities(options.entities);\r\n        }\r\n    }\r\n\r\n    public get depthOrder(): number {\r\n        return this._depthOrder;\r\n    }\r\n\r\n    public set depthOrder(depghOrder: number) {\r\n        this._depthOrder = depghOrder;\r\n        if (this.renderNode) {\r\n            this.renderNode.updateEntityCollectionsDepthOrder();\r\n        }\r\n    }\r\n\r\n    public isEmpty(): boolean {\r\n        return this._entities.length == 0;\r\n    }\r\n\r\n    get id(): number {\r\n        return this.__id;\r\n    }\r\n\r\n    public get useLighting(): boolean {\r\n        return Boolean(this._useLighting)\r\n    }\r\n\r\n    public set useLighting(f: boolean) {\r\n        this._useLighting = Number(f);\r\n    }\r\n\r\n    public isEqual(ec: EntityCollection | null): boolean {\r\n        return ec !== null && (this.__id === ec.__id);\r\n    }\r\n\r\n    /**\r\n     * Sets collection visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Visibility flag.\r\n     */\r\n    public setVisibility(visibility: boolean) {\r\n        this._visibility = visibility;\r\n        this._fadingOpacity = this._opacity * (visibility ? 1 : 0);\r\n        this.renderNode?.updateEntityCollectionsDepthOrder();\r\n        this.events.dispatch(this.events.visibilitychange, this);\r\n    }\r\n\r\n    /**\r\n     * Returns collection visibility.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public getVisibility(): boolean {\r\n        return this._visibility;\r\n    }\r\n\r\n    /**\r\n     * Sets collection opacity.\r\n     * @public\r\n     * @param {number} opacity - Opacity.\r\n     */\r\n    public setOpacity(opacity: number) {\r\n        this._opacity = opacity;\r\n    }\r\n\r\n    /**\r\n     * Sets collection picking ability.\r\n     * @public\r\n     * @param {boolean} enable - Picking enable flag.\r\n     */\r\n    public setPickingEnabled(enable: boolean) {\r\n        this.billboardHandler.pickingEnabled = enable;\r\n        this.labelHandler.pickingEnabled = enable;\r\n        this.polylineHandler.pickingEnabled = enable;\r\n        this.rayHandler.pickingEnabled = enable;\r\n        this.pointCloudHandler.pickingEnabled = enable;\r\n        this.stripHandler.pickingEnabled = enable;\r\n        this.geoObjectHandler.pickingEnabled = enable;\r\n    }\r\n\r\n    /**\r\n     * Gets collection opacity.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getOpacity(): number {\r\n        return this._opacity;\r\n    }\r\n\r\n    /**\r\n     * Sets scale by distance parameters.\r\n     * @public\r\n     * @param {number} near - Full scale entity distance.\r\n     * @param {number} far - Zero scale entity distance.\r\n     * @param {number} [farInvisible] - Entity visibility distance.\r\n     */\r\n    public setScaleByDistance(near: number, far: number, farInvisible?: number) {\r\n        this.scaleByDistance[0] = near;\r\n        this.scaleByDistance[1] = far;\r\n        this.scaleByDistance[2] = farInvisible || math.MAX32;\r\n    }\r\n\r\n    public appendChildEntity(entity: Entity) {\r\n        this._addRecursively(entity);\r\n    }\r\n\r\n    protected _addRecursively(entity: Entity) {\r\n        let rn: RenderNode | null = this.renderNode;\r\n        if (rn) {\r\n            if ((rn as Planet).ellipsoid && entity._cartesian.isZero()) {\r\n                entity.setCartesian3v((rn as Planet).ellipsoid.lonLatToCartesian(entity._lonLat));\r\n            }\r\n        }\r\n\r\n        this._setPickingColor(entity);\r\n        entity._updateAbsolutePosition();\r\n        entity.setScale3v(entity.getScale());\r\n\r\n        // billboard\r\n        entity.billboard && this.billboardHandler.add(entity.billboard);\r\n\r\n        // label\r\n        entity.label && this.labelHandler.add(entity.label);\r\n\r\n        // polyline\r\n        entity.polyline && this.polylineHandler.add(entity.polyline);\r\n\r\n        // ray\r\n        entity.ray && this.rayHandler.add(entity.ray);\r\n\r\n        // pointCloud\r\n        entity.pointCloud && this.pointCloudHandler.add(entity.pointCloud);\r\n\r\n        // strip\r\n        entity.strip && this.stripHandler.add(entity.strip);\r\n\r\n        //geoObject\r\n        entity.geoObject && this.geoObjectHandler.add(entity.geoObject);\r\n\r\n        this.events.dispatch(this.events.entityadd, entity);\r\n\r\n        for (let i = 0; i < entity.childEntities.length; i++) {\r\n            entity.childEntities[i]._entityCollection = this;\r\n            entity.childEntities[i]._entityCollectionIndex = entity._entityCollectionIndex;\r\n            this._addRecursively(entity.childEntities[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds entity to the collection and returns collection.\r\n     * @public\r\n     * @param {Entity} entity - Entity.\r\n     * @returns {EntityCollection} -\r\n     */\r\n    public add(entity: Entity): EntityCollection {\r\n        if (!entity._entityCollection) {\r\n            entity._entityCollection = this;\r\n            entity._entityCollectionIndex = this._entities.length;\r\n            this._entities.push(entity);\r\n            this._addRecursively(entity);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Adds entities array to the collection and returns collection.\r\n     * @public\r\n     * @param {Array.<Entity>} entities - Entities array.\r\n     * @returns {EntityCollection} -\r\n     */\r\n    public addEntities(entities: Entity[]): EntityCollection {\r\n        for (let i = 0, len = entities.length; i < len; i++) {\r\n            this.add(entities[i]);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the entity belongs this collection, otherwise returns false.\r\n     * @public\r\n     * @param {Entity} entity - Entity.\r\n     * @returns {boolean} -\r\n     */\r\n    public belongs(entity: Entity) {\r\n        return this.isEqual(entity._entityCollection);\r\n    }\r\n\r\n    protected _removeRecursively(entity: Entity) {\r\n        entity._entityCollection = null;\r\n        entity._entityCollectionIndex = -1;\r\n\r\n        // billboard\r\n        entity.billboard && this.billboardHandler.remove(entity.billboard);\r\n\r\n        // label\r\n        entity.label && this.labelHandler.remove(entity.label);\r\n\r\n        // polyline\r\n        entity.polyline && this.polylineHandler.remove(entity.polyline);\r\n\r\n        // ray\r\n        entity.ray && this.rayHandler.remove(entity.ray);\r\n\r\n        // pointCloud\r\n        entity.pointCloud && this.pointCloudHandler.remove(entity.pointCloud);\r\n\r\n        // strip\r\n        entity.strip && this.stripHandler.remove(entity.strip);\r\n\r\n        // geoObject\r\n        entity.geoObject && this.geoObjectHandler.remove(entity.geoObject);\r\n\r\n        for (let i = 0; i < entity.childEntities.length; i++) {\r\n            this._removeRecursively(entity.childEntities[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes entity from this collection.\r\n     * @public\r\n     * @param {Entity} entity - Entity to remove.\r\n     */\r\n    public removeEntity(entity: Entity) {\r\n        this._entities.splice(entity._entityCollectionIndex, 1);\r\n        this.reindexEntitiesArray(entity._entityCollectionIndex);\r\n\r\n        // clear picking color\r\n        if (this.renderNode && this.renderNode.renderer) {\r\n            this.renderNode.renderer.clearPickingColor(entity);\r\n            entity._pickingColor.clear();\r\n        }\r\n\r\n        if (this.belongs(entity)) {\r\n            this._removeRecursively(entity);\r\n        }\r\n\r\n        this.events.dispatch(this.events.entityremove, entity);\r\n    }\r\n\r\n    public _removeEntitySilent(entity: Entity) {\r\n        this._entities.splice(entity._entityCollectionIndex, 1);\r\n        this.reindexEntitiesArray(entity._entityCollectionIndex);\r\n\r\n        // clear picking color\r\n        if (this.renderNode && this.renderNode.renderer) {\r\n            this.renderNode.renderer.clearPickingColor(entity);\r\n            entity._pickingColor.clear();\r\n        }\r\n\r\n        if (this.belongs(entity)) {\r\n            this._removeRecursively(entity);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates or refresh collected entities picking color.\r\n     * @public\r\n     */\r\n    public createPickingColors(entities: Entity[] = this._entities) {\r\n        if (!(this.renderNode && this.renderNode.renderer)) return;\r\n        for (let i = 0; i < entities.length; i++) {\r\n            let ei = entities[i];\r\n            this._setPickingColor(ei);\r\n            this.createPickingColors(ei.childEntities);\r\n        }\r\n    }\r\n\r\n    protected _setPickingColor(entity: Entity) {\r\n        if (this.renderNode && this.renderNode.renderer) {\r\n            if (entity._independentPicking || !entity.parent) {\r\n                this.renderNode.renderer.assignPickingColor<Entity>(entity);\r\n            } else {\r\n                entity._pickingColor = entity.parent._pickingColor;\r\n            }\r\n            this.renderNode.renderer.assignPickingColor<Entity>(entity);\r\n            entity.setPickingColor();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Refresh collected entities indexes from startIndex entities collection array position.\r\n     * @public\r\n     * @param {number} startIndex - Entities collection array index.\r\n     */\r\n    public reindexEntitiesArray(startIndex: number) {\r\n        let e = this._entities;\r\n        for (let i = startIndex; i < e.length; i++) {\r\n            e[i]._entityCollectionIndex = i;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds this collection to render node.\r\n     * @public\r\n     * @param {RenderNode} renderNode - Render node.\r\n     * @param {boolean} [isHidden] - Uses in vector layers that render in planet render specific function.\r\n     * @returns {EntityCollection} -\r\n     */\r\n    public addTo(renderNode: RenderNode, isHidden: boolean = false) {\r\n        if (!this.renderNode) {\r\n            renderNode.addEntityCollection(this, isHidden);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * This function is called in the RenderNode assign function.\r\n     * @public\r\n     * @param {RenderNode} renderNode\r\n     */\r\n    public bindRenderNode(renderNode: RenderNode) {\r\n        if (renderNode.renderer && renderNode.renderer.isInitialized()) {\r\n\r\n            this.billboardHandler.setRenderer(renderNode.renderer);\r\n            this.labelHandler.setRenderer(renderNode.renderer);\r\n            this.rayHandler.setRenderer(renderNode.renderer);\r\n\r\n            this.geoObjectHandler.setRenderNode(renderNode);\r\n            this.polylineHandler.setRenderNode(renderNode);\r\n            this.pointCloudHandler.setRenderNode(renderNode);\r\n            this.stripHandler.setRenderNode(renderNode);\r\n\r\n            renderNode.renderer.events.on(\"changerelativecenter\", this._onChangeRelativeCenter);\r\n\r\n            this.updateBillboardsTextureAtlas();\r\n            this.updateLabelsFontAtlas();\r\n            this.createPickingColors();\r\n        }\r\n    }\r\n\r\n    protected _onChangeRelativeCenter = (c: Vec3) => {\r\n        this.geoObjectHandler.setRelativeCenter(c);\r\n        this.polylineHandler.setRelativeCenter(c);\r\n    }\r\n\r\n    /**\r\n     * Updates coordinates all lonLat entities in collection after collection attached to the planet node.\r\n     * @protected\r\n     * @param {Ellipsoid} ellipsoid - Globe ellipsoid.\r\n     */\r\n    protected _updateGeodeticCoordinates(ellipsoid: Ellipsoid) {\r\n        let e = this._entities;\r\n        let i = e.length;\r\n        while (i--) {\r\n            let ei = e[i];\r\n            ei._lonLat && ei.setCartesian3v(ellipsoid.lonLatToCartesian(ei._lonLat));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates billboard texture atlas.\r\n     * @public\r\n     */\r\n    public updateBillboardsTextureAtlas() {\r\n        let b = this.billboardHandler.billboards;\r\n        for (let i = 0; i < b.length; i++) {\r\n            b[i].setSrc(b[i].getSrc());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates labels font atlas.\r\n     * @public\r\n     */\r\n    public updateLabelsFontAtlas() {\r\n        if (this.renderNode) {\r\n            // let l = ([] as Label[]).concat(this.labelHandler.labels);\r\n            // this.labelHandler._billboards = [];\r\n            // for (let i = 0; i < l.length; i++) {\r\n            //     this.labelHandler.assignFontAtlas(l[i]);\r\n            // }\r\n            this.labelHandler.updateFonts();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes collection from render node.\r\n     * @public\r\n     */\r\n    public remove() {\r\n        if (this.renderNode) {\r\n            this.renderNode.removeEntityCollection(this);\r\n            this.renderNode.renderer?.events.off(\"changerelativecenter\", this._onChangeRelativeCenter);\r\n            this.renderNode = null;\r\n            this.events.dispatch(this.events.remove, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets entity array.\r\n     * @public\r\n     * @returns {Array.<Entity>} -\r\n     */\r\n    public getEntities(): Entity[] {\r\n        return ([] as Entity[]).concat(this._entities);\r\n    }\r\n\r\n    /**\r\n     * Safety entities loop.\r\n     * @public\r\n     * @param {function} callback - Entity callback.\r\n     */\r\n    public each(callback: Function) {\r\n        let i = this._entities.length;\r\n        while (i--) {\r\n            let ei = this._entities[i];\r\n            ei && callback(ei);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes all entities from collection and clear handlers.\r\n     * @public\r\n     */\r\n    public clear() {\r\n        // TODO: Optimize by replace delete\r\n        // code to the clearEntity function.\r\n        this.billboardHandler.clear();\r\n        this.labelHandler.clear();\r\n        this.polylineHandler.clear();\r\n        this.rayHandler.clear();\r\n        this.pointCloudHandler.clear();\r\n        this.stripHandler.clear();\r\n        this.geoObjectHandler.clear();\r\n\r\n        let i = this._entities.length;\r\n        while (i--) {\r\n            let ei = this._entities[i];\r\n            if (this.renderNode && this.renderNode.renderer) {\r\n                this.renderNode.renderer.clearPickingColor(ei);\r\n                ei._pickingColor.clear();\r\n            }\r\n            this._clearEntity(ei);\r\n        }\r\n        this._entities.length = 0;\r\n        this._entities = [];\r\n    }\r\n\r\n    /**\r\n     * Clears entity recursively.\r\n     * @private\r\n     * @param {Entity} entity - Entity to clear.\r\n     */\r\n    protected _clearEntity(entity: Entity) {\r\n        entity._entityCollection = null;\r\n        entity._entityCollectionIndex = -1;\r\n        for (let i = 0; i < entity.childEntities.length; i++) {\r\n            this._clearEntity(entity.childEntities[i]);\r\n        }\r\n    }\r\n}\r\n\r\ntype EntityCollectionEventList = [\r\n    //\"entitymove\",\r\n    \"draw\",\r\n    \"drawend\",\r\n    \"add\",\r\n    \"remove\",\r\n    \"entityadd\",\r\n    \"entityremove\",\r\n    \"visibilitychange\",\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\"\r\n]\r\n\r\nconst ENTITYCOLLECTION_EVENTS: EntityCollectionEventList = [\r\n    // /**\r\n    //  * Triggered when entity has moved.\r\n    //  * @event EntityCollection#entitymove\r\n    //  */\r\n    // \"entitymove\",\r\n\r\n    /**\r\n     * Triggered when collection entities begin draw.\r\n     * @event EntityCollection#draw\r\n     */\r\n    \"draw\",\r\n\r\n    /**\r\n     * Triggered after collection has drawn.\r\n     * @event EntityCollection#drawend\r\n     */\r\n    \"drawend\",\r\n\r\n    /**\r\n     * Triggered when added to the render node.\r\n     * @event EntityCollection#add\r\n     */\r\n    \"add\",\r\n\r\n    /**\r\n     * Triggered when removed from the render node.\r\n     * @event EntityCollection#remove\r\n     */\r\n    \"remove\",\r\n\r\n    /**\r\n     * Triggered when new entity added to the collection.\r\n     * @event EntityCollection#entityadd\r\n     */\r\n    \"entityadd\",\r\n\r\n    /**\r\n     * Triggered when entity removes from the collection.\r\n     * @event EntityCollection#entityremove\r\n     */\r\n    \"entityremove\",\r\n\r\n    /**\r\n     * Triggered when visibility changes.\r\n     * @event EntityCollection#visibilitychange\r\n     */\r\n    \"visibilitychange\",\r\n\r\n    /**\r\n     * Triggered when mouse moves over the entity.\r\n     * @event EntityCollection#mousemove\r\n     */\r\n    \"mousemove\",\r\n\r\n    /**\r\n     * Triggered when mouse has entered over the entity.\r\n     * @event EntityCollection#mouseenter\r\n     */\r\n    \"mouseenter\",\r\n\r\n    /**\r\n     * Triggered when mouse leaves the entity.\r\n     * @event EntityCollection#mouseleave\r\n     */\r\n    \"mouseleave\",\r\n\r\n    /**\r\n     * Mouse left button clicked.\r\n     * @event EntityCollection#lclick\r\n     */\r\n    \"lclick\",\r\n\r\n    /**\r\n     * Mouse right button clicked.\r\n     * @event EntityCollection#rclick\r\n     */\r\n    \"rclick\",\r\n\r\n    /**\r\n     * Mouse right button clicked.\r\n     * @event EntityCollection#mclick\r\n     */\r\n    \"mclick\",\r\n\r\n    /**\r\n     * Mouse left button double click.\r\n     * @event EntityCollection#ldblclick\r\n     */\r\n    \"ldblclick\",\r\n\r\n    /**\r\n     * Mouse right button double click.\r\n     * @event EntityCollection#rdblclick\r\n     */\r\n    \"rdblclick\",\r\n\r\n    /**\r\n     * Mouse middle button double click.\r\n     * @event EntityCollection#mdblclick\r\n     */\r\n    \"mdblclick\",\r\n\r\n    /**\r\n     * Mouse left button up(stop pressing).\r\n     * @event EntityCollection#lup\r\n     */\r\n    \"lup\",\r\n\r\n    /**\r\n     * Mouse right button up(stop pressing).\r\n     * @event EntityCollection#rup\r\n     */\r\n    \"rup\",\r\n\r\n    /**\r\n     * Mouse middle button up(stop pressing).\r\n     * @event EntityCollection#mup\r\n     */\r\n    \"mup\",\r\n\r\n    /**\r\n     * Mouse left button is just pressed down(start pressing).\r\n     * @event EntityCollection#ldown\r\n     */\r\n    \"ldown\",\r\n\r\n    /**\r\n     * Mouse right button is just pressed down(start pressing).\r\n     * @event EntityCollection#rdown\r\n     */\r\n    \"rdown\",\r\n\r\n    /**\r\n     * Mouse middle button is just pressed down(start pressing).\r\n     * @event EntityCollection#mdown\r\n     */\r\n    \"mdown\",\r\n\r\n    /**\r\n     * Mouse left button is pressing.\r\n     * @event EntityCollection#lhold\r\n     */\r\n    \"lhold\",\r\n\r\n    /**\r\n     * Mouse right button is pressing.\r\n     * @event EntityCollection#rhold\r\n     */\r\n    \"rhold\",\r\n\r\n    /**\r\n     * Mouse middle button is pressing.\r\n     * @event EntityCollection#mhold\r\n     */\r\n    \"mhold\",\r\n\r\n    /**\r\n     * Mouse wheel is rotated.\r\n     * @event EntityCollection#mousewheel\r\n     */\r\n    \"mousewheel\",\r\n\r\n    /**\r\n     * Triggered when touch moves over the entity.\r\n     * @event EntityCollection#touchmove\r\n     */\r\n    \"touchmove\",\r\n\r\n    /**\r\n     * Triggered when entity begins to touch.\r\n     * @event EntityCollection#touchstart\r\n     */\r\n    \"touchstart\",\r\n\r\n    /**\r\n     * Triggered when entity ends touching.\r\n     * @event EntityCollection#touchend\r\n     */\r\n    \"touchend\",\r\n\r\n    /**\r\n     * Triggered entity double touch.\r\n     * @event EntityCollection#doubletouch\r\n     */\r\n    \"doubletouch\",\r\n\r\n    /**\r\n     * Triggered when touching leaves entity.\r\n     * @event EntityCollection#touchleave\r\n     */\r\n    \"touchleave\",\r\n\r\n    /**\r\n     * Triggered when touch enters over the entity.\r\n     * @event EntityCollection#touchenter\r\n     */\r\n    \"touchenter\"\r\n];\r\n\r\nexport {EntityCollection};\r\n","/**\r\n * @module og/math/coder\r\n */\r\n\r\nimport * as math from \"../math\";\r\nimport {Vec4} from \"./Vec4\";\r\nimport {Vec2} from \"./Vec2\";\r\n\r\nimport type {NumberArray4} from \"./Vec4\";\r\nimport type {NumberArray3} from \"./Vec3\";\r\nimport type {NumberArray2} from \"./Vec2\";\r\n\r\n/**\r\n * Encode 32 bit float value to the RGBA vector.\r\n * @function\r\n * @param {number} v - 32 bit float value.\r\n * @returns {Vec4} - RGBA vector value.\r\n */\r\nexport function encodeFloatToRGBA(v: number): Vec4 {\r\n    let enc = new Vec4((1.0 * v) % 1, (255.0 * v) % 1, (65025.0 * v) % 1, (160581375.0 * v) % 1);\r\n    let yzww = new Vec4(enc.y / 255, enc.z / 255, enc.w / 255, 0);\r\n    return enc.subA(yzww);\r\n}\r\n\r\n/**\r\n * Decode RGBA vector to 32 bit float value.\r\n * @function\r\n * @param {Vec4} rgba - RGBA encoded 32 bit float value.\r\n * @returns {number} - Float value.\r\n */\r\nexport function decodeFloatFromRGBA(rgba: Vec4): number {\r\n    let s = 1.0 - math.step(128.0, rgba.x) * 2.0;\r\n    let e = 2.0 * math.mod(rgba.x, 128.0) + math.step(128.0, rgba.y) - 127.0;\r\n    let m = math.mod(rgba.y, 128.0) * 65536.0 + rgba.z * 256.0 + rgba.w + 8388608.0;\r\n    return s * math.exp2(e) * (m * 1.1920928955078125e-7);\r\n}\r\n\r\n/**\r\n * Decode RGBA vector to 32 bit float value.\r\n * @function\r\n * @param {NumberArray4 | NumberArray3} arr - RGBA encoded 32 bit float value.\r\n * @param {boolean} [use32=false] Use 32 bit result\r\n * @returns {number} - Float value.\r\n */\r\nexport function decodeFloatFromRGBAArr(arr: NumberArray4 | NumberArray3 | Uint8Array, use32: boolean = false): number {\r\n    let s = 1.0 - math.step(128.0, arr[0]) * 2.0;\r\n    let e = 2.0 * math.mod(arr[0], 128.0) + math.step(128.0, arr[1]) - 127.0;\r\n    let m = math.mod(arr[1], 128.0) * 65536.0 + arr[2] * 256.0 + (use32 ? arr[3] || 0.0 : 0.0) + 8388608.0;\r\n    return s * math.exp2(e) * (m * 1.1920928955078125e-7);\r\n}\r\n\r\n/**\r\n * Separate 64 bit value to two 32-bit float values.\r\n * @function\r\n * @param {number} value - Double type value.\r\n * @returns {Float32Array} Encoded array. (exactly 2 entries)\r\n */\r\nexport function doubleToTwoFloats(value: number): Float32Array {\r\n    let high: number, low: number;\r\n    if (value >= 0.0) {\r\n        let doubleHigh = Math.floor(value / 65536.0) * 65536.0;\r\n        high = Math.fround(doubleHigh);\r\n        low = Math.fround(value - doubleHigh);\r\n    } else {\r\n        let doubleHigh = Math.floor(-value / 65536.0) * 65536.0;\r\n        high = Math.fround(-doubleHigh);\r\n        low = Math.fround(value + doubleHigh);\r\n    }\r\n    return new Float32Array([high, low]);\r\n}\r\n\r\n/**\r\n * Separate 64 bit value to two 32-bit float values.\r\n * @function\r\n * @param {number} value - Double type value.\r\n * @param {NumberArray2 | Float32Array} - Reference out array.\r\n * @returns {NumberArray2 | Float32Array} Encoded array. (exactly 2 entries)\r\n */\r\nexport function doubleToTwoFloats2(value: number, highLowArr: NumberArray2 | Float32Array): NumberArray2 | Float32Array {\r\n    if (value >= 0.0) {\r\n        let doubleHigh = Math.floor(value / 65536.0) * 65536.0;\r\n        highLowArr[0] = Math.fround(doubleHigh);\r\n        highLowArr[1] = Math.fround(value - doubleHigh);\r\n    } else {\r\n        let doubleHigh = Math.floor(-value / 65536.0) * 65536.0;\r\n        highLowArr[0] = Math.fround(-doubleHigh);\r\n        highLowArr[1] = Math.fround(value + doubleHigh);\r\n    }\r\n    return highLowArr;\r\n}\r\n\r\n/**\r\n * Separate 64 bit value to two 32-bit float values.\r\n * @function\r\n * @param {number} value - Double type value.\r\n * @param {Vec2} highLowVec - Reference out vector object.\r\n * @returns {Vec2} Encoded array. (exactly 2 entries)\r\n */\r\nexport function doubleToTwoFloatsV2(value: number, highLowVec: Vec2): Vec2 {\r\n    if (value >= 0.0) {\r\n        let doubleHigh = Math.floor(value / 65536.0) * 65536.0;\r\n        highLowVec.x = Math.fround(doubleHigh);\r\n        highLowVec.y = Math.fround(value - doubleHigh);\r\n    } else {\r\n        let doubleHigh = Math.floor(-value / 65536.0) * 65536.0;\r\n        highLowVec.x = Math.fround(-doubleHigh);\r\n        highLowVec.y = Math.fround(value + doubleHigh);\r\n    }\r\n    return highLowVec;\r\n}\r\n","// @ts-nocheck\r\n\r\n/* eslint-disable no-unused-vars */\r\n/* eslint-disable curly */\r\n/* eslint-disable operator-linebreak */\r\n/* eslint-disable no-mixed-operators */\r\n\r\n/**\r\n * @module og/utils/earcut\r\n */\r\n\r\n'use strict';\r\n\r\n// ISC License\r\n//\r\n// Copyright (c) 2016, Mapbox\r\n//\r\n// Permission to use, copy, modify, and/or distribute this software for any purpose\r\n// with or without fee is hereby granted, provided that the above copyright notice\r\n// and this permission notice appear in all copies.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\n// REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\r\n// FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\n// INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n// OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\r\n// TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\r\n// THIS SOFTWARE.\r\n//\r\n//https://github.com/mapbox/earcut\r\nfunction earcut(data, holeIndices, dim) {\r\n\r\n    dim = dim || 2;\r\n\r\n    var hasHoles = holeIndices && holeIndices.length,\r\n        outerLen = hasHoles ? holeIndices[0] * dim : data.length,\r\n        outerNode = linkedList(data, 0, outerLen, dim, true),\r\n        triangles = [];\r\n\r\n    if (!outerNode) return triangles;\r\n\r\n    var minX, minY, maxX, maxY, x, y, size;\r\n\r\n    if (hasHoles) outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\r\n\r\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\r\n    if (data.length > 80 * dim) {\r\n        minX = maxX = data[0];\r\n        minY = maxY = data[1];\r\n\r\n        for (let i = dim; i < outerLen; i += dim) {\r\n            x = data[i];\r\n            y = data[i + 1];\r\n            if (x < minX) minX = x;\r\n            if (y < minY) minY = y;\r\n            if (x > maxX) maxX = x;\r\n            if (y > maxY) maxY = y;\r\n        }\r\n\r\n        // minX, minY and size are later used to transform coords into integers for z-order calculation\r\n        size = Math.max(maxX - minX, maxY - minY);\r\n    }\r\n\r\n    earcutLinked(outerNode, triangles, dim, minX, minY, size);\r\n\r\n    return triangles;\r\n}\r\n\r\n// create a circular doubly linked list from polygon points in the specified winding order\r\nfunction linkedList(data, start, end, dim, clockwise) {\r\n    var i, last;\r\n\r\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\r\n        for (i = start; i < end; i += dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    } else {\r\n        for (i = end - dim; i >= start; i -= dim) last = insertNode(i, data[i], data[i + 1], last);\r\n    }\r\n\r\n    if (last && equals(last, last.next)) {\r\n        removeNode(last);\r\n        last = last.next;\r\n    }\r\n\r\n    return last;\r\n}\r\n\r\n// eliminate colinear or duplicate points\r\nfunction filterPoints(start, end) {\r\n    if (!start) return start;\r\n    if (!end) end = start;\r\n\r\n    var p = start,\r\n        again;\r\n    do {\r\n        again = false;\r\n\r\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\r\n            removeNode(p);\r\n            p = end = p.prev;\r\n            if (p === p.next) return null;\r\n            again = true;\r\n\r\n        } else {\r\n            p = p.next;\r\n        }\r\n    } while (again || p !== end);\r\n\r\n    return end;\r\n}\r\n\r\n// main ear slicing loop which triangulates a polygon (given as a linked list)\r\nfunction earcutLinked(ear, triangles, dim, minX, minY, size, pass) {\r\n    if (!ear) return;\r\n\r\n    // interlink polygon nodes in z-order\r\n    if (!pass && size) indexCurve(ear, minX, minY, size);\r\n\r\n    var stop = ear,\r\n        prev, next;\r\n\r\n    // iterate through ears, slicing them one by one\r\n    while (ear.prev !== ear.next) {\r\n        prev = ear.prev;\r\n        next = ear.next;\r\n\r\n        if (size ? isEarHashed(ear, minX, minY, size) : isEar(ear)) {\r\n            // cut off the triangle\r\n            triangles.push(prev.i / dim);\r\n            triangles.push(ear.i / dim);\r\n            triangles.push(next.i / dim);\r\n\r\n            removeNode(ear);\r\n\r\n            // skipping the next vertice leads to less sliver triangles\r\n            ear = next.next;\r\n            stop = next.next;\r\n\r\n            continue;\r\n        }\r\n\r\n        ear = next;\r\n\r\n        // if we looped through the whole remaining polygon and can't find any more ears\r\n        if (ear === stop) {\r\n            // try filtering points and slicing again\r\n            if (!pass) {\r\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, size, 1);\r\n\r\n                // if this didn't work, try curing all small self-intersections locally\r\n            } else if (pass === 1) {\r\n                ear = cureLocalIntersections(ear, triangles, dim);\r\n                earcutLinked(ear, triangles, dim, minX, minY, size, 2);\r\n\r\n                // as a last resort, try splitting the remaining polygon into two\r\n            } else if (pass === 2) {\r\n                splitEarcut(ear, triangles, dim, minX, minY, size);\r\n            }\r\n\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// check whether a polygon node forms a valid ear with adjacent nodes\r\nfunction isEar(ear) {\r\n    var a = ear.prev,\r\n        b = ear,\r\n        c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // now make sure we don't have other points inside the potential ear\r\n    var p = ear.next.next;\r\n\r\n    while (p !== ear.prev) {\r\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.next;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction isEarHashed(ear, minX, minY, size) {\r\n    var a = ear.prev,\r\n        b = ear,\r\n        c = ear.next;\r\n\r\n    if (area(a, b, c) >= 0) return false; // reflex, can't be an ear\r\n\r\n    // triangle bbox; min & max are calculated like this for speed\r\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x),\r\n        minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y),\r\n        maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x),\r\n        maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\r\n\r\n    // z-order range for the current triangle bbox;\r\n    var minZ = zOrder(minTX, minTY, minX, minY, size),\r\n        maxZ = zOrder(maxTX, maxTY, minX, minY, size);\r\n\r\n    // first look for points inside the triangle in increasing z-order\r\n    var p = ear.nextZ;\r\n\r\n    while (p && p.z <= maxZ) {\r\n        if (p !== ear.prev && p !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.nextZ;\r\n    }\r\n\r\n    // then look for points in decreasing z-order\r\n    p = ear.prevZ;\r\n\r\n    while (p && p.z >= minZ) {\r\n        if (p !== ear.prev && p !== ear.next &&\r\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\r\n            area(p.prev, p, p.next) >= 0) return false;\r\n        p = p.prevZ;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n// go through all polygon nodes and cure small local self-intersections\r\nfunction cureLocalIntersections(start, triangles, dim) {\r\n    var p = start;\r\n    do {\r\n        var a = p.prev,\r\n            b = p.next.next;\r\n\r\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\r\n\r\n            triangles.push(a.i / dim);\r\n            triangles.push(p.i / dim);\r\n            triangles.push(b.i / dim);\r\n\r\n            // remove two nodes involved\r\n            removeNode(p);\r\n            removeNode(p.next);\r\n\r\n            p = start = b;\r\n        }\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return p;\r\n}\r\n\r\n// try splitting polygon into two and triangulate them independently\r\nfunction splitEarcut(start, triangles, dim, minX, minY, size) {\r\n    // look for a valid diagonal that divides the polygon into two\r\n    var a = start;\r\n    do {\r\n        var b = a.next.next;\r\n        while (b !== a.prev) {\r\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\r\n                // split the polygon in two by the diagonal\r\n                var c = splitPolygon(a, b);\r\n\r\n                // filter colinear points around the cuts\r\n                a = filterPoints(a, a.next);\r\n                c = filterPoints(c, c.next);\r\n\r\n                // run earcut on each half\r\n                earcutLinked(a, triangles, dim, minX, minY, size);\r\n                earcutLinked(c, triangles, dim, minX, minY, size);\r\n                return;\r\n            }\r\n            b = b.next;\r\n        }\r\n        a = a.next;\r\n    } while (a !== start);\r\n}\r\n\r\n// link every hole into the outer loop, producing a single-ring polygon without holes\r\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\r\n    var queue = [],\r\n        i, len, start, end, list;\r\n\r\n    for (i = 0, len = holeIndices.length; i < len; i++) {\r\n        start = holeIndices[i] * dim;\r\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n        list = linkedList(data, start, end, dim, false);\r\n        if (list === list.next) list.steiner = true;\r\n        queue.push(getLeftmost(list));\r\n    }\r\n\r\n    queue.sort(compareX);\r\n\r\n    // process holes from left to right\r\n    for (i = 0; i < queue.length; i++) {\r\n        eliminateHole(queue[i], outerNode);\r\n        outerNode = filterPoints(outerNode, outerNode.next);\r\n    }\r\n\r\n    return outerNode;\r\n}\r\n\r\nfunction compareX(a, b) {\r\n    return a.x - b.x;\r\n}\r\n\r\n// find a bridge between vertices that connects hole with an outer ring and and link it\r\nfunction eliminateHole(hole, outerNode) {\r\n    outerNode = findHoleBridge(hole, outerNode);\r\n    if (outerNode) {\r\n        var b = splitPolygon(outerNode, hole);\r\n        filterPoints(b, b.next);\r\n    }\r\n}\r\n\r\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\r\nfunction findHoleBridge(hole, outerNode) {\r\n    var p = outerNode,\r\n        hx = hole.x,\r\n        hy = hole.y,\r\n        qx = -Infinity,\r\n        m;\r\n\r\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\r\n    // segment's endpoint with lesser x will be potential connection point\r\n    do {\r\n        if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y) {\r\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\r\n            if (x <= hx && x > qx) {\r\n                qx = x;\r\n                if (x === hx) {\r\n                    if (hy === p.y) return p;\r\n                    if (hy === p.next.y) return p.next;\r\n                }\r\n                m = p.x < p.next.x ? p : p.next;\r\n            }\r\n        }\r\n        p = p.next;\r\n    } while (p !== outerNode);\r\n\r\n    if (!m) return null;\r\n\r\n    if (hx === qx) return m.prev; // hole touches outer segment; pick lower endpoint\r\n\r\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\r\n    // if there are no points found, we have a valid connection;\r\n    // otherwise choose the point of the minimum angle with the ray as connection point\r\n\r\n    var stop = m,\r\n        mx = m.x,\r\n        my = m.y,\r\n        tanMin = Infinity,\r\n        tan;\r\n\r\n    p = m.next;\r\n\r\n    while (p !== stop) {\r\n        if (hx >= p.x && p.x >= mx && hx !== p.x &&\r\n            pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\r\n\r\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\r\n\r\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\r\n                m = p;\r\n                tanMin = tan;\r\n            }\r\n        }\r\n\r\n        p = p.next;\r\n    }\r\n\r\n    return m;\r\n}\r\n\r\n// interlink polygon nodes in z-order\r\nfunction indexCurve(start, minX, minY, size) {\r\n    var p = start;\r\n    do {\r\n        if (p.z === null) p.z = zOrder(p.x, p.y, minX, minY, size);\r\n        p.prevZ = p.prev;\r\n        p.nextZ = p.next;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    p.prevZ.nextZ = null;\r\n    p.prevZ = null;\r\n\r\n    sortLinked(p);\r\n}\r\n\r\n// Simon Tatham's linked list merge sort algorithm\r\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\r\nfunction sortLinked(list) {\r\n    var i, p, q, e, tail, numMerges, pSize, qSize,\r\n        inSize = 1;\r\n\r\n    do {\r\n        p = list;\r\n        list = null;\r\n        tail = null;\r\n        numMerges = 0;\r\n\r\n        while (p) {\r\n            numMerges++;\r\n            q = p;\r\n            pSize = 0;\r\n            for (i = 0; i < inSize; i++) {\r\n                pSize++;\r\n                q = q.nextZ;\r\n                if (!q) break;\r\n            }\r\n            qSize = inSize;\r\n\r\n            while (pSize > 0 || (qSize > 0 && q)) {\r\n\r\n                if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z)) {\r\n                    e = p;\r\n                    p = p.nextZ;\r\n                    pSize--;\r\n                } else {\r\n                    e = q;\r\n                    q = q.nextZ;\r\n                    qSize--;\r\n                }\r\n\r\n                if (tail) tail.nextZ = e;\r\n                else list = e;\r\n\r\n                e.prevZ = tail;\r\n                tail = e;\r\n            }\r\n\r\n            p = q;\r\n        }\r\n\r\n        tail.nextZ = null;\r\n        inSize *= 2;\r\n\r\n    } while (numMerges > 1);\r\n\r\n    return list;\r\n}\r\n\r\n// z-order of a point given coords and size of the data bounding box\r\nfunction zOrder(x, y, minX, minY, size) {\r\n    // coords are transformed into non-negative 15-bit integer range\r\n    x = 32767 * (x - minX) / size;\r\n    y = 32767 * (y - minY) / size;\r\n\r\n    x = (x | (x << 8)) & 0x00FF00FF;\r\n    x = (x | (x << 4)) & 0x0F0F0F0F;\r\n    x = (x | (x << 2)) & 0x33333333;\r\n    x = (x | (x << 1)) & 0x55555555;\r\n\r\n    y = (y | (y << 8)) & 0x00FF00FF;\r\n    y = (y | (y << 4)) & 0x0F0F0F0F;\r\n    y = (y | (y << 2)) & 0x33333333;\r\n    y = (y | (y << 1)) & 0x55555555;\r\n\r\n    return x | (y << 1);\r\n}\r\n\r\n// find the leftmost node of a polygon ring\r\nfunction getLeftmost(start) {\r\n    var p = start,\r\n        leftmost = start;\r\n    do {\r\n        if (p.x < leftmost.x) leftmost = p;\r\n        p = p.next;\r\n    } while (p !== start);\r\n\r\n    return leftmost;\r\n}\r\n\r\n// check if a point lies within a convex triangle\r\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\r\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\r\n        (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\r\n        (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\r\n}\r\n\r\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\r\nfunction isValidDiagonal(a, b) {\r\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\r\n        locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\r\n}\r\n\r\n// signed area of a triangle\r\nfunction area(p, q, r) {\r\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\r\n}\r\n\r\n// check if two points are equal\r\nfunction equals(p1, p2) {\r\n    return p1.x === p2.x && p1.y === p2.y;\r\n}\r\n\r\n// check if two segments intersect\r\nfunction intersects(p1, q1, p2, q2) {\r\n    if ((equals(p1, q1) && equals(p2, q2)) ||\r\n        (equals(p1, q2) && equals(p2, q1))) return true;\r\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\r\n        area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\r\n}\r\n\r\n// check if a polygon diagonal intersects any polygon segments\r\nfunction intersectsPolygon(a, b) {\r\n    var p = a;\r\n    do {\r\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\r\n            intersects(p, p.next, a, b)) return true;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return false;\r\n}\r\n\r\n// check if a polygon diagonal is locally inside the polygon\r\nfunction locallyInside(a, b) {\r\n    return area(a.prev, a, a.next) < 0 ?\r\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\r\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\r\n}\r\n\r\n// check if the middle point of a polygon diagonal is inside the polygon\r\nfunction middleInside(a, b) {\r\n    var p = a,\r\n        inside = false,\r\n        px = (a.x + b.x) / 2,\r\n        py = (a.y + b.y) / 2;\r\n    do {\r\n        if (((p.y > py) !== (p.next.y > py)) && p.next.y !== p.y &&\r\n            (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\r\n            inside = !inside;\r\n        p = p.next;\r\n    } while (p !== a);\r\n\r\n    return inside;\r\n}\r\n\r\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\r\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\r\nfunction splitPolygon(a, b) {\r\n    var a2 = new Node(a.i, a.x, a.y),\r\n        b2 = new Node(b.i, b.x, b.y),\r\n        an = a.next,\r\n        bp = b.prev;\r\n\r\n    a.next = b;\r\n    b.prev = a;\r\n\r\n    a2.next = an;\r\n    an.prev = a2;\r\n\r\n    b2.next = a2;\r\n    a2.prev = b2;\r\n\r\n    bp.next = b2;\r\n    b2.prev = bp;\r\n\r\n    return b2;\r\n}\r\n\r\n// create a node and optionally link it with previous one (in a circular doubly linked list)\r\nfunction insertNode(i, x, y, last) {\r\n    var p = new Node(i, x, y);\r\n\r\n    if (!last) {\r\n        p.prev = p;\r\n        p.next = p;\r\n\r\n    } else {\r\n        p.next = last.next;\r\n        p.prev = last;\r\n        last.next.prev = p;\r\n        last.next = p;\r\n    }\r\n    return p;\r\n}\r\n\r\nfunction removeNode(p) {\r\n    p.next.prev = p.prev;\r\n    p.prev.next = p.next;\r\n\r\n    if (p.prevZ) p.prevZ.nextZ = p.nextZ;\r\n    if (p.nextZ) p.nextZ.prevZ = p.prevZ;\r\n}\r\n\r\nfunction Node(i, x, y) {\r\n    // vertice index in coordinates array\r\n    this.i = i;\r\n\r\n    // vertex coordinates\r\n    this.x = x;\r\n    this.y = y;\r\n\r\n    // previous and next vertice nodes in a polygon ring\r\n    this.prev = null;\r\n    this.next = null;\r\n\r\n    // z-order curve value\r\n    this.z = null;\r\n\r\n    // previous and next nodes in z-order\r\n    this.prevZ = null;\r\n    this.nextZ = null;\r\n\r\n    // indicates whether this is a steiner point\r\n    this.steiner = false;\r\n}\r\n\r\n// return a percentage difference between the polygon area and its triangulation area;\r\n// used to verify correctness of triangulation\r\nfunction deviation(data, holeIndices, dim, triangles) {\r\n    var hasHoles = holeIndices && holeIndices.length;\r\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\r\n\r\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\r\n    if (hasHoles) {\r\n        for (let i = 0, len = holeIndices.length; i < len; i++) {\r\n            var start = holeIndices[i] * dim;\r\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\r\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\r\n        }\r\n    }\r\n\r\n    var trianglesArea = 0;\r\n    for (let i = 0; i < triangles.length; i += 3) {\r\n        var a = triangles[i] * dim;\r\n        var b = triangles[i + 1] * dim;\r\n        var c = triangles[i + 2] * dim;\r\n        trianglesArea += Math.abs(\r\n            (data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\r\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\r\n    }\r\n\r\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\r\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\r\n}\r\n\r\nfunction signedArea(data, start, end, dim) {\r\n    var sum = 0;\r\n    for (let i = start, j = end - dim; i < end; i += dim) {\r\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\r\n        j = i;\r\n    }\r\n    return sum;\r\n}\r\n\r\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\r\nfunction flatten(data) {\r\n    var dim = data[0][0].length,\r\n        result = { vertices: [], holes: [], dimensions: dim },\r\n        holeIndex = 0;\r\n\r\n    for (let i = 0; i < data.length; i++) {\r\n        for (let j = 0; j < data[i].length; j++) {\r\n            for (let d = 0; d < dim; d++) result.vertices.push(data[i][j][d]);\r\n        }\r\n        if (i > 0) {\r\n            holeIndex += data[i - 1].length;\r\n            result.holes.push(holeIndex);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nexport { earcut, flatten };\r\n","import * as mercator from \"../mercator\";\r\nimport * as quadTree from \"../quadTree/quadTree\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\nimport {doubleToTwoFloatsV2} from \"../math/coder\";\r\nimport {Vector} from \"../layer/Vector\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport type {\r\n    CoordinatesType,\r\n    Geometry,\r\n    ILineStringCoordinates,\r\n    IMultiLineStringCoordinates,\r\n    IMultiPolygonCoordinates,\r\n    IPolygonCoordinates\r\n} from \"./Geometry\";\r\n\r\nimport {GeometryTypeEnum} from \"./Geometry\";\r\n\r\nimport {earcut, flatten} from \"../utils/earcut\";\r\n\r\nconst POLYVERTICES_BUFFER = 0;\r\nconst POLYINDEXES_BUFFER = 1;\r\nconst POLYCOLORS_BUFFER = 2;\r\nconst LINEVERTICES_BUFFER = 3;\r\nconst LINEINDEXES_BUFFER = 4;\r\nconst LINEORDERS_BUFFER = 5;\r\nconst LINECOLORS_BUFFER = 6;\r\nconst LINETHICKNESS_BUFFER = 7;\r\nconst LINESTROKES_BUFFER = 8;\r\nconst LINESTROKECOLORS_BUFFER = 9;\r\nconst POLYPICKINGCOLORS_BUFFER = 10;\r\nconst LINEPICKINGCOLORS_BUFFER = 11;\r\n\r\nfunction doubleToTwoFloats(v: NumberArray2, high: Vec2, low: Vec2) {\r\n    let x = v[0],\r\n        y = v[1];\r\n\r\n    if (x >= 0.0) {\r\n        let doubleHigh = Math.floor(x / 65536.0) * 65536.0;\r\n        high.x = Math.fround(doubleHigh);\r\n        low.x = Math.fround(x - doubleHigh);\r\n    } else {\r\n        let doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\r\n        high.x = Math.fround(-doubleHigh);\r\n        low.x = Math.fround(x + doubleHigh);\r\n    }\r\n\r\n    if (y >= 0.0) {\r\n        let doubleHigh = Math.floor(y / 65536.0) * 65536.0;\r\n        high.y = Math.fround(doubleHigh);\r\n        low.y = Math.fround(y - doubleHigh);\r\n    } else {\r\n        let doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\r\n        high.y = Math.fround(-doubleHigh);\r\n        low.y = Math.fround(y + doubleHigh);\r\n    }\r\n}\r\n\r\nlet tempHigh = new Vec2(),\r\n    tempLow = new Vec2(),\r\n    tempHighLow = new Vec2();\r\n\r\nclass GeometryHandler {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    protected _layer: Vector;\r\n\r\n    protected _handler: Handler | null;\r\n\r\n    protected _geometries: Geometry[];\r\n\r\n    protected _updatedGeometryArr: Geometry[];\r\n    protected _updatedGeometry: Record<number, boolean>;\r\n\r\n    protected _removeGeometryExtentArr: Extent[];\r\n    protected _removeGeometryExtents: Record<number, boolean>;\r\n\r\n    // Polygon arrays\r\n    protected _polyVerticesHighMerc: number[];\r\n    protected _polyVerticesLowMerc: number[];\r\n    protected _polyColors: number[];\r\n    protected _polyPickingColors: number[];\r\n    protected _polyIndexes: number[];\r\n\r\n    // Line arrays\r\n    protected _lineVerticesHighMerc: number[];\r\n    protected _lineVerticesLowMerc: number[];\r\n    protected _lineOrders: number[];\r\n    protected _lineIndexes: number[];\r\n    protected _lineColors: number[];\r\n    protected _linePickingColors: number[];\r\n    protected _lineThickness: number[];\r\n    protected _lineStrokes: number[];\r\n    protected _lineStrokeColors: number[];\r\n\r\n    // Buffers\r\n    public _polyVerticesHighBufferMerc: WebGLBufferExt | null;\r\n    public _polyVerticesLowBufferMerc: WebGLBufferExt | null;\r\n    public _polyColorsBuffer: WebGLBufferExt | null;\r\n    public _polyPickingColorsBuffer: WebGLBufferExt | null;\r\n    public _polyIndexesBuffer: WebGLBufferExt | null;\r\n\r\n    public _lineVerticesHighBufferMerc: WebGLBufferExt | null;\r\n    public _lineVerticesLowBufferMerc: WebGLBufferExt | null;\r\n    public _lineColorsBuffer: WebGLBufferExt | null;\r\n    public _linePickingColorsBuffer: WebGLBufferExt | null;\r\n    public _lineThicknessBuffer: WebGLBufferExt | null;\r\n    public _lineStrokesBuffer: WebGLBufferExt | null;\r\n    public _lineStrokeColorsBuffer: WebGLBufferExt | null;\r\n    public _lineOrdersBuffer: WebGLBufferExt | null;\r\n    public _lineIndexesBuffer: WebGLBufferExt | null;\r\n\r\n    protected _buffersUpdateCallbacks: Function[];\r\n\r\n    protected _changedBuffers: boolean[];\r\n\r\n    constructor(layer: Vector) {\r\n        this.__id = GeometryHandler.__counter__++;\r\n\r\n        this._layer = layer;\r\n\r\n        this._handler = null;\r\n\r\n        this._geometries = [];\r\n\r\n        this._updatedGeometryArr = [];\r\n        this._updatedGeometry = {};\r\n\r\n        this._removeGeometryExtentArr = [];\r\n        this._removeGeometryExtents = {};\r\n\r\n        // Polygon arrays\r\n        this._polyVerticesHighMerc = [];\r\n        this._polyVerticesLowMerc = [];\r\n        this._polyColors = [];\r\n        this._polyPickingColors = [];\r\n        this._polyIndexes = [];\r\n\r\n        // Line arrays\r\n        this._lineVerticesHighMerc = [];\r\n        this._lineVerticesLowMerc = [];\r\n        this._lineOrders = [];\r\n        this._lineIndexes = [];\r\n        this._lineColors = [];\r\n        this._linePickingColors = [];\r\n        this._lineThickness = [];\r\n        this._lineStrokes = [];\r\n        this._lineStrokeColors = [];\r\n\r\n        // Buffers\r\n        this._polyVerticesHighBufferMerc = null;\r\n        this._polyVerticesLowBufferMerc = null;\r\n        this._polyColorsBuffer = null;\r\n        this._polyPickingColorsBuffer = null;\r\n        this._polyIndexesBuffer = null;\r\n\r\n        this._lineVerticesHighBufferMerc = null;\r\n        this._lineVerticesLowBufferMerc = null;\r\n        this._lineColorsBuffer = null;\r\n        this._linePickingColorsBuffer = null;\r\n        this._lineThicknessBuffer = null;\r\n        this._lineStrokesBuffer = null;\r\n        this._lineStrokeColorsBuffer = null;\r\n        this._lineOrdersBuffer = null;\r\n        this._lineIndexesBuffer = null;\r\n\r\n        this._buffersUpdateCallbacks = [];\r\n        this._buffersUpdateCallbacks[POLYVERTICES_BUFFER] = this.createPolyVerticesBuffer;\r\n        this._buffersUpdateCallbacks[POLYINDEXES_BUFFER] = this.createPolyIndexesBuffer;\r\n        this._buffersUpdateCallbacks[POLYCOLORS_BUFFER] = this.createPolyColorsBuffer;\r\n        this._buffersUpdateCallbacks[LINEVERTICES_BUFFER] = this.createLineVerticesBuffer;\r\n        this._buffersUpdateCallbacks[LINEINDEXES_BUFFER] = this.createLineIndexesBuffer;\r\n        this._buffersUpdateCallbacks[LINEORDERS_BUFFER] = this.createLineOrdersBuffer;\r\n        this._buffersUpdateCallbacks[LINECOLORS_BUFFER] = this.createLineColorsBuffer;\r\n        this._buffersUpdateCallbacks[LINETHICKNESS_BUFFER] = this.createLineThicknessBuffer;\r\n        this._buffersUpdateCallbacks[LINESTROKES_BUFFER] = this.createLineStrokesBuffer;\r\n        this._buffersUpdateCallbacks[LINESTROKECOLORS_BUFFER] = this.createLineStrokeColorsBuffer;\r\n        this._buffersUpdateCallbacks[POLYPICKINGCOLORS_BUFFER] = this.createPolyPickingColorsBuffer;\r\n        this._buffersUpdateCallbacks[LINEPICKINGCOLORS_BUFFER] = this.createLinePickingColorsBuffer;\r\n\r\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\r\n    }\r\n\r\n    static appendLineData(\r\n        pathArr: CoordinatesType[][],\r\n        isClosed: boolean,\r\n        color: Vec4,\r\n        pickingColor: Vec3,\r\n        thickness: number,\r\n        strokeColor: Vec4,\r\n        strokeSize: number,\r\n        outVerticesHigh: number[],\r\n        outVerticesLow: number[],\r\n        outOrders: number[],\r\n        outIndexes: number[],\r\n        outColors: number[],\r\n        outPickingColors: number[],\r\n        outThickness: number[],\r\n        outStrokeColors: number[],\r\n        outStrokes: number[],\r\n        outVerticesHigh2: number[],\r\n        outVerticesLow2: number[]\r\n    ) {\r\n        var index = 0;\r\n\r\n        if (outIndexes.length > 0) {\r\n            index = outIndexes[outIndexes.length - 5] + 9;\r\n            outIndexes.push(index, index);\r\n        } else {\r\n            outIndexes.push(0, 0);\r\n        }\r\n\r\n        var t = thickness,\r\n            c = [color.x, color.y, color.z, color.w],\r\n            s = strokeSize,\r\n            sc = [strokeColor.x, strokeColor.y, strokeColor.z, strokeColor.w],\r\n            p = [pickingColor.x, pickingColor.y, pickingColor.z, 1.0];\r\n\r\n        for (let j = 0; j < pathArr.length; j++) {\r\n            var path = pathArr[j];\r\n\r\n            if (path.length === 0) {\r\n                continue;\r\n            }\r\n\r\n            let startIndex = index;\r\n            let last: CoordinatesType;\r\n            if (isClosed) {\r\n                last = path[path.length - 1];\r\n            } else {\r\n                let p0 = path[0],\r\n                    p1 = path[1];\r\n\r\n                if (!p1) {\r\n                    p1 = p0;\r\n                }\r\n\r\n                last = [p0[0] + p0[0] - p1[0], p0[1] + p0[1] - p1[1]];\r\n            }\r\n\r\n            doubleToTwoFloats(last as NumberArray2, tempHigh, tempLow);\r\n\r\n            outVerticesHigh.push(\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y\r\n            );\r\n            outVerticesLow.push(\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y\r\n            );\r\n\r\n            outVerticesHigh2.push(\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y\r\n            );\r\n            outVerticesLow2.push(\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y\r\n            );\r\n\r\n            outOrders.push(1, -1, 2, -2);\r\n\r\n            outThickness.push(t, t, t, t);\r\n            outStrokes.push(s, s, s, s);\r\n            outColors.push(\r\n                c[0], c[1], c[2], c[3],\r\n                c[0], c[1], c[2], c[3],\r\n                c[0], c[1], c[2], c[3],\r\n                c[0], c[1], c[2], c[3]\r\n            );\r\n            outStrokeColors.push(\r\n                sc[0], sc[1], sc[2], sc[3],\r\n                sc[0], sc[1], sc[2], sc[3],\r\n                sc[0], sc[1], sc[2], sc[3],\r\n                sc[0], sc[1], sc[2], sc[3]\r\n            );\r\n            outPickingColors.push(\r\n                p[0], p[1], p[2], p[3],\r\n                p[0], p[1], p[2], p[3],\r\n                p[0], p[1], p[2], p[3],\r\n                p[0], p[1], p[2], p[3]\r\n            );\r\n\r\n            for (let i = 0; i < path.length; i++) {\r\n                let cur = path[i];\r\n\r\n                doubleToTwoFloats(cur as NumberArray2, tempHigh, tempLow);\r\n\r\n                outVerticesHigh.push(\r\n                    tempHigh.x, tempHigh.y,\r\n                    tempHigh.x, tempHigh.y,\r\n                    tempHigh.x, tempHigh.y,\r\n                    tempHigh.x, tempHigh.y\r\n                );\r\n                outVerticesLow.push(\r\n                    tempLow.x, tempLow.y,\r\n                    tempLow.x, tempLow.y,\r\n                    tempLow.x, tempLow.y,\r\n                    tempLow.x, tempLow.y\r\n                );\r\n\r\n                outVerticesHigh2.push(\r\n                    tempHigh.x, tempHigh.y,\r\n                    tempHigh.x, tempHigh.y,\r\n                    tempHigh.x, tempHigh.y,\r\n                    tempHigh.x, tempHigh.y\r\n                );\r\n                outVerticesLow2.push(\r\n                    tempLow.x, tempLow.y,\r\n                    tempLow.x, tempLow.y,\r\n                    tempLow.x, tempLow.y,\r\n                    tempLow.x, tempLow.y\r\n                );\r\n\r\n                outOrders.push(1, -1, 2, -2);\r\n                outThickness.push(t, t, t, t);\r\n                outStrokes.push(s, s, s, s);\r\n                outColors.push(\r\n                    c[0], c[1], c[2], c[3],\r\n                    c[0], c[1], c[2], c[3],\r\n                    c[0], c[1], c[2], c[3],\r\n                    c[0], c[1], c[2], c[3]\r\n                );\r\n                outStrokeColors.push(\r\n                    sc[0], sc[1], sc[2], sc[3],\r\n                    sc[0], sc[1], sc[2], sc[3],\r\n                    sc[0], sc[1], sc[2], sc[3],\r\n                    sc[0], sc[1], sc[2], sc[3]\r\n                );\r\n                outPickingColors.push(\r\n                    p[0], p[1], p[2], p[3],\r\n                    p[0], p[1], p[2], p[3],\r\n                    p[0], p[1], p[2], p[3],\r\n                    p[0], p[1], p[2], p[3]\r\n                );\r\n                outIndexes.push(index++, index++, index++, index++);\r\n            }\r\n\r\n            let first: CoordinatesType;\r\n            if (isClosed) {\r\n                first = path[0];\r\n                outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\r\n            } else {\r\n                let p0 = path[path.length - 1],\r\n                    p1 = path[path.length - 2];\r\n\r\n                if (!p1) {\r\n                    p1 = p0;\r\n                }\r\n\r\n                first = [p0[0] + p0[0] - p1[0], p0[1] + p0[1] - p1[1]];\r\n                outIndexes.push(index - 1, index - 1, index - 1, index - 1);\r\n            }\r\n\r\n            doubleToTwoFloats(first as NumberArray2, tempHigh, tempLow);\r\n\r\n            outVerticesHigh.push(\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y\r\n            );\r\n            outVerticesLow.push(\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y\r\n            );\r\n\r\n            outVerticesHigh2.push(\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y,\r\n                tempHigh.x, tempHigh.y\r\n            );\r\n            outVerticesLow2.push(\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y,\r\n                tempLow.x, tempLow.y\r\n            );\r\n\r\n            outOrders.push(1, -1, 2, -2);\r\n            outThickness.push(t, t, t, t);\r\n            outStrokes.push(s, s, s, s);\r\n            outColors.push(\r\n                c[0], c[1], c[2], c[3],\r\n                c[0], c[1], c[2], c[3],\r\n                c[0], c[1], c[2], c[3],\r\n                c[0], c[1], c[2], c[3]\r\n            );\r\n            outStrokeColors.push(\r\n                sc[0], sc[1], sc[2], sc[3],\r\n                sc[0], sc[1], sc[2], sc[3],\r\n                sc[0], sc[1], sc[2], sc[3],\r\n                sc[0], sc[1], sc[2], sc[3]\r\n            );\r\n            outPickingColors.push(\r\n                p[0], p[1], p[2], p[3],\r\n                p[0], p[1], p[2], p[3],\r\n                p[0], p[1], p[2], p[3],\r\n                p[0], p[1], p[2], p[3]\r\n            );\r\n\r\n            if (j < pathArr.length - 1) {\r\n                index += 8;\r\n                outIndexes.push(index, index);\r\n            }\r\n        }\r\n    }\r\n\r\n    public assignHandler(handler: Handler) {\r\n        this._handler = handler;\r\n        this.refresh();\r\n        if (handler.isInitialized()) {\r\n            this.update();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @param {Geometry} geometry - Geometry object.\r\n     */\r\n    public add(geometry: Geometry) {\r\n        //\r\n        // Triangulates polygon and sets geometry data.\r\n        if (geometry._handlerIndex === -1) {\r\n            geometry._handler = this;\r\n            geometry._handlerIndex = this._geometries.length;\r\n\r\n            this._geometries.push(geometry);\r\n\r\n            let pickingColor = geometry._entity!._pickingColor.scaleTo(1 / 255);\r\n\r\n            geometry._polyVerticesHighMerc = [];\r\n            geometry._polyVerticesLowMerc = [];\r\n            geometry._lineVerticesHighMerc = [];\r\n            geometry._lineVerticesLowMerc = [];\r\n\r\n            if ((geometry._coordinates as IPolygonCoordinates)[0].length) {\r\n                if (geometry.type === GeometryTypeEnum.POLYGON) {\r\n                    let coordinates = geometry._coordinates as IPolygonCoordinates;\r\n                    let ci: IPolygonCoordinates = [];\r\n                    for (let j = 0; j < coordinates.length; j++) {\r\n                        ci[j] = [];\r\n                        for (let k = 0; k < coordinates[j].length; k++) {\r\n                            ci[j][k] = [mercator.forward_lon(coordinates[j][k][0]), mercator.forward_lat(coordinates[j][k][1])];\r\n                        }\r\n                    }\r\n\r\n                    let data = flatten(ci);\r\n                    let indexes: number[] = earcut(data.vertices, data.holes, 2);\r\n\r\n                    geometry._polyVerticesHandlerIndex = this._polyVerticesHighMerc.length;\r\n                    geometry._polyIndexesHandlerIndex = this._polyIndexes.length;\r\n\r\n                    for (let i = 0; i < indexes.length; i++) {\r\n                        this._polyIndexes.push(indexes[i] + geometry._polyVerticesHandlerIndex * 0.5);\r\n                    }\r\n\r\n                    let color = geometry._style.fillColor;\r\n\r\n                    let verticesHigh = [],\r\n                        verticesLow = [];\r\n\r\n                    for (let i = 0; i < data.vertices.length * 0.5; i++) {\r\n                        this._polyColors.push(color.x, color.y, color.z, color.w);\r\n                        this._polyPickingColors.push(pickingColor.x, pickingColor.y, pickingColor.z, 1.0);\r\n                    }\r\n\r\n                    for (let i = 0; i < data.vertices.length; i++) {\r\n                        doubleToTwoFloatsV2(data.vertices[i], tempHighLow);\r\n                        verticesHigh[i] = tempHighLow.x;\r\n                        verticesLow[i] = tempHighLow.y;\r\n                    }\r\n\r\n                    geometry._polyVerticesHighMerc = verticesHigh;\r\n                    geometry._polyVerticesLowMerc = verticesLow;\r\n\r\n                    this._polyVerticesHighMerc.push.apply(this._polyVerticesHighMerc, verticesHigh);\r\n                    this._polyVerticesLowMerc.push.apply(this._polyVerticesLowMerc, verticesLow);\r\n\r\n                    geometry._polyVerticesLength = data.vertices.length;\r\n                    geometry._polyIndexesLength = indexes.length;\r\n\r\n                    // Creates polygon stroke data\r\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\r\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\r\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\r\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\r\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\r\n\r\n                    GeometryHandler.appendLineData(\r\n                        ci,\r\n                        true,\r\n                        geometry._style.lineColor,\r\n                        pickingColor,\r\n                        geometry._style.lineWidth,\r\n                        geometry._style.strokeColor,\r\n                        geometry._style.strokeWidth,\r\n                        this._lineVerticesHighMerc,\r\n                        this._lineVerticesLowMerc,\r\n                        this._lineOrders,\r\n                        this._lineIndexes,\r\n                        this._lineColors,\r\n                        this._linePickingColors,\r\n                        this._lineThickness,\r\n                        this._lineStrokeColors,\r\n                        this._lineStrokes,\r\n                        geometry._lineVerticesHighMerc,\r\n                        geometry._lineVerticesLowMerc\r\n                    );\r\n\r\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\r\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\r\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\r\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\r\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\r\n\r\n                } else if (geometry.type === GeometryTypeEnum.MULTIPOLYGON) {\r\n\r\n                    let coordinates = geometry._coordinates as IMultiPolygonCoordinates;\r\n                    let vertices: number[] = [],\r\n                        indexes: number[] = [];\r\n\r\n                    // Creates polygon stroke data\r\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\r\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\r\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\r\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\r\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\r\n\r\n                    for (let i = 0; i < coordinates.length; i++) {\r\n                        let cci: CoordinatesType[][] = coordinates[i];\r\n                        let ci: CoordinatesType[][] = [];\r\n                        for (let j = 0; j < cci.length; j++) {\r\n                            ci[j] = [];\r\n                            for (let k = 0; k < coordinates[i][j].length; k++) {\r\n                                ci[j][k] = [mercator.forward_lon(cci[j][k][0]), mercator.forward_lat(cci[j][k][1])];\r\n                            }\r\n                        }\r\n                        let data = flatten(ci);\r\n                        let dataIndexes: number[] = earcut(data.vertices, data.holes, 2);\r\n\r\n                        for (let j = 0; j < dataIndexes.length; j++) {\r\n                            indexes.push(dataIndexes[j] + vertices.length * 0.5);\r\n                        }\r\n\r\n                        vertices.push.apply(vertices, data.vertices);\r\n\r\n                        GeometryHandler.appendLineData(\r\n                            ci,\r\n                            true,\r\n                            geometry._style.lineColor,\r\n                            pickingColor,\r\n                            geometry._style.lineWidth,\r\n                            geometry._style.strokeColor,\r\n                            geometry._style.strokeWidth,\r\n                            this._lineVerticesHighMerc,\r\n                            this._lineVerticesLowMerc,\r\n                            this._lineOrders,\r\n                            this._lineIndexes,\r\n                            this._lineColors,\r\n                            this._linePickingColors,\r\n                            this._lineThickness,\r\n                            this._lineStrokeColors,\r\n                            this._lineStrokes,\r\n                            geometry._lineVerticesHighMerc,\r\n                            geometry._lineVerticesLowMerc\r\n                        );\r\n                    }\r\n\r\n                    geometry._polyVerticesHandlerIndex = this._polyVerticesHighMerc.length;\r\n                    geometry._polyIndexesHandlerIndex = this._polyIndexes.length;\r\n\r\n                    for (let i = 0; i < indexes.length; i++) {\r\n                        this._polyIndexes.push(indexes[i] + geometry._polyVerticesHandlerIndex * 0.5);\r\n                    }\r\n\r\n                    let color = geometry._style.fillColor;\r\n\r\n                    let verticesHigh = [],\r\n                        verticesLow = [];\r\n\r\n                    for (let i = 0; i < vertices.length * 0.5; i++) {\r\n                        this._polyColors.push(color.x, color.y, color.z, color.w);\r\n                        this._polyPickingColors.push(\r\n                            pickingColor.x,\r\n                            pickingColor.y,\r\n                            pickingColor.z,\r\n                            1.0\r\n                        );\r\n                    }\r\n\r\n                    for (let i = 0; i < vertices.length; i++) {\r\n                        doubleToTwoFloatsV2(vertices[i], tempHighLow);\r\n                        verticesHigh[i] = tempHighLow.x;\r\n                        verticesLow[i] = tempHighLow.y;\r\n                    }\r\n\r\n                    geometry._polyVerticesHighMerc = verticesHigh;\r\n                    geometry._polyVerticesLowMerc = verticesLow;\r\n\r\n                    this._polyVerticesHighMerc.push.apply(this._polyVerticesHighMerc, verticesHigh);\r\n                    this._polyVerticesLowMerc.push.apply(this._polyVerticesLowMerc, verticesLow);\r\n\r\n                    geometry._polyVerticesLength = vertices.length;\r\n                    geometry._polyIndexesLength = indexes.length;\r\n\r\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\r\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\r\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\r\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\r\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\r\n\r\n                } else if (geometry.type === GeometryTypeEnum.LINESTRING) {\r\n\r\n                    let coordinates: ILineStringCoordinates = geometry._coordinates as ILineStringCoordinates;\r\n                    let ci = new Array(coordinates.length);\r\n                    for (let j = 0; j < coordinates.length; j++) {\r\n                        ci[j] = [mercator.forward_lon(coordinates[j][0]), mercator.forward_lat(coordinates[j][1])];\r\n                    }\r\n\r\n                    // Creates polygon stroke data\r\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\r\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\r\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\r\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\r\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\r\n\r\n                    GeometryHandler.appendLineData(\r\n                        [ci],\r\n                        false,\r\n                        geometry._style.lineColor,\r\n                        pickingColor,\r\n                        geometry._style.lineWidth,\r\n                        geometry._style.strokeColor,\r\n                        geometry._style.strokeWidth,\r\n                        this._lineVerticesHighMerc,\r\n                        this._lineVerticesLowMerc,\r\n                        this._lineOrders,\r\n                        this._lineIndexes,\r\n                        this._lineColors,\r\n                        this._linePickingColors,\r\n                        this._lineThickness,\r\n                        this._lineStrokeColors,\r\n                        this._lineStrokes,\r\n                        geometry._lineVerticesHighMerc,\r\n                        geometry._lineVerticesLowMerc\r\n                    );\r\n\r\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\r\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\r\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\r\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\r\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\r\n\r\n                } else if (geometry.type === GeometryTypeEnum.MULTILINESTRING) {\r\n\r\n                    let coordinates = geometry._coordinates as IMultiLineStringCoordinates;\r\n                    let ci: IMultiLineStringCoordinates = [];\r\n                    for (let j = 0; j < coordinates.length; j++) {\r\n                        ci[j] = [];\r\n                        for (let k = 0; k < coordinates[j].length; k++) {\r\n                            ci[j][k] = [mercator.forward_lon(coordinates[j][k][0]), mercator.forward_lat(coordinates[j][k][1])];\r\n                        }\r\n                    }\r\n\r\n                    // Creates polygon stroke data\r\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\r\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\r\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\r\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\r\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\r\n\r\n                    GeometryHandler.appendLineData(\r\n                        ci,\r\n                        false,\r\n                        geometry._style.lineColor,\r\n                        pickingColor,\r\n                        geometry._style.lineWidth,\r\n                        geometry._style.strokeColor,\r\n                        geometry._style.strokeWidth,\r\n                        this._lineVerticesHighMerc,\r\n                        this._lineVerticesLowMerc,\r\n                        this._lineOrders,\r\n                        this._lineIndexes,\r\n                        this._lineColors,\r\n                        this._linePickingColors,\r\n                        this._lineThickness,\r\n                        this._lineStrokeColors,\r\n                        this._lineStrokes,\r\n                        geometry._lineVerticesHighMerc,\r\n                        geometry._lineVerticesLowMerc\r\n                    );\r\n\r\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\r\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\r\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\r\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\r\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\r\n                }\r\n            }\r\n\r\n            // Refresh visibility\r\n            this.setGeometryVisibility(geometry);\r\n\r\n            !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n            this._updatedGeometry[geometry.__id] = true;\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    public remove(geometry: Geometry) {\r\n\r\n        const index = geometry._handlerIndex;\r\n        if (index !== -1) {\r\n            this._geometries.splice(index, 1);\r\n\r\n            // polygon\r\n            // this._polyVerticesLonLat.splice(geometry._polyVerticesHandlerIndex, geometry._polyVerticesLength);\r\n\r\n            this._polyVerticesHighMerc.splice(geometry._polyVerticesHandlerIndex, geometry._polyVerticesLength);\r\n            this._polyVerticesLowMerc.splice(geometry._polyVerticesHandlerIndex, geometry._polyVerticesLength);\r\n\r\n            this._polyColors.splice(geometry._polyVerticesHandlerIndex * 2, geometry._polyVerticesLength * 2);\r\n            this._polyPickingColors.splice(geometry._polyVerticesHandlerIndex * 2, geometry._polyVerticesLength * 2);\r\n            this._polyIndexes.splice(geometry._polyIndexesHandlerIndex, geometry._polyIndexesLength);\r\n\r\n            let di = geometry._polyVerticesLength * 0.5;\r\n            for (let i = geometry._polyIndexesHandlerIndex; i < this._polyIndexes.length; i++) {\r\n                this._polyIndexes[i] -= di;\r\n            }\r\n\r\n            // line\r\n            // this._lineVerticesLonLat.splice(geometry._lineVerticesHandlerIndex, geometry._lineVerticesLength);\r\n\r\n            this._lineVerticesHighMerc.splice(geometry._lineVerticesHandlerIndex, geometry._lineVerticesLength);\r\n            this._lineVerticesLowMerc.splice(geometry._lineVerticesHandlerIndex, geometry._lineVerticesLength);\r\n\r\n            this._lineOrders.splice(geometry._lineOrdersHandlerIndex, geometry._lineOrdersLength);\r\n            this._lineColors.splice(geometry._lineColorsHandlerIndex, geometry._lineColorsLength);\r\n            this._linePickingColors.splice(geometry._lineColorsHandlerIndex, geometry._lineColorsLength);\r\n            this._lineStrokeColors.splice(geometry._lineColorsHandlerIndex, geometry._lineColorsLength);\r\n            this._lineThickness.splice(geometry._lineThicknessHandlerIndex, geometry._lineThicknessLength);\r\n            this._lineStrokes.splice(geometry._lineThicknessHandlerIndex, geometry._lineThicknessLength);\r\n            this._lineIndexes.splice(geometry._lineIndexesHandlerIndex, geometry._lineIndexesLength);\r\n\r\n            di = geometry._lineVerticesLength * 0.5;\r\n            for (let i = geometry._lineIndexesHandlerIndex; i < this._lineIndexes.length; i++) {\r\n                this._lineIndexes[i] -= di;\r\n            }\r\n\r\n            // reindex\r\n            let g = this._geometries;\r\n            for (let i = index; i < g.length; i++) {\r\n                let gi = g[i];\r\n\r\n                gi._handlerIndex = i;\r\n                gi._polyVerticesHandlerIndex -= geometry._polyVerticesLength;\r\n                gi._polyIndexesHandlerIndex -= geometry._polyIndexesLength;\r\n\r\n                gi._lineVerticesHandlerIndex -= geometry._lineVerticesLength;\r\n                gi._lineOrdersHandlerIndex -= geometry._lineOrdersLength;\r\n                gi._lineColorsHandlerIndex -= geometry._lineColorsLength;\r\n                gi._lineThicknessHandlerIndex -= geometry._lineThicknessLength;\r\n                gi._lineIndexesHandlerIndex -= geometry._lineIndexesLength;\r\n            }\r\n\r\n\r\n            geometry._pickingReady = false;\r\n\r\n            geometry._handler = null;\r\n            geometry._handlerIndex = -1;\r\n\r\n            geometry._polyVerticesHighMerc = [];\r\n            geometry._polyVerticesLowMerc = [];\r\n            geometry._polyVerticesLength = -1;\r\n            geometry._polyIndexesLength = -1;\r\n            geometry._polyVerticesHandlerIndex = -1;\r\n            geometry._polyIndexesHandlerIndex = -1;\r\n\r\n            geometry._lineVerticesHighMerc = [];\r\n            geometry._lineVerticesLowMerc = [];\r\n            geometry._lineVerticesLength = -1;\r\n            geometry._lineOrdersLength = -1;\r\n            geometry._lineIndexesLength = -1;\r\n            geometry._lineColorsLength = -1;\r\n            geometry._lineThicknessLength = -1;\r\n            geometry._lineVerticesHandlerIndex = -1;\r\n            geometry._lineOrdersHandlerIndex = -1;\r\n            geometry._lineIndexesHandlerIndex = -1;\r\n            geometry._lineThicknessHandlerIndex = -1;\r\n            geometry._lineColorsHandlerIndex = -1;\r\n\r\n            !this._removeGeometryExtents[geometry.__id] && this._removeGeometryExtentArr.push(geometry.getExtent());\r\n            this._removeGeometryExtents[geometry.__id] = true;\r\n\r\n            this.refresh();\r\n        }\r\n    }\r\n\r\n    protected _refreshRecursevely(geometry: Geometry, treeNode: Node) {\r\n        if (treeNode.ready) {\r\n            let lid = this._layer._id;\r\n            for (let i = 0; i < treeNode.nodes.length; i++) {\r\n                let ni = treeNode.nodes[i];\r\n                if (geometry.overlaps(ni.segment.getExtentLonLat())) {\r\n                    this._refreshRecursevely(geometry, ni);\r\n                    let m = ni.segment.materials[lid];\r\n                    if (m && m.isReady) {\r\n                        if (m.segment.node.getState() !== quadTree.RENDERING) {\r\n                            m.layer.clearMaterial(m);\r\n                        } else {\r\n                            m.pickingReady = m.pickingReady && geometry._pickingReady;\r\n                            m.isReady = false;\r\n                            m._updateTexture = m.texture;\r\n                            m._updatePickingMask = m.pickingMask;\r\n                        }\r\n\r\n                        geometry._pickingReady = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _refreshRecursevelyExt(extent: Extent, treeNode: Node) {\r\n        if (treeNode.ready) {\r\n            let lid = this._layer.__id;\r\n            for (let i = 0; i < treeNode.nodes.length; i++) {\r\n                let ni = treeNode.nodes[i];\r\n                if (extent.overlaps(ni.segment.getExtentLonLat())) {\r\n                    this._refreshRecursevelyExt(extent, ni);\r\n                    let m = ni.segment.materials[lid];\r\n                    if (m && m.isReady) {\r\n                        m.layer.clearMaterial(m);\r\n                        // m.pickingReady = false;\r\n                        // m.isReady = false;\r\n                        // m._updateTexture = m.texture;\r\n                        // m._updatePickingMask = m.pickingMask;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _refreshPlanetNode(treeNode: Node) {\r\n        let i;\r\n\r\n        let e = this._removeGeometryExtentArr;\r\n        for (i = 0; i < e.length; i++) {\r\n            this._refreshRecursevelyExt(e[i], treeNode);\r\n        }\r\n\r\n        let g = this._updatedGeometryArr;\r\n        for (i = 0; i < g.length; i++) {\r\n            this._refreshRecursevely(g[i], treeNode);\r\n        }\r\n    }\r\n\r\n    protected _updatePlanet() {\r\n        let p = this._layer._planet;\r\n        if (p) {\r\n            let ql = p.quadTreeStrategy.quadTreeList;\r\n            for (let i = 0; i < ql.length; i++) {\r\n                this._refreshPlanetNode(ql[i]);\r\n            }\r\n            // p.quadTreeStrategy.quadTreeList.forEach((quadTree: Node) => {\r\n            //     this._refreshPlanetNode(quadTree);\r\n            // });\r\n        }\r\n        this._updatedGeometryArr.length = 0;\r\n        this._updatedGeometryArr = [];\r\n        this._updatedGeometry = {};\r\n\r\n        this._removeGeometryExtentArr.length = 0;\r\n        this._removeGeometryExtentArr = [];\r\n        this._removeGeometryExtents = {};\r\n    }\r\n\r\n    protected refresh() {\r\n        let i = this._changedBuffers.length;\r\n        while (i--) {\r\n            this._changedBuffers[i] = true;\r\n        }\r\n    }\r\n\r\n    public update() {\r\n        if (this._handler) {\r\n            let needUpdate = false;\r\n            let i = this._changedBuffers.length;\r\n            while (i--) {\r\n                if (this._changedBuffers[i]) {\r\n                    needUpdate = true;\r\n                    this._buffersUpdateCallbacks[i].call(this);\r\n                    this._changedBuffers[i] = false;\r\n                }\r\n            }\r\n            needUpdate && this._updatePlanet();\r\n        }\r\n    }\r\n\r\n    public setGeometryVisibility(geometry: Geometry) {\r\n        let v = geometry.getVisibility() ? 1.0 : 0.0;\r\n\r\n        let a = this._polyVerticesHighMerc,\r\n            b = this._polyVerticesLowMerc;\r\n\r\n        let l = geometry._polyVerticesLength;\r\n        let ind = geometry._polyVerticesHandlerIndex;\r\n        for (let i = 0; i < l; i++) {\r\n            a[ind + i] = geometry._polyVerticesHighMerc[i] * v;\r\n            b[ind + i] = geometry._polyVerticesLowMerc[i] * v;\r\n        }\r\n\r\n        a = this._lineVerticesHighMerc;\r\n        b = this._lineVerticesLowMerc;\r\n\r\n        l = geometry._lineVerticesLength;\r\n        ind = geometry._lineVerticesHandlerIndex;\r\n        for (let i = 0; i < l; i++) {\r\n            a[ind + i] = geometry._lineVerticesHighMerc[i] * v;\r\n            b[ind + i] = geometry._lineVerticesLowMerc[i] * v;\r\n        }\r\n\r\n        this._changedBuffers[POLYVERTICES_BUFFER] = true;\r\n        this._changedBuffers[LINEVERTICES_BUFFER] = true;\r\n\r\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public setPolyColorArr(geometry: Geometry, color: Vec4) {\r\n        let index = geometry._polyVerticesHandlerIndex * 2, // ... / 2 * 4\r\n            size = index + geometry._polyVerticesLength * 2; // ... / 2 * 4\r\n        let a = this._polyColors;\r\n        for (let i = index; i < size; i += 4) {\r\n            a[i] = color.x;\r\n            a[i + 1] = color.y;\r\n            a[i + 2] = color.z;\r\n            a[i + 3] = color.w;\r\n        }\r\n        this._changedBuffers[POLYCOLORS_BUFFER] = true;\r\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public setLineStrokeColorArr(geometry: Geometry, color: Vec4) {\r\n        let index = geometry._lineColorsHandlerIndex,\r\n            size = index + geometry._lineColorsLength;\r\n        let a = this._lineStrokeColors;\r\n        for (let i = index; i < size; i += 4) {\r\n            a[i] = color.x;\r\n            a[i + 1] = color.y;\r\n            a[i + 2] = color.z;\r\n            a[i + 3] = color.w;\r\n        }\r\n        this._changedBuffers[LINESTROKECOLORS_BUFFER] = true;\r\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public setLineColorArr(geometry: Geometry, color: Vec4) {\r\n        let index = geometry._lineColorsHandlerIndex,\r\n            size = index + geometry._lineColorsLength;\r\n        let a = this._lineColors;\r\n        for (let i = index; i < size; i += 4) {\r\n            a[i] = color.x;\r\n            a[i + 1] = color.y;\r\n            a[i + 2] = color.z;\r\n            a[i + 3] = color.w;\r\n        }\r\n        this._changedBuffers[LINECOLORS_BUFFER] = true;\r\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public setLineStrokeArr(geometry: Geometry, width: number) {\r\n        // let index = geometry._lineStrokesHandlerIndex,\r\n        //     size = index + geometry._lineStrokesLength;\r\n        // let a = this._lineStrokes;\r\n        // for (let i = index; i < size; i++) {\r\n        //     a[i] = width;\r\n        // }\r\n        // this._changedBuffers[LINESTROKES_BUFFER] = true;\r\n        // !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        // this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public setLineThicknessArr(geometry: Geometry, width: number) {\r\n        let index = geometry._lineThicknessHandlerIndex,\r\n            size = index + geometry._lineThicknessLength;\r\n        let a = this._lineThickness;\r\n        for (let i = index; i < size; i++) {\r\n            a[i] = width;\r\n        }\r\n        this._changedBuffers[LINETHICKNESS_BUFFER] = true;\r\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public bringToFront(geometry: Geometry) {\r\n        let polyIndexes = this._polyIndexes.splice(geometry._polyIndexesHandlerIndex, geometry._polyIndexesLength);\r\n        let lineIndexes = this._lineIndexes.splice(geometry._lineIndexesHandlerIndex, geometry._lineIndexesLength);\r\n\r\n        this._geometries.splice(geometry._handlerIndex, 1);\r\n\r\n        let g = this._geometries;\r\n        for (let i = geometry._handlerIndex; i < g.length; i++) {\r\n            let gi = g[i];\r\n            gi._handlerIndex = i;\r\n            gi._polyIndexesHandlerIndex -= geometry._polyIndexesLength;\r\n            gi._lineIndexesHandlerIndex -= geometry._lineIndexesLength;\r\n        }\r\n\r\n        geometry._polyIndexesHandlerIndex = this._polyIndexes.length;\r\n        geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\r\n\r\n        geometry._handlerIndex = this._geometries.length;\r\n        this._geometries.push(geometry);\r\n\r\n        this._polyIndexes.push.apply(this._polyIndexes, polyIndexes);\r\n        this._lineIndexes.push.apply(this._lineIndexes, lineIndexes);\r\n\r\n        this._changedBuffers[POLYINDEXES_BUFFER] = true;\r\n        this._changedBuffers[LINEINDEXES_BUFFER] = true;\r\n\r\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\r\n        this._updatedGeometry[geometry.__id] = true;\r\n    }\r\n\r\n    public createPolyVerticesBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._polyVerticesHighBufferMerc!);\r\n        this._polyVerticesHighBufferMerc = h.createArrayBuffer(\r\n            new Float32Array(this._polyVerticesHighMerc),\r\n            2,\r\n            this._polyVerticesHighMerc.length / 2\r\n        );\r\n\r\n        h.gl!.deleteBuffer(this._polyVerticesLowBufferMerc!);\r\n        this._polyVerticesLowBufferMerc = h.createArrayBuffer(\r\n            new Float32Array(this._polyVerticesLowMerc),\r\n            2,\r\n            this._polyVerticesLowMerc.length / 2\r\n        );\r\n    }\r\n\r\n    public createPolyIndexesBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._polyIndexesBuffer!);\r\n        this._polyIndexesBuffer = h.createElementArrayBuffer(\r\n            new Uint32Array(this._polyIndexes),\r\n            1,\r\n            this._polyIndexes.length\r\n        );\r\n    }\r\n\r\n    public createPolyColorsBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._polyColorsBuffer!);\r\n        this._polyColorsBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._polyColors),\r\n            4,\r\n            this._polyColors.length / 4\r\n        );\r\n    }\r\n\r\n    public createPolyPickingColorsBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._polyPickingColorsBuffer!);\r\n        this._polyPickingColorsBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._polyPickingColors),\r\n            4,\r\n            this._polyPickingColors.length / 4\r\n        );\r\n    }\r\n\r\n    public createLineVerticesBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineVerticesHighBufferMerc!);\r\n        this._lineVerticesHighBufferMerc = h.createArrayBuffer(\r\n            new Float32Array(this._lineVerticesHighMerc),\r\n            2,\r\n            this._lineVerticesHighMerc.length / 2\r\n        );\r\n\r\n        h.gl!.deleteBuffer(this._lineVerticesLowBufferMerc!);\r\n        this._lineVerticesLowBufferMerc = h.createArrayBuffer(\r\n            new Float32Array(this._lineVerticesLowMerc),\r\n            2,\r\n            this._lineVerticesLowMerc.length / 2\r\n        );\r\n    }\r\n\r\n    public createLineIndexesBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineIndexesBuffer!);\r\n        this._lineIndexesBuffer = h.createElementArrayBuffer(\r\n            new Uint32Array(this._lineIndexes),\r\n            1,\r\n            this._lineIndexes.length\r\n        );\r\n    }\r\n\r\n    public createLineOrdersBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineOrdersBuffer!);\r\n        this._lineOrdersBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._lineOrders),\r\n            1,\r\n            this._lineOrders.length / 2\r\n        );\r\n    }\r\n\r\n    public createLineColorsBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineColorsBuffer!);\r\n        this._lineColorsBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._lineColors),\r\n            4,\r\n            this._lineColors.length / 4\r\n        );\r\n    }\r\n\r\n    public createLinePickingColorsBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._linePickingColorsBuffer!);\r\n        this._linePickingColorsBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._linePickingColors),\r\n            4,\r\n            this._linePickingColors.length / 4\r\n        );\r\n    }\r\n\r\n    public createLineThicknessBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineThicknessBuffer!);\r\n        this._lineThicknessBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._lineThickness),\r\n            1,\r\n            this._lineThickness.length\r\n        );\r\n    }\r\n\r\n    public createLineStrokesBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineStrokesBuffer!);\r\n        this._lineStrokesBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._lineStrokes),\r\n            1,\r\n            this._lineStrokes.length\r\n        );\r\n    }\r\n\r\n    public createLineStrokeColorsBuffer() {\r\n        let h = this._handler!;\r\n        h.gl!.deleteBuffer(this._lineStrokeColorsBuffer!);\r\n        this._lineStrokeColorsBuffer = h.createArrayBuffer(\r\n            new Float32Array(this._lineStrokeColors),\r\n            4,\r\n            this._lineStrokeColors.length / 4\r\n        );\r\n    }\r\n\r\n    public clear() {\r\n        this._geometries = [];\r\n        this._polyVerticesHighMerc = [];\r\n        this._polyVerticesLowMerc = [];\r\n        this._polyIndexes = [];\r\n        this._polyColors = [];\r\n        this._polyPickingColors = [];\r\n\r\n        this._lineVerticesHighMerc = [];\r\n        this._lineVerticesLowMerc = [];\r\n        this._lineOrders = [];\r\n        this._lineIndexes = [];\r\n        this._lineColors = [];\r\n        this._linePickingColors = [];\r\n        this._lineThickness = [];\r\n        this._lineStrokeColors = [];\r\n        this._lineStrokes = [];\r\n\r\n        this._deleteBuffers();\r\n\r\n        this._polyVerticesHighBufferMerc = null;\r\n        this._polyVerticesLowBufferMerc = null;\r\n        this._polyIndexesBuffer = null;\r\n        this._polyColorsBuffer = null;\r\n        this._polyPickingColorsBuffer = null;\r\n\r\n        this._lineVerticesHighBufferMerc = null;\r\n        this._lineVerticesLowBufferMerc = null;\r\n        this._lineIndexesBuffer = null;\r\n        this._lineOrdersBuffer = null;\r\n        this._lineColorsBuffer = null;\r\n        this._linePickingColorsBuffer = null;\r\n        this._lineThicknessBuffer = null;\r\n        this._lineStrokeColorsBuffer = null;\r\n        this._lineStrokesBuffer = null;\r\n\r\n        this._updatedGeometryArr = [];\r\n        this._updatedGeometry = {};\r\n\r\n        this._removeGeometryExtentArr = [];\r\n        this._removeGeometryExtents = {};\r\n\r\n        this.refresh();\r\n    }\r\n\r\n    public _deleteBuffers() {\r\n        if (this._layer._planet && this._layer._planet.renderer) {\r\n\r\n            let h = this._layer._planet.renderer.handler,\r\n                gl = h.gl!;\r\n\r\n            if (gl) {\r\n                gl.deleteBuffer(this._polyVerticesHighBufferMerc!);\r\n                gl.deleteBuffer(this._polyVerticesLowBufferMerc!);\r\n                gl.deleteBuffer(this._polyIndexesBuffer!);\r\n                gl.deleteBuffer(this._polyColorsBuffer!);\r\n                gl.deleteBuffer(this._polyPickingColorsBuffer!);\r\n\r\n                gl.deleteBuffer(this._lineVerticesHighBufferMerc);\r\n                gl.deleteBuffer(this._lineVerticesLowBufferMerc);\r\n                gl.deleteBuffer(this._lineIndexesBuffer);\r\n                gl.deleteBuffer(this._lineOrdersBuffer);\r\n                gl.deleteBuffer(this._lineColorsBuffer);\r\n                gl.deleteBuffer(this._linePickingColorsBuffer);\r\n                gl.deleteBuffer(this._lineThicknessBuffer);\r\n                gl.deleteBuffer(this._lineStrokeColorsBuffer);\r\n                gl.deleteBuffer(this._lineStrokesBuffer);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {GeometryHandler};\r\n","import * as math from \"../math\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport type {IEntityParams} from \"../entity/Entity\";\r\nimport {EntityCollection} from \"../entity/EntityCollection\";\r\nimport {EntityCollectionsTreeStrategy} from \"../quadTree/EntityCollectionsTreeStrategy\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {GeometryHandler} from \"../entity/GeometryHandler\";\r\nimport type {IMouseState, ITouchState} from \"../renderer/RendererEvents\";\r\nimport {Layer} from \"./Layer\";\r\nimport type {ILayerParams, LayerEventsList} from \"./Layer\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Material} from \"./Material\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport * as mercator from \"../mercator\";\r\n\r\nexport interface IVectorParams extends ILayerParams {\r\n    entities?: Entity[] | IEntityParams[];\r\n    polygonOffsetUnits?: number;\r\n    nodeCapacity?: number;\r\n    relativeToGround?: boolean;\r\n    clampToGround?: boolean;\r\n    async?: boolean;\r\n    pickingScale?: number | NumberArray3;\r\n    scaleByDistance?: NumberArray3;\r\n    labelMaxLetters?: number;\r\n    useLighting?: boolean;\r\n    depthOrder?: number;\r\n}\r\n\r\ntype VectorEventsList = [\r\n    //\"entitymove\",\r\n    \"draw\",\r\n    \"entityadd\",\r\n    \"entityremove\"\r\n]\r\n\r\nexport type VectorEventsType = EventsHandler<VectorEventsList> & EventsHandler<LayerEventsList>;\r\n\r\n/**\r\n * Creates entity instance array.\r\n * @param {Entity[] | IEntityParams[]} entities - Entity array.\r\n * @returns {Entity[]} - Entity array.\r\n */\r\nfunction _entitiesConstructor(entities: Entity[] | IEntityParams[]): Entity[] {\r\n    let res: Entity[] = [];\r\n    for (let i = 0; i < entities.length; i++) {\r\n        let ei = entities[i];\r\n        if ((ei as Entity).instanceName === \"Entity\") {\r\n            res.push(ei as Entity);\r\n        } else {\r\n            res.push(new Entity(ei as IEntityParams));\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\n/**\r\n * Vector layer represents alternative entities store. Used for geospatial data rendering like\r\n * points, lines, polygons, geometry objects etc.\r\n * @class\r\n * @extends {Layer}\r\n * @param {string} [name=\"noname\"] - Layer name.\r\n * @param {IVectorParams} [options] - Layer options:\r\n * @param {number} [options.minZoom=0] - Minimal visible zoom. 0 is default\r\n * @param {number} [options.maxZoom=50] - Maximal visible zoom. 50 is default.\r\n * @param {string} [options.attribution] - Layer attribution.\r\n * @param {string} [options.zIndex=0] - Layer Z-order index. 0 is default.\r\n * @param {boolean} [options.visibility=true] - Layer visibility. True is default.\r\n * @param {boolean} [options.isBaseLayer=false] - Layer base layer. False is default.\r\n * @param {Array.<Entity>} [options.entities] - Entities array.\r\n * @param {Array.<number>} [options.scaleByDistance] - Scale by distance parameters. (exactly 3 entries)\r\n *      First index - near distance to the entity, after entity becomes full scale.\r\n *      Second index - far distance to the entity, when entity becomes zero scale.\r\n *      Third index - far distance to the entity, when entity becomes invisible.\r\n *      Use [1.0, 1.0, 1.0] for real sized objects\r\n * @param {number} [options.nodeCapacity=30] - Maximum entities quantity in the tree node. Rendering optimization parameter. 30 is default.\r\n * @param {boolean} [options.async=true] - Asynchronous vector data handling before rendering. True for optimization huge data.\r\n * @param {boolean} [options.clampToGround = false] - Clamp vector data to the ground.\r\n * @param {boolean} [options.relativeToGround = false] - Place vector data relative to the ground relief.\r\n * @param {Number} [options.polygonOffsetUnits=0.0] - The multiplier by which an implementation-specific value is multiplied with to create a constant depth offset.\r\n *\r\n * //@fires EventsHandler<VectorEventsList>#entitymove\r\n * @fires EventsHandler<VectorEventsList>#draw\r\n * @fires EventsHandler<VectorEventsList>#add\r\n * @fires EventsHandler<VectorEventsList>#remove\r\n * @fires EventsHandler<VectorEventsList>#entityadd\r\n * @fires EventsHandler<VectorEventsList>#entityremove\r\n * @fires EventsHandler<VectorEventsList>#visibilitychange\r\n */\r\nclass Vector extends Layer {\r\n\r\n    public override events: VectorEventsType;\r\n\r\n    protected _depthOrder: number;\r\n\r\n    /**\r\n     * Entities collection.\r\n     * @protected\r\n     */\r\n    protected _entities: Entity[];\r\n\r\n    /**\r\n     * First index - near distance to the entity, after that entity becomes full scale.\r\n     * Second index - far distance to the entity, when entity becomes zero scale.\r\n     * Third index - far distance to the entity, when entity becomes invisible.\r\n     * @public\r\n     * @type {NumberArray3}\r\n     */\r\n    public scaleByDistance: NumberArray3;\r\n\r\n    public pickingScale: Float32Array;\r\n\r\n    /**\r\n     * Asynchronous data handling before rendering.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public async: boolean;\r\n\r\n    /**\r\n     * Maximum entities quantity in the tree node.\r\n     * @public\r\n     */\r\n    public _nodeCapacity: number;\r\n\r\n    /**\r\n     * Clamp vector data to the ground.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public clampToGround: boolean;\r\n\r\n    /**\r\n     * Sets vector data relative to the ground relief.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public relativeToGround: boolean;\r\n\r\n    /** todo: combine into one */\r\n    protected _stripEntityCollection: EntityCollection;\r\n    protected _polylineEntityCollection: EntityCollection;\r\n    protected _geoObjectEntityCollection: EntityCollection;\r\n\r\n    public _geometryHandler: GeometryHandler;\r\n\r\n    protected _entityCollectionsTreeStrategy: EntityCollectionsTreeStrategy | null;\r\n\r\n    //protected _pendingsQueue: Entity[];\r\n\r\n    /**\r\n     * Specifies the scale Units for gl.polygonOffset function to calculate depth values, 0.0 is default.\r\n     * @public\r\n     * @type {Number}\r\n     */\r\n    public polygonOffsetUnits: number;\r\n\r\n    protected _labelMaxLetters: number;\r\n\r\n    protected _useLighting: boolean;\r\n\r\n    constructor(name?: string | null, options: IVectorParams = {}) {\r\n        super(name, options);\r\n\r\n        // @ts-ignore\r\n        this.events = this.events.registerNames(VECTOR_EVENTS);\r\n\r\n        this.isVector = true;\r\n\r\n        this._hasImageryTiles = false;\r\n\r\n        this.scaleByDistance = options.scaleByDistance || [math.MAX32, math.MAX32, math.MAX32];\r\n\r\n        this._useLighting = options.useLighting !== undefined ? options.useLighting : true;\r\n\r\n\r\n        let pickingScale: Float32Array = new Float32Array([1.0, 1.0, 1.0]);\r\n        if (options.pickingScale !== undefined) {\r\n            if (options.pickingScale instanceof Array) {\r\n                pickingScale[0] = options.pickingScale[0] || pickingScale[0];\r\n                pickingScale[1] = options.pickingScale[1] || pickingScale[1];\r\n                pickingScale[2] = options.pickingScale[2] || pickingScale[2];\r\n            } else if (typeof options.pickingScale === 'number') {\r\n                pickingScale[0] = options.pickingScale;\r\n                pickingScale[1] = options.pickingScale;\r\n                pickingScale[2] = options.pickingScale;\r\n            }\r\n        }\r\n\r\n        this.pickingScale = pickingScale;\r\n\r\n        this.async = options.async !== undefined ? options.async : true;\r\n\r\n        this.clampToGround = options.clampToGround || false;\r\n\r\n        this.relativeToGround = options.relativeToGround || false;\r\n\r\n        this._entities = _entitiesConstructor(options.entities || []);\r\n\r\n        this._labelMaxLetters = options.labelMaxLetters || 24;\r\n\r\n        this._stripEntityCollection = new EntityCollection({\r\n            pickingEnabled: this.pickingEnabled\r\n        });\r\n        this._bindEventsDefault(this._stripEntityCollection);\r\n\r\n        this._polylineEntityCollection = new EntityCollection({\r\n            pickingEnabled: this.pickingEnabled\r\n        });\r\n        this._bindEventsDefault(this._polylineEntityCollection);\r\n\r\n        this._geoObjectEntityCollection = new EntityCollection({\r\n            pickingEnabled: this.pickingEnabled,\r\n            useLighting: this._useLighting\r\n        });\r\n        this._bindEventsDefault(this._geoObjectEntityCollection);\r\n\r\n        this._geometryHandler = new GeometryHandler(this);\r\n\r\n        this._nodeCapacity = options.nodeCapacity || 60;\r\n\r\n        this._entityCollectionsTreeStrategy = null;\r\n\r\n        this.setEntities(this._entities);\r\n\r\n        this.polygonOffsetUnits = options.polygonOffsetUnits != undefined ? options.polygonOffsetUnits : 0.0;\r\n\r\n        this.pickingEnabled = this._pickingEnabled;\r\n\r\n        this._depthOrder = options.depthOrder || 0;\r\n    }\r\n\r\n    public get depthOrder(): number {\r\n        return this._depthOrder;\r\n    }\r\n\r\n    public set depthOrder(d: number) {\r\n        if (d !== this._depthOrder) {\r\n            this._depthOrder = d;\r\n            this._planet && this._planet.updateVisibleLayers();\r\n        }\r\n    }\r\n\r\n    public get useLighting(): boolean {\r\n        return this._useLighting;\r\n    }\r\n\r\n    public set useLighting(f: boolean) {\r\n        if (f !== this._useLighting) {\r\n            this._geoObjectEntityCollection.useLighting = f;\r\n            this._useLighting = f;\r\n        }\r\n    }\r\n\r\n    public get labelMaxLetters(): number {\r\n        return this._labelMaxLetters;\r\n    }\r\n\r\n    public override get instanceName() {\r\n        return \"Vector\";\r\n    }\r\n\r\n    protected override _bindPicking() {\r\n        this._pickingColor.clear();\r\n    }\r\n\r\n    /**\r\n     * Adds layer to the planet.\r\n     * @public\r\n     * @param {Planet} planet - Planet scene object.\r\n     * @returns {Vector} -\r\n     */\r\n    public override addTo(planet: Planet) {\r\n        if (!this._planet) {\r\n            this._assignPlanet(planet);\r\n            this._geometryHandler.assignHandler(planet.renderer!.handler);\r\n            this._polylineEntityCollection.addTo(planet, true);\r\n            this._stripEntityCollection.addTo(planet, true);\r\n            this._geoObjectEntityCollection.addTo(planet, true);\r\n\r\n            this._polylineEntityCollection._layer = this;\r\n            this._stripEntityCollection._layer = this;\r\n            this._geoObjectEntityCollection._layer = this;\r\n\r\n            this.setEntities(this._entities);\r\n        }\r\n    }\r\n\r\n    public override remove(): this {\r\n        super.remove();\r\n        this._polylineEntityCollection.remove();\r\n        this._stripEntityCollection.remove();\r\n        this._geoObjectEntityCollection.remove();\r\n\r\n        this._polylineEntityCollection._layer = undefined;\r\n        this._stripEntityCollection._layer = undefined;\r\n        this._geoObjectEntityCollection._layer = undefined;\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Returns stored entities.\r\n     * @public\r\n     * @returns {Array.<Entity>} -\r\n     */\r\n    public getEntities(): Entity[] {\r\n        return ([] as Entity[]).concat(this._entities);\r\n    }\r\n\r\n    /**\r\n     * Adds entity to the layer.\r\n     * @public\r\n     * @param {Entity} entity - Entity.\r\n     * @param {boolean} [rightNow=false] - Entity insertion option. False is default.\r\n     * @returns {Vector} - Returns this layer.\r\n     */\r\n    public add(entity: Entity, rightNow: boolean = false): this {\r\n        if (!(entity._layer || entity._entityCollection)) {\r\n            entity._layer = this;\r\n            entity._layerIndex = this._entities.length;\r\n            //this._fitExtent(entity);\r\n            this._entities.push(entity);\r\n            this._proceedEntity(entity, rightNow);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Adds entity to the layer in the index position.\r\n     * @public\r\n     * @param {Entity} entity - Entity.\r\n     * @param {Number} index - Index position.\r\n     * @param {boolean} [rightNow] - Entity insertion option. False is default.\r\n     * @returns {Vector} - Returns this layer.\r\n     */\r\n    public insert(entity: Entity, index: number, rightNow: boolean = false): this {\r\n        if (!(entity._layer || entity._entityCollection)) {\r\n            entity._layer = this;\r\n            entity._layerIndex = index;\r\n            //this._fitExtent(entity);\r\n            this._entities.splice(index, 0, entity);\r\n            for (let i = index + 1, len = this._entities.length; i < len; i++) {\r\n                this._entities[i]._layerIndex = i;\r\n            }\r\n\r\n            this._proceedEntity(entity, rightNow);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _proceedEntity(entity: Entity, rightNow: boolean = false) {\r\n        let temp = this._hasImageryTiles;\r\n\r\n        let isEmpty = !(entity.strip || entity.polyline || entity.ray || entity.geoObject || entity.geometry);\r\n\r\n        if (entity.strip) {\r\n            this._stripEntityCollection.add(entity);\r\n        }\r\n\r\n        if (entity.polyline || entity.ray) {\r\n            this._polylineEntityCollection.add(entity);\r\n        }\r\n\r\n        if (entity.geoObject || isEmpty) {\r\n            this._geoObjectEntityCollection.add(entity);\r\n        }\r\n\r\n        if (entity.geometry) {\r\n            this._hasImageryTiles = true;\r\n            if (this._planet) {\r\n                this._planet.renderer!.assignPickingColor<Entity>(entity);\r\n                this._geometryHandler.add(entity.geometry);\r\n            }\r\n        }\r\n\r\n        if (this._planet) {\r\n            if (entity.billboard || entity.label || entity.geoObject || isEmpty) {\r\n                if (entity._cartesian.isZero() && !entity._lonLat.isZero()) {\r\n                    entity._setCartesian3vSilent(\r\n                        this._planet.ellipsoid.lonLatToCartesian(entity._lonLat)\r\n                    );\r\n                } else {\r\n                    entity._lonLat = this._planet.ellipsoid.cartesianToLonLat(entity._cartesian);\r\n\r\n                    // IT's important event for degrees proj strategies\r\n                    if (Math.abs(entity._lonLat.lat) < mercator.MAX_LAT) {\r\n                        entity._lonLatMerc = entity._lonLat.forwardMercator();\r\n                    } else {\r\n                        entity._lonLatMerc.lon = entity._lonLatMerc.lat = entity._lonLatMerc.height = 0;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (entity.billboard || entity.label) {\r\n                this._entityCollectionsTreeStrategy?.insertEntity(entity);\r\n            }\r\n        }\r\n\r\n        if (this._planet && this._hasImageryTiles !== temp) {\r\n            this._planet.updateVisibleLayers();\r\n        }\r\n\r\n        this.events.dispatch(this.events.entityadd, entity);\r\n    }\r\n\r\n    /**\r\n     * Adds entity array to the layer.\r\n     * @public\r\n     * @param {Array.<Entity>} entities - Entities array.\r\n     * @param {boolean} [rightNow=false] - Entity insertion option. False is default.\r\n     * @returns {Vector} - Returns this layer.\r\n     */\r\n    public addEntities(entities: Entity[], rightNow: boolean = false) {\r\n        let i = entities.length;\r\n        while (i--) {\r\n            this.add(entities[i], rightNow);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Remove entity from layer.\r\n     * TODO: memory leaks.\r\n     * @public\r\n     * @param {Entity} entity - Entity to remove.\r\n     * @returns {Vector} - Returns this layer.\r\n     */\r\n    public removeEntity(entity: Entity): this {\r\n\r\n        if (entity._layer && this.isEqual(entity._layer)) {\r\n\r\n            this._entities.splice(entity._layerIndex, 1);\r\n\r\n            this._reindexEntitiesArray(entity._layerIndex);\r\n\r\n            entity._layer = null;\r\n\r\n            entity._layerIndex = -1;\r\n\r\n            if (entity._entityCollection) {\r\n\r\n                entity._entityCollection._removeEntitySilent(entity);\r\n\r\n                let node = entity._nodePtr;\r\n\r\n                while (node) {\r\n                    node.count--;\r\n                    node = node.parentNode!;\r\n                }\r\n\r\n                if (\r\n                    entity._nodePtr &&\r\n                    entity._nodePtr.count === 0 &&\r\n                    entity._nodePtr.deferredEntities.length === 0\r\n                ) {\r\n                    entity._nodePtr.entityCollection = null;\r\n                    //\r\n                    // ...\r\n                    //\r\n                }\r\n            } else if (entity._nodePtr && entity._nodePtr.deferredEntities.length) {\r\n                let defEntities = entity._nodePtr.deferredEntities;\r\n                let j = defEntities.length;\r\n                while (j--) {\r\n                    if (defEntities[j].id === entity.id) {\r\n                        defEntities.splice(j, 1);\r\n                        let node = entity._nodePtr;\r\n                        while (node) {\r\n                            node.count--;\r\n                            node = node.parentNode!;\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (this._planet && entity.geometry) {\r\n                this._geometryHandler.remove(entity.geometry);\r\n                this._planet.renderer!.clearPickingColor(entity);\r\n            }\r\n\r\n            entity._nodePtr = undefined;\r\n\r\n            this.events.dispatch(this.events.entityremove, entity);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set layer picking events active.\r\n     * @public\r\n     * @param {boolean} picking - Picking enable flag.\r\n     */\r\n    public override set pickingEnabled(picking: boolean) {\r\n        this._pickingEnabled = picking;\r\n        this._stripEntityCollection.setPickingEnabled(picking);\r\n        this._polylineEntityCollection.setPickingEnabled(picking);\r\n        this._geoObjectEntityCollection.setPickingEnabled(picking);\r\n        this._entityCollectionsTreeStrategy?.setPickingEnabled(picking);\r\n    }\r\n\r\n    /**\r\n     * Refresh collected entities indexes from startIndex entities collection array position.\r\n     * @protected\r\n     * @param {number} startIndex - Entity array index.\r\n     */\r\n    protected _reindexEntitiesArray(startIndex: number) {\r\n        const e = this._entities;\r\n        for (let i = startIndex; i < e.length; i++) {\r\n            e[i]._layerIndex = i;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes entities from layer.\r\n     * @public\r\n     * @param {Array.<Entity>} entities - Entity array.\r\n     * @returns {Vector} - Returns this layer.\r\n     */\r\n    public removeEntities(entities: Entity[]): this {\r\n        let i = entities.length;\r\n        while (i--) {\r\n            this.removeEntity(entities[i]);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Clear the layer.\r\n     * @public\r\n     */\r\n    public override clear() {\r\n        super.clear();\r\n        let temp: Entity[] = new Array(this._entities.length);\r\n\r\n        for (let i = 0; i < temp.length; i++) {\r\n            temp[i] = this._entities[i];\r\n        }\r\n\r\n        let i = this._entities.length;\r\n        while (i--) {\r\n            this._entities[i].remove();\r\n        }\r\n\r\n        this._entities.length = 0;\r\n        this._entities = [];\r\n        for (let i = 0; i < temp.length; i++) {\r\n            this._entities[i] = temp[i];\r\n        }\r\n\r\n        this._entityCollectionsTreeStrategy?.dispose();\r\n        this._entityCollectionsTreeStrategy = null;\r\n        this._geometryHandler.clear()\r\n    }\r\n\r\n    /**\r\n     * Safety entities loop.\r\n     * @public\r\n     * @param {function(Entity, number): void} callback - Entity callback.\r\n     */\r\n    public each(callback: (entity: Entity, index?: number) => void) {\r\n        let e = this._entities;\r\n        let i = e.length;\r\n        while (i--) {\r\n            callback(e[i], i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes current entities from layer and adds new entities.\r\n     * @public\r\n     * @param {Array.<Entity>} entities - New entity array.\r\n     * @returns {Vector} - Returns layer instance.\r\n     */\r\n    public setEntities(entities: Entity[]): this {\r\n\r\n        let temp: Entity[] = new Array(entities.length);\r\n\r\n        for (let i = 0, len = entities.length; i < len; i++) {\r\n            temp[i] = entities[i];\r\n        }\r\n\r\n        this.clear();\r\n\r\n        this._entities = new Array(temp.length);\r\n\r\n        let entitiesForTree = [];\r\n\r\n        for (let i = 0; i < temp.length; i++) {\r\n            let ei = temp[i];\r\n\r\n            ei._layer = this;\r\n            ei._layerIndex = i;\r\n\r\n            let isEmpty = !(ei.strip || ei.polyline || ei.ray || ei.geoObject || ei.billboard || ei.label);\r\n\r\n            if (ei.strip) {\r\n                this._stripEntityCollection.add(ei);\r\n            } else if (ei.polyline || ei.ray) {\r\n                this._polylineEntityCollection.add(ei);\r\n            } else if (ei.geoObject || isEmpty) {\r\n                this._geoObjectEntityCollection.add(ei);\r\n            } else if (ei.billboard || ei.label) {\r\n                entitiesForTree.push(ei);\r\n            }\r\n\r\n            if (ei.geometry) {\r\n                this._hasImageryTiles = true;\r\n                if (this._planet) {\r\n                    this._planet.renderer!.assignPickingColor<Entity>(ei);\r\n                    this._geometryHandler.add(ei.geometry);\r\n                }\r\n            }\r\n\r\n            this._entities[i] = ei;\r\n        }\r\n\r\n        this._createEntityCollectionsTree(entitiesForTree);\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _createEntityCollectionsTree(entitiesForTree: Entity[]) {\r\n        if (this._planet) {\r\n            this._entityCollectionsTreeStrategy = this._planet.quadTreeStrategy.createEntitiCollectionsTreeStrategy(this, this._nodeCapacity);\r\n            this._entityCollectionsTreeStrategy.insertEntities(entitiesForTree);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @todo (refactoring) could be used in something like bindEntityCollectionQuad(...)\r\n     * @param entityCollection\r\n     */\r\n    public _bindEventsDefault(entityCollection: EntityCollection) {\r\n\r\n        let ve = this.events;\r\n\r\n        //\r\n        // @todo: replace with arrow functions and '...e'\r\n        //\r\n        // entityCollection.events.on(\"entitymove\", (e: any) => {\r\n        //     ve.dispatch(ve.entitymove, e);\r\n        // });\r\n        entityCollection.events.on(\"mousemove\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mousemove, e);\r\n        });\r\n        entityCollection.events.on(\"mouseenter\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mouseenter, e);\r\n        });\r\n        entityCollection.events.on(\"mouseleave\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mouseleave, e);\r\n        });\r\n        entityCollection.events.on(\"lclick\", (e: IMouseState) => {\r\n            ve.dispatch(ve.lclick, e);\r\n        });\r\n        entityCollection.events.on(\"rclick\", (e: IMouseState) => {\r\n            ve.dispatch(ve.rclick, e);\r\n        });\r\n        entityCollection.events.on(\"mclick\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mclick, e);\r\n        });\r\n        entityCollection.events.on(\"ldblclick\", (e: IMouseState) => {\r\n            ve.dispatch(ve.ldblclick, e);\r\n        });\r\n        entityCollection.events.on(\"rdblclick\", (e: IMouseState) => {\r\n            ve.dispatch(ve.rdblclick, e);\r\n        });\r\n        entityCollection.events.on(\"mdblclick\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mdblclick, e);\r\n        });\r\n        entityCollection.events.on(\"lup\", (e: IMouseState) => {\r\n            ve.dispatch(ve.lup, e);\r\n        });\r\n        entityCollection.events.on(\"rup\", (e: IMouseState) => {\r\n            ve.dispatch(ve.rup, e);\r\n        });\r\n        entityCollection.events.on(\"mup\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mup, e);\r\n        });\r\n        entityCollection.events.on(\"ldown\", (e: IMouseState) => {\r\n            ve.dispatch(ve.ldown, e);\r\n        });\r\n        entityCollection.events.on(\"rdown\", (e: IMouseState) => {\r\n            ve.dispatch(ve.rdown, e);\r\n        });\r\n        entityCollection.events.on(\"mdown\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mdown, e);\r\n        });\r\n        entityCollection.events.on(\"lhold\", (e: IMouseState) => {\r\n            ve.dispatch(ve.lhold, e);\r\n        });\r\n        entityCollection.events.on(\"rhold\", (e: IMouseState) => {\r\n            ve.dispatch(ve.rhold, e);\r\n        });\r\n        entityCollection.events.on(\"mhold\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mhold, e);\r\n        });\r\n        entityCollection.events.on(\"mousewheel\", (e: IMouseState) => {\r\n            ve.dispatch(ve.mousewheel, e);\r\n        });\r\n        entityCollection.events.on(\"touchmove\", (e: ITouchState) => {\r\n            ve.dispatch(ve.touchmove, e);\r\n        });\r\n        entityCollection.events.on(\"touchstart\", (e: ITouchState) => {\r\n            ve.dispatch(ve.touchstart, e);\r\n        });\r\n        entityCollection.events.on(\"touchend\", (e: ITouchState) => {\r\n            ve.dispatch(ve.touchend, e);\r\n        });\r\n        entityCollection.events.on(\"doubletouch\", (e: ITouchState) => {\r\n            ve.dispatch(ve.doubletouch, e);\r\n        });\r\n        entityCollection.events.on(\"touchleave\", (e: ITouchState) => {\r\n            ve.dispatch(ve.touchleave, e);\r\n        });\r\n        entityCollection.events.on(\"touchenter\", (e: ITouchState) => {\r\n            ve.dispatch(ve.touchenter, e);\r\n        });\r\n    }\r\n\r\n    protected _collectStripCollectionPASS(outArr: EntityCollection[]) {\r\n        let ec = this._stripEntityCollection;\r\n\r\n        ec._fadingOpacity = this._fadingOpacity;\r\n        ec.scaleByDistance = this.scaleByDistance;\r\n        ec.pickingScale = this.pickingScale;\r\n        ec.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n        outArr.push(ec);\r\n    }\r\n\r\n    protected _collectPolylineCollectionPASS(outArr: EntityCollection[]) {\r\n        let ec = this._polylineEntityCollection;\r\n\r\n        ec._fadingOpacity = this._fadingOpacity;\r\n        ec.scaleByDistance = this.scaleByDistance;\r\n        ec.pickingScale = this.pickingScale;\r\n        ec.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n        outArr.push(ec);\r\n\r\n        if (this.clampToGround || this.relativeToGround) {\r\n            let rtg = Number(this.relativeToGround);\r\n\r\n            const nodes = this._planet!._renderedNodes;\r\n            const visibleExtent = this._planet!.getViewExtent();\r\n            let e = ec._entities;\r\n            let e_i = e.length;\r\n            let res = new Vec3();\r\n\r\n            while (e_i--) {\r\n                let p = e[e_i].polyline!;\r\n                if (p && visibleExtent.overlaps(p._extent)) {\r\n                    // TODO:this works only for mercator area.\r\n                    // needs to be working on poles.\r\n                    let coords = p._pathLonLatMerc,\r\n                        c_j = coords.length;\r\n                    while (c_j--) {\r\n                        let c_j_h = coords[c_j].length;\r\n                        while (c_j_h--) {\r\n                            let ll = coords[c_j][c_j_h],\r\n                                n_k = nodes.length;\r\n                            while (n_k--) {\r\n                                let seg = nodes[n_k].segment;\r\n                                if (seg._extent.isInside(ll)) {\r\n                                    let cart = p._path3v[c_j][c_j_h] as Vec3;\r\n                                    seg.getTerrainPoint(cart, ll, res);\r\n                                    let alt = (rtg && p.altitude) || 0.0;\r\n                                    if (alt) {\r\n                                        let n = this._planet!.ellipsoid.getSurfaceNormal3v(res);\r\n                                        p.setPoint3v(res.addA(n.scale(alt)), c_j_h, c_j, true);\r\n                                    } else {\r\n                                        p.setPoint3v(res, c_j_h, c_j, true);\r\n                                    }\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _collectGeoObjectCollectionPASS(outArr: EntityCollection[]) {\r\n        let ec = this._geoObjectEntityCollection;\r\n\r\n        ec._fadingOpacity = this._fadingOpacity;\r\n        ec.scaleByDistance = this.scaleByDistance;\r\n        ec.pickingScale = this.pickingScale;\r\n        ec.polygonOffsetUnits = this.polygonOffsetUnits;\r\n\r\n        outArr.push(ec);\r\n\r\n        // if (this.clampToGround || this.relativeToGround) {\r\n        //     let rtg = Number(this.relativeToGround);\r\n        //\r\n        //     var nodes = this._planet._renderedNodes;\r\n        //     var visibleExtent = this._planet.getViewExtent();\r\n        //     var e = ec._entities;\r\n        //     var e_i = e.length;\r\n        //     let res = new Vec3();\r\n        //\r\n        //     while (e_i--) {\r\n        //         var p = e[e_i].polyline;\r\n        //         if (visibleExtent.overlaps(p._extent)) {\r\n        //             // TODO:this works only for mercator area.\r\n        //             // needs to be working on poles.\r\n        //             let coords = p._pathLonLatMerc,\r\n        //                 c_j = coords.length;\r\n        //             while (c_j--) {\r\n        //                 var c_j_h = coords[c_j].length;\r\n        //                 while (c_j_h--) {\r\n        //                     let ll = coords[c_j][c_j_h],\r\n        //                         n_k = nodes.length;\r\n        //                     while (n_k--) {\r\n        //                         var seg = nodes[n_k].segment;\r\n        //                         if (seg._extent.isInside(ll)) {\r\n        //                             let cart = p._path3v[c_j][c_j_h];\r\n        //                             seg.getTerrainPoint(cart, ll, res);\r\n        //                             p.setPoint3v(\r\n        //                                 res.addA(res.normal().scale((rtg && p.altitude) || 0.0)),\r\n        //                                 c_j_h,\r\n        //                                 c_j,\r\n        //                                 true\r\n        //                             );\r\n        //                             break;\r\n        //                         }\r\n        //                     }\r\n        //                 }\r\n        //             }\r\n        //         }\r\n        //     }\r\n        // }\r\n    }\r\n\r\n    public collectVisibleCollections(outArr: EntityCollection[]) {\r\n        let p = this._planet!;\r\n\r\n        if (\r\n            (this._fading && this._fadingOpacity > 0.0) ||\r\n            (this.minZoom <= p.maxCurrZoom && this.maxZoom >= p.maxCurrZoom)\r\n        ) {\r\n            // Common collections first\r\n            this._collectStripCollectionPASS(outArr);\r\n            this._collectPolylineCollectionPASS(outArr);\r\n            this._collectGeoObjectCollectionPASS(outArr);\r\n\r\n            if (this._entityCollectionsTreeStrategy) {\r\n                this._entityCollectionsTreeStrategy.collectVisibleEntityCollections(outArr);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Start to load tile material.\r\n     * @public\r\n     * @virtual\r\n     * @param {Material} material - Current material.\r\n     */\r\n    public override loadMaterial(material: Material) {\r\n        const seg = material.segment;\r\n\r\n        if (this._isBaseLayer) {\r\n            material.texture = seg._isNorth ? seg.planet.solidTextureOne : seg.planet.solidTextureTwo;\r\n        } else {\r\n            material.texture = seg.planet.transparentTexture;\r\n        }\r\n\r\n        if (this._planet!.layerLock.isFree()) {\r\n            material.isReady = false;\r\n            material.isLoading = true;\r\n            this._planet!._vectorTileCreator.add(material);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Abort exact material loading.\r\n     * @public\r\n     * @override\r\n     * @param {Material} material - Segment material.\r\n     */\r\n    public override abortMaterialLoading(material: Material) {\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n\r\n    public override applyMaterial(material: Material, isForced: boolean = false): NumberArray4 {\r\n        if (material.isReady) {\r\n            return [0, 0, 1, 1];\r\n        } else {\r\n            !material.isLoading && this.loadMaterial(material);\r\n\r\n            const segment = material.segment;\r\n            let pn = segment.node,\r\n                notEmpty = false;\r\n\r\n            let mId = this.__id;\r\n            let psegm = material;\r\n\r\n            while (pn.parentNode) {\r\n                if (psegm && psegm.isReady) {\r\n                    notEmpty = true;\r\n                    break;\r\n                }\r\n                pn = pn.parentNode;\r\n                psegm = pn.segment.materials[mId];\r\n            }\r\n\r\n            if (notEmpty) {\r\n                material.appliedNodeId = pn.nodeId;\r\n                material.texture = psegm.texture;\r\n                material.pickingMask = psegm.pickingMask;\r\n                const dZ2 = 1.0 / (2 << (segment.tileZoom - pn.segment.tileZoom - 1));\r\n                return [\r\n                    segment.tileX * dZ2 - pn.segment.tileX,\r\n                    segment.tileY * dZ2 - pn.segment.tileY,\r\n                    dZ2,\r\n                    dZ2\r\n                ];\r\n            } else {\r\n                if (material.textureExists && material._updateTexture) {\r\n                    material.texture = material._updateTexture;\r\n                    material.pickingMask = material._updatePickingMask;\r\n                } else {\r\n                    material.texture = segment.planet.transparentTexture;\r\n                    material.pickingMask = segment.planet.transparentTexture;\r\n                }\r\n                material.pickingReady = true;\r\n                return [0, 0, 1, 1];\r\n            }\r\n        }\r\n    }\r\n\r\n    public override clearMaterial(material: Material) {\r\n        if (material.isReady) {\r\n            const gl = material.segment.handler.gl!;\r\n\r\n            material.isReady = false;\r\n            material.pickingReady = false;\r\n\r\n            let t = material.texture;\r\n            material.texture = null;\r\n            t && !t.default && gl.deleteTexture(t);\r\n\r\n            t = material.pickingMask;\r\n            material.pickingMask = null;\r\n            t && !t.default && gl.deleteTexture(t);\r\n\r\n            t = material._updateTexture;\r\n            material._updateTexture = null;\r\n            t && !t.default && gl.deleteTexture(t);\r\n\r\n            t = material._updatePickingMask;\r\n            material._updatePickingMask = null;\r\n            t && !t.default && gl.deleteTexture(t);\r\n        }\r\n\r\n        this.abortMaterialLoading(material);\r\n\r\n        material.isLoading = false;\r\n        material.textureExists = false;\r\n    }\r\n\r\n    public update() {\r\n        this._geometryHandler.update();\r\n        this.events.dispatch(this.events.draw, this);\r\n    }\r\n}\r\n\r\nconst VECTOR_EVENTS: VectorEventsList = [\r\n    // /**\r\n    //  * Triggered when entity has moved.\r\n    //  * @event EventsHandler<VectorEventsList>#draw\r\n    //  */\r\n    // \"entitymove\",\r\n\r\n    /**\r\n     * Triggered when layer begin draw.\r\n     * @event EventsHandler<VectorEventsList>#draw\r\n     */\r\n    \"draw\",\r\n\r\n    /**\r\n     * Triggered when new entity added to the layer.\r\n     * @event EventsHandler<VectorEventsList>#entityadd\r\n     */\r\n    \"entityadd\",\r\n\r\n    /**\r\n     * Triggered when entity removes from the collection.\r\n     * @event EventsHandler<VectorEventsList>#entityremove\r\n     */\r\n    \"entityremove\"\r\n];\r\n\r\nexport {Vector};\r\n","import * as math from \"../../math\";\r\nimport {createEvents, type EventsHandler} from '../../Events';\r\nimport type {CoordinatesType} from \"../../entity/Geometry\";\r\nimport {Entity} from '../../entity/Entity';\r\nimport type {IMouseState} from \"../../renderer/RendererEvents\";\r\nimport {OldMouseNavigation} from \"../OldMouseNavigation\";\r\nimport {LonLat} from '../../LonLat';\r\nimport {Line3} from '../../math/Line3';\r\nimport {Object3d} from '../../Object3d';\r\nimport {Planet} from '../../scene/Planet';\r\nimport {RenderNode} from '../../scene/RenderNode';\r\nimport {Vec2} from '../../math/Vec2';\r\nimport {Vec3} from '../../math/Vec3';\r\nimport {Vector} from '../../layer/Vector';\r\n\r\ntype PolygonDrawingSceneEventsList = [\"change\", \"startpoint\"];\r\n\r\nconst POLYGONDRAWINGSCENE_EVENTS: PolygonDrawingSceneEventsList = [\"change\", \"startpoint\"];\r\n\r\nexport interface IPolygonDrawingSceneParams {\r\n    coordinates?: CoordinatesType[];\r\n    name: string;\r\n}\r\n\r\nconst POINTER_OBJ3D = Object3d.createCylinder(1, 1, 2.0, 20, 1, true, false, 0, -0.5, 0);\r\n\r\nexport const NUM_SEGMENTS = 200;\r\nexport const OUTLINE_ALT = 0.3;\r\nexport const COORDINATES_COLOR = \"rgb(350, 350, 0)\";\r\nexport const CENTER_COLOR = \"rgb(0, 350, 50)\";\r\nexport const OUTLINE_COLOR = \"rgb(0, 350, 50)\";\r\nexport const OUTLINE_THICKNESS = 3.5;\r\n\r\nexport const CORNER_OPTIONS = {\r\n    scale: 0.5,\r\n    instanced: true,\r\n    tag: \"corners\",\r\n    color: COORDINATES_COLOR,\r\n    object3d: POINTER_OBJ3D\r\n};\r\n\r\nexport const CENTER_OPTIONS = {\r\n    scale: 0.4,\r\n    instanced: true,\r\n    tag: \"centers\",\r\n    color: CENTER_COLOR,\r\n    object3d: POINTER_OBJ3D\r\n};\r\n\r\nexport const OUTLINE_OPTIONS = {\r\n    thickness: OUTLINE_THICKNESS,\r\n    color: OUTLINE_COLOR\r\n}\r\n\r\nclass PolygonDrawingScene extends RenderNode {\r\n    public events: EventsHandler<PolygonDrawingSceneEventsList>;\r\n    public _planet: Planet | null;\r\n    protected _initCoordinates: CoordinatesType[];\r\n    protected _pickedCorner: Entity | null;\r\n    protected _pickedCenter: Entity | null;\r\n    protected _startPos: Vec2 | null;\r\n    protected _startClick: Vec2;\r\n    protected _geometryLayer: Vector;\r\n    protected _cornerLayer: Vector;\r\n    protected _centerLayer: Vector;\r\n    protected _outlineLayer: Vector;\r\n    protected _ghostCorner: Entity;\r\n    protected _ghostOutlineLayer: Vector;\r\n    protected _showGhostPointer: boolean;\r\n    protected _isStartPoint: boolean;\r\n    protected _insertCornerIndex: number;\r\n    protected _cornerDblClick = false;\r\n\r\n    constructor(options: IPolygonDrawingSceneParams) {\r\n        super(options.name);\r\n\r\n        this.events = createEvents(POLYGONDRAWINGSCENE_EVENTS);\r\n\r\n        this._planet = null;\r\n\r\n        this._initCoordinates = options.coordinates || [];\r\n\r\n        this._pickedCorner = null;\r\n        this._pickedCenter = null;\r\n\r\n        this._startPos = null;\r\n        this._startClick = new Vec2();\r\n\r\n        this._geometryLayer = new Vector();\r\n\r\n        //\r\n        // outline vectors\r\n        //\r\n        this._cornerLayer = new Vector(\"corners\", {\r\n            pickingScale: 3,\r\n            pickingEnabled: true,\r\n            polygonOffsetUnits: -5,\r\n            relativeToGround: true,\r\n            scaleByDistance: [100, 4000000, 1.0]\r\n        });\r\n\r\n        this._centerLayer = new Vector(\"centers\", {\r\n            pickingScale: 3,\r\n            pickingEnabled: true,\r\n            polygonOffsetUnits: -5,\r\n            relativeToGround: true,\r\n            scaleByDistance: [100, 4000000, 1.0]\r\n        });\r\n\r\n        this._outlineLayer = new Vector(\"outline\", {\r\n            entities: [new Entity({\r\n                polyline: {\r\n                    path3v: [],\r\n                    isClosed: false,\r\n                    ...OUTLINE_OPTIONS\r\n                }\r\n            })],\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -5,\r\n            relativeToGround: true\r\n        });\r\n\r\n        this._outlineLayer.getEntities()[0].polyline!.altitude = OUTLINE_ALT;\r\n\r\n        //\r\n        // Ghost cursor pointer\r\n        //\r\n        this._ghostCorner = new Entity({\r\n            geoObject: CORNER_OPTIONS\r\n        });\r\n\r\n        this._ghostOutlineLayer = new Vector(\"ghost-pointer\", {\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -5,\r\n            relativeToGround: true,\r\n            scaleByDistance: [100, 4000000, 1.0],\r\n            opacity: 0.5\r\n        });\r\n\r\n        this._showGhostPointer = false;\r\n\r\n        this._isStartPoint = false;\r\n\r\n        this._insertCornerIndex = -1;\r\n    }\r\n\r\n    public get geometryType(): string {\r\n        return \"POLYGON\";\r\n    }\r\n\r\n    public getCoordinates(): CoordinatesType[] {\r\n        let corners = this._cornerLayer.getEntities();\r\n        if (corners.length > 0) {\r\n            return corners.map((c: Entity) => {\r\n                let ll = c.getLonLat();\r\n                return [ll.lon, ll.lat, ll.height];\r\n            });\r\n        } else {\r\n            return this._initCoordinates;\r\n        }\r\n    }\r\n\r\n    public bindPlanet(planet: Planet) {\r\n        this._planet = planet;\r\n    }\r\n\r\n    public override init() {\r\n\r\n        this._initEvents();\r\n\r\n        this._initGhostLayerPointer();\r\n\r\n        if (this._initCoordinates.length) {\r\n            this.setCoordinates(this._initCoordinates);\r\n        }\r\n\r\n        this._planet!.addLayer(this._outlineLayer);\r\n        this._planet!.addLayer(this._cornerLayer);\r\n        this._planet!.addLayer(this._centerLayer);\r\n\r\n        this.showGhostPointer();\r\n        this.startNewPoint();\r\n\r\n        this._geometryLayer.addTo(this._planet!);\r\n\r\n        this.events.on(\"change\", this._onChange, this);\r\n    }\r\n\r\n    protected _onChange = (e: PolygonDrawingScene) => {\r\n        if (e.geometryType === \"POLYGON\") {\r\n            let coords = this.getCoordinates();\r\n            let entity = new Entity({\r\n                'geometry': {\r\n                    'type': e.geometryType,\r\n                    'coordinates': [coords],\r\n                    'style': {\r\n                        'fillColor': \"rgba(0,146,247,0.2)\"\r\n                    }\r\n                }\r\n            });\r\n            this._geometryLayer.clear();\r\n            this._geometryLayer.add(entity);\r\n        }\r\n    }\r\n\r\n    override onremove() {\r\n        this._clearEvents();\r\n        this.hideGhostPointer();\r\n        this.stopNewPoint();\r\n        this.clear();\r\n        this._geometryLayer.remove();\r\n    }\r\n\r\n    public clear() {\r\n\r\n        this._geometryLayer.clear();\r\n\r\n        let corners = this._cornerLayer.getEntities();\r\n\r\n        let i = corners.length;\r\n        while (i--) {\r\n            corners[i].remove();\r\n        }\r\n\r\n        let centers = this._centerLayer.getEntities();\r\n        i = centers.length;\r\n        while (i--) {\r\n            centers[i].remove();\r\n        }\r\n\r\n        let entities = this._outlineLayer.getEntities();\r\n        i = entities.length;\r\n        while (i--) {\r\n            entities[i].polyline!.clear();\r\n            if (i > 0) {\r\n                entities[i].remove();\r\n            }\r\n        }\r\n\r\n        this._clearGhostPointer();\r\n    }\r\n\r\n    public setCoordinates(coords: CoordinatesType[]) {\r\n        this.clear();\r\n        for (let i = 0; i < coords.length; i++) {\r\n            let ci = coords[i];\r\n            let cart = this._planet!.ellipsoid.lonLatToCartesian(new LonLat(ci[0], ci[1], ci[2]));\r\n            this._appendCart(cart);\r\n        }\r\n        this.events.dispatch(this.events.change, this);\r\n    }\r\n\r\n    public stopNewPoint() {\r\n        if (this.renderer) {\r\n            this.renderer.events.off(\"ldblclick\", this._onMouseDblClick);\r\n        }\r\n    }\r\n\r\n    public startNewPoint() {\r\n        this.renderer!.events.on(\"ldblclick\", this._onMouseDblClick, this);\r\n    }\r\n\r\n    public showGhostPointer() {\r\n        this._showGhostPointer = true;\r\n        this._planet!.addLayer(this._ghostOutlineLayer);\r\n        this._insertCornerIndex = this._cornerLayer.getEntities().length;\r\n    }\r\n\r\n    public hideGhostPointer() {\r\n        this._showGhostPointer = false;\r\n        this._ghostOutlineLayer.remove();\r\n        this._insertCornerIndex = -1;\r\n    }\r\n\r\n    public setGhostPointerPosition(groundPos: Vec3) {\r\n        if (groundPos) {\r\n            this._ghostCorner.setCartesian3v(groundPos);\r\n            this._updateGhostOutlinePointer(groundPos);\r\n        }\r\n    }\r\n\r\n    protected _onCornerMouseEnter = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"pointer\";\r\n        this.hideGhostPointer();\r\n    }\r\n\r\n    _onCornerMouseLeave = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"default\";\r\n        this.showGhostPointer();\r\n    }\r\n\r\n    _onCenterMouseEnter = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"pointer\";\r\n        this.hideGhostPointer();\r\n    }\r\n\r\n    _onCenterMouseLeave = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"default\";\r\n        if (!(this._pickedCenter || this._pickedCorner)) {\r\n            this.showGhostPointer();\r\n        }\r\n    }\r\n\r\n    protected _onLup = (e: IMouseState) => {\r\n        (this._planet!.renderer!.controls.mouseNavigation as OldMouseNavigation).activate();\r\n        if (this._pickedCorner || this._pickedCenter) {\r\n            this.events.dispatch(this.events.change, this);\r\n            this.setGhostPointerPosition(this._planet!.getCartesianFromPixelTerrain(e)!);\r\n            this.showGhostPointer();\r\n            this._pickedCorner = null;\r\n            this._pickedCenter = null;\r\n        }\r\n    }\r\n\r\n    protected _getLdown(e: IMouseState): Entity | null {\r\n        (this._planet!.renderer!.controls.mouseNavigation as OldMouseNavigation).deactivate();\r\n        this._startClick.set(e.x, e.y);\r\n        let coords = e.pickingObject.getCartesian();\r\n        this._startPos = this._planet!.getPixelFromCartesian(coords);\r\n        return e.pickingObject;\r\n    }\r\n\r\n    protected _onCornerLdown = (e: IMouseState) => {\r\n        this._pickedCorner = this._getLdown(e);\r\n    }\r\n\r\n    protected _onCenterLdown = (e: IMouseState) => {\r\n        this._pickedCenter = this._getLdown(e);\r\n    }\r\n\r\n    protected _onMouseMove = (e: IMouseState) => {\r\n        if (this._pickedCenter) {\r\n            this._moveCenterPoint();\r\n        } else if (this._pickedCorner) {\r\n            this._moveCornerPoint(e.pos!);\r\n        } else {\r\n            this.setGhostPointerPosition(this._planet!.getCartesianFromPixelTerrain(e.pos)!);\r\n        }\r\n    }\r\n\r\n    protected _onCornerLdblclick = (e: IMouseState) => {\r\n        this._cornerDblClick = true;\r\n        let coords = this.getCoordinates();\r\n        coords.splice(e.pickingObject.layerIndex, 1);\r\n        this.setCoordinates(coords);\r\n    }\r\n\r\n    protected _onMouseDblClick = (e: IMouseState) => {\r\n\r\n        if (this._cornerDblClick) {\r\n            this._cornerDblClick = false;\r\n            return;\r\n        }\r\n\r\n        if (!this._showGhostPointer) {\r\n            return;\r\n        }\r\n\r\n        let cart = this._planet!.getCartesianFromPixelTerrain(e);\r\n        if (cart) {\r\n            this._addNew(cart);\r\n            if (!this._isStartPoint && this._cornerLayer.getEntities().length > 2) {\r\n                this._isStartPoint = true;\r\n                this.events.dispatch(this.events.startpoint, this);\r\n            }\r\n            this.events.dispatch(this.events.change, this);\r\n        }\r\n    }\r\n\r\n    protected _initEvents() {\r\n\r\n        this._cornerLayer.events.on(\"ldblclick\", this._onCornerLdblclick, this);\r\n        this._cornerLayer.events.on(\"ldown\", this._onCornerLdown, this);\r\n        this._centerLayer.events.on(\"ldown\", this._onCenterLdown, this);\r\n\r\n        this.renderer!.events.on(\"lup\", this._onLup, this);\r\n        this.renderer!.events.on(\"mousemove\", this._onMouseMove, this);\r\n\r\n        this._cornerLayer.events.on(\"mouseenter\", this._onCornerMouseEnter, this);\r\n        this._cornerLayer.events.on(\"mouseleave\", this._onCornerMouseLeave, this);\r\n        this._centerLayer.events.on(\"mouseenter\", this._onCenterMouseEnter, this);\r\n        this._centerLayer.events.on(\"mouseleave\", this._onCenterMouseLeave, this);\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        this._cornerLayer.events.off(\"ldblclick\", this._onCornerLdblclick);\r\n        this._cornerLayer.events.off(\"ldown\", this._onCornerLdown);\r\n        this._centerLayer.events.off(\"ldown\", this._onCenterLdown);\r\n\r\n        this.renderer!.events.off(\"lup\", this._onLup);\r\n        this.renderer!.events.off(\"mousemove\", this._onMouseMove);\r\n\r\n        this._cornerLayer.events.off(\"mouseenter\", this._onCornerMouseEnter);\r\n        this._cornerLayer.events.off(\"mouseleave\", this._onCornerMouseLeave);\r\n        this._centerLayer.events.off(\"mouseenter\", this._onCenterMouseEnter);\r\n        this._centerLayer.events.off(\"mouseleave\", this._onCenterMouseLeave);\r\n    }\r\n\r\n    protected _drawCorners() {\r\n        let corners = this._cornerLayer.getEntities();\r\n        for (let i = 0; i < corners.length; i++) {\r\n            let ai = corners[i];\r\n            this._checkTerrainCollision(ai);\r\n        }\r\n    }\r\n\r\n    protected _drawCenters() {\r\n        let centers = this._centerLayer.getEntities();\r\n        for (let i = 0; i < centers.length; i++) {\r\n            let ai = centers[i];\r\n            this._checkTerrainCollision(ai);\r\n        }\r\n    }\r\n\r\n    protected _drawGhostCorner() {\r\n        if (this._showGhostPointer) {\r\n            this._checkTerrainCollision(this._ghostCorner);\r\n        }\r\n    }\r\n\r\n    public override frame() {\r\n        this._drawCorners();\r\n        this._drawCenters();\r\n        this._drawGhostCorner();\r\n    }\r\n\r\n    protected _checkTerrainCollision(entity: Entity) {\r\n        let _tempTerrPoint = new Vec3();\r\n        let nodes = this._planet!._renderedNodes;\r\n        for (let j = 0; j < nodes.length; j++) {\r\n            let seg = nodes[j].segment;\r\n            if (seg && seg._extentLonLat.isInside(entity.getLonLat())) {\r\n                seg.getEntityTerrainPoint(entity, _tempTerrPoint);\r\n                entity.setCartesian3v(_tempTerrPoint);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _moveCenterPoint() {\r\n        let coords = this.getCoordinates(),\r\n            index = this._pickedCenter!.layerIndex + 1,\r\n            ll = this._pickedCenter!.getLonLat();\r\n        let newCorner: CoordinatesType = [ll.lon, ll.lat, ll.height];\r\n\r\n        coords.splice(index, 0, newCorner);\r\n\r\n        this.setCoordinates(coords);\r\n\r\n        this._pickedCenter = null;\r\n\r\n        this._pickedCorner = this._cornerLayer.getEntities()[index];\r\n    }\r\n\r\n    protected _addNew(cart: Vec3) {\r\n        if (this._insertCornerIndex === -1 || this._cornerLayer.getEntities().length < 2) {\r\n            this._appendCart(cart);\r\n        } else {\r\n            let area = this.getCoordinates(),\r\n                index = this._insertCornerIndex;\r\n            let ll = this._planet!.ellipsoid.cartesianToLonLat(cart);\r\n            let newCorner: CoordinatesType = [ll.lon, ll.lat, ll.height];\r\n            area.splice(index, 0, newCorner);\r\n            this.clear();\r\n            this.setCoordinates(area);\r\n        }\r\n    }\r\n\r\n    protected _appendCart(cart: Vec3) {\r\n        let corners = this._cornerLayer.getEntities();\r\n\r\n        let segNum = corners.length - 1;\r\n        let prevCorn = corners[segNum];\r\n\r\n        let corner = new Entity({\r\n            geoObject: CORNER_OPTIONS,\r\n        });\r\n\r\n        corner.setCartesian3v(cart);\r\n        corner.addTo(this._cornerLayer);\r\n        this._checkTerrainCollision(corner);\r\n\r\n        if (prevCorn) {\r\n\r\n            let firstCart = corners[0].getCartesian(),\r\n                prevCart = prevCorn.getCartesian();\r\n\r\n            let vecPrev = corner.getCartesian().sub(prevCart),\r\n                vecFirst = corner.getCartesian().sub(firstCart);\r\n\r\n            let distPrev = vecPrev.length(),\r\n                distFirst = vecFirst.length();\r\n\r\n            vecPrev.normalize();\r\n            vecFirst.normalize();\r\n\r\n            let prevPath = [],\r\n                firstPath = [];\r\n\r\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\r\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(prevCart);\r\n                prevPath.push(p);\r\n\r\n                let f = vecFirst.scaleTo(i * distFirst / NUM_SEGMENTS).addA(firstCart);\r\n                firstPath.push(f);\r\n            }\r\n\r\n            this._outlineLayer.getEntities()[0].polyline!.setPath3v([firstPath]);\r\n\r\n            let entity = new Entity({\r\n                polyline: {\r\n                    path3v: [prevPath],\r\n                    isClosed: false,\r\n                    ...OUTLINE_OPTIONS\r\n                }\r\n            });\r\n            entity.polyline!.altitude = OUTLINE_ALT;\r\n            this._outlineLayer.add(entity);\r\n\r\n            let centers = this._centerLayer.getEntities();\r\n            let firstCenter = centers[centers.length - 1];\r\n\r\n            let prevCenterCart = vecPrev.scaleTo(distPrev * 0.5).addA(prevCart),\r\n                firstCenterCart = vecFirst.scaleTo(distFirst * 0.5).addA(firstCart);\r\n\r\n            let center = new Entity({\r\n                geoObject: CENTER_OPTIONS,\r\n            });\r\n            center.setCartesian3v(prevCenterCart);\r\n            center.addTo(this._centerLayer);\r\n            this._checkTerrainCollision(center);\r\n\r\n            //moveToEnd\r\n            firstCenter.remove();\r\n            firstCenter.addTo(this._centerLayer);\r\n\r\n            firstCenter.setCartesian3v(firstCenterCart);\r\n\r\n        } else {\r\n            let center = new Entity({\r\n                geoObject: CENTER_OPTIONS,\r\n            });\r\n            center.addTo(this._centerLayer);\r\n        }\r\n    }\r\n\r\n    protected _clearGhostPointer() {\r\n        const g = this._ghostOutlineLayer;\r\n        g.getEntities()[0].polyline!.clear();\r\n        g.getEntities()[1].polyline!.clear();\r\n    }\r\n\r\n    protected _moveCornerPoint(e: Vec2) {\r\n        let d = new Vec2(e.x, e.y).sub(this._startClick),\r\n            p = this._startPos!.add(d);\r\n\r\n        let groundCoords = this._planet!.getCartesianFromPixelTerrain(p);\r\n\r\n        if (groundCoords) {\r\n\r\n            this._pickedCorner!.setCartesian3v(groundCoords);\r\n\r\n            let corners = this._cornerLayer.getEntities();\r\n\r\n            if (corners.length) {\r\n                let ind = this._pickedCorner!.layerIndex;\r\n                let size = corners.length;\r\n\r\n                let cartPrev = corners[ind === 0 ? (size - 1) : (ind - 1)].getCartesian(),\r\n                    cartNext = corners[(ind + 1) % size].getCartesian();\r\n\r\n                let vecPrev = this._pickedCorner!.getCartesian().sub(cartPrev),\r\n                    vecNext = this._pickedCorner!.getCartesian().sub(cartNext);\r\n\r\n                let distPrev = vecPrev.length(),\r\n                    distNext = vecNext.length();\r\n\r\n                vecPrev.normalize();\r\n                vecNext.normalize();\r\n\r\n                let pathPrev = [],\r\n                    pathNext = [];\r\n\r\n                for (let i = 0; i <= NUM_SEGMENTS; i++) {\r\n                    let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(cartPrev);\r\n                    pathPrev.push(p);\r\n\r\n                    let f = vecNext.scaleTo(i * distNext / NUM_SEGMENTS).addA(cartNext);\r\n                    pathNext.push(f);\r\n                }\r\n\r\n                let entities = this._outlineLayer.getEntities();\r\n\r\n                let prevPolyline = entities[ind].polyline,\r\n                    nextPolyline = entities[(ind + 1) % size].polyline;\r\n\r\n                prevPolyline?.setPath3v([pathPrev]);\r\n                nextPolyline?.setPath3v([pathNext]);\r\n\r\n                //\r\n                // Move center points\r\n                let centers = this._centerLayer.getEntities();\r\n                let prevCenter = centers[ind === 0 ? (size - 1) : (ind - 1)],\r\n                    nextCenter = centers[ind];\r\n\r\n                let prevCenterCart = vecPrev.scaleTo(distPrev * 0.5).addA(cartPrev),\r\n                    nextCenterCart = vecNext.scaleTo(distNext * 0.5).addA(cartNext);\r\n\r\n                prevCenter.setCartesian3v(prevCenterCart);\r\n                this._checkTerrainCollision(prevCenter);\r\n\r\n                nextCenter.setCartesian3v(nextCenterCart);\r\n                this._checkTerrainCollision(nextCenter);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _updateGhostOutlinePointer(groundPos: Vec3) {\r\n\r\n        let corners = this._cornerLayer.getEntities();\r\n        let size = corners.length;\r\n\r\n        if (size > 0) {\r\n\r\n            let ind = 0;\r\n\r\n            let minDist = math.MAX;\r\n\r\n            for (let i = 0; i < size; i++) {\r\n                let ci = corners[i];\r\n                let dist = ci.getCartesian().distance(groundPos);\r\n                if (dist < minDist) {\r\n                    minDist = dist;\r\n                    ind = i;\r\n                }\r\n            }\r\n\r\n            let cCurr = corners[ind].getCartesian(),\r\n                cNext = corners[(ind + 1) % size].getCartesian(),\r\n                cPrev = corners[ind === 0 ? (size - 1) : (ind - 1)].getCartesian();\r\n\r\n            let nPrev = cPrev.sub(cCurr).normalize(),\r\n                nNext = cNext.sub(cCurr).normalize(),\r\n                nGround = groundPos.sub(cCurr).normalize();\r\n\r\n            let midVec = nPrev.add(nNext).normalize();\r\n\r\n            let toMid = nGround.cross(midVec),\r\n                up = nPrev.cross(nNext);\r\n\r\n            if (toMid.dot(up) > 0) {\r\n                ind--;\r\n                if (ind < 0) {\r\n                    ind = size - 1;\r\n                }\r\n            }\r\n\r\n            let temp = new Vec3();\r\n\r\n            for (let i = 0; i < size; i++) {\r\n                let side = new Line3(corners[i].getCartesian(), corners[(i + 1) % size].getCartesian());\r\n                let u = side.getNearestDistancePoint(groundPos, temp);\r\n                if (u) {\r\n                    let dist = temp.distance(groundPos);\r\n                    if (dist < minDist) {\r\n                        minDist = dist;\r\n                        ind = i;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._insertCornerIndex = (ind + 1) % size;\r\n\r\n            let cartPrev = corners[ind % size].getCartesian(),\r\n                cartNext = corners[(ind + 1) % size].getCartesian();\r\n\r\n            let vecPrev = this._ghostCorner.getCartesian().sub(cartPrev),\r\n                vecNext = this._ghostCorner.getCartesian().sub(cartNext);\r\n\r\n            let distPrev = vecPrev.length(),\r\n                distNext = vecNext.length();\r\n\r\n            vecPrev.normalize();\r\n            vecNext.normalize();\r\n\r\n            let pathPrev = [],\r\n                pathNext = [];\r\n\r\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\r\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(cartPrev);\r\n                pathPrev.push(p);\r\n\r\n                let f = vecNext.scaleTo(i * distNext / NUM_SEGMENTS).addA(cartNext);\r\n                pathNext.push(f);\r\n            }\r\n\r\n            let entities = this._ghostOutlineLayer.getEntities();\r\n\r\n            let prevPolyline = entities[0].polyline,\r\n                nextPolyline = entities[1].polyline;\r\n\r\n            prevPolyline?.setPath3v([pathPrev]);\r\n            nextPolyline?.setPath3v([pathNext]);\r\n        }\r\n    }\r\n\r\n    protected _initGhostLayerPointer() {\r\n        this._ghostOutlineLayer.setEntities([\r\n            new Entity({\r\n                polyline: {\r\n                    path3v: [],\r\n                    isClosed: false,\r\n                    ...OUTLINE_OPTIONS\r\n                }\r\n            }), new Entity({\r\n                polyline: {\r\n                    path3v: [],\r\n                    isClosed: false,\r\n                    ...OUTLINE_OPTIONS\r\n                }\r\n            }),\r\n            this._ghostCorner\r\n        ]);\r\n\r\n        const g = this._ghostOutlineLayer;\r\n        g.getEntities()[0].polyline!.altitude = g.getEntities()[1].polyline!.altitude = OUTLINE_ALT;\r\n    }\r\n}\r\n\r\nexport {PolygonDrawingScene};\r\n","import {Entity} from \"../../entity/Entity\";\r\nimport {Vec2} from \"../../math/Vec2\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport {\r\n    CENTER_OPTIONS,\r\n    CORNER_OPTIONS,\r\n    NUM_SEGMENTS,\r\n    OUTLINE_ALT,\r\n    OUTLINE_OPTIONS,\r\n    PolygonDrawingScene,\r\n    type IPolygonDrawingSceneParams\r\n} from \"./PolygonDrawingScene\";\r\n\r\nclass LineStringDrawingScene extends PolygonDrawingScene {\r\n    constructor(props: IPolygonDrawingSceneParams) {\r\n        super(props);\r\n    }\r\n\r\n    public override get geometryType(): string {\r\n        return \"LineString\";\r\n    }\r\n\r\n    protected override _addNew(cart: Vec3) {\r\n        this._appendCart(cart);\r\n    }\r\n\r\n    protected override _appendCart(cart: Vec3) {\r\n        let corners = this._cornerLayer.getEntities();\r\n\r\n        let segNum = corners.length - 1;\r\n        let prevCorn = corners[segNum];\r\n\r\n        let corner = new Entity({\r\n            geoObject: CORNER_OPTIONS,\r\n        });\r\n\r\n        corner.setCartesian3v(cart);\r\n        corner.addTo(this._cornerLayer);\r\n        this._checkTerrainCollision(corner);\r\n\r\n        if (prevCorn) {\r\n\r\n            let prevCart = prevCorn.getCartesian();\r\n\r\n            let vecPrev = corner.getCartesian().sub(prevCart);\r\n\r\n            let distPrev = vecPrev.length();\r\n\r\n            vecPrev.normalize();\r\n\r\n            let prevPath = [];\r\n\r\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\r\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(prevCart);\r\n                prevPath.push(p);\r\n            }\r\n\r\n            let entity = new Entity({\r\n                polyline: {\r\n                    path3v: [prevPath],\r\n                    isClosed: false,\r\n                    ...OUTLINE_OPTIONS\r\n                }\r\n            });\r\n            entity.polyline!.altitude = OUTLINE_ALT;\r\n            this._outlineLayer.add(entity);\r\n\r\n            let prevCenterCart = vecPrev.scaleTo(distPrev * 0.5).addA(prevCart);\r\n\r\n            let center = new Entity({\r\n                geoObject: CENTER_OPTIONS,\r\n            });\r\n            center.setCartesian3v(prevCenterCart);\r\n            center.addTo(this._centerLayer);\r\n            this._checkTerrainCollision(center);\r\n\r\n        }\r\n    }\r\n\r\n    protected override _clearGhostPointer() {\r\n        this._ghostOutlineLayer.getEntities()[0].polyline!.clear();\r\n    }\r\n\r\n    protected _moveCorner(indexCurrent: number, indexPrev: number, indexCenter: number) {\r\n        let corners = this._cornerLayer.getEntities();\r\n        if (corners.length == 0) return;\r\n        if (corners.length == 1) {\r\n            indexCurrent = indexPrev = indexCenter = 0;\r\n        }\r\n        let cartCurr = corners[indexCurrent].getCartesian();\r\n        let vecCurr = this._pickedCorner!.getCartesian().sub(cartCurr);\r\n        let distCurr = vecCurr.length();\r\n        vecCurr.normalize();\r\n\r\n        let path = [];\r\n        for (let i = 0; i <= NUM_SEGMENTS; i++) {\r\n            let p = vecCurr.scaleTo(i * distCurr / NUM_SEGMENTS).addA(cartCurr);\r\n            path.push(p);\r\n        }\r\n\r\n        let entities = this._outlineLayer.getEntities();\r\n\r\n        let prevPolyline = entities[indexPrev].polyline;\r\n\r\n        prevPolyline?.setPath3v([path]);\r\n\r\n        //\r\n        // Move center points\r\n        let centers = this._centerLayer.getEntities();\r\n        let center = centers[indexCenter];\r\n\r\n        if (center) {\r\n            let centerCart = vecCurr.scaleTo(distCurr * 0.5).addA(cartCurr);\r\n            center.setCartesian3v(centerCart);\r\n            this._checkTerrainCollision(center);\r\n        }\r\n    }\r\n\r\n    protected override _moveCornerPoint(e: Vec2) {\r\n        let d = new Vec2(e.x, e.y).sub(this._startClick),\r\n            p = this._startPos!.add(d);\r\n\r\n        let groundCoords = this._planet!.getCartesianFromPixelTerrain(p);\r\n\r\n        if (groundCoords) {\r\n\r\n            this._pickedCorner!.setCartesian3v(groundCoords);\r\n\r\n            let corners = this._cornerLayer.getEntities();\r\n\r\n            if (corners.length) {\r\n                let ind = this._pickedCorner!.layerIndex;\r\n\r\n                if (ind === 0) {\r\n                    this._moveCorner(ind + 1, ind + 1, ind);\r\n                } else if (ind === corners.length - 1) {\r\n                    this._moveCorner(ind - 1, ind, ind - 1);\r\n                } else {\r\n                    this._moveCorner(ind + 1, ind + 1, ind);\r\n                    this._moveCorner(ind - 1, ind, ind - 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public override _updateGhostOutlinePointer(groundPos: Vec3) {\r\n\r\n        let corners = this._cornerLayer.getEntities();\r\n        let size = corners.length;\r\n\r\n        if (size > 0) {\r\n\r\n            let ind = size - 1;\r\n\r\n            this._insertCornerIndex = ind;\r\n\r\n            let cartPrev = corners[ind].getCartesian();\r\n\r\n            let vecPrev = this._ghostCorner.getCartesian().sub(cartPrev);\r\n\r\n            let distPrev = vecPrev.length();\r\n\r\n            vecPrev.normalize();\r\n\r\n            let pathPrev = [];\r\n\r\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\r\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(cartPrev);\r\n                pathPrev.push(p);\r\n            }\r\n\r\n            let entities = this._ghostOutlineLayer.getEntities();\r\n\r\n            let prevPolyline = entities[0].polyline!;\r\n\r\n            prevPolyline.setPath3v([pathPrev]);\r\n        }\r\n    }\r\n\r\n    protected override _initGhostLayerPointer() {\r\n        this._ghostOutlineLayer.setEntities([\r\n            new Entity({\r\n                polyline: {\r\n                    path3v: [],\r\n                    isClosed: false,\r\n                    ...OUTLINE_OPTIONS\r\n                }\r\n            }),\r\n            this._ghostCorner\r\n        ]);\r\n\r\n        this._ghostOutlineLayer.getEntities()[0].polyline!.altitude = OUTLINE_ALT;\r\n    }\r\n}\r\n\r\nexport {LineStringDrawingScene};\r\n","import {Control, type IControlParams} from \"../Control\";\r\nimport {LineStringDrawingScene} from \"./LineStringDrawingScene\";\r\nimport {PolygonDrawingScene} from \"./PolygonDrawingScene\";\r\n\r\nclass DrawingControl extends Control {\r\n    protected _drawingScene: PolygonDrawingScene;\r\n\r\n    constructor(options: IControlParams = {}) {\r\n        super(options);\r\n\r\n        this._drawingScene = new LineStringDrawingScene({\r\n            name: `drawingScene:${this.__id}`\r\n        });\r\n    }\r\n\r\n    public activatePolygonDrawing() {\r\n        this.deactivate();\r\n        this._drawingScene = new PolygonDrawingScene({\r\n            name: `polygonDrawingScene:${this.__id}`\r\n        });\r\n        this.activate();\r\n    }\r\n\r\n    public activateLineStringDrawing() {\r\n        this.deactivate();\r\n        this._drawingScene = new LineStringDrawingScene({\r\n            name: `linestringDrawingScene:${this.__id}`\r\n        });\r\n        this.activate();\r\n    }\r\n\r\n    public override oninit() {\r\n    }\r\n\r\n    public override onactivate() {\r\n        this.planet && this._drawingScene.bindPlanet(this.planet);\r\n        this.renderer && this.renderer.addNode(this._drawingScene);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        this.renderer && this.renderer.removeNode(this._drawingScene);\r\n    }\r\n}\r\n\r\nexport {DrawingControl};\r\n","import {ButtonGroup} from \"../ui/ButtonGroup\";\r\nimport {Control} from \"./Control\";\r\nimport {DrawingControl} from \"./drawing/DrawingControl\";\r\nimport {ToggleButton} from \"../ui/ToggleButton\";\r\n\r\nconst ICON_POLYGON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<!-- Generator: Adobe Illustrator 24.1.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\r\n<svg version=\"1.1\" id=\"Layer_2\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\r\n\\t viewBox=\"0 0 1024 1024\" style=\"enable-background:new 0 0 1024 1024;\" xml:space=\"preserve\">\r\n<g>\r\n\\t<path d=\"M926.03,321.16c-16.02,0-31.11,3.94-44.48,10.79l-263.43-191.4c2.69-8.94,4.18-18.4,4.18-28.2\r\n\\t\\tc0-54.02-43.95-97.97-97.97-97.97c-54.03,0-97.98,43.95-97.98,97.97c0,9.81,1.49,19.27,4.18,28.21L155.75,340.18\r\n\\t\\tc-16.22-11.91-36.16-19.03-57.78-19.03C43.95,321.16,0,365.11,0,419.13c0,52.58,41.67,95.5,93.71,97.75l102.63,315.86\r\n\\t\\tc-24.28,17.85-40.13,46.52-40.13,78.9c0,54.02,43.95,97.98,97.98,97.98c37.54,0,70.18-21.25,86.62-52.34h367.26\r\n\\t\\tc16.44,31.08,49.08,52.34,86.63,52.34c54.03,0,97.98-43.95,97.98-97.98c0-32.46-15.94-61.21-40.33-79.05l104.11-320.4\r\n\\t\\tc39.15-12.84,67.54-49.68,67.54-93.07C1024,365.11,980.05,321.16,926.03,321.16z M828.05,911.65c0,8.5-3.3,16.19-8.55,22.09\r\n\\t\\tc-6.11,6.85-14.9,11.26-24.79,11.26c-13.65,0-25.37-8.26-30.52-20.02c-1.79-4.09-2.82-8.58-2.82-13.33\r\n\\t\\tc0-18.39,14.95-33.35,33.34-33.35c2.93,0,5.72,0.5,8.43,1.21c13.27,3.49,23.21,14.91,24.59,28.9\r\n\\t\\tC827.83,909.5,828.05,910.54,828.05,911.65z M790.48,813.89c-45.63,1.96-83.27,35.16-91.87,78.77H350.28\r\n\\t\\tc-8.62-43.69-46.38-76.93-92.11-78.79L155.59,498.19c24.41-17.84,40.36-46.59,40.36-79.06c0-8.9-1.3-17.49-3.53-25.7L468.57,192.8\r\n\\t\\tc15.84,11.01,35.05,17.52,55.76,17.52c20.71,0,39.92-6.5,55.76-17.52l256.56,186.4c-5.48,12.21-8.59,25.7-8.59,39.93\r\n\\t\\tc0,41.02,25.36,76.17,61.21,90.75L790.48,813.89z M254.19,945c-10.11,0-19.07-4.62-25.19-11.75c-5.01-5.84-8.15-13.32-8.15-21.6\r\n\\t\\tc0-0.91,0.2-1.76,0.27-2.66c1.14-14.18,11.08-25.8,24.43-29.41c2.78-0.75,5.64-1.28,8.65-1.28c18.38,0,33.33,14.96,33.33,33.35\r\n\\t\\tc0,4.74-1.03,9.24-2.82,13.33C279.55,936.74,267.83,945,254.19,945z M64.88,421.49c-0.06-0.79-0.24-1.55-0.24-2.35\r\n\\t\\tc0-16.41,11.93-30.01,27.55-32.76c1.89-0.33,3.8-0.58,5.78-0.58c11.94,0,22.35,6.36,28.24,15.81c3.18,5.11,5.11,11.09,5.11,17.53\r\n\\t\\tc0,15.47-10.63,28.39-24.94,32.14c-2.7,0.71-5.48,1.2-8.4,1.2C80.4,452.47,66.11,438.76,64.88,421.49z M549.41,90.62\r\n\\t\\tc5.07,5.85,8.25,13.39,8.25,21.72c0,7.32-2.44,14.03-6.45,19.54c-6.07,8.33-15.82,13.81-26.88,13.81\r\n\\t\\tc-11.07,0-20.83-5.48-26.89-13.81c-4.01-5.51-6.45-12.22-6.45-19.54c0-8.33,3.17-15.86,8.24-21.71\r\n\\t\\tc6.12-7.07,15.04-11.64,25.1-11.64C534.38,79,543.29,83.57,549.41,90.62z M959.36,419.13c0,11.94-6.36,22.35-15.82,28.24\r\n\\t\\tc-5.1,3.18-11.07,5.1-17.52,5.1c-6.08,0-11.71-1.76-16.62-4.61c-9.71-5.64-16.33-15.94-16.64-27.89c-0.01-0.29-0.09-0.56-0.09-0.85\r\n\\t\\tc0-11.75,6.14-22.05,15.36-28c5.2-3.35,11.35-5.35,17.99-5.35C944.41,385.78,959.36,400.75,959.36,419.13z\"/>\r\n</g>\r\n</svg>`;\r\n\r\nconst ICON_LINESTRING_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- License: MIT. Made by Esri: https://github.com/Esri/calcite-ui-icons -->\r\n    <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M21 6h.046l-5.25 9h-.944L10 9.455V7H7v2.926L1.862 18H0v3h3v-2.926L8.138 10h1.01L14 15.545V18h3v-3h-.046l5.25-9H24V3h-3zM8 8h1v1H8zM2 20H1v-1h1zm14-3h-1v-1h1zm7-13v1h-1V4z\"/></svg>`;\r\n\r\nconst ICON_DEFAULT_SVG = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M4 0l16 12.279-6.951 1.17 4.325 8.817-3.596 1.734-4.35-8.879-5.428 4.702z\"/></svg>`;\r\n\r\n/**\r\n * Activate drawing control\r\n */\r\nexport class DrawingSwitcher extends Control {\r\n    public drawingControl: DrawingControl;\r\n\r\n    constructor(options = {}) {\r\n        super({\r\n            name: \"DrawingSwitcher\",\r\n            ...options\r\n        });\r\n\r\n        this.drawingControl = new DrawingControl();\r\n    }\r\n\r\n    public override oninit() {\r\n        this.planet!.addControl(this.drawingControl);\r\n        this._createMenu();\r\n    }\r\n\r\n    public override onactivate() {\r\n        this.drawingControl.activate();\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        this.drawingControl.deactivate();\r\n    }\r\n\r\n    protected _createMenu() {\r\n\r\n        let defaultBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-drawing-default_button\"],\r\n            icon: ICON_DEFAULT_SVG,\r\n            name: \"default\",\r\n            isActive: true\r\n        });\r\n\r\n        let polyBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-drawing-polygon_button\"],\r\n            icon: ICON_POLYGON_SVG,\r\n            name: \"polygon\"\r\n        });\r\n\r\n        let lineBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-drawing-linestring_button\"],\r\n            icon: ICON_LINESTRING_SVG,\r\n            name: \"linestring\"\r\n        });\r\n\r\n        let buttons = new ButtonGroup({\r\n            buttons: [\r\n                defaultBtn, polyBtn, lineBtn\r\n            ]\r\n        });\r\n\r\n        buttons.events.on(\"change\", (btn: ToggleButton) => {\r\n            this.drawingControl.deactivate();\r\n            switch (btn.name) {\r\n                case \"polygon\":\r\n                    this.drawingControl.activatePolygonDrawing();\r\n                    break;\r\n                case \"linestring\":\r\n                    this.drawingControl.activateLineStringDrawing();\r\n                    break;\r\n            }\r\n        });\r\n\r\n        defaultBtn.appendTo(this.renderer!.div!)\r\n        polyBtn.appendTo(this.renderer!.div!);\r\n        lineBtn.appendTo(this.renderer!.div!);\r\n    }\r\n}\r\n","export const ELL = 0;\r\nexport const MSL = 1;\r\nexport const GND = 2;\r\n\r\nexport const heightMode: Record<string, number> = {\r\n    \"ell\": ELL,\r\n    \"msl\": MSL,\r\n    \"gnd\": GND\r\n};\r\n\r\nconst KM_to_M = 1000.0;\r\nconst M_to_KM = 1.0 / KM_to_M;\r\nconst FT_to_M = 0.3048;\r\nconst M_to_FT = 1.0 / FT_to_M;\r\nconst MS_to_KMH = 3.6;\r\nconst KMH_to_MS = 1.0 / MS_to_KMH;\r\nconst MS_to_FTS = 3.28084;\r\nconst FT_to_KM = FT_to_M * M_to_KM;\r\nconst KM_to_FT = 1.0 / FT_to_KM;\r\n\r\nexport const m = 0;\r\nexport const km = 1;\r\nexport const ft = 2;\r\nexport const s = 3;\r\nexport const h = 4;\r\nexport const ms = 5;\r\nexport const kmh = 6;\r\nexport const fts = 7;\r\n\r\nconst DEFAULT_NAN = \"--\";\r\n\r\nconst _abbr: string[] = [\"m\", \"km\", \"ft\", \"s\", \"h\", \"m/s\", \"km/h\", \"ft/s\"];\r\n\r\nexport const _tenth = [0, 2, 0, 0, 0, 0, 0, 0];\r\n\r\n\r\nlet _convFn: ((v: number) => number)[][] = [];\r\n\r\n_convFn[m] = [];\r\n_convFn[m][m] = (v: number): number => v;\r\n_convFn[m][km] = (v: number): number => v * M_to_KM;\r\n_convFn[m][ft] = (v: number): number => v * M_to_FT;\r\n\r\n_convFn[ft] = [];\r\n_convFn[ft][m] = (v: number): number => v * FT_to_M;\r\n_convFn[ft][km] = (v: number): number => v * FT_to_KM;\r\n_convFn[ft][ft] = (v: number): number => v;\r\n\r\n_convFn[km] = [];\r\n_convFn[km][m] = (v: number): number => v * KM_to_M;\r\n_convFn[km][km] = (v: number): number => v;\r\n_convFn[km][ft] = (v: number): number => v * KM_to_FT;\r\n\r\n_convFn[ms] = [];\r\n_convFn[ms][ms] = (v: number): number => v;\r\n_convFn[ms][kmh] = (v: number): number => v * MS_to_KMH;\r\n_convFn[ms][fts] = (v: number): number => v * MS_to_FTS;\r\n\r\n_convFn[kmh] = [];\r\n_convFn[kmh][ms] = (v: number): number => v * KMH_to_MS;\r\n_convFn[kmh][kmh] = (v: number): number => v;\r\n\r\n//_convFn[kmh][fts] = (v) => v * KMH_to_FTS;\r\n\r\nexport function convert(from: number, to: number, val: number): number {\r\n    return _convFn[from][to](val);\r\n}\r\n\r\nexport function convertExt(isNotNaN: boolean, unitFrom: number, unitTo: number, val: number, fixed?: number): string {\r\n    if (isNotNaN) {\r\n        return convert(unitFrom, unitTo, val).toFixed(fixed || _tenth[unitTo]);\r\n    }\r\n    return DEFAULT_NAN;\r\n}\r\n\r\nexport function toString(u: number) {\r\n    return _abbr[u];\r\n}","import * as units from '../utils/units';\r\nimport {Control, type IControlParams} from './Control';\r\nimport {heightMode} from '../utils/units';\r\nimport {LonLat} from '../LonLat';\r\nimport {throttle} from '../utils/shared';\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\n\r\ninterface IEarthCoordinatesParams extends IControlParams {\r\n    heightMode?: string;\r\n    centerMode?: boolean;\r\n    altitudeUnit?: string;\r\n    type?: number\r\n}\r\n\r\nconst DECIMAL_TEMPLATE =\r\n    `<div class=\"og-lat-side\"></div><div class=\"og-lat-val\"></div>\r\n    <div class=\"og-lon-side\"></div><div class=\"og-lon-val\"></div>\r\n    <div class=\"og-height\"></div>\r\n    <div class=\"og-units-height\"></div>`;\r\n\r\nconst DEGREE_TEMPLATE =\r\n    `<div class=\"og-lat-side\"></div><div class=\"og-lat-val\"></div>\r\n    <div class=\"og-lon-side\"></div><div class=\"og-lon-val\"></div>\r\n    <div class=\"og-height\"></div>\r\n    <div class=\"og-units-height\"></div>`;\r\n\r\nconst CENTER_SVG = '<svg width=\"12\" height=\"12\"><g><path stroke-width=\"1\" stroke-opacity=\"1\" d=\"M6 0L6 12M0 6L12 6\" stroke=\"#337ab7\"></path></g></svg>';\r\n\r\nconst TYPE_HTML = [DECIMAL_TEMPLATE, DEGREE_TEMPLATE];\r\n\r\n/**\r\n * Control displays mouse or screen center Earth coordinates.\r\n * @param {Boolean} [options.center] - Earth coordinates by screen center otherwise mouse pointer. False is default.\r\n * @param {Boolean} [options.type] - Coordinates shown: 0 - is decimal degrees, 1 - degrees, 2 - mercator geodetic coordinates.\r\n */\r\nexport class EarthCoordinates extends Control {\r\n    protected _type: number;\r\n    protected _TYPE_FUNC: ((ll?: LonLat | null) => void)[];\r\n    protected _showFn: ((ll?: LonLat | null) => void) | null;\r\n    protected _lonLat: LonLat | null;\r\n    protected _latSideEl: HTMLElement | null;\r\n    protected _lonSideEl: HTMLElement | null;\r\n    protected _latValEl: HTMLElement | null;\r\n    protected _lonValEl: HTMLElement | null;\r\n    protected _heightEl: HTMLElement | null;\r\n    protected _altUnitVal: string;\r\n    protected _heightModeVal: string;\r\n    protected _altUnit: number;\r\n    protected _heightMode: number;\r\n    protected _centerMode: boolean;\r\n    protected _el: HTMLElement | null;\r\n\r\n    constructor(options: IEarthCoordinatesParams = {}) {\r\n        super(options);\r\n\r\n        this._type = options.type || 0;\r\n\r\n        this._TYPE_FUNC = [this._SHOW_DECIMAL, this._SHOW_DEGREE];\r\n\r\n        this._showFn = null;\r\n\r\n        this._el = null;\r\n        this._latSideEl = null;\r\n        this._lonSideEl = null;\r\n        this._latValEl = null;\r\n        this._lonValEl = null;\r\n        this._heightEl = null;\r\n\r\n        this._altUnitVal = options.altitudeUnit || \"m\";\r\n        this._heightModeVal = options.heightMode || \"ell\";\r\n\r\n        this._altUnit = (units as any)[this._altUnitVal];\r\n        this._heightMode = heightMode[this._heightModeVal];\r\n\r\n        this._lonLat = null;\r\n\r\n        this._centerMode = false;//options.centerMode != undefined ? options.centerMode : true;\r\n    }\r\n\r\n    protected _SHOW_DECIMAL(ll?: LonLat | null) {\r\n        if (ll) {\r\n            let lat = ll.lat,\r\n                lon = ll.lon;\r\n\r\n            if (lat >= 0) {\r\n                this._latSideEl!.innerHTML = 'N';\r\n            } else {\r\n                this._latSideEl!.innerHTML = 'S';\r\n            }\r\n\r\n            if (lon >= 0) {\r\n                this._lonSideEl!.innerHTML = 'E';\r\n            } else {\r\n                this._lonSideEl!.innerHTML = 'W';\r\n            }\r\n\r\n            this._latValEl!.innerHTML = Math.abs(lat).toFixed(7) + '°';\r\n            this._lonValEl!.innerHTML = Math.abs(lon).toFixed(7) + '°';\r\n        }\r\n    }\r\n\r\n    protected _SHOW_DEGREE(ll?: LonLat | null) {\r\n        if (ll) {\r\n            let lat = ll.lat,\r\n                lon = ll.lon;\r\n\r\n            if (lat >= 0) {\r\n                this._latSideEl!.innerHTML = 'N';\r\n            } else {\r\n                this._latSideEl!.innerHTML = 'S';\r\n            }\r\n\r\n            if (lon >= 0) {\r\n                this._lonSideEl!.innerHTML = 'E';\r\n            } else {\r\n                this._lonSideEl!.innerHTML = 'W';\r\n            }\r\n\r\n            let t = 0;\r\n\r\n            let deg = lat < 0 ? Math.ceil(lat) : Math.floor(lat);\r\n            let min = Math.floor(t = Math.abs((lat - deg)) * 60);\r\n            let sec = Math.floor((t - min) * 6000) / 100.0;\r\n            this._latValEl!.innerHTML = Math.abs(deg) + '°' + min + \"'\" + sec.toFixed(0) + '\"';\r\n\r\n            deg = lon < 0 ? Math.ceil(lon) : Math.floor(lon);\r\n            min = Math.floor(t = Math.abs((lon - deg)) * 60);\r\n            sec = Math.floor((t - min) * 6000) / 100.0;\r\n            this._lonValEl!.innerHTML = Math.abs(deg) + '°' + min + \"'\" + sec.toFixed(0) + '\"';\r\n        }\r\n    }\r\n\r\n    protected _createCenterEl(): HTMLElement {\r\n        let el = document.createElement('div');\r\n        el.className = 'og-center-icon';\r\n        el.innerHTML = CENTER_SVG;\r\n        return el;\r\n    }\r\n\r\n    protected _updateUnits() {\r\n        this._heightMode = heightMode[this._heightModeVal];\r\n        this._altUnit = (units as any)[this._altUnitVal];\r\n        this._el!.querySelector(\".og-units-height\")!.innerHTML = units.toString(this._altUnit);\r\n        this._showHeight();\r\n    }\r\n\r\n    protected _refreshCoordinates() {\r\n\r\n        if (this._type >= this._TYPE_FUNC.length) {\r\n            this._type = 0;\r\n        }\r\n\r\n        let el = this._el!;\r\n\r\n        el.innerHTML = TYPE_HTML[this._type];\r\n\r\n        this._latSideEl = el.querySelector(\".og-lat-side\");\r\n        this._lonSideEl = el.querySelector(\".og-lon-side\");\r\n        this._latValEl = el.querySelector(\".og-lat-val\");\r\n        this._lonValEl = el.querySelector(\".og-lon-val\");\r\n        this._heightEl = el.querySelector(\".og-height\");\r\n\r\n        this._showFn = this._TYPE_FUNC[this._type];\r\n        this._showFn(this._lonLat);\r\n    }\r\n\r\n    public override oninit() {\r\n        this._el = document.createElement('div');\r\n        this._el.classList.add(\"og-coordinates\");\r\n\r\n        this.renderer!.div!.appendChild(this._el);\r\n\r\n        this._el.addEventListener(\"click\", () => {\r\n            this._type++;\r\n            this._refreshCoordinates();\r\n            this._updateUnits();\r\n            this._showHeight();\r\n        });\r\n\r\n        if (this._centerMode) {\r\n            this.renderer!.div!.appendChild(this._createCenterEl());\r\n            this.planet!.camera.events.on(\"moveend\", this._grabCoordinates, this);\r\n            this.planet!.camera.events.on(\"moveend\", throttle(() => this._showHeight(), 400, true), this);\r\n        } else {\r\n            this.renderer!.events.on(\"mousemove\", this._grabCoordinates, this);\r\n            this.renderer!.events.on(\"mousestop\", throttle(() => this._showHeight(), 400, true), this);\r\n        }\r\n\r\n        this._refreshCoordinates();\r\n\r\n        this._updateUnits();\r\n    }\r\n\r\n    protected _grabCoordinates(e: IMouseState) {\r\n        let px = e.pos;\r\n        let scrPx;\r\n        let r = this.renderer;\r\n        if (this._centerMode) {\r\n            scrPx = r!.handler.getCenter();\r\n        } else {\r\n            scrPx = px;\r\n        }\r\n        this._lonLat = this.planet!.getLonLatFromPixelTerrain(scrPx) || null;\r\n        this._showFn!(this._lonLat);\r\n    }\r\n\r\n    protected async _showHeight() {\r\n        if (this._lonLat && this.planet) {\r\n            let alt = 0;\r\n            this._heightEl!.style.opacity = \"0.7\";\r\n            if (this._heightMode === heightMode.ell) {\r\n                alt = await this.planet.getHeightAboveELL(this._lonLat);\r\n                alt = Number(units.convertExt(true, units.m, this._altUnit, alt));\r\n            } else if (this._heightMode === heightMode.msl) {\r\n                alt = await this.planet.getHeightDefault(this._lonLat);\r\n                alt = Number(units.convertExt(true, units.m, this._altUnit, alt));\r\n            }\r\n            this._heightEl!.style.opacity = \"1.0\";\r\n            this._heightEl!.innerHTML = alt.toString();\r\n        }\r\n    }\r\n}\r\n","import * as mercator from \"../mercator\";\r\nimport {doubleToTwoFloats2} from \"../math/coder\";\r\nimport {Extent} from \"../Extent\";\r\nimport type {EventCallback, EventsHandler} from \"../Events\";\r\nimport {Layer} from \"./Layer\";\r\nimport type {LayerEventsList, ILayerParams} from \"./Layer\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Material} from \"./Material\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport type {WebGLBufferExt, WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\nexport interface IBaseGeoImageParams extends ILayerParams {\r\n    fullExtent?: boolean;\r\n    corners?: NumberArray2[];\r\n}\r\n\r\ntype BaseGeoImageEventsList = [\r\n    \"loadend\"\r\n];\r\n\r\nconst BASEGEOIMAGE_EVENTS: BaseGeoImageEventsList = [\r\n    /**\r\n     * Triggered when image data is loaded\r\n     * @event EventsHandler<BaseGeoImageEventsList>#loadend\r\n     */\r\n    \"loadend\"\r\n];\r\n\r\nexport type BaseGeoImageEventsType = EventsHandler<BaseGeoImageEventsList> & EventsHandler<LayerEventsList>;\r\n\r\n/**\r\n * BaseGeoImage layer represents square imagery layer that\r\n * could be a static image, or animated video or webgl buffer\r\n * object displayed on the globe.\r\n * @class\r\n * @extends {Layer}\r\n */\r\nclass BaseGeoImage extends Layer {\r\n\r\n    public override events: BaseGeoImageEventsType;\r\n\r\n    protected _projType: number;\r\n\r\n    protected _frameWidth: number;\r\n    protected _frameHeight: number;\r\n\r\n    protected _sourceReady: boolean;\r\n    protected _sourceTexture: WebGLTextureExt | null;\r\n    protected _materialTexture: WebGLTextureExt | null;\r\n\r\n    protected _gridBufferLow: WebGLBufferExt | null;\r\n    protected _gridBufferHigh: WebGLBufferExt | null;\r\n\r\n    protected _extentWgs84ParamsHigh: Float32Array;\r\n    protected _extentWgs84ParamsLow: Float32Array;\r\n\r\n    protected _extentMercParamsHigh: Float32Array;\r\n    protected _extentMercParamsLow: Float32Array;\r\n\r\n    protected _refreshFrame: boolean;\r\n    protected _frameCreated: boolean;\r\n    protected _sourceCreated: boolean;\r\n\r\n    public _animate: boolean;\r\n    protected _ready: boolean;\r\n    public _creationProceeding: boolean;\r\n    public _isRendering: boolean;\r\n\r\n    protected _extentWgs84: Extent;\r\n    protected _cornersWgs84: LonLat[];\r\n    protected _cornersMerc: LonLat[];\r\n\r\n    protected _isFullExtent: number;\r\n\r\n    /**\r\n     * rendering function pointer\r\n     * @type {Function}\r\n     */\r\n    public rendering: Function;\r\n\r\n    protected _onLoadend_: EventCallback | null;\r\n\r\n    constructor(name: string | null, options: IBaseGeoImageParams = {}) {\r\n        super(name, options);\r\n\r\n        // @ts-ignore\r\n        this.events = this.events.registerNames(BASEGEOIMAGE_EVENTS);\r\n\r\n        this._projType = 0;\r\n\r\n        this._frameWidth = 256;\r\n        this._frameHeight = 256;\r\n\r\n        this._sourceReady = false;\r\n        this._sourceTexture = null;\r\n        this._materialTexture = null;\r\n\r\n        this._gridBufferLow = null;\r\n        this._gridBufferHigh = null;\r\n\r\n        this._extentWgs84ParamsHigh = new Float32Array(4);\r\n        this._extentWgs84ParamsLow = new Float32Array(4);\r\n\r\n        this._extentMercParamsHigh = new Float32Array(4);\r\n        this._extentMercParamsLow = new Float32Array(4);\r\n\r\n        this._refreshFrame = true;\r\n        this._frameCreated = false;\r\n        this._sourceCreated = false;\r\n\r\n        this._animate = false;\r\n        this._ready = false;\r\n        this._creationProceeding = false;\r\n        this._isRendering = false;\r\n\r\n        this._extentWgs84 = new Extent();\r\n        this._cornersWgs84 = [];\r\n        this._cornersMerc = [];\r\n\r\n        this._isFullExtent = options.fullExtent ? 1 : 0;\r\n\r\n        /**\r\n         * rendering function pointer\r\n         */\r\n        this.rendering = this._renderingProjType0.bind(this);\r\n\r\n        this._onLoadend_ = null;\r\n\r\n        options.corners && this.setCorners(options.corners);\r\n    }\r\n\r\n    public override get isIdle(): boolean {\r\n        return super.isIdle && this._ready;\r\n    }\r\n\r\n    public override addTo(planet: Planet) {\r\n        this._onLoadend_ = this._onLoadend.bind(this);\r\n        this.events.on(\"loadend\", this._onLoadend_, this);\r\n        return super.addTo(planet);\r\n    }\r\n\r\n    protected _onLoadend() {\r\n        if (this._planet) {\r\n            this._planet.events.dispatch(this._planet.events.layerloadend, this);\r\n        }\r\n    }\r\n\r\n    public override remove() {\r\n        this.events.off(\"loadend\", this._onLoadend_);\r\n        this._onLoadend_ = null;\r\n        return super.remove();\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"BaseGeoImage\";\r\n    }\r\n\r\n    /**\r\n     * Gets corners coordinates.\r\n     * @public\r\n     * @return {Array.<LonLat>} - (exactly 4 entries)\r\n     */\r\n    public getCornersLonLat(): LonLat[] {\r\n        let c = this._cornersWgs84;\r\n        return [\r\n            new LonLat(c[0].lon, c[0].lat),\r\n            new LonLat(c[1].lon, c[1].lat),\r\n            new LonLat(c[2].lon, c[2].lat),\r\n            new LonLat(c[3].lon, c[3].lat)\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * Gets corners coordinates.\r\n     * @public\r\n     * @return {Array.<Array<number>>} - (exactly 3 entries)\r\n     */\r\n    public getCorners(): NumberArray2[] {\r\n        let c = this._cornersWgs84;\r\n        return [\r\n            [c[0].lon, c[0].lat],\r\n            [c[1].lon, c[1].lat],\r\n            [c[2].lon, c[2].lat],\r\n            [c[3].lon, c[3].lat]\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * Sets geoImage geographical corners coordinates.\r\n     * @public\r\n     * @param {Array.<Array.<number>>} corners - GeoImage corners coordinates. Where first coordinate (exactly 3 entries)\r\n     * coincedents to the left top image corner, secont to the right top image corner, third to the right bottom\r\n     * and fourth - left bottom image corner.\r\n     */\r\n    public setCorners(corners: NumberArray2[]) {\r\n        this.setCornersLonLat(LonLat.join(corners));\r\n    }\r\n\r\n    /**\r\n     * Sets geoImage geographical corners coordinates.\r\n     * @public\r\n     * @param {Array.<LonLat>} corners - GeoImage corners coordinates. Where first coordinate\r\n     * coincedents to the left top image corner, secont to the right top image corner, third to the right bottom\r\n     * and fourth - left bottom image corner. (exactly 4 entries)\r\n     */\r\n    public setCornersLonLat(corners: LonLat[]) {\r\n        this._refreshFrame = true;\r\n        this._cornersWgs84 = [\r\n            corners[0].clone(),\r\n            corners[1].clone(),\r\n            corners[2].clone(),\r\n            corners[3].clone()\r\n        ];\r\n\r\n        for (let i = 0; i < this._cornersWgs84.length; i++) {\r\n            if (this._cornersWgs84[i].lat >= 89.9) {\r\n                this._cornersWgs84[i].lat = 89.9;\r\n            }\r\n            if (this._cornersWgs84[i].lat <= -89.9) {\r\n                this._cornersWgs84[i].lat = -89.9;\r\n            }\r\n        }\r\n        this._extent.setByCoordinates(this._cornersWgs84);\r\n\r\n        let me = this._extent;\r\n        if (me.southWest.lat > mercator.MAX_LAT || me.northEast.lat < mercator.MIN_LAT) {\r\n            this._projType = 0;\r\n            this.rendering = this._renderingProjType0;\r\n        } else {\r\n            this._projType = 1;\r\n            this.rendering = this._renderingProjType1;\r\n        }\r\n\r\n        if (this._ready && !this._creationProceeding) {\r\n            this._planet!._geoImageCreator.add(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates geoImage frame.\r\n     * @protected\r\n     */\r\n    protected _createFrame() {\r\n        this._extentWgs84 = this._extent.clone();\r\n\r\n        this._cornersMerc = [\r\n            this._cornersWgs84[0].forwardMercatorEPS01(),\r\n            this._cornersWgs84[1].forwardMercatorEPS01(),\r\n            this._cornersWgs84[2].forwardMercatorEPS01(),\r\n            this._cornersWgs84[3].forwardMercatorEPS01()\r\n        ];\r\n\r\n        this._extentMerc = new Extent(\r\n            this._extentWgs84.southWest.forwardMercatorEPS01(),\r\n            this._extentWgs84.northEast.forwardMercatorEPS01()\r\n        );\r\n\r\n        let tempArr = new Float32Array(2);\r\n\r\n        if (this._projType === 0) {\r\n\r\n            doubleToTwoFloats2(this._extentWgs84.southWest.lon, tempArr);\r\n            this._extentWgs84ParamsHigh[0] = tempArr[0];\r\n            this._extentWgs84ParamsLow[0] = tempArr[1];\r\n\r\n            doubleToTwoFloats2(this._extentWgs84.southWest.lat, tempArr);\r\n            this._extentWgs84ParamsHigh[1] = tempArr[0];\r\n            this._extentWgs84ParamsLow[1] = tempArr[1];\r\n\r\n            this._extentWgs84ParamsHigh[2] = 2.0 / this._extentWgs84.getWidth();\r\n            this._extentWgs84ParamsHigh[3] = 2.0 / this._extentWgs84.getHeight();\r\n\r\n        } else {\r\n\r\n            doubleToTwoFloats2(this._extentMerc.southWest.lon, tempArr);\r\n            this._extentMercParamsHigh[0] = tempArr[0];\r\n            this._extentMercParamsLow[0] = tempArr[1];\r\n\r\n            doubleToTwoFloats2(this._extentMerc.southWest.lat, tempArr);\r\n            this._extentMercParamsHigh[1] = tempArr[0];\r\n            this._extentMercParamsLow[1] = tempArr[1];\r\n\r\n            this._extentMercParamsHigh[2] = 2.0 / this._extentMerc.getWidth();\r\n            this._extentMercParamsHigh[3] = 2.0 / this._extentMerc.getHeight();\r\n        }\r\n\r\n        // creates material frame textures\r\n        if (this._planet) {\r\n            let p = this._planet,\r\n                h = p.renderer!.handler,\r\n                gl = h.gl!;\r\n\r\n            gl.deleteTexture(this._materialTexture as WebGLTexture);\r\n            this._materialTexture = h.createEmptyTexture_l(this._frameWidth, this._frameHeight);\r\n\r\n            let gridBufferArr = this._planet._geoImageCreator.createGridBuffer(this._cornersWgs84, this._projType === 1);\r\n\r\n            this._gridBufferHigh = gridBufferArr[0];\r\n            this._gridBufferLow = gridBufferArr[1];\r\n\r\n            this._refreshFrame = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @override\r\n     * @param {Material} material - GeoImage material.\r\n     */\r\n    public override abortMaterialLoading(material: Material) {\r\n        this._creationProceeding = false;\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n\r\n    /**\r\n     * Clear layer material.\r\n     * @public\r\n     * @override\r\n     */\r\n    public override clear() {\r\n        let p = this._planet;\r\n\r\n        if (p) {\r\n            let gl = p.renderer!.handler.gl;\r\n            this._creationProceeding && p._geoImageCreator.remove(this);\r\n            p._clearLayerMaterial(this);\r\n\r\n            if (gl) {\r\n                gl.deleteBuffer(this._gridBufferHigh as WebGLBuffer);\r\n                gl.deleteBuffer(this._gridBufferLow as WebGLBuffer);\r\n                gl.deleteTexture(this._sourceTexture as WebGLTexture);\r\n                this._materialTexture && !this._materialTexture.default && gl.deleteTexture(this._materialTexture);\r\n            }\r\n        }\r\n\r\n        this._sourceTexture = null;\r\n        this._materialTexture = null;\r\n\r\n        this._gridBufferHigh = null;\r\n        this._gridBufferLow = null;\r\n\r\n        this._refreshFrame = true;\r\n        this._sourceCreated = false;\r\n\r\n        this._ready = false;\r\n        this._creationProceeding = false;\r\n    }\r\n\r\n    /**\r\n     * Sets layer visibility.\r\n     * @public\r\n     * @override\r\n     * @param {boolean} visibility - GeoImage visibility.\r\n     */\r\n    public override setVisibility(visibility: boolean) {\r\n        if (visibility !== this._visibility) {\r\n            super.setVisibility(visibility);\r\n\r\n            // remove from creator\r\n            if (this._planet && this._sourceReady) {\r\n                if (visibility) {\r\n                    this._planet._geoImageCreator.add(this);\r\n                } else {\r\n                    this._planet._geoImageCreator.remove(this);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @param {Material} material - GeoImage material.\r\n     */\r\n    public override clearMaterial(material: Material) {\r\n        material.texture = null;\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @override\r\n     * @returns {Array<number>} -\r\n     */\r\n    public override applyMaterial(material: Material): NumberArray4 {\r\n        let segment = material.segment;\r\n\r\n        if (this._ready) {\r\n            material.applyTexture(this._materialTexture);\r\n        } else {\r\n            material.texture = this._planet!.transparentTexture;\r\n            !this._creationProceeding && this.loadMaterial(material);\r\n        }\r\n\r\n        let v0s, v0t;\r\n        if (this._projType === 0) {\r\n            v0s = this._extentWgs84;\r\n            v0t = segment._extent;\r\n        } else {\r\n            v0s = this._extentMerc;\r\n            v0t = segment.getExtentMerc();\r\n        }\r\n\r\n        let sSize_x = v0s.northEast.lon - v0s.southWest.lon;\r\n        let sSize_y = v0s.northEast.lat - v0s.southWest.lat;\r\n        let dV0s_x = (v0t.southWest.lon - v0s.southWest.lon) / sSize_x;\r\n        let dV0s_y = (v0s.northEast.lat - v0t.northEast.lat) / sSize_y;\r\n        let dSize_x = (v0t.northEast.lon - v0t.southWest.lon) / sSize_x;\r\n        let dSize_y = (v0t.northEast.lat - v0t.southWest.lat) / sSize_y;\r\n\r\n        return [dV0s_x, dV0s_y, dSize_x, dSize_y];\r\n    }\r\n\r\n    /**\r\n     * Gets frame width size in pixels.\r\n     * @public\r\n     * @returns {Number} Frame width.\r\n     */\r\n    public get getFrameWidth(): number {\r\n        return this._frameWidth;\r\n    }\r\n\r\n    /**\r\n     * Gets frame height size in pixels.\r\n     * @public\r\n     * @returns {Number} Frame height.\r\n     */\r\n    public get getFrameHeight(): number {\r\n        return this._frameHeight;\r\n    }\r\n\r\n    /**\r\n     * Method depends on GeoImage instance\r\n     * @protected\r\n     */\r\n    protected _createSourceTexture() {\r\n        //empty\r\n    }\r\n\r\n    public _renderingProjType1() {\r\n        let p = this._planet!,\r\n            h = p.renderer!.handler,\r\n            gl = h.gl!,\r\n            creator = p._geoImageCreator;\r\n\r\n        this._refreshFrame && this._createFrame();\r\n        this._createSourceTexture();\r\n\r\n        let f = creator._framebuffer!;\r\n        f.setSize(this._frameWidth, this._frameHeight);\r\n        f.activate();\r\n\r\n        h.programs.geoImageTransform.activate();\r\n        let sh = h.programs.geoImageTransform._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        f.bindOutputTexture(this._materialTexture as WebGLTexture);\r\n        gl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n        gl.uniform1i(shu.isFullExtent, this._isFullExtent);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, creator._texCoordsBuffer as WebGLBuffer);\r\n\r\n        gl.vertexAttribPointer(sha.texCoords, 2, gl.UNSIGNED_SHORT, true, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferHigh as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.cornersHigh, this._gridBufferHigh!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferLow as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.cornersLow, this._gridBufferLow!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform4fv(shu.extentParamsHigh, this._extentMercParamsHigh);\r\n        gl.uniform4fv(shu.extentParamsLow, this._extentMercParamsLow);\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this._sourceTexture as WebGLTexture);\r\n        gl.uniform1i(shu.sourceTexture, 0);\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, creator._indexBuffer as WebGLBuffer);\r\n        gl.drawElements(gl.TRIANGLE_STRIP, creator._indexBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n        f.deactivate();\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n        this._ready = true;\r\n\r\n        this._creationProceeding = false;\r\n    }\r\n\r\n    protected _renderingProjType0() {\r\n        let p = this._planet!,\r\n            h = p.renderer!.handler,\r\n            gl = h.gl!,\r\n            creator = p._geoImageCreator;\r\n\r\n        this._refreshFrame && this._createFrame();\r\n        this._createSourceTexture();\r\n\r\n        let f = creator._framebuffer!;\r\n        f.setSize(this._frameWidth, this._frameHeight);\r\n        f.activate();\r\n\r\n        h.programs.geoImageTransform.activate();\r\n        let sh = h.programs.geoImageTransform._program;\r\n        let sha = sh.attributes,\r\n            shu = sh.uniforms;\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        f.bindOutputTexture(this._materialTexture as WebGLTexture);\r\n        gl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, creator._texCoordsBuffer as WebGLBuffer);\r\n\r\n        gl.vertexAttribPointer(sha.texCoords, 2, gl.UNSIGNED_SHORT, true, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferHigh as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.cornersHigh, this._gridBufferHigh!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferLow as WebGLBuffer);\r\n        gl.vertexAttribPointer(sha.cornersLow, this._gridBufferLow!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform4fv(shu.extentParamsHigh, this._extentWgs84ParamsHigh);\r\n        gl.uniform4fv(shu.extentParamsLow, this._extentWgs84ParamsLow);\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this._sourceTexture as WebGLTexture);\r\n        gl.uniform1i(shu.sourceTexture, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, creator._indexBuffer as WebGLBuffer);\r\n        gl.drawElements(gl.TRIANGLE_STRIP, creator._indexBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n        f.deactivate();\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n        this._ready = true;\r\n\r\n        this._creationProceeding = false;\r\n    }\r\n}\r\n\r\nexport {BaseGeoImage};\r\n","import {BaseGeoImage} from '../layer/BaseGeoImage';\r\nimport {Control, type IControlParams} from './Control';\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {ToggleButton} from \"../ui/ToggleButton\";\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path d=\"M16 13l6.964 4.062-2.973.85 2.125 3.681-1.732 1-2.125-3.68-2.223 2.15L16 13zm-2-7h2v2h5a1 1 0 0 1 1 1v4h-2v-3H10v10h4v2H9a1 1 0 0 1-1-1v-5H6v-2h2V9a1 1 0 0 1 1-1h5V6zM4 14v2H2v-2h2zm0-4v2H2v-2h2zm0-4v2H2V6h2zm0-4v2H2V2h2zm4 0v2H6V2h2zm4 0v2h-2V2h2zm4 0v2h-2V2h2z\" fill=\"#000\"/></svg>`;\r\n\r\ninterface IGeoImageDragControlParams extends IControlParams {\r\n\r\n}\r\n\r\nexport class GeoImageDragControl extends Control {\r\n    protected _cornerIndex: number;\r\n    protected _catchCorner: boolean;\r\n    protected _toggleBtn: ToggleButton;\r\n\r\n    constructor(options: IGeoImageDragControlParams = {}) {\r\n        super(options);\r\n\r\n        this._cornerIndex = -1;\r\n        this._catchCorner = false;\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-geoimagegrag_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n    }\r\n\r\n    override oninit() {\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n\r\n        this.planet!.events.on('layeradd', (e: Layer) => {\r\n            if (this.isActive()) {\r\n                this._bindLayer(e);\r\n            }\r\n        }, this);\r\n\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            if (isActive) {\r\n                this.activate();\r\n            } else {\r\n                this.deactivate();\r\n            }\r\n        });\r\n    }\r\n\r\n    override onactivate() {\r\n        super.onactivate();\r\n\r\n        const p = this.planet!;\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            this._bindLayer(p.layers[i]);\r\n        }\r\n    }\r\n\r\n    override ondeactivate() {\r\n        super.ondeactivate();\r\n        const p = this.planet!;\r\n        for (let i = 0; i < p.layers.length; i++) {\r\n            this._unbindLayer(p.layers[i]);\r\n        }\r\n    }\r\n\r\n    _bindLayer(layer: Layer) {\r\n        if (layer instanceof BaseGeoImage) {\r\n            layer.events.on('mousemove', this._onMouseMove, this);\r\n            layer.events.on(\"mouseleave\", this._onMouseLeave, this);\r\n            layer.events.on('ldown', this._onLDown, this);\r\n            layer.events.on('lup', this._onLUp, this);\r\n        }\r\n    }\r\n\r\n    protected _unbindLayer(layer: Layer) {\r\n        if (layer instanceof BaseGeoImage) {\r\n            layer.events.off('mousemove', this._onMouseMove);\r\n            layer.events.off(\"mouseleave\", this._onMouseLeave);\r\n            layer.events.off('ldown', this._onLDown);\r\n            layer.events.off('lup', this._onLUp);\r\n        }\r\n    }\r\n\r\n    protected _onLUp(ms: IMouseState) {\r\n        this._catchCorner = false;\r\n        ms.renderer.controls.mouseNavigation.activate();\r\n    }\r\n\r\n    protected _onLDown(ms: IMouseState) {\r\n        if (this._cornerIndex !== -1) {\r\n            this._catchCorner = true;\r\n            ms.renderer.controls.mouseNavigation.deactivate();\r\n        }\r\n    }\r\n\r\n    protected _onMouseLeave() {\r\n        document.body.style.cursor = 'auto';\r\n    }\r\n\r\n    protected _onMouseMove(ms: IMouseState) {\r\n        let layer = ms.pickingObject;\r\n        const p = this.planet!;\r\n        if (this._catchCorner) {// mouse is catching a corner\r\n            let corners = layer.getCornersLonLat();\r\n            // corners[this._cornerIndex] = p.getLonLatFromPixelTerrain(ms, true);\r\n            corners[this._cornerIndex] = p.getLonLatFromPixelTerrain(ms);\r\n            layer.setCornersLonLat(corners);\r\n        } else { // mouse isn't catching\r\n            this._cornerIndex = -1;\r\n            for (let i = 0; i < layer._cornersWgs84.length; i++) {\r\n                // let ground = p.getLonLatFromPixelTerrain(ms, true);\r\n                let ground = p.getLonLatFromPixelTerrain(ms);\r\n                // mouse is near\r\n                //if (ground && p.ellipsoid.getGreatCircleDistance(layer._cornersWgs84[i], ground) / p.getDistanceFromPixel(ms, true) <= 0.05) {\r\n                if (ground && p.ellipsoid.getGreatCircleDistance(layer._cornersWgs84[i], ground) / p.getDistanceFromPixel(ms) <= 0.05) {\r\n                    this._cornerIndex = i;\r\n                    document.body.style.cursor = 'move';\r\n                    break;\r\n                    // mouse is far\r\n                } else {\r\n                    document.body.style.cursor = 'auto';\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","export const input: { [id: string]: number } = {\r\n    MB_LEFT: 0,\r\n    MB_RIGHT: 2,\r\n    MB_MIDDLE: 1,\r\n    KEY_CTRL: 17,\r\n    KEY_ALT: 18,\r\n    KEY_SHIFT: 16,\r\n    KEY_SPACE: 32,\r\n    KEY_PGUP: 33,\r\n    KEY_PGDN: 34,\r\n    KEY_LEFT: 37,\r\n    KEY_UP: 38,\r\n    KEY_RIGHT: 39,\r\n    KEY_DOWN: 40,\r\n    KEY_PRINTSCREEN: 44,\r\n    KEY_EQUALS: 61,\r\n    KEY_A: 65,\r\n    KEY_C: 67,\r\n    KEY_D: 68,\r\n    KEY_E: 69,\r\n    KEY_F: 70,\r\n    KEY_H: 72,\r\n    KEY_I: 73,\r\n    KEY_K: 75,\r\n    KEY_L: 76,\r\n    KEY_N: 78,\r\n    KEY_O: 79,\r\n    KEY_P: 80,\r\n    KEY_Q: 81,\r\n    KEY_R: 82,\r\n    KEY_S: 83,\r\n    KEY_V: 86,\r\n    KEY_W: 87,\r\n    KEY_X: 88,\r\n    KEY_Z: 90,\r\n    KEY_PLUS: 107,\r\n    KEY_F1: 112,\r\n    KEY_MINUS: 173,\r\n    KEY_APOSTROPHE: 192,\r\n    KEY_BACK_SLASH: 220,\r\n    KEY_MORE: 190,\r\n    KEY_SLASH: 191,\r\n    KEY_LESS: 188,\r\n    KEY_LEFT_SQUARE_BRACKET: 219,\r\n    KEY_RIGHT_SQUARE_BRACKET: 221,\r\n    KEY_SINGLE_QUOTE: 222\r\n};\r\n","import * as math from \"../math\";\r\nimport {Control, type IControlParams} from \"./Control\";\r\nimport {input} from \"../input/input\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Camera} from \"../camera/Camera\";\r\nimport {PlanetCamera} from \"../camera/PlanetCamera\";\r\nimport {RADIANS} from \"../math\";\r\n\r\ninterface IKeyboardNavigationParams extends IControlParams {\r\n    speed?: number;\r\n    camera?: Camera | PlanetCamera;\r\n}\r\n\r\n/**\r\n * Planet camera keyboard navigation. Use W,S,A,D and left shift key for fly around a planet.\r\n */\r\nexport class KeyboardNavigation extends Control {\r\n\r\n    public speed: number;\r\n    public force: Vec3;\r\n    public vel: Vec3;\r\n    public mass: number;\r\n\r\n    protected _camera: Camera | PlanetCamera | null;\r\n\r\n    constructor(options: IKeyboardNavigationParams = {}) {\r\n        options = options || {};\r\n        super({name: \"KeyboardNavigation\", ...options});\r\n        this._camera = options.camera || null;\r\n\r\n        this.speed = options.speed || 10.0;\r\n        this.force = new Vec3();\r\n        this.vel = new Vec3();\r\n        this.mass = 1;\r\n    }\r\n\r\n    public bindCamera(camera: Camera) {\r\n        this._camera = camera;\r\n    }\r\n\r\n    public override onactivate() {\r\n        let r = this.renderer!;\r\n        // r.events.on(\"keypress\", input.KEY_PGUP, this.onCameraMoveForward, this);\r\n        // r.events.on(\"keypress\", input.KEY_PGDN, this.onCameraMoveBackward, this);\r\n        // r.events.on(\"keypress\", input.KEY_PLUS, this.onCameraMoveForward, this);\r\n        // r.events.on(\"keypress\", input.KEY_EQUALS, this.onCameraMoveForward, this);\r\n        r.events.on(\"keypress\", input.KEY_S, this.onCameraMoveBackward, this);\r\n        r.events.on(\"keypress\", input.KEY_W, this.onCameraMoveForward, this);\r\n        // r.events.on(\"keypress\", input.KEY_A, this.onCameraStrifeLeft, this);\r\n        // r.events.on(\"keypress\", input.KEY_D, this.onCameraStrifeRight, this);\r\n        r.events.on(\"keypress\", input.KEY_UP, this.onCameraPitchUp, this);\r\n        r.events.on(\"keypress\", input.KEY_DOWN, this.onCameraPitchDown, this);\r\n        r.events.on(\"keypress\", input.KEY_LEFT, this.onCameraYawLeft, this);\r\n        r.events.on(\"keypress\", input.KEY_RIGHT, this.onCameraYawRight, this);\r\n\r\n        r.events.on(\"draw\", this.onDraw, this, -1000);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        let r = this.renderer!;\r\n    }\r\n\r\n    public override oninit() {\r\n        this.activate();\r\n    }\r\n\r\n    protected get dt(): number {\r\n        return 0.001 * this.renderer!.handler.deltaTime;\r\n    }\r\n\r\n    protected onCameraPitchUp = () => {\r\n        if (this._camera) {\r\n            this._camera.setPitch(this._camera.getPitch() + 0.1 * RADIANS);\r\n        }\r\n    }\r\n\r\n    protected onCameraPitchDown = () => {\r\n        if (this._camera) {\r\n            this._camera.setPitch(this._camera.getPitch() - 0.1 * RADIANS);\r\n        }\r\n    }\r\n\r\n    protected onCameraYawLeft = () => {\r\n        if (this._camera) {\r\n            this._camera.setYaw(this._camera.getYaw() - 0.1 * RADIANS);\r\n        }\r\n    }\r\n\r\n    protected onCameraYawRight = () => {\r\n        if (this._camera) {\r\n            this._camera.setYaw(this._camera.getYaw() + 0.1 * RADIANS);\r\n        }\r\n    }\r\n\r\n    protected onCameraMoveForward = () => {\r\n        if (this._camera) {\r\n            this.force.addA(this._camera.getForward()).normalize();\r\n        }\r\n    }\r\n\r\n    protected onCameraMoveBackward = () => {\r\n        if (this._camera) {\r\n            this.force.addA(this._camera.getBackward()).normalize();\r\n        }\r\n    }\r\n\r\n    protected onDraw() {\r\n        if (this.renderer && this._camera) {\r\n\r\n            let acc = this.force.scale(1.0 / this.mass);\r\n            this.vel.addA(acc);\r\n            this.vel.scale(0.96);\r\n            this.force.set(0, 0, 0);\r\n\r\n            let cam = this._camera;\r\n            cam.eye = cam.eye.add(this.vel.scaleTo(this.dt));\r\n            cam.update();\r\n        }\r\n    }\r\n}","import {type EventsHandler, createEvents} from '../Events';\r\nimport {Layer} from '../layer/Layer';\r\nimport {Control, type IControlParams} from \"./Control\";\r\n\r\ntype LayerAnimationEventsList = [\"change\", \"idle\", \"play\", \"pause\", \"stop\"];\r\n\r\nconst LAYERANIMATION_EVENTS: LayerAnimationEventsList = [\"change\", \"idle\", \"play\", \"pause\", \"stop\"];\r\n\r\ninterface ILayerAnimationParams extends IControlParams {\r\n    layers?: Layer,\r\n    playInterval?: number,\r\n    frameSize?: number,\r\n    repeat?: boolean;\r\n    skipTimeout?: number;\r\n}\r\n\r\nexport class LayerAnimation extends Control {\r\n    public events: EventsHandler<LayerAnimationEventsList>;\r\n    protected _layersArr: Layer[];\r\n    protected _currentIndex: number;\r\n    protected _playInterval: number;\r\n    protected _playIntervalHandler: any;\r\n    protected _playIndex: number;\r\n    protected _frameSize: number;\r\n    public repeat: boolean;\r\n    public skipTimeout: number;\r\n    protected _timeoutStart: number;\r\n    protected _currVisibleIndex: number = 0;\r\n\r\n    constructor(options: ILayerAnimationParams = {}) {\r\n        super(options);\r\n        this.events = createEvents(LAYERANIMATION_EVENTS);\r\n        this._name = options.name || `layerAnimation-${this.__id}`;\r\n        this._layersArr = options.layers ? ([] as Layer[]).concat(options.layers) : [];\r\n        this._currentIndex = -1;\r\n        this._playInterval = options.playInterval || 120;\r\n        this._playIntervalHandler = -1;\r\n        this._playIndex = 0;\r\n        this._frameSize = options.frameSize || 50;\r\n        this.repeat = options.repeat != undefined ? options.repeat : true;\r\n        this.skipTimeout = options.skipTimeout || 5000;\r\n        this._timeoutStart = 0;\r\n    }\r\n\r\n    protected _onViewchange = () => {\r\n        this._timeoutStart = performance.now();\r\n    }\r\n\r\n    protected _getFramesNum(): number {\r\n        return Math.ceil(this._layersArr.length / this._frameSize);\r\n    }\r\n\r\n    protected _setFrame(frameIndex: number) {\r\n        for (let i = 0, len = this._getFramesNum(); i < len; i++) {\r\n            if (i !== frameIndex) {\r\n                this._removeFrameFromPlanet(i);\r\n            } else {\r\n                this._appendFrameToPlanet(i);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _getFrameIndex(layerIndex: number): number {\r\n        return Math.floor(layerIndex / this._frameSize);\r\n    }\r\n\r\n    protected _appendFrameToPlanet(frameIndex: number) {\r\n        if (this.planet) {\r\n            let minIndex = frameIndex * this._frameSize;\r\n            let maxIndex = minIndex + this._frameSize;\r\n            for (let i = minIndex, len = maxIndex > this._layersArr.length ? this._layersArr.length : maxIndex; i < len; i++) {\r\n                this.planet.addLayer(this._layersArr[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _removeFrameFromPlanet(frameIndex: number) {\r\n        if (this.planet) {\r\n            let minIndex = frameIndex * this._frameSize;\r\n            let maxIndex = minIndex + this._frameSize;\r\n            for (let i = minIndex, len = maxIndex > this._layersArr.length ? this._layersArr.length : maxIndex; i < len; i++) {\r\n                this._layersArr[i].abortLoading();\r\n                this._layersArr[i].remove();\r\n                this._layersArr[i].setVisibility(false);\r\n            }\r\n        }\r\n    }\r\n\r\n    public override oninit() {\r\n        super.oninit();\r\n        this.onactivate();\r\n        this._initLayers();\r\n        this.planet!.events.on(\"layerloadend\", this._onLayerLoadend);\r\n        this._setCurrentIndexAsync(0, false, true);\r\n    }\r\n\r\n    public override onactivate() {\r\n        super.onactivate();\r\n        this.planet!.camera.events.on(\"viewchange\", this._onViewchange);\r\n        this.planet!.renderer!.handler.events.on(\"visibilitychange\", this._onVisibilityChange);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        super.ondeactivate();\r\n        this.planet!.camera.events.off(\"viewchange\", this._onViewchange);\r\n\r\n        for (let i = 0; i < this._layersArr.length; i++) {\r\n            this._layersArr[i].setVisibility(false);\r\n        }\r\n\r\n        this.planet!.events.off(\"layerloadend\", this._onLayerLoadend);\r\n        this.planet!.renderer!.handler.events.off(\"visibilitychange\", this._onVisibilityChange);\r\n    }\r\n\r\n    protected _onVisibilityChange = (isVisible: boolean) => {\r\n        if (!isVisible) {\r\n            this.pause();\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        this.stop();\r\n        this._currentIndex = -1;\r\n        this._currVisibleIndex = -1;\r\n        let layersToRemove = this._layersArr;\r\n        this._layersArr = [];\r\n        for (let i = 0; i < layersToRemove.length; i++) {\r\n            layersToRemove[i].remove();\r\n        }\r\n    }\r\n\r\n    protected _initLayers() {\r\n        if (this.planet) {\r\n            for (let i = 0, len = this._layersArr.length; i < len; i++) {\r\n                let li = this._layersArr[i];\r\n                li.setVisibility(false);\r\n                li.setBaseLayer(false);\r\n                li.opacity = 0.0;\r\n            }\r\n            this._appendFrameToPlanet(0);\r\n        }\r\n    }\r\n\r\n    public setLayers(layers: Layer[]) {\r\n        this.clear();\r\n        this._layersArr = [].concat(layers as any);\r\n        this._initLayers();\r\n    }\r\n\r\n    public appendLayer(layer: Layer) {\r\n        this._layersArr.push(layer);\r\n        layer.setVisibility(false);\r\n        layer.setBaseLayer(false);\r\n        layer.opacity = 0.0;\r\n        //check current frame\r\n        this.planet?.addLayer(layer);\r\n    }\r\n\r\n    /**\r\n     * warning: Use XYZ.isIdle in requestAnimationFrame(after setVisibility)\r\n     * @returns Returns true if current layer is idle\r\n     */\r\n    public get isIdle(): boolean {\r\n        let currLayer = this._layersArr[this._currentIndex];\r\n        return currLayer && currLayer.isIdle || !currLayer;\r\n    }\r\n\r\n    public get playInterval() {\r\n        return this._playInterval;\r\n    }\r\n\r\n    public set playInterval(val: number) {\r\n        if (val !== this._playInterval) {\r\n            this._playInterval = val;\r\n            if (this.isPlaying) {\r\n                this.pause();\r\n                this.play();\r\n            }\r\n        }\r\n    }\r\n\r\n    public get isPlaying(): boolean {\r\n        return this._playIntervalHandler !== -1;\r\n    }\r\n\r\n    public get layers(): Layer[] {\r\n        return this._layersArr;\r\n    }\r\n\r\n    protected _checkEnd() {\r\n        if (this._playIndex > this._layersArr.length) {\r\n            if (this.repeat) {\r\n                this._playIndex = 0;\r\n            } else {\r\n                this.pause();\r\n            }\r\n        }\r\n    }\r\n\r\n    public play() {\r\n        if (!this.isPlaying) {\r\n\r\n            if (this._currentIndex >= this._layersArr.length - 1) {\r\n                this.stop();\r\n            }\r\n\r\n            this._timeoutStart = performance.now();\r\n\r\n            this._playIntervalHandler = setInterval(() => {\r\n                this._checkEnd();\r\n                this._setCurrentIndexAsync(this._playIndex, false, false);\r\n\r\n                requestAnimationFrame(() => {\r\n                    if (this.isIdle || (performance.now() - this._timeoutStart > this.skipTimeout)) {\r\n                        this._playIndex++;\r\n                        this._timeoutStart = performance.now();\r\n                    }\r\n                });\r\n\r\n            }, this._playInterval);\r\n\r\n            this.events.dispatch(this.events.play);\r\n        }\r\n    }\r\n\r\n    public stop() {\r\n        if (this._playIndex > 0) {\r\n            this._clearInterval();\r\n            this._playIndex = 0;\r\n            this.setCurrentIndex(0);\r\n            this.events.dispatch(this.events.stop);\r\n        }\r\n    }\r\n\r\n    public pause() {\r\n        if (this.isPlaying) {\r\n            this._clearInterval();\r\n            this.events.dispatch(this.events.pause);\r\n        }\r\n    }\r\n\r\n    protected _clearInterval() {\r\n        clearInterval(this._playIntervalHandler);\r\n        this._playIntervalHandler = -1;\r\n    }\r\n\r\n    /**\r\n     * Waiting for the current index layer loadend and make it non-transparent,\r\n     * and make prev layer transparent, also check previous frame index to clean up.\r\n     */\r\n    private _onLayerLoadend = (layer: Layer) => {\r\n\r\n        let currLayer = this._layersArr[this._currentIndex];\r\n\r\n        if (currLayer && currLayer.isEqual(layer)) {\r\n\r\n            // BRUTE\r\n            let currFrame = this._getFrameIndex(this._currentIndex);\r\n            let from = currFrame * this._frameSize,\r\n                to = this._currentIndex;\r\n            for (let i = from; i < to; i++) {\r\n                let li = this._layersArr[i];\r\n                li.opacity = 0;\r\n                li.setVisibility(false);\r\n            }\r\n\r\n            // * Make CURRENT Layer VISIBLE *\r\n            currLayer.opacity = 1.0;\r\n\r\n            let currVisibleLayer = this._layersArr[this._currVisibleIndex];\r\n            if (currVisibleLayer) {\r\n                currVisibleLayer.opacity = 0.0;\r\n                currVisibleLayer.setVisibility(false);\r\n\r\n                // If frame is changed - remove it from the planet\r\n                let prevFrame = this._getFrameIndex(this._currVisibleIndex);\r\n                if (this._getFrameIndex(this._currentIndex) !== prevFrame) {\r\n                    this._removeFrameFromPlanet(prevFrame);\r\n                }\r\n            }\r\n\r\n            this.events.dispatch(this.events.idle, currLayer);\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Function sets layer index visible.\r\n     * @param {number} index\r\n     * @param {boolean} [stopPropagation=false]\r\n     */\r\n    setCurrentIndex(index: number, stopPropagation = false) {\r\n        this._setCurrentIndexAsync(index, true, stopPropagation);\r\n    }\r\n\r\n    /**\r\n     * Function sets layer index visible. If the layer is idle (all visible tiles loaded), sets opacity to one,\r\n     * otherwise to ZERO it means that when all visible tiles will be loaded the opacity becomes ONE. So, previous\r\n     * layer remains not transparent (opacity = 1) till current layer is loading.\r\n     */\r\n    protected _setCurrentIndexAsync(index: number, forceVisibility: boolean = false, stopPropagation: boolean = false) {\r\n\r\n        if (index != this._currentIndex && index >= 0 && index < this._layersArr.length) {\r\n\r\n            let prevCurrIndex = this._currentIndex;\r\n            this._currentIndex = index;\r\n            this._playIndex = index;\r\n\r\n            let prevCurrFrame = this._getFrameIndex(prevCurrIndex);\r\n            let currFrame = this._getFrameIndex(this._currentIndex);\r\n\r\n            let prevCurrLayer = this._layersArr[prevCurrIndex],\r\n                currLayer = this._layersArr[index];\r\n\r\n            let frameChanged = currFrame != prevCurrFrame;\r\n            if (frameChanged) {\r\n                this._appendFrameToPlanet(currFrame);\r\n            }\r\n\r\n            if (prevCurrLayer) {\r\n                if (prevCurrLayer.isIdle) {\r\n                    this._currVisibleIndex = prevCurrIndex;\r\n                } else {\r\n                    prevCurrLayer.opacity = 0;\r\n                    prevCurrLayer.setVisibility(false);\r\n                }\r\n            }\r\n\r\n            if (currLayer) {\r\n\r\n                currLayer.opacity = 0.0;\r\n                currLayer.setVisibility(true);\r\n\r\n                requestAnimationFrame(() => {\r\n                    if (currLayer.isIdle || forceVisibility) {\r\n\r\n                        currLayer.opacity = 1.0;\r\n\r\n                        // If frame is changed - remove it from the planet\r\n                        if (frameChanged) {\r\n                            this._removeFrameFromPlanet(prevCurrFrame);\r\n                        }\r\n\r\n                        if (prevCurrLayer) {\r\n                            prevCurrLayer.opacity = 0.0;\r\n                            prevCurrLayer.setVisibility(false);\r\n                        }\r\n\r\n                        let currVisibleLayer = this._layersArr[this._currVisibleIndex];\r\n                        if (currVisibleLayer) {\r\n                            currVisibleLayer.opacity = 0.0;\r\n                            currVisibleLayer.setVisibility(false);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                if (!stopPropagation) {\r\n                    this.events.dispatch(this.events.change, this._currentIndex, prevCurrIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {Dialog} from \"../ui/Dialog\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {ToggleButton} from \"../ui/ToggleButton\";\r\nimport {View} from \"../ui/View\";\r\nimport type {IViewParams} from \"../ui/View\";\r\nimport {stringTemplate} from \"../utils/shared\";\r\n\r\ninterface ILayerSwitcherParams extends IControlParams {\r\n\r\n}\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->\r\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\r\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 1000 1000\" enable-background=\"new 0 0 1000 1000\" xml:space=\"preserve\">\r\n<metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\r\n<g><path d=\"M500,573.5c-3.2,0-6.5-0.6-9.5-1.9L25,375.6c-9.1-3.8-15-12.7-15-22.6s5.9-18.8,15-22.6l465.5-196c6.1-2.5,12.9-2.5,19,0l465.5,196c9.1,3.8,15,12.7,15,22.6s-5.9,18.8-15,22.6l-465.5,196C506.5,572.9,503.2,573.5,500,573.5L500,573.5z M97.6,353L500,522.4L902.4,353L500,183.6L97.6,353L97.6,353z\"/><path d=\"M500,720.5c-3.2,0-6.5-0.6-9.5-1.9L25,522.6c-12.4-5.2-18.3-19.6-13.1-32.1c5.2-12.5,19.6-18.3,32.1-13.1l456,192l456-192c12.4-5.2,26.9,0.6,32.1,13.1s-0.6,26.9-13.1,32.1l-465.5,196C506.5,719.9,503.2,720.5,500,720.5L500,720.5z\"/><path d=\"M500,867.5c-3.2,0-6.5-0.6-9.5-1.9L25,669.6c-12.4-5.2-18.3-19.6-13.1-32.1c5.2-12.5,19.6-18.3,32.1-13.1l456,192l456-192c12.4-5.2,26.9,0.6,32.1,13.1c5.2,12.5-0.6,26.8-13.1,32.1l-465.5,196C506.5,866.9,503.2,867.5,500,867.5L500,867.5z\"/></g>\r\n</svg>`;\r\n\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-layerSwitcher\">\r\n      <div class=\"og-layerSwitcher__title\">Base Layers</div>\r\n      <div class=\"og-layerSwitcher__list og-layerSwitcher__baseLayers\"></div>        \r\n        \r\n      <div class=\"og-layerSwitcher__title\">Overlays</div>\r\n      <div class=\"og-layerSwitcher__list og-layerSwitcher__overlays\"></div>\r\n         \r\n    </div>`;\r\n\r\nconst LAYER_BUTTON_TEMPLATE =\r\n    `<button title={title} class=\"og-layerSwitcher__layerButton\">{icon}<div class=\"og-layerSwitcher__name\">{name}</div></button>`;\r\n\r\nclass LayerButtonView extends View<Layer> {\r\n    constructor(params: IViewParams) {\r\n        super({\r\n            template: stringTemplate(LAYER_BUTTON_TEMPLATE, {\r\n                title: params.model.name,\r\n                name: params.model.name,\r\n                icon: params.model.iconSrc ? `<img src=\"${params.model.iconSrc}\" />` : \"\"\r\n            }),\r\n            ...params\r\n        });\r\n    }\r\n\r\n    public override render(params?: any): this {\r\n        super.render(params);\r\n        this.model.events.on(\"visibilitychange\", this._onVisibilityChange);\r\n        this._onVisibilityChange(this.model);\r\n        this.el!.addEventListener(\"click\", this._onClick);\r\n        this.el!.addEventListener(\"dblclick\", this._onDblClick);\r\n        return this;\r\n    }\r\n\r\n    protected _onVisibilityChange = (layer: Layer) => {\r\n        if (this.el) {\r\n            if (this.model.getVisibility()) {\r\n                this.el.classList.add(\"og-layerSwitcher__visible\");\r\n            } else {\r\n                this.el.classList.remove(\"og-layerSwitcher__visible\");\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onClick = () => {\r\n        if (this.model.isBaseLayer()) {\r\n            this.model.setVisibility(true);\r\n        } else {\r\n            this.model.setVisibility(!this.model.getVisibility());\r\n        }\r\n    }\r\n\r\n    protected _onDblClick = () => {\r\n        this.model.flyExtent();\r\n    }\r\n\r\n    public override remove() {\r\n        super.remove();\r\n        this.model.events.off(\"visibilitychange\", this._onVisibilityChange);\r\n    }\r\n}\r\n\r\n/**\r\n * Advanced :) layer switcher, includes base layers, overlays, geo images etc. groups.\r\n * Double click for zoom, drag-and-drop to change zIndex\r\n */\r\nexport class LayerSwitcher extends Control {\r\n    protected _dialog: Dialog<null>;\r\n    protected _toggleBtn: ToggleButton;\r\n    protected _panel: View<null>;\r\n\r\n    public $baseLayers: HTMLElement | null;\r\n    public $overlays: HTMLElement | null;\r\n\r\n    public _layerViews: LayerButtonView[];\r\n\r\n    constructor(options: ILayerSwitcherParams = {}) {\r\n        super({\r\n            name: \"LayerSwitcher\",\r\n            ...options\r\n        });\r\n\r\n        this._dialog = new Dialog({\r\n            title: \"Layer Switcher\",\r\n            top: 15,\r\n            useHide: true,\r\n            visible: false,\r\n            width: 300,\r\n            maxHeight: 500\r\n        });\r\n\r\n        this._panel = new View({\r\n            template: TEMPLATE\r\n        });\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-layerSwitcher_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        this.$baseLayers = null;\r\n        this.$overlays = null;\r\n\r\n        this._layerViews = [];\r\n    }\r\n\r\n    override oninit() {\r\n\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n        this._dialog.appendTo(this.planet!.renderer!.div!);\r\n        this._panel.appendTo(this._dialog.container!);\r\n\r\n        this.$baseLayers = this._panel.el!.querySelector(\".og-layerSwitcher__baseLayers\");\r\n        this.$overlays = this._panel.el!.querySelector(\".og-layerSwitcher__overlays\");\r\n\r\n        this._dialog.setPosition((this.planet!.renderer!.div!.clientWidth as number) - this._dialog.width - 67)\r\n\r\n        this._dialog.events.on(\"visibility\", (v: boolean) => {\r\n            this._toggleBtn.setActive(v);\r\n        });\r\n\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this._dialog.setVisibility(isActive);\r\n        });\r\n\r\n        this.planet!.events.on(\"layeradd\", this.addLayer, this);\r\n        this.planet!.events.on(\"layerremove\", this.removeLayer, this);\r\n\r\n        this._initLayers();\r\n    }\r\n\r\n    protected _initLayers() {\r\n        let layers = this.planet!.layers;\r\n        for (let i = 0; i < layers.length; i++) {\r\n            this.addLayer(layers[i]);\r\n        }\r\n    }\r\n\r\n    protected _createLayerButton(layer: Layer): LayerButtonView {\r\n        return new LayerButtonView({\r\n            model: layer\r\n        });\r\n    }\r\n\r\n    public addLayer = (layer: Layer) => {\r\n        if (!layer.hideInLayerSwitcher) {\r\n            let layerView = this._createLayerButton(layer);\r\n            this._layerViews.push(layerView);\r\n            if (layer.isBaseLayer()) {\r\n                layerView.appendTo(this.$baseLayers!);\r\n            } else {\r\n                layerView.appendTo(this.$overlays!);\r\n            }\r\n        }\r\n    }\r\n\r\n    public removeLayer = (layer: Layer) => {\r\n        for (let i = 0; i < this._layerViews.length; i++) {\r\n            let li = this._layerViews[i];\r\n            if (li.model.isEqual(layer)) {\r\n                li.remove();\r\n                this._layerViews.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    override onactivate() {\r\n\r\n    }\r\n\r\n    override ondeactivate() {\r\n        this._dialog.hide();\r\n    }\r\n\r\n}\r\n","import {clamp} from '../math';\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {View} from './View';\r\nimport type {IViewParams, ViewEventsList} from './View';\r\nimport {stringTemplate} from '../utils/shared';\r\n\r\ninterface ISliderParams extends IViewParams {\r\n    label?: string;\r\n    value?: number;\r\n    min?: number;\r\n    max?: number;\r\n}\r\n\r\ntype SliderEventsList = [\"change\"];\r\n\r\nconst SLIDER_EVENTS: SliderEventsList = [\"change\"];\r\n\r\nconst TEMPLATE = `<div class=\"og-slider\">\r\n      <div class=\"og-slider-label\">{label}</div>\r\n      <div class=\"og-slider-panel\">\r\n        <div class=\"og-slider-progress\"></div>      \r\n        <div class=\"og-slider-pointer\"></div>\r\n      </div>\r\n      <input type=\"number\"/>\r\n    </div>`;\r\n\r\nclass Slider extends View<null> {\r\n\r\n    public override events: EventsHandler<SliderEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    protected _value: number;\r\n    protected _min: number;\r\n    protected _max: number;\r\n\r\n    protected _startPosX: number;\r\n\r\n    protected _resizeObserver: ResizeObserver;\r\n\r\n    protected $label: HTMLElement | null;\r\n    protected $pointer: HTMLElement | null;\r\n    protected $progress: HTMLElement | null;\r\n    protected $input: HTMLInputElement | null;\r\n    protected $panel: HTMLElement | null;\r\n\r\n    constructor(options: ISliderParams = {}) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                label: options.label || \"\"\r\n            })\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(SLIDER_EVENTS);\r\n\r\n        this._value = options.value || 0.0;\r\n        this._min = options.min || 0.0;\r\n        this._max = options.max || 1.0;\r\n        //this._step = options.step || ((this._max - this._min) / 10.0);\r\n\r\n        this._resizeObserver = new ResizeObserver(this._onResize);\r\n\r\n        this._startPosX = 0;\r\n\r\n        this.$label = null;\r\n        this.$pointer = null;\r\n        this.$progress = null;\r\n        this.$input = null;\r\n        this.$panel = null;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n\r\n        super.render(params);\r\n\r\n        this.$label = this.select(\".og-slider-label\")!;\r\n        if (this.$label.innerHTML === \"\") {\r\n            this.$label.style.display = \"none\";\r\n        }\r\n        this.$pointer = this.select(\".og-slider-pointer\");\r\n        this.$progress = this.select(\".og-slider-progress\");\r\n        this.$panel = this.select(\".og-slider-panel\");\r\n        this.$input = this.select<HTMLInputElement>(\"input\");\r\n\r\n        this._resizeObserver.observe(this.el!);\r\n\r\n        this._initEvents();\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _onResize = () => {\r\n        this._setOffset((this._value - this._min) * this.$panel!.clientWidth / (this._max - this._min));\r\n    }\r\n\r\n    public set value(val: number) {\r\n        if (val !== this._value) {\r\n            this._value = clamp(val, this._min, this._max);\r\n            this.$input!.value = this._value.toString();\r\n            this._setOffset((this._value - this._min) * this.$panel!.clientWidth / (this._max - this._min));\r\n            this.events.dispatch(this.events.change, this._value, this);\r\n        }\r\n    }\r\n\r\n    public get value(): number {\r\n        return this._value;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        this.$panel!.addEventListener(\"mousedown\", this._onMouseDown);\r\n        //@ts-ignore\r\n        this.$panel!.addEventListener(\"mousewheel\", this._onMouseWheel);\r\n        this.$panel!.addEventListener(\"wheel\", this._onMouseWheelFF);\r\n        this.$input!.addEventListener(\"input\", this._onInput);\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        this.$panel!.removeEventListener(\"mousedown\", this._onMouseDown);\r\n        //@ts-ignore\r\n        this.$panel!.removeEventListener(\"mousewheel\", this._onMouseWheel);\r\n        this.$panel!.removeEventListener(\"wheel\", this._onMouseWheelFF);\r\n        this.$input!.removeEventListener(\"input\", this._onInput);\r\n    }\r\n\r\n    protected _onMouseWheel = (e: WheelEvent) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        //@ts-ignore\r\n        this.value = this._value + Math.sign(e.wheelDelta) * (this._max - this._min) / 100.0;\r\n    }\r\n\r\n    protected _onMouseWheelFF = (e: WheelEvent) => {\r\n        this._onMouseWheel(e);\r\n    }\r\n\r\n    protected _onInput = (e: Event) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        //@ts-ignore\r\n        this.value = parseFloat(e.target.value);\r\n    }\r\n\r\n    protected _onMouseDown = (e: MouseEvent) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n\r\n        this._startPosX = e.clientX;\r\n\r\n        this.value = this._min + (this._max - this._min) * (e.offsetX / this.$panel!.clientWidth);\r\n\r\n        document.addEventListener(\"mousemove\", this._onMouseMove);\r\n        document.addEventListener(\"mouseup\", this._onMouseUp);\r\n    }\r\n\r\n    protected _setOffset(x: number) {\r\n        if (x >= 0 && x <= this.$panel!.clientWidth) {\r\n            this.$pointer!.style.left = this.$progress!.style.width = `${x * 100 / this.$panel!.clientWidth}%`;\r\n        }\r\n    }\r\n\r\n    protected _onMouseMove = (e: MouseEvent) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        let rect = this.$panel!.getBoundingClientRect();\r\n        let clientX = clamp(e.clientX, rect.left, rect.right);\r\n        let dx = this._startPosX - clientX;\r\n        this._startPosX = clientX;\r\n        this.value = this._value - dx * (this._max - this._min) / this.$panel!.clientWidth;\r\n    }\r\n\r\n    protected _onMouseUp = () => {\r\n        document.removeEventListener(\"mouseup\", this._onMouseUp);\r\n        document.removeEventListener(\"mousemove\", this._onMouseMove);\r\n    }\r\n\r\n    public override remove() {\r\n        this._clearEvents();\r\n        super.remove();\r\n    }\r\n}\r\n\r\nexport {Slider}\r\n","import type {EventsHandler} from \"../Events\";\r\nimport {View} from './View';\r\nimport type {IViewParams, ViewEventsList} from './View';\r\nimport {stringTemplate} from '../utils/shared';\r\n\r\ninterface IColorParams extends IViewParams {\r\n    label?: string;\r\n    value?: string;\r\n}\r\n\r\ntype ColorEventsList = [\"input\"];\r\n\r\nconst COLOR_EVENTS: ColorEventsList = [\"input\"];\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-color\">\r\n      <label for=\"{id}\" class=\"og-color-label\">{label}</label>\r\n      <input type=\"color\" name=\"{id}\" value=\"{value}\"/>\r\n    </div>`;\r\n\r\nlet __labelCounter__ = 0;\r\n\r\nclass Color extends View<null> {\r\n\r\n    public override events: EventsHandler<ColorEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    protected _value: string;\r\n    protected $label: HTMLElement | null;\r\n    protected $input: HTMLInputElement | null;\r\n\r\n    constructor(options: IColorParams = {}) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                id: `color-${__labelCounter__++}`,\r\n                label: options.label || \"\",\r\n                value: options.value || \"#000000\",\r\n            })\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(COLOR_EVENTS);\r\n\r\n        this._value = options.value || \"blue\";\r\n\r\n        this.$label = null;\r\n        this.$input = null;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n\r\n        super.render(params);\r\n\r\n        this.$label = this.select(\".og-color-label\")!;\r\n        if (this.$label.innerHTML === \"\") {\r\n            this.$label.style.display = \"none\";\r\n        }\r\n        this.$input = this.select<HTMLInputElement>(\"input\");\r\n\r\n        this._initEvents();\r\n\r\n        return this;\r\n    }\r\n\r\n    public set value(val: string) {\r\n        if (val !== this._value) {\r\n            this._value = val;\r\n            this.$input!.value = this._value;\r\n            this.events.dispatch(this.events.input, this._value, this);\r\n        }\r\n    }\r\n\r\n    public get value(): string {\r\n        return this._value;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        this.$input!.addEventListener(\"input\", this._onInput);\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        this.$input!.removeEventListener(\"input\", this._onInput);\r\n    }\r\n\r\n    protected _onInput = (e: Event) => {\r\n        //@ts-ignore\r\n        this.value = e.target.value;\r\n    }\r\n\r\n    public override remove() {\r\n        this._clearEvents();\r\n        super.remove();\r\n    }\r\n}\r\n\r\nexport {Color}\r\n","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {Dialog} from '../ui/Dialog';\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {Slider} from \"../ui/Slider\";\r\nimport {Sun} from \"./Sun\";\r\nimport {ToggleButton} from \"../ui/ToggleButton\";\r\nimport {View} from '../ui/View';\r\nimport {Atmosphere} from \"./atmosphere/Atmosphere\";\r\nimport {Color} from \"../ui/Color\";\r\nimport {SimpleSkyBackground} from \"../control/SimpleSkyBackground\";\r\n\r\ninterface ILightingParams extends IControlParams {\r\n\r\n}\r\n\r\nconst SUN_STOP_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?><svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 122.88 70.41\" style=\"enable-background:new 0 0 122.88 70.41\" xml:space=\"preserve\"><g><path d=\"M60.91,19.12c6.95,0,13.24,2.95,17.8,7.72c4.55,4.77,7.37,11.37,7.37,18.64c0,1.94-0.2,3.83-0.58,5.65h31.61 c2.1,0,2.62,1.16,2.62,2.59c0,1.43-0.52,2.59-2.62,2.59H7.09c-2.1,0-2.62-1.16-2.62-2.59c0-1.43,0.52-2.59,2.62-2.59h29.23 c-0.38-1.82-0.58-3.71-0.58-5.65c0-7.28,2.82-13.87,7.37-18.64C47.67,22.08,53.96,19.12,60.91,19.12L60.91,19.12L60.91,19.12z M63.4,70.41c-2.1,0-2.62-1.16-2.62-2.59s0.52-2.59,2.62-2.59h56.86c2.1,0,2.62,1.16,2.62,2.59s-0.52,2.59-2.62,2.59H63.4 L63.4,70.41z M2.62,70.41c-2.1,0-2.62-1.16-2.62-2.59s0.52-2.59,2.62-2.59h29.51c2.1,0,2.62,1.16,2.62,2.59s-0.52,2.59-2.62,2.59 H2.62L2.62,70.41z M38.39,9.46c-0.78-1.35-0.32-3.07,1.03-3.85c1.35-0.78,3.07-0.32,3.85,1.03l3.62,6.27 c0.78,1.35,0.32,3.07-1.03,3.85c-1.35,0.78-3.07,0.32-3.85-1.03L38.39,9.46L38.39,9.46L38.39,9.46z M58.67,2.83 c0-1.56,1.27-2.83,2.83-2.83c1.56,0,2.83,1.27,2.83,2.83v7.24c0,1.56-1.27,2.83-2.83,2.83c-1.56,0-2.83-1.26-2.83-2.83V2.83 L58.67,2.83L58.67,2.83z M79.56,7.23c0.77-1.35,2.49-1.81,3.84-1.04c1.35,0.77,1.81,2.49,1.04,3.84l-3.62,6.27 c-0.77,1.35-2.49,1.81-3.84,1.04c-1.35-0.77-1.81-2.49-1.04-3.84L79.56,7.23L79.56,7.23L79.56,7.23z M95.45,21.48 c1.35-0.78,3.07-0.32,3.85,1.03c0.78,1.35,0.32,3.07-1.03,3.85L92,29.98c-1.35,0.78-3.07,0.32-3.85-1.03 c-0.78-1.35-0.32-3.07,1.03-3.85L95.45,21.48L95.45,21.48L95.45,21.48z M102.08,41.76c1.56,0,2.83,1.27,2.83,2.83 c0,1.56-1.27,2.83-2.83,2.83h-7.24c-1.56,0-2.83-1.26-2.83-2.83s1.26-2.83,2.83-2.83H102.08L102.08,41.76L102.08,41.76z M19.74,46.25c-1.56,0-2.83-1.27-2.83-2.83c0-1.56,1.27-2.83,2.83-2.83h7.24c1.56,0,2.83,1.26,2.83,2.83s-1.27,2.83-2.83,2.83 H19.74L19.74,46.25L19.74,46.25z M24.14,25.35c-1.35-0.77-1.81-2.49-1.04-3.84c0.77-1.35,2.49-1.81,3.84-1.04l6.27,3.62 c1.35,0.77,1.81,2.49,1.04,3.84c-0.77,1.35-2.49,1.81-3.84,1.04L24.14,25.35L24.14,25.35L24.14,25.35z\"/></g></svg>`;\r\nconst SUN_ACTIVE_SVG_ICON = `<?xml version=\"1.0\"?>\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\r\n    <path style=\"text-indent:0;text-align:start;line-height:normal;text-transform:none;block-progression:tb;-inkscape-font-specification:Sans\" d=\"M 16 4 C 9.3844277 4 4 9.3844277 4 16 C 4 22.615572 9.3844277 28 16 28 C 22.615572 28 28 22.615572 28 16 C 28 9.3844277 22.615572 4 16 4 z M 16 6 C 16.389823 6 16.778223 6.0506339 17.15625 6.09375 C 18.631659 7.6568432 21 10.9245 21 16 C 21 21.0755 18.631659 24.343157 17.15625 25.90625 C 16.778223 25.949366 16.389823 26 16 26 C 10.465308 26 6 21.534692 6 16 C 6 10.465308 10.465308 6 16 6 z\" overflow=\"visible\" font-family=\"Sans\"/>\r\n</svg>\r\n`;\r\nconst LIGHTING_ENABLED_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<!-- Generated by IcoMoon.io -->\r\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\r\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\">\r\n<g>\r\n</g>\r\n\\t<path d=\"M257.894 156.948c-53.258 0-96.42 43.561-96.42 97.26 0 53.719 43.161 97.249 96.42 97.249 53.197 0 96.379-43.53 96.379-97.25 0-53.698-43.182-97.26-96.379-97.26zM257.894 309.873c-30.464 0-55.163-24.945-55.163-55.665s24.699-55.624 55.163-55.624c30.423 0 55.101 24.904 55.101 55.624s-24.688 55.665-55.101 55.665z\" fill=\"#000000\" />\r\n\\t<path d=\"M241.808 43.499h32.144v79.575h-32.144v-79.575z\" fill=\"#000000\" />\r\n\\t<path d=\"M417.209 115.897l-22.723-22.917-55.757 56.279 22.723 22.907z\" fill=\"#000000\" />\r\n\\t<path d=\"M389.468 238.407h78.899v32.389h-78.899v-32.389z\" fill=\"#000000\" />\r\n\\t<path d=\"M396.012 416.86l22.723-22.917-55.767-56.259-22.712 22.897z\" fill=\"#000000\" />\r\n\\t<path d=\"M242.473 388.915h32.144v79.575h-32.144v-79.575z\" fill=\"#000000\" />\r\n\\t<path d=\"M96.266 396.073l22.722 22.938 55.778-56.289-22.692-22.928z\" fill=\"#000000\" />\r\n\\t<path d=\"M43.633 240.537h78.879v32.43h-78.879v-32.43z\" fill=\"#000000\" />\r\n\\t<path d=\"M115.394 93.051l-22.681 22.907 55.757 56.258 22.702-22.917z\" fill=\"#000000\" />\r\n</svg>`;\r\nconst ATMOSPHERE_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\r\n<svg width=\"800px\" height=\"800px\" viewBox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path fill=\"#000000\" d=\"M135.688 18.5c-6.798 74.842-23.842 85.39-107.907 59.656 84.85 52.022 73.57 64.954-6.843 96.938 87.743-10.27 103.29 4.89 70.75 87.594 17.805-27.56 32.5-44.498 46.282-54.47-11.813 28.26-18.345 59.274-18.345 91.813 0 84.184 43.71 157.96 109.656 200.376-41.624-43.834-67.686-102.7-67.686-167.875 0-134.923 109.45-244.405 244.375-244.405 30.92 0 60.76 5.762 88 16.25-38.584-26.87-85.517-42.625-136.064-42.625-55.257 0-106.14 18.802-146.562 50.375 4.627-18.783 17.39-38.073 41.03-60.906C190.18 90.942 153.53 95.634 135.69 18.5zm10.03 77.188c5.67.002 11.428 1.247 16.876 3.874 14.506 6.998 22.72 21.81 22 36.938-10.26 10.87-19.507 22.696-27.594 35.344-9.035 2.753-19.075 2.27-28.25-2.156-19.37-9.343-27.5-32.6-18.156-51.97 6.715-13.92 20.638-22.036 35.125-22.03z\"/></svg>`;\r\n\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-lighing og-options-container\">\r\n\r\n         <div class=\"og-option\">\r\n           <div class=\"og-suncontrol\"></div>\r\n         </div>        \r\n         \r\n         <div class=\"og-option og-atmosphere-opacity\">\r\n         </div>\r\n         \r\n         <div class=\"og-option og-simpleskybackground\">\r\n         </div>\r\n         \r\n        <div class=\"og-lighting-emptyline\"></div>\r\n\r\n         <div class=\"og-option og-gamma\"></div>         \r\n         <div class=\"og-option og-exposure\"></div>\r\n       \r\n        <div class=\"og-lighting-emptyline\"></div>\r\n\r\n         <div class=\"og-option\">\r\n         <div class=\"og-layers\">\r\n           <div class=\"og-caption\">Select layer:</div>\r\n           <select id=\"layers\"></select>\r\n         </div>\r\n         </div>\r\n\r\n         <div class=\"og-option og-opacity\">\r\n         </div>\r\n         \r\n         <div class=\"og-option og-night\">\r\n         </div>\r\n         \r\n         <div class=\"og-lighting-emptyline\"></div>\r\n\r\n         <div class=\"og-option og-diffuse\">\r\n         </div>\r\n      \r\n         <div class=\"og-option og-ambient\">\r\n         </div>\r\n\r\n         <div class=\"og-option og-specular\">\r\n         </div>        \r\n\r\n    </div>`;\r\n\r\nconst ICON_BUTTON_SVG = `<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" width=\"256\" height=\"256\" viewBox=\"0 0 256 256\" xml:space=\"preserve\">\r\n\r\n<defs>\r\n</defs>\r\n<g style=\"stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; opacity: 1;\" transform=\"translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)\" >\r\n\\t<path d=\"M 45 68 c -12.682 0 -23 -10.317 -23 -23 c 0 -12.682 10.318 -23 23 -23 c 12.683 0 23 10.318 23 23 C 68 57.683 57.683 68 45 68 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 45 17.556 c -1.657 0 -3 -1.343 -3 -3 V 3 c 0 -1.657 1.343 -3 3 -3 c 1.657 0 3 1.343 3 3 v 11.556 C 48 16.212 46.657 17.556 45 17.556 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 45 90 c -1.657 0 -3 -1.343 -3 -3 V 75.444 c 0 -1.657 1.343 -3 3 -3 c 1.657 0 3 1.343 3 3 V 87 C 48 88.657 46.657 90 45 90 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 14.556 48 H 3 c -1.657 0 -3 -1.343 -3 -3 c 0 -1.657 1.343 -3 3 -3 h 11.556 c 1.657 0 3 1.343 3 3 C 17.556 46.657 16.212 48 14.556 48 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 87 48 H 75.444 c -1.657 0 -3 -1.343 -3 -3 c 0 -1.657 1.343 -3 3 -3 H 87 c 1.657 0 3 1.343 3 3 C 90 46.657 88.657 48 87 48 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 66.527 26.473 c -0.768 0 -1.535 -0.293 -2.121 -0.878 c -1.172 -1.172 -1.172 -3.071 0 -4.243 l 8.171 -8.171 c 1.172 -1.172 3.07 -1.171 4.242 0 c 1.172 1.172 1.172 3.071 0 4.243 l -8.171 8.171 C 68.063 26.18 67.295 26.473 66.527 26.473 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 15.302 77.698 c -0.768 0 -1.536 -0.293 -2.121 -0.879 c -1.172 -1.171 -1.172 -3.071 0 -4.242 l 8.171 -8.171 c 1.171 -1.172 3.071 -1.172 4.242 0 c 1.172 1.171 1.172 3.071 0 4.242 l -8.171 8.171 C 16.837 77.405 16.069 77.698 15.302 77.698 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 23.473 26.473 c -0.768 0 -1.536 -0.293 -2.121 -0.878 l -8.171 -8.171 c -1.172 -1.172 -1.172 -3.071 0 -4.243 c 1.172 -1.172 3.072 -1.171 4.243 0 l 8.171 8.171 c 1.172 1.172 1.172 3.071 0 4.243 C 25.008 26.18 24.24 26.473 23.473 26.473 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n\\t<path d=\"M 74.698 77.698 c -0.768 0 -1.535 -0.293 -2.121 -0.879 l -8.171 -8.171 c -1.172 -1.171 -1.172 -3.071 0 -4.242 c 1.172 -1.172 3.07 -1.172 4.242 0 l 8.171 8.171 c 1.172 1.171 1.172 3.071 0 4.242 C 76.233 77.405 75.466 77.698 74.698 77.698 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\r\n</g>\r\n</svg>`;\r\n\r\nconst MAX_COLOR = 5;\r\n\r\n/**\r\n * Helps to set up lighting.\r\n */\r\nexport class Lighting extends Control {\r\n    protected _selectedLayer: Layer | null;\r\n    protected _toggleBtn: ToggleButton;\r\n    protected _dialog: Dialog<null>;\r\n    protected _panel: View<null>;\r\n\r\n    protected _atmosphereMaxOpacity: Slider;\r\n    protected _atmosphereMinOpacity: Slider;\r\n\r\n    protected _simpleSkyBackgroundColorOne: Color;\r\n    protected _simpleSkyBackgroundColorTwo: Color;\r\n\r\n    protected _gamma: Slider;\r\n    protected _exposure: Slider;\r\n    protected _night: Slider;\r\n    protected _opacity: Slider;\r\n    protected _diffuse_r: Slider;\r\n    protected _diffuse_g: Slider;\r\n    protected _diffuse_b: Slider;\r\n    protected _ambient_r: Slider;\r\n    protected _ambient_g: Slider;\r\n    protected _ambient_b: Slider;\r\n    protected _specular_r: Slider;\r\n    protected _specular_g: Slider;\r\n    protected _specular_b: Slider;\r\n    protected _shininess: Slider;\r\n\r\n    public $gamma: HTMLElement | null;\r\n    public $exposure: HTMLElement | null;\r\n    public $night: HTMLElement | null;\r\n    public $opacity: HTMLElement | null;\r\n    public $diffuse: HTMLElement | null;\r\n    public $ambient: HTMLElement | null;\r\n    public $specular: HTMLElement | null;\r\n    public $atmosphereOpacity: HTMLElement | null;\r\n    public $simpleSkyBackground: HTMLElement | null;\r\n\r\n\r\n    constructor(options: ILightingParams = {}) {\r\n        super(options);\r\n\r\n        this._selectedLayer = null;\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-lighting_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        this._dialog = new Dialog({\r\n            title: \"Lighting Parameters\",\r\n            visible: false,\r\n            useHide: true,\r\n            top: 60,\r\n            left: 60,\r\n            width: 600\r\n        });\r\n\r\n        this._dialog.events.on(\"visibility\", (v: boolean) => {\r\n            this._toggleBtn.setActive(v);\r\n        });\r\n\r\n        this._panel = new View({\r\n            template: TEMPLATE\r\n        });\r\n\r\n        this.$gamma = null;\r\n        this.$exposure = null;\r\n        this.$night = null;\r\n        this.$opacity = null;\r\n        this.$diffuse = null;\r\n        this.$ambient = null;\r\n        this.$specular = null;\r\n        this.$atmosphereOpacity = null;\r\n        this.$simpleSkyBackground = null;\r\n\r\n        this._atmosphereMaxOpacity = new Slider({\r\n            label: \"Max.opacity\",\r\n            max: 5\r\n        });\r\n\r\n        this._atmosphereMinOpacity = new Slider({\r\n            label: \"Min.opacity\",\r\n            max: 5\r\n        });\r\n\r\n        this._simpleSkyBackgroundColorOne = new Color({\r\n            label: \"Color One\"\r\n        });\r\n\r\n        this._simpleSkyBackgroundColorTwo = new Color({\r\n            label: \"Color Two\"\r\n        });\r\n\r\n        this._gamma = new Slider({\r\n            label: \"Gamma\",\r\n            max: 5\r\n        });\r\n\r\n        this._exposure = new Slider({\r\n            label: \"Exposure\",\r\n            max: 5\r\n        });\r\n\r\n        this._night = new Slider({\r\n            label: \"Nightlight\",\r\n            max: 5\r\n        });\r\n\r\n        this._opacity = new Slider({\r\n            label: \"Opacity\",\r\n            max: 1\r\n        });\r\n\r\n        //\r\n        // Diffuse sliders\r\n        //\r\n        this._diffuse_r = new Slider({\r\n            label: \"Diffuse R\",\r\n            max: MAX_COLOR\r\n        });\r\n\r\n        this._diffuse_g = new Slider({\r\n            label: \"Diffuse G\",\r\n            max: MAX_COLOR\r\n        });\r\n\r\n        this._diffuse_b = new Slider({\r\n            label: \"Diffuse B\",\r\n            max: MAX_COLOR\r\n        });\r\n\r\n        //\r\n        // Ambient sliders\r\n        //\r\n        this._ambient_r = new Slider({\r\n            label: \"Ambient R\",\r\n            max: MAX_COLOR\r\n        });\r\n\r\n        this._ambient_g = new Slider({\r\n            label: \"Ambient G\",\r\n            max: MAX_COLOR\r\n        });\r\n\r\n        this._ambient_b = new Slider({\r\n            label: \"Ambient B\",\r\n            max: MAX_COLOR\r\n        });\r\n\r\n        //\r\n        // Specular sliders\r\n        //\r\n        this._specular_r = new Slider({\r\n            label: \"Specular R\",\r\n            max: 0.2\r\n        });\r\n\r\n        this._specular_g = new Slider({\r\n            label: \"Specular G\",\r\n            max: 0.2\r\n        });\r\n\r\n        this._specular_b = new Slider({\r\n            label: \"Specular B\",\r\n            max: 0.2\r\n        });\r\n\r\n        this._shininess = new Slider({\r\n            label: \"Shininess\",\r\n            max: 100\r\n        });\r\n    }\r\n\r\n    public bindLayer(layer: Layer) {\r\n        this._selectedLayer = layer;\r\n        this._opacity.value = layer.opacity;\r\n        this._update();\r\n    }\r\n\r\n    public override oninit() {\r\n\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n        this._dialog.appendTo(this.renderer!.div!);\r\n        this._panel.appendTo(this._dialog.container!);\r\n\r\n        if (this._panel.el) {\r\n            this.$atmosphereOpacity = this._panel.el.querySelector(\".og-atmosphere-opacity\");\r\n            this.$simpleSkyBackground = this._panel.el.querySelector(\".og-simpleskybackground\");\r\n            this.$gamma = this._panel.el.querySelector(\".og-option.og-gamma\");\r\n            this.$exposure = this._panel.el.querySelector(\".og-option.og-exposure\");\r\n            this.$opacity = this._panel.el.querySelector(\".og-option.og-opacity\");\r\n            this.$diffuse = this._panel.el.querySelector(\".og-option.og-diffuse\");\r\n            this.$ambient = this._panel.el.querySelector(\".og-option.og-ambient\");\r\n            this.$specular = this._panel.el.querySelector(\".og-option.og-specular\");\r\n            this.$night = this._panel.el.querySelector(\".og-option.og-night\");\r\n        }\r\n\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this._dialog.setVisibility(isActive);\r\n        });\r\n\r\n        let $suncontrol = this._dialog.select(\".og-suncontrol\")!;\r\n\r\n        let sunStopBtn = new ToggleButton({\r\n            classList: [\"og-suncontrol-button\"],\r\n            isActive: true,\r\n            icon: SUN_STOP_SVG_ICON,\r\n            title: \"Star/stop the Sun from following the camera\"\r\n        });\r\n        sunStopBtn.appendTo($suncontrol);\r\n\r\n        let sunActiveBtn = new ToggleButton({\r\n            classList: [\"og-suncontrol-button\"],\r\n            isActive: true,\r\n            icon: SUN_ACTIVE_SVG_ICON,\r\n            title: \"Activate/deactivate the Sun current time positioning\"\r\n        });\r\n        sunActiveBtn.appendTo($suncontrol);\r\n\r\n        sunStopBtn.events.on(\"change\", (isActive: boolean) => {\r\n            const sun = this.planet!.renderer!.controls.sun as Sun;\r\n            if (isActive) {\r\n                sun.start();\r\n            } else {\r\n                sun.stop();\r\n            }\r\n        });\r\n\r\n        sunActiveBtn.events.on(\"change\", (isActive: boolean) => {\r\n            const sun = this.planet!.renderer!.controls.sun;\r\n            if (isActive) {\r\n                sun.activate();\r\n            } else {\r\n                sun.deactivate();\r\n            }\r\n        });\r\n\r\n        let lightingEnabledBtn = new ToggleButton({\r\n            classList: [\"og-suncontrol-button\"],\r\n            isActive: this.planet!.lightEnabled,\r\n            icon: LIGHTING_ENABLED_SVG_ICON,\r\n            title: \"Enable/disable planet lighting\"\r\n        });\r\n        lightingEnabledBtn.appendTo($suncontrol);\r\n\r\n        lightingEnabledBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this.planet!.lightEnabled = isActive;\r\n        });\r\n\r\n        let atmosphereEnabledBtn = new ToggleButton({\r\n            classList: [\"og-suncontrol-button\"],\r\n            isActive: this.planet!.atmosphereEnabled,\r\n            icon: ATMOSPHERE_SVG_ICON,\r\n            title: \"Enable/disable atmosphere scattering\"\r\n        });\r\n        atmosphereEnabledBtn.appendTo($suncontrol);\r\n\r\n        if (this.planet!.atmosphereEnabled) {\r\n            this.$atmosphereOpacity!.style.display = \"block\";\r\n            this.$simpleSkyBackground!.style.display = \"none\";\r\n        } else {\r\n            this.$atmosphereOpacity!.style.display = \"none\";\r\n            this.$simpleSkyBackground!.style.display = \"flex\";\r\n        }\r\n\r\n        atmosphereEnabledBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this.planet!.atmosphereEnabled = isActive;\r\n            if (this.planet!.atmosphereEnabled) {\r\n                this.$atmosphereOpacity!.style.display = \"block\";\r\n                this.$simpleSkyBackground!.style.display = \"none\";\r\n            } else {\r\n                this.$atmosphereOpacity!.style.display = \"none\";\r\n                this.$simpleSkyBackground!.style.display = \"flex\";\r\n            }\r\n        });\r\n\r\n        this._atmosphereMaxOpacity.appendTo(this.$atmosphereOpacity!);\r\n        this._atmosphereMinOpacity.appendTo(this.$atmosphereOpacity!);\r\n\r\n        this._simpleSkyBackgroundColorOne.appendTo(this.$simpleSkyBackground!);\r\n        this._simpleSkyBackgroundColorTwo.appendTo(this.$simpleSkyBackground!);\r\n\r\n        this._gamma.appendTo(this.$gamma!);\r\n        this._exposure.appendTo(this.$exposure!);\r\n\r\n        this._night.appendTo(this.$night!);\r\n        this._opacity.appendTo(this.$opacity!);\r\n\r\n        this._diffuse_r.appendTo(this.$diffuse!);\r\n        this._diffuse_g.appendTo(this.$diffuse!);\r\n        this._diffuse_b.appendTo(this.$diffuse!);\r\n\r\n        this._ambient_r.appendTo(this.$ambient!);\r\n        this._ambient_g.appendTo(this.$ambient!);\r\n        this._ambient_b.appendTo(this.$ambient!);\r\n\r\n        this._specular_r.appendTo(this.$specular!);\r\n        this._specular_g.appendTo(this.$specular!);\r\n        this._specular_b.appendTo(this.$specular!);\r\n        this._shininess.appendTo(this.$specular!);\r\n\r\n        //\r\n        // Screen options\r\n        //\r\n        this._gamma.value = this.planet!.renderer!.gamma;\r\n        this._gamma.events.on(\"change\", (val: number) => {\r\n            this.planet!.renderer!.gamma = val;\r\n        });\r\n\r\n        this._exposure.value = this.planet!.renderer!.exposure;\r\n        this._exposure.events.on(\"change\", (val: number) => {\r\n            this.planet!.renderer!.exposure = val;\r\n        });\r\n\r\n        //\r\n        // Atmosphere parameters\r\n        //\r\n        this._atmosphereMinOpacity.value = this.planet!.atmosphereMinOpacity;\r\n        this._atmosphereMinOpacity.events.on(\"change\", (val: number) => {\r\n            this.planet!.atmosphereMinOpacity = val;\r\n        });\r\n\r\n        this._atmosphereMaxOpacity.value = this.planet!.atmosphereMaxOpacity;\r\n        this._atmosphereMaxOpacity.events.on(\"change\", (val: number) => {\r\n            this.planet!.atmosphereMaxOpacity = val;\r\n            let atmos = this.planet!.renderer!.controls.Atmosphere as Atmosphere;\r\n            atmos.opacity = val;\r\n        });\r\n\r\n        //\r\n        // Simple Sky Background parameters\r\n        //\r\n        let simpleSkyBackgroundControl = this.planet!.renderer!.controls.SimpleSkyBackground as SimpleSkyBackground;\r\n        if (simpleSkyBackgroundControl) {\r\n            this._simpleSkyBackgroundColorOne.value = simpleSkyBackgroundControl.colorOne;\r\n            this._simpleSkyBackgroundColorTwo.value = simpleSkyBackgroundControl.colorTwo;\r\n        }\r\n\r\n        this._simpleSkyBackgroundColorOne.events.on(\"input\", (val: string) => {\r\n            let simpleSkyBackgroundControl = this.planet!.renderer!.controls.SimpleSkyBackground as SimpleSkyBackground;\r\n            if (simpleSkyBackgroundControl) {\r\n                simpleSkyBackgroundControl.colorOne = val;\r\n            }\r\n        });\r\n\r\n        this._simpleSkyBackgroundColorTwo.events.on(\"input\", (val: string) => {\r\n            let simpleSkyBackgroundControl = this.planet!.renderer!.controls.SimpleSkyBackground as SimpleSkyBackground;\r\n            if (simpleSkyBackgroundControl) {\r\n                simpleSkyBackgroundControl.colorTwo = val;\r\n            }\r\n        });\r\n\r\n        //\r\n        // Planet options\r\n        //\r\n        this._panel.el!.querySelector<HTMLSelectElement>(\"#layers\")!.addEventListener(\"change\", (e: Event) => {\r\n            const l = this.planet!.getLayerByName((e.target as HTMLSelectElement).value);\r\n            if (l) {\r\n                this.bindLayer(l);\r\n            }\r\n        });\r\n\r\n        this._night.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer) {\r\n                this._selectedLayer.nightTextureCoefficient = val;\r\n            }\r\n        });\r\n\r\n        this._opacity.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer)\r\n                this._selectedLayer.opacity = val;\r\n        });\r\n\r\n        this._ambient_r.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._ambient)\r\n                this._selectedLayer._ambient[0] = val\r\n        });\r\n\r\n        this._ambient_g.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._ambient)\r\n                this._selectedLayer._ambient[1] = val\r\n        });\r\n\r\n        this._ambient_b.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._ambient)\r\n                this._selectedLayer._ambient[2] = val\r\n        });\r\n\r\n        this._diffuse_r.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._diffuse)\r\n                this._selectedLayer._diffuse[0] = val\r\n        });\r\n\r\n        this._diffuse_g.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._diffuse)\r\n                this._selectedLayer._diffuse[1] = val\r\n        });\r\n\r\n        this._diffuse_b.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._diffuse)\r\n                this._selectedLayer._diffuse[2] = val\r\n        });\r\n\r\n        this._specular_r.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._specular)\r\n                this._selectedLayer._specular[0] = val\r\n        });\r\n\r\n        this._specular_g.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._specular)\r\n                this._selectedLayer._specular[1] = val\r\n        });\r\n\r\n        this._specular_b.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._specular)\r\n                this._selectedLayer._specular[2] = val\r\n        });\r\n\r\n        this._shininess.events.on(\"change\", (val: number) => {\r\n            if (this._selectedLayer && this._selectedLayer._specular)\r\n                this._selectedLayer._specular[3] = val\r\n        });\r\n\r\n\r\n        if (this.planet) {\r\n            this.planet!.events.on(\"layeradd\", this._onLayerAdd, this);\r\n            this.planet!.events.on(\"layerremove\", this._onLayerRemove, this);\r\n        }\r\n\r\n        this._fetchLayers();\r\n    }\r\n\r\n    protected _update() {\r\n        let l = this._selectedLayer;\r\n\r\n        this._opacity.value = l && l.opacity ? l.opacity : 0.0;\r\n\r\n        this._night.value = l && l.nightTextureCoefficient ? l.nightTextureCoefficient : this.planet!.nightTextureCoefficient;\r\n\r\n        let a = l && l._ambient ? l._ambient : this.planet!._ambient;\r\n        this._ambient_r.value = a[0];\r\n        this._ambient_g.value = a[1];\r\n        this._ambient_b.value = a[2];\r\n\r\n        let d = l && l._diffuse ? l._diffuse : this.planet!._diffuse;\r\n        this._diffuse_r.value = d[0];\r\n        this._diffuse_g.value = d[1];\r\n        this._diffuse_b.value = d[2];\r\n\r\n        let s = l && l._specular ? l._specular : this.planet!._specular;\r\n        this._specular_r.value = s[0];\r\n        this._specular_g.value = s[1];\r\n        this._specular_b.value = s[2];\r\n        this._shininess.value = s[3];\r\n    }\r\n\r\n    protected _fetchLayers() {\r\n        if (this.planet) {\r\n            for (let i = 0; i < this.planet.layers.length; i++) {\r\n                this._onLayerAdd(this.planet.layers[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onLayerAdd(e: Layer) {\r\n        this.bindLayer(e);\r\n        let opt = document.createElement(\"option\");\r\n        opt.value = e.name;\r\n        opt.innerText = e.name;\r\n        this._panel.el!.querySelector(\"#layers\")!.appendChild(opt);\r\n        this._panel.el!.querySelector<HTMLSelectElement>(\"#layers\")!.value = e.name;\r\n    }\r\n\r\n    protected _onLayerRemove(e: Layer) {\r\n    }\r\n}\r\n","class Lock {\r\n\r\n    protected _lock: number;\r\n\r\n    constructor() {\r\n        this._lock = 0;\r\n    }\r\n\r\n    public lock(key: Key) {\r\n        this._lock |= (1 << key.id);\r\n    }\r\n\r\n    public free(key: Key) {\r\n        this._lock &= ~(1 << key.id);\r\n    }\r\n\r\n    public isFree(): boolean {\r\n        return this._lock === 0;\r\n    }\r\n\r\n    public isLocked(): boolean {\r\n        return this._lock !== 0;\r\n    }\r\n}\r\n\r\nclass Key {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    protected __id: number;\r\n\r\n    constructor() {\r\n        this.__id = Key.__counter__++;\r\n    }\r\n\r\n    public get id(): number {\r\n        return this.__id;\r\n    }\r\n}\r\n\r\nexport {Lock, Key};\r\n","import * as math from \"../math\";\r\nimport {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {input} from \"../input/input\";\r\nimport {Key} from \"../Lock\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Mat4} from \"../math/Mat4\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {PlanetCamera} from \"../camera/PlanetCamera\";\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\nimport {Plane} from \"../math/Plane\";\r\n\r\nexport interface IStepForward {\r\n    eye: Vec3;\r\n    v: Vec3;\r\n    u: Vec3;\r\n    n: Vec3;\r\n}\r\n\r\ninterface IMouseNavigationParams extends IControlParams {\r\n    minSlope?: number;\r\n}\r\n\r\n/**\r\n * Mouse planet camera dragging control.\r\n */\r\nexport class OldMouseNavigation extends Control {\r\n    protected grabbedPoint: Vec3;\r\n    protected _eye0: Vec3;\r\n    protected pointOnEarth: Vec3;\r\n    protected earthUp: Vec3;\r\n    public inertia: number;\r\n    protected grabbedSpheroid: Sphere;\r\n    protected qRot: Quat;\r\n    protected scaleRot: number;\r\n    protected distDiff: number;\r\n    protected stepsCount: number;\r\n    protected stepsForward: IStepForward[] | null;\r\n    protected stepIndex: number;\r\n    protected _lmbDoubleClickActive: boolean;\r\n    public minSlope: number;\r\n    protected _wheelDirection: number;\r\n    protected _keyLock: Key;\r\n    protected _deactivate = false;\r\n    protected _shiftBusy = false;\r\n\r\n    constructor(options: IMouseNavigationParams = {}) {\r\n        super(options);\r\n\r\n        this._name = \"mouseNavigation\";\r\n\r\n        this.grabbedPoint = new Vec3();\r\n        this._eye0 = new Vec3();\r\n        this.pointOnEarth = new Vec3();\r\n        this.earthUp = new Vec3();\r\n        this.inertia = 0.007;\r\n        this.grabbedSpheroid = new Sphere();\r\n        this.qRot = new Quat();\r\n        this.scaleRot = 0.0;\r\n\r\n        this.distDiff = 0.3;\r\n        this.stepsCount = 8;\r\n        this.stepsForward = null;\r\n        this.stepIndex = 0;\r\n\r\n        this._lmbDoubleClickActive = true;\r\n\r\n        this.minSlope = options.minSlope || 0.1;\r\n\r\n        this._wheelDirection = +1;\r\n\r\n        this._keyLock = new Key();\r\n    }\r\n\r\n    static getMovePointsFromPixelTerrain(cam: PlanetCamera, planet: Planet, stepsCount: number, delta: number, point: Vec2, forward: boolean, dir?: Vec3 | null): IStepForward[] | undefined {\r\n        const steps: IStepForward[] = [];\r\n\r\n        let eye = cam.eye.clone(),\r\n            n = cam.getBackward(),\r\n            u = cam.getRight(),\r\n            v = cam.getUp();\r\n\r\n        let a = planet.getCartesianFromPixelTerrain(point);\r\n\r\n        if (!a) {\r\n            a = planet.getCartesianFromPixelTerrain(planet.renderer!.handler.getCenter());\r\n        }\r\n\r\n        if (a) {\r\n            if (!dir) {\r\n                dir = Vec3.sub(a, cam.eye).normalize();\r\n            }\r\n\r\n            let d = (delta * cam.eye.distance(a)) / stepsCount;\r\n\r\n            if (forward) {\r\n                d = -1.25 * d;\r\n            } else {\r\n                d *= 2;\r\n            }\r\n\r\n            const scaled_n = n.scaleTo(d);\r\n\r\n            const slope = dir.dot(cam.eye.normal().negate());\r\n\r\n            if (slope >= 0.1) {\r\n                const grabbedSpheroid = new Sphere();\r\n                grabbedSpheroid.radius = a.length();\r\n\r\n                let rotArr = [],\r\n                    eyeArr = [];\r\n\r\n                let breaked = false;\r\n                for (let i = 0; i < stepsCount; i++) {\r\n                    eye.addA(scaled_n);\r\n                    const b = new Ray(eye, dir).hitSphere(grabbedSpheroid);\r\n                    eyeArr[i] = eye.clone();\r\n                    if (b) {\r\n                        rotArr[i] = new Mat4().rotateBetweenVectors(a.normal(), b.normal());\r\n                    } else {\r\n                        breaked = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (!breaked) {\r\n                    for (let i = 0; i < stepsCount; i++) {\r\n                        let rot = rotArr[i];\r\n                        steps[i] = {\r\n                            eye: rot.mulVec3(eyeArr[i]),\r\n                            v: rot.mulVec3(v),\r\n                            u: rot.mulVec3(u),\r\n                            n: rot.mulVec3(n)\r\n                        };\r\n                    }\r\n                } else {\r\n                    eye = cam.eye.clone();\r\n                    for (let i = 0; i < stepsCount; i++) {\r\n                        steps[i] = {\r\n                            eye: eye.addA(scaled_n).clone(),\r\n                            v: v,\r\n                            u: u,\r\n                            n: n,\r\n                        };\r\n                    }\r\n                }\r\n            } else {\r\n                for (let i = 0; i < stepsCount; i++) {\r\n                    steps[i] = {\r\n                        eye: eye.addA(dir.scaleTo(-d)).clone(),\r\n                        v: v,\r\n                        u: u,\r\n                        n: n,\r\n                    };\r\n                }\r\n            }\r\n\r\n            return steps;\r\n        }\r\n    }\r\n\r\n    public override onactivate() {\r\n        if (this.renderer) {\r\n            this.renderer.events.on(\"mousewheel\", this.onMouseWheel, this);\r\n            this.renderer.events.on(\"lhold\", this.onMouseLeftButtonDown, this);\r\n            this.renderer.events.on(\"rhold\", this.onMouseRightButtonDown, this);\r\n            this.renderer.events.on(\"ldown\", this.onMouseLeftButtonClick, this);\r\n            this.renderer.events.on(\"lup\", this.onMouseLeftButtonUp, this);\r\n            this.renderer.events.on(\"rdown\", this.onMouseRightButtonClick, this);\r\n            this.renderer.events.on(\"draw\", this.onDraw, this, -1000);\r\n            this.renderer.events.on(\"mousemove\", this.onMouseMove, this);\r\n            this.renderer.events.on(\"mouseleave\", this.onMouseLeave, this);\r\n            this.renderer.events.on(\"mouseenter\", this.onMouseEnter, this);\r\n\r\n            if (this._lmbDoubleClickActive) {\r\n                this.renderer.events.on(\"ldblclick\", this.onMouseLeftButtonDoubleClick, this);\r\n            }\r\n        }\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        if (this.renderer) {\r\n            this.renderer.events.off(\"mousewheel\", this.onMouseWheel);\r\n            this.renderer.events.off(\"lhold\", this.onMouseLeftButtonDown);\r\n            this.renderer.events.off(\"rhold\", this.onMouseRightButtonDown);\r\n            this.renderer.events.off(\"ldown\", this.onMouseLeftButtonClick);\r\n            this.renderer.events.off(\"lup\", this.onMouseLeftButtonUp);\r\n            this.renderer.events.off(\"rdown\", this.onMouseRightButtonClick);\r\n            this.renderer.events.off(\"draw\", this.onDraw);\r\n            this.renderer.events.off(\"ldblclick\", this.onMouseLeftButtonDoubleClick);\r\n            this.renderer.events.off(\"mouseleave\", this.onMouseLeave);\r\n            this.renderer.events.off(\"mouseenter\", this.onMouseEnter);\r\n        }\r\n    }\r\n\r\n    public activateDoubleClickZoom() {\r\n        if (!this._lmbDoubleClickActive) {\r\n            this._lmbDoubleClickActive = true;\r\n            this.renderer && this.renderer.events.on(\"ldblclick\", this.onMouseLeftButtonDoubleClick, this);\r\n        }\r\n    }\r\n\r\n    public deactivateDoubleClickZoom() {\r\n        if (this._lmbDoubleClickActive) {\r\n            this._lmbDoubleClickActive = false;\r\n            this.renderer && this.renderer.events.off(\"ldblclick\", this.onMouseLeftButtonDoubleClick);\r\n        }\r\n    }\r\n\r\n    protected onMouseEnter(e: IMouseState) {\r\n        const renderEvents = this.renderer!.events;\r\n        if (renderEvents.isKeyPressed(input.KEY_ALT)) {\r\n            renderEvents.releaseKeys();\r\n        }\r\n\r\n        renderEvents.updateButtonsStates(e.sys!.buttons);\r\n        if (renderEvents.mouseState.leftButtonDown) {\r\n            this.renderer!.handler.canvas!.classList.add(\"ogGrabbingPoiner\");\r\n        } else {\r\n            this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n        }\r\n    }\r\n\r\n    protected onMouseLeave() {\r\n        if (this.renderer!.events.mouseState.leftButtonDown) {\r\n            this.scaleRot = 0;\r\n        }\r\n        this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n    }\r\n\r\n    protected onMouseWheel(e: IMouseState) {\r\n        if (this.stepIndex) {\r\n            return;\r\n        }\r\n\r\n        this.planet!.stopFlying();\r\n\r\n        this.stopRotation();\r\n\r\n        this._deactivate = true;\r\n\r\n        this.lockPlanet(true);\r\n\r\n        this.stepsForward = OldMouseNavigation.getMovePointsFromPixelTerrain(\r\n            this.planet!.camera,\r\n            this.planet!,\r\n            this.stepsCount,\r\n            this.distDiff,\r\n            e.pos,\r\n            e.wheelDelta > 0,\r\n            e.direction\r\n        ) || null;\r\n\r\n        this._wheelDirection = e.wheelDelta;\r\n\r\n        if (this.stepsForward) {\r\n            this.stepIndex = this.stepsCount;\r\n        }\r\n    }\r\n\r\n    public override oninit() {\r\n        this.activate();\r\n        if (this.renderer) {\r\n            this.renderer.events.on(\"keyfree\", input.KEY_ALT, this.onShiftFree, this);\r\n            this.renderer.events.on(\"keyfree\", input.KEY_PRINTSCREEN, this.onShiftFree, this);\r\n        }\r\n    }\r\n\r\n    protected onMouseLeftButtonDoubleClick(e: IMouseState) {\r\n        this.planet!.stopFlying();\r\n        this.stopRotation();\r\n        const p = this.planet!.getCartesianFromPixelTerrain(e.pos);\r\n        if (p) {\r\n            const cam = this.planet!.camera;\r\n            let maxAlt = cam.maxAltitude + this.planet!.ellipsoid.polarSize;\r\n            let minAlt = cam.minAltitude + this.planet!.ellipsoid.polarSize;\r\n            const camAlt = cam.eye.length();\r\n            const g = this.planet!.ellipsoid.cartesianToLonLat(p);\r\n            if (camAlt > maxAlt || camAlt < minAlt) {\r\n                this.planet!.flyLonLat(new LonLat(g.lon, g.lat))\r\n                return;\r\n            }\r\n\r\n            if (this.renderer!.events.isKeyPressed(input.KEY_ALT)) {\r\n                this.planet!.flyLonLat(\r\n                    new LonLat(g.lon, g.lat, cam.eye.distance(p) * 2.0)\r\n                );\r\n            } else {\r\n                this.planet!.flyLonLat(\r\n                    new LonLat(g.lon, g.lat, cam.eye.distance(p) * 0.57)\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onMouseLeftButtonClick() {\r\n        if (this._active) {\r\n            this.renderer!.handler.canvas!.classList.add(\"ogGrabbingPoiner\");\r\n            this.grabbedPoint = this.planet!.getCartesianFromMouseTerrain()!;\r\n            if (this.grabbedPoint) {\r\n                this._eye0.copy(this.planet!.camera.eye);\r\n                this.grabbedSpheroid.radius = this.grabbedPoint.length();\r\n                this.stopRotation();\r\n            }\r\n        }\r\n    }\r\n\r\n    public stopRotation() {\r\n        this.qRot.clear();\r\n        this.freePlanet();\r\n    }\r\n\r\n    protected onMouseLeftButtonUp(e: IMouseState) {\r\n        this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n        if (e.x === e.prev_x && e.y === e.prev_y) {\r\n            this.scaleRot = 0.0;\r\n        }\r\n    }\r\n\r\n    protected onMouseLeftButtonDown(e: IMouseState) {\r\n        if (this._active) {\r\n            if (!this.grabbedPoint) {\r\n                return;\r\n            }\r\n\r\n            this.planet!.stopFlying();\r\n\r\n            if (e.moving) {\r\n                let cam = this.planet!.camera;\r\n\r\n                if (cam.slope > 0.2) {\r\n                    const targetPoint = new Ray(cam.eye, e.direction).hitSphere(this.grabbedSpheroid);\r\n                    if (targetPoint) {\r\n                        this.scaleRot = 1.0;\r\n                        this.qRot = Quat.getRotationBetweenVectors(\r\n                            targetPoint.normal(),\r\n                            this.grabbedPoint.normal()\r\n                        );\r\n                        let rot = this.qRot;\r\n                        cam.eye = rot.mulVec3(cam.eye);\r\n                        cam.rotate(rot);\r\n                        // cam._u = rot.mulVec3(cam._u);\r\n                        // cam._r = rot.mulVec3(cam._r);\r\n                        // cam._b = rot.mulVec3(cam._b);\r\n                        // cam._f.set(-cam._b.x, -cam._b.y, -cam._b.z);\r\n                    }\r\n                } else {\r\n                    let p0 = this.grabbedPoint,\r\n                        p1 = Vec3.add(p0, cam.getRight()),\r\n                        p2 = Vec3.add(p0, p0.normal());\r\n\r\n                    let px = new Vec3();\r\n                    if (new Ray(cam.eye, e.direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n                        cam.eye = this._eye0.addA(px.subA(p0).negate());\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onMouseRightButtonClick(e: IMouseState) {\r\n        this.stopRotation();\r\n        this.planet!.stopFlying();\r\n        this.pointOnEarth = this.planet!.getCartesianFromPixelTerrain(e.pos)!;\r\n        if (this.pointOnEarth) {\r\n            this.earthUp = this.pointOnEarth.normal();\r\n        }\r\n    }\r\n\r\n    protected onMouseRightButtonDown(e: IMouseState) {\r\n        const cam = this.planet!.camera;\r\n\r\n        if (this.pointOnEarth && e.moving) {\r\n            this.renderer!.controlsBag.scaleRot = 1.0;\r\n            let l = (0.5 / cam.eye.distance(this.pointOnEarth)) * cam._lonLat.height * math.RADIANS;\r\n            if (l > 0.007) {\r\n                l = 0.007;\r\n            } else if (l < 0.003) {\r\n                l = 0.003;\r\n            }\r\n            cam.rotateHorizontal(l * (e.x - e.prev_x), false, this.pointOnEarth, this.earthUp);\r\n            cam.rotateVertical(l * (e.y - e.prev_y), this.pointOnEarth, this.minSlope);\r\n        }\r\n    }\r\n\r\n    public onShiftFree() {\r\n        this._shiftBusy = false;\r\n    }\r\n\r\n    protected onMouseMove(e: IMouseState) {\r\n        if (this._active && this.renderer!.events.isKeyPressed(input.KEY_ALT)) {\r\n            if (!this._shiftBusy) {\r\n                this._shiftBusy = true;\r\n                this.onMouseRightButtonClick(e);\r\n            }\r\n\r\n            this.onMouseRightButtonDown(e);\r\n        }\r\n    }\r\n\r\n    protected onDraw() {\r\n        if (this._active) {\r\n            const r = this.renderer!;\r\n            const cam = this.planet!.camera;\r\n            let prevEye = cam.eye.clone();\r\n\r\n            if (this.stepIndex) {\r\n                r.controlsBag.scaleRot = 1.0;\r\n                const sf = this.stepsForward![this.stepsCount - this.stepIndex--];\r\n                cam.eye = sf.eye;\r\n                //@ts-ignore\r\n                cam._u = sf.v;\r\n                //@ts-ignore\r\n                cam._r = sf.u;\r\n                //@ts-ignore\r\n                cam._b = sf.n;\r\n                //@ts-ignore\r\n                cam._f.set(-cam._b.x, -cam._b.y, -cam._b.z);\r\n            } else {\r\n                if (this._deactivate) {\r\n                    this._deactivate = false;\r\n                    this.freePlanet();\r\n                }\r\n            }\r\n\r\n            if (r.events.mouseState.leftButtonDown || !this.scaleRot) {\r\n                return;\r\n            }\r\n\r\n            this.scaleRot -= this.inertia;\r\n            if (this.scaleRot <= 0.0) {\r\n                this.scaleRot = 0.0;\r\n            } else {\r\n                r.controlsBag.scaleRot = this.scaleRot;\r\n                let rot = this.qRot\r\n                    .slerp(Quat.IDENTITY, 1.0 - this.scaleRot * this.scaleRot * this.scaleRot)\r\n                    .normalize();\r\n                if (!(rot.x || rot.y || rot.z)) {\r\n                    this.scaleRot = 0.0;\r\n                }\r\n                cam.eye = rot.mulVec3(cam.eye);\r\n                cam.rotate(rot);\r\n                // cam._u = rot.mulVec3(cam._u);\r\n                // cam._r = rot.mulVec3(cam._r);\r\n                // cam._b = rot.mulVec3(cam._b);\r\n                // cam._f.set(-cam._b.x, -cam._b.y, -cam._b.z);\r\n            }\r\n\r\n            if (cam.eye.distance(prevEye) / cam.getAltitude() > 0.01) {\r\n                this.lockPlanet();\r\n            } else {\r\n                this.freePlanet();\r\n            }\r\n        }\r\n    }\r\n\r\n    public lockPlanet(skipTerrain?: boolean) {\r\n        this.planet!.layerLock.lock(this._keyLock);\r\n        !skipTerrain && this.planet!.terrainLock.lock(this._keyLock);\r\n        this.planet!._normalMapCreator.lock(this._keyLock);\r\n    }\r\n\r\n    public freePlanet() {\r\n        this.planet!.layerLock.free(this._keyLock);\r\n        this.planet!.terrainLock.free(this._keyLock);\r\n        this.planet!._normalMapCreator.free(this._keyLock);\r\n    }\r\n}\r\n","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {input} from \"../input/input\";\r\nimport {Plane} from \"../math/Plane\";\r\n\r\ninterface IEarthNavigationParams extends IControlParams {\r\n    speed?: number;\r\n    fixedUp?: boolean;\r\n}\r\n\r\nconst DEFAULT_VELINERTIA = 0.96;\r\n\r\n// Camera moves vertically (up/down) when slope is less than this threshold\r\nconst MIN_SLOPE = 0.35;\r\n\r\n\r\nexport class MouseNavigation extends Control {\r\n\r\n    public speed: number;\r\n    public force: Vec3;\r\n    public force_h: number;\r\n    public force_v: number;\r\n    public vel: Vec3;\r\n    public vel_h: number;\r\n    public vel_v: number;\r\n    public mass: number;\r\n\r\n    public vel_roll: number;\r\n    public force_roll: number;\r\n\r\n    protected _lookPos: Vec3 | undefined;\r\n\r\n    protected _grabbedPoint: Vec3 | null;\r\n\r\n    protected _targetZoomPoint: Vec3 | null;\r\n\r\n    protected _targetDragPoint: Vec3 | null;\r\n\r\n    protected _targetRotationPoint: Vec3 | null;\r\n\r\n    protected _grabbedSphere: Sphere;\r\n\r\n    protected _wheelDirection: number;\r\n\r\n    protected _currScreenPos: Vec2;\r\n\r\n    protected _tUp: Vec3;\r\n    protected _tRad: number;\r\n\r\n    protected _shiftBusy = false;\r\n\r\n    protected fixedUp: boolean;\r\n\r\n    protected _curPitch: number;\r\n\r\n    protected _curYaw: number;\r\n\r\n    protected _curRoll: number;\r\n\r\n    protected _rot: Quat;\r\n\r\n    protected _eye0: Vec3;\r\n\r\n    protected _grabbedCameraHeight: number;\r\n\r\n    protected _newEye: Vec3;\r\n\r\n    protected _isTouchPad: boolean;\r\n\r\n    protected _velInertia: number;\r\n\r\n    protected _hold: boolean = false;\r\n\r\n    protected _prevVel: Vec3 = new Vec3();\r\n\r\n    protected _screenPosIsChanged: boolean = true;\r\n\r\n    protected _rotHDir: number;\r\n    protected _rotVDir: number;\r\n\r\n    constructor(options: IEarthNavigationParams = {}) {\r\n        super({\r\n            name: \"mouseNavigation\",\r\n            autoActivate: true,\r\n            ...options\r\n        });\r\n\r\n        this.speed = options.speed || 1.0; // m/s\r\n        this.force = new Vec3();\r\n        this.force_h = 0;\r\n        this.force_v = 0;\r\n\r\n        this.vel = new Vec3();\r\n        this.vel_h = 0;\r\n        this.vel_v = 0;\r\n\r\n        this.vel_roll = 0;\r\n        this.force_roll = 0;\r\n\r\n        this.mass = 1;\r\n        this._velInertia = DEFAULT_VELINERTIA;\r\n\r\n        this._lookPos = undefined;\r\n        this._grabbedPoint = null;\r\n\r\n        this._targetZoomPoint = null;\r\n        this._targetDragPoint = null;\r\n        this._targetRotationPoint = null;\r\n        this._tUp = new Vec3();\r\n        this._tRad = 0;\r\n        this._rotHDir = 0;\r\n        this._rotVDir = 0;\r\n\r\n        this._wheelDirection = 1;\r\n\r\n        this._currScreenPos = new Vec2();\r\n\r\n        this._grabbedSphere = new Sphere();\r\n\r\n        this.fixedUp = options.fixedUp != undefined ? options.fixedUp : true;\r\n\r\n        this._rot = new Quat();\r\n\r\n        this._curPitch = 0;\r\n        this._curYaw = 0;\r\n        this._curRoll = 0;\r\n\r\n        this._eye0 = new Vec3();\r\n        this._newEye = new Vec3();\r\n        this._grabbedCameraHeight = 0;\r\n\r\n        this._isTouchPad = false;\r\n    }\r\n\r\n    override oninit() {\r\n        if (this.renderer) {\r\n            this.renderer.events.on(\"keyfree\", input.KEY_ALT, this._onShiftFree);\r\n            this.renderer.events.on(\"keyfree\", input.KEY_PRINTSCREEN, this._onShiftFree);\r\n        }\r\n    }\r\n\r\n    public override onactivate() {\r\n        super.onactivate();\r\n        let r = this.renderer!;\r\n        r.events.on(\"mousewheel\", this._onMouseWheel);\r\n        r.events.on(\"rhold\", this._onRHold);\r\n        r.events.on(\"rdown\", this._onRDown);\r\n        r.events.on(\"lhold\", this._onLHold);\r\n        r.events.on(\"ldown\", this._onLDown);\r\n        r.events.on(\"lup\", this._onLUp);\r\n        r.events.on(\"draw\", this.onDraw, this, -1000);\r\n        r.events.on(\"mousemove\", this._onMouseMove);\r\n        r.events.on(\"mouseleave\", this._onMouseLeave);\r\n        r.events.on(\"mouseenter\", this._onMouseEnter);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        super.ondeactivate();\r\n        let r = this.renderer!;\r\n        r.events.off(\"mousewheel\", this._onMouseWheel);\r\n        r.events.off(\"rhold\", this._onRHold);\r\n        r.events.off(\"rdown\", this._onRDown);\r\n        r.events.off(\"lhold\", this._onLHold);\r\n        r.events.off(\"ldown\", this._onLDown);\r\n        r.events.off(\"lup\", this._onLUp);\r\n        r.events.off(\"draw\", this.onDraw);\r\n        r.events.off(\"mousemove\", this._onMouseMove);\r\n        r.events.off(\"mouseleave\", this._onMouseLeave);\r\n        r.events.off(\"mouseenter\", this._onMouseEnter);\r\n    }\r\n\r\n    protected onDraw() {\r\n        this._updateVel();\r\n        this._handleZoom();\r\n        this._handleDrag();\r\n        this._handleRotation();\r\n    }\r\n\r\n    public _onShiftFree = () => {\r\n        this._shiftBusy = false;\r\n    }\r\n\r\n    protected _onMouseMove = (e: IMouseState) => {\r\n        if (this._active && this.renderer!.events.isKeyPressed(input.KEY_ALT)) {\r\n            if (!this._shiftBusy) {\r\n                this._shiftBusy = true;\r\n                this._onRHold(e);\r\n            }\r\n            this._onRDown(e);\r\n        }\r\n    }\r\n\r\n    protected _onMouseEnter = (e: IMouseState) => {\r\n        const renderEvents = this.renderer!.events;\r\n        if (renderEvents.isKeyPressed(input.KEY_ALT)) {\r\n            renderEvents.releaseKeys();\r\n        }\r\n\r\n        renderEvents.updateButtonsStates(e.sys!.buttons);\r\n        if (renderEvents.mouseState.leftButtonDown) {\r\n            this.renderer!.handler.canvas!.classList.add(\"ogGrabbingPoiner\");\r\n        } else {\r\n            this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n        }\r\n    }\r\n\r\n    protected _onMouseLeave = () => {\r\n        if (this.renderer!.events.mouseState.leftButtonDown) {\r\n            this.vel.scale(0);\r\n        }\r\n        this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n    }\r\n\r\n    protected _onRHold = (e: IMouseState) => {\r\n        if (this._targetRotationPoint) {\r\n            let _noRotationInertia = false;\r\n            this._velInertia = 0.8;\r\n            this.force_h = 0.2 * (e.x - e.prev_x);\r\n            this.force_v = 0.2 * (e.y - e.prev_y);\r\n        }\r\n    }\r\n\r\n    protected _handleRotation() {\r\n        if (this.planet && this._targetRotationPoint) {\r\n            let cam = this.planet!.camera;\r\n\r\n            // let l = (0.3 / this._tRad) * math.RADIANS;\r\n            // if (l > 0.007) {\r\n            //     l = 0.007;\r\n            // } else if (l < 0.003) {\r\n            //     l = 0.003;\r\n            // }\r\n\r\n            let d_v_h = this.vel_h * this.dt;\r\n            let d_v_v = this.vel_v * this.dt;\r\n\r\n            cam.rotateHorizontal(d_v_h, false, this._targetRotationPoint, this._tUp);\r\n            cam.rotateVertical(d_v_v, this._targetRotationPoint, 0.1);\r\n\r\n            this._curPitch = cam.getPitch();\r\n            this._curYaw = cam.getYaw();\r\n            this._curRoll = cam.getRoll();\r\n\r\n            this._velInertia = DEFAULT_VELINERTIA;\r\n        }\r\n    }\r\n\r\n    protected _onRDown = (e: IMouseState) => {\r\n        if (this.planet) {\r\n            this.planet.stopFlying();\r\n            this._targetRotationPoint = this._getTargetPoint(e.pos)!;\r\n            if (this._targetRotationPoint) {\r\n\r\n                this._targetZoomPoint = null;\r\n                this._targetDragPoint = null;\r\n\r\n                this.vel.set(0, 0, 0);\r\n                this._tUp = this._targetRotationPoint.getNormal();\r\n                this._tRad = this.planet.camera.eye.distance(this._targetRotationPoint);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _getTargetPoint(p: Vec2): Vec3 | null {\r\n        if (this.planet) {\r\n            if (this.planet.camera.getAltitude() > 80000) {\r\n                return this.planet.getCartesianFromPixelEllipsoid(p) || null;\r\n            }\r\n            return this.planet.getCartesianFromPixelTerrain(p) || null;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    protected _onMouseWheel = (e: IMouseState) => {\r\n        if (this.planet) {\r\n\r\n            this._targetRotationPoint = null;\r\n            this._targetDragPoint = null;\r\n            let _targetZoomPoint = this._getTargetPoint(e.pos);\r\n\r\n            if (!_targetZoomPoint)\r\n                return;\r\n\r\n            this._targetZoomPoint = _targetZoomPoint;\r\n\r\n            this._grabbedSphere.radius = this._targetZoomPoint.length();\r\n\r\n            this._curPitch = this.planet.camera.getPitch();\r\n            this._curYaw = this.planet.camera.getYaw();\r\n            this._curRoll = this.planet.camera.getRoll();\r\n\r\n            if (Math.sign(e.wheelDelta) !== this._wheelDirection) {\r\n                this.vel.scale(0.3);\r\n                this._currScreenPos.set(e.x, e.y);\r\n                this._wheelDirection = Math.sign(e.wheelDelta);\r\n                return;\r\n            }\r\n\r\n            //let dd = this.targetPoint!.distance(this.planet.camera.eye);\r\n            // let brk = 1;\r\n            // if (this._wheelDirection > 0 && dd < 5000) {\r\n            //this.vel.scale(0.3);\r\n            //     brk = dist / 5000;\r\n            // }\r\n\r\n            this._currScreenPos.set(e.x, e.y);\r\n            this._wheelDirection = Math.sign(e.wheelDelta);\r\n            let scale = 2;\r\n            this._isTouchPad = e.isTouchPad;\r\n            if (e.isTouchPad) {\r\n                this._velInertia = 0.88;\r\n                scale = 0.8;\r\n            } else {\r\n                this._velInertia = DEFAULT_VELINERTIA;\r\n            }\r\n\r\n            let cam = this.planet.camera;\r\n            let spdAlt = Math.abs(cam.getAltitude() < 20 ? 20 : cam.getAltitude());\r\n            let dist = Math.min(spdAlt, this.planet.camera.eye.distance(this._targetZoomPoint)) * scale;\r\n            this.force = (e.direction.scale(Math.sign(this._wheelDirection))).normalize().scale(dist);\r\n\r\n            this.force_roll = this._curRoll;\r\n        }\r\n    }\r\n\r\n    protected _onLDown = (e: IMouseState) => {\r\n\r\n        this.stop();\r\n\r\n        this._targetRotationPoint = null\r\n        this._targetZoomPoint = null;\r\n\r\n        if (!this.planet) return;\r\n\r\n        this.planet.stopFlying();\r\n\r\n        this._grabbedPoint = this._getTargetPoint(e.pos);\r\n\r\n        if (!this._grabbedPoint) return;\r\n\r\n        this.renderer!.handler.canvas!.classList.add(\"ogGrabbingPoiner\");\r\n\r\n        this._grabbedSphere.radius = this._grabbedPoint.length();\r\n\r\n        this._eye0 = this.planet.camera.eye.clone();\r\n        this._grabbedCameraHeight = this._eye0.length();\r\n\r\n        this._curPitch = this.planet.camera.getPitch();\r\n        this._curYaw = this.planet.camera.getYaw();\r\n        this._curRoll = this.planet.camera.getRoll();\r\n\r\n        this._currScreenPos.copy(e.pos);\r\n\r\n        if (this.planet!.camera.getUp().dot(new Vec3(0, 0, 1)) > 0.3) {\r\n            this.fixedUp = true;\r\n        }\r\n    }\r\n\r\n    protected _onLHold = (e: IMouseState) => {\r\n        if (this._grabbedPoint && this.planet) {\r\n            let cam = this.planet.camera;\r\n\r\n            if (cam.slope > MIN_SLOPE) {\r\n                let _targetDragPoint = new Ray(cam.eye, e.direction).hitSphere(this._grabbedSphere);\r\n\r\n                if (!_targetDragPoint) {\r\n                    return;\r\n                }\r\n\r\n                this._targetDragPoint = _targetDragPoint;\r\n\r\n                let newEye = new Vec3();\r\n\r\n                let rot = Quat.getRotationBetweenVectors(\r\n                    this._targetDragPoint.getNormal(),\r\n                    this._grabbedPoint.getNormal()\r\n                );\r\n\r\n                newEye.copy(rot.mulVec3(cam.eye));\r\n                this.force = newEye.sub(cam.eye).scale(70);\r\n            } else {\r\n                let p0 = this._grabbedPoint,\r\n                    p1 = Vec3.add(p0, cam.getRight()),\r\n                    p2 = Vec3.add(p0, p0.getNormal());\r\n\r\n                let px = new Vec3();\r\n                new Ray(cam.eye, e.direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px);\r\n                let newEye = cam.eye.add(px.subA(p0).negate());\r\n                this.force = newEye.sub(cam.eye).scale(70);\r\n                this._targetDragPoint = px;\r\n            }\r\n\r\n            this.vel.set(0.0, 0.0, 0.0);\r\n\r\n            if (!this._currScreenPos.equal(e.pos)) {\r\n                this._screenPosIsChanged = true;\r\n                this._currScreenPos.copy(e.pos);\r\n            }\r\n\r\n            this._hold = true;\r\n        }\r\n    }\r\n\r\n    protected _onLUp = (e: IMouseState) => {\r\n        this._hold = false;\r\n        this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n    }\r\n\r\n    protected _handleDrag() {\r\n        if (this.planet && this._targetDragPoint && this._grabbedPoint && this.vel.length() > 0.0) {\r\n            this._velInertia = DEFAULT_VELINERTIA;\r\n            let cam = this.planet!.camera;\r\n\r\n            if (Math.abs(cam.eyeNorm.dot(Vec3.NORTH)) > 0.9) {\r\n                this.fixedUp = false;\r\n            }\r\n\r\n            if (!this._screenPosIsChanged) {\r\n                if (this.vel.length() > this._prevVel.length()) {\r\n                    this.fixedUp = false;\r\n                }\r\n            }\r\n            this._screenPosIsChanged = false;\r\n            this._prevVel.copy(this.vel);\r\n\r\n            if (cam.slope > MIN_SLOPE) {\r\n                let d_v = this.vel.scaleTo(this.dt);\r\n                // let d_s = d_v;\r\n                // let newEye = cam.eye.add(d_s).normalize().scale(this._grabbedCameraHeight);\r\n                let d_s = Vec3.proj_b_to_plane(d_v, cam.eyeNorm);\r\n                let newEye = cam.eye.add(d_s).normalize().scale(this._grabbedCameraHeight);\r\n                if (this.fixedUp) {\r\n                    cam.eye.copy(newEye);\r\n                    this._corrRoll();\r\n                    cam.setPitchYawRoll(this._curPitch, this._curYaw, this._curRoll);\r\n                } else {\r\n                    let rot = Quat.getRotationBetweenVectors(cam.eye.getNormal(), newEye.getNormal());\r\n                    cam.rotate(rot);\r\n                    cam.eye.copy(newEye);\r\n                }\r\n            } else {\r\n                let d_v = this.vel.scaleTo(this.dt);\r\n                let newEye = cam.eye.add(d_v);\r\n                cam.eye.copy(newEye);\r\n                cam.checkTerrainCollision();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _corrRoll() {\r\n        if (this.planet!.camera.slope < 0.5) {\r\n            this._curRoll -= this.vel_roll * this.dt;\r\n            if (this._curRoll < 0.01 * Math.PI / 180) {\r\n                this._curRoll = 0.01 * Math.PI / 180;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _handleZoom() {\r\n        if (this._targetZoomPoint && this.vel.length() > 0.0) {\r\n\r\n            // Common\r\n            let cam = this.planet!.camera;\r\n            let a = this._targetZoomPoint;\r\n            let dir = a.sub(cam.eye).normalize();\r\n            let eye = cam.eye.clone();\r\n\r\n            let velDir = Math.sign(this.vel.getNormal().dot(cam.getForward()));\r\n            let d_v = this.vel.scaleTo(this.dt);\r\n            //let d_s = d_v.projToVec(cam.getForward().scale(velDir));\r\n\r\n            // if camera eye position under the dome of the grabbed sphere\r\n            if (this._grabbedSphere.radius > eye.length()) {\r\n                velDir *= -1;\r\n            }\r\n\r\n            let d_s = cam.getForward().scaleTo(velDir * d_v.length());\r\n\r\n            // Slow down if camera moves very fast tweak\r\n            let destDist = cam.eye.distance(a);\r\n            if (destDist < 30 * d_s.length()) {\r\n                let temp = d_s.length();\r\n                d_s.normalize().scale(temp * 0.5);\r\n                this.vel.scale(0.5);\r\n            }\r\n\r\n            eye.addA(d_s);\r\n\r\n            // Check max camera distance\r\n            let maxAlt = cam.maxAltitude + this.planet!.ellipsoid.getEquatorialSize();\r\n            if (eye.length() > maxAlt) {\r\n                eye.copy(eye.getNormal().scale(maxAlt));\r\n                return;\r\n            }\r\n\r\n            let b = new Ray(eye, dir).hitSphere(this._grabbedSphere);\r\n\r\n            if (!b) {\r\n                this.vel.set(0, 0, 0);\r\n                return;\r\n            }\r\n\r\n            let rot = Quat.getRotationBetweenVectors(b.getNormal(), a.getNormal());\r\n            cam.eye = rot.mulVec3(eye);\r\n            cam.rotate(rot);\r\n\r\n            if (this.fixedUp && destDist > 10) {\r\n\r\n                this._corrRoll();\r\n                // restore camera direction\r\n                cam.setPitchYawRoll(this._curPitch, this._curYaw, this._curRoll);\r\n\r\n                cam.update();\r\n                let dirCurr = cam.unproject2v(this._currScreenPos);\r\n                let dirNew = a.sub(cam.eye).normalize();\r\n\r\n                let px0 = new Vec3();\r\n                let px1 = new Vec3();\r\n                let pl = Plane.fromPoints(a, a.add(cam.getUp()), a.add(cam.getRight()));\r\n\r\n                new Ray(cam.eye, dirCurr).hitPlaneRes(pl, px0);\r\n                new Ray(cam.eye, dirNew).hitPlaneRes(pl, px1);\r\n\r\n                let dp = px1.sub(px0);\r\n                cam.eye = cam.eye.add(dp);\r\n\r\n                // ver.2\r\n                // let px0 = new Ray(cam.eye, dirCurr).hitSphere(this._grabbedSphere)!;\r\n                // let px1 = new Ray(cam.eye, dirNew).hitSphere(this._grabbedSphere)!;\r\n            }\r\n\r\n            cam.checkTerrainCollision();\r\n        }\r\n    }\r\n\r\n    protected _updateVel() {\r\n        let acc = this.force.scale(1.0 / this.mass);\r\n        this.vel.addA(acc);\r\n        this.vel.scale(this._velInertia);\r\n        if (this.vel.length() < 0.001) {\r\n            this.vel.set(0, 0, 0);\r\n        }\r\n        this.force.set(0, 0, 0);\r\n\r\n        this._updateVel_h();\r\n        this._updateVel_v();\r\n        this._updateVel_roll();\r\n    }\r\n\r\n    protected _updateVel_h() {\r\n        let acc = this.force_h / this.mass;\r\n        this.vel_h += acc;\r\n        this.vel_h *= this._velInertia;\r\n        this.force_h = 0;\r\n    }\r\n\r\n    protected _updateVel_v() {\r\n        let acc = this.force_v / this.mass;\r\n        this.vel_v += acc;\r\n        this.vel_v *= this._velInertia;\r\n        this.force_v = 0;\r\n    }\r\n\r\n    protected _updateVel_roll() {\r\n        let acc = this.force_roll / this.mass;\r\n        this.vel_roll += acc;\r\n        this.vel_roll *= this._velInertia;\r\n        this.force_roll = 0;\r\n    }\r\n\r\n    protected get dt(): number {\r\n        return 0.001 * this.renderer!.handler.deltaTime;\r\n    }\r\n\r\n    public stop() {\r\n        this.vel.set(0, 0, 0);\r\n        this.vel_h = 0;\r\n        this.vel_v = 0;\r\n        this._velInertia = DEFAULT_VELINERTIA;\r\n        this._targetZoomPoint = null;\r\n        this._grabbedPoint = null;\r\n        this._targetRotationPoint = null;\r\n        this._targetDragPoint = null;\r\n    }\r\n}\r\n","import {Entity} from '../../entity/Entity';\r\nimport {createEvents} from '../../Events';\r\nimport type {EventsHandler} from '../../Events';\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {Object3d} from '../../Object3d';\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {RenderNode} from '../../scene/RenderNode';\r\nimport {Vector} from '../../layer/Vector';\r\nimport {Vec2} from '../../math/Vec2';\r\nimport {Vec3} from '../../math/Vec3';\r\nimport type {IMouseState} from \"../../renderer/RendererEvents\";\r\nimport {Ellipsoid} from \"../../ellipsoid/Ellipsoid\";\r\nimport type {ILabelParams} from \"../../entity/Label\";\r\n\r\nconst OUTLINE_COUNT = 120;\r\n\r\nexport interface IRulerSceneParams {\r\n    name?: string;\r\n    ignoreTerrain?: boolean;\r\n    planet?: Planet;\r\n}\r\n\r\nexport const distanceFormat = (v: number): string => {\r\n    if (v > 1000) {\r\n        return `${(v / 1000).toFixed(1)} km`;\r\n    } else if (v > 9) {\r\n        return `${Math.round(v)} m`;\r\n    } else {\r\n        return `${v.toFixed(1)} m`;\r\n    }\r\n}\r\n\r\nlet obj3d = Object3d.createCylinder(1.1, 0, 2.7, 20, 1, true, false, 0, 0, 0);\r\n\r\nconst LABEL_OPTIONS: ILabelParams = {\r\n    text: \"\",\r\n    size: 11,\r\n    color: \"rgba(455,455,455,1.0)\",\r\n    outlineColor: \"rgba(0,0,0,0.34)\",\r\n    outline: 0.23,\r\n    align: \"center\",\r\n    offset: [0, 20, 0]\r\n};\r\nconst RULER_CORNER_OPTIONS = {\r\n    scale: 1,\r\n    instanced: true,\r\n    tag: \"ruler\",\r\n    color: \"rgb(0,305,0)\",\r\n    object3d: obj3d\r\n};\r\n\r\ntype RulerSceneEventsList = [\r\n    \"add\",\r\n    \"remove\",\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\"\r\n];\r\n\r\nclass RulerScene extends RenderNode {\r\n    public events: EventsHandler<RulerSceneEventsList>;\r\n    protected _ignoreTerrain: boolean;\r\n    protected _planet: Planet | null;\r\n    protected _startLonLat: LonLat | null;\r\n    protected _preventClick: boolean;\r\n    protected _stopDrawing: boolean;\r\n    protected _pickedCorner: Entity | null;\r\n    protected _startPos: Vec2 | null;\r\n    protected _startClick: Vec2;\r\n    protected _heading: number;\r\n    protected _trackLayer: Vector;\r\n    protected _labelLayer: Vector;\r\n    protected _cornersLayer: Vector;\r\n    protected _cornerEntity: Entity[];\r\n    protected _propsLabel: Entity;\r\n    protected _trackEntity: Entity;\r\n    protected _anchorLonLat: LonLat | null;\r\n    protected _timeout: any;\r\n\r\n    constructor(options: IRulerSceneParams = {}) {\r\n        super(options.name);\r\n\r\n        this.events = createEvents(RULERSCENE_EVENTS);\r\n\r\n        this._ignoreTerrain = options.ignoreTerrain != undefined ? options.ignoreTerrain : true;\r\n\r\n        this._planet = options.planet || null;\r\n\r\n        this._startLonLat = null;\r\n        this._preventClick = false;\r\n        this._stopDrawing = false;\r\n\r\n        this._pickedCorner = null;\r\n        this._startPos = null;\r\n        this._startClick = new Vec2();\r\n\r\n        this._anchorLonLat = null;\r\n\r\n        this._heading = 0;\r\n\r\n        this._trackLayer = new Vector(\"track\", {\r\n            entities: [],\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -1.0,\r\n            relativeToGround: true,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._labelLayer = new Vector(\"ruler-label\", {\r\n            entities: [],\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -100.0,\r\n            relativeToGround: true,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._cornersLayer = new Vector(\"corners\", {\r\n            entities: [],\r\n            pickingEnabled: true,\r\n            hideInLayerSwitcher: true,\r\n            scaleByDistance: [100, 4000000, 1.0],\r\n            pickingScale: 2\r\n        });\r\n\r\n        this._propsLabel = new Entity({\r\n            name: 'propsLabel',\r\n            label: LABEL_OPTIONS\r\n        });\r\n\r\n        this._trackEntity = new Entity({\r\n            polyline: {\r\n                path3v: [],\r\n                thickness: 4.8,\r\n                color: \"rgb(255,131,0)\",\r\n                isClosed: false\r\n            }\r\n        });\r\n\r\n        this._trackEntity.polyline!.altitude = 0.01;\r\n\r\n        this._cornerEntity = [\r\n            new Entity({\r\n                geoObject: RULER_CORNER_OPTIONS,\r\n                properties: {\r\n                    name: \"start\"\r\n                }\r\n            }),\r\n            new Entity({\r\n                geoObject: RULER_CORNER_OPTIONS,\r\n                properties: {\r\n                    name: \"end\"\r\n                }\r\n            })\r\n        ];\r\n    }\r\n\r\n    public set ignoreTerrain(v: boolean) {\r\n        this._ignoreTerrain = v;\r\n        if (v) {\r\n            //...redraw line\r\n        }\r\n    }\r\n\r\n    public bindPlanet(planet: Planet) {\r\n        this._planet = planet;\r\n    }\r\n\r\n    protected _createCorners() {\r\n        this._cornersLayer.addEntities(this._cornerEntity)\r\n    }\r\n\r\n    public override init() {\r\n        this._createCorners();\r\n        this._trackLayer.addEntities([this._trackEntity]);\r\n        this._labelLayer.addEntities([this._propsLabel]);\r\n        this._planet!.addLayer(this._labelLayer);\r\n        this._planet!.addLayer(this._trackLayer);\r\n        this._planet!.addLayer(this._cornersLayer);\r\n        this._activate();\r\n    }\r\n\r\n    public override onremove() {\r\n        this._deactivate();\r\n    }\r\n\r\n    public _activate() {\r\n\r\n        this._propsLabel.label!.setVisibility(false);\r\n        this.setVisibility(false);\r\n\r\n        this.renderer!.events.on(\"lclick\", this._onLclick, this);\r\n        this.renderer!.events.on(\"mousemove\", this._onMouseMove, this);\r\n        this.renderer!.events.on(\"ldblclick\", this._onLdblclick, this);\r\n        this.renderer!.events.on(\"lup\", this._onLUp, this);\r\n\r\n        this._cornersLayer.events.on(\"mouseenter\", this._onCornerEnter, this);\r\n        this._cornersLayer.events.on(\"mouseleave\", this._onCornerLeave, this);\r\n        this._cornersLayer.events.on(\"ldown\", this._onCornerLdown, this);\r\n        this._cornersLayer.events.on(\"lup\", this._onCornerLup, this);\r\n\r\n    }\r\n\r\n    protected _deactivate() {\r\n        this._startLonLat = null;\r\n        this._preventClick = false;\r\n        this._stopDrawing = false;\r\n        this._pickedCorner = null;\r\n        // this._trackLayer.remove();\r\n        // this._cornersLayer.remove();\r\n\r\n        this.renderer!.events.off(\"lclick\", this._onLclick);\r\n        this.renderer!.events.off(\"mousemove\", this._onMouseMove);\r\n        this.renderer!.events.off(\"lup\", this._onLUp);\r\n\r\n        this._cornersLayer.events.off(\"mouseenter\", this._onCornerEnter);\r\n        this._cornersLayer.events.off(\"mouseleave\", this._onCornerLeave);\r\n        this._cornersLayer.events.off(\"ldown\", this._onCornerLdown);\r\n        this._cornersLayer.events.off(\"lup\", this._onCornerLup);\r\n\r\n        this.clear();\r\n    }\r\n\r\n    protected _onCornerLdown = (e: IMouseState) => {\r\n        if (!this._startLonLat) {\r\n            this.renderer?.controls.mouseNavigation?.deactivate();\r\n            this._startClick.set(e.x, e.y);\r\n            let coords = e.pickingObject.getCartesian();\r\n            this._startPos = this._planet!.getPixelFromCartesian(coords);\r\n            this._pickedCorner = e.pickingObject;\r\n            if (e.pickingObject.properties.name == \"start\") {\r\n                this._anchorLonLat = this._cornerEntity[1].getLonLat().clone();\r\n            } else {\r\n                this._anchorLonLat = this._cornerEntity[0].getLonLat().clone();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onLUp = () => {\r\n        if (this._pickedCorner) {\r\n            this.renderer!.controls.mouseNavigation?.activate();\r\n            this._pickedCorner = null;\r\n            this._anchorLonLat = null;\r\n        }\r\n    }\r\n\r\n    protected _onCornerLup = () => {\r\n        this._onLUp();\r\n    }\r\n\r\n    protected _onCornerEnter = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"pointer\";\r\n    }\r\n\r\n    protected _onCornerLeave = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"default\";\r\n    }\r\n\r\n    protected _onLdblclick = () => {\r\n        this._preventClick = true;\r\n    }\r\n\r\n    public setVisibility(visibility: boolean) {\r\n        this._cornersLayer.setVisibility(visibility);\r\n        this._trackLayer.setVisibility(visibility);\r\n        this._labelLayer.setVisibility(visibility);\r\n    }\r\n\r\n    protected _onLclick = (e: IMouseState) => {\r\n        let startLonLat = this._planet!.getLonLatFromPixelTerrain(e.pos);\r\n        if (!startLonLat) return;\r\n        this._timeout = setTimeout(() => {\r\n            if (!this._preventClick) {\r\n                if (!this._startLonLat) {\r\n                    this.setVisibility(true);\r\n                    this._stopDrawing = false;\r\n                    this._startLonLat = startLonLat!;\r\n                } else {\r\n                    this._startLonLat = null;\r\n                }\r\n            }\r\n            this._preventClick = false;\r\n            this._stopDrawing = false;\r\n            clearTimeout(this._timeout);\r\n        }, 200);\r\n\r\n        if (this._startLonLat) {\r\n            this._stopDrawing = true;\r\n        }\r\n    }\r\n\r\n    protected _drawLine(startLonLat: LonLat, endLonLat: LonLat, startPos?: Vec3) {\r\n\r\n        if (!startPos) {\r\n            startPos = this._planet!.ellipsoid.lonLatToCartesian(startLonLat);\r\n        }\r\n\r\n        let endPos = this._planet!.ellipsoid.lonLatToCartesian(endLonLat);\r\n\r\n        let res = this._planet!.ellipsoid.inverse(startLonLat, endLonLat);\r\n        let length = res.distance;\r\n        this._heading = res.initialAzimuth;\r\n\r\n        let path = [];\r\n        let dir = endPos.sub(startPos);\r\n        let dist = dir.length();\r\n        dir.normalize();\r\n\r\n        for (let i = 0; i < OUTLINE_COUNT; i++) {\r\n            let f = dir.scaleTo(i * dist / OUTLINE_COUNT).addA(startPos);\r\n            path.push(f);\r\n        }\r\n        path.push(endPos);\r\n\r\n        this._trackEntity.polyline!.setPath3v([path]);\r\n\r\n        if (this._ignoreTerrain) {\r\n            this._propsLabel.setCartesian3v(path[Math.floor(path.length / 2)]);\r\n            this._propsLabel.label!.setText(`${distanceFormat(length)}, ${Math.round(this._heading)} deg`);\r\n        }\r\n    }\r\n\r\n    protected _onMouseMove = (e: IMouseState) => {\r\n        if (this._startLonLat && !this._stopDrawing) {\r\n            this._propsLabel.label!.setVisibility(true);\r\n            let endLonLat = this._planet!.getLonLatFromPixelTerrain(e.pos);\r\n            if (!endLonLat) return;\r\n            this._drawLine(this._startLonLat, endLonLat);\r\n        } else if (this._pickedCorner) {\r\n            let newLonLat = this._planet!.getLonLatFromPixelTerrain(e.pos);\r\n            if (newLonLat) {\r\n                if (this._pickedCorner.properties.name === \"start\") {\r\n                    this._drawLine(newLonLat, this._anchorLonLat!);\r\n                } else {\r\n                    this._drawLine(this._anchorLonLat!, newLonLat);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        this._trackEntity.remove();\r\n        this._cornerEntity[0].remove();\r\n        this._cornerEntity[1].remove();\r\n        this._propsLabel.remove();\r\n        this._planet!.removeLayer(this._trackLayer);\r\n        this._planet!.removeLayer(this._cornersLayer);\r\n    }\r\n\r\n    public isCornersPositionChanged(): boolean {\r\n        let t = this._trackEntity.polyline!.getPath3v()[0] as Vec3[];\r\n        if (t) {\r\n            const startPos = t[0].clone(),\r\n                endPos = t[t.length - 1].clone();\r\n            return this._cornerEntity[0].getCartesian().equal(startPos) &&\r\n                this._cornerEntity[1].getCartesian().equal(endPos)\r\n        }\r\n        return false\r\n    }\r\n\r\n    public override frame() {\r\n        let t = this._trackEntity.polyline!.getPath3v()[0] as Vec3[];\r\n        if (t) {\r\n            const startPos = t[0].clone(),\r\n                endPos = t[t.length - 1].clone();\r\n\r\n            if (!this.isCornersPositionChanged()) {\r\n                this._cornerEntity[0].setCartesian3v(startPos);\r\n                this._cornerEntity[1].setCartesian3v(endPos);\r\n                if (!this._ignoreTerrain) {\r\n                    let res = 0;\r\n                    for (let i = 0, len = t.length - 1; i < len; i++) {\r\n                        res += t[i + 1].distance(t[i]);\r\n                    }\r\n                    this._propsLabel.setCartesian3v(t[Math.floor(t.length / 2)]);\r\n                    this._propsLabel.label!.setText(`${distanceFormat(res)}, ${Math.round(this._heading)} deg`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public get ellipsoid(): Ellipsoid | null {\r\n        return this._planet ? this._planet.ellipsoid : null;\r\n    }\r\n}\r\n\r\nconst RULERSCENE_EVENTS: RulerSceneEventsList = [\r\n    \"add\",\r\n    \"remove\",\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\"\r\n];\r\n\r\nexport {RulerScene};\r\n","import {Control} from \"../Control\";\r\nimport type {IControlParams} from \"../Control\";\r\nimport {RulerScene} from \"./RulerScene\";\r\n\r\nexport interface IRulerParams extends IControlParams {\r\n    ignoreTerrain?: boolean\r\n}\r\n\r\nexport class Ruler extends Control {\r\n    protected _rulerScene: RulerScene;\r\n\r\n    constructor(options: IRulerParams = {}) {\r\n        super(options);\r\n\r\n        this._rulerScene = new RulerScene({\r\n            name: `rulerScene:${this.__id}`,\r\n            ignoreTerrain: options.ignoreTerrain\r\n        });\r\n    }\r\n\r\n    public set ignoreTerrain(v: boolean) {\r\n        this._rulerScene.ignoreTerrain = v;\r\n    }\r\n\r\n    public override oninit() {\r\n        this._rulerScene.bindPlanet(this.planet!);\r\n    }\r\n\r\n    public override onactivate() {\r\n        this.renderer && this.renderer.addNode(this._rulerScene);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        this.renderer && this.renderer.removeNode(this._rulerScene);\r\n    }\r\n}\r\n","import {Entity} from '../../entity/Entity';\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {Object3d} from \"../../Object3d\";\r\nimport {RulerScene, type IRulerSceneParams} from \"../ruler/RulerScene\";\r\nimport {Vector} from \"../../layer/Vector\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport type {ILabelParams} from \"../../entity/Label\";\r\nimport type {IRayParams} from \"../../entity/Ray\";\r\n\r\nlet obj3d = Object3d.createCylinder(1.1, 0, 2, 6, 1, true, true, 0, 0, 0);\r\n\r\nconst RAYS_OPTIONS: IRayParams = {\r\n    startColor: \"rgb(255,131,0)\",\r\n    endColor: \"rgb(255,131,0)\",\r\n    thickness: 5\r\n}\r\nconst LABEL_OPTIONS: ILabelParams = {\r\n    text: \"\",\r\n    size: 11,\r\n    color: \"rgba(455,455,455,1.0)\",\r\n    outlineColor: \"rgba(0,0,0,0.34)\",\r\n    outline: 0.23,\r\n    align: \"center\",\r\n    offset: [0, 18, 0]\r\n};\r\n\r\nconst RULER_CORNER_OPTIONS = {\r\n    scale: 1,\r\n    instanced: true,\r\n    tag: \"height-ruler\",\r\n    color: \"rgb(255,131,0)\",\r\n    object3d: obj3d\r\n};\r\n\r\ninterface IHeightRulerSceneParams extends IRulerSceneParams {\r\n\r\n}\r\n\r\nclass HeightRulerScene extends RulerScene {\r\n    protected _geoRulerLayer: Vector;\r\n    protected _heightLabels: Entity[];\r\n    protected _rayH: Entity;\r\n    protected _rayV: Entity;\r\n\r\n    constructor(options: IHeightRulerSceneParams = {}) {\r\n        super(options);\r\n\r\n        this._geoRulerLayer = new Vector(\"rayHeightRuler\", {\r\n            entities: [],\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -2.0,\r\n            relativeToGround: false,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._rayV = new Entity({\r\n            name: 'verticalRay',\r\n            ray: RAYS_OPTIONS\r\n        });\r\n\r\n        this._rayH = new Entity({\r\n            name: 'heightRay',\r\n            ray: RAYS_OPTIONS\r\n        });\r\n\r\n        this._heightLabels = [\r\n            new Entity({\r\n                name: 'startCornerLabel',\r\n                label: {\r\n                    ...LABEL_OPTIONS\r\n                }\r\n            }),\r\n            new Entity({\r\n                name: 'endCornerLabel',\r\n                label: {\r\n                    ...LABEL_OPTIONS\r\n                }\r\n            }),\r\n            new Entity({\r\n                name: 'deltaLabel',\r\n                label: {\r\n                    ...LABEL_OPTIONS\r\n                }\r\n            })\r\n        ];\r\n    }\r\n\r\n    public override setVisibility(visibility: boolean) {\r\n        super.setVisibility(visibility);\r\n        this._geoRulerLayer.setVisibility(visibility);\r\n    }\r\n\r\n    public get deltaLabel(): Entity {\r\n        return this._heightLabels[2];\r\n    }\r\n\r\n    public get startLabel(): Entity {\r\n        return this._heightLabels[0]\r\n    }\r\n\r\n    public get endLabel(): Entity {\r\n        return this._heightLabels[1]\r\n    }\r\n\r\n    public get corners(): Entity[] {\r\n        return this._cornerEntity;\r\n    }\r\n\r\n    public get startCorner(): Entity {\r\n        return this.corners[0];\r\n    }\r\n\r\n    public get endCorner(): Entity {\r\n        return this.corners[1];\r\n    }\r\n\r\n    public get startCornerLonLat(): LonLat {\r\n        return this.startCorner.getLonLat();\r\n    }\r\n\r\n    public get startCornerHeight(): number {\r\n        return this.startCornerLonLat.height;\r\n    }\r\n\r\n    public get endCornerLonLat(): LonLat {\r\n        return this.endCorner.getLonLat();\r\n    }\r\n\r\n    public get endCornerHeight(): number {\r\n        return this.endCornerLonLat.height;\r\n    }\r\n\r\n    public get maxHeightCornerLonLat(): LonLat {\r\n        if (this.startCornerHeight <= this.endCornerHeight) {\r\n            return this.endCornerLonLat;\r\n        } else {\r\n            return this.startCornerLonLat;\r\n        }\r\n    }\r\n\r\n    public get minHeightCornerLonLat(): LonLat {\r\n        if (this.startCornerHeight > this.endCornerHeight) {\r\n            return this.endCornerLonLat;\r\n        } else {\r\n            return this.startCornerLonLat;\r\n        }\r\n    }\r\n\r\n    public get deltaHeight(): number {\r\n        return Math.abs(this.startCornerHeight - this.endCornerHeight);\r\n    }\r\n\r\n    public override _drawLine(startLonLat: LonLat, endLonLat: LonLat, startPos?: Vec3) {\r\n        super._drawLine(startLonLat, endLonLat, startPos);\r\n        this._updateHeightRaysAndLabels();\r\n    }\r\n\r\n    protected async _updateHeightRaysAndLabels() {\r\n        const middleLonLat = this.minHeightCornerLonLat.clone();\r\n        middleLonLat.height = this.maxHeightCornerLonLat.height;\r\n\r\n        this._rayH.ray!.setStartPosition3v(this._planet!.ellipsoid.lonLatToCartesian(this.maxHeightCornerLonLat))\r\n        this._rayH.ray!.setEndPosition3v(this._planet!.ellipsoid.lonLatToCartesian(middleLonLat))\r\n        this._rayV.ray!.setStartPosition3v(this._planet!.ellipsoid.lonLatToCartesian(this.minHeightCornerLonLat));\r\n        this._rayV.ray!.setEndPosition3v(this._planet!.ellipsoid.lonLatToCartesian(middleLonLat));\r\n\r\n        middleLonLat.height = this.minHeightCornerLonLat.height + this.deltaHeight / 2;\r\n\r\n        this.deltaLabel.setLonLat(middleLonLat);\r\n        this.startLabel.setLonLat(this.startCornerLonLat);\r\n        this.endLabel.setLonLat(this.endCornerLonLat);\r\n\r\n        const startHeight = await this._planet!.getHeightDefault(this.startCornerLonLat),\r\n            endHeight = await this._planet!.getHeightDefault(this.endCornerLonLat)\r\n\r\n        this.deltaLabel.label!.setText(`\\u0394 ${Math.abs(startHeight - endHeight).toFixed(1)} m`);\r\n        this.startLabel.label!.setText(`P1 ${startHeight.toFixed(1)} m`)\r\n        this.endLabel.label!.setText(`P2 ${endHeight.toFixed(1)} m`)\r\n    }\r\n\r\n    public override clear() {\r\n        this._rayH.remove();\r\n        this._rayV.remove();\r\n        this.startCorner.remove();\r\n        this.endCorner.remove();\r\n        this.startLabel.remove();\r\n        this.endLabel.remove();\r\n        this.deltaLabel.remove();\r\n        super.clear();\r\n\r\n        // this._rayH = null;\r\n        // this._rayV = null;\r\n\r\n        this._planet!.removeLayer(this._geoRulerLayer);\r\n    }\r\n\r\n    public override _createCorners() {\r\n        this._cornerEntity = [\r\n            new Entity({\r\n                geoObject: RULER_CORNER_OPTIONS,\r\n                properties: {\r\n                    name: \"start\"\r\n                }\r\n            }),\r\n            new Entity({\r\n                geoObject: RULER_CORNER_OPTIONS,\r\n                properties: {\r\n                    name: \"end\"\r\n                }\r\n            })\r\n        ];\r\n\r\n        this._cornersLayer.setEntities(this._cornerEntity);\r\n    }\r\n\r\n    public override init() {\r\n        super.init();\r\n        this._createCorners();\r\n\r\n        this._labelLayer.addEntities(this._heightLabels);\r\n        this._geoRulerLayer.addEntities([this._rayH, this._rayV]);\r\n\r\n        this._planet!.addLayer(this._geoRulerLayer);\r\n    }\r\n\r\n    public override frame() {\r\n        super.frame()\r\n        this._updateHeightRaysAndLabels();\r\n    }\r\n}\r\n\r\n\r\nexport {HeightRulerScene};\r\n","import {Ruler, type IRulerParams} from \"../ruler/Ruler\";\r\nimport {HeightRulerScene} from \"./HeightRulerScene\";\r\n\r\ninterface IHeightRulerParams extends IRulerParams {\r\n\r\n}\r\n\r\nexport class HeightRuler extends Ruler {\r\n    constructor(options: IHeightRulerParams = {}) {\r\n        super(options);\r\n        this._rulerScene = new HeightRulerScene({\r\n            name: `heightRulerScene:${this.__id}`,\r\n            ignoreTerrain: false\r\n        });\r\n    }\r\n}","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {ToggleButton} from \"../ui/ToggleButton\";\r\nimport {HeightRuler} from \"./heightRuler/HeightRuler\";\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\r\n<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\r\n<svg fill=\"#000000\" height=\"800px\" width=\"800px\" version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \r\n\\t viewBox=\"0 0 512 512\" xml:space=\"preserve\">\r\n<g>\r\n\\t<g>\r\n\\t\\t<path d=\"M369.151,0L0.001,369.15L142.85,512l369.149-369.15L369.151,0z M47.286,369.15l10.908-10.908l47.782,47.782l23.642-23.642\r\n\\t\\t\\tL81.837,334.6l10.909-10.909l23.711,23.711L140.1,323.76l-23.711-23.711l10.909-10.909l23.711,23.711l23.642-23.642\r\n\\t\\t\\tl-23.711-23.711l10.909-10.909l47.782,47.782l23.642-23.642l-47.782-47.782l10.908-10.908l23.71,23.71l23.642-23.642l-23.71-23.71\r\n\\t\\t\\tl10.908-10.908l23.711,23.711l23.642-23.642l-23.711-23.711l10.909-10.909l47.782,47.782l23.642-23.642l-47.782-47.782\r\n\\t\\t\\tl10.908-10.908l23.71,23.711l23.642-23.642l-23.711-23.71L334.6,81.837l23.711,23.71l23.642-23.642l-23.711-23.712l10.908-10.908\r\n\\t\\t\\tl95.564,95.564L142.85,464.714L47.286,369.15z\"/>\r\n\\t</g>\r\n</g>\r\n</svg>`;\r\n\r\ninterface IRulerSwitcherParams extends IControlParams {\r\n    ignoreTerrain?: boolean;\r\n}\r\n\r\n/**\r\n * Activate ruler\r\n */\r\nexport class RulerSwitcher extends Control {\r\n    ruler: HeightRuler;\r\n\r\n    constructor(options: IRulerSwitcherParams = {}) {\r\n        super({\r\n            name: \"RulerSwitcher\",\r\n            ...options\r\n        });\r\n\r\n        this.ruler = new HeightRuler({\r\n            ignoreTerrain: options.ignoreTerrain\r\n        });\r\n    }\r\n\r\n    public override oninit() {\r\n        this.planet!.addControl(this.ruler);\r\n        this._createMenuBtn();\r\n    }\r\n\r\n    public override onactivate() {\r\n        this.ruler.activate();\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        this.ruler.deactivate();\r\n    }\r\n\r\n    protected _createMenuBtn() {\r\n\r\n        let btn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-ruler_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        btn.appendTo(this.renderer!.div!);\r\n\r\n        btn.events.on(\"change\", (isActive: boolean) => {\r\n            if (isActive) {\r\n                this.onactivate();\r\n            } else {\r\n                this.ondeactivate();\r\n            }\r\n        });\r\n    }\r\n}\r\n","import {binarySearch, parseHTML} from \"../utils/shared\";\r\nimport {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {RADIANS} from \"../math\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {GlobusTerrain} from \"../terrain/GlobusTerrain\";\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\n\r\ninterface IScaleControlParams extends IControlParams {\r\n    isCenter?: boolean\r\n}\r\n\r\nconst scale: number[] = [\r\n    0.001, 0.005, 0.01, 0.05, 0.1, 0.2, 0.5, 1, 2, 3, 5, 10, 20, 30, 50, 100, 200, 300, 500, 1e3, 2e3, 3e3, 5e3, 10e3, 20e3, 30e3, 50e3,\r\n    100e3, 200e3, 300e3, 500e3, 1000e3, 2000e3, 3000e3, 5000e3, 10000e3\r\n];\r\n\r\nconst TEMPLATE = `<div class=\"og-scale-container\">\r\n      <div class=\"og-scale-label\"></div>\r\n      <div class=\"og-scale-ruler\"></div>\r\n    </div>`;\r\n\r\n/**\r\n * Planet zoom buttons control.\r\n */\r\nexport class ScaleControl extends Control {\r\n\r\n    public el: HTMLElement | null;\r\n    protected _template: string;\r\n    protected _minWidth: number;\r\n    protected _maxWidth: number;\r\n    protected _isCenter: boolean;\r\n    protected _scaleLabelEl: HTMLElement | null;\r\n    protected _mPx: number;\r\n    protected currWidth: number;\r\n    protected _metersInMinSize: number;\r\n\r\n    constructor(options: IScaleControlParams = {}) {\r\n        if (!options.name || options.name === \"\") {\r\n            options.name = \"scaleControl\";\r\n        }\r\n        super(options);\r\n\r\n        this._template = TEMPLATE;\r\n\r\n        this._minWidth = 100;\r\n        this._maxWidth = 150;\r\n\r\n        this._isCenter = options.isCenter != undefined ? options.isCenter : true;\r\n\r\n        this._mPx = 0\r\n        this.currWidth = 0;\r\n        this._metersInMinSize = 0;\r\n\r\n        this.el = null;\r\n\r\n        this._scaleLabelEl = null;\r\n    }\r\n\r\n    protected _renderTemplate() {\r\n        return parseHTML(this._template)[0];\r\n    }\r\n\r\n    public override oninit() {\r\n        this.el = this._renderTemplate()!;\r\n\r\n        this._scaleLabelEl = this.el.querySelector<HTMLElement>(\".og-scale-label\")!;\r\n\r\n        this.renderer!.div!.appendChild(this.el);\r\n\r\n        if (this._isCenter) {\r\n            this.planet!.camera.events.on(\"moveend\", () => {\r\n                this._drawScreen(this.planet!.renderer!.handler.getCenter());\r\n            });\r\n\r\n            !this.planet!.terrain!.isEmpty && (this.planet!.terrain as GlobusTerrain).events.on(\"loadend\", () => {\r\n                this._drawScreen(this.planet!.renderer!.handler.getCenter());\r\n            });\r\n        } else {\r\n            this.renderer!.events.on(\"mousemove\", (e: IMouseState) => {\r\n                if (!e.leftButtonHold && !e.rightButtonHold) {\r\n                    this._drawScreen(e.pos);\r\n                }\r\n            });\r\n\r\n            this.planet!.camera.events.on(\"moveend\", () => {\r\n                let ms = this.renderer!.events.mouseState;\r\n                if (!ms.leftButtonHold && !ms.rightButtonHold) {\r\n                    this._drawScreen(ms.pos);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    protected _drawScreen(px: Vec2) {\r\n        let cam = this.planet!.camera;\r\n        let s0 = px;\r\n        let dist = this.planet!.getDistanceFromPixel(s0) || 0;\r\n        if (dist === 0) {\r\n            s0 = cam.project3v(Vec3.ZERO);\r\n            dist = this.planet!.getDistanceFromPixel(s0) || 0;\r\n        }\r\n        let p0 = cam.getForward().scaleTo(dist).addA(cam.eye);\r\n        let tempSize = dist * Math.tan(cam.viewAngle * RADIANS);\r\n        let p1 = p0.add(cam.getRight().scaleTo(tempSize));\r\n        let s1 = cam.project3v(p1);\r\n        this._mPx = tempSize / s1.distance(s0);\r\n\r\n        let metersInMinSize = this._mPx * this._minWidth;\r\n\r\n        let index = binarySearch(scale, metersInMinSize, (a: number, b: number) => a - b);\r\n        if (index < 0) {\r\n            index = ~index;\r\n        }\r\n        let minMeters = scale[index],\r\n            maxMeters = scale[index + 1];\r\n\r\n        let t = (minMeters - metersInMinSize) / (maxMeters - minMeters);\r\n        this.currWidth = this._minWidth + t * (this._maxWidth - this._minWidth);\r\n\r\n        if (minMeters >= 1000) {\r\n            this._scaleLabelEl!.innerText = `${minMeters / 1000} km`;\r\n        } else if (minMeters >= 1) {\r\n            this._scaleLabelEl!.innerText = `${minMeters} m`;\r\n        } else if (minMeters >= 0.01) {\r\n            this._scaleLabelEl!.innerText = `${minMeters * 100} cm`;\r\n        } else {\r\n            this._scaleLabelEl!.innerText = `${minMeters * 1000} mm`;\r\n        }\r\n\r\n\r\n        this._metersInMinSize = metersInMinSize;\r\n\r\n        this.el!.style.width = this.currWidth + \"px\";\r\n    }\r\n}\r\n","import {print2d} from \"../utils/shared\";\r\nimport {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\n\r\n/**\r\n * Frame per second(FPS) display control.\r\n */\r\nexport class ShowFps extends Control {\r\n    constructor(options: IControlParams) {\r\n        super(options);\r\n    }\r\n\r\n    public override oninit() {\r\n        let d = document.createElement(\"div\");\r\n        d.className = \"defaultText \";\r\n        d.id = \"ogShowFpsControl\";\r\n        document.body.appendChild(d);\r\n        this.renderer!.events.on(\"draw\", this._draw, this);\r\n    }\r\n\r\n    protected _draw() {\r\n        print2d(\r\n            \"ogShowFpsControl\",\r\n            (1000.0 / this.renderer!.handler.deltaTime).toFixed(1),\r\n            this.renderer!.handler.canvas!.clientWidth - 60,\r\n            0\r\n        );\r\n    }\r\n}","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {input} from \"../input/input\";\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport * as math from \"../math\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Plane} from \"../math/Plane\";\r\n\r\ninterface ISimpleNavigationParams extends IControlParams {\r\n    speed?: number;\r\n}\r\n\r\n/**\r\n * Simple keyboard camera navigation with W,S,A,D and shift keys to fly around the scene.\r\n */\r\nexport class SimpleNavigation extends Control {\r\n    public speed: number;\r\n    public force: Vec3;\r\n    public vel: Vec3;\r\n    public mass: number;\r\n\r\n    protected _lookPos: Vec3 | undefined;\r\n    protected _up: Vec3 | null;\r\n\r\n    protected _grabbedPoint: Vec3 | undefined;\r\n    protected _eye0: Vec3;\r\n\r\n    constructor(options: ISimpleNavigationParams = {}) {\r\n        super({\r\n            name: \"SimpleNavigation\",\r\n            autoActivate: true, ...options\r\n        });\r\n        this.speed = options.speed || 1.0; // m/s\r\n        this.force = new Vec3();\r\n        this.vel = new Vec3();\r\n        this.mass = 1;\r\n\r\n        this._lookPos = undefined;\r\n        this._grabbedPoint = undefined;\r\n        this._up = null;\r\n\r\n        this._eye0 = new Vec3();\r\n    }\r\n\r\n    override oninit() {\r\n\r\n    }\r\n\r\n    public override onactivate() {\r\n        super.onactivate();\r\n        let r = this.renderer!;\r\n\r\n        r.events.on(\"mousewheel\", this._onMouseWheel);\r\n        r.events.on(\"keypress\", input.KEY_W, this.onCameraMoveForward, this);\r\n        r.events.on(\"keypress\", input.KEY_S, this.onCameraMoveBackward, this);\r\n        r.events.on(\"keypress\", input.KEY_A, this.onCameraStrifeLeft, this);\r\n        r.events.on(\"keypress\", input.KEY_D, this.onCameraStrifeRight, this);\r\n        r.events.on(\"keypress\", input.KEY_UP, this.onCameraLookUp, this);\r\n        r.events.on(\"keypress\", input.KEY_DOWN, this.onCameraLookDown, this);\r\n        r.events.on(\"keypress\", input.KEY_LEFT, this.onCameraTurnLeft, this);\r\n        r.events.on(\"keypress\", input.KEY_RIGHT, this.onCameraTurnRight, this);\r\n        r.events.on(\"keypress\", input.KEY_Q, this.onCameraRollLeft, this);\r\n        r.events.on(\"keypress\", input.KEY_E, this.onCameraRollRight, this);\r\n\r\n        r.events.on(\"rhold\", this._onRHold, this);\r\n        r.events.on(\"rdown\", this._onRDown, this);\r\n\r\n        r.events.on(\"lhold\", this._onMouseLeftButtonDown);\r\n        r.events.on(\"ldown\", this._onMouseLeftButtonClick);\r\n        r.events.on(\"lup\", this._onMouseLeftButtonUp);\r\n\r\n        r.events.on(\"draw\", this.onDraw, this, -1000);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        super.ondeactivate();\r\n        let r = this.renderer!;\r\n        r.events.off(\"mousewheel\", this._onMouseWheel);\r\n        r.events.off(\"keypress\", input.KEY_W, this.onCameraMoveForward);\r\n        r.events.off(\"keypress\", input.KEY_S, this.onCameraMoveBackward);\r\n        r.events.off(\"keypress\", input.KEY_A, this.onCameraStrifeLeft);\r\n        r.events.off(\"keypress\", input.KEY_D, this.onCameraStrifeRight);\r\n        r.events.off(\"keypress\", input.KEY_UP, this.onCameraLookUp);\r\n        r.events.off(\"keypress\", input.KEY_DOWN, this.onCameraLookDown);\r\n        r.events.off(\"keypress\", input.KEY_LEFT, this.onCameraTurnLeft);\r\n        r.events.off(\"keypress\", input.KEY_RIGHT, this.onCameraTurnRight);\r\n        r.events.off(\"keypress\", input.KEY_Q, this.onCameraRollLeft);\r\n        r.events.off(\"keypress\", input.KEY_E, this.onCameraRollRight);\r\n\r\n        r.events.off(\"rhold\", this._onRHold);\r\n        r.events.off(\"rdown\", this._onRDown);\r\n\r\n        r.events.off(\"lhold\", this._onMouseLeftButtonDown);\r\n        r.events.off(\"ldown\", this._onMouseLeftButtonClick);\r\n        r.events.off(\"lup\", this._onMouseLeftButtonUp);\r\n\r\n        r.events.off(\"draw\", this.onDraw);\r\n    }\r\n\r\n    protected _onMouseLeftButtonClick = (e: IMouseState) => {\r\n        if (this._active && this.renderer) {\r\n            this.renderer.handler.canvas!.classList.add(\"ogGrabbingPoiner\");\r\n            this._grabbedPoint = this.renderer.getCartesianFromPixel(e);\r\n            if (this._grabbedPoint) {\r\n                this._eye0.copy(this.renderer.activeCamera.eye);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onMouseLeftButtonUp = (e: IMouseState) => {\r\n        this.renderer!.handler.canvas!.classList.remove(\"ogGrabbingPoiner\");\r\n        if (e.x === e.prev_x && e.y === e.prev_y) {\r\n            //this.force.set(0, 0, 0);\r\n        }\r\n    }\r\n\r\n    protected _onMouseLeftButtonDown = (e: IMouseState) => {\r\n        if (this._active && this.renderer) {\r\n            if (!this._grabbedPoint) {\r\n                return;\r\n            }\r\n\r\n            if (e.moving) {\r\n                let cam = this.renderer.activeCamera;\r\n\r\n                let camSlope = Math.abs(cam.getForward().dot(Vec3.UP));\r\n\r\n                let p0 = this._grabbedPoint, p1, p2;\r\n\r\n                if (camSlope > 0.7) {\r\n                    p1 = Vec3.add(p0, Vec3.LEFT);\r\n                    p2 = Vec3.add(p0, cam.getRight());\r\n                } else {\r\n                    p1 = Vec3.add(p0, cam.getRight());\r\n                    p2 = Vec3.add(p0, Vec3.UP);\r\n                }\r\n\r\n                let px = new Vec3();\r\n                if (new Ray(cam.eye, e.direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n                    cam.eye = this._eye0.addA(px.subA(p0).negate());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onRHold = (e: IMouseState) => {\r\n        if (this._lookPos && e.moving && this.renderer) {\r\n            const cam = this.renderer.activeCamera;\r\n            this.renderer!.controlsBag.scaleRot = 1.0;\r\n            let l = (0.5 / cam.eye.distance(this._lookPos)) * math.RADIANS;\r\n            if (l > 0.007) {\r\n                l = 0.007;\r\n            } else if (l < 0.003) {\r\n                l = 0.003;\r\n            }\r\n            cam.rotateHorizontal(l * (e.x - e.prev_x), false, this._lookPos, this._up!);\r\n            cam.rotateVertical(l * (e.y - e.prev_y), this._lookPos);\r\n        }\r\n    }\r\n\r\n    protected _onRDown = (e: IMouseState) => {\r\n        if (this.renderer) {\r\n            this._lookPos = this.renderer.getCartesianFromPixel(e.pos);\r\n            if (this._lookPos) {\r\n                this._up = Vec3.UP;//this.renderer.activeCamera.getUp();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onMouseWheel = (e: IMouseState) => {\r\n        if (this.renderer) {\r\n            let pos = this.renderer.getCartesianFromPixel(e),\r\n                dist = 10;\r\n            if (pos) {\r\n                dist = this.renderer.activeCamera.eye.distance(pos);\r\n            }\r\n            this.force.addA(e.direction.scale(e.wheelDelta)).normalize().scale(dist);\r\n        }\r\n    }\r\n\r\n    protected onCameraMoveForward = () => {\r\n        this.force.addA(this.renderer!.activeCamera.getForward()).normalize();\r\n    }\r\n\r\n    protected onCameraMoveBackward = () => {\r\n        this.force.addA(this.renderer!.activeCamera.getBackward()).normalize();\r\n    }\r\n\r\n    protected onCameraStrifeLeft = () => {\r\n        this.force.addA(this.renderer!.activeCamera.getLeft()).normalize();\r\n    }\r\n\r\n    protected onCameraStrifeRight = () => {\r\n        this.force.addA(this.renderer!.activeCamera.getRight()).normalize();\r\n    }\r\n\r\n    protected onCameraLookUp = () => {\r\n        let cam = this.renderer!.activeCamera!;\r\n        cam.setPitch(0.5);\r\n        cam.update();\r\n    }\r\n\r\n    protected onCameraLookDown = () => {\r\n        let cam = this.renderer!.activeCamera!;\r\n        cam.setPitch(-0.5);\r\n        cam.update();\r\n    }\r\n\r\n    protected onCameraTurnLeft = () => {\r\n        let cam = this.renderer!.activeCamera!;\r\n        cam.setYaw(0.5);\r\n        cam.update();\r\n    }\r\n\r\n    protected onCameraTurnRight = () => {\r\n        let cam = this.renderer!.activeCamera!;\r\n        cam.setYaw(-0.5);\r\n        cam.update();\r\n    }\r\n\r\n    protected onCameraRollLeft = () => {\r\n        let cam = this.renderer!.activeCamera!;\r\n        cam.setRoll(-0.5);\r\n        cam.update();\r\n    }\r\n\r\n    protected onCameraRollRight = () => {\r\n        let cam = this.renderer!.activeCamera!;\r\n        cam.setRoll(0.5);\r\n        cam.update();\r\n    }\r\n\r\n    protected get dt(): number {\r\n        return 0.001 * this.renderer!.handler.deltaTime;\r\n    }\r\n\r\n    protected onDraw() {\r\n        if (this.renderer) {\r\n\r\n            let acc = this.force.scale(1.0 / this.mass);\r\n            this.vel.addA(acc);\r\n            this.vel.scale(0.96);\r\n            this.force.set(0, 0, 0);\r\n\r\n            let cam = this.renderer.activeCamera;\r\n            cam.eye = cam.eye.add(this.vel.scaleTo(this.dt));\r\n            cam.update();\r\n        }\r\n    }\r\n}","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {htmlColorToRgb, rgbToStringHTML} from \"../utils/shared\";\r\nimport {Program} from '../webgl/Program';\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\n\r\ninterface ISimpleSkyBackgroundParams extends IControlParams {\r\n\r\n}\r\n\r\nexport class SimpleSkyBackground extends Control {\r\n    protected _colorOne: Float32Array;\r\n    protected _colorTwo: Float32Array;\r\n\r\n    constructor(options: ISimpleSkyBackgroundParams = {}) {\r\n        super({\r\n            name: \"SimpleSkyBackground\",\r\n            ...options\r\n        });\r\n\r\n        this._colorOne = new Float32Array([128 / 255, 223 / 255, 255 / 255]);\r\n        this._colorTwo = new Float32Array([10 / 255, 15 / 255, 56 / 255]);\r\n    }\r\n\r\n    public get colorOne(): string {\r\n        let c = this._colorOne;\r\n        let arr: NumberArray3 = [Math.round(c[0] * 255), Math.round(c[1] * 255), Math.round(c[2] * 255)];\r\n        return rgbToStringHTML(arr);\r\n    }\r\n\r\n    public get colorTwo(): string {\r\n        let c = this._colorTwo;\r\n        let arr: NumberArray3 = [Math.round(c[0] * 255), Math.round(c[1] * 255), Math.round(c[2] * 255)];\r\n        return rgbToStringHTML(arr);\r\n    }\r\n\r\n    public set colorOne(htmlColor: string) {\r\n        let rgb = htmlColorToRgb(htmlColor);\r\n        this._colorOne[0] = rgb.x;\r\n        this._colorOne[1] = rgb.y;\r\n        this._colorOne[2] = rgb.z;\r\n    }\r\n\r\n    public set colorTwo(htmlColor: string) {\r\n        let rgb = htmlColorToRgb(htmlColor);\r\n        this._colorTwo[0] = rgb.x;\r\n        this._colorTwo[1] = rgb.y;\r\n        this._colorTwo[2] = rgb.z;\r\n    }\r\n\r\n    public override oninit() {\r\n        this.renderer!.handler.addProgram(simpleSkyBackgroundShader());\r\n        this.activate();\r\n    }\r\n\r\n    public override onactivate() {\r\n        super.onactivate();\r\n        this.planet!.events.on(\"draw\", this._drawBackground, this);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        super.ondeactivate();\r\n        this.planet!.events.off(\"draw\", this._drawBackground);\r\n    }\r\n\r\n    protected _drawBackground() {\r\n        let h = this.renderer!.handler;\r\n        let sh = h.programs.simpleSkyBackground,\r\n            p = sh._program,\r\n            shu = p.uniforms,\r\n            gl = h.gl!;\r\n        let cam = this.planet!.camera;\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        sh.activate();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.renderer!.screenFramePositionBuffer!);\r\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.uniform3fv(shu.camPos, [cam.eye.x, cam.eye.y, cam.eye.z]);\r\n        gl.uniform2fv(shu.iResolution, [h.getWidth(), h.getHeight()]);\r\n        gl.uniform1f(shu.fov, cam.getViewAngle());\r\n        gl.uniform1f(shu.earthRadius, this.planet!.ellipsoid.getPolarSize() + 1);\r\n        gl.uniform3fv(shu.colorOne, this._colorOne);\r\n        gl.uniform3fv(shu.colorTwo, this._colorTwo);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n    }\r\n}\r\n\r\nfunction simpleSkyBackgroundShader(): Program {\r\n    return new Program(\"simpleSkyBackground\", {\r\n        uniforms: {\r\n            iResolution: \"vec2\", fov: \"float\",\r\n            camPos: \"vec3\",\r\n            earthRadius: \"float\",\r\n            viewMatrix: \"mat4\",\r\n            colorOne: \"vec3\",\r\n            colorTwo: \"vec3\"\r\n        }, attributes: {\r\n            corners: \"vec3\"\r\n        },\r\n        vertexShader:\r\n            `attribute vec2 corners;\r\n                        \r\n            varying vec2 tc;\r\n            \r\n            void main(void) {\r\n                gl_Position = vec4(corners, 0.0, 1.0);\r\n                tc = corners * 0.5 + 0.5;\r\n            }`,\r\n        fragmentShader:\r\n            `precision highp float;\r\n            \r\n            #define MAX 10e10\r\n            #define PI 3.14159265359\r\n            #define rad(x) x * PI / 180.\r\n            #define ZERO vec3(0.0)          \r\n           \r\n            #define RED vec4(1.0, 0.0, 0.0, 1.0)\r\n            #define GREEN vec4(0.0, 1.0, 0.0, 1.0)         \r\n            \r\n            uniform vec3 camPos;            \r\n            uniform vec2 iResolution;\r\n            uniform float fov;\r\n            uniform float earthRadius;\r\n            uniform mat4 viewMatrix;\r\n            \r\n            uniform vec3 colorOne;\r\n            uniform vec3 colorTwo;\r\n                         \r\n            varying vec2 tc;\r\n                        \r\n            // compute the view ray in the camera coordinate\r\n            vec3 computeView(vec2 uv){\r\n                float w_h_ratio = iResolution.x / iResolution.y;   \r\n                float h = tan(rad(fov/2.));\r\n                return normalize(vec3(-w_h_ratio * h, -h, -1.) + vec3(uv.x * 2. * h * w_h_ratio, uv.y*2.*h, 0.));\r\n            }\r\n\r\n            // sphere of size ra centered at point ce\r\n            vec2 sphIntersect( in vec3 ro, in vec3 rd, in vec3 ce, float ra )\r\n            {\r\n                vec3 oc = ro - ce;\r\n                float b = dot( oc, rd );\r\n                float c = dot( oc, oc ) - ra * ra;\r\n                float h = b * b - c;\r\n                if( h < 0.0 ) return vec2(MAX); // no intersection\r\n                h = sqrt( h );\r\n                return vec2( -b-h, -b+h );\r\n            }\r\n            \r\n            mat3 transpose(mat3 matrix) {\r\n                vec3 row0 = matrix[0];\r\n                vec3 row1 = matrix[1];\r\n                vec3 row2 = matrix[2];\r\n                mat3 result = mat3(\r\n                    vec3(row0.x, row1.x, row2.x),\r\n                    vec3(row0.y, row1.y, row2.y),\r\n                    vec3(row0.z, row1.z, row2.z)\r\n                );\r\n                return result;\r\n            }\r\n            \r\n            float det(mat2 matrix) {\r\n                return matrix[0].x * matrix[1].y - matrix[0].y * matrix[1].x;\r\n            }\r\n            \r\n            mat3 inverse(mat3 matrix) {\r\n                vec3 row0 = matrix[0];\r\n                vec3 row1 = matrix[1];\r\n                vec3 row2 = matrix[2];\r\n            \r\n                vec3 minors0 = vec3(\r\n                    det(mat2(row1.y, row1.z, row2.y, row2.z)),\r\n                    det(mat2(row1.z, row1.x, row2.z, row2.x)),\r\n                    det(mat2(row1.x, row1.y, row2.x, row2.y))\r\n                );\r\n                vec3 minors1 = vec3(\r\n                    det(mat2(row2.y, row2.z, row0.y, row0.z)),\r\n                    det(mat2(row2.z, row2.x, row0.z, row0.x)),\r\n                    det(mat2(row2.x, row2.y, row0.x, row0.y))\r\n                );\r\n                vec3 minors2 = vec3(\r\n                    det(mat2(row0.y, row0.z, row1.y, row1.z)),\r\n                    det(mat2(row0.z, row0.x, row1.z, row1.x)),\r\n                    det(mat2(row0.x, row0.y, row1.x, row1.y))\r\n                );\r\n            \r\n                mat3 adj = transpose(mat3(minors0, minors1, minors2));\r\n            \r\n                return (1.0 / dot(row0, minors0)) * adj;\r\n            }\r\n            \r\n            void main(void) {\r\n            \r\n                vec3 dir = computeView(tc);\r\n                dir = inverse(mat3(viewMatrix)) * dir;\r\n                \r\n                vec2 ER = sphIntersect(camPos, dir, vec3(0.0), earthRadius);\r\n                \r\n                float bigRadius = earthRadius * 2.5;\r\n                vec3 bigCenter = normalize(camPos) * bigRadius * 1.3;                \r\n                               \r\n                vec2 BIG = sphIntersect(camPos, dir, bigCenter, bigRadius);\r\n                \r\n                float Ix = distance(camPos + dir * BIG.y, ZERO);               \r\n                \r\n                float maxI = sqrt(bigRadius * bigRadius + bigRadius * bigRadius);\r\n                                   \r\n                gl_FragColor = vec4(mix(colorOne, colorTwo, Ix / maxI), 1.0);\r\n            }`\r\n    });\r\n}\r\n","import {type JulianDate, ONE_BY_SECONDS_PER_DAY, J2000} from \"./jd\";\r\n\r\n/**\r\n * Angle between J2000 mean equator and the ecliptic plane.\r\n * 23 deg 26' 21\".448 (Seidelmann, _Explanatory Supplement to the\r\n * Astronomical Almanac_ (1992), eqn 3.222-1.\r\n * @const\r\n * @type{number}\r\n */\r\nexport const J2000_OBLIQUITY = 23.4392911;\r\n\r\n/**\r\n * IAU 1976 value\r\n * @const\r\n * @type{number}\r\n */\r\nexport const AU_TO_METERS = 1.4959787e11;\r\n\r\n/**\r\n * Terrestrial and atomic time difference.\r\n * @const\r\n * @type{number}\r\n */\r\nexport const TDT_TAI = 32.184;\r\n\r\n/**\r\n * Earth gravitational parameter product of gravitational constant G and the mass M of the Earth.\r\n * @const\r\n * @type{number}\r\n */\r\nexport const EARTH_GRAVITATIONAL_PARAMETER = 3.98600435e14;\r\n\r\n/**\r\n * Sun gravitational parameter product of gravitational constant G and the mass M of the Sun.\r\n * @const\r\n * @type{number}\r\n */\r\nexport const SUN_GRAVITATIONAL_PARAMETER = 1.32712440018e20;\r\n\r\n/**\r\n * Converts atomic time to barycentric dynamical time.\r\n * @param {JulianDate} tai - Atomic time.\r\n * @returns {JulianDate} - returns barycentric dynamical time.\r\n */\r\nexport function TAItoTDB(tai: JulianDate): JulianDate {\r\n    tai += TDT_TAI * ONE_BY_SECONDS_PER_DAY;\r\n    const g = 6.239996 + 0.0172019696544 * (tai - J2000);\r\n    return tai + 0.001658 * Math.sin(g + 1.671e-2 * Math.sin(g)) * ONE_BY_SECONDS_PER_DAY;\r\n}\r\n","import * as math from \"../math\";\r\nimport { Quat } from \"../math/Quat\";\r\nimport { Vec3 } from \"../math/Vec3\";\r\nimport * as astro from \"./astro\";\r\nimport * as jd from \"./jd\";\r\nimport type {JulianDate} from \"./jd\";\r\n\r\n/**\r\n * Returns Sun position in the geocentric coordinate system by the time.\r\n * @param {JulianDate} jDate - Julian date time.\r\n * @returns {Vec3} - Sun geocentric coordinates.\r\n */\r\nexport function getSunPosition(jDate: JulianDate): Vec3 {\r\n    // http://stjarnhimlen.se/comp/tutorial.html\r\n    // a  Mean distance, or semi-major axis\r\n    // e  Eccentricity\r\n    // T  Time at perihelion\r\n\r\n    // q  Perihelion distance  = a * (1 - e)\r\n    // Q  Aphelion distance    = a * (1 + e)\r\n\r\n    // i  Inclination, i.e. the \"tilt\" of the orbit relative to the\r\n    //    ecliptic.  The inclination varies from 0 to 180 degrees. If\r\n    //    the inclination is larger than 90 degrees, the planet is in\r\n    //    a retrogade orbit, i.e. it moves \"backwards\".  The most\r\n    //    well-known celestial body with retrogade motion is Comet Halley.\r\n\r\n    // N  (usually written as \"Capital Omega\") Longitude of Ascending\r\n    //    Node. This is the angle, along the ecliptic, from the Vernal\r\n    //    Point to the Ascending Node, which is the intersection between\r\n    //    the orbit and the ecliptic, where the planet moves from south\r\n    //    of to north of the ecliptic, i.e. from negative to positive\r\n    //    latitudes.\r\n\r\n    // w  (usually written as \"small Omega\") The angle from the Ascending\r\n    //    node to the Perihelion, along the orbit.\r\n\r\n    // P  Orbital period       = 365.256898326 * a**1.5/sqrt(1+m) days,\r\n    //    where m = the mass of the planet in solar masses (0 for\r\n    //    comets and asteroids). sqrt() is the square root function.\r\n\r\n    // n  Daily motion         = 360_deg / P    degrees/day\r\n\r\n    // t  Some epoch as a day count, e.g. Julian Day Number. The Time\r\n    //    at Perihelion, T, should then be expressed as the same day count.\r\n\r\n    // t - T   Time since Perihelion, usually in days\r\n\r\n    // M  Mean Anomaly         = n * (t - T)  =  (t - T) * 360_deg / P\r\n    //    Mean Anomaly is 0 at perihelion and 180 degrees at aphelion\r\n\r\n    // L  Mean Longitude       = M + w + N\r\n\r\n    // E  Eccentric anomaly, defined by Kepler's equation:   M = E - e * sin(E)\r\n    //    An auxiliary angle to compute the position in an elliptic orbit\r\n\r\n    // v  True anomaly: the angle from perihelion to the planet, as seen\r\n    //    from the Sun\r\n\r\n    // r  Heliocentric distance: the planet's distance from the Sun.\r\n\r\n    // x,y,z  Rectangular coordinates. Used e.g. when a heliocentric\r\n    //        position (seen from the Sun) should be converted to a\r\n    //        corresponding geocentric position (seen from the Earth).\r\n\r\n    var d = jDate - jd.J2000;\r\n\r\n    var w = 282.9404 + 4.70935e-5 * d; // longitude of perihelion\r\n    // var a = 1.000000; // mean distance, a.u.\r\n    var e = 0.016709 - 1.151e-9 * d; // eccentricity\r\n    var M = math.rev(356.047 + 0.9856002585 * d); // mean anomaly\r\n\r\n    var oblecl = astro.J2000_OBLIQUITY - 3.563e-7 * d; // obliquity of the ecliptic\r\n\r\n    // var L = math.rev(w + M); // Sun's mean longitude\r\n\r\n    var E =\r\n        M + math.DEGREES * e * Math.sin(M * math.RADIANS) * (1 + e * Math.cos(M * math.RADIANS)); // eccentric anomaly\r\n\r\n    // Sun rectangular coordinates, where the X axis points towards the perihelion\r\n    var x = Math.cos(E * math.RADIANS) - e;\r\n    var y = Math.sin(E * math.RADIANS) * Math.sqrt(1 - e * e);\r\n\r\n    var r = Math.sqrt(x * x + y * y); // distance\r\n    var v = Math.atan2(y, x) * math.DEGREES; // true anomaly\r\n\r\n    var lon = math.rev(v + w); // longitude of the Sun\r\n\r\n    // the Sun's ecliptic rectangular coordinates\r\n    x = r * Math.cos(lon * math.RADIANS);\r\n    y = r * Math.sin(lon * math.RADIANS);\r\n\r\n    // We use oblecl, and rotate these coordinates\r\n    var xequat = x;\r\n    var yequat = y * Math.cos(oblecl * math.RADIANS);\r\n    var zequat = y * Math.sin(oblecl * math.RADIANS);\r\n\r\n    var theta = math.TWO_PI * ((d * 24.0) / 23.9344694 - 259.853 / 360.0); // Siderial spin time\r\n\r\n    return Quat.zRotation(-theta).mulVec3(\r\n        new Vec3(\r\n            -xequat * astro.AU_TO_METERS,\r\n            -yequat * astro.AU_TO_METERS,\r\n            zequat * astro.AU_TO_METERS\r\n        )\r\n    );\r\n\r\n    // Convert to RA and Decl\r\n    // var RA = Math.atan2(yequat, xequat) * math.DEGREES;\r\n    // var Decl = Math.atan2(zequat, Math.sqrt(xequat * xequat + yequat * yequat)) * math.DEGREES;\r\n}\r\n","import {Vec3} from \"../math/Vec3\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\n\r\nexport interface ILightSourceParams {\r\n    position?: Vec3;\r\n    ambient?: Vec3;\r\n    diffuse?: Vec3;\r\n    specular?: Vec3;\r\n    shininess?: number;\r\n}\r\n\r\nclass LightSource {\r\n\r\n    protected _renderNode: RenderNode | null;\r\n\r\n    public _position: Vec3;\r\n\r\n    protected _ambient: Vec3;\r\n    protected _diffuse: Vec3;\r\n    protected _specular: Vec3;\r\n    protected _shininess: number;\r\n    protected _active: boolean;\r\n    protected _tempAmbient: Vec3;\r\n    protected _tempDiffuse: Vec3;\r\n    protected _tempSpecular: Vec3;\r\n    protected _tempShininess: number;\r\n\r\n    constructor(params: ILightSourceParams) {\r\n\r\n        this._renderNode = null;\r\n        this._position = params.position || new Vec3();\r\n        this._ambient = params.ambient || new Vec3();\r\n        this._diffuse = params.diffuse || new Vec3(0.8, 0.8, 0.8);\r\n        this._specular = params.specular || new Vec3(0.18, 0.18, 0.18);\r\n        this._shininess = params.shininess != undefined ? params.shininess : 3.3;\r\n        this._active = true;\r\n\r\n        this._tempAmbient = this._ambient.clone();\r\n        this._tempDiffuse = this._diffuse.clone();\r\n        this._tempSpecular = this._specular.clone();\r\n        this._tempShininess = this._shininess;\r\n    }\r\n\r\n    public isActive(): boolean {\r\n        return this._active;\r\n    }\r\n\r\n    public setPosition3v(position: Vec3) {\r\n        this.setPosition(position.x, position.y, position.z);\r\n    }\r\n\r\n    public setPosition(x: number, y: number, z: number) {\r\n        this._position.x = x;\r\n        this._position.y = y;\r\n        this._position.z = z;\r\n        if (this._renderNode) {\r\n            this._renderNode._lightPosition[0] = x;\r\n            this._renderNode._lightPosition[1] = y;\r\n            this._renderNode._lightPosition[2] = z;\r\n        }\r\n    }\r\n\r\n    public getPosition(): Vec3 {\r\n        return this._position.clone();\r\n    }\r\n\r\n    public setAmbient3v(rgb: Vec3) {\r\n        this.setAmbient(rgb.x, rgb.y, rgb.z);\r\n    }\r\n\r\n    public setDiffuse3v(rgb: Vec3) {\r\n        this.setDiffuse(rgb.x, rgb.y, rgb.z);\r\n    }\r\n\r\n    public setSpecular3v(rgb: Vec3) {\r\n        this.setSpecular(rgb.x, rgb.y, rgb.z);\r\n    }\r\n\r\n    public setAmbient(r: number, g: number, b: number) {\r\n        this._ambient.set(r, g, b);\r\n        const rn = this._renderNode;\r\n        if (rn) {\r\n            rn._lightParams[0] = r;\r\n            rn._lightParams[1] = g;\r\n            rn._lightParams[2] = b;\r\n        }\r\n    }\r\n\r\n    public setDiffuse(r: number, g: number, b: number) {\r\n        this._diffuse.set(r, g, b);\r\n        const rn = this._renderNode;\r\n        if (rn) {\r\n            rn._lightParams[3] = r;\r\n            rn._lightParams[4] = g;\r\n            rn._lightParams[5] = b;\r\n        }\r\n    }\r\n\r\n    public setSpecular(r: number, g: number, b: number) {\r\n        this._specular.set(r, g, b);\r\n        const rn = this._renderNode;\r\n        if (rn) {\r\n            rn._lightParams[6] = r;\r\n            rn._lightParams[7] = g;\r\n            rn._lightParams[8] = b;\r\n        }\r\n    }\r\n\r\n    public setShininess(shininess: number) {\r\n        this._shininess = shininess;\r\n        const rn = this._renderNode;\r\n        if (rn) {\r\n            rn._lightShininess = shininess;\r\n        }\r\n    }\r\n\r\n    public addTo(renderNode: RenderNode) {\r\n        this._renderNode = renderNode;\r\n        this.setShininess(this._shininess);\r\n        this.setAmbient3v(this._ambient);\r\n        this.setDiffuse3v(this._diffuse);\r\n        this.setSpecular3v(this._specular);\r\n    }\r\n}\r\n\r\nexport {LightSource};\r\n","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {Clock} from \"../Clock\";\r\nimport {getSunPosition} from \"../astro/earth\";\r\nimport {LightSource} from \"../light/LightSource\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Vec3} from \"../math/Vec3\";\r\n\r\ninterface ISunParams extends IControlParams {\r\n    activationHeight?: number;\r\n    offsetVertical?: number;\r\n    offsetHorizontal?: number;\r\n    stopped?: boolean;\r\n}\r\n\r\n/**\r\n * Real Sun geocentric position control that place the Sun on the right place by the Earth.\r\n */\r\nexport class Sun extends Control {\r\n    public activationHeight: number;\r\n    public offsetVertical: number;\r\n    public offsetHorizontal: number;\r\n    public sunlight: LightSource;\r\n\r\n    protected _currDate: number;\r\n    protected _prevDate: number;\r\n    protected _clockPtr: Clock | null;\r\n    protected _lightOn: boolean;\r\n    protected _stopped: boolean;\r\n    protected _f: number;\r\n    protected _k: number;\r\n\r\n    constructor(options: ISunParams = {}) {\r\n        super({autoActivate: true, ...options});\r\n\r\n        this._name = \"sun\";\r\n\r\n        this.activationHeight = options.activationHeight || 12079000.0;\r\n\r\n        this.offsetVertical = options.offsetVertical || -5000000;\r\n\r\n        this.offsetHorizontal = options.offsetHorizontal || 5000000;\r\n\r\n        this.sunlight = new LightSource({\r\n            ambient: new Vec3(0.15, 0.15, 0.25),\r\n            diffuse: new Vec3(0.9, 0.9, 0.8),\r\n            specular: new Vec3(0.1, 0.1, 0.06),\r\n            shininess: 110\r\n        });\r\n\r\n        /**\r\n         * Current frame handler clock date and time.\r\n         * @private\r\n         * @type {Number}\r\n         */\r\n        this._currDate = 0;\r\n\r\n        /**\r\n         * Previous frame handler clock date and time.\r\n         * @private\r\n         * @type {Number}\r\n         */\r\n        this._prevDate = 0;\r\n\r\n        this._clockPtr = null;\r\n\r\n        this._lightOn = false;\r\n\r\n        this._f = 0;\r\n        this._k = 0;\r\n\r\n        this._stopped = options.stopped || false;\r\n    }\r\n\r\n    public override oninit() {\r\n        this.planet!.lightEnabled = true;\r\n\r\n        // sunlight initialization\r\n        this.sunlight.addTo(this.planet!);\r\n\r\n        this.renderer!.events.on(\"draw\", this._draw, this);\r\n\r\n        if (!this._clockPtr) {\r\n            this._clockPtr = this.renderer!.handler.defaultClock;\r\n        }\r\n    }\r\n\r\n    public stop() {\r\n        this._stopped = true;\r\n        this.deactivate();\r\n    }\r\n\r\n    public start() {\r\n        this._stopped = false;\r\n        this.activate();\r\n    }\r\n\r\n    public override onactivate() {\r\n        super.onactivate();\r\n        this._stopped = false;\r\n    }\r\n\r\n    public bindClock(clock: Clock) {\r\n        this._clockPtr = clock;\r\n    }\r\n\r\n    protected _draw() {\r\n        if (!this._clockPtr) return;\r\n        this._currDate = this._clockPtr.currentDate;\r\n        if (!this._stopped) {\r\n            let cam = this.planet!.camera;\r\n            if (cam.getHeight() < this.activationHeight || !this._active) {\r\n                this._lightOn = true;\r\n                this._f = 1;\r\n                let n = cam.eye.normal(),\r\n                    u = cam.getForward();\r\n\r\n                u.scale(Math.sign(cam.getUp().dot(n))); // up\r\n\r\n                if (cam.slope > 0.99) {\r\n                    u = cam.getUp();\r\n                }\r\n\r\n                let tu = Vec3.proj_b_to_plane(u, n, u).normalize().scale(this.offsetVertical);\r\n                let tr = Vec3.proj_b_to_plane(cam.getRight(), n, cam.getRight())\r\n                    .normalize()\r\n                    .scale(this.offsetHorizontal); // right\r\n\r\n                let d = tu.add(tr);\r\n                let pos = cam.eye.add(d);\r\n\r\n                if (this._k > 0) {\r\n                    this._k -= 0.001;\r\n                    let rot = Quat.getRotationBetweenVectors(\r\n                        this.sunlight._position.normal(),\r\n                        pos.normal()\r\n                    );\r\n                    let r = rot.slerp(Quat.IDENTITY, this._k).normalize();\r\n                    this.sunlight.setPosition3v(r.mulVec3(this.sunlight._position));\r\n                } else {\r\n                    this.sunlight.setPosition3v(pos);\r\n                }\r\n            } else {\r\n                this._k = 1;\r\n                if (this._f > 0) {\r\n                    this._f -= 0.001;\r\n                    let rot = Quat.getRotationBetweenVectors(\r\n                        this.sunlight._position.normal(),\r\n                        getSunPosition(this._currDate).normal()\r\n                    );\r\n                    let r = rot.slerp(Quat.IDENTITY, this._f).normalize();\r\n                    this.sunlight.setPosition3v(r.mulVec3(this.sunlight._position));\r\n                } else {\r\n                    if (\r\n                        (Math.abs(this._currDate - this._prevDate) > 0.00034 && this._active) ||\r\n                        this._lightOn\r\n                    ) {\r\n                        this._lightOn = false;\r\n                        this._prevDate = this._currDate;\r\n                        this.sunlight.setPosition3v(getSunPosition(this._currDate));\r\n                        this._f = 0;\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            this.sunlight.setPosition3v(getSunPosition(this._currDate));\r\n        }\r\n    }\r\n}","import {input} from \"../input/input\";\r\nimport {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\n\r\ninterface IToggleWireframe extends IControlParams {\r\n    isActive?: boolean;\r\n}\r\n\r\n/**\r\n * Planet GL draw mode(TRIANGLE_STRIP/LINE_STRING) changer.\r\n */\r\nexport class ToggleWireframe extends Control {\r\n    protected _isActive = false;\r\n\r\n    constructor(options: IToggleWireframe = {}) {\r\n        super(options);\r\n        this._isActive = options.isActive || false;\r\n    }\r\n\r\n    public override oninit() {\r\n        this.renderer!.events.on(\"charkeypress\", input.KEY_X, this.toogleWireframe, this);\r\n        if (this._isActive) {\r\n            this.planet!.setDrawMode(this.renderer!.handler.gl!.LINE_STRIP);\r\n        }\r\n    }\r\n\r\n    public toogleWireframe = () => {\r\n        if (this.renderer && this.renderer.handler.gl) {\r\n            if (this.planet!.drawMode === this.renderer.handler.gl.LINE_STRIP) {\r\n                this.planet!.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP);\r\n            } else {\r\n                this.planet!.setDrawMode(this.renderer.handler.gl.LINE_STRIP);\r\n            }\r\n        }\r\n    }\r\n}\r\n","import {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {Key} from \"../Lock\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {math} from \"../index\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {ITouchState} from \"../renderer/RendererEvents\";\r\nimport {Plane} from \"../math/Plane\";\r\n\r\ninterface ITouchNavigationParams extends IControlParams {\r\n\r\n}\r\n\r\nclass TouchExt {\r\n    public x: number;\r\n    public y: number;\r\n    public prev_x: number;\r\n    public prev_y: number;\r\n    public grabbedPoint: Vec3 | null;\r\n    public grabbedSpheroid: Sphere;\r\n\r\n    protected _vec: Vec2;\r\n    protected _vecPrev: Vec2;\r\n\r\n\r\n    constructor() {\r\n        this.x = 0;\r\n        this.y = 0;\r\n        this.prev_x = 0;\r\n        this.prev_y = 0;\r\n        this.grabbedPoint = null;\r\n        this.grabbedSpheroid = new Sphere();\r\n        this._vec = new Vec2();\r\n        this._vecPrev = new Vec2();\r\n    }\r\n\r\n    public get dY(): number {\r\n        return this.y - this.prev_y;\r\n    }\r\n\r\n    public get dX(): number {\r\n        return this.x - this.prev_x;\r\n    }\r\n\r\n    public get vec(): Vec2 {\r\n        return this._vec.set(this.x, this.y);\r\n    }\r\n\r\n    public get vecPrev(): Vec2 {\r\n        return this._vecPrev.set(this.prev_x, this.prev_y);\r\n    }\r\n}\r\n\r\n/**\r\n * Touch pad planet camera dragging control.\r\n */\r\nexport class TouchNavigation extends Control {\r\n\r\n    public grabbedPoint: Vec3;\r\n    public inertia: number;\r\n\r\n    protected grabbedSpheroid: Sphere;\r\n    protected qRot: Quat;\r\n    protected scaleRot: number;\r\n    protected rot: number;\r\n    protected _eye0: Vec3;\r\n    protected pointOnEarth: Vec3 | null;\r\n    protected earthUp: Vec3 | null;\r\n    protected touches: TouchExt[];\r\n    protected _keyLock: Key;\r\n    protected _touching: boolean;\r\n\r\n\r\n    constructor(options: ITouchNavigationParams = {}) {\r\n        super(options);\r\n\r\n        this._name = \"touchNavigation\";\r\n\r\n        this.grabbedPoint = new Vec3();\r\n        this.inertia = 0.007;\r\n        this.grabbedSpheroid = new Sphere();\r\n        this.planet = null;\r\n        this.qRot = new Quat();\r\n        this.scaleRot = 0;\r\n        this.rot = 1;\r\n        this._eye0 = new Vec3();\r\n\r\n        this.pointOnEarth = null;\r\n        this.earthUp = null;\r\n\r\n        this.touches = [new TouchExt(), new TouchExt()];\r\n\r\n        this._keyLock = new Key();\r\n\r\n        this._touching = false;\r\n    }\r\n\r\n    override oninit() {\r\n        if (this.renderer) {\r\n            this.renderer.events.on(\"touchstart\", this.onTouchStart, this);\r\n            this.renderer.events.on(\"touchend\", this.onTouchEnd, this);\r\n            this.renderer.events.on(\"doubletouch\", this.onDoubleTouch, this);\r\n            this.renderer.events.on(\"touchcancel\", this.onTouchCancel, this);\r\n            this.renderer.events.on(\"touchmove\", this.onTouchMove, this);\r\n            this.renderer.events.on(\"draw\", this.onDraw, this);\r\n        }\r\n    }\r\n\r\n    protected onTouchStart(e: ITouchState) {\r\n        const handler = this.renderer!.handler;\r\n        this._touching = true;\r\n\r\n        if (e.sys!.touches.length === 2) {\r\n            const t0 = this.touches[0];\r\n            const t1 = this.touches[1];\r\n\r\n            t0.x = (e.sys!.touches.item(0)!.clientX - e.sys!.offsetLeft) * handler.pixelRatio;\r\n            t0.y = (e.sys!.touches.item(0)!.clientY - e.sys!.offsetTop) * handler.pixelRatio;\r\n            t0.prev_x = t0.x;\r\n            t0.prev_y = t0.y;\r\n\r\n            t0.grabbedPoint = this.planet!.getCartesianFromPixelTerrain(new Vec2(t0.x, t0.y)) || null;\r\n\r\n            t1.x = (e.sys!.touches.item(1)!.clientX - e.sys!.offsetLeft) * handler.pixelRatio;\r\n            t1.y = (e.sys!.touches.item(1)!.clientY - e.sys!.offsetTop) * handler.pixelRatio;\r\n            t1.prev_x = t1.x;\r\n            t1.prev_y = t1.y;\r\n\r\n            t1.grabbedPoint = this.planet!.getCartesianFromPixelTerrain(new Vec2(t1.x, t1.y)) || null;\r\n\r\n            this.pointOnEarth = this.planet!.getCartesianFromPixelTerrain(\r\n                this.renderer!.handler.getCenter()\r\n            ) || null;\r\n\r\n            if (this.pointOnEarth) {\r\n                this.earthUp = this.pointOnEarth.normal();\r\n            }\r\n\r\n            if (t0.grabbedPoint && t1.grabbedPoint) {\r\n                t0.grabbedSpheroid.radius = t0.grabbedPoint.length();\r\n                t1.grabbedSpheroid.radius = t1.grabbedPoint.length();\r\n                this.stopRotation();\r\n            }\r\n        } else if (e.sys!.touches.length === 1) {\r\n            this._startTouchOne(e);\r\n        }\r\n    }\r\n\r\n    protected _startTouchOne(e: ITouchState) {\r\n        const t = this.touches[0];\r\n        const handler = this.renderer!.handler;\r\n\r\n        t.x = (e.sys!.touches.item(0)!.clientX - e.sys!.offsetLeft) * handler.pixelRatio;\r\n        t.y = (e.sys!.touches.item(0)!.clientY - e.sys!.offsetTop) * handler.pixelRatio;\r\n        t.prev_x = t.x;\r\n        t.prev_y = t.y;\r\n\r\n        // t.grabbedPoint = this.planet!.getCartesianFromPixelTerrain(e, true);\r\n        t.grabbedPoint = this.planet!.getCartesianFromPixelTerrain(e) || null;\r\n        this._eye0.copy(this.planet!.camera.eye);\r\n\r\n        if (t.grabbedPoint) {\r\n            t.grabbedSpheroid.radius = t.grabbedPoint.length();\r\n            this.stopRotation();\r\n        }\r\n    }\r\n\r\n    public stopRotation() {\r\n        this.qRot.clear();\r\n        this.planet!.layerLock.free(this._keyLock);\r\n        this.planet!.terrainLock.free(this._keyLock);\r\n        this.planet!._normalMapCreator.free(this._keyLock);\r\n    }\r\n\r\n    protected onDoubleTouch(e: ITouchState) {\r\n\r\n        this.planet!.stopFlying();\r\n        this.stopRotation();\r\n\r\n        const p = this.planet!.getCartesianFromPixelTerrain(e);\r\n        if (p) {\r\n            const g = this.planet!.ellipsoid.cartesianToLonLat(p);\r\n            this.planet!.flyLonLat(\r\n                new LonLat(g.lon, g.lat, this.planet!.camera.eye.distance(p) * 0.57)\r\n            );\r\n        }\r\n    }\r\n\r\n    protected onTouchEnd(e: ITouchState) {\r\n        if (e.sys!.touches.length === 0) {\r\n            this._touching = false;\r\n        }\r\n\r\n        if (e.sys!.touches.length === 1) {\r\n            this._startTouchOne(e);\r\n        }\r\n\r\n        if (\r\n            Math.abs(this.touches[0].x - this.touches[0].prev_x) < 3 &&\r\n            Math.abs(this.touches[0].y - this.touches[0].prev_y) < 3\r\n        ) {\r\n            this.scaleRot = 0;\r\n        }\r\n    }\r\n\r\n    protected onTouchCancel(e: ITouchState) {\r\n    }\r\n\r\n    protected onTouchMove(e: ITouchState) {\r\n        let cam = this.planet!.camera;\r\n        const handler = this.renderer!.handler;\r\n        if (e.sys!.touches.length === 2) {\r\n            this.renderer!.controlsBag.scaleRot = 1;\r\n\r\n            let t0 = this.touches[0],\r\n                t1 = this.touches[1];\r\n\r\n            if (!t0.grabbedPoint || !t1.grabbedPoint) {\r\n                return;\r\n            }\r\n\r\n            this.planet!.stopFlying();\r\n\r\n            t0.prev_x = t0.x;\r\n            t0.prev_y = t0.y;\r\n            t0.x = (e.sys!.touches.item(0)!.clientX - e.sys!.offsetLeft) * handler.pixelRatio;\r\n            t0.y = (e.sys!.touches.item(0)!.clientY - e.sys!.offsetTop) * handler.pixelRatio;\r\n\r\n            t1.prev_x = t1.x;\r\n            t1.prev_y = t1.y;\r\n            t1.x = (e.sys!.touches.item(1)!.clientX - e.sys!.offsetLeft) * handler.pixelRatio;\r\n            t1.y = (e.sys!.touches.item(1)!.clientY - e.sys!.offsetTop) * handler.pixelRatio;\r\n\r\n            const middle = t0.vec.add(t1.vec).scale(0.5);\r\n            const earthMiddlePoint = this.planet!.getCartesianFromPixelTerrain(\r\n                middle\r\n            );\r\n            if (earthMiddlePoint) {\r\n                this.pointOnEarth = earthMiddlePoint\r\n\r\n                const prevAngle = Math.atan2(t0.prev_y - t1.prev_y, t0.prev_x - t1.prev_x)\r\n                const curAngle = Math.atan2(t0.y - t1.y, t0.x - t1.x)\r\n\r\n                const deltaAngle = curAngle - prevAngle;\r\n                const distanceToPointOnEarth = cam.eye.distance(this.pointOnEarth);\r\n\r\n                const zoomCur = t0.vec.sub(t1.vec);\r\n                const zoomPrev = t0.vecPrev.sub(t1.vecPrev);\r\n                const scale = zoomCur.length() / zoomPrev.length();\r\n\r\n                let d = distanceToPointOnEarth * -(1 - scale);\r\n                cam.eye.addA(cam.getForward().scale(d));\r\n                cam.rotateAround(-deltaAngle, false, this.pointOnEarth, this.earthUp!);\r\n\r\n                const panCur = t0.vec.add(t1.vec).scale(0.5);\r\n                const panPrev = t0.vecPrev.add(t1.vecPrev).scale(0.5);\r\n                const panOffset = panCur.sub(panPrev).scale(-1);\r\n                var l = 0.5 / distanceToPointOnEarth * cam._lonLat.height * math.RADIANS;\r\n                if (l > 0.003) l = 0.003;\r\n                cam.rotateHorizontal(l * -panOffset.x, false, this.pointOnEarth, this.earthUp!);\r\n                cam.rotateVertical(l * -panOffset.y, this.pointOnEarth);\r\n\r\n                cam.checkTerrainCollision();\r\n                cam.update();\r\n            }\r\n            this.scaleRot = 0;\r\n        } else if (e.sys!.touches.length === 1) {\r\n            let t = this.touches[0];\r\n\r\n            t.prev_x = t.x;\r\n            t.prev_y = t.y;\r\n            t.x = (e.sys!.touches.item(0)!.clientX - e.sys!.offsetLeft) * handler.pixelRatio;\r\n            t.y = (e.sys!.touches.item(0)!.clientY - e.sys!.offsetTop) * handler.pixelRatio;\r\n\r\n            if (!t.grabbedPoint) {\r\n                return;\r\n            }\r\n\r\n            this.planet!.stopFlying();\r\n\r\n            let direction = e.direction\r\n            let targetPoint = new Ray(cam.eye, direction).hitSphere(t.grabbedSpheroid);\r\n\r\n            if (targetPoint) {\r\n                if (cam.slope > 0.2) {\r\n                    this.qRot = Quat.getRotationBetweenVectors(\r\n                        targetPoint.normal(),\r\n                        t.grabbedPoint.normal()\r\n                    );\r\n                    let rot = this.qRot;\r\n                    cam.eye = rot.mulVec3(cam.eye);\r\n                    cam.rotate(rot);\r\n                    // cam._r = rot.mulVec3(cam._r);\r\n                    // cam._u = rot.mulVec3(cam._u);\r\n                    // cam._b = rot.mulVec3(cam._b);\r\n                    cam.checkTerrainCollision();\r\n                    cam.update();\r\n                    this.scaleRot = 1;\r\n                } else {\r\n                    let p0 = t.grabbedPoint,\r\n                        p1 = Vec3.add(p0, cam.getUp()),\r\n                        p2 = Vec3.add(p0, p0.getNormal());\r\n                    let dir = cam.unproject(t.x, t.y);\r\n                    let px = new Vec3();\r\n                    if (new Ray(cam.eye, dir).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n                        cam.eye = this._eye0.addA(px.subA(p0).negate());\r\n                        cam.checkTerrainCollision();\r\n                        cam.update();\r\n                        this.scaleRot = 0;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onDraw() {\r\n\r\n        const r = this.renderer!;\r\n\r\n        r.controlsBag.scaleRot = this.scaleRot;\r\n\r\n        if (this._touching) {\r\n            return;\r\n        }\r\n\r\n        let cam = this.planet!.camera;\r\n        let prevEye = cam.eye.clone();\r\n\r\n        if (r.events.mouseState.leftButtonDown || !this.scaleRot) {\r\n            return;\r\n        }\r\n\r\n        this.scaleRot -= this.inertia;\r\n        if (this.scaleRot <= 0) {\r\n            this.scaleRot = 0;\r\n        } else {\r\n            r.controlsBag.scaleRot = this.scaleRot;\r\n            let rot = this.qRot\r\n                .slerp(Quat.IDENTITY, 1 - this.scaleRot * this.scaleRot * this.scaleRot)\r\n                .normalize();\r\n            if (!(rot.x || rot.y || rot.z)) {\r\n                this.scaleRot = 0;\r\n            }\r\n            cam.eye = rot.mulVec3(cam.eye);\r\n            cam.rotate(rot);\r\n            // cam._r = rot.mulVec3(cam._r);\r\n            // cam._u = rot.mulVec3(cam._u);\r\n            // cam._b = rot.mulVec3(cam._b);\r\n            cam.checkTerrainCollision();\r\n            cam.update();\r\n        }\r\n\r\n        if (cam.eye.distance(prevEye) / cam.getAltitude() > 0.01) {\r\n            this.planet!.layerLock.lock(this._keyLock);\r\n            this.planet!.terrainLock.lock(this._keyLock);\r\n            this.planet!._normalMapCreator.lock(this._keyLock);\r\n        } else {\r\n            this.planet!.layerLock.free(this._keyLock);\r\n            this.planet!.terrainLock.free(this._keyLock);\r\n            this.planet!._normalMapCreator.free(this._keyLock);\r\n        }\r\n    }\r\n}\r\n","import {Key} from \"../Lock\";\r\nimport {Button} from \"../ui/Button\";\r\nimport {Control} from \"./Control\";\r\nimport type {IControlParams} from \"./Control\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {Vec2} from \"../math/Vec2\";\r\n\r\nconst ICON_PLUS_SVG = '<?xml version=\"1.0\"?>' +\r\n    '<svg width=24 height=24 xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">' +\r\n    '    <path d=\"M 11 5 L 11 11 L 5 11 L 5 13 L 11 13 L 11 19 L 13 19 L 13 13 L 19 13 L 19 11 L 13 11 L 13 5 L 11 5 z\"/>' +\r\n    '</svg>';\r\n\r\nconst ICON_MINUS_SVG = '<?xml version=\"1.0\"?>' +\r\n    '<svg width=24 height=24 xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">' +\r\n    '    <path d=\"M 5 11 L 5 13 L 19 13 L 19 11 L 5 11 z\"/>' +\r\n    '</svg>';\r\n\r\n/**\r\n * Planet zoom buttons control.\r\n */\r\nclass ZoomControl extends Control {\r\n    protected _keyLock: Key;\r\n    protected _move: number;\r\n    protected _targetPoint: Vec2 | null;\r\n\r\n    constructor(options: IControlParams = {}) {\r\n        super(options);\r\n        this._keyLock = new Key();\r\n        this._move = 0;\r\n        this._targetPoint = null;\r\n    }\r\n\r\n    public override oninit() {\r\n\r\n        let zoomInBtn = new Button({\r\n            classList: [\"og-map-button\", \"og-zoomin-button\"],\r\n            icon: ICON_PLUS_SVG\r\n        });\r\n        zoomInBtn.appendTo(this.renderer!.div!);\r\n\r\n\r\n        let zoomOutBtn = new Button({\r\n            classList: [\"og-map-button\", \"og-zoomout-button\"],\r\n            icon: ICON_MINUS_SVG\r\n        });\r\n        zoomOutBtn.appendTo(this.renderer!.div!);\r\n\r\n        zoomInBtn.events.on(\"mousedown\", () => this.zoomIn());\r\n        zoomInBtn.events.on(\"mouseup\", () => this.stopZoom());\r\n        zoomOutBtn.events.on(\"mousedown\", () => this.zoomOut());\r\n        zoomOutBtn.events.on(\"mouseup\", () => this.stopZoom());\r\n        zoomInBtn.events.on(\"touchstart\", () => this.zoomIn());\r\n        zoomInBtn.events.on(\"touchend\", () => this.stopZoom());\r\n        zoomInBtn.events.on(\"touchcancel\", () => this.stopZoom());\r\n        zoomOutBtn.events.on(\"touchstart\", () => this.zoomOut());\r\n        zoomOutBtn.events.on(\"touchend\", () => this.stopZoom());\r\n        zoomOutBtn.events.on(\"touchcancel\", () => this.stopZoom());\r\n\r\n        this.renderer!.events.on(\"draw\", this._draw, this);\r\n    }\r\n\r\n    /**\r\n     * Planet zoom in.\r\n     * @public\r\n     */\r\n    public zoomIn() {\r\n        this.planet!.layerLock.lock(this._keyLock);\r\n        this.planet!.terrainLock.lock(this._keyLock);\r\n        this.planet!._normalMapCreator.lock(this._keyLock);\r\n\r\n        this._targetPoint = this.renderer!.getCenter();\r\n\r\n        this._move = 1;\r\n    }\r\n\r\n    /**\r\n     * Planet zoom out.\r\n     * @public\r\n     */\r\n    zoomOut() {\r\n        this.planet!.layerLock.lock(this._keyLock);\r\n        this.planet!.terrainLock.lock(this._keyLock);\r\n        this.planet!._normalMapCreator.lock(this._keyLock);\r\n\r\n        this._targetPoint = this.renderer!.getCenter();\r\n        this._move = -1;\r\n    }\r\n\r\n    public stopZoom() {\r\n        this._move = 0;\r\n\r\n        this.planet!.layerLock.free(this._keyLock);\r\n        this.planet!.terrainLock.free(this._keyLock);\r\n        this.planet!._normalMapCreator.free(this._keyLock);\r\n    }\r\n\r\n    protected _draw(e: Renderer) {\r\n        const cam = this.planet!.camera;\r\n\r\n        if (this._move !== 0) {\r\n            const pos = this.planet!.getCartesianFromPixelTerrain(e.getCenter());\r\n            if (pos) {\r\n                let d = cam.eye.distance(pos) * 0.035;\r\n                cam.eye.addA(cam.getForward().scale(this._move * d));\r\n                cam.checkTerrainCollision();\r\n                cam.update();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {ZoomControl};\r\n","import { Entity } from '../../entity/Entity';\r\nimport { Events } from '../../Events';\r\nimport { Vector } from '../../layer/Vector';\r\nimport { LonLat } from '../../LonLat';\r\nimport { Object3d } from '../../Object3d';\r\nimport { RenderNode } from '../../scene/RenderNode';\r\n\r\nconst OUTLINE_COUNT = 120;\r\n\r\nconst MAX_SCALE = 0.005;\r\nconst MIN_SCALE = 0.001;\r\nconst MAX_SCALE_HEIGHT = 3000.0;\r\nconst MIN_SCALE_HEIGHT = 19000000.0;\r\n\r\nfunction distanceFormat(v: number) {\r\n    if (v > 1000) {\r\n        return `${(v / 1000).toFixed(1)} km`;\r\n    } else if (v > 9) {\r\n        return `${Math.round(v)} m`;\r\n    } else {\r\n        return `${v.toFixed(1)} m`;\r\n    }\r\n}\r\n\r\nclass SelectionScene extends RenderNode {\r\n    events: Events<string[]>;\r\n    _ignoreTerrain = false;\r\n    _onSelect: any;\r\n    _autoSelectionHide: any;\r\n    _planet: any;\r\n    _startLonLat: any;\r\n    _heading: number;\r\n    _propsLabel: Entity;\r\n    _trackEntity: Entity;\r\n    _cornerEntity: Entity[];\r\n    _trackLayer: Vector;\r\n    _cornersLayer: Vector;\r\n    _onMouseMove_: any;\r\n    _onMouseLdown_: any;\r\n    _onMouseLup_: any;\r\n    _pickedCorner: any;\r\n    _anchorLonLat: any;\r\n    constructor(options: { name?: string, ignoreTerrain?: boolean, onSelect?: any, autoSelectionHide?: boolean, planet?: any } = {}) {\r\n        super(options.name);\r\n\r\n        this.events = new Events(EVENT_NAMES);\r\n\r\n        this._ignoreTerrain = options.ignoreTerrain != undefined ? options.ignoreTerrain : true;\r\n\r\n        this._onSelect = options.onSelect || null;\r\n\r\n        this._autoSelectionHide = options.autoSelectionHide || false;\r\n\r\n        this._planet = options.planet || null;\r\n\r\n        this._startLonLat = null;\r\n\r\n        this._heading = 0;\r\n\r\n        this._propsLabel = new Entity({\r\n            'name': 'propsLabel',\r\n            'label': {\r\n                text: \"\",\r\n                size: 11,\r\n                color: \"rgba(455,455,455,1.0)\",\r\n                outlineColor: \"rgba(0,0,0,0.34)\",\r\n                outline: 0.23,\r\n                align: \"center\",\r\n                offset: [0, 18]\r\n            }\r\n        } as any);\r\n\r\n        this._propsLabel?.label?.setVisibility(false);\r\n\r\n        this._trackEntity = new Entity({\r\n            polyline: {\r\n                path3v: [],\r\n                thickness: 3.8,\r\n                color: \"rgb(455,455,455)\",\r\n                isClosed: false\r\n            }\r\n        } as any);\r\n\r\n        (this._trackEntity as any).polyline.altitude = 0.01;\r\n\r\n        let obj3d = Object3d.createCylinder(1.1, 0, 2.7, 20, 1, true, false, 0, 0, 0)\r\n\r\n        this._cornerEntity = [\r\n            new Entity({\r\n                geoObject: {\r\n                    scale: 1,\r\n                    instanced: true,\r\n                    tag: \"selection\",\r\n                    color: \"rgb(0,305,0)\",\r\n                    object3d: obj3d\r\n                },\r\n                properties: {\r\n                    name: \"start\"\r\n                }\r\n            } as any),\r\n            new Entity({\r\n                geoObject: {\r\n                    scale: 1,\r\n                    instanced: true,\r\n                    tag: \"selection\",\r\n                    color: \"rgb(455,0,0)\",\r\n                    object3d: obj3d\r\n                },\r\n                properties: {\r\n                    name: \"end\"\r\n                }\r\n            } as any)\r\n        ];\r\n\r\n        this._trackLayer = new Vector(\"track\", {\r\n            entities: [this._trackEntity, this._propsLabel],\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -1.0,\r\n            relativeToGround: true,\r\n            hideInLayerSwitcher: false\r\n        });\r\n\r\n        this._cornersLayer = new Vector(\"corners\", {\r\n            entities: [this._cornerEntity[0], this._cornerEntity[1]],\r\n            pickingEnabled: true,\r\n            hideInLayerSwitcher: true,\r\n            scaleByDistance: [1.0, 4000000, 0.01],\r\n            pickingScale: 2\r\n        });\r\n    }\r\n\r\n    set ignoreTerrain(v: boolean) {\r\n        this._ignoreTerrain = v;\r\n        if (v) {\r\n            //...redraw line\r\n        }\r\n    }\r\n\r\n    bindPlanet(planet: any) {\r\n        this._planet = planet;\r\n    }\r\n\r\n    override init() {\r\n        this._activate();\r\n    }\r\n\r\n    override onremove() {\r\n        this._deactivate();\r\n    }\r\n\r\n    _activate() {\r\n        this._propsLabel?.label?.setVisibility(false);\r\n\r\n        this._onMouseMove_ = this._onMouseMove.bind(this);\r\n        this.renderer?.events.on(\"mousemove\", this._onMouseMove_, this);\r\n\r\n        this._onMouseLdown_ = this._onMouseLdown.bind(this);\r\n        this.renderer?.events.on(\"ldown\", this._onMouseLdown_, this);\r\n\r\n        this._onMouseLup_ = this._onMouseLup.bind(this);\r\n        this.renderer?.events.on(\"lup\", this._onMouseLup_, this);\r\n\r\n        this._planet.addLayer(this._trackLayer);\r\n\r\n        this._planet.addLayer(this._cornersLayer);\r\n\r\n    }\r\n\r\n    _deactivate() {\r\n        this._startLonLat = null;\r\n        this._trackLayer.remove();\r\n        this._cornersLayer.remove();\r\n        this.renderer?.events.off(\"mousemove\", this._onMouseMove_);\r\n        this.renderer?.events.off(\"ldown\", this._onMouseLdown_);\r\n        this.renderer?.events.off(\"lup\", this._onMouseLup_);\r\n\r\n        this.clear();\r\n\r\n        this._onMouseMove_ = null;\r\n        this._onMouseLdown_ = null;\r\n        this._onMouseLup_ = null;\r\n    }\r\n\r\n    _onMouseLdown(e: any) {\r\n\r\n        //workaround to show pointer, because ogGrabbingPoiner keep !importanti which override pointer style\r\n        e.renderer.handler.canvas.classList.remove('ogGrabbingPoiner');\r\n\r\n        e.renderer.handler.canvas.style.cursor = 'pointer';\r\n\r\n        if (!this._startLonLat) {\r\n\r\n\r\n            this._propsLabel.label?.setVisibility(false);\r\n\r\n            this._trackEntity.polyline?.setPath3v([]);\r\n\r\n\r\n            this._cornerEntity[0].geoObject?.setVisibility(true);\r\n            this._cornerEntity[1].geoObject?.setVisibility(true);\r\n\r\n            this.renderer?.controls.mouseNavigation?.deactivate();\r\n            this._startLonLat = this._planet.getLonLatFromPixelTerrain(e);\r\n\r\n            let startPos = this._planet.ellipsoid.lonLatToCartesian(this._startLonLat);\r\n            this._cornerEntity[0].setCartesian3v(startPos);\r\n            this._cornerEntity[1].setCartesian3v(startPos);\r\n        }\r\n    }\r\n\r\n    _onMouseLup(e: any) {\r\n        if (this._startLonLat) {\r\n\r\n            this._pickedCorner = null;\r\n            this._anchorLonLat = null;\r\n\r\n            this._propsLabel.label?.setVisibility(true);\r\n\r\n            if (this._onSelect && typeof this._onSelect === 'function') {\r\n                let startLonLat = this._cornerEntity[0].getLonLat();\r\n                let endLonLat = this._cornerEntity[1].getLonLat();\r\n\r\n                let extent = [\r\n                    Math.min(startLonLat.lon, endLonLat.lon),\r\n                    Math.min(startLonLat.lat, endLonLat.lat),\r\n                    Math.max(startLonLat.lon, endLonLat.lon),\r\n                    Math.max(startLonLat.lat, endLonLat.lat)\r\n                ];\r\n                this._onSelect(extent);\r\n            }\r\n\r\n            if (this._autoSelectionHide) {\r\n                this.clear();\r\n            }\r\n\r\n            this._startLonLat = null;\r\n        }\r\n        e.renderer.handler.canvas.style.cursor = 'default';\r\n        this.renderer?.controls.mouseNavigation?.activate();\r\n    }\r\n\r\n    _drawLine(startLonLat: any, endLonLat: any, startPos?: any) {\r\n\r\n        if (!startPos) {\r\n            startPos = this._planet.ellipsoid.lonLatToCartesian(startLonLat);\r\n        }\r\n\r\n        let endPos = this._planet.ellipsoid.lonLatToCartesian(endLonLat);\r\n\r\n        let res = this._planet.ellipsoid.direct(startLonLat, endLonLat);\r\n\r\n        this._heading = res.initialAzimuth;\r\n\r\n        let path = [];\r\n\r\n        this._cornerEntity[0].setCartesian3v(startPos);\r\n        this._cornerEntity[1].setCartesian3v(endPos);\r\n\r\n        let corners = [\r\n            startPos,\r\n            this._planet.ellipsoid.lonLatToCartesian(new LonLat(endLonLat.lon, startLonLat.lat, startLonLat.height)),\r\n            endPos,\r\n            this._planet.ellipsoid.lonLatToCartesian(new LonLat(startLonLat.lon, endLonLat.lat, startLonLat.height)),\r\n            startPos\r\n        ];\r\n\r\n\r\n        path.push(startPos);\r\n\r\n        let createPath = (sideA: any, sideB: any) => {\r\n            let dir = sideB.sub(sideA);\r\n            let dist = dir.length();\r\n            dir.normalize();\r\n\r\n            for (let i = 0; i < OUTLINE_COUNT; i++) {\r\n                let f = dir.scaleTo(i * dist / OUTLINE_COUNT).addA(sideA);\r\n                path.push(f);\r\n            }\r\n        };\r\n\r\n        for (let i = 0; i < corners.length - 1; i++) {\r\n            createPath(corners[i], corners[i + 1]);\r\n        }\r\n\r\n        this._trackEntity.polyline?.setPath3v([path]);\r\n\r\n        if (this._ignoreTerrain) {\r\n            // this._propsLabel.setCartesian3v(path[Math.floor(path.length / 2)]);\r\n            // this._propsLabel.label.setText(`${distanceFormat(length)}, ${Math.round(this._heading)} deg`);\r\n        }\r\n    }\r\n\r\n    _onMouseMove(e: any) {\r\n        if (this._startLonLat) {\r\n            this._propsLabel.label?.setVisibility(true);\r\n            let endLonLat = this._planet.getLonLatFromPixelTerrain(e);\r\n            if (!endLonLat)\r\n                return;\r\n            this._drawLine(this._startLonLat, endLonLat);\r\n        }\r\n    }\r\n\r\n    clear() {\r\n        this._trackEntity.polyline?.clear();\r\n        this._cornerEntity[0].geoObject?.setVisibility(false);\r\n        this._cornerEntity[1].geoObject?.setVisibility(false);\r\n    }\r\n\r\n    override frame() {\r\n        let t = this._trackEntity.polyline?.getPath3v()[0];\r\n        if (t) {\r\n            if (!this._ignoreTerrain) {\r\n                let res = 0;\r\n                for (let i = 0, len = t.length - 1; i < len; i++) {\r\n                    res += (t[i + 1] as any).distance(t[i]);\r\n                }\r\n\r\n                this._propsLabel.setCartesian3v(t[Math.floor(t.length / 2)] as any);\r\n                this._propsLabel.label?.setText(`${distanceFormat(res)}, ${Math.round(this._heading)} deg`);\r\n            }\r\n        }\r\n    }\r\n\r\n    get ellipsoid() {\r\n        return this._planet ? this._planet.ellipsoid : null;\r\n    }\r\n}\r\n\r\nconst EVENT_NAMES = [\r\n    \"add\",\r\n    \"remove\",\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\"\r\n];\r\n\r\nexport { SelectionScene };\r\n","import {Control} from \"../Control\";\r\nimport type {IControlParams} from \"../Control\";\r\nimport {SelectionScene} from \"./SelectionScene\";\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\r\n<svg width=\"800px\" height=\"800px\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\" role=\"img\" class=\"iconify iconify--gis\" preserveAspectRatio=\"xMidYMid meet\"><path d=\"M2.1 0v1.914H0v6h3V3h5.1V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h1.8v1.2h3V0h-4.8zm1.8 7.2v6h3v-6h-3zM0 10.913v6h3v-6H0zM66.9 16.2v6h3v-6h-3zM0 19.914v6h3v-6H0zM66.9 25.2v6h3v-6h-3zM0 28.914v6h3v-6H0zM66.9 34.2v6h3v-6h-3zM0 37.914v6h3v-6H0zM66.9 43.2v6h3v-6h-3zM0 46.914v6h3v-6H0zM66.9 52.2v6h3v-6h-3zM0 55.914v5.191h3.809v-3H3v-2.19H0zm6.809 2.191v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9.648 1.899a2.076 2.076 0 0 0-2.19 2.324l3.137 33.676c.2 1.635 2.135 2.399 3.397 1.34l6.623-5.371l2.969 5.142c1.707 2.958 4.417 3.684 7.375 1.977c2.957-1.708 3.684-4.417 1.976-7.375l-2.959-5.125l7.848-3.008c1.548-.564 1.855-2.62.539-3.611L71.576 60.416a2.073 2.073 0 0 0-1.119-.412z\" fill=\"#000000\"></path></svg>`;\r\n\r\ninterface ISelectionParams extends IControlParams {\r\n    ignoreTerrain?: boolean;\r\n    onSelect?: boolean;\r\n    autoSelectionHide?: boolean\r\n}\r\n\r\n/**\r\n * Activate Selection\r\n * @param {boolean} [options.ignoreTerrain=false].\r\n * @param {function} options.onSelect - callback (extent) => {} where extent is selected extent array [minLon,minLat,maxLon,maxLat]\r\n * @param {boolean} [options.autoSelectionHide=false] - clear selection rectangle  after passing extent to callback\r\n * @example:\r\n * to use bootstrap icons, include\r\n *  <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css\">\r\n *\r\n * new Selection({\r\n *       ignoreTerrain: false,\r\n *       autoSelectionHide:true,\r\n *       onSelect: (extent) => {\r\n *\r\n *           var vectorSource = new ol.source.Vector({\r\n *               format: new GeoJSON(),\r\n *               url: function (extent) {\r\n *                   return 'https://snap.ogs.trieste.it/geoserver/snap/ows?service=WFS&' +\r\n *                           'version=1.1.0&request=GetFeature&typename=snap:all_dataset_segy_view&' +\r\n *                           'outputFormat=application/json&srsname=EPSG:4326&' +\r\n *                           'bbox=' + extent.join(',') + ',EPSG:4326';\r\n *               },\r\n *               strategy: function (extent, resolution) {\r\n *                   if (this.resolution && this.resolution != resolution) {\r\n *                       this.loadedExtentsRtree_.clear();\r\n *                   }\r\n *                   return [extent];\r\n *               }\r\n *           });\r\n *\r\n *           vectorSource.loadFeatures(extent);\r\n *\r\n *           console.log(extent);\r\n *\r\n *       }\r\n *   });\r\n */\r\nexport class Selection extends Control {\r\n    protected _selectorScene: SelectionScene;\r\n    protected _toggleBtn: ToggleButton;\r\n\r\n    constructor(options: ISelectionParams = {}) {\r\n        super(options);\r\n\r\n        this._selectorScene = new SelectionScene({\r\n            name: `selectionScene:${this.__id}`,\r\n            ignoreTerrain: options.ignoreTerrain,\r\n            onSelect: options.onSelect,\r\n            autoSelectionHide: options.autoSelectionHide\r\n        });\r\n\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-selection_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n    }\r\n\r\n    public set ignoreTerrain(v: boolean) {\r\n        this._selectorScene.ignoreTerrain = v;\r\n    }\r\n\r\n    public override oninit() {\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            if (isActive) {\r\n                this.activate();\r\n            } else {\r\n                this.deactivate();\r\n            }\r\n        });\r\n\r\n        this._selectorScene.bindPlanet(this.planet);\r\n    }\r\n\r\n    public override onactivate() {\r\n        this.renderer!.addNode(this._selectorScene);\r\n    }\r\n\r\n    override ondeactivate() {\r\n        this.renderer!.removeNode(this._selectorScene);\r\n    }\r\n}\r\n","import * as math from '../../math';\r\n\r\ntype BaselineType = \"alphabetic\" | \"bottom\" | \"hanging\" | \"ideographic\" | \"middle\" | \"top\";\r\ntype AlignType = \"center\" | \"end\" | \"left\" | \"right\" | \"start\";\r\n\r\nexport function addSeconds(date: Date, seconds: number): Date {\r\n    return new Date(+date + seconds * 1000);\r\n}\r\n\r\nexport function dateToStr(date: Date, showTime: boolean = true, showMilliseconds: boolean = false): string {\r\n\r\n    let month = MONTHS[date.getMonth()],\r\n        day = date.getUTCDate(),\r\n        year = date.getUTCFullYear();\r\n\r\n    if (showTime) {\r\n        let h = date.getUTCHours().toString().padStart(2, '0'),\r\n            m = date.getUTCMinutes().toString().padStart(2, '0'),\r\n            s = date.getUTCSeconds().toString().padStart(2, '0');\r\n\r\n        if (showMilliseconds) {\r\n            let ms = date.getUTCMilliseconds().toString().padStart(3, '0');\r\n            return `${month} ${day} ${year} ${h}:${m}:${s}.${ms}`;\r\n        }\r\n\r\n        return `${month} ${day} ${year} ${h}:${m}:${s}`;\r\n    }\r\n\r\n    return `${month} ${day} ${year}`;\r\n}\r\n\r\nexport function createCanvasHTML(): HTMLCanvasElement {\r\n    return document.createElement(\"canvas\");\r\n}\r\n\r\nexport function getNearestTimeLeft(t: number, div: number): number {\r\n    return t - (t % div);\r\n}\r\n\r\nexport function drawNotch(ctx: CanvasRenderingContext2D, xOffset: number = 0, size: number = 10, thickness: number = 2, color: string = \"white\") {\r\n    ctx.lineWidth = thickness;\r\n    ctx.strokeStyle = color;\r\n    ctx.beginPath();\r\n    ctx.moveTo(xOffset, 0);\r\n    ctx.lineTo(xOffset, size);\r\n    ctx.stroke();\r\n}\r\n\r\nexport function drawText(ctx: CanvasRenderingContext2D, text: string, x: number, y: number, font: string = \"12px Arial\", fillStyle: string = \"black\", align: AlignType = \"left\", baseLine: BaselineType = \"bottom\", rotDeg: number = 0) {\r\n    ctx.save();\r\n    ctx.translate(x, y);\r\n    ctx.rotate(rotDeg * math.RADIANS);\r\n    ctx.fillStyle = fillStyle;\r\n    ctx.textBaseline = baseLine;\r\n    ctx.font = font;\r\n    ctx.textAlign = align;\r\n    ctx.fillText(text, 0, 0);\r\n    ctx.restore();\r\n}\r\n\r\nexport const SCALES: [number, number][] = [\r\n    [0.001, 10],\r\n    [0.002, 10],\r\n    [0.005, 10],\r\n    [0.01, 10],\r\n    [0.02, 10],\r\n    [0.05, 10],\r\n    [0.1, 10],\r\n    [0.25, 10],\r\n    [0.5, 5],\r\n    [1.0, 10],\r\n    [2.0, 10],\r\n    [5.0, 5],\r\n    [10.0, 10],\r\n    [15.0, 15],\r\n    [30.0, 6],\r\n    [60.0, 12], // 1min\r\n    [120.0, 12], // 2min\r\n    [300.0, 5], // 5min\r\n    [600.0, 10], // 10min\r\n    [900.0, 15], // 15min\r\n    [1800.0, 6], // 30min\r\n    [3600.0, 12], // 1hr\r\n    [7200.0, 10], // 2hr\r\n    [14400.0, 4], // 4hr\r\n    [21600.0, 6], // 6hr\r\n    [43200.0, 12], // 12hr\r\n    [86400.0, 24], // 24hr\r\n    [172800.0, 2], // 2days\r\n    [345600.0, 4], // 4days\r\n    [604800.0, 7], // 7days\r\n    [1296000.0, 15], // 15days\r\n    [2592000.0, 5], // 30days\r\n    [5184000.0, 6], // 60days\r\n    [7776000.0, 9], // 90days\r\n    [15552000.0, 18], // 180days\r\n    [31536000.0, 12], // 365days\r\n    [63072000.0, 2], // 2years\r\n    [126144000.0, 4], // 4years\r\n    [157680000.0, 5], // 5years\r\n    [315360000.0, 10], // 10years\r\n    [630720000.0, 2], // 20years\r\n    [1261440000.0, 4], // 40years\r\n    [1576800000.0, 5], // 50years\r\n    [3153600000.0, 10], // 100years\r\n    [6307200000.0, 2], // 200years\r\n    [12614400000.0, 4], // 400years\r\n    [15768000000.0, 5], // 500years\r\n    [31536000000.0, 10], // 1000years\r\n];\r\n\r\nexport function getScale(seconds: number) {\r\n    for (let i = 0, len = SCALES.length; i < len; i++) {\r\n        if (SCALES[i][0] > seconds) {\r\n            return SCALES[i - 1];\r\n        }\r\n    }\r\n}\r\n\r\nexport const MONTHS = [\r\n    \"Jan\",\r\n    \"Feb\",\r\n    \"Mar\",\r\n    \"Apr\",\r\n    \"May\",\r\n    \"Jun\",\r\n    \"Jul\",\r\n    \"Aug\",\r\n    \"Sep\",\r\n    \"Oct\",\r\n    \"Nov\",\r\n    \"Dec\",\r\n];\r\n","import {type EventsHandler, createEvents} from '../../Events';\r\nimport {addSeconds} from \"./timelineUtils\";\r\n\r\ntype TimelineEventsList = [\"change\", \"current\"];\r\n\r\nconst TIMELINE_EVENTS: TimelineEventsList = [\"change\", \"current\"/*, \"tick\"*/];\r\n\r\ninterface ITimelineParams {\r\n    current?: Date;\r\n    rangeStart?: Date;\r\n    rangeEnd?: Date;\r\n    minDate?: Date | null;\r\n    maxDate?: Date | null;\r\n    multiplier?: number\r\n}\r\n\r\nclass TimelineModel {\r\n    public events: EventsHandler<TimelineEventsList>;\r\n    protected _current: Date;\r\n    protected _rangeStart: Date;\r\n    protected _rangeEnd: Date;\r\n    protected _range: number;\r\n    protected _minDate: Date | null;\r\n    protected _maxDate: Date | null;\r\n    protected _requestAnimationFrameId: number;\r\n    protected _prevNow: number;\r\n\r\n    public multiplier: number;\r\n    public dt: number;\r\n\r\n    constructor(options: ITimelineParams = {}) {\r\n\r\n        this.events = createEvents(TIMELINE_EVENTS);\r\n\r\n        this._current = options.current || new Date();\r\n        this._rangeStart = options.rangeStart || new Date();\r\n        this._rangeEnd = options.rangeEnd || addSeconds(this._rangeStart, 3600);\r\n        this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\r\n        this._minDate = options.minDate || null;\r\n        this._maxDate = options.maxDate || null;\r\n\r\n        this.multiplier = options.multiplier != undefined ? options.multiplier : 1.0;\r\n\r\n        this._requestAnimationFrameId = 0;\r\n        this._prevNow = 0;\r\n\r\n        this.dt = 0;\r\n    }\r\n\r\n    public play() {\r\n        if (!this._requestAnimationFrameId) {\r\n            this._prevNow = window.performance.now();\r\n            this._animationFrameCallback();\r\n        }\r\n    }\r\n\r\n    public stop() {\r\n        if (this._requestAnimationFrameId) {\r\n            window.cancelAnimationFrame(this._requestAnimationFrameId);\r\n            this._requestAnimationFrameId = 0;\r\n        }\r\n    }\r\n\r\n    public stopped() {\r\n        return this._requestAnimationFrameId == 0;\r\n    }\r\n\r\n    protected _animationFrameCallback() {\r\n        this._requestAnimationFrameId = window.requestAnimationFrame(() => {\r\n            this._frame();\r\n            this._animationFrameCallback();\r\n        });\r\n    }\r\n\r\n    protected _frame() {\r\n        let now = window.performance.now();\r\n        this.dt = now - this._prevNow;\r\n        this._prevNow = now;\r\n\r\n        this.current = new Date(this.currentTime + this.dt * this.multiplier);\r\n\r\n        // this._events.dispatch(this._events.tick, this._current);\r\n    }\r\n\r\n    public get range(): number {\r\n        return this._range\r\n    }\r\n\r\n    public set(rangeStart: Date, rangeEnd: Date) {\r\n        if (rangeStart !== this._rangeStart || rangeEnd !== this._rangeEnd) {\r\n            this._rangeStart = rangeStart;\r\n            this._rangeEnd = rangeEnd;\r\n            this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\r\n            this.events.dispatch(this.events.change, rangeStart, rangeEnd);\r\n        }\r\n    }\r\n\r\n    public get current(): Date {\r\n        return this._current;\r\n    }\r\n\r\n    public get rangeStart(): Date {\r\n        return this._rangeStart;\r\n    }\r\n\r\n    public get rangeEnd(): Date {\r\n        return this._rangeEnd;\r\n    }\r\n\r\n    public get rangeStartTime(): number {\r\n        return this._rangeStart.getTime();\r\n    }\r\n\r\n    public get rangeEndTime(): number {\r\n        return this._rangeEnd.getTime();\r\n    }\r\n\r\n    public get currentTime(): number {\r\n        return this._current.getTime();\r\n    }\r\n\r\n    public set current(current: Date) {\r\n        if (current !== this._current) {\r\n            if (this._maxDate && current > this._maxDate) {\r\n                this._current = this._maxDate;\r\n            } else if (this._minDate && current < this._minDate) {\r\n                this._current = this._minDate;\r\n            } else {\r\n                this._current = current;\r\n            }\r\n            this.events.dispatch(this.events.current, this._current);\r\n        }\r\n    }\r\n\r\n    public set rangeStart(date: Date) {\r\n        if (date !== this._rangeStart) {\r\n            this._rangeStart = date;\r\n            this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\r\n            this.events.dispatch(this.events.change, date);\r\n        }\r\n    }\r\n\r\n    public set rangeEnd(date: Date) {\r\n        if (date !== this._rangeEnd) {\r\n            this._rangeEnd = date;\r\n            this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\r\n            this.events.dispatch(this.events.change, date);\r\n        }\r\n    }\r\n}\r\n\r\nexport {TimelineModel};\r\n","import type {EventsHandler} from \"../../Events\";\r\nimport {ButtonGroup} from \"../../ui/ButtonGroup\";\r\nimport {View} from '../../ui/View';\r\nimport type {IViewParams, ViewEventsList} from '../../ui/View';\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\nimport {TimelineModel} from './TimelineModel';\r\nimport {\r\n    addSeconds,\r\n    createCanvasHTML,\r\n    dateToStr,\r\n    drawNotch,\r\n    drawText,\r\n    getNearestTimeLeft,\r\n    getScale\r\n} from './timelineUtils';\r\nimport type {MouseEventExt} from \"../../input/MouseHandler\";\r\n\r\ninterface ITimelineViewParams extends IViewParams {\r\n    currentDate?: Date;\r\n    rangeStart?: Date;\r\n    rangeEnd?: Date;\r\n    minDate?: Date;\r\n    maxDate?: Date;\r\n    fillStyle?: string\r\n}\r\n\r\nconst SECONDS_TO_MILLISECONDS = 1000.0;\r\nconst MILLISECONDS_TO_SECONDS = 1.0 / SECONDS_TO_MILLISECONDS;\r\n\r\ntype TimelineViewEventsList = [\r\n    'startdrag',\r\n    'stopdrag',\r\n    'startdragcurrent',\r\n    'stopdragcurrent',\r\n    'setcurrent',\r\n    'reset',\r\n    'play',\r\n    'playback',\r\n    'pause',\r\n    'visibility'\r\n];\r\n\r\nconst TIMELINEVIEW_EVENTS: TimelineViewEventsList = [\r\n    'startdrag',\r\n    'stopdrag',\r\n    'startdragcurrent',\r\n    'stopdragcurrent',\r\n    'setcurrent',\r\n    'reset',\r\n    'play',\r\n    'playback',\r\n    'pause',\r\n    'visibility'\r\n];\r\n\r\nconst ICON_PLAY_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M8 5v14l11-7z\" style=\"fill: black;\"/></svg>';\r\nconst ICON_PAUSE_SVG = '<?xml version=\"1.0\" ?><!DOCTYPE svg  PUBLIC \\'-//W3C//DTD SVG 1.1//EN\\'  \\'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\\'><svg enable-background=\"new 0 0 512 512\" height=\"512px\" version=\"1.1\" viewBox=\"0 0 512 512\" width=\"512px\" xml:space=\"preserve\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><g id=\"Layer_6\"><rect fill=\"#252525\" height=\"320\" width=\"60\" x=\"153\" y=\"96\"/><rect fill=\"#252525\" height=\"320\" width=\"60\" x=\"299\" y=\"96\"/></g></svg>';\r\n\r\nconst SCALE_FILL_COLOR = \"rgba(64, 59, 59, 1.0)\";\r\nconst SCALE_NOTCH_COLOR = \"#bfbfbf\";\r\nconst SCALE_TIME_COLOR = \"#bfbfbf\";\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-timeline\">\r\n\r\n  <div class=\"og-timeline-top\">\r\n  </div>\r\n\r\n  <div class=\"og-timeline-frame\">\r\n    <div class=\"og-timeline-current\">\r\n      <div class=\"og-timeline-current-spin\">\r\n        <div class=\"og-timeline-current-arrow\"></div>\r\n      </div>\r\n    </div>\r\n    <div class=\"og-timeline-scale\"></div>\r\n  </div>\r\n\r\n  <div class=\"og-timeline-bottom\">\r\n    <div class=\"og-timeline-controls\">\r\n    </div>\r\n  </div>\r\n\r\n</div>`;\r\n\r\n\r\nclass TimelineView extends View<TimelineModel> {\r\n\r\n    public override events: EventsHandler<TimelineViewEventsList> & EventsHandler<ViewEventsList>;\r\n    public fillStyle: string;\r\n    public $controls: HTMLElement | null;\r\n    protected _frameEl: HTMLElement | null;\r\n    protected _currentEl: HTMLElement | null;\r\n    protected _canvasEl: HTMLCanvasElement;\r\n    protected _ctx: CanvasRenderingContext2D;\r\n    protected _isMouseOver: boolean;\r\n    protected _isDragging: boolean;\r\n    protected _isCurrentDragging: boolean;\r\n    protected _isCurrentMouseOver: boolean;\r\n    protected _minWidth: number;\r\n    protected _canvasScale: number;\r\n    protected _millisecondsInPixel: number;\r\n    protected _clickPosX: number;\r\n    protected _clickRangeStart: Date;\r\n    protected _clickRangeEnd: Date;\r\n    protected _clickCurrentDate: Date;\r\n    protected _clickTime: number;\r\n    protected _clickDelay: number;\r\n    protected _onResizeObserver_: () => void;\r\n    protected _resizeObserver: ResizeObserver;\r\n    protected _pauseBtn: ToggleButton;\r\n    protected _playBtn: ToggleButton;\r\n    protected _buttons: ButtonGroup;\r\n    protected _visibility: boolean;\r\n\r\n    constructor(options: ITimelineViewParams = {}) {\r\n        super({\r\n            template: TEMPLATE,\r\n            model: new TimelineModel({\r\n                rangeStart: options.rangeStart,\r\n                rangeEnd: options.rangeEnd,\r\n                current: options.currentDate,\r\n                minDate: options.minDate,\r\n                maxDate: options.maxDate\r\n            })\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(TIMELINEVIEW_EVENTS);\r\n\r\n        this.fillStyle = options.fillStyle || SCALE_FILL_COLOR;\r\n\r\n        this.$controls = null;\r\n\r\n        this._frameEl = null;\r\n        this._currentEl = null;\r\n        this._canvasEl = createCanvasHTML();\r\n        this._ctx = this._canvasEl.getContext('2d')!;\r\n\r\n        this._isMouseOver = false;\r\n        this._isDragging = false;\r\n        this._isCurrentDragging = false;\r\n        this._isCurrentMouseOver = false;\r\n\r\n        this._minWidth = 330;\r\n        this._canvasScale = 2;\r\n\r\n        this._millisecondsInPixel = 0;\r\n\r\n        this._clickPosX = 0;\r\n        this._clickRangeStart = new Date();\r\n        this._clickRangeEnd = new Date();\r\n        this._clickCurrentDate = new Date();\r\n\r\n        this._clickTime = 0;\r\n        this._clickDelay = 450;\r\n\r\n        this._onResizeObserver_ = this._onResizeObserver.bind(this);\r\n        this._resizeObserver = new ResizeObserver(this._onResizeObserver_);\r\n\r\n        this._pauseBtn = new ToggleButton({\r\n            classList: [\"og-timeline-control_button\"],\r\n            icon: ICON_PAUSE_SVG,\r\n            name: \"pause\"\r\n        });\r\n\r\n        this._playBtn = new ToggleButton({\r\n            classList: [\"og-timeline-control_button\"],\r\n            icon: ICON_PLAY_SVG,\r\n            name: \"play\"\r\n        });\r\n\r\n        this._buttons = new ButtonGroup({\r\n            buttons: [this._pauseBtn, this._playBtn]\r\n        })\r\n\r\n        this._visibility = false;\r\n    }\r\n\r\n    protected _onResizeObserver() {\r\n        this.resize();\r\n    }\r\n\r\n    public get canvasScale(): number {\r\n        return this._canvasScale;\r\n    }\r\n\r\n    public set canvasScale(scale: number) {\r\n        if (scale !== this._canvasScale) {\r\n            this._canvasScale = scale;\r\n            this.resize();\r\n        }\r\n    }\r\n\r\n    public resize() {\r\n        this._resize();\r\n        this.draw();\r\n    }\r\n\r\n    public override afterRender(parentNode: HTMLElement) {\r\n        this.resize();\r\n    }\r\n\r\n    public override render(): this {\r\n        super.render();\r\n\r\n        this.$controls = this.select(\".og-timeline-controls\");\r\n\r\n        this._frameEl = this.select(\".og-timeline-frame\");\r\n        this._currentEl = this.select(\".og-timeline-current\");\r\n        this.select(\".og-timeline-frame .og-timeline-scale\")!.appendChild(this._canvasEl);\r\n\r\n        this._resizeObserver.observe(this.el!);\r\n\r\n        this.model.events.on(\"change\", () => {\r\n            this.draw()\r\n        });\r\n\r\n        this.model.events.on(\"current\", (d: Date) => {\r\n            this._drawCurrent();\r\n            this.events.dispatch(this.events.setcurrent, d);\r\n        });\r\n\r\n        this._canvasEl.addEventListener(\"mouseenter\", this._onMouseEnter);\r\n        this._canvasEl.addEventListener(\"mouseout\", this._onMouseOut);\r\n\r\n        this._currentEl!.addEventListener(\"mouseenter\", this._onCurrentMouseEnter);\r\n        this._currentEl!.addEventListener(\"mouseout\", this._onCurrentMouseOut);\r\n\r\n        document.body.addEventListener(\"mousemove\", this._onMouseMove);\r\n        document.body.addEventListener(\"mousedown\", this._onMouseDown);\r\n        document.body.addEventListener(\"mouseup\", this._onMouseUp);\r\n        document.body.addEventListener(\"wheel\", this._onMouseWheelFF);\r\n\r\n        this._playBtn.appendTo(this.$controls!);\r\n        this._pauseBtn.appendTo(this.$controls!);\r\n\r\n        if (this.model.stopped()) {\r\n            this._pauseBtn.setActive(true, true);\r\n            this._pauseBtn.preventClick = true;\r\n        } else {\r\n            this._playBtn.setActive(true, true);\r\n            this._playBtn.preventClick = true;\r\n        }\r\n\r\n        this._buttons.events.on(\"change\", (btn: ToggleButton) => {\r\n            switch (btn.name) {\r\n                case \"play\":\r\n                    this.play();\r\n                    break;\r\n                case \"pause\":\r\n                    this.pause();\r\n                    break;\r\n            }\r\n        });\r\n\r\n        // let mltView = new View({\r\n        //     template: `<div class=\"og-timeline-multiplier\">\r\n        //                 <select>\r\n        //                     <option value=\"0.25\">0.25</option>\r\n        //                     <option value=\"0.5\">0.5</option>\r\n        //                     <option value=\"1\" selected>1.0</option>\r\n        //                     <option value=\"2\">2.0</option>\r\n        //                     <option value=\"3\">3.0</option>\r\n        //                     <option value=\"5\">5.0</option>\r\n        //                 </select>\r\n        //                 </div>`\r\n        // });\r\n\r\n        //mltView.appendTo($ctl)\r\n\r\n        // let multiplierEl = this.select(\".og-timeline-multiplier select\");\r\n        //\r\n        // multiplierEl.value = this.model.multiplier.toString();\r\n        // multiplierEl.addEventListener(\"change\", (e) => {\r\n        //     this.model.multiplier = Math.sign(this.model.multiplier) * Number(e.target.value);\r\n        // });\r\n\r\n        this.setVisibility(true);\r\n\r\n        return this;\r\n    }\r\n\r\n    public setVisibility(visibility: boolean) {\r\n        if (visibility !== this._visibility) {\r\n            this._visibility = visibility;\r\n            if (this.el) {\r\n                if (visibility) {\r\n                    this.el.style.display = \"block\";\r\n                } else {\r\n                    this.el.style.display = \"none\";\r\n                }\r\n            }\r\n            this.events.dispatch(this.events.visibility, visibility);\r\n        }\r\n    }\r\n\r\n    public reset() {\r\n        this.model.stop();\r\n        this.events.dispatch(this.events.reset, this.model);\r\n    }\r\n\r\n    public play() {\r\n        this.model.multiplier = Math.abs(this.model.multiplier);\r\n        this.model.play();\r\n        this.events.dispatch(this.events.play, this.model);\r\n    }\r\n\r\n    public pause() {\r\n        this.model.stop();\r\n        this.events.dispatch(this.events.pause, this.model);\r\n    }\r\n\r\n    public playBack() {\r\n        this.model.multiplier = -1 * Math.abs(this.model.multiplier);\r\n        this.model.play();\r\n        this.events.dispatch(this.events.playback, this.model);\r\n    }\r\n\r\n    protected _onMouseWheel = (e: MouseEventExt) => {\r\n        if (this._isMouseOver) {\r\n            let rect = this._canvasEl.getBoundingClientRect();\r\n            let pointerPosX = e.clientX - rect.left,\r\n                pointerCenterOffsetX = -(pointerPosX - this.clientWidth * 0.5);\r\n            let pointerTime = this.model.rangeStartTime + this._millisecondsInPixel * pointerPosX;\r\n            this._zoom(pointerTime, pointerCenterOffsetX, Math.sign(e.wheelDelta!));\r\n        } else if (this._isCurrentMouseOver) {\r\n            let pointerCenterOffsetX = -((this.model.currentTime - this.model.rangeStartTime) / this._millisecondsInPixel - this.clientWidth * 0.5);\r\n            this._zoom(this.model.currentTime, pointerCenterOffsetX, Math.sign(e.wheelDelta!));\r\n        }\r\n    }\r\n\r\n    protected _onMouseWheelFF = (e: MouseEventExt) => {\r\n        this._onMouseWheel(e);\r\n    }\r\n\r\n    protected _zoom(pointerTime: number, pointerCenterOffsetX: number, dir: number) {\r\n        let centerTime = this.model.rangeStartTime + 0.5 * this.model.range;\r\n\r\n        let centerTimeOffset = (pointerTime - centerTime) * MILLISECONDS_TO_SECONDS;\r\n\r\n        let rangeStart = addSeconds(this.model.rangeStart, centerTimeOffset),\r\n            rangeEnd = addSeconds(this.model.rangeEnd, centerTimeOffset);\r\n\r\n        let delta = ((rangeEnd.getTime() - rangeStart.getTime()) / 20) * MILLISECONDS_TO_SECONDS;\r\n\r\n        let newRangeStart = addSeconds(rangeStart, delta * dir);\r\n        let newRangeEnd = addSeconds(rangeEnd, -delta * dir);\r\n        let msPx = (newRangeEnd.getTime() - newRangeStart.getTime()) / this.clientWidth;\r\n\r\n        if (msPx < 31536000000 && msPx > 0.1) {\r\n            let timeOffset = msPx * pointerCenterOffsetX * MILLISECONDS_TO_SECONDS;\r\n\r\n            this.model.set(\r\n                addSeconds(newRangeStart, timeOffset),\r\n                addSeconds(newRangeEnd, timeOffset)\r\n            );\r\n        }\r\n    }\r\n\r\n    protected _onMouseDown = (e: MouseEvent) => {\r\n        if (this._isMouseOver) {\r\n            this._isDragging = true;\r\n            document.body.classList.add(\"og-timeline-unselectable\");\r\n\r\n            this._clickPosX = e.clientX;\r\n            this._clickTime = Date.now();\r\n\r\n            this._clickRangeStart = this.model.rangeStart;\r\n            this._clickRangeEnd = this.model.rangeEnd;\r\n\r\n            this.events.dispatch(this.events.startdrag, e);\r\n        } else if (this._isCurrentMouseOver) {\r\n            this._isCurrentDragging = true;\r\n            document.body.classList.add(\"og-timeline-unselectable\");\r\n\r\n            this._clickPosX = e.clientX;\r\n\r\n            this._clickCurrentDate = this.model.current;\r\n\r\n            this.events.dispatch(this.events.startdragcurrent, e);\r\n        }\r\n    }\r\n\r\n    protected _onMouseUp = (e: MouseEvent) => {\r\n        if (this._isDragging) {\r\n            this._isDragging = false;\r\n            document.body.classList.remove(\"og-timeline-unselectable\");\r\n            if (this._clickPosX === e.clientX && (Date.now() - this._clickTime) < this._clickDelay) {\r\n                let rect = this._canvasEl.getBoundingClientRect();\r\n                let current = new Date(this.model.rangeStartTime + (e.clientX - rect.left) * this._millisecondsInPixel);\r\n                this.model.current = current;\r\n                this.events.dispatch(this.events.stopdrag, current);\r\n                this.events.dispatch(this.events.setcurrent, current);\r\n            } else {\r\n                this.events.dispatch(this.events.stopdrag, this.model.current);\r\n            }\r\n        } else if (this._isCurrentDragging) {\r\n            this._isCurrentDragging = false;\r\n            document.body.classList.remove(\"og-timeline-unselectable\");\r\n            this.events.dispatch(this.events.stopdragcurrent, this.model.current);\r\n        }\r\n    }\r\n\r\n    protected _onMouseEnter = () => {\r\n        this._isMouseOver = true;\r\n    }\r\n\r\n    protected _onMouseOut = () => {\r\n        this._isMouseOver = false;\r\n    }\r\n\r\n    protected _onCurrentMouseEnter = () => {\r\n        this._isCurrentMouseOver = true;\r\n    }\r\n\r\n    protected _onCurrentMouseOut = () => {\r\n        this._isCurrentMouseOver = false;\r\n    }\r\n\r\n    protected _onMouseMove = (e: MouseEvent) => {\r\n        if (this._isDragging) {\r\n            let offsetSec = (this._clickPosX - e.clientX) * this._millisecondsInPixel * MILLISECONDS_TO_SECONDS;\r\n            this.model.set(addSeconds(this._clickRangeStart, offsetSec), addSeconds(this._clickRangeEnd, offsetSec))\r\n        } else if (this._isCurrentDragging) {\r\n            let offsetSec = (this._clickPosX - e.clientX) * this._millisecondsInPixel * MILLISECONDS_TO_SECONDS;\r\n            let newCurrent = addSeconds(this._clickCurrentDate, -offsetSec);\r\n            if (newCurrent >= this.model.rangeStart && newCurrent <= this.model.rangeEnd) {\r\n                this.model.current = addSeconds(this._clickCurrentDate, -offsetSec);\r\n            }\r\n        }\r\n    }\r\n\r\n    public get clientWidth(): number {\r\n        return this._canvasEl ? this._canvasEl.width / this._canvasScale : 0;\r\n    }\r\n\r\n    public get clientHeight(): number {\r\n        return this._canvasEl ? this._canvasEl.height / this._canvasScale : 0;\r\n    }\r\n\r\n    protected _resize() {\r\n        if (this._frameEl) {\r\n            this._canvasEl.width = this._frameEl.clientWidth * this._canvasScale;\r\n            this._canvasEl.height = this._frameEl.clientHeight * this._canvasScale;\r\n            this._canvasEl.style.width = `${this._frameEl.clientWidth}px`;\r\n            this._canvasEl.style.height = `${this._frameEl.clientHeight}px`;\r\n        }\r\n    }\r\n\r\n    public getOffsetByTime(milliseconds: number): number {\r\n        return (milliseconds - this.model.rangeStartTime) / this._millisecondsInPixel;\r\n    }\r\n\r\n    public override remove() {\r\n        super.remove();\r\n        this.model.stop();\r\n    }\r\n\r\n    protected _clearCanvas() {\r\n        this._ctx.fillStyle = this.fillStyle;\r\n        this._ctx.fillRect(0, 0, this.clientWidth * this._canvasScale, this.clientHeight * this._canvasScale);\r\n    }\r\n\r\n    protected _drawCurrent() {\r\n        let curPosX = (this.model.currentTime - this.model.rangeStartTime) / this._millisecondsInPixel;\r\n        if (this.model.current < this.model.rangeStart || this.model.current > this.model.rangeEnd) {\r\n            this._currentEl!.style.display = \"none\";\r\n        } else {\r\n            this._currentEl!.style.display = \"block\";\r\n            this._currentEl!.style.transform = `translateX(${curPosX}px)`;\r\n        }\r\n    }\r\n\r\n    public draw() {\r\n        this._millisecondsInPixel = (this.model.range / this.clientWidth);\r\n        let minWidthMs = this._minWidth * this._millisecondsInPixel;\r\n        let scaleData = getScale(minWidthMs * MILLISECONDS_TO_SECONDS);\r\n        if (scaleData) {\r\n\r\n            this._clearCanvas();\r\n\r\n            let scaleMs = scaleData[0] * SECONDS_TO_MILLISECONDS,\r\n                scalePx = scaleMs / this._millisecondsInPixel,\r\n                segCount = scaleData[1];\r\n\r\n            let originTime = getNearestTimeLeft(this.model.rangeStartTime, scaleMs);\r\n\r\n            let showMilliseconds = scaleData[0] < 1.0,\r\n                showTime = scaleData[0] < 86400.0;\r\n\r\n            for (let i = originTime, rangeEnd = this.model.rangeEndTime + scaleMs; i < rangeEnd; i += scaleMs) {\r\n                let x = this.getOffsetByTime(i);\r\n                if (x >= 0 && x <= this.clientWidth * this._canvasScale) {\r\n                    drawNotch(this._ctx, x * this._canvasScale, 10 * this._canvasScale, 2 * this._canvasScale, SCALE_NOTCH_COLOR);\r\n                }\r\n                for (let j = 1; j < segCount; j++) {\r\n                    let xx = x + j * (scalePx / segCount);\r\n                    if (xx >= 0 && xx <= this.clientWidth * this._canvasScale) {\r\n                        drawNotch(this._ctx, xx * this._canvasScale, 5 * this._canvasScale, 1 * this._canvasScale, SCALE_NOTCH_COLOR);\r\n                    }\r\n                }\r\n                drawText(this._ctx, dateToStr(new Date(i), showTime, showMilliseconds), x * this._canvasScale, 26 * this._canvasScale, \"24px monospace\", SCALE_TIME_COLOR, \"center\");\r\n            }\r\n\r\n            this._drawCurrent();\r\n        }\r\n    }\r\n}\r\n\r\nexport {TimelineView};\r\n\r\n","import {Dialog} from \"../../ui/Dialog\";\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\nimport {Control, type IControlParams} from '../Control';\r\nimport {TimelineView} from './TimelineView';\r\n\r\ninterface ITimelineControlParams extends IControlParams {\r\n    name?: string;\r\n    current?: Date;\r\n    rangeStart?: Date;\r\n    rangeEnd?: Date;\r\n}\r\n\r\nfunction addHours(date: Date, hours: number): Date {\r\n    const temp = new Date(date);\r\n    temp.setHours(temp.getHours() + hours);\r\n    return temp;\r\n}\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->\r\n    <!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\r\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 1000 1000\" enable-background=\"new 0 0 1000 1000\" xml:space=\"preserve\">\r\n    <metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\r\n    <g><path d=\"M500,10C229.4,10,10,229.4,10,500s219.4,490,490,490s490-219.4,490-490S770.6,10,500,10z M800.3,800.3c-39,39-84.5,69.7-135,91C613,913.5,557.4,924.7,500,924.7s-112.9-11.2-165.3-33.3c-50.5-21.3-95.9-52-135-91c-39-39-69.7-84.5-91-135C86.5,612.9,75.3,557.4,75.3,500s11.2-112.9,33.3-165.3c21.3-50.5,52-95.9,91-135c39-39,84.5-69.7,135-91C387.1,86.5,442.6,75.3,500,75.3s112.9,11.2,165.3,33.3c50.5,21.3,95.9,52,135,91c39,39,69.7,84.5,91,135c22.1,52.3,33.3,107.9,33.3,165.3s-11.2,112.9-33.3,165.3C869.9,715.8,839.3,761.2,800.3,800.3z\"/><path d=\"M761.3,532.7H532.7V304c0-18.1-14.6-32.7-32.7-32.7s-32.7,14.6-32.7,32.7v261.3l0,0c0,18.1,14.6,32.7,32.7,32.7h261.3c18.1,0,32.7-14.6,32.7-32.7l0,0C794,547.3,779.4,532.7,761.3,532.7z\"/></g>\r\n</svg>`;\r\n\r\nclass TimelineControl extends Control {\r\n    protected _timelineView: TimelineView;\r\n    protected _toggleBtn: ToggleButton;\r\n    protected _dialog: Dialog<null>;\r\n\r\n    constructor(options: ITimelineControlParams = {}) {\r\n        super({\r\n            name: \"timeline\",\r\n            ...options\r\n        });\r\n\r\n        let currentDate = options.current || new Date();\r\n        let startDate = options.rangeStart || addHours(currentDate, -12);\r\n        let endDate = options.rangeEnd || addHours(currentDate, 12);\r\n\r\n        this._timelineView = new TimelineView({\r\n            rangeStart: startDate,\r\n            rangeEnd: endDate,\r\n            currentDate: currentDate\r\n        });\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-timeline_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        this._dialog = new Dialog({\r\n            title: \"Timeline\",\r\n            visible: false,\r\n            resizable: true,\r\n            useHide: true,\r\n            top: 10,\r\n            left: 60,\r\n            width: 600,\r\n            height: 115,\r\n            minHeight: 115,\r\n            maxHeight: 110\r\n        });\r\n\r\n        this._dialog.events.on(\"visibility\", (v: boolean) => {\r\n            this._toggleBtn.setActive(v);\r\n        });\r\n    }\r\n\r\n    public override oninit() {\r\n\r\n        let $container = this.renderer!.div!;\r\n\r\n        this._toggleBtn.appendTo($container);\r\n        this._dialog.appendTo($container);\r\n\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this._dialog.setVisibility(isActive);\r\n            if (isActive) {\r\n                this._timelineView.resize();\r\n            }\r\n        });\r\n\r\n        this._timelineView.appendTo(this._dialog.container!);\r\n\r\n        this._timelineView.events.on(\"setcurrent\", (d: Date) => {\r\n            this.renderer && this.renderer.handler.defaultClock.setDate(d);\r\n        });\r\n\r\n        this._timelineView.events.on(\"startdrag\", () => {\r\n            this.planet?.sun!.stop();\r\n            this.renderer && this.renderer.controls.mouseNavigation.deactivate();\r\n        });\r\n\r\n        this._timelineView.events.on(\"stopdrag\", () => {\r\n            this.renderer && this.renderer.controls.mouseNavigation.activate();\r\n        });\r\n\r\n        this._timelineView.events.on(\"startdragcurrent\", () => {\r\n            this.planet?.sun!.stop();\r\n            this.renderer && this.renderer.controls.mouseNavigation.deactivate();\r\n        });\r\n\r\n        this._timelineView.events.on(\"stopdragcurrent\", () => {\r\n            this.renderer && this.renderer.controls.mouseNavigation.activate();\r\n        });\r\n    }\r\n}\r\n\r\nexport {TimelineControl};\r\n","export class Deferred<T> {\r\n    resolve: ((value: T | PromiseLike<T>) => void);\r\n    reject: ((reason?: any) => void);\r\n    promise: Promise<T>;\r\n\r\n    constructor() {\r\n        this.resolve = () => {\r\n        };\r\n        this.reject = () => {\r\n        };\r\n        this.promise = new Promise<T>((resolve: (value: T | PromiseLike<T>) => void, reject: (reason?: any) => void) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n        Object.freeze(this);\r\n    }\r\n}","import {Deferred} from '../../Deferred';\r\nimport {createEvents, type EventsHandler} from '../../Events';\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {LonLat} from \"../../LonLat\";\r\n\r\nconst DEFAULT_WARNING_HEIGHT_LEVEL = 5;\r\n\r\nexport interface ElevationProfileParams {\r\n    planet?: Planet\r\n}\r\n\r\nexport interface IProfileData {\r\n    dist: number;\r\n    minY: number;\r\n    maxY: number;\r\n    trackCoords: TrackItem[];\r\n    groundCoords: GroundItem[];\r\n}\r\n\r\nexport type ElevationProfileDrawData = [TrackItem[], GroundItem[]];\r\n\r\ntype ElevationProfileEventsList = [\"startcollecting\", \"profilecollected\", \"clear\"];\r\n\r\nconst ELEVATIONPROFILE_EVENTS: ElevationProfileEventsList = [\"startcollecting\", \"profilecollected\", \"clear\"];\r\n\r\n/**\r\n * Point types\r\n */\r\nexport const SAFE = 0;\r\nexport const WARNING = 1;\r\nexport const COLLISION = 2;\r\n\r\n/**\r\n * drawData index names\r\n */\r\nconst TRACK = 0;\r\nconst GROUND = 1;\r\n\r\nconst SEGMMENT_LENGTH = 1.0; // Distance between query points on the ground\r\nconst GROUND_OFFSET = 1.0; // Ground level offset\r\nconst BOTTOM_PADDING = 0.1; // Range minY padding in percentage from the bottom\r\nconst TOP_PADDING = 0.2; // Range maxY padding in percentage from the top\r\nconst HEIGHT_EPS = 0.1; // Warning height level error\r\n\r\ntype WarningLevel = typeof SAFE | typeof WARNING | typeof COLLISION;\r\n/**\r\n * 0 - distance, 1 - elevation, 2 - related ground point index\r\n */\r\nexport type TrackItem = [number, number, number];\r\n/**\r\n * 0 - distance, 1 - elevation, 2 - warning level, 3 - ..., 4 - related track point index\r\n */\r\nexport type GroundItem = [number, number, WarningLevel, number, number];\r\n\r\nexport class ElevationProfile {\r\n    public events: EventsHandler<ElevationProfileEventsList>;\r\n    public planet: Planet | null;\r\n    protected _warningHeightLevel: number;\r\n    protected _pointsReady: boolean;\r\n    protected _isWarning: boolean;\r\n\r\n    protected _planeDistance: number;\r\n    protected _minX: number;\r\n    protected _maxX: number;\r\n    protected _minY: number;\r\n    protected _maxY: number;\r\n    protected _drawData: ElevationProfileDrawData;\r\n    protected _promiseArr: Promise<void | number>[];\r\n    protected _promiseCounter: number;\r\n    protected _pMaxY: number;\r\n    protected _pMinY: number;\r\n    protected _pDist: number;\r\n    protected _pTrackCoords: TrackItem[];\r\n    protected _pGroundCoords: GroundItem[];\r\n    protected _pIndex: number;\r\n\r\n    constructor(options: ElevationProfileParams = {}) {\r\n        this.events = createEvents(ELEVATIONPROFILE_EVENTS);\r\n\r\n        this.planet = options.planet || null;\r\n\r\n        this._warningHeightLevel = DEFAULT_WARNING_HEIGHT_LEVEL;\r\n        this._pointsReady = false;\r\n        this._isWarning = false;\r\n\r\n        this._minX = 0;\r\n        this._planeDistance = this._maxX = 1000;\r\n        this._minY = 0;\r\n        this._maxY = 200;\r\n\r\n        this._drawData = [[], []];\r\n\r\n        this._promiseArr = [];\r\n        this._promiseCounter = 0;\r\n        this._pMaxY = 0;\r\n        this._pMinY = 0;\r\n        this._pDist = 0;\r\n        this._pTrackCoords = [];\r\n        this._pGroundCoords = [];\r\n\r\n        this._pIndex = 0;\r\n    }\r\n\r\n    public bindPlanet(planet: Planet) {\r\n        this.planet = planet;\r\n    }\r\n\r\n    public setWarningHeightLevel(warningHeight: number = 0) {\r\n        this._warningHeightLevel = warningHeight;\r\n    }\r\n\r\n    public setRange(minX: number, maxX: number, minY?: number, maxY?: number) {\r\n        this._minX = minX;\r\n        this._maxX = maxX;\r\n        if (minY) {\r\n            this._minY = minY;\r\n        }\r\n        if (maxY) {\r\n            this._maxY = maxY;\r\n        }\r\n    }\r\n\r\n    protected _getHeightAsync(ll: LonLat, pIndex: number, promiseCounter: number): Promise<number> {\r\n        let def = new Deferred<number>();\r\n        if (this.planet) {\r\n            let msl = this.planet.terrain!.geoid.getHeightLonLat(ll);\r\n            this.planet.terrain!.getHeightAsync(ll, (elv: number) => {\r\n                if (this.planet && promiseCounter === this._promiseCounter) {\r\n                    elv += msl;\r\n                    this._pGroundCoords[pIndex][1] = elv;\r\n                    this._pGroundCoords[pIndex][2] = SAFE;\r\n                    this._pGroundCoords[pIndex][3] = ll.height;\r\n                    if (elv > this._pMaxY) this._pMaxY = elv;\r\n                    if (elv < this._pMinY) this._pMinY = elv;\r\n                    this._updatePointType(pIndex);\r\n                    def.resolve(elv);\r\n                } else {\r\n                    def.reject();\r\n                }\r\n            });\r\n        } else {\r\n            def.reject();\r\n        }\r\n        return def.promise;\r\n    }\r\n\r\n    protected _collectCoordsBetweenTwoTrackPoints(index: number, internalPoints: number, scaleFactor: number, p0: Vec3, trackDir: Vec3, promiseCounter: number) {\r\n\r\n        if (!this.planet) return;\r\n\r\n        for (let j = 1; j <= internalPoints; j++) {\r\n            this._pDist += SEGMMENT_LENGTH;\r\n            this._pIndex++;\r\n\r\n            // Point on the track segment\r\n            let dirSegLen = j * scaleFactor;\r\n            let pjd = p0.add(trackDir.scaleTo(dirSegLen));\r\n            let llx = this.planet.ellipsoid.cartesianToLonLat(pjd);\r\n\r\n            this._pGroundCoords[this._pIndex] = [this._pDist, 0, SAFE, 0, index];\r\n\r\n            ((lonlat: LonLat, index: number) => {\r\n                this._promiseArr.push(this._getHeightAsync(lonlat, index, promiseCounter));\r\n            })(llx, this._pIndex);\r\n        }\r\n    }\r\n\r\n    protected _collectAllPoints(pointsLonLat: LonLat[], promiseCounter: number) {\r\n\r\n        if (!this.planet) return;\r\n        if (promiseCounter !== this._promiseCounter) return;\r\n\r\n        let p0 = new Vec3(),\r\n            p1 = new Vec3();\r\n\r\n        for (let i = 1, len = pointsLonLat.length; i < len; i++) {\r\n            let lonlat0 = pointsLonLat[i - 1],\r\n                lonlat1 = pointsLonLat[i];\r\n\r\n            this.planet.ellipsoid.lonLatToCartesianRes(lonlat0, p0);\r\n            this.planet.ellipsoid.lonLatToCartesianRes(lonlat1, p1);\r\n\r\n            let trackDir = p1.sub(p0);\r\n            let dirLength = trackDir.length();\r\n            let n0 = this.planet.ellipsoid.getSurfaceNormal3v(p0);\r\n            let proj = Vec3.proj_b_to_plane(trackDir, n0);\r\n            let projLen = proj.length();\r\n            let internalPoints = Math.floor(projLen / SEGMMENT_LENGTH);\r\n            let scaleFactor = SEGMMENT_LENGTH * dirLength / projLen;\r\n\r\n            this._getGroundElevation(lonlat0, i - 1, promiseCounter);\r\n\r\n            proj.normalize();\r\n            trackDir.normalize();\r\n\r\n            // Getting internal point elevations and looking for the collisions\r\n            this._collectCoordsBetweenTwoTrackPoints(i - 1, internalPoints, scaleFactor, p0, trackDir, promiseCounter);\r\n\r\n            this._pDist += projLen - internalPoints * SEGMMENT_LENGTH;\r\n            this._pIndex++;\r\n\r\n            let elv = lonlat1.height;\r\n            if (elv > this._pMaxY) this._pMaxY = elv;\r\n            if (elv < this._pMinY) this._pMinY = elv;\r\n\r\n            this._pTrackCoords[i] = [this._pDist, elv, this._pIndex];\r\n        }\r\n    }\r\n\r\n    protected _getGroundElevation(lonLat: LonLat, index: number, promiseCounter: number) {\r\n        this._pGroundCoords[this._pIndex] = [this._pDist, 0, SAFE, 0, index];\r\n        this._promiseArr.push(this._getHeightAsync(lonLat, this._pIndex, promiseCounter));\r\n    }\r\n\r\n    protected _calcPointsAsync(pointsLonLat: LonLat[], promiseCounter: number) {\r\n        return new Promise<IProfileData>((resolve: (p: IProfileData) => void, reject) => {\r\n            this._pTrackCoords = [[0, pointsLonLat[0].height, 0]];\r\n            this._pMaxY = pointsLonLat[0].height;\r\n            this._pMinY = this._pMaxY;\r\n            this._pDist = 0;\r\n            this._pGroundCoords = [];\r\n            this._pIndex = 0;\r\n            this._promiseArr = [];\r\n\r\n            this._collectAllPoints(pointsLonLat, promiseCounter);\r\n\r\n            this._getGroundElevation(pointsLonLat[pointsLonLat.length - 1], pointsLonLat.length - 1, promiseCounter);\r\n\r\n            Promise.all(this._promiseArr).then(() => {\r\n                resolve({\r\n                    dist: this._pDist,\r\n                    minY: this._pMinY,\r\n                    maxY: this._pMaxY,\r\n                    trackCoords: this._pTrackCoords,\r\n                    groundCoords: this._pGroundCoords\r\n                });\r\n            });\r\n        });\r\n    }\r\n\r\n    public get minX(): number {\r\n        return this._minX;\r\n    }\r\n\r\n    public get planeDistance(): number {\r\n        return this._planeDistance;\r\n    }\r\n\r\n    public get maxX(): number {\r\n        return this._maxX;\r\n    }\r\n\r\n    public get minY(): number {\r\n        return this._minY;\r\n    }\r\n\r\n    public get maxY(): number {\r\n        return this._maxY;\r\n    }\r\n\r\n    public get pointsReady(): boolean {\r\n        return this._pointsReady;\r\n    }\r\n\r\n    public get isWarningOrCollision(): boolean {\r\n        return this._isWarning;\r\n    }\r\n\r\n    public get drawData(): ElevationProfileDrawData {\r\n        return this._drawData;\r\n    }\r\n\r\n    public collectProfile(pointsLonLat: LonLat[]): Promise<ElevationProfileDrawData> {\r\n\r\n        let def = new Deferred<ElevationProfileDrawData>();\r\n\r\n        if (!this.planet) def.reject();\r\n\r\n        this._pointsReady = false;\r\n        this._isWarning = false;\r\n\r\n        if (!pointsLonLat || !pointsLonLat.length) {\r\n            def.reject();\r\n            return def.promise;\r\n        }\r\n\r\n        this.events.dispatch(this.events.startcollecting, this);\r\n\r\n        this._promiseCounter++;\r\n\r\n        ((counter: number) => {\r\n            this._calcPointsAsync(pointsLonLat, counter).then((p: IProfileData) => {\r\n                if (counter === this._promiseCounter) {\r\n                    this._planeDistance = p.dist;\r\n                    this.setRange(0, p.dist, p.minY - BOTTOM_PADDING * Math.abs(p.minY), p.maxY + Math.abs(p.maxY) * TOP_PADDING);\r\n                    this._pointsReady = true;\r\n                    this._drawData = [p.trackCoords, p.groundCoords];\r\n                    this.events.dispatch(this.events.profilecollected, this._drawData, this);\r\n                    def.resolve(this._drawData);\r\n                }\r\n            });\r\n        })(this._promiseCounter);\r\n\r\n        return def.promise;\r\n    }\r\n\r\n    protected _updatePointType(pIndex: number) {\r\n        if ((this._pGroundCoords[pIndex][3] >= this._pGroundCoords[pIndex][1]) &&\r\n            (this._pGroundCoords[pIndex][3] < this._pGroundCoords[pIndex][1] + this._warningHeightLevel - HEIGHT_EPS)) {\r\n            this._pGroundCoords[pIndex][2] = WARNING;\r\n        }\r\n\r\n        if (this._pGroundCoords[pIndex][3] <= this._pGroundCoords[pIndex][1] + GROUND_OFFSET) {\r\n            this._pGroundCoords[pIndex][2] = COLLISION;\r\n        }\r\n\r\n        if (this._pGroundCoords[pIndex][2] === WARNING || this._pGroundCoords[pIndex][2] === COLLISION) {\r\n            this._isWarning = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @deprecated\r\n     */\r\n    protected _setPointsType() {\r\n        this._isWarning = false;\r\n\r\n        this._pTrackCoords = this._drawData[TRACK];\r\n        this._pGroundCoords = this._drawData[GROUND];\r\n\r\n        for (let i = 0; i < this._pGroundCoords.length; i++) {\r\n            this._updatePointType(i);\r\n        }\r\n\r\n        this._drawData[GROUND] = this._pGroundCoords;\r\n        this.events.dispatch(this.events.profilecollected, this._drawData, this);\r\n    }\r\n\r\n    public clear() {\r\n        this._promiseCounter = 0;\r\n        this._pointsReady = false;\r\n        this._isWarning = false;\r\n        this._drawData = [[], []];\r\n        this._pMaxY = 0;\r\n        this._pMinY = 0;\r\n        this._pDist = 0;\r\n        this._pTrackCoords = [];\r\n        this._pGroundCoords = [];\r\n        this._pIndex = 0;\r\n        this.events.dispatch(this.events.clear, this._drawData, this);\r\n    }\r\n}","import type {EventsHandler} from \"../../Events\";\r\nimport {View} from '../../ui/View';\r\nimport type {IViewParams, ViewEventsList} from '../../ui/View';\r\nimport {\r\n    SAFE,\r\n    WARNING,\r\n    COLLISION,\r\n    ElevationProfile,\r\n} from './ElevationProfile';\r\n\r\nimport type {\r\n    ElevationProfileDrawData,\r\n    GroundItem,\r\n    TrackItem\r\n} from './ElevationProfile';\r\n\r\nimport {distanceFormatExt, binarySearch} from \"../../utils/shared\";\r\nimport type {MouseEventExt} from \"../../input/MouseHandler\";\r\n\r\nconst FILL_COLOR = \"rgb(63, 63, 63)\";\r\nconst TRACK_COLOR = \"rgb(0, 255, 50)\";\r\nconst TERRAIN_COLOR = \"rgb(198, 198, 198)\";\r\nconst TERRAIN_FILL_COLOR = \"rgb(64, 68, 82)\";\r\nconst WARNING_COLOR = \"rgb(255, 255, 0)\";\r\nconst COLLISION_COLOR = \"rgb(255, 0, 0)\";\r\nconst LINE_COLORS = [TERRAIN_COLOR, WARNING_COLOR, COLLISION_COLOR];\r\nconst TERRAIN_ALPHA = 0.5;\r\nconst LINE_WIDTH = 5;\r\n\r\ninterface IElevationProfileViewParams extends IViewParams {\r\n    fillStyle?: string;\r\n}\r\n\r\ntype ElevationProfileViewEventsList = [\"startdrag\", \"stopdrag\", \"pointer\", \"mouseenter\", \"mouseleave\", \"dblclick\", \"tracklength\", \"groundlength\", \"warninglength\", \"collisionlength\"];\r\n\r\nconst ELEVATIONPROFILEVIEW_EVENTS: ElevationProfileViewEventsList = [\"startdrag\", \"stopdrag\", \"pointer\", \"mouseenter\", \"mouseleave\", \"dblclick\", \"tracklength\", \"groundlength\", \"warninglength\", \"collisionlength\"];\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-elevationprofile\">\r\n      <div class=\"og-elevationprofile-loading\" style=\"display: none;\">\r\n        <div class=\"loadingio-spinner-bars-r354qqyl5v\">\r\n          <div class=\"ldio-p0v5a1f6oz\">\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n            <div></div>\r\n          </div>\r\n        </div> \r\n      </div>     \r\n    </div>`;\r\n\r\n\r\nclass ElevationProfileView extends View<ElevationProfile> {\r\n\r\n    public override events: EventsHandler<ElevationProfileViewEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    public fillStyle: string;\r\n\r\n    protected _pixelsInMeter_x: number;\r\n    protected _pixelsInMeter_y: number;\r\n    protected _canvasScale: number;\r\n    public $canvas: HTMLCanvasElement;\r\n    public $pointerCanvas: HTMLCanvasElement;\r\n    protected _ctx: CanvasRenderingContext2D;\r\n    protected _pointerCtx: CanvasRenderingContext2D;\r\n    protected _onResizeObserver_: () => void;\r\n    protected _resizeObserver: ResizeObserver;\r\n\r\n    public $loading: HTMLElement | null;\r\n\r\n    protected _isMouseOver: boolean;\r\n    protected _isDragging: boolean;\r\n\r\n    protected _clickPosX: number;\r\n    protected _clickLeftDistance: number;\r\n    protected _clickRightDistance: number;\r\n\r\n    protected _leftDistance: number;\r\n    protected _rightDistance: number;\r\n\r\n    protected _customFrame: boolean;\r\n\r\n    protected _timeStartHandler: number;\r\n\r\n    constructor(options: IElevationProfileViewParams = {}) {\r\n        super({\r\n            template: TEMPLATE,\r\n            model: new ElevationProfile()\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(ELEVATIONPROFILEVIEW_EVENTS);\r\n\r\n        this.fillStyle = options.fillStyle || FILL_COLOR;\r\n\r\n        this._customFrame = false;\r\n        this._leftDistance = 0;\r\n        this._rightDistance = 0;\r\n        this._pixelsInMeter_x = 0;\r\n        this._pixelsInMeter_y = 0;\r\n        this._canvasScale = 2;\r\n        this.$canvas = document.createElement(\"canvas\");\r\n        this.$canvas.style.position = \"absolute\";\r\n        this._ctx = this.$canvas.getContext('2d')!;\r\n\r\n        this.$pointerCanvas = document.createElement(\"canvas\");\r\n        this.$pointerCanvas.style.pointerEvents = \"none\";\r\n        this.$pointerCanvas.style.position = \"absolute\";\r\n        this._pointerCtx = this.$pointerCanvas.getContext('2d')!;\r\n\r\n        this.$loading = null;\r\n\r\n        this._isMouseOver = false;\r\n        this._isDragging = false;\r\n        this._clickPosX = 0;\r\n        this._clickLeftDistance = 0;\r\n        this._clickRightDistance = 0;\r\n\r\n        this._timeStartHandler = 0;\r\n\r\n        this._onResizeObserver_ = this._onResizeObserver.bind(this);\r\n        this._resizeObserver = new ResizeObserver(this._onResizeObserver_);\r\n    }\r\n\r\n    protected _onResizeObserver() {\r\n        this.resize();\r\n    }\r\n\r\n    public get canvasScale(): number {\r\n        return this._canvasScale;\r\n    }\r\n\r\n    public set canvasScale(scale: number) {\r\n        if (scale !== this._canvasScale) {\r\n            this._canvasScale = scale;\r\n            this.resize();\r\n        }\r\n    }\r\n\r\n    public resize() {\r\n        this._resize();\r\n        this.draw();\r\n    }\r\n\r\n    public override render(): this {\r\n        super.render();\r\n\r\n        this._resizeObserver.observe(this.el!);\r\n\r\n        this.el!.appendChild(this.$canvas);\r\n        this.el!.appendChild(this.$pointerCanvas);\r\n\r\n        this.model.events.on(\"profilecollected\", (data: ElevationProfileDrawData) => {\r\n            this._hideLoading();\r\n            this.clearPointerCanvas();\r\n            this.draw();\r\n        });\r\n\r\n        this.model.events.on(\"startcollecting\", () => {\r\n            clearTimeout(this._timeStartHandler);\r\n            //@ts-ignore\r\n            this._timeStartHandler = setTimeout(() => {\r\n                this._showLoading();\r\n            }, 450);\r\n        });\r\n\r\n        this.model.events.on(\"clear\", () => {\r\n            this._customFrame = false;\r\n            this._leftDistance = 0;\r\n            this.clearCanvas();\r\n            this.clearPointerCanvas();\r\n        });\r\n\r\n        this.$loading = this.select(\".og-elevationprofile-loading\");\r\n\r\n        this.$canvas.addEventListener(\"mouseenter\", this._onMouseEnter);\r\n        this.$canvas.addEventListener(\"mouseout\", this._onMouseOut);\r\n        this.$canvas.addEventListener(\"dblclick\", this._onMouseDblClick);\r\n\r\n        this.$canvas.addEventListener(\"mousemove\", this._onCanvasMouseMove);\r\n        document.body.addEventListener(\"mousemove\", this._onMouseMove);\r\n        document.body.addEventListener(\"mousedown\", this._onMouseDown);\r\n        document.body.addEventListener(\"mouseup\", this._onMouseUp);\r\n        document.body.addEventListener(\"wheel\", this._onMouseWheelFF);\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _hideLoading() {\r\n        clearTimeout(this._timeStartHandler);\r\n        this.$loading!.style.display = \"none\";\r\n    }\r\n\r\n    protected _showLoading() {\r\n        this.$loading!.style.display = \"flex\";\r\n    }\r\n\r\n    protected _onMouseDblClick = (e: MouseEvent) => {\r\n        //\r\n        // @todo: The same code as in the pointer mouse move\r\n        //\r\n        let rect = this.$canvas.getBoundingClientRect();\r\n        let x = e.clientX - rect.left;\r\n\r\n        let pointerDistance = this._leftDistance + (this._rightDistance - this._leftDistance) * x / this.clientWidth;\r\n        let groundData = this.model.drawData[1];\r\n        let trackData = this.model.drawData[0];\r\n\r\n        let groundPoiIndex;\r\n\r\n        if (pointerDistance < 0) {\r\n            groundPoiIndex = 1;\r\n            pointerDistance = 0;\r\n            x = (0 - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\r\n        } else if (pointerDistance > this.model.planeDistance) {\r\n            groundPoiIndex = groundData.length - 1;\r\n            pointerDistance = this.model.planeDistance;\r\n            x = (pointerDistance - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\r\n        } else {\r\n            groundPoiIndex = -1 - binarySearch(groundData, pointerDistance, (a: number, b: GroundItem) => {\r\n                return a - b[0];\r\n            });\r\n        }\r\n\r\n        // Ground point\r\n        let gp0 = groundData[groundPoiIndex - 1],\r\n            gp1 = groundData[groundPoiIndex];\r\n        let d = (pointerDistance - gp0[0]) / (gp1[0] - gp0[0]);\r\n        let groundElv = gp0[1] + d * (gp1[1] - gp0[1]);\r\n\r\n        // track point\r\n        let trackPoiIndex = gp0[4];\r\n        let tp0 = trackData[trackPoiIndex],\r\n            tp1 = trackData[trackPoiIndex + 1];\r\n        d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\r\n        let trackElv = tp0[1] + d * (tp1[1] - tp0[1]);\r\n\r\n        this.events.dispatch(this.events.dblclick, pointerDistance, tp0, tp1, gp0, gp1, trackPoiIndex, groundPoiIndex - 1, trackElv - groundElv);\r\n    }\r\n\r\n    protected _onMouseEnter = (e: MouseEvent) => {\r\n        this._isMouseOver = true;\r\n        this.events.dispatch(this.events.mouseenter, e);\r\n    }\r\n\r\n    protected _onMouseOut = (e: MouseEvent) => {\r\n        this._isMouseOver = false;\r\n        this.events.dispatch(this.events.mouseleave, e);\r\n    }\r\n\r\n    protected _onMouseDown = (e: MouseEvent) => {\r\n        if (this._isMouseOver) {\r\n            this._isDragging = true;\r\n            document.body.classList.add(\"og-timeline-unselectable\");\r\n\r\n            this._clickPosX = e.clientX;\r\n\r\n            if (!this._customFrame) {\r\n                this._leftDistance = this.model.minX;\r\n                this._rightDistance = this.model.maxX;\r\n            }\r\n\r\n            this._clickLeftDistance = this._leftDistance;\r\n            this._clickRightDistance = this._rightDistance;\r\n\r\n            this.events.dispatch(this.events.startdrag, e);\r\n        }\r\n    }\r\n\r\n    protected _onMouseUp = (e: MouseEvent) => {\r\n        if (this._isDragging) {\r\n            this._isDragging = false;\r\n            document.body.classList.remove(\"og-timeline-unselectable\");\r\n            this.events.dispatch(this.events.stopdrag, e);\r\n        }\r\n    }\r\n\r\n    protected _onCanvasMouseMove = (e: MouseEvent) => {\r\n        if (this.model.pointsReady) {\r\n            if (!this._isDragging) {\r\n\r\n                if (!this._customFrame) {\r\n                    this._leftDistance = this.model.minX;\r\n                    this._rightDistance = this.model.maxX;\r\n                }\r\n\r\n                let rect = this.$pointerCanvas.getBoundingClientRect();\r\n                let x = e.clientX - rect.left;\r\n                this.redrawPointerCanvas(x);\r\n            } else {\r\n                this.clearPointerCanvas();\r\n            }\r\n        }\r\n    }\r\n\r\n    public redrawPointerCanvas(x: number) {\r\n        this.clearPointerCanvas();\r\n\r\n        let pointerDistance = this._leftDistance + (this._rightDistance - this._leftDistance) * x / this.clientWidth;\r\n        let groundData = this.model.drawData[1];\r\n        let trackData = this.model.drawData[0];\r\n\r\n        let groundPoiIndex;\r\n\r\n        if (pointerDistance < 0) {\r\n            groundPoiIndex = 1;\r\n            pointerDistance = 0;\r\n            x = (0 - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\r\n        } else if (pointerDistance > this.model.planeDistance) {\r\n            groundPoiIndex = groundData.length - 1;\r\n            pointerDistance = this.model.planeDistance;\r\n            x = (pointerDistance - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\r\n        } else {\r\n            groundPoiIndex = -1 - binarySearch(groundData, pointerDistance, (a: number, b: GroundItem) => {\r\n                return a - b[0];\r\n            });\r\n        }\r\n\r\n        // Ground point\r\n        let gp0 = groundData[groundPoiIndex - 1],\r\n            gp1 = groundData[groundPoiIndex];\r\n        let d = (pointerDistance - gp0[0]) / (gp1[0] - gp0[0]);\r\n        let groundElv = gp0[1] + d * (gp1[1] - gp0[1]);\r\n\r\n        // track point\r\n        let trackPoiIndex = gp0[4];\r\n        let tp0 = trackData[trackPoiIndex],\r\n            tp1 = trackData[trackPoiIndex + 1];\r\n        d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\r\n        let trackElv = tp0[1] + d * (tp1[1] - tp0[1]);\r\n\r\n        let trackY = (this.model.maxY - trackElv) * this._pixelsInMeter_y;\r\n        let groundY = (this.model.maxY - groundElv) * this._pixelsInMeter_y;\r\n\r\n        this.events.dispatch(this.events.pointer, pointerDistance, tp0, tp1, gp0, gp1, trackPoiIndex, groundPoiIndex - 1, trackElv - groundElv);\r\n\r\n        let ctx = this._pointerCtx;\r\n\r\n        // Vertical grey line\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = \"rgba(64,64,64,0.6)\";\r\n        ctx.beginPath();\r\n        ctx.moveTo(x * this._canvasScale, 0);\r\n        ctx.lineTo(x * this._canvasScale, this.clientHeight * this._canvasScale);\r\n        ctx.stroke();\r\n\r\n        // Ground point\r\n        ctx.beginPath();\r\n        ctx.arc(x * this._canvasScale, groundY, 4, 0, 2 * Math.PI, false);\r\n        ctx.fillStyle = '#FFB277';\r\n        ctx.fill();\r\n        ctx.lineWidth = 4;\r\n        ctx.strokeStyle = '#FFB277';\r\n        ctx.stroke();\r\n\r\n        // Track point\r\n        ctx.beginPath();\r\n        ctx.arc(x * this._canvasScale, trackY, 4, 0, 2 * Math.PI, false);\r\n        ctx.fillStyle = '#FFB277';\r\n        ctx.fill();\r\n        ctx.lineWidth = 4;\r\n        ctx.strokeStyle = '#FFB277';\r\n        ctx.stroke();\r\n\r\n        // Vertical white line\r\n        ctx.lineWidth = 3;\r\n        ctx.strokeStyle = \"#FFB277\";\r\n        ctx.beginPath();\r\n        ctx.moveTo(x * this._canvasScale, groundY);\r\n        ctx.lineTo(x * this._canvasScale, trackY);\r\n        ctx.stroke();\r\n\r\n        // Altitude label\r\n        ctx.fillStyle = \"white\";\r\n        ctx.font = `${28 / devicePixelRatio}px Arial`;\r\n        ctx.textBaseline = \"middle\";\r\n        ctx.textAlign = \"left\";\r\n        ctx.fillText(`${Math.round(trackElv - groundElv).toString()} m`, (x + 5) * this._canvasScale, groundY + (trackY - groundY) * 0.5);\r\n\r\n        // distance from the begining label\r\n        ctx.fillStyle = \"white\";\r\n        ctx.font = `${28 / devicePixelRatio}px Arial`;\r\n        ctx.textAlign = \"right\";\r\n        let distStr = distanceFormatExt(pointerDistance);\r\n        ctx.fillText(`${distStr[0]} ${distStr[1]}`, (x - 5) * this._canvasScale, (this.clientHeight - 7) * this._canvasScale);\r\n    }\r\n\r\n    protected _onMouseMove = (e: MouseEvent) => {\r\n        if (this._isDragging && this.model.pointsReady) {\r\n            let offset = (this._clickPosX - e.clientX);\r\n            let distanceOffset = offset * this._canvasScale / this._pixelsInMeter_x;\r\n            this.setFrame(this._clickLeftDistance + distanceOffset, this._clickRightDistance + distanceOffset);\r\n        }\r\n    }\r\n\r\n    protected _onMouseWheelFF = (e: MouseEventExt) => {\r\n        this._onMouseWheel(e);\r\n    }\r\n    protected _onMouseWheel = (e: MouseEventExt) => {\r\n        if (this._isMouseOver && this.model.pointsReady) {\r\n\r\n            if (!this._customFrame) {\r\n                this._leftDistance = this.model.minX;\r\n                this._rightDistance = this.model.maxX;\r\n            }\r\n\r\n            this._customFrame = true;\r\n\r\n            let padDist = Math.sign(e.wheelDelta!) * (this._rightDistance - this._leftDistance) / 20;\r\n\r\n            let rect = this.$canvas.getBoundingClientRect();\r\n            let pointerPosX = e.clientX - rect.left,\r\n                pointerCenterOffsetX = pointerPosX - this.$canvas.clientWidth * 0.5;\r\n            let distanceCenterOffsetX = pointerCenterOffsetX * this._canvasScale / this._pixelsInMeter_x;\r\n\r\n            // Move distance under pointer to a screen center\r\n            let leftDistance = distanceCenterOffsetX + this._leftDistance + padDist;\r\n            let rightDistance = distanceCenterOffsetX + this._rightDistance - padDist;\r\n\r\n            // move center back to the mouse pointer\r\n            distanceCenterOffsetX = -pointerCenterOffsetX * (rightDistance - leftDistance) / this.clientWidth;\r\n\r\n            this.setFrame(leftDistance + distanceCenterOffsetX, rightDistance + distanceCenterOffsetX);\r\n\r\n            this.redrawPointerCanvas(pointerPosX);\r\n        }\r\n    }\r\n\r\n\r\n    public get clientWidth(): number {\r\n        return this.$canvas ? this.$canvas.width / this._canvasScale : 0;\r\n    }\r\n\r\n    public get clientHeight(): number {\r\n        return this.$canvas ? this.$canvas.height / this._canvasScale : 0;\r\n    }\r\n\r\n    protected _resize() {\r\n        if (this.el) {\r\n            this.$canvas.width = this.el.clientWidth * this._canvasScale;\r\n            this.$canvas.height = this.el.clientHeight * this._canvasScale;\r\n            this.$canvas.style.width = `${this.el.clientWidth}px`;\r\n            this.$canvas.style.height = `${this.el.clientHeight}px`;\r\n\r\n            this.$pointerCanvas.width = this.el.clientWidth * this._canvasScale;\r\n            this.$pointerCanvas.height = this.el.clientHeight * this._canvasScale;\r\n            this.$pointerCanvas.style.width = `${this.el.clientWidth}px`;\r\n            this.$pointerCanvas.style.height = `${this.el.clientHeight}px`;\r\n\r\n            if (this._customFrame) {\r\n                this._pixelsInMeter_x = this._canvasScale * this.clientWidth / (this._rightDistance - this._leftDistance);\r\n            }\r\n        }\r\n    }\r\n\r\n    public clearPointerCanvas() {\r\n        this._pointerCtx.fillStyle = \"rgba(0,0,0,0)\";\r\n        this._pointerCtx.clearRect(0, 0, this.clientWidth * this._canvasScale, this.clientHeight * this._canvasScale);\r\n    }\r\n\r\n    public clearCanvas() {\r\n        const grd = this._ctx.createLinearGradient(0, 0, 0, this.clientHeight * this._canvasScale);\r\n        grd.addColorStop(0, \"black\");\r\n        grd.addColorStop(1, this.fillStyle);\r\n\r\n        this._ctx.fillStyle = grd;\r\n        this._ctx.fillRect(0, 0, this.clientWidth * this._canvasScale, this.clientHeight * this._canvasScale);\r\n    }\r\n\r\n    public setFrame(leftDistance: number, rightDistance: number) {\r\n        this._leftDistance = leftDistance;\r\n        this._rightDistance = rightDistance;\r\n        this._customFrame = true;\r\n        this._pixelsInMeter_x = this._canvasScale * this.clientWidth / (this._rightDistance - this._leftDistance);\r\n        this.model.setRange(leftDistance, rightDistance);\r\n        this.draw();\r\n    }\r\n\r\n    public _updateUnits() {\r\n        if (!this._customFrame) {\r\n            this._pixelsInMeter_x = this._canvasScale * this.clientWidth / (this.model.maxX - this.model.minX);\r\n        }\r\n        this._pixelsInMeter_y = this._canvasScale * this.clientHeight / (this.model.maxY - this.model.minY);\r\n    }\r\n\r\n    public clear() {\r\n        this.model.clear();\r\n        this.clearCanvas();\r\n    }\r\n\r\n    public draw() {\r\n        let trackCoords = this.model.drawData[0];\r\n        if (trackCoords.length > 1) {\r\n\r\n            this._updateUnits();\r\n\r\n            this.clearCanvas();\r\n\r\n            let groundCoords = this.model.drawData[1];\r\n\r\n            this._drawTrack(trackCoords, groundCoords);\r\n            this._drawTerrain(groundCoords);\r\n            this._drawWarningAndCollision(groundCoords);\r\n            this._drawLabels(trackCoords, groundCoords);\r\n\r\n        } else {\r\n            this.clearCanvas();\r\n        }\r\n    }\r\n\r\n    protected _drawLabels(coords: TrackItem[], groundCoords: GroundItem[]) {\r\n        let ctx = this._ctx;\r\n        if (ctx) {\r\n            let p0 = coords[0];\r\n            const maxY = this.model.maxY;\r\n            let x = (-this._leftDistance + p0[0]) * this._pixelsInMeter_x,\r\n                yt = (maxY - p0[1]) * this._pixelsInMeter_y,\r\n                yg = (maxY - groundCoords[p0[2]][1]) * this._pixelsInMeter_y;\r\n\r\n            // Track points\r\n            ctx.beginPath();\r\n            ctx.fillStyle = '#F7F718';\r\n            ctx.fillRect(x - 4, yt - 4, 8, 8);\r\n            ctx.stroke();\r\n\r\n            // Alt label\r\n            ctx.fillStyle = \"white\";\r\n            ctx.font = `${26 / devicePixelRatio}px Arial`;\r\n            ctx.textBaseline = \"bottom\";\r\n            ctx.textAlign = \"left\";\r\n            ctx.fillText(`${Math.round(p0[1] - groundCoords[p0[2]][1]).toString()} m`, x + 1, yt - 10);\r\n            ctx.stroke();\r\n\r\n            for (let i = 1, len = coords.length; i < len; i++) {\r\n                let pi = coords[i];\r\n                x = (-this._leftDistance + pi[0]) * this._pixelsInMeter_x;\r\n                yt = (maxY - pi[1]) * this._pixelsInMeter_y;\r\n                yg = (maxY - groundCoords[pi[2]][1]) * this._pixelsInMeter_y;\r\n\r\n                // Track points\r\n                ctx.beginPath();\r\n                ctx.fillStyle = '#F7F718';\r\n                ctx.fillRect(x - 4, yt - 4, 8, 8);\r\n                ctx.stroke();\r\n\r\n                // Alt label\r\n                ctx.fillStyle = \"white\";\r\n                ctx.fillText(`${Math.round(pi[1] - groundCoords[pi[2]][1]).toString()} m`, x + 1, yt - 10);\r\n                ctx.stroke();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _drawTrack(coords: TrackItem[], groundCoords: GroundItem[]) {\r\n        let p0 = coords[0];\r\n        let ctx = this._ctx;\r\n        if (ctx) {\r\n            const maxY = this.model.maxY;\r\n            ctx.lineWidth = LINE_WIDTH;\r\n            ctx.strokeStyle = TRACK_COLOR;\r\n            ctx.beginPath();\r\n            ctx.moveTo((-this._leftDistance + p0[0]) * this._pixelsInMeter_x, (maxY - p0[1]) * this._pixelsInMeter_y);\r\n            let trackLength = 0;\r\n            for (let i = 1, len = coords.length; i < len; i++) {\r\n                let pi = coords[i];\r\n                ctx.lineTo((-this._leftDistance + pi[0]) * this._pixelsInMeter_x, (maxY - pi[1]) * this._pixelsInMeter_y);\r\n                let prevP = coords[i - 1];\r\n                let a = pi[0] - prevP[0],\r\n                    b = pi[1] - prevP[1],\r\n                    aa = a * a,\r\n                    bb = b * b;\r\n                trackLength += Math.sqrt(aa + bb);\r\n            }\r\n            ctx.stroke();\r\n\r\n            // Track points lines\r\n            ctx.lineWidth = 2;\r\n            ctx.strokeStyle = \"rgba(255,255,255,0.7)\";\r\n            ctx.beginPath();\r\n            let x = (-this._leftDistance + p0[0]) * this._pixelsInMeter_x,\r\n                yt = (maxY - p0[1]) * this._pixelsInMeter_y,\r\n                yg = (maxY - groundCoords[p0[2]][1]) * this._pixelsInMeter_y;\r\n            ctx.moveTo(x, yt);\r\n            ctx.lineTo(x, yg);\r\n\r\n            for (let i = 1, len = coords.length; i < len; i++) {\r\n                let pi = coords[i];\r\n                x = (-this._leftDistance + pi[0]) * this._pixelsInMeter_x;\r\n                yt = (maxY - pi[1]) * this._pixelsInMeter_y;\r\n                yg = (maxY - groundCoords[pi[2]][1]) * this._pixelsInMeter_y;\r\n                ctx.strokeStyle = \"rgba(255,255,255,0.7)\";\r\n                ctx.moveTo(x, yt);\r\n                ctx.lineTo(x, yg);\r\n            }\r\n\r\n            ctx.stroke();\r\n\r\n            this.events.dispatch(this.events.tracklength, trackLength);\r\n        }\r\n    }\r\n\r\n    protected _drawTerrain(coords: number[][]) {\r\n        let p0 = coords[0];\r\n        let ctx = this._ctx;\r\n        if (ctx) {\r\n            const maxY = this.model.maxY;\r\n            ctx.lineWidth = LINE_WIDTH;\r\n            ctx.strokeStyle = TERRAIN_COLOR;\r\n            ctx.beginPath();\r\n            ctx.moveTo((-this._leftDistance + p0[0]) * this._pixelsInMeter_x, this.$canvas.height);\r\n            ctx.lineTo((-this._leftDistance + p0[0]) * this._pixelsInMeter_x, (maxY - p0[1]) * this._pixelsInMeter_y);\r\n            let groundLength = 0;\r\n            for (let i = 1, len = coords.length; i < len; i++) {\r\n                let pi = coords[i];\r\n                ctx.lineTo((-this._leftDistance + pi[0]) * this._pixelsInMeter_x, (maxY - pi[1]) * this._pixelsInMeter_y);\r\n                let prevP = coords[i - 1];\r\n                let a = pi[0] - prevP[0],\r\n                    b = pi[1] - prevP[1],\r\n                    aa = a * a,\r\n                    bb = b * b;\r\n                groundLength += Math.sqrt(aa + bb);\r\n            }\r\n\r\n            ctx.lineTo((-this._leftDistance + coords[coords.length - 1][0]) * this._pixelsInMeter_x, this.$canvas.height);\r\n            ctx.closePath();\r\n            ctx.stroke();\r\n            ctx.save();\r\n            ctx.fillStyle = TERRAIN_FILL_COLOR;\r\n            ctx.globalAlpha = TERRAIN_ALPHA;\r\n            ctx.fill();\r\n            ctx.restore();\r\n            ctx.globalAlpha = 1;\r\n\r\n            this.events.dispatch(this.events.groundlength, groundLength);\r\n        }\r\n    }\r\n\r\n    protected _drawWarningAndCollision(coords: number[][]) {\r\n        let ctx = this._ctx;\r\n        if (ctx && coords.length > 1) {\r\n            let maxY = this.model.maxY;\r\n            ctx.lineWidth = LINE_WIDTH;\r\n            ctx.beginPath();\r\n\r\n            let warningLength = 0,\r\n                collisionLength = 0;\r\n\r\n            for (let i = 0, len = coords.length - 1; i < len; i++) {\r\n\r\n                let pi0 = coords[i],\r\n                    pi1 = coords[i + 1];\r\n\r\n                if (pi0[2] !== SAFE && pi1[2] !== SAFE) {\r\n\r\n                    let a = pi1[0] - pi0[0],\r\n                        b = pi1[1] - pi0[1],\r\n                        aa = a * a,\r\n                        bb = b * b;\r\n\r\n                    if (pi0[2] === COLLISION) {\r\n                        ctx.stroke();\r\n                        ctx.beginPath();\r\n                        ctx.strokeStyle = LINE_COLORS[COLLISION];\r\n                        collisionLength += Math.sqrt(aa + bb);\r\n                    } else if (pi0[2] === WARNING) {\r\n                        ctx.stroke();\r\n                        ctx.beginPath();\r\n                        ctx.strokeStyle = LINE_COLORS[WARNING];\r\n                        warningLength += Math.sqrt(aa + bb);\r\n                    }\r\n\r\n                    ctx.moveTo((-this._leftDistance + pi0[0]) * this._pixelsInMeter_x, (maxY - pi0[1]) * this._pixelsInMeter_y);\r\n                    ctx.lineTo((-this._leftDistance + pi1[0]) * this._pixelsInMeter_x, (maxY - pi1[1]) * this._pixelsInMeter_y);\r\n                }\r\n            }\r\n            ctx.stroke();\r\n\r\n            this.events.dispatch(this.events.warninglength, warningLength);\r\n\r\n            this.events.dispatch(this.events.collisionlength, collisionLength);\r\n        }\r\n    }\r\n}\r\n\r\nexport {ElevationProfileView};","import {Entity} from '../../entity/Entity';\r\nimport {createEvents, type EventsHandler} from '../../Events';\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {Object3d} from '../../Object3d';\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {RenderNode} from '../../scene/RenderNode';\r\nimport {Vector} from '../../layer/Vector';\r\nimport {Vec2} from '../../math/Vec2';\r\nimport {Vec3} from '../../math/Vec3';\r\nimport type {IMouseState} from \"../../renderer/RendererEvents\";\r\nimport {Ellipsoid} from \"../../ellipsoid/Ellipsoid\";\r\nimport type {ILabelParams} from \"../../entity/Label\";\r\nimport type {IRayParams} from \"../../entity/Ray\";\r\nimport type {IBillboardParams} from \"../../entity/Billboard\";\r\nimport {Ray} from \"../../math/Ray\";\r\nimport {Plane} from \"../../math/Plane\";\r\n\r\nexport interface IElevationProfileSceneParams {\r\n    name?: string;\r\n    planet?: Planet;\r\n}\r\n\r\nlet groundObj3d = Object3d.createCylinder(0.33, 0, 1.0, 20, 1, true, false, 0, 0, 0);\r\nlet headObj3d = Object3d.createCylinder(0.33, 0.33, 1.1, 20, 1, true, true, 0, -0.55, 0);\r\n\r\nconst POINTER_RAY_OPTIONS: IRayParams = {\r\n    startPosition: new Vec3(),\r\n    endPosition: new Vec3(),\r\n    startColor: \"rgba(255,131,0,0.2)\",\r\n    endColor: \"rgba(255,131,0,1.0)\",\r\n    thickness: 2.7\r\n}\r\n\r\nconst POINTER_BILLBOARD_OPTIONS: IBillboardParams = {\r\n    src: \"data:image/png;base64,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\",\r\n    color: \"rgb(255,131,0)\",\r\n    size: [8, 8]\r\n}\r\n\r\nconst POINTER_LABEL_OPTIONS: ILabelParams = {\r\n    text: \"\",\r\n    face: \"arial\",\r\n    size: 10.5,\r\n    color: \"rgba(455,455,455,1.0)\",\r\n    outlineColor: \"rgba(0,0,0,0.34)\",\r\n    outline: 0.23,\r\n    align: \"left\",\r\n    offset: [5, 15, -5]\r\n};\r\n\r\nconst LABEL_OPTIONS: ILabelParams = {\r\n    face: \"arial\",\r\n    text: \"\",\r\n    size: 10.5,\r\n    color: \"rgba(455,455,455,1.0)\",\r\n    outlineColor: \"rgba(0,0,0,0.34)\",\r\n    outline: 0.23,\r\n    align: \"right\",\r\n    offset: [-47, 25, 0]\r\n};\r\n\r\nconst GROUND_POINTER_OPTIONS = {\r\n    instanced: true,\r\n    tag: \"ground-pointer\",\r\n    color: \"rgb(0,305,0)\",\r\n    object3d: groundObj3d\r\n};\r\n\r\nconst HEAD_POINTER_OPTIONS = {\r\n    instanced: true,\r\n    tag: \"head-pointer\",\r\n    color: \"rgb(305,305,0)\",\r\n    object3d: headObj3d\r\n};\r\n\r\nclass ElevationProfileScene extends RenderNode {\r\n\r\n    public events: EventsHandler<ElevationProfileSceneEventsList>;\r\n\r\n    protected _planet: Planet | null;\r\n    protected _trackLayer: Vector;\r\n    protected _groundPointersLayer: Vector;\r\n    protected _columnPointersLayer: Vector;\r\n    protected _headPointersLayer: Vector;\r\n    protected _heightsLayer: Vector;\r\n    protected _trackEntity: Entity;\r\n    protected _pickedGroundEntity: Entity | null;\r\n    protected _pickedHeadEntity: Entity | null;\r\n\r\n\r\n    protected _pointerLayer: Vector;\r\n    protected _pointerHeadEntity: Entity;\r\n    protected _pointerLabelEntity: Entity;\r\n    protected _pointerRayEntity: Entity;\r\n\r\n    protected _startClickPos: Vec2;\r\n    protected _startEntityPos: Vec2;\r\n\r\n    protected _clampToGround: boolean;\r\n\r\n    constructor(options: IElevationProfileSceneParams = {}) {\r\n        super(\"ElevationProfileScene\");\r\n\r\n        this.events = createEvents(ELEVATIONPROFILESCENE_EVENTS);\r\n\r\n        this._planet = options.planet || null;\r\n\r\n        this._pickedGroundEntity = null;\r\n        this._pickedHeadEntity = null;\r\n        this._startClickPos = new Vec2();\r\n        this._startEntityPos = new Vec2();\r\n        this._clampToGround = true;\r\n\r\n        this._trackLayer = new Vector(\"track\", {\r\n            entities: [],\r\n            pickingEnabled: false,\r\n            polygonOffsetUnits: -1.0,\r\n            relativeToGround: true,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._groundPointersLayer = new Vector(\"ground-pointers\", {\r\n            entities: [],\r\n            pickingEnabled: true,\r\n            hideInLayerSwitcher: true,\r\n            scaleByDistance: [1, 5000, 0.02],\r\n            pickingScale: 1.5\r\n        });\r\n\r\n        this._headPointersLayer = new Vector(\"head-pointers\", {\r\n            entities: [],\r\n            pickingEnabled: true,\r\n            hideInLayerSwitcher: true,\r\n            scaleByDistance: [1, 10000, 0.02],\r\n            pickingScale: 1\r\n        });\r\n\r\n        this._columnPointersLayer = new Vector(\"column-pointers\", {\r\n            entities: [],\r\n            pickingEnabled: false,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._trackEntity = new Entity({\r\n            polyline: {\r\n                path3v: [],\r\n                thickness: 3.8,\r\n                color: \"rgba(0,305,0,0.8)\",\r\n                isClosed: false\r\n            }\r\n        });\r\n\r\n        this._trackLayer = new Vector(\"column-pointers\", {\r\n            entities: [this._trackEntity],\r\n            pickingEnabled: false,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._heightsLayer = new Vector(\"heights-labels\", {\r\n            entities: [],\r\n            pickingEnabled: false,\r\n            hideInLayerSwitcher: true\r\n        });\r\n\r\n        this._pointerHeadEntity = new Entity({\r\n            cartesian: new Vec3(),\r\n            billboard: POINTER_BILLBOARD_OPTIONS\r\n        });\r\n\r\n        this._pointerLabelEntity = new Entity({\r\n            cartesian: new Vec3(),\r\n            label: POINTER_LABEL_OPTIONS\r\n        });\r\n\r\n        this._pointerRayEntity = new Entity({\r\n            cartesian: new Vec3(),\r\n            ray: POINTER_RAY_OPTIONS\r\n        });\r\n\r\n        this._pointerLayer = new Vector(\"pointer\", {\r\n            entities: [this._pointerHeadEntity, this._pointerLabelEntity, this._pointerRayEntity],\r\n            pickingEnabled: false,\r\n            hideInLayerSwitcher: true\r\n        });\r\n    }\r\n\r\n    public flyExtent() {\r\n        let entities = this._headPointersLayer.getEntities();\r\n        let minLon = 180, minLat = 180, maxLon = -180, maxLat = -180, maxHeight = -1000000;\r\n        if (entities.length > 1) {\r\n            for (let i = 0; i < entities.length; i++) {\r\n                let ll = entities[i].getLonLat();\r\n                if (ll.lon < minLon) minLon = ll.lon;\r\n                if (ll.lat < minLat) minLat = ll.lat;\r\n                if (ll.lon > maxLon) maxLon = ll.lon;\r\n                if (ll.lat > maxLat) maxLat = ll.lat;\r\n                if (ll.height > maxHeight) maxHeight = ll.height;\r\n            }\r\n\r\n            this._planet!.camera.flyExtent(new Extent(new LonLat(minLon, minLat), new LonLat(maxLon, maxLat)), maxHeight, null, 0);\r\n        }\r\n    }\r\n\r\n    public get planet(): Planet | null {\r\n        return this._planet;\r\n    }\r\n\r\n    protected _createGroundPointer(groundCart: Vec3, altitude: number = 10): {\r\n        headEntity: Entity,\r\n        groundEntity: Entity,\r\n        columnEntity: Entity,\r\n        heightLabelEntity: Entity\r\n    } {\r\n\r\n        let surfaceNormal = this.ellipsoid!.getSurfaceNormal3v(groundCart);\r\n        let headCart = groundCart.add(surfaceNormal.scale(altitude));\r\n\r\n        let columnEntity = new Entity({\r\n            ray: {\r\n                startPosition: groundCart,\r\n                endPosition: headCart,\r\n                startColor: \"rgba(255,255,255,0.2)\",\r\n                endColor: \"rgba(355,355,355,1.0)\",\r\n                thickness: 3.2\r\n            }\r\n        });\r\n\r\n        let groundEntity = new Entity({\r\n            cartesian: groundCart,\r\n            geoObject: GROUND_POINTER_OPTIONS,\r\n        });\r\n\r\n        let headEntity = new Entity({\r\n            cartesian: headCart,\r\n            geoObject: HEAD_POINTER_OPTIONS,\r\n            properties: {}\r\n        });\r\n\r\n        let heightLabelEntity = new Entity({\r\n            cartesian: headCart,\r\n            label: LABEL_OPTIONS\r\n        });\r\n\r\n        heightLabelEntity.appendChild(new Entity({\r\n                cartesian: headCart,\r\n                label: {...LABEL_OPTIONS, offset: [-47, 45, 0]}\r\n            })\r\n        );\r\n\r\n        const index = this._groundPointersLayer.getEntities().length;\r\n\r\n        columnEntity.properties =\r\n            groundEntity.properties =\r\n                headEntity.properties = {\r\n                    index,\r\n                    altitude: altitude,\r\n                    lonLatEll: new LonLat(),\r\n                    headEntity,\r\n                    groundEntity,\r\n                    columnEntity,\r\n                    heightLabelEntity\r\n                };\r\n\r\n        return {headEntity, groundEntity, columnEntity, heightLabelEntity};\r\n    }\r\n\r\n    public setPointerCartesian3v(p: Vec3, height: number) {\r\n        this._pointerLabelEntity.setCartesian3v(p);\r\n        this._pointerLabelEntity.label!.setText(`${Math.round(height).toString()} m`);\r\n\r\n        this._pointerRayEntity.ray!.setEndPosition3v(p);\r\n        let n = this._planet!.ellipsoid.getSurfaceNormal3v(p);\r\n        this._pointerRayEntity.ray!.setStartPosition3v(p.add(n.scale(-height)));\r\n\r\n        this._pointerHeadEntity.setCartesian3v(p);\r\n    }\r\n\r\n    public bindPlanet(planet: Planet) {\r\n        this._planet = planet;\r\n    }\r\n\r\n    public override init() {\r\n        this._activate();\r\n    }\r\n\r\n    public override onremove() {\r\n        this._deactivate();\r\n    }\r\n\r\n    public _activate() {\r\n\r\n        this._planet!.addLayer(this._trackLayer);\r\n        this._planet!.addLayer(this._groundPointersLayer);\r\n        this._planet!.addLayer(this._columnPointersLayer);\r\n        this._planet!.addLayer(this._headPointersLayer);\r\n        this._planet!.addLayer(this._heightsLayer);\r\n        this._planet!.addLayer(this._pointerLayer);\r\n\r\n        this.renderer!.events.on(\"ldblclick\", this._onLClick);\r\n        this.renderer!.events.on(\"mousemove\", this._onMouseMove);\r\n        this.renderer!.events.on(\"lup\", this._onLUp);\r\n\r\n        this._groundPointersLayer.events.on(\"mouseenter\", this._onGroundPointerEnter);\r\n        this._groundPointersLayer.events.on(\"mouseleave\", this._onGroundPointerLeave);\r\n        this._groundPointersLayer.events.on(\"ldown\", this._onGroundPointerLDown);\r\n        this._groundPointersLayer.events.on(\"lup\", this._onGroundPointerLUp);\r\n\r\n        this._headPointersLayer.events.on(\"mouseenter\", this._onHeadPointerEnter);\r\n        this._headPointersLayer.events.on(\"mouseleave\", this._onHeadPointerLeave);\r\n        this._headPointersLayer.events.on(\"ldown\", this._onHeadPointerLDown);\r\n        this._headPointersLayer.events.on(\"lup\", this._onHeadPointerLUp);\r\n\r\n        this.setPointerVisibility(false);\r\n    }\r\n\r\n    public getPointLonLat(index: number): LonLat | undefined {\r\n        let entity = this._headPointersLayer.getEntities()[index];\r\n        if (entity) {\r\n            return entity.getLonLat();\r\n        }\r\n    }\r\n\r\n    public getPointsLonLat(): LonLat[] {\r\n        let entities = this._headPointersLayer.getEntities();\r\n        let points: LonLat[] = new Array(entities.length);\r\n        for (let i = 0, len = points.length; i < len; i++) {\r\n            let ei = entities[i];\r\n            points[i] = ei.getLonLat();\r\n        }\r\n        return points;\r\n    }\r\n\r\n    public getHeightMSL(lonLat: LonLat) {\r\n        if (this._planet && this._planet.terrain!.geoid) {\r\n            return this._planet!.terrain!.geoid.getHeightLonLat(lonLat);\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public getHeightELLAsync(lonLat: LonLat): Promise<number> {\r\n        return new Promise((resolve, reject) => {\r\n            this._planet!.terrain!.getHeightAsync(lonLat, (hGnd: number) => {\r\n                if (this._planet) {\r\n                    let hMsl = this.getHeightMSL(lonLat);\r\n                    resolve(hGnd + hMsl);\r\n                } else {\r\n                    reject();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    public addPointLonLatArrayAsync(lonLatArr: LonLat[], stopPropagation: boolean = false): Promise<Entity>[] {\r\n\r\n        if (!this._planet) {\r\n            throw new Error(\"Planet is not defined\");\r\n        }\r\n\r\n        let ell = this._planet.ellipsoid;\r\n\r\n        for (let i = 0, len = lonLatArr.length - 1; i < len; i++) {\r\n            let p0 = ell.lonLatToCartesian(lonLatArr[i]),\r\n                p1 = ell.lonLatToCartesian(lonLatArr[i + 1]);\r\n            if (p0.distance(p1) > 100000) {\r\n                throw new Error(\"Track is too long! 100 km is maximum.\");\r\n            }\r\n        }\r\n\r\n        let res = new Array(lonLatArr.length);\r\n\r\n        for (let i = 0, len = lonLatArr.length; i < len; i++) {\r\n            res[i] = this.addPointLonLatAsync(lonLatArr[i], true);\r\n        }\r\n\r\n        Promise.all(res).then(() => {\r\n            if (!stopPropagation) {\r\n                this.events.dispatch(this.events.change, this);\r\n            }\r\n        });\r\n\r\n        return res;\r\n    }\r\n\r\n    public addPointLonLatAsync(lonLat: LonLat, stopPropagation: boolean = false): Promise<Entity> {\r\n\r\n        let headPos = this._planet!.ellipsoid.lonLatToCartesian(lonLat);\r\n        let n = this._planet!.ellipsoid.getSurfaceNormal3v(headPos);\r\n\r\n        let ellLonLat = new LonLat(lonLat.lon, lonLat.lat);\r\n        let ellPos = this._planet!.ellipsoid.lonLatToCartesian(ellLonLat);\r\n\r\n        let {headEntity, groundEntity, columnEntity, heightLabelEntity} = this._createGroundPointer(ellPos);\r\n\r\n        this._groundPointersLayer.add(groundEntity);\r\n        this._columnPointersLayer.add(columnEntity);\r\n        this._headPointersLayer.add(headEntity);\r\n        this._heightsLayer.add(heightLabelEntity);\r\n        this._trackEntity.polyline!.appendPoint3v(headEntity.getCartesian());\r\n\r\n        groundEntity.properties.lonLatEll.lon = ellLonLat.lon;\r\n        groundEntity.properties.lonLatEll.lat = ellLonLat.lat;\r\n        groundEntity.properties.lonLatEll.height = ellLonLat.height;\r\n\r\n        return new Promise((resolve) => {\r\n            this.getHeightELLAsync(lonLat).then((hEll: number) => {\r\n\r\n                groundEntity.properties.lonLatEll.height = hEll;\r\n\r\n                let altitude = 10,\r\n                    groundPos: Vec3;\r\n\r\n                if (lonLat.height === 0) {\r\n                    groundPos = headPos.add(n.scaleTo(hEll));\r\n                    headPos = groundPos.add(n.scaleTo(altitude));\r\n                } else {\r\n                    altitude = lonLat.height - hEll;\r\n                    groundPos = headPos.sub(n.scaleTo(altitude));\r\n                }\r\n\r\n                groundEntity.setCartesian3v(groundPos);\r\n                heightLabelEntity.setCartesian3v(headPos);\r\n                heightLabelEntity.label!.setText(`${hEll.toFixed(1)} m`);\r\n                heightLabelEntity.childEntities[0].label!.setText(`${altitude.toFixed(1)} m`);\r\n                headEntity.properties.altitude = altitude;\r\n                headEntity.setCartesian3v(headPos);\r\n                headEntity.properties.columnEntity.ray!.setStartPosition3v(groundPos);\r\n                headEntity.properties.columnEntity.ray!.setEndPosition3v(headPos);\r\n                this._trackEntity.polyline?.setPoint3v(headPos, headEntity.properties.index);\r\n\r\n                if (!stopPropagation) {\r\n                    this.events.dispatch(this.events.addpoint, headEntity, this);\r\n                    this.events.dispatch(this.events.change, this);\r\n                }\r\n\r\n                resolve(headEntity);\r\n            });\r\n        });\r\n    }\r\n\r\n    public addGroundPointLonLatAsync(lonLat: LonLat, altitude: number = 10, stopPropagation: boolean = false): Promise<Entity> {\r\n        let groundPos = this._planet!.ellipsoid.lonLatToCartesian(lonLat)!;\r\n        return this._addPoint(groundPos, lonLat, altitude, stopPropagation);\r\n    }\r\n\r\n    public addGroundPoint3vAsync(groundPos: Vec3, altitude: number = 10, stopPropagation: boolean = false): Promise<Entity> {\r\n        let lonLat = this._planet!.ellipsoid.cartesianToLonLat(groundPos)!;\r\n        return this._addPoint(groundPos, lonLat, altitude, stopPropagation);\r\n    }\r\n\r\n    protected _addPoint(groundPos: Vec3, lonLat: LonLat, altitude: number, stopPropagation: boolean = false): Promise<Entity> {\r\n        return new Promise((resolve, reject) => {\r\n            let {\r\n                headEntity,\r\n                groundEntity,\r\n                columnEntity,\r\n                heightLabelEntity\r\n            } = this._createGroundPointer(groundPos, altitude);\r\n            this._groundPointersLayer.add(groundEntity);\r\n            this._columnPointersLayer.add(columnEntity);\r\n            this._headPointersLayer.add(headEntity);\r\n            this._heightsLayer.add(heightLabelEntity);\r\n            this._trackEntity.polyline!.appendPoint3v(headEntity.getCartesian());\r\n\r\n            groundEntity.properties.lonLatEll.lon = lonLat.lon;\r\n            groundEntity.properties.lonLatEll.lat = lonLat.lat;\r\n            groundEntity.properties.lonLatEll.height = lonLat.height;\r\n\r\n            this.getHeightELLAsync(lonLat).then((hEll: number) => {\r\n                groundEntity.properties.lonLatEll.height = lonLat.height = hEll;\r\n                let groundPos = this._planet!.ellipsoid.lonLatToCartesian(lonLat);\r\n                let groundNormal = this._planet!.ellipsoid.getSurfaceNormal3v(groundPos);\r\n                let headPos = groundPos.add(groundNormal.scale(altitude));\r\n                heightLabelEntity.setCartesian3v(headPos);\r\n                heightLabelEntity.label!.setText(`${hEll.toFixed(1)} m`);\r\n                heightLabelEntity.childEntities[0].label!.setText(`${altitude.toFixed(1)} m`);\r\n                headEntity.setCartesian3v(headPos);\r\n                headEntity.properties.columnEntity.ray!.setEndPosition3v(headPos);\r\n                this._trackEntity.polyline?.setPoint3v(headPos, headEntity.properties.index);\r\n                if (!stopPropagation) {\r\n                    this.events.dispatch(this.events.addpoint, headEntity, this);\r\n                    this.events.dispatch(this.events.change, this);\r\n                }\r\n                resolve(headEntity);\r\n            });\r\n        });\r\n    }\r\n\r\n    protected _onLClick = (e: IMouseState) => {\r\n        let groundPos = this._planet!.getCartesianFromPixelTerrain(e.pos);\r\n        if (groundPos) {\r\n            this.addGroundPoint3vAsync(groundPos);\r\n        }\r\n    }\r\n\r\n    protected _onMouseMove = (e: IMouseState) => {\r\n        let mouseCart = this._planet!.getCartesianFromMouseTerrain();\r\n        if (this._pickedGroundEntity) {\r\n            let d = new Vec2(e.x, e.y).sub(this._startClickPos),\r\n                p = this._startEntityPos.add(d);\r\n            let groundCart = this._planet!.getCartesianFromPixelTerrain(p);\r\n            if (groundCart) {\r\n                this.setGroundPointCartesian3v(this._pickedGroundEntity!.properties.index, groundCart);\r\n            }\r\n        } else if (this._pickedHeadEntity) {\r\n\r\n            let cam = this._planet!.camera;\r\n            let p0 = this._pickedHeadEntity.properties.groundEntity.getCartesian();\r\n            let groundNormal = this._planet!.ellipsoid.getSurfaceNormal3v(p0);\r\n            let p1 = p0.add(groundNormal);\r\n            let p2 = p0.add(cam.getRight());\r\n            let px = new Vec3();\r\n\r\n            if (new Ray(cam.eye, e.direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n                let h = Vec3.proj_b_to_a(px, p0);\r\n                let s = h.sub(p0).dot(p0);\r\n                let headPos = p0.add(groundNormal.scale(Math.sign(s) * h.distance(p0)));\r\n                this.setHeadPointCartesian3v(this._pickedHeadEntity.properties.index, headPos);\r\n            }\r\n        }\r\n    }\r\n\r\n    public setHeadPointCartesian3v(entityIndex: number, headPos: Vec3) {\r\n\r\n        const headEntity = this._headPointersLayer.getEntities()[entityIndex];\r\n\r\n        if (headEntity) {\r\n            let groundPos = this._planet!.ellipsoid.lonLatToCartesian(headEntity.properties.lonLatEll);\r\n            let altitude = headPos.length() - groundPos.length();\r\n\r\n            if (altitude <= 0) {\r\n                headPos = groundPos;\r\n                altitude = 0;\r\n            }\r\n\r\n            headEntity.properties.altitude = altitude;\r\n            headEntity.setCartesian3v(headPos);\r\n            headEntity.properties.columnEntity.ray!.setEndPosition3v(headPos);\r\n            headEntity.properties.heightLabelEntity.setCartesian3v(headPos);\r\n            headEntity.properties.heightLabelEntity.childEntities[0].label!.setText(`${altitude.toFixed(1)} m`);\r\n\r\n            this._trackEntity.polyline!.setPoint3v(headPos, entityIndex);\r\n\r\n            this.events.dispatch(this.events.change, this._pickedHeadEntity);\r\n        }\r\n    }\r\n\r\n    public setGroundPointCartesian3v(entityIndex: number, groundPos: Vec3) {\r\n\r\n        let groundEntity = this._groundPointersLayer.getEntities()[entityIndex];\r\n\r\n        if (groundEntity) {\r\n\r\n            let lonLat = this._planet!.ellipsoid.cartesianToLonLat(groundPos);\r\n\r\n            groundEntity.properties.lonLatEll.lon = lonLat.lon;\r\n            groundEntity.properties.lonLatEll.lat = lonLat.lat;\r\n            groundEntity.properties.lonLatEll.height = lonLat.height;\r\n\r\n            let groundNormal = this._planet!.ellipsoid.getSurfaceNormal3v(groundPos);\r\n            let headEntity = groundEntity.properties.headEntity;\r\n            let heightLabelEntity = groundEntity.properties.heightLabelEntity;\r\n            let altitude = groundEntity.properties.altitude;\r\n\r\n            groundEntity.setCartesian3v(groundPos);\r\n\r\n            let headPos = groundPos.add(groundNormal.scale(altitude));\r\n            headEntity.setCartesian3v(headPos);\r\n            headEntity.properties.columnEntity.ray!.setStartPosition3v(groundPos);\r\n            headEntity.properties.columnEntity.ray!.setEndPosition3v(headPos);\r\n            this._trackEntity.polyline?.setPoint3v(headPos, headEntity.properties.index);\r\n\r\n            heightLabelEntity.setCartesian3v(headPos);\r\n            heightLabelEntity.label!.setText(`${lonLat.height.toFixed(1)} m`);\r\n            heightLabelEntity.childEntities[0].label!.setText(`${altitude.toFixed(1)} m`);\r\n\r\n            this.events.dispatch(this.events.change, groundEntity.properties.headEntity);\r\n        }\r\n    }\r\n\r\n    protected _onLUp = (e: IMouseState) => {\r\n\r\n    }\r\n\r\n    protected _onGroundPointerEnter = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"pointer\";\r\n    }\r\n\r\n    protected _onGroundPointerLeave = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"default\";\r\n    }\r\n\r\n    protected _onGroundPointerLDown = (e: IMouseState) => {\r\n        this._clampToGround = false;\r\n        this.renderer!.controls.mouseNavigation.deactivate();\r\n        this._pickedGroundEntity = e.pickingObject;\r\n        const coords = this._pickedGroundEntity!.getCartesian();\r\n        this._startClickPos.set(e.x, e.y);\r\n        this._startEntityPos = this._planet!.getPixelFromCartesian(coords);\r\n    }\r\n\r\n    protected _onGroundPointerLUp = (e: IMouseState) => {\r\n        this._clampToGround = true;\r\n        this.renderer!.controls.mouseNavigation.activate();\r\n        this._pickedGroundEntity = null;\r\n    }\r\n\r\n    protected _onHeadPointerEnter = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"pointer\";\r\n    }\r\n\r\n    protected _onHeadPointerLeave = (e: IMouseState) => {\r\n        e.renderer.handler.canvas!.style.cursor = \"default\";\r\n    }\r\n\r\n    protected _onHeadPointerLDown = (e: IMouseState) => {\r\n        this.renderer!.controls.mouseNavigation.deactivate();\r\n        this._pickedHeadEntity = e.pickingObject;\r\n    }\r\n\r\n    protected _onHeadPointerLUp = (e: IMouseState) => {\r\n        this.renderer!.controls.mouseNavigation.activate();\r\n        this._pickedHeadEntity = null;\r\n    }\r\n\r\n    protected _deactivate() {\r\n\r\n        this.renderer!.events.off(\"ldblclick\", this._onLClick);\r\n        this.renderer!.events.off(\"mousemove\", this._onMouseMove);\r\n        this.renderer!.events.off(\"lup\", this._onLUp);\r\n\r\n        this._groundPointersLayer.events.off(\"mouseenter\", this._onGroundPointerEnter);\r\n        this._groundPointersLayer.events.off(\"mouseleave\", this._onGroundPointerLeave);\r\n        this._groundPointersLayer.events.off(\"ldown\", this._onGroundPointerLDown);\r\n        this._groundPointersLayer.events.off(\"lup\", this._onGroundPointerLUp);\r\n\r\n        this._headPointersLayer.events.off(\"mouseenter\", this._onHeadPointerEnter);\r\n        this._headPointersLayer.events.off(\"mouseleave\", this._onHeadPointerLeave);\r\n        this._headPointersLayer.events.off(\"ldown\", this._onHeadPointerLDown);\r\n        this._headPointersLayer.events.off(\"lup\", this._onHeadPointerLUp);\r\n\r\n        this._trackLayer.remove();\r\n        this._groundPointersLayer.remove();\r\n        this._headPointersLayer.remove();\r\n        this._columnPointersLayer.remove();\r\n        this._trackLayer.remove();\r\n        this._heightsLayer.remove();\r\n        this._pointerLayer.remove();\r\n\r\n        this.clear();\r\n    }\r\n\r\n    public setPointerVisibility(visibility: boolean) {\r\n        this._pointerLayer.setVisibility(visibility);\r\n    }\r\n\r\n    public setVisibility(visibility: boolean) {\r\n        this._groundPointersLayer.setVisibility(visibility);\r\n        this._trackLayer.setVisibility(visibility);\r\n        this._columnPointersLayer.setVisibility(visibility);\r\n        this._headPointersLayer.setVisibility(visibility);\r\n        this._trackLayer.setVisibility(visibility);\r\n        this._heightsLayer.setVisibility(visibility);\r\n        this._pointerLayer.setVisibility(visibility);\r\n    }\r\n\r\n\r\n    public clear() {\r\n        this._headPointersLayer.setEntities([]);\r\n        this._groundPointersLayer.setEntities([]);\r\n        this._columnPointersLayer.setEntities([]);\r\n        this._heightsLayer.setEntities([]);\r\n        this._trackEntity.polyline!.setPath3v([]);\r\n    }\r\n\r\n    public override frame() {\r\n        if (this._clampToGround) {\r\n            let __tempVec__ = new Vec3();\r\n            const nodes = this._planet!._renderedNodes;\r\n            const entities = this._groundPointersLayer.getEntities();\r\n            for (let i = 0; i < entities.length; i++) {\r\n                let ei = entities[i];\r\n                for (let j = 0; j < nodes.length; j++) {\r\n                    let nj = nodes[j];\r\n                    if (nj.segment.isEntityInside(ei)) {\r\n                        nj.segment.getEntityTerrainPoint(ei, __tempVec__);\r\n                        ei.setCartesian3v(__tempVec__);\r\n                        ei.properties.columnEntity.ray!.setStartPosition3v(__tempVec__);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public get ellipsoid(): Ellipsoid | null {\r\n        return this._planet ? this._planet.ellipsoid : null;\r\n    }\r\n}\r\n\r\ntype ElevationProfileSceneEventsList = [\r\n    \"change\", \"addpoint\"\r\n];\r\n\r\nconst ELEVATIONPROFILESCENE_EVENTS: ElevationProfileSceneEventsList = [\r\n    \"change\", \"addpoint\"\r\n];\r\n\r\nexport {ElevationProfileScene};\r\n","import {View} from \"../../ui/View\";\r\nimport type {IViewParams, ViewEventsList} from \"../../ui/View\";\r\nimport {Button} from \"../../ui/Button\";\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\nimport type {EventsHandler} from \"../../Events\";\r\nimport {ElevationProfile} from \"./ElevationProfile\";\r\n\r\nconst TEMPLATE = '<div class=\"og-elevationprofile-buttons\"></div>';\r\n\r\nconst RESET_SVG_ICON = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\r\n<svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" version=\"1.1\">\r\n  <g transform=\"translate(0,-289.0625)\">\r\n    <path d=\"M 15 6 C 10.041282 6 6 10.04128 6 15 C 6 19.95872 10.041282 24 15 24 C 16.586491 24 18.07668 23.58246 19.373047 22.857422 L 17.888672 21.375 C 17.00816 21.772814 16.032235 22 15 22 C 11.122162 22 8 18.87784 8 15 C 8 11.12216 11.122162 8 15 8 C 18.877838 8 22 11.12216 22 15 L 19 15 L 23 20 L 27 15 L 24 15 C 24 10.04128 19.958718 6 15 6 z \" transform=\"translate(0,289.0625)\" />\r\n  </g>\r\n</svg>`;\r\n\r\nconst LIST_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?><svg width=\"800px\" height=\"800px\" viewBox=\"0 0 32 32\" id=\"icon\" xmlns=\"http://www.w3.org/2000/svg\"><defs><style>.cls-1{fill:none;}</style></defs><title>list</title><rect x=\"10\" y=\"6\" width=\"18\" height=\"2\"/><rect x=\"10\" y=\"24\" width=\"18\" height=\"2\"/><rect x=\"10\" y=\"15\" width=\"18\" height=\"2\"/><rect x=\"4\" y=\"15\" width=\"2\" height=\"2\"/><rect x=\"4\" y=\"6\" width=\"2\" height=\"2\"/><rect x=\"4\" y=\"24\" width=\"2\" height=\"2\"/></svg>`;\r\n\r\nconst LOCATION_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->\r\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\r\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 256 256\" enable-background=\"new 0 0 256 256\" xml:space=\"preserve\">\r\n<metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\r\n<g><g><path fill=\"#000000\" d=\"M127,169.4c23.7,0,42.8-18.3,42.8-41s-19.2-41-42.8-41c-23.7,0-42.8,18.4-42.8,41S103.4,169.4,127,169.4z\"/><path fill=\"#000000\" d=\"M221.7,120.2c-3.8-44-40.9-78.9-87-82V15h-16.3v23.6c-44.8,4-80.3,38.5-84.1,81.7H10v15.6h24.3c3.8,43.1,39.3,77.4,84.1,81.7V241h16.3v-23.2c46-3.1,83.2-37.9,87-82H246v-15.6H221.7L221.7,120.2L221.7,120.2z M128,201.6c-42.5,0-76.7-33-76.7-73.4c0-40.4,34.5-73.4,76.7-73.4c42.5,0,76.7,33,76.7,73.4C204.7,168.5,170.5,201.6,128,201.6L128,201.6z\"/></g></g>\r\n</svg>`;\r\n\r\ninterface IElevationProfileButtonsViewParams extends IViewParams {\r\n}\r\n\r\ntype ElevationProfileButtonsViewEventsList = [\"reset\", \"list\", \"location\"];\r\n\r\nconst ELEVATIONPROFILEBUTTONSVIEW_EVENTS: ElevationProfileButtonsViewEventsList = [\"reset\", \"list\", \"location\"];\r\n\r\nexport class ElevationProfileButtonsView extends View<ElevationProfile> {\r\n\r\n    public override events: EventsHandler<ElevationProfileButtonsViewEventsList> & EventsHandler<ViewEventsList>;\r\n    public pointListBtn: ToggleButton;\r\n\r\n    constructor(params: IElevationProfileButtonsViewParams = {}) {\r\n        super({\r\n            ...params,\r\n            template: TEMPLATE\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(ELEVATIONPROFILEBUTTONSVIEW_EVENTS);\r\n\r\n        this.pointListBtn = new ToggleButton({\r\n            classList: [\"og-elevationprofile-button\"],\r\n            icon: LIST_SVG_ICON,\r\n            title: \"Point List\"\r\n        });\r\n\r\n        this.pointListBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this.events.dispatch(this.events.list, isActive);\r\n        });\r\n    }\r\n\r\n    public override render(params: any) {\r\n        super.render(params);\r\n\r\n        let resetBtn = new Button({\r\n            classList: [\"og-elevationprofile-button\"],\r\n            icon: RESET_SVG_ICON,\r\n            title: \"Reset\"\r\n        });\r\n        resetBtn.appendTo(this.el!);\r\n\r\n        resetBtn.events.on(\"click\", () => {\r\n            this.model.clear();\r\n            this.events.dispatch(this.events.reset, this);\r\n        });\r\n\r\n        this.pointListBtn.appendTo(this.el!);\r\n\r\n        let locationBtn = new Button({\r\n            classList: [\"og-elevationprofile-button\", \"og-elevationprofile-button__location\"],\r\n            icon: LOCATION_SVG_ICON,\r\n            title: \"View bounds\"\r\n        });\r\n        locationBtn.appendTo(this.el!);\r\n\r\n        locationBtn.events.on(\"click\", () => {\r\n            this.events.dispatch(this.events.location, this);\r\n        });\r\n\r\n        return this;\r\n    }\r\n}","import {Button} from \"../../ui/Button\";\r\nimport {View} from \"../../ui/View\";\r\nimport {type IDialogParams, Dialog} from \"../../ui/Dialog\";\r\nimport {ElevationProfileScene} from \"./ElevationProfileScene\";\r\nimport {LonLat} from \"../../LonLat\";\r\n\r\nconst LIST_TEMPLATE =\r\n    `<div class=\"og-elevationprofile-list\">\r\n        <textarea placeholder=\"[[lon, lat, height], [lon, lat, height], ..., [lon, lat, height]]\"></textarea>\r\n        <div class=\"og-elevationprofile-list-buttons\"></div>\r\n    </div>`;\r\n\r\ninterface IPointListDialog extends IDialogParams {\r\n    model: ElevationProfileScene;\r\n}\r\n\r\nclass PointListDialog extends Dialog<ElevationProfileScene> {\r\n\r\n    public $textarea: HTMLTextAreaElement | null;\r\n\r\n    constructor(params: IPointListDialog) {\r\n        super({\r\n            title: \"Points List\",\r\n            visible: false,\r\n            resizable: true,\r\n            useHide: true,\r\n            top: 150,\r\n            left: 200,\r\n            width: 400,\r\n            height: 300,\r\n            minHeight: 100,\r\n            minWidth: 100,\r\n            ...params\r\n        });\r\n\r\n        this.$textarea = null;\r\n    }\r\n\r\n    public override render(params?: any): this {\r\n        super.render(params);\r\n\r\n        let view = new View({\r\n            template: LIST_TEMPLATE\r\n        })\r\n        view.appendTo(this.container!);\r\n\r\n        let applyBtn = new Button({\r\n            classList: [\"og-elevationprofile-list-apply\"],\r\n            icon: \"Apply\"\r\n        });\r\n        applyBtn.appendTo(view.select(\".og-elevationprofile-list-buttons\")!);\r\n\r\n        applyBtn.events.on(\"click\", this._onApplyClick);\r\n\r\n        this.$textarea = view.select(\"textarea\");\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _onApplyClick = () => {\r\n        try {\r\n            this.model.clear();\r\n            let coordsArr = JSON.parse(this.$textarea!.value);\r\n            let lonLatArr: LonLat[] = new Array(coordsArr.length);\r\n            for (let i = 0; i < coordsArr.length; i++) {\r\n                let ci = coordsArr[i];\r\n                lonLatArr[i] = new LonLat(ci[0], ci[1], ci[2]);\r\n            }\r\n            this.model.addPointLonLatArrayAsync(lonLatArr);\r\n        } catch (err) {\r\n            console.error(err);\r\n        }\r\n    }\r\n}\r\n\r\nexport {PointListDialog};","import {type IViewParams, View} from '../../ui/View';\r\nimport {distanceFormatExt} from \"../../utils/shared\";\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-elevationprofile-legend\">\r\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__track\">\r\n          <div class=\"og-elevationprofile-square\"></div>\r\n          <div class=\"og-elevationprofile-value\">0</div>\r\n          <div class=\"og-elevationprofile-units\">m</div>\r\n        </div>\r\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__ground\">\r\n          <div class=\"og-elevationprofile-square\"></div>\r\n          <div class=\"og-elevationprofile-value\">0</div>\r\n          <div class=\"og-elevationprofile-units\">m</div>\r\n        </div>\r\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__warning\">        \r\n          <div class=\"og-elevationprofile-square\"></div>\r\n          <div class=\"og-elevationprofile-value\">0</div>\r\n          <div class=\"og-elevationprofile-units\">m</div>\r\n        </div>\r\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__collision\">\r\n          <div class=\"og-elevationprofile-square\"></div>\r\n          <div class=\"og-elevationprofile-value\">0</div>\r\n          <div class=\"og-elevationprofile-units\">m</div>\r\n        </div>\r\n      </div>`;\r\n\r\nexport interface IElevationProfileLegendParams extends IViewParams {\r\n\r\n}\r\n\r\nexport class ElevationProfileLegend extends View<null> {\r\n\r\n    public $groundValue: HTMLElement | null;\r\n    public $trackValue: HTMLElement | null;\r\n    public $warningValue: HTMLElement | null;\r\n    public $collisionValue: HTMLElement | null;\r\n\r\n    public $trackUnits: HTMLElement | null;\r\n    public $groundUnits: HTMLElement | null;\r\n    public $warningUnits: HTMLElement | null;\r\n    public $collisionUnits: HTMLElement | null;\r\n\r\n    constructor(params: IElevationProfileLegendParams = {}) {\r\n        super({\r\n            ...params,\r\n            template: TEMPLATE\r\n        });\r\n\r\n        this.$groundValue = null;\r\n        this.$trackValue = null;\r\n        this.$warningValue = null;\r\n        this.$collisionValue = null;\r\n\r\n        this.$trackUnits = null;\r\n        this.$groundUnits = null;\r\n        this.$warningUnits = null;\r\n        this.$collisionUnits = null;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n        super.render(params);\r\n\r\n        this.$trackValue = this.select(\".og-elevationprofile-legend__track .og-elevationprofile-value\");\r\n        this.$groundValue = this.select(\".og-elevationprofile-legend__ground .og-elevationprofile-value\");\r\n        this.$warningValue = this.select(\".og-elevationprofile-legend__warning .og-elevationprofile-value\");\r\n        this.$collisionValue = this.select(\".og-elevationprofile-legend__collision .og-elevationprofile-value\");\r\n\r\n        this.$trackUnits = this.select(\".og-elevationprofile-legend__track .og-elevationprofile-units\");\r\n        this.$groundUnits = this.select(\".og-elevationprofile-legend__ground .og-elevationprofile-units\");\r\n        this.$warningUnits = this.select(\".og-elevationprofile-legend__warning .og-elevationprofile-units\");\r\n        this.$collisionUnits = this.select(\".og-elevationprofile-legend__collision .og-elevationprofile-units\");\r\n\r\n        return this;\r\n    }\r\n\r\n    public clear() {\r\n        this.$trackValue && (this.$trackValue.innerText = \"0\");\r\n        this.$trackUnits && (this.$trackUnits.innerText = \"m\");\r\n        this.$groundValue && (this.$groundValue.innerText = \"0\");\r\n        this.$groundUnits && (this.$groundUnits.innerText = \"m\");\r\n        this.$warningValue && (this.$warningValue.innerText = \"0\");\r\n        this.$warningUnits && (this.$warningUnits.innerText = \"m\");\r\n        this.$collisionValue && (this.$collisionValue.innerText = \"0\");\r\n        this.$collisionUnits && (this.$collisionUnits.innerText = \"m\");\r\n    }\r\n\r\n    public setTrackLength(trackLength: number) {\r\n        let dist = distanceFormatExt(trackLength);\r\n        this.$trackValue!.innerText = dist[0];\r\n        this.$trackUnits!.innerText = dist[1];\r\n    }\r\n\r\n    public setGroundLength(groundLength: number) {\r\n        let dist = distanceFormatExt(groundLength);\r\n        this.$groundValue!.innerText = dist[0];\r\n        this.$groundUnits!.innerText = dist[1];\r\n    }\r\n\r\n    public setWarningLength(warningLength: number) {\r\n        let warningDist = distanceFormatExt(warningLength);\r\n        this.$warningValue!.innerText = warningDist[0];\r\n        this.$warningUnits!.innerText = warningDist[1];\r\n    }\r\n\r\n    public setCollisionLength(collisionLength: number) {\r\n        let collisionDist = distanceFormatExt(collisionLength);\r\n        this.$collisionValue!.innerText = collisionDist[0];\r\n        this.$collisionUnits!.innerText = collisionDist[1];\r\n    }\r\n}","import {Control, type IControlParams} from \"../Control\";\r\nimport {Dialog} from \"../../ui/Dialog\";\r\nimport {View} from \"../../ui/View\";\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\nimport {ElevationProfileView} from \"./ElevationProfileView\";\r\nimport {ElevationProfileScene} from \"./ElevationProfileScene\";\r\nimport {OldMouseNavigation} from \"../OldMouseNavigation\";\r\nimport {throttle} from \"../../utils/shared\";\r\nimport {ElevationProfileButtonsView} from \"./ElevationProfileButtonsView\";\r\nimport {PointListDialog} from \"./PointListDialog\";\r\nimport type {GroundItem, TrackItem} from \"./ElevationProfile\";\r\nimport {ElevationProfileLegend} from \"./ElevationProfileLegend\";\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-elevationprofile__container\">\r\n      <div class=\"og-elevationprofile__menu\"></div>\r\n      <div class=\"og-elevationprofile__graph\"></div>\r\n    </div>`;\r\n\r\ninterface IElevationProfileGraphParams extends IControlParams {\r\n}\r\n\r\nconst ICON_BUTTON_SVG = `<svg style=\"width: 2em; height: 2em;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M128 896v-158.293333l331.946667-191.573334 160.853333 93.866667L896 480V896H128M896 381.44l-275.2 159.146667-160.853333-92.586667L128 640v-94.293333l331.946667-191.573334 160.853333 93.866667L896 288v93.44z\" fill=\"\" /></svg>`;\r\n\r\nexport class ElevationProfileControl extends Control {\r\n\r\n    protected _toggleBtn: ToggleButton;\r\n    protected _dialog: Dialog<null>;\r\n    protected _graphView: View<null>;\r\n    protected _poiListDialog: PointListDialog;\r\n    protected _elevationProfileView: ElevationProfileView;\r\n    protected _elevationProfileScene: ElevationProfileScene;\r\n    protected _elevationProfileButtonsView: ElevationProfileButtonsView;\r\n    protected _elevationProfileLegend: ElevationProfileLegend;\r\n\r\n    protected _collectProfileThrottled: () => void;\r\n\r\n    constructor(options: IElevationProfileGraphParams = {}) {\r\n        super({\r\n            name: \"ElevationProfileControl\",\r\n            ...options\r\n        });\r\n\r\n        this._elevationProfileScene = new ElevationProfileScene();\r\n        this._elevationProfileView = new ElevationProfileView();\r\n        this._elevationProfileLegend = new ElevationProfileLegend();\r\n        this._elevationProfileButtonsView = new ElevationProfileButtonsView({\r\n            model: this._elevationProfileView.model\r\n        });\r\n\r\n        this._elevationProfileView.events.on(\"pointer\", this._onElevationProfilePointer);\r\n        this._elevationProfileView.events.on(\"dblclick\", this._onElevationProfileDblClick);\r\n        this._elevationProfileView.events.on(\"mouseenter\", this._onElevationProfileMouseEnter);\r\n        this._elevationProfileView.events.on(\"mouseleave\", this._onElevationProfileMouseLeave);\r\n\r\n\r\n        this._dialog = new Dialog({\r\n            title: \"Elevation Profile\",\r\n            visible: false,\r\n            resizable: true,\r\n            useHide: true,\r\n            top: 175,\r\n            left: 65,\r\n            width: 400,\r\n            height: 200,\r\n            minHeight: 100,\r\n            minWidth: 100\r\n        });\r\n\r\n        this._graphView = new View({\r\n            template: TEMPLATE\r\n        });\r\n\r\n        this._poiListDialog = new PointListDialog({\r\n            model: this._elevationProfileScene\r\n        });\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-elevationprofile_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        this._collectProfileThrottled = throttle(() => {\r\n            let points = this._elevationProfileScene.getPointsLonLat();\r\n            this._elevationProfileView.model.collectProfile(points);\r\n        }, 250);\r\n    }\r\n\r\n    override oninit() {\r\n\r\n        this._dialog.appendTo(this.planet!.renderer!.div!);\r\n        this._graphView.appendTo(this._dialog.container!);\r\n\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n        this._dialog.events.on(\"visibility\", (v: boolean) => {\r\n            this._toggleBtn.setActive(v);\r\n            if (v) {\r\n                this.activate();\r\n                this._elevationProfileView.resize();\r\n            } else {\r\n                this.deactivate();\r\n            }\r\n        });\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this._dialog.setVisibility(isActive);\r\n        });\r\n\r\n        this._elevationProfileView.appendTo(this._graphView.select(\".og-elevationprofile__graph\")!);\r\n        this._elevationProfileView.model.bindPlanet(this.planet!);\r\n        this._elevationProfileView.model.events.on(\"clear\", () => {\r\n            this._elevationProfileScene.clear();\r\n            this._elevationProfileLegend.clear();\r\n        });\r\n        this._elevationProfileView.model.events.on(\"startcollecting\", () => {\r\n            this._elevationProfileScene.setPointerVisibility(false);\r\n        });\r\n        this._elevationProfileView.events.on(\"tracklength\", (length: number) => {\r\n            this._elevationProfileLegend.setTrackLength(length);\r\n        });\r\n        this._elevationProfileView.events.on(\"groundlength\", (length: number) => {\r\n            this._elevationProfileLegend.setGroundLength(length);\r\n        });\r\n        this._elevationProfileView.events.on(\"warninglength\", (length: number) => {\r\n            this._elevationProfileLegend.setWarningLength(length);\r\n        });\r\n        this._elevationProfileView.events.on(\"collisionlength\", (length: number) => {\r\n            this._elevationProfileLegend.setCollisionLength(length);\r\n        });\r\n\r\n\r\n        this._poiListDialog.appendTo(this.planet!.renderer!.div!);\r\n        this._poiListDialog.events.on(\"visibility\", (isVisible: boolean) => {\r\n            this._elevationProfileButtonsView.pointListBtn.setActive(isVisible, true);\r\n        });\r\n\r\n        this._elevationProfileLegend.appendTo(this._graphView.select(\".og-elevationprofile__menu\")!);\r\n\r\n        this._elevationProfileButtonsView.appendTo(this._graphView.select(\".og-elevationprofile__menu\")!);\r\n        this._elevationProfileButtonsView.events.on(\"list\", (isActive: boolean) => {\r\n            this._poiListDialog.setVisibility(isActive);\r\n        });\r\n        this._elevationProfileButtonsView.events.on(\"location\", (isActive: boolean) => {\r\n            this._elevationProfileScene.flyExtent();\r\n        });\r\n        this._elevationProfileButtonsView.events.on(\"reset\", (isActive: boolean) => {\r\n            this._elevationProfileScene.setPointerVisibility(false);\r\n        });\r\n\r\n\r\n        this._elevationProfileScene.events.on(\"change\", this._onSceneChange);\r\n    }\r\n\r\n    protected _onSceneChange = () => {\r\n        this._collectProfileThrottled();\r\n    }\r\n\r\n    override onactivate() {\r\n        this.planet && this._elevationProfileScene.bindPlanet(this.planet);\r\n        this.renderer && this.renderer.addNode(this._elevationProfileScene);\r\n    }\r\n\r\n    override ondeactivate() {\r\n        this._poiListDialog.setVisibility(false);\r\n        this._elevationProfileView.model.clear();\r\n        this.renderer && this.renderer.removeNode(this._elevationProfileScene);\r\n        this._dialog.hide();\r\n    }\r\n\r\n    protected _onElevationProfilePointer = (pointerDistance: number, tp0: TrackItem, tp1: TrackItem, gp0: GroundItem, gp1: GroundItem, trackPoiIndex: number, groundPoiIndex: number, elevation: number) => {\r\n\r\n        let lonLat0 = this._elevationProfileScene.getPointLonLat(trackPoiIndex)!;\r\n        let lonLat1 = this._elevationProfileScene.getPointLonLat(trackPoiIndex + 1)!;\r\n\r\n        let cart0 = this.planet!.ellipsoid.lonLatToCartesian(lonLat0),\r\n            cart1 = this.planet!.ellipsoid.lonLatToCartesian(lonLat1);\r\n\r\n        let d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\r\n\r\n        let dir = cart1.sub(cart0);\r\n\r\n        this._elevationProfileScene.setPointerCartesian3v(cart0.add(dir.scale(d)), elevation);\r\n    }\r\n\r\n    protected _onElevationProfileDblClick = (pointerDistance: number, tp0: TrackItem, tp1: TrackItem, gp0: GroundItem, gp1: GroundItem, trackPoiIndex: number, groundPoiIndex: number, elevation: number) => {\r\n        let lonLat0 = this._elevationProfileScene.getPointLonLat(trackPoiIndex)!;\r\n        let lonLat1 = this._elevationProfileScene.getPointLonLat(trackPoiIndex + 1)!;\r\n\r\n        let cart0 = this.planet!.ellipsoid.lonLatToCartesian(lonLat0),\r\n            cart1 = this.planet!.ellipsoid.lonLatToCartesian(lonLat1);\r\n\r\n        let d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\r\n\r\n        let dir = cart1.sub(cart0);\r\n\r\n        let poi = cart0.add(dir.scale(d));\r\n\r\n        this.planet!.camera.flyDistance(poi, this.planet!.camera.eye.distance(poi));\r\n    }\r\n\r\n    protected _onElevationProfileMouseEnter = () => {\r\n        if (this._elevationProfileView.model.pointsReady) {\r\n            this._elevationProfileScene.setPointerVisibility(true);\r\n        }\r\n    }\r\n\r\n    protected _onElevationProfileMouseLeave = () => {\r\n\r\n    }\r\n}\r\n","import {Control, type IControlParams} from \"../Control\";\r\nimport {Dialog} from '../../ui/Dialog';\r\nimport {Slider} from \"../../ui/Slider\";\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\nimport {View} from '../../ui/View';\r\nimport type {AtmosphereParameters} from \"../../shaders/atmos/atmos\";\r\n\r\ninterface IAtmosphereConfigParams extends IControlParams {\r\n\r\n}\r\n\r\nconst TEMPLATE =\r\n    `<div class=\"og-atmosphere og-options-container\">\r\n         \r\n         <div class=\"og-option og-atmosphere-maxOpacity\"></div> \r\n         <div class=\"og-option og-atmosphere-minOpacity\"></div>\r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n         \r\n         <div class=\"og-option og-atmosphere-rayleight\"></div>\r\n         <div class=\"og-option og-atmosphere-mie\"></div>\r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n                  \r\n         <div class=\"og-option og-atmosphere-height\"></div> \r\n         <div class=\"og-option og-atmosphere-bottomRadius\"></div>\r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n         \r\n         <div class=\"og-option og-atmosphere-mieScatteringCoefficient\"></div>  \r\n         <div class=\"og-option og-atmosphere-mieExtinctionCoefficient\"></div>\r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n         \r\n         <div class=\"og-option og-atmosphere-rayleighScatteringCoefficientA\"></div>    \r\n         <div class=\"og-option og-atmosphere-rayleighScatteringCoefficientB\"></div>    \r\n         <div class=\"og-option og-atmosphere-rayleighScatteringCoefficientC\"></div>\r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n         \r\n         <div class=\"og-option og-atmosphere-ozoneAbsorptionCoefficientA\"></div>    \r\n         <div class=\"og-option og-atmosphere-ozoneAbsorptionCoefficientB\"></div>    \r\n         <div class=\"og-option og-atmosphere-ozoneAbsorptionCoefficientC\"></div>\r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n         \r\n         <div class=\"og-option og-atmosphere-ozoneDensityHeight\"></div>    \r\n         <div class=\"og-option og-atmosphere-ozoneDensityWide\"></div>    \r\n         \r\n       <div class=\"og-emptyline-2\"></div>\r\n         \r\n         <div class=\"og-option og-atmosphere-sunAngularRadius\"></div> \r\n         <div class=\"og-option og-atmosphere-sunIntensity\"></div> \r\n         <div class=\"og-option og-atmosphere-earthAlbedo\"></div>\r\n       \r\n    </div>`;\r\n\r\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\r\n<svg width=\"800px\" height=\"800px\" viewBox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path fill=\"#000000\" d=\"M135.688 18.5c-6.798 74.842-23.842 85.39-107.907 59.656 84.85 52.022 73.57 64.954-6.843 96.938 87.743-10.27 103.29 4.89 70.75 87.594 17.805-27.56 32.5-44.498 46.282-54.47-11.813 28.26-18.345 59.274-18.345 91.813 0 84.184 43.71 157.96 109.656 200.376-41.624-43.834-67.686-102.7-67.686-167.875 0-134.923 109.45-244.405 244.375-244.405 30.92 0 60.76 5.762 88 16.25-38.584-26.87-85.517-42.625-136.064-42.625-55.257 0-106.14 18.802-146.562 50.375 4.627-18.783 17.39-38.073 41.03-60.906C190.18 90.942 153.53 95.634 135.69 18.5zm10.03 77.188c5.67.002 11.428 1.247 16.876 3.874 14.506 6.998 22.72 21.81 22 36.938-10.26 10.87-19.507 22.696-27.594 35.344-9.035 2.753-19.075 2.27-28.25-2.156-19.37-9.343-27.5-32.6-18.156-51.97 6.715-13.92 20.638-22.036 35.125-22.03z\"/></svg>`;\r\n\r\n/**\r\n * Helps to set up atmosphere parameters.\r\n */\r\nexport class AtmosphereConfig extends Control {\r\n    protected _toggleBtn: ToggleButton;\r\n    protected _dialog: Dialog<null>;\r\n    protected _panel: View<null>;\r\n\r\n    public $maxOpacity: HTMLElement | null;\r\n    public $minOpacity: HTMLElement | null;\r\n    public $rayleight: HTMLElement | null;\r\n    public $mie: HTMLElement | null;\r\n    public $height: HTMLElement | null;\r\n    public $bottomRadius: HTMLElement | null;\r\n    public $mieScatteringCoefficient: HTMLElement | null;\r\n    public $mieExtinctionCoefficient: HTMLElement | null;\r\n    public $rayleighScatteringCoefficientA: HTMLElement | null;\r\n    public $rayleighScatteringCoefficientB: HTMLElement | null;\r\n    public $rayleighScatteringCoefficientC: HTMLElement | null;\r\n    public $ozoneAbsorptionCoefficientA: HTMLElement | null;\r\n    public $ozoneAbsorptionCoefficientB: HTMLElement | null;\r\n    public $ozoneAbsorptionCoefficientC: HTMLElement | null;\r\n    public $sunAngularRadius: HTMLElement | null;\r\n    public $sunIntensity: HTMLElement | null;\r\n    public $groundAlbedo: HTMLElement | null;\r\n    public $ozoneDensityHeight: HTMLElement | null;\r\n    public $ozoneDensityWide: HTMLElement | null;\r\n\r\n    protected _maxOpacity: Slider;\r\n    protected _minOpacity: Slider;\r\n    protected _rayleight: Slider;\r\n    protected _mie: Slider;\r\n    protected _height: Slider;\r\n    protected _bottomRadius: Slider;\r\n    protected _mieScatteringCoefficient: Slider;\r\n    protected _mieExtinctionCoefficient: Slider;\r\n    protected _rayleighScatteringCoefficientA: Slider;\r\n    protected _rayleighScatteringCoefficientB: Slider;\r\n    protected _rayleighScatteringCoefficientC: Slider;\r\n    protected _ozoneAbsorptionCoefficientA: Slider;\r\n    protected _ozoneAbsorptionCoefficientB: Slider;\r\n    protected _ozoneAbsorptionCoefficientC: Slider;\r\n    protected _sunAngularRadius: Slider;\r\n    protected _sunIntensity: Slider;\r\n    protected _groundAlbedo: Slider;\r\n    protected _ozoneDensityHeight: Slider;\r\n    protected _ozoneDensityWide: Slider;\r\n\r\n    protected _parameters: AtmosphereParameters;\r\n\r\n    constructor(options: IAtmosphereConfigParams = {}) {\r\n        super(options);\r\n\r\n        this.$maxOpacity = null;\r\n        this.$minOpacity = null;\r\n        this.$rayleight = null;\r\n        this.$mie = null;\r\n        this.$height = null;\r\n        this.$bottomRadius = null;\r\n        this.$mieScatteringCoefficient = null;\r\n        this.$mieExtinctionCoefficient = null;\r\n        this.$rayleighScatteringCoefficientA = null;\r\n        this.$rayleighScatteringCoefficientB = null;\r\n        this.$rayleighScatteringCoefficientC = null;\r\n        this.$ozoneAbsorptionCoefficientA = null;\r\n        this.$ozoneAbsorptionCoefficientB = null;\r\n        this.$ozoneAbsorptionCoefficientC = null;\r\n        this.$sunAngularRadius = null;\r\n        this.$sunIntensity = null;\r\n        this.$groundAlbedo = null;\r\n        this.$ozoneDensityHeight = null;\r\n        this.$ozoneDensityWide = null;\r\n\r\n        this._toggleBtn = new ToggleButton({\r\n            classList: [\"og-map-button\", \"og-atmosphere_button\"],\r\n            icon: ICON_BUTTON_SVG\r\n        });\r\n\r\n        this._dialog = new Dialog({\r\n            title: \"Atmosphere Parameters\",\r\n            visible: false,\r\n            useHide: true,\r\n            top: 60,\r\n            left: 60,\r\n            width: 720\r\n        });\r\n\r\n        this._dialog.events.on(\"visibility\", (v: boolean) => {\r\n            this._toggleBtn.setActive(v);\r\n        });\r\n\r\n        this._panel = new View({\r\n            template: TEMPLATE\r\n        });\r\n\r\n        this._maxOpacity = new Slider({\r\n            label: \"Max.opacity\",\r\n            max: 5\r\n        });\r\n\r\n        this._minOpacity = new Slider({\r\n            label: \"Min.opacity\",\r\n            max: 5\r\n        });\r\n\r\n        this._rayleight = new Slider({\r\n            label: \"Rayleight Scale\",\r\n            min: -10.0,\r\n            max: 10.0\r\n        });\r\n\r\n        this._mie = new Slider({\r\n            label: \"Mie Scale\",\r\n            min: -10.0,\r\n            max: 10.0\r\n        });\r\n\r\n        this._height = new Slider({\r\n            label: \"Height\",\r\n            max: 1000000.0\r\n        });\r\n\r\n        this._bottomRadius = new Slider({\r\n            label: \"Planet Radius\",\r\n            max: 5 * 6356752.3142451793\r\n        });\r\n\r\n        this._mieScatteringCoefficient = new Slider({\r\n            label: \"Mie Scattering Coefficient e-6\",\r\n            min: -10 * 3.996,\r\n            max: 10 * 3.996\r\n        });\r\n\r\n        this._mieExtinctionCoefficient = new Slider({\r\n            label: \"Mie Extinction Coef.e-6\",\r\n            min: -10 * 4.440,\r\n            max: 10 * 4.440\r\n        });\r\n\r\n        this._rayleighScatteringCoefficientA = new Slider({\r\n            label: \"Rayleight Scattering Coef A.e-6\",\r\n            min: -10 * 5.802,\r\n            max: 10 * 5.802\r\n        });\r\n\r\n        this._rayleighScatteringCoefficientB = new Slider({\r\n            label: \"Rayleight Scattering Coef B.e-6\",\r\n            min: -10 * 13.558,\r\n            max: 10 * 13.558\r\n        });\r\n\r\n        this._rayleighScatteringCoefficientC = new Slider({\r\n            label: \"Rayleight Scattering Coef C.e-6\",\r\n            min: -10 * 33.100,\r\n            max: 10 * 33.100\r\n        });\r\n\r\n        this._ozoneAbsorptionCoefficientA = new Slider({\r\n            label: \"Ozone absorbtion Coef A.e-6\",\r\n            min: -10 * 0.650,\r\n            max: 10 * 0.650\r\n        });\r\n\r\n        this._ozoneAbsorptionCoefficientB = new Slider({\r\n            label: \"Ozone absorbtion Coef B.e-6\",\r\n            min: -10 * 0.650,\r\n            max: 10 * 1.881\r\n        });\r\n\r\n        this._ozoneAbsorptionCoefficientC = new Slider({\r\n            label: \"Ozone absorbtion Coef C.e-6\",\r\n            min: -10 * 0.085,\r\n            max: 10 * 0.085\r\n        });\r\n\r\n        this._ozoneDensityHeight = new Slider({\r\n            label: \"Ozone Density Height\",\r\n            max: 100 * 25000\r\n        });\r\n\r\n        this._ozoneDensityWide = new Slider({\r\n            label: \"Ozone Density Wide\",\r\n            max: 100 * 25000\r\n        });\r\n\r\n        this._sunAngularRadius = new Slider({\r\n            label: \"Sun Angular Radius\",\r\n            max: 1000 * 0.004685\r\n        });\r\n\r\n        this._sunIntensity = new Slider({\r\n            label: \"Sun Intensity\",\r\n            max: 10 * 1.0\r\n        });\r\n\r\n        this._groundAlbedo = new Slider({\r\n            label: \"Earth Albedo\",\r\n            max: 10 * 0.05\r\n        });\r\n\r\n        this._parameters = {\r\n            ATMOS_HEIGHT: 0,\r\n            RAYLEIGH_SCALE: 0,\r\n            MIE_SCALE: 0,\r\n            GROUND_ALBEDO: 0,\r\n            BOTTOM_RADIUS: 0,\r\n            rayleighScatteringCoefficient_0: 0,\r\n            rayleighScatteringCoefficient_1: 0,\r\n            rayleighScatteringCoefficient_2: 0,\r\n            mieScatteringCoefficient: 0,\r\n            mieExtinctionCoefficient: 0,\r\n            ozoneAbsorptionCoefficient_0: 0,\r\n            ozoneAbsorptionCoefficient_1: 0,\r\n            ozoneAbsorptionCoefficient_2: 0,\r\n            SUN_ANGULAR_RADIUS: 0,\r\n            SUN_INTENSITY: 0,\r\n            ozoneDensityHeight: 0,\r\n            ozoneDensityWide: 0,\r\n        }\r\n    }\r\n\r\n    public override oninit() {\r\n\r\n        this._toggleBtn.appendTo(this.renderer!.div!);\r\n        this._dialog.appendTo(this.renderer!.div!);\r\n        this._panel.appendTo(this._dialog.container!);\r\n\r\n        if (this._panel.el) {\r\n            this.$height = this._panel.el.querySelector(\".og-option.og-atmosphere-height\");\r\n            this.$maxOpacity = this._panel.el.querySelector(\".og-option.og-atmosphere-maxOpacity\");\r\n            this.$minOpacity = this._panel.el.querySelector(\".og-option.og-atmosphere-minOpacity\");\r\n            this.$rayleight = this._panel.el.querySelector(\".og-option.og-atmosphere-rayleight\");\r\n            this.$mie = this._panel.el.querySelector(\".og-option.og-atmosphere-mie\");\r\n            this.$bottomRadius = this._panel.el.querySelector(\".og-option.og-atmosphere-bottomRadius\");\r\n            this.$mieScatteringCoefficient = this._panel.el.querySelector(\".og-option.og-atmosphere-mieScatteringCoefficient\");\r\n            this.$mieExtinctionCoefficient = this._panel.el.querySelector(\".og-option.og-atmosphere-mieExtinctionCoefficient\");\r\n            this.$rayleighScatteringCoefficientA = this._panel.el.querySelector(\".og-option.og-atmosphere-rayleighScatteringCoefficientA\");\r\n            this.$rayleighScatteringCoefficientB = this._panel.el.querySelector(\".og-option.og-atmosphere-rayleighScatteringCoefficientB\");\r\n            this.$rayleighScatteringCoefficientC = this._panel.el.querySelector(\".og-option.og-atmosphere-rayleighScatteringCoefficientC\");\r\n            this.$ozoneAbsorptionCoefficientA = this._panel.el.querySelector(\".og-option.og-atmosphere-ozoneAbsorptionCoefficientA\");\r\n            this.$ozoneAbsorptionCoefficientB = this._panel.el.querySelector(\".og-option.og-atmosphere-ozoneAbsorptionCoefficientB\");\r\n            this.$ozoneAbsorptionCoefficientC = this._panel.el.querySelector(\".og-option.og-atmosphere-ozoneAbsorptionCoefficientC\");\r\n            this.$sunAngularRadius = this._panel.el.querySelector(\".og-option.og-atmosphere-sunAngularRadius\");\r\n            this.$sunIntensity = this._panel.el.querySelector(\".og-option.og-atmosphere-sunIntensity\");\r\n            this.$groundAlbedo = this._panel.el.querySelector(\".og-option.og-atmosphere-earthAlbedo\");\r\n            this.$ozoneDensityHeight = this._panel.el.querySelector(\".og-option.og-atmosphere-ozoneDensityHeight\");\r\n            this.$ozoneDensityWide = this._panel.el.querySelector(\".og-option.og-atmosphere-ozoneDensityWide\");\r\n        }\r\n\r\n        this._toggleBtn.events.on(\"change\", (isActive: boolean) => {\r\n            this._dialog.setVisibility(isActive);\r\n        });\r\n\r\n        this._maxOpacity.appendTo(this.$maxOpacity!);\r\n        this._minOpacity.appendTo(this.$minOpacity!);\r\n        this._height.appendTo(this.$height!);\r\n        this._rayleight.appendTo(this.$rayleight!);\r\n        this._mie.appendTo(this.$mie!);\r\n        this._bottomRadius.appendTo(this.$bottomRadius!);\r\n        this._mieScatteringCoefficient.appendTo(this.$mieScatteringCoefficient!);\r\n        this._mieExtinctionCoefficient.appendTo(this.$mieExtinctionCoefficient!);\r\n        this._rayleighScatteringCoefficientA.appendTo(this.$rayleighScatteringCoefficientA!);\r\n        this._rayleighScatteringCoefficientB.appendTo(this.$rayleighScatteringCoefficientB!);\r\n        this._rayleighScatteringCoefficientC.appendTo(this.$rayleighScatteringCoefficientC!);\r\n        this._ozoneAbsorptionCoefficientA.appendTo(this.$ozoneAbsorptionCoefficientA!);\r\n        this._ozoneAbsorptionCoefficientB.appendTo(this.$ozoneAbsorptionCoefficientB!);\r\n        this._ozoneAbsorptionCoefficientC.appendTo(this.$ozoneAbsorptionCoefficientC!);\r\n        this._sunAngularRadius.appendTo(this.$sunAngularRadius!);\r\n        this._sunIntensity.appendTo(this.$sunIntensity!);\r\n        this._groundAlbedo.appendTo(this.$groundAlbedo!);\r\n        this._ozoneDensityHeight.appendTo(this.$ozoneDensityHeight!);\r\n        this._ozoneDensityWide.appendTo(this.$ozoneDensityWide!);\r\n\r\n        if (this.planet) {\r\n\r\n            this._parameters = this.planet.atmosphereControl.parameters;\r\n\r\n            this._height.value = this._parameters.ATMOS_HEIGHT;\r\n            this._rayleight.value = this._parameters.RAYLEIGH_SCALE;\r\n            this._mie.value = this._parameters.MIE_SCALE;\r\n            this._bottomRadius.value = this._parameters.BOTTOM_RADIUS;\r\n            this._mieScatteringCoefficient.value = this._parameters.mieScatteringCoefficient;\r\n            this._mieExtinctionCoefficient.value = this._parameters.mieExtinctionCoefficient;\r\n            this._rayleighScatteringCoefficientA.value = this._parameters.rayleighScatteringCoefficient_0;\r\n            this._rayleighScatteringCoefficientB.value = this._parameters.rayleighScatteringCoefficient_1;\r\n            this._rayleighScatteringCoefficientC.value = this._parameters.rayleighScatteringCoefficient_2;\r\n            this._ozoneAbsorptionCoefficientA.value = this._parameters.ozoneAbsorptionCoefficient_0;\r\n            this._ozoneAbsorptionCoefficientB.value = this._parameters.ozoneAbsorptionCoefficient_1;\r\n            this._ozoneAbsorptionCoefficientC.value = this._parameters.ozoneAbsorptionCoefficient_2;\r\n            this._sunAngularRadius.value = this._parameters.SUN_ANGULAR_RADIUS;\r\n            this._sunIntensity.value = this._parameters.SUN_INTENSITY;\r\n            this._groundAlbedo.value = this._parameters.GROUND_ALBEDO;\r\n            this._ozoneDensityHeight.value = this._parameters.ozoneDensityHeight;\r\n            this._ozoneDensityWide.value = this._parameters.ozoneDensityWide;\r\n        }\r\n\r\n\r\n        this._minOpacity.value = this.planet!.atmosphereMinOpacity;\r\n        this._minOpacity.events.on(\"change\", (val: number) => {\r\n            this.planet!.atmosphereMinOpacity = val;\r\n        });\r\n\r\n        this._maxOpacity.value = this.planet!.atmosphereMaxOpacity;\r\n        this._maxOpacity.events.on(\"change\", (val: number) => {\r\n            this.planet!.atmosphereMaxOpacity = val;\r\n            //let atmos = this.planet!.renderer!.controls.Atmosphere as Atmosphere;\r\n            //atmos.opacity = val;\r\n        });\r\n\r\n        this._rayleight.events.on(\"change\", (val: number) => {\r\n            this._parameters.RAYLEIGH_SCALE = val;\r\n            this._update();\r\n        });\r\n\r\n        this._mie.events.on(\"change\", (val: number) => {\r\n            this._parameters.MIE_SCALE = val;\r\n            this._update();\r\n        });\r\n\r\n        this._height.events.on(\"change\", (val: number) => {\r\n            this._parameters.ATMOS_HEIGHT = val;\r\n            this._update();\r\n        });\r\n\r\n        this._bottomRadius.events.on(\"change\", (val: number) => {\r\n            this._parameters.BOTTOM_RADIUS = val;\r\n            this._update();\r\n        });\r\n\r\n        this._mieScatteringCoefficient.events.on(\"change\", (val: number) => {\r\n            this._parameters.mieScatteringCoefficient = val;\r\n            this._update();\r\n        });\r\n\r\n        this._mieExtinctionCoefficient.events.on(\"change\", (val: number) => {\r\n            this._parameters.mieExtinctionCoefficient = val;\r\n            this._update();\r\n        });\r\n\r\n        this._rayleighScatteringCoefficientA.events.on(\"change\", (val: number) => {\r\n            this._parameters.rayleighScatteringCoefficient_0 = val;\r\n            this._update();\r\n        });\r\n\r\n        this._rayleighScatteringCoefficientB.events.on(\"change\", (val: number) => {\r\n            this._parameters.rayleighScatteringCoefficient_1 = val;\r\n            this._update();\r\n        });\r\n\r\n        this._rayleighScatteringCoefficientC.events.on(\"change\", (val: number) => {\r\n            this._parameters.rayleighScatteringCoefficient_2 = val;\r\n            this._update();\r\n        });\r\n\r\n        this._ozoneAbsorptionCoefficientA.events.on(\"change\", (val: number) => {\r\n            this._parameters.ozoneAbsorptionCoefficient_0 = val;\r\n            this._update();\r\n        });\r\n\r\n        this._ozoneAbsorptionCoefficientB.events.on(\"change\", (val: number) => {\r\n            this._parameters.ozoneAbsorptionCoefficient_1 = val;\r\n            this._update();\r\n        });\r\n\r\n        this._ozoneAbsorptionCoefficientC.events.on(\"change\", (val: number) => {\r\n            this._parameters.ozoneAbsorptionCoefficient_2 = val;\r\n            this._update();\r\n        });\r\n\r\n        this._sunAngularRadius.events.on(\"change\", (val: number) => {\r\n            this._parameters.SUN_ANGULAR_RADIUS = val;\r\n            this._update();\r\n        });\r\n\r\n        this._sunIntensity.events.on(\"change\", (val: number) => {\r\n            this._parameters.SUN_INTENSITY = val;\r\n            this._update();\r\n        });\r\n\r\n        this._groundAlbedo.events.on(\"change\", (val: number) => {\r\n            this._parameters.GROUND_ALBEDO = val;\r\n            this._update();\r\n        });\r\n\r\n        this._ozoneDensityHeight.events.on(\"change\", (val: number) => {\r\n            this._parameters.ozoneDensityHeight = val;\r\n            this._update();\r\n        });\r\n\r\n        this._ozoneDensityWide.events.on(\"change\", (val: number) => {\r\n            this._parameters.ozoneDensityWide = val;\r\n            this._update();\r\n        });\r\n    }\r\n\r\n    protected _update() {\r\n        if (this.planet) {\r\n            this.planet.atmosphereControl.setParameters(this._parameters);\r\n        }\r\n    }\r\n}\r\n","export const X_COLOR = \"rgb(253,77,77)\";\r\nexport const SEL_X_COLOR = \"rgb(248,115,115)\";\r\n\r\nexport const Y_COLOR = \"rgb(73,73,239)\";\r\nexport const SEL_Y_COLOR = \"rgb(90,90,253)\";\r\n\r\nexport const Z_COLOR = \"rgb(26,122,26)\";\r\nexport const SEL_Z_COLOR = \"rgb(55,191,55)\";\r\n\r\nexport const XZ_COLOR = \"rgba(255,255,255,0.8)\";\r\nexport const SEL_XZ_COLOR = \"rgba(255,255,255,1.0)\";","import {Entity, type IEntityParams} from \"../../entity/Entity\";\r\nimport {X_COLOR} from \"./colors\";\r\nimport {Object3d} from \"../../Object3d\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\n\r\nconst SCALE = 0.1;\r\nconst SCALE_VEC = new Vec3(SCALE, SCALE, SCALE);\r\nconst TIP_LENGTH = 0.17;\r\nconst TIP_RADIUS = 0.04;\r\nconst SPIN_RADIUS = 0.0095;\r\n\r\nconst lineObj = Object3d.createCylinder(SPIN_RADIUS, SPIN_RADIUS, 1.0 - TIP_LENGTH).scale(SCALE_VEC);\r\nconst tipObj = Object3d.createCylinder(0, TIP_RADIUS, TIP_LENGTH, 16, 16,\r\n    false, true, 0, -TIP_LENGTH).scale(SCALE_VEC);\r\n\r\nexport interface IArrowEntityParams extends IEntityParams {\r\n    yaw?: number;\r\n    pitch?: number;\r\n    roll?: number;\r\n    size?: number;\r\n    color?: string,\r\n    properties?: any;\r\n}\r\n\r\nexport class ArrowEntity extends Entity {\r\n\r\n    protected _size: number;\r\n\r\n    constructor(params: IArrowEntityParams = {}) {\r\n\r\n        const scale = 1.0;\r\n\r\n        super({\r\n            independentPicking: true,\r\n            yaw: params.yaw || 0,\r\n            pitch: params.pitch || 0,\r\n            roll: params.roll || 0,\r\n            forceGlobalPosition: true,\r\n            geoObject: {\r\n                color: params.color || X_COLOR,\r\n                scale,\r\n                tag: \"line\",\r\n                object3d: lineObj,\r\n            },\r\n            properties: params.properties\r\n        });\r\n\r\n        this._size = params.size != undefined ? params.size : 1.0;\r\n\r\n        this.appendChild(new Entity({\r\n            yaw: params.yaw || 0,\r\n            pitch: params.pitch || 0,\r\n            roll: params.roll || 0,\r\n            forceGlobalPosition: true,\r\n            geoObject: {\r\n                color: params.color || X_COLOR,\r\n                scale,\r\n                tag: \"tip\",\r\n                object3d: tipObj,\r\n            },\r\n            properties: params.properties\r\n        }));\r\n    }\r\n\r\n    public setSize(size: number) {\r\n        this._size = size;\r\n        const scale = new Vec3(1, (this._size - TIP_LENGTH) / (1.0 - TIP_LENGTH), 1);\r\n        const trans = new Vec3(0, this._size * SCALE, 0);\r\n\r\n        let line = this;\r\n        let tip = line.childEntities[0];\r\n        line.setScale3v(scale);\r\n        tip.geoObject!.setTranslate3v(trans);\r\n    }\r\n\r\n    public setColorHTML(color: string) {\r\n        let line = this;\r\n        let tip = line.childEntities[0];\r\n        line.geoObject!.setColorHTML(color);\r\n        tip.geoObject!.setColorHTML(color);\r\n    }\r\n}","import {Entity, type IEntityParams} from \"../../entity/Entity\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport {SEL_X_COLOR, SEL_Y_COLOR, SEL_Z_COLOR, X_COLOR, Y_COLOR, Z_COLOR} from \"./colors\";\r\nimport {ArrowEntity} from \"./ArrowEntity\";\r\nimport {RADIANS} from \"../../math\";\r\n\r\nexport interface IAxisEntityParams extends IEntityParams {\r\n    size?: number;\r\n}\r\n\r\nexport class MoveAxisEntity extends Entity {\r\n    protected _size: number;\r\n    public override childEntities: ArrowEntity[];\r\n\r\n    constructor(params: IAxisEntityParams = {}) {\r\n        super(params);\r\n        this._size = params.size != undefined ? params.size : 1.0;\r\n        this.childEntities = [];\r\n        this._init();\r\n    }\r\n\r\n    private _init() {\r\n\r\n        let arrowX = new ArrowEntity({\r\n            color: X_COLOR,\r\n            yaw: 0,\r\n            pitch: 0,\r\n            roll: 90 * RADIANS,\r\n            properties: {\r\n                opName: \"move_x\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: X_COLOR,\r\n                    selectColor: SEL_X_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        let arrowY = new ArrowEntity({\r\n            color: Y_COLOR,\r\n            yaw: 0,\r\n            pitch: 0,\r\n            roll: 0,\r\n            properties: {\r\n                opName: \"move_y\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: Y_COLOR,\r\n                    selectColor: SEL_Y_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        let arrowZ = new ArrowEntity({\r\n            color: Z_COLOR,\r\n            yaw: 0,\r\n            pitch: 90 * RADIANS,\r\n            roll: 0,\r\n            properties: {\r\n                opName: \"move_z\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: Z_COLOR,\r\n                    selectColor: SEL_Z_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        this.appendChild(arrowX);\r\n        this.appendChild(arrowY);\r\n        this.appendChild(arrowZ);\r\n\r\n        this.setSize(this._size);\r\n    }\r\n\r\n    public setSize(size: number) {\r\n        this.childEntities[0].setSize(size);\r\n        this.childEntities[1].setSize(size);\r\n        this.childEntities[2].setSize(size);\r\n    }\r\n\r\n    public override setPitch(a: number) {\r\n        let line = this.childEntities[0];\r\n        let tip = line.childEntities[0];\r\n        line.setPitch(a);\r\n        tip.setPitch(a);\r\n\r\n        line = this.childEntities[1];\r\n        tip = line.childEntities[0];\r\n        line.setPitch(a);\r\n        tip.setPitch(a);\r\n\r\n        line = this.childEntities[2];\r\n        tip = line.childEntities[0];\r\n        line.setPitch(a + 90);\r\n        tip.setPitch(a + 90);\r\n    }\r\n\r\n    public override setYaw(a: number) {\r\n        let line = this.childEntities[0];\r\n        let tip = line.childEntities[0];\r\n        line.setYaw(a);\r\n        tip.setYaw(a);\r\n\r\n        line = this.childEntities[1];\r\n        tip = line.childEntities[0];\r\n        line.setYaw(a);\r\n        tip.setYaw(a);\r\n\r\n        line = this.childEntities[2];\r\n        tip = line.childEntities[0];\r\n        line.setYaw(a);\r\n        tip.setYaw(a);\r\n    }\r\n\r\n    public override setRoll(a: number) {\r\n        let line = this.childEntities[0];\r\n        let tip = line.childEntities[0];\r\n        line.setRoll(a + 90);\r\n        tip.setRoll(a + 90);\r\n\r\n        line = this.childEntities[1];\r\n        tip = line.childEntities[0];\r\n        line.setRoll(a);\r\n        tip.setRoll(a);\r\n    }\r\n\r\n    public getY(): Vec3 {\r\n        return this.childEntities[1].getAbsoluteRotation().mulVec3(Vec3.UP).normalize();\r\n    }\r\n}","import {Entity, type IEntityParams} from \"../../entity/Entity\";\r\nimport {Object3d} from \"../../Object3d\";\r\nimport {SEL_XZ_COLOR, XZ_COLOR} from \"./colors\";\r\n\r\nconst planeObj = Object3d.createPlane(1, 1, -0.5, 0, 0.5);\r\n\r\nexport interface IMovePlaneEntityParams extends IEntityParams {\r\n}\r\n\r\nexport class MovePlaneEntity extends Entity {\r\n\r\n    constructor(params: IMovePlaneEntityParams = {}) {\r\n        super(params);\r\n        this._init();\r\n    }\r\n\r\n    private _init() {\r\n        let planeXZ = new Entity({\r\n            independentPicking: true,\r\n            scale: 0.025,\r\n            forceGlobalPosition: true,\r\n            geoObject: {\r\n                color: XZ_COLOR,\r\n                tag: \"plane\",\r\n                object3d: planeObj\r\n            },\r\n            properties: {\r\n                opName: \"move_xz\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: XZ_COLOR,\r\n                    selectColor: SEL_XZ_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        this.appendChild(planeXZ);\r\n    }\r\n}","import {Entity, type IEntityParams} from \"../../entity/Entity\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport {RADIANS} from \"../../math\";\r\nimport {Quat} from \"../../math/Quat\";\r\nimport {SEL_X_COLOR, SEL_Y_COLOR, SEL_Z_COLOR, X_COLOR, Y_COLOR, Z_COLOR} from \"./colors\";\r\n\r\nconst SEG_SIZE = 360;\r\nconst VISIBLESPHERE_DOT_THRESHOLD = 0.95\r\n\r\nexport interface IRotationEntityParams extends IEntityParams {\r\n}\r\n\r\nconst pitchCoords = new Array(SEG_SIZE);\r\nconst yawCoords = new Array(SEG_SIZE);\r\nconst rollCoords = new Array(SEG_SIZE);\r\n\r\nexport class RotateEntity extends Entity {\r\n\r\n    constructor(params: IRotationEntityParams = {}) {\r\n        super(params);\r\n        this._init();\r\n    }\r\n\r\n    private _init() {\r\n\r\n        const length = SEG_SIZE;\r\n\r\n        let pitch = new Entity({\r\n            independentPicking: true,\r\n            polyline: {\r\n                path3v: [Array.from({length}, (_, i) => new Vec3())],\r\n                thickness: 3.1,\r\n                color: X_COLOR,\r\n                isClosed: true\r\n            },\r\n            properties: {\r\n                opName: \"rotate_pitch\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: X_COLOR,\r\n                    selectColor: SEL_X_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        let yaw = new Entity({\r\n            independentPicking: true,\r\n            polyline: {\r\n                path3v: [Array.from({length}, (_, i) => new Vec3())],\r\n                thickness: 2.5,\r\n                color: Y_COLOR,\r\n                isClosed: true\r\n            },\r\n            properties: {\r\n                opName: \"rotate_yaw\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: Y_COLOR,\r\n                    selectColor: SEL_Y_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        let roll = new Entity({\r\n            independentPicking: true,\r\n            polyline: {\r\n                path3v: [Array.from({length}, (_, i) => new Vec3())],\r\n                thickness: 2.5,\r\n                color: Z_COLOR,\r\n                isClosed: true\r\n            },\r\n            properties: {\r\n                opName: \"rotate_roll\",\r\n                noEdit: true,\r\n                style: {\r\n                    color: Z_COLOR,\r\n                    selectColor: SEL_Z_COLOR\r\n                }\r\n            }\r\n        });\r\n\r\n        this.appendChild(pitch);\r\n        this.appendChild(yaw);\r\n        this.appendChild(roll);\r\n    }\r\n\r\n    public override setCartesian3v(cart: Vec3, yaw: number = 0) {\r\n\r\n        super.setCartesian3v(cart);\r\n\r\n        if (this._entityCollection && this._entityCollection.renderNode) {\r\n\r\n            let rn = this._entityCollection.renderNode;\r\n            let cam = rn.renderer!.activeCamera;\r\n\r\n            let qNorthFrame = rn.getFrameRotation(cart).conjugate();\r\n            let r = cam.eye.distance(cart) * 0.15;\r\n\r\n            let qp = Quat.xRotation(0);\r\n            let qy = Quat.yRotation(yaw);\r\n            let qr = Quat.zRotation(0);\r\n\r\n            let qRot = qr.mul(qp).mul(qy).mul(rn.getFrameRotation(cart)).conjugate();\r\n\r\n            for (let i = 0, j = 0, step = 360 / SEG_SIZE; i < SEG_SIZE; i += step, j++) {\r\n                let a = i * RADIANS,\r\n                    cos_a = Math.cos(a),\r\n                    sin_a = Math.sin(a);\r\n\r\n                let pitch_p = qRot.mulVec3(new Vec3(0, sin_a, cos_a)).normalize().scale(r).add(cart);\r\n                let yaw_p = qNorthFrame.mulVec3(new Vec3(cos_a, 0, sin_a)).normalize().scale(r).add(cart);\r\n                let roll_p = qRot.mulVec3(new Vec3(cos_a, sin_a, 0)).normalize().scale(r).add(cart);\r\n\r\n                pitchCoords[j] = pitch_p;\r\n                yawCoords[j] = yaw_p;\r\n                rollCoords[j] = roll_p;\r\n            }\r\n\r\n            this.childEntities[0].polyline!.setPath3v([pitchCoords], undefined, true);\r\n            this.childEntities[1].polyline!.setPath3v([yawCoords], undefined, true);\r\n            this.childEntities[2].polyline!.setPath3v([rollCoords], undefined, true);\r\n\r\n            // Gets whole circle visibility\r\n            let dir_pitch = qRot.mulVec3(new Vec3(1, 0, 0)).normalize();\r\n            let dir_yaw = qNorthFrame.mulVec3(new Vec3(0, 1, 0)).normalize();\r\n            let dir_roll = qRot.mulVec3(new Vec3(0, 0, 1)).normalize();\r\n\r\n            this.childEntities[0].polyline!.setVisibleSphere(cart, Math.abs(dir_pitch.dot(cam.getForward())) > VISIBLESPHERE_DOT_THRESHOLD ? 0.0 : r);\r\n            this.childEntities[1].polyline!.setVisibleSphere(cart, Math.abs(dir_yaw.dot(cam.getForward())) > VISIBLESPHERE_DOT_THRESHOLD ? 0.0 : r);\r\n            this.childEntities[2].polyline!.setVisibleSphere(cart, Math.abs(dir_roll.dot(cam.getForward())) > VISIBLESPHERE_DOT_THRESHOLD ? 0.0 : r);\r\n        }\r\n    }\r\n}","import {Entity, type IEntityParams} from \"../../entity/Entity\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport {SEL_X_COLOR, SEL_Y_COLOR, SEL_Z_COLOR} from \"./colors\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {htmlColorToFloat32Array} from \"../../utils/shared\";\r\nimport type {SegmentPathColor} from \"../../entity/Polyline\";\r\nimport {GeoObjectEditorScene} from \"./GeoObjectEditorScene\";\r\n\r\nconst SEG_SIZE = 20;\r\n\r\nexport interface IAxisTrackEntityParams extends IEntityParams {\r\n}\r\n\r\nexport class AxisTrackEntity extends Entity {\r\n\r\n    constructor(params: IAxisTrackEntityParams = {}) {\r\n        super({...params, forceGlobalPosition: true});\r\n        this._init();\r\n    }\r\n\r\n    private _init() {\r\n\r\n        const length = SEG_SIZE;\r\n\r\n        let lonColors: SegmentPathColor = [],\r\n            latCoords: SegmentPathColor = [],\r\n            yColors: SegmentPathColor = [];\r\n\r\n        let lonCol = htmlColorToFloat32Array(SEL_X_COLOR),\r\n            yCol = htmlColorToFloat32Array(SEL_Y_COLOR),\r\n            latCol = htmlColorToFloat32Array(SEL_Z_COLOR);\r\n\r\n\r\n        for (let i = 0; i < length; i++) {\r\n            let op = 1;\r\n            if (i < 5) {\r\n                let t = i / 5;\r\n                op = 0.5 * (1 - Math.cos(Math.PI * t));\r\n            } else if (i > 15) {\r\n                let t = (i - 15) / 5;\r\n                op = 1 - 0.5 * (1 - Math.cos(Math.PI * t));\r\n            }\r\n            latCoords.push([latCol[0], latCol[1], latCol[2], op]);\r\n            lonColors.push([lonCol[0], lonCol[1], lonCol[2], op]);\r\n            yColors.push([yCol[0], yCol[1], yCol[2], op]);\r\n        }\r\n\r\n        let axisX = new Entity({\r\n            polyline: {\r\n                path3v: [Array.from({length}, (_, i) => new Vec3())],\r\n                thickness: 2.5,\r\n                pathColors: [lonColors],\r\n                isClosed: false\r\n            }\r\n        });\r\n\r\n        let axisY = new Entity({\r\n            polyline: {\r\n                path3v: [Array.from({length}, (_, i) => new Vec3())],\r\n                thickness: 2.5,\r\n                pathColors: [yColors],\r\n                isClosed: false\r\n            }\r\n        });\r\n\r\n        let axisZ = new Entity({\r\n            polyline: {\r\n                path3v: [Array.from({length}, (_, i) => new Vec3())],\r\n                thickness: 2.5,\r\n                pathColors: [latCoords],\r\n                isClosed: false\r\n            }\r\n        });\r\n\r\n        this.appendChild(axisX);\r\n        this.appendChild(axisY);\r\n        this.appendChild(axisZ);\r\n    }\r\n\r\n    public override setCartesian3v(cart: Vec3) {\r\n\r\n        super.setCartesian3v(cart);\r\n\r\n        if (this._entityCollection && this._entityCollection.renderNode) {\r\n\r\n            let rn = this._entityCollection.renderNode as GeoObjectEditorScene;\r\n            let cam = rn.renderer!.activeCamera;\r\n            let r = cam.eye.distance(cart) * 0.05;\r\n\r\n            if (rn.planet) {\r\n\r\n                let yCoords: Vec3[] = [],\r\n                    lonCoords: LonLat[] = [],\r\n                    latCoords: LonLat[] = [];\r\n\r\n                let n = rn.planet.ellipsoid.getSurfaceNormal3v(cart);\r\n\r\n                let ll = this._lonLat;\r\n\r\n                let size = SEG_SIZE / 2;\r\n                for (let i = -size; i < size; i++) {\r\n                    latCoords.push(new LonLat(ll.lon, ll.lat + i, ll.height));\r\n                    lonCoords.push(new LonLat(ll.lon + i, ll.lat, ll.height));\r\n                    yCoords.push(cart.add(n.scaleTo(i * r)));\r\n                }\r\n\r\n                this.childEntities[0].polyline!.setPathLonLatFast([lonCoords],);\r\n                this.childEntities[1].polyline!.setPath3vFast([yCoords]);\r\n                this.childEntities[2].polyline!.setPathLonLatFast([latCoords]);\r\n\r\n            } else {\r\n\r\n                let zCoords: Vec3[] = [],\r\n                    xCoords: Vec3[] = [],\r\n                    yCoords: Vec3[] = [];\r\n\r\n                let y = Vec3.UNIT_Y,\r\n                    x = Vec3.UNIT_X,\r\n                    z = Vec3.UNIT_Z;\r\n\r\n                let size = SEG_SIZE / 2;\r\n                for (let i = -size; i < size; i++) {\r\n                    xCoords.push(cart.add(x.scaleTo(i * r)));\r\n                    yCoords.push(cart.add(y.scaleTo(i * r)));\r\n                    zCoords.push(cart.add(z.scaleTo(i * r)));\r\n                }\r\n\r\n                this.childEntities[0].polyline!.setPath3vFast([xCoords]);\r\n                this.childEntities[1].polyline!.setPath3vFast([yCoords]);\r\n                this.childEntities[2].polyline!.setPath3vFast([zCoords]);\r\n            }\r\n        }\r\n    }\r\n}","import {createEvents, type EventsHandler} from '../../Events';\r\nimport {MAX32} from \"../../math\";\r\nimport {Plane} from \"../../math/Plane\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {RenderNode} from '../../scene/RenderNode';\r\nimport {Vec2} from '../../math/Vec2';\r\nimport {Vec3} from '../../math/Vec3';\r\nimport {Quat} from '../../math/Quat';\r\nimport type {IMouseState} from \"../../renderer/RendererEvents\";\r\nimport {Ellipsoid} from \"../../ellipsoid/Ellipsoid\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {MoveAxisEntity} from \"./MoveAxisEntity\";\r\nimport {MovePlaneEntity} from \"./MovePlaneEntity\";\r\nimport {RotateEntity} from \"./RotateEntity\";\r\nimport {Ray} from \"../../math/Ray\";\r\nimport {Sphere} from \"../../bv/Sphere\";\r\nimport {AxisTrackEntity} from \"./AxisTrackEntity\";\r\nimport {CameraLock} from \"../CameraLock\";\r\nimport {EntityCollection} from \"../../entity/EntityCollection\";\r\n\r\nexport interface IGeoObjectEditorSceneParams {\r\n    planet?: Planet;\r\n    name?: string;\r\n}\r\n\r\nfunction dragSimpleRes(unit: Vec3, eye: Vec3, clickDir: Vec3, direction: Vec3, p0: Vec3, res: Vec3) {\r\n    let p1 = p0.add(Vec3.UP),\r\n        p2 = p0.add(unit);\r\n\r\n    let px = new Vec3();\r\n\r\n    if (new Ray(eye, clickDir).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n        let clickCart = Vec3.proj_b_to_a(px, unit);\r\n        if (new Ray(eye, direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n            let dragCart = Vec3.proj_b_to_a(px, unit);\r\n            let dragVec = dragCart.sub(clickCart);\r\n            res.copy(p0.add(dragVec));\r\n        }\r\n    }\r\n}\r\n\r\ntype GeoObjectSceneEventsList = [\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\",\r\n    \"select\",\r\n    \"unselect\",\r\n    \"change\",\r\n    \"position\",\r\n    \"pitch\",\r\n    \"yaw\",\r\n    \"roll\",\r\n    \"scale\"\r\n];\r\n\r\nclass GeoObjectEditorScene extends RenderNode {\r\n    public events: EventsHandler<GeoObjectSceneEventsList>;\r\n    protected _planet: Planet | null;\r\n    protected _startPos: Vec2 | null;\r\n    protected _startClick: Vec2;\r\n    protected _moveLayer: EntityCollection;\r\n    protected _planeLayer: EntityCollection;\r\n    protected _rotateLayer: EntityCollection;\r\n    protected _axisTrackLayer: EntityCollection;\r\n\r\n    protected _selectedEntity: Entity | null;\r\n    protected _selectedEntityCart: Vec3;\r\n    protected _selectedEntityPitch: number;\r\n    protected _selectedEntityYaw: number;\r\n    protected _selectedEntityRoll: number;\r\n    protected _clickPos: Vec2;\r\n\r\n    protected _axisEntity: MoveAxisEntity;\r\n    protected _planeEntity: MovePlaneEntity;\r\n    protected _rotateEntity: RotateEntity;\r\n    protected _axisTrackEntity: AxisTrackEntity;\r\n\r\n    protected _selectedMove: string | null;\r\n\r\n    protected _ops: Record<string, (mouseState: IMouseState) => void>;\r\n\r\n    protected _axisTrackVisibility: boolean;\r\n\r\n    constructor(options: IGeoObjectEditorSceneParams = {}) {\r\n        super(options.name || 'GeoObjectEditorScene');\r\n\r\n        this.events = createEvents(GEOOBJECTEDITORCENE_EVENTS);\r\n\r\n        this._planet = options.planet || null;\r\n\r\n        this._startPos = null;\r\n        this._startClick = new Vec2();\r\n\r\n        this._axisEntity = new MoveAxisEntity();\r\n        this._planeEntity = new MovePlaneEntity();\r\n        this._rotateEntity = new RotateEntity();\r\n        this._axisTrackEntity = new AxisTrackEntity();\r\n\r\n        this._moveLayer = new EntityCollection({\r\n            scaleByDistance: [0.1, MAX32, 0.1],\r\n            useLighting: false,\r\n            pickingScale: [5, 1.1, 5],\r\n            visibility: false,\r\n            depthOrder: 1000,\r\n        });\r\n\r\n        this._planeLayer = new EntityCollection({\r\n            scaleByDistance: [0.1, MAX32, 0.1],\r\n            useLighting: false,\r\n            visibility: false,\r\n            depthOrder: 1000,\r\n        });\r\n\r\n        this._rotateLayer = new EntityCollection({\r\n            useLighting: false,\r\n            visibility: false,\r\n            depthOrder: 1000,\r\n            pickingScale: 5,\r\n        });\r\n\r\n        this._selectedEntity = null;\r\n        this._clickPos = new Vec2();\r\n        this._selectedEntityCart = new Vec3();\r\n        this._selectedEntityPitch = 0;\r\n        this._selectedEntityYaw = 0;\r\n        this._selectedEntityRoll = 0;\r\n        this._selectedMove = null;\r\n\r\n        this._axisTrackVisibility = false;\r\n\r\n        this._axisTrackLayer = new EntityCollection({\r\n            useLighting: false,\r\n            visibility: false,\r\n            pickingScale: 5,\r\n            pickingEnabled: false,\r\n            opacity: 0.6\r\n        });\r\n\r\n        this._ops = {\r\n            move_x: this._moveX,\r\n            move_y: this._moveY,\r\n            move_z: this._moveZ,\r\n            move_xz: this._moveXZ,\r\n            move_xy: this._moveXY,\r\n            move_zy: this._moveZY,\r\n            rotate_pitch: this._rotatePitch,\r\n            rotate_yaw: this._rotateYaw,\r\n            rotate_roll: this._rotateRoll,\r\n            scale: this._scale,\r\n            scale_x: this._scaleX,\r\n            scale_y: this._scaleY,\r\n            scale_z: this._scaleZ,\r\n        }\r\n    }\r\n\r\n    get ellipsoid(): Ellipsoid | undefined {\r\n        if (this._planet) {\r\n            return this._planet.ellipsoid;\r\n        }\r\n    }\r\n\r\n    get planet(): Planet | null {\r\n        return this._planet;\r\n    }\r\n\r\n    public bindPlanet(planet: Planet) {\r\n        this._planet = planet;\r\n    }\r\n\r\n    public override init() {\r\n        this.activate();\r\n    }\r\n\r\n    public override onremove() {\r\n        this.deactivate();\r\n    }\r\n\r\n    protected _addAxisLayers() {\r\n        this._moveLayer.addTo(this);\r\n        this._planeLayer.addTo(this);\r\n        this._rotateLayer.addTo(this);\r\n        this._axisTrackLayer.addTo(this);\r\n\r\n        this._moveLayer.add(this._axisEntity);\r\n        this._moveLayer.events.on(\"mouseenter\", this._onAxisLayerMouseEnter);\r\n        this._moveLayer.events.on(\"mouseleave\", this._onAxisLayerMouseLeave);\r\n        this._moveLayer.events.on(\"lup\", this._onAxisLayerLUp);\r\n        this._moveLayer.events.on(\"ldown\", this._onAxisLayerLDown);\r\n\r\n        this._planeLayer.add(this._planeEntity);\r\n        this._planeLayer.events.on(\"mouseenter\", this._onPlaneLayerMouseEnter);\r\n        this._planeLayer.events.on(\"mouseleave\", this._onPlaneLayerMouseLeave);\r\n        this._planeLayer.events.on(\"lup\", this._onPlaneLayerLUp);\r\n        this._planeLayer.events.on(\"ldown\", this._onPlaneLayerLDown);\r\n\r\n        this._rotateLayer.add(this._rotateEntity);\r\n        this._rotateLayer.events.on(\"mouseenter\", this._onRotateLayerMouseEnter);\r\n        this._rotateLayer.events.on(\"mouseleave\", this._onRotateLayerMouseLeave);\r\n        this._rotateLayer.events.on(\"lup\", this._onRotateLayerLUp);\r\n        this._rotateLayer.events.on(\"ldown\", this._onRotateLayerLDown);\r\n\r\n        this._axisTrackLayer.add(this._axisTrackEntity);\r\n    }\r\n\r\n    protected _onAxisLayerMouseEnter = (e: IMouseState) => {\r\n        this.renderer!.handler!.canvas!.style.cursor = \"pointer\";\r\n        e.pickingObject.setColorHTML(e.pickingObject.properties.style.selectColor);\r\n    }\r\n\r\n    protected _onAxisLayerMouseLeave = (e: IMouseState) => {\r\n        this.renderer!.handler!.canvas!.style.cursor = \"default\";\r\n        e.pickingObject.setColorHTML(e.pickingObject.properties.style.color);\r\n    }\r\n\r\n    protected _navActivate() {\r\n        if (this.renderer) {\r\n            if (this.renderer.controls.mouseNavigation) {\r\n                this.renderer.controls.mouseNavigation.activate();\r\n            }\r\n            if (this.renderer.controls.SimpleNavigation) {\r\n                this.renderer.controls.SimpleNavigation.activate();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _navDeactivate() {\r\n        if (this.renderer) {\r\n            if (this.renderer.controls.mouseNavigation) {\r\n                this.renderer.controls.mouseNavigation.deactivate();\r\n            }\r\n            if (this.renderer.controls.SimpleNavigation) {\r\n                this.renderer.controls.SimpleNavigation.deactivate();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onAxisLayerLUp = (e: IMouseState) => {\r\n        this._selectedMove = null;\r\n        this._navActivate();\r\n        this._setAxisTrackVisibility(false);\r\n    }\r\n\r\n    protected _onAxisLayerLDown = (e: IMouseState) => {\r\n        this._clickPos = e.pos.clone();\r\n\r\n        if (this._selectedEntity) {\r\n            this._selectedEntityCart = this._selectedEntity.getAbsoluteCartesian();\r\n            this._setAxisTrackVisibility(true);\r\n        }\r\n\r\n        this._selectedMove = e.pickingObject.properties.opName;\r\n        this._navDeactivate();\r\n    }\r\n\r\n    protected _onPlaneLayerMouseEnter = (e: IMouseState) => {\r\n        this.renderer!.handler!.canvas!.style.cursor = \"pointer\";\r\n        e.pickingObject.geoObject.setColorHTML(e.pickingObject.properties.style.selectColor);\r\n    }\r\n\r\n    protected _onPlaneLayerMouseLeave = (e: IMouseState) => {\r\n        this.renderer!.handler!.canvas!.style.cursor = \"default\";\r\n        e.pickingObject.geoObject.setColorHTML(e.pickingObject.properties.style.color);\r\n    }\r\n\r\n    protected _onPlaneLayerLUp = (e: IMouseState) => {\r\n        this._selectedMove = null;\r\n        this._navActivate();\r\n        this._setAxisTrackVisibility(false);\r\n    }\r\n\r\n    protected _onPlaneLayerLDown = (e: IMouseState) => {\r\n        this._clickPos = e.pos.clone();\r\n\r\n        if (this._selectedEntity) {\r\n            this._selectedEntityCart = this._selectedEntity.getAbsoluteCartesian();\r\n            this._setAxisTrackVisibility(true);\r\n        }\r\n\r\n        this._selectedMove = e.pickingObject.properties.opName;\r\n        this._navDeactivate();\r\n    }\r\n\r\n    protected _onRotateLayerMouseEnter = (e: IMouseState) => {\r\n        this.renderer!.handler!.canvas!.style.cursor = \"pointer\";\r\n        e.pickingObject.polyline!.setColorHTML(e.pickingObject.properties.style.selectColor);\r\n    }\r\n\r\n    protected _onRotateLayerMouseLeave = (e: IMouseState) => {\r\n        this.renderer!.handler!.canvas!.style.cursor = \"default\";\r\n        e.pickingObject.polyline!.setColorHTML(e.pickingObject.properties.style.color);\r\n    }\r\n\r\n    protected _onRotateLayerLUp = (e: IMouseState) => {\r\n        this._selectedMove = null;\r\n        this._navActivate();\r\n    }\r\n\r\n    protected _onRotateLayerLDown = (e: IMouseState) => {\r\n        this._clickPos = e.pos.clone();\r\n\r\n        if (this._selectedEntity) {\r\n            this._selectedEntityCart = this._selectedEntity.getAbsoluteCartesian();\r\n            if (this._selectedEntity) {\r\n                this._selectedEntityPitch = this._selectedEntity.getAbsolutePitch();\r\n                this._selectedEntityYaw = this._selectedEntity.getAbsoluteYaw();\r\n                this._selectedEntityRoll = this._selectedEntity.getAbsoluteRoll();\r\n            }\r\n        }\r\n\r\n        this._selectedMove = e.pickingObject.properties.opName;\r\n        this._navDeactivate();\r\n    }\r\n\r\n    protected _onMouseMove = (e: IMouseState) => {\r\n        if (this._selectedEntity && this._selectedMove && this._ops[this._selectedMove]) {\r\n            this._ops[this._selectedMove](e);\r\n        }\r\n    }\r\n\r\n    protected _removeAxisLayers() {\r\n        this._moveLayer.remove();\r\n        this._planeLayer.remove();\r\n        this._rotateLayer.remove()\r\n    }\r\n\r\n    public activate() {\r\n        this.renderer!.events.on(\"lclick\", this._onLclick);\r\n        this.renderer!.events.on(\"mousemove\", this._onMouseMove);\r\n        this._addAxisLayers();\r\n    }\r\n\r\n    protected deactivate() {\r\n        this.renderer!.events.off(\"lclick\", this._onLclick);\r\n        this.renderer!.events.off(\"mousemove\", this._onMouseMove);\r\n        this._removeAxisLayers();\r\n        this.clear();\r\n    }\r\n\r\n    protected _setAxisTrackVisibility(visibility: boolean) {\r\n        if (visibility !== this._axisTrackVisibility) {\r\n            this._axisTrackVisibility = visibility;\r\n            this._axisTrackLayer.setVisibility(visibility);\r\n        }\r\n    }\r\n\r\n    public setVisibility(visibility: boolean) {\r\n        this._moveLayer.setVisibility(visibility);\r\n        this._planeLayer.setVisibility(visibility);\r\n        this._rotateLayer.setVisibility(visibility);\r\n        this.unlockView();\r\n    }\r\n\r\n    public readyToEdit(entity: Entity): boolean {\r\n        return !entity.properties || !entity.properties.noEdit\r\n    }\r\n\r\n    public select(entity: Entity) {\r\n        if ((!this._selectedEntity || this._selectedEntity && !entity.isEqual(this._selectedEntity)) && this.readyToEdit(entity)) {\r\n            if (this._selectedEntity) {\r\n                this.unselect();\r\n            }\r\n            this._selectedEntity = entity;\r\n\r\n            this.renderer && this.renderer.setRelativeCenter();\r\n\r\n            this.setVisibility(true);\r\n            this.events.dispatch(this.events.select, this._selectedEntity);\r\n        }\r\n    }\r\n\r\n    public unselect() {\r\n        this.setVisibility(false);\r\n        let selectedEntity = this._selectedEntity;\r\n        this._selectedEntity = null;\r\n        this.events.dispatch(this.events.unselect, selectedEntity);\r\n    }\r\n\r\n    protected _onLclick = (e: IMouseState) => {\r\n        if (e.pickingObject && (e.pickingObject instanceof Entity)) {\r\n            this.select(e.pickingObject);\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        this.removeEntityCollection(this._moveLayer);\r\n        this.removeEntityCollection(this._planeLayer);\r\n        this.removeEntityCollection(this._rotateLayer);\r\n    }\r\n\r\n    public override frame() {\r\n        if (this._selectedEntity) {\r\n            let cart = this._selectedEntity.getAbsoluteCartesian();\r\n            this._axisEntity.setCartesian3v(cart);\r\n            this._planeEntity.setCartesian3v(cart);\r\n            this._rotateEntity.setCartesian3v(cart, this._selectedEntity.getAbsoluteYaw());\r\n            this._axisTrackEntity.setCartesian3v(cart);\r\n        }\r\n    }\r\n\r\n    protected get _ellipsoid(): Ellipsoid | null {\r\n        return this._planet ? this._planet.ellipsoid : null;\r\n    }\r\n\r\n    protected _moveX = (e: IMouseState) => {\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        let px = new Vec3();\r\n\r\n        if (this.planet) {\r\n            let clickCart = new Ray(cam.eye, clickDir).hitSphere(new Sphere(p0.length(), new Vec3()))!;\r\n            let currCart = new Ray(cam.eye, e.direction).hitSphere(new Sphere(p0.length(), new Vec3()))!;\r\n\r\n            if (!currCart) return;\r\n\r\n            let rot = Quat.getRotationBetweenVectors(\r\n                clickCart.normal(),\r\n                currCart.normal()\r\n            );\r\n\r\n            px = rot.mulVec3(p0);\r\n\r\n            if (this._ellipsoid) {\r\n                let p0_lonLat = this._ellipsoid.cartesianToLonLat(p0)!;\r\n                let px_lonLat = this._ellipsoid.cartesianToLonLat(px)!;\r\n\r\n                this._ellipsoid.lonLatToCartesianRes(new LonLat(px_lonLat.lon, p0_lonLat.lat, p0_lonLat.height), px);\r\n            }\r\n        } else {\r\n            dragSimpleRes(Vec3.UNIT_X, cam.eye, clickDir, e.direction, p0, px);\r\n        }\r\n\r\n        this._selectedEntity.setAbsoluteCartesian3v(px);\r\n\r\n        this.events.dispatch(this.events.position, px, this._selectedEntity);\r\n        this.events.dispatch(this.events.change, this._selectedEntity);\r\n    }\r\n\r\n    protected _moveY = (e: IMouseState) => {\r\n\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n        let groundNormal = Vec3.UP;\r\n        if (this.planet) {\r\n            groundNormal = this._axisEntity.getY();\r\n        }\r\n        let p1 = p0.add(groundNormal);\r\n        let p2 = p0.add(cam.getRight());\r\n        let px = new Vec3();\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        if (new Ray(cam.eye, clickDir).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n            let clickCart = Vec3.proj_b_to_a(px, groundNormal);\r\n            if (new Ray(cam.eye, e.direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), px) === Ray.INSIDE) {\r\n                let dragCart = Vec3.proj_b_to_a(px, groundNormal);\r\n                let dragVec = dragCart.sub(clickCart);\r\n                let pos = this._selectedEntityCart.add(dragVec);\r\n                this._selectedEntity.setAbsoluteCartesian3v(pos);\r\n                this.events.dispatch(this.events.position, px, this._selectedEntity);\r\n                this.events.dispatch(this.events.change, this._selectedEntity);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _moveZ = (e: IMouseState) => {\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        let px = new Vec3();\r\n\r\n        if (this.planet) {\r\n\r\n            let clickCart = new Ray(cam.eye, clickDir).hitSphere(new Sphere(p0.length(), new Vec3()))!;\r\n            let currCart = new Ray(cam.eye, e.direction).hitSphere(new Sphere(p0.length(), new Vec3()))!;\r\n\r\n            if (!currCart) return;\r\n\r\n            let rot = Quat.getRotationBetweenVectors(\r\n                clickCart.normal(),\r\n                currCart.normal()\r\n            );\r\n\r\n            px = rot.mulVec3(p0);\r\n\r\n            if (this._ellipsoid) {\r\n                let p0_lonLat = this._ellipsoid.cartesianToLonLat(p0)!;\r\n                let px_lonLat = this._ellipsoid.cartesianToLonLat(px)!;\r\n\r\n                this._ellipsoid.lonLatToCartesianRes(new LonLat(p0_lonLat.lon, px_lonLat.lat, p0_lonLat.height), px);\r\n            }\r\n        } else {\r\n            dragSimpleRes(Vec3.UNIT_Z, cam.eye, clickDir, e.direction, p0, px);\r\n        }\r\n\r\n        this._selectedEntity.setAbsoluteCartesian3v(px);\r\n\r\n        this.events.dispatch(this.events.position, px, this._selectedEntity);\r\n        this.events.dispatch(this.events.change, this._selectedEntity);\r\n    }\r\n\r\n    protected _moveXZ = (e: IMouseState) => {\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        let px = new Vec3();\r\n\r\n        if (this.planet) {\r\n\r\n            let clickCart = new Ray(cam.eye, clickDir).hitSphere(new Sphere(p0.length(), new Vec3()))!;\r\n            let currCart = new Ray(cam.eye, e.direction).hitSphere(new Sphere(p0.length(), new Vec3()))!;\r\n\r\n            if (!currCart) return;\r\n\r\n            let rot = Quat.getRotationBetweenVectors(\r\n                clickCart.normal(),\r\n                currCart.normal()\r\n            );\r\n\r\n            px = rot.mulVec3(p0);\r\n\r\n            if (this._ellipsoid) {\r\n                let lonLat = this._ellipsoid.cartesianToLonLat(px)!;\r\n                let height = this._selectedEntity.getLonLat().height;\r\n\r\n                this._ellipsoid.lonLatToCartesianRes(new LonLat(lonLat.lon, lonLat.lat, height), px);\r\n            }\r\n        } else {\r\n            let p1 = p0.add(Vec3.UNIT_X),\r\n                p2 = p0.add(Vec3.UNIT_Z);\r\n            let clickCart = new Vec3(),\r\n                dragCart = new Vec3();\r\n            if (new Ray(cam.eye, clickDir).hitPlaneRes(Plane.fromPoints(p0, p1, p2), clickCart) === Ray.INSIDE) {\r\n                if (new Ray(cam.eye, e.direction).hitPlaneRes(Plane.fromPoints(p0, p1, p2), dragCart) === Ray.INSIDE) {\r\n                    let dragVec = dragCart.sub(clickCart);\r\n                    px = p0.add(dragVec);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._selectedEntity.setAbsoluteCartesian3v(px);\r\n\r\n        this.events.dispatch(this.events.position, px, this._selectedEntity);\r\n        this.events.dispatch(this.events.change, this._selectedEntity);\r\n    }\r\n\r\n    protected _moveXY = (e: IMouseState) => {\r\n        console.log(\"moveXY\");\r\n    }\r\n\r\n    protected _moveZY = (e: IMouseState) => {\r\n        console.log(\"moveZY\");\r\n    }\r\n\r\n    public override getFrameRotation(cartesian: Vec3): Quat {\r\n        return this._planet ? this._planet.getFrameRotation(cartesian) : super.getFrameRotation(cartesian);\r\n    }\r\n\r\n    protected _rotatePitch = (e: IMouseState) => {\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n\r\n        let qp = Quat.xRotation(0);\r\n        let qy = Quat.yRotation(this._selectedEntity.getYaw());\r\n        let qr = Quat.zRotation(0);\r\n\r\n        let qRot = qr.mul(qp).mul(qy).mul(this.getFrameRotation(p0)).conjugate();\r\n\r\n        //let norm = qNorthFrame.mulVec3(new Vec3(1, 0, 0)).normalize();\r\n        let norm = qRot.mulVec3(new Vec3(1, 0, 0)).normalize();\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        let pl = new Plane(p0, norm);\r\n\r\n        let clickCart = new Vec3(),\r\n            dragCart = new Vec3();\r\n\r\n        if (new Ray(cam.eye, clickDir).hitPlaneRes(pl, clickCart) === Ray.INSIDE) {\r\n            if (new Ray(cam.eye, e.direction).hitPlaneRes(pl, dragCart) === Ray.INSIDE) {\r\n\r\n                let c0 = clickCart.sub(p0).normalize(),\r\n                    c1 = dragCart.sub(p0).normalize();\r\n\r\n                let sig = Math.sign(c0.cross(c1).dot(norm));\r\n                let angle = Math.acos(c0.dot(c1));\r\n                let deg = this._selectedEntityPitch + sig * angle;\r\n                this._selectedEntity.setAbsolutePitch(deg);\r\n\r\n                this.events.dispatch(this.events.pitch, deg, this._selectedEntity);\r\n                this.events.dispatch(this.events.change, this._selectedEntity);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _rotateYaw = (e: IMouseState) => {\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n        let qNorthFrame = this.getFrameRotation(p0).conjugate();\r\n        let norm = qNorthFrame.mulVec3(new Vec3(0, 1, 0)).normalize();\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        let pl = new Plane(p0, norm);\r\n\r\n        let clickCart = new Vec3(),\r\n            dragCart = new Vec3();\r\n\r\n        if (new Ray(cam.eye, clickDir).hitPlaneRes(pl, clickCart) === Ray.INSIDE) {\r\n            if (new Ray(cam.eye, e.direction).hitPlaneRes(pl, dragCart) === Ray.INSIDE) {\r\n\r\n                let c0 = clickCart.sub(p0).normalize(),\r\n                    c1 = dragCart.sub(p0).normalize();\r\n\r\n                let sig = Math.sign(c1.cross(c0).dot(norm));\r\n                let angle = Math.acos(c0.dot(c1));\r\n                let deg = this._selectedEntityYaw + sig * angle;\r\n                this._selectedEntity.setAbsoluteYaw(deg);\r\n\r\n                this.events.dispatch(this.events.yaw, deg, this._selectedEntity);\r\n                this.events.dispatch(this.events.change, this._selectedEntity);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _rotateRoll = (e: IMouseState) => {\r\n        if (!this._selectedEntity) return;\r\n\r\n        let cam = this.renderer!.activeCamera;\r\n        let p0 = this._selectedEntityCart;\r\n        let qNorthFrame = this.getFrameRotation(p0).conjugate();\r\n\r\n        let qp = Quat.xRotation(0);\r\n        let qy = Quat.yRotation(this._selectedEntity.getYaw());\r\n        let qr = Quat.zRotation(0);\r\n\r\n        let qRot = qr.mul(qp).mul(qy).mul(this.getFrameRotation(p0)).conjugate();\r\n\r\n        //let norm = qNorthFrame.mulVec3(new Vec3(0, 0, 1)).normalize();\r\n        let norm = qRot.mulVec3(new Vec3(0, 0, 1)).normalize();\r\n\r\n        let clickDir = cam.unproject(this._clickPos.x, this._clickPos.y);\r\n\r\n        let pl = new Plane(p0, norm);\r\n\r\n        let clickCart = new Vec3(),\r\n            dragCart = new Vec3();\r\n\r\n        if (new Ray(cam.eye, clickDir).hitPlaneRes(pl, clickCart) === Ray.INSIDE) {\r\n            if (new Ray(cam.eye, e.direction).hitPlaneRes(pl, dragCart) === Ray.INSIDE) {\r\n\r\n                let c0 = clickCart.sub(p0).normalize(),\r\n                    c1 = dragCart.sub(p0).normalize();\r\n\r\n                let sig = Math.sign(c0.cross(c1).dot(norm));\r\n                let angle = Math.acos(c0.dot(c1));\r\n                let deg = this._selectedEntityRoll + sig * angle;\r\n                this._selectedEntity.setAbsoluteRoll(deg);\r\n\r\n                this.events.dispatch(this.events.roll, deg, this._selectedEntity);\r\n                this.events.dispatch(this.events.change, this._selectedEntity);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _scale = (e: IMouseState) => {\r\n        let scale = 1;\r\n        this.events.dispatch(this.events.scale, scale, this._selectedEntity);\r\n        this.events.dispatch(this.events.change, this._selectedEntity);\r\n    }\r\n\r\n    protected _scaleX = (e: IMouseState) => {\r\n    }\r\n\r\n    protected _scaleY = (e: IMouseState) => {\r\n    }\r\n\r\n    protected _scaleZ = (e: IMouseState) => {\r\n    }\r\n\r\n    public getSelectedEntity(): Entity | null {\r\n        return this._selectedEntity;\r\n    }\r\n\r\n    public lockView() {\r\n        if (this.renderer && this._selectedEntity) {\r\n            let camLock = this.renderer.controls.CameraLock as CameraLock;\r\n            camLock.lockView(this._selectedEntity);\r\n        }\r\n    }\r\n\r\n    public unlockView() {\r\n        if (this.renderer && this._selectedEntity) {\r\n            let camLock = this.renderer.controls.CameraLock as CameraLock;\r\n            if (camLock) {\r\n                camLock.unlockView();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nconst GEOOBJECTEDITORCENE_EVENTS: GeoObjectSceneEventsList = [\r\n    \"mousemove\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchmove\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\",\r\n    \"select\",\r\n    \"unselect\",\r\n    \"change\",\r\n    \"position\",\r\n    \"pitch\",\r\n    \"yaw\",\r\n    \"roll\",\r\n    \"scale\"\r\n];\r\n\r\nexport {GeoObjectEditorScene};\r\n","import type {EventsHandler} from \"../Events\";\r\nimport {View} from './View';\r\nimport type {IViewParams, ViewEventsList} from './View';\r\nimport {stringTemplate, toFixedMax} from '../utils/shared';\r\n\r\ninterface IInputParams extends IViewParams {\r\n    label?: string;\r\n    value?: string;\r\n    min?: number;\r\n    max?: number;\r\n    type?: string;\r\n    maxFixed?: number;\r\n}\r\n\r\ntype InputEventsList = [\"change\"];\r\n\r\nconst SLIDER_EVENTS: InputEventsList = [\"change\"];\r\n\r\nconst TEMPLATE = `<div class=\"og-input\">\r\n      <div class=\"og-input-label\">{label}</div>\r\n      <input type=\"{type}\"/>\r\n    </div>`;\r\n\r\nclass Input extends View<null> {\r\n\r\n    public override events: EventsHandler<InputEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    protected _value: string;\r\n\r\n    protected $label: HTMLElement | null;\r\n    protected $input: HTMLInputElement | null;\r\n\r\n    protected _maxFixed: number;\r\n\r\n    constructor(options: IInputParams = {}) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                label: options.label || \"\",\r\n                type: options.type || \"text\"\r\n            })\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(SLIDER_EVENTS);\r\n\r\n        this._value = options.value || \"\";\r\n\r\n        this._maxFixed = options.maxFixed != undefined ? options.maxFixed : -1;\r\n\r\n        this.$label = null;\r\n        this.$input = null;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n\r\n        super.render(params);\r\n\r\n        this.$label = this.select(\".og-input-label\")!;\r\n        if (this.$label.innerHTML === \"\") {\r\n            this.$label.style.display = \"none\";\r\n        }\r\n        this.$input = this.select<HTMLInputElement>(\"input\");\r\n\r\n        this._initEvents();\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _onResize = () => {\r\n    }\r\n\r\n    public set value(val: string | number) {\r\n        if (val !== this._value) {\r\n            if (typeof val === \"number\") {\r\n                this._value = toFixedMax(val, this._maxFixed);\r\n            } else {\r\n                this._value = val;\r\n            }\r\n            if (this.$input) {\r\n                this.$input.value = this._value;\r\n            }\r\n            this.events.dispatch(this.events.change, this._value, this);\r\n        }\r\n    }\r\n\r\n    protected _setValue(val: string | number) {\r\n        if (val !== this._value) {\r\n            if (typeof val === \"number\") {\r\n                this._value = toFixedMax(val, this._maxFixed);\r\n            } else {\r\n                this._value = val;\r\n            }\r\n            this.events.dispatch(this.events.change, this._value, this);\r\n        }\r\n    }\r\n\r\n    public get value(): string {\r\n        return this._value;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        //@ts-ignore\r\n        this.el!.addEventListener(\"mousewheel\", this._onMouseWheel);\r\n        this.el!.addEventListener(\"wheel\", this._onMouseWheelFF);\r\n        this.$input!.addEventListener(\"input\", this._onInput);\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        //@ts-ignore\r\n        this.el!.removeEventListener(\"mousewheel\", this._onMouseWheel);\r\n        this.el!.removeEventListener(\"wheel\", this._onMouseWheelFF);\r\n        this.$input!.removeEventListener(\"input\", this._onInput);\r\n    }\r\n\r\n    protected _onMouseWheel = (e: WheelEvent) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n\r\n    protected _onMouseWheelFF = (e: WheelEvent) => {\r\n        this._onMouseWheel(e);\r\n    }\r\n\r\n    protected _onInput = (e: Event) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        //@ts-ignore\r\n        this._setValue(e.target.value);\r\n    }\r\n\r\n\r\n    public override remove() {\r\n        this._clearEvents();\r\n        super.remove();\r\n    }\r\n\r\n    set visibility(visibility: boolean) {\r\n        if (this.el) {\r\n            if (visibility) {\r\n                this.el.style.display = \"\";\r\n            } else {\r\n                this.el.style.display = \"none\";\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {Input}\r\n","import type {EventsHandler} from \"../Events\";\r\nimport {View} from './View';\r\nimport type {IViewParams, ViewEventsList} from './View';\r\nimport {stringTemplate, toFixedMax} from '../utils/shared';\r\n\r\ninterface ICheckboxParams extends IViewParams {\r\n    label?: string;\r\n    checked?: boolean;\r\n    disabled?: boolean;\r\n}\r\n\r\ntype CheckboxEventsList = [\"change\"];\r\n\r\nconst SLIDER_EVENTS: CheckboxEventsList = [\"change\"];\r\n\r\nconst TEMPLATE = `<div class=\"og-checkbox\">\r\n      <div class=\"og-input-label\">{label}</div>\r\n      <div class=\"og-checkbox-input\">\r\n        <input type=\"checkbox\" {checked}/>\r\n      </div>\r\n    </div>`;\r\n\r\nclass Checkbox extends View<null> {\r\n\r\n    public override events: EventsHandler<CheckboxEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    protected $label: HTMLElement | null;\r\n    protected $input: HTMLInputElement | null;\r\n\r\n    protected _checked: boolean;\r\n    protected _disabled: boolean;\r\n\r\n    constructor(options: ICheckboxParams = {}) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                label: options.label || \"\",\r\n                checked: options.checked ? \"checked\" : \"\"\r\n            })\r\n        });\r\n\r\n        this._checked = options.checked || false;\r\n        this._disabled = options.disabled || false;\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(SLIDER_EVENTS);\r\n\r\n        this.$label = null;\r\n        this.$input = null;\r\n    }\r\n\r\n    public set disabled(disabled: boolean) {\r\n        this._disabled = disabled;\r\n        this._updateDisabled();\r\n    }\r\n\r\n    protected _updateDisabled() {\r\n        if (!this.el) return;\r\n        if (this._disabled) {\r\n            this.el.classList.add(\"og-input-disabled\");\r\n        } else {\r\n            this.el.classList.remove(\"og-input-disabled\");\r\n        }\r\n    }\r\n\r\n    public get disabled(): boolean {\r\n        return this._disabled;\r\n    }\r\n\r\n    public override render(params: any): this {\r\n\r\n        super.render(params);\r\n\r\n        this.$label = this.select(\".og-input-label\")!;\r\n        if (this.$label.innerHTML === \"\") {\r\n            this.$label.style.display = \"none\";\r\n        }\r\n        this.$input = this.select<HTMLInputElement>(\"input\");\r\n        this.$input!.checked = this._checked;\r\n\r\n        this._updateDisabled();\r\n\r\n        this._initEvents();\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _onResize = () => {\r\n    }\r\n\r\n    public set checked(isChecked: boolean) {\r\n        if (isChecked !== this._checked) {\r\n            this._checked = isChecked;\r\n            if (this.$input) {\r\n                this.$input.checked = this._checked;\r\n            }\r\n            this.events.dispatch(this.events.change, this._checked, this);\r\n        }\r\n    }\r\n\r\n    public get checked(): boolean {\r\n        return this._checked;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        //@ts-ignore\r\n        this.el!.addEventListener(\"mousewheel\", this._onMouseWheel);\r\n        this.el!.addEventListener(\"wheel\", this._onMouseWheelFF);\r\n        this.$input!.addEventListener(\"click\", this._onClick);\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        //@ts-ignore\r\n        this.el!.removeEventListener(\"mousewheel\", this._onMouseWheel);\r\n        this.el!.removeEventListener(\"wheel\", this._onMouseWheelFF);\r\n        this.$input!.removeEventListener(\"click\", this._onClick);\r\n    }\r\n\r\n    protected _onMouseWheel = (e: WheelEvent) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    }\r\n\r\n    protected _onMouseWheelFF = (e: WheelEvent) => {\r\n        this._onMouseWheel(e);\r\n    }\r\n\r\n    protected _onClick = (e: Event) => {\r\n        //@ts-ignore\r\n        e = e || window.event;\r\n        e.stopPropagation();\r\n\r\n        this.checked = !this._checked;\r\n    }\r\n\r\n\r\n    public override remove() {\r\n        this._clearEvents();\r\n        super.remove();\r\n    }\r\n\r\n    set visibility(visibility: boolean) {\r\n        if (this.el) {\r\n            if (visibility) {\r\n                this.el.style.display = \"\";\r\n            } else {\r\n                this.el.style.display = \"none\";\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {Checkbox}\r\n","import {Dialog, type IDialogParams} from \"../../ui/Dialog\";\r\nimport {GeoObjectEditorScene} from \"./GeoObjectEditorScene\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {Input} from \"../../ui/Input\";\r\nimport {Checkbox} from \"../../ui/Checkbox\";\r\nimport {Button} from \"../../ui/Button\";\r\nimport {Vec3} from \"../../math/Vec3\";\r\nimport {ToggleButton} from \"../../ui/ToggleButton\";\r\nimport {DEGREES, RADIANS} from \"../../math\";\r\n\r\nconst ICON_LOCK_BUTTON_SVG = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" id=\"filter-center-focus\">\r\n  <path d=\"M5 15H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z\"/>\r\n</svg>`;\r\n\r\ninterface IGeoObjectPropertiesDialog extends IDialogParams {\r\n    model: GeoObjectEditorScene\r\n}\r\n\r\nexport class GeoObjectPropertiesDialog extends Dialog<GeoObjectEditorScene> {\r\n\r\n    protected _relativePositionView: Checkbox;\r\n\r\n    protected _lonView: Input;\r\n    protected _latView: Input;\r\n    protected _heightView: Input;\r\n\r\n    protected _xView: Input;\r\n    protected _yView: Input;\r\n    protected _zView: Input;\r\n\r\n    protected _absXView: Input;\r\n    protected _absYView: Input;\r\n    protected _absZView: Input;\r\n\r\n    protected _pitchView: Input;\r\n    protected _yawView: Input;\r\n    protected _rollView: Input;\r\n\r\n    protected _absolutePitchView: Input;\r\n    protected _absoluteYawView: Input;\r\n    protected _absoluteRollView: Input;\r\n\r\n    protected _scaleView: Input;\r\n    protected _scaleXView: Input;\r\n    protected _scaleYView: Input;\r\n    protected _scaleZView: Input;\r\n\r\n    protected _groundBtn: Button;\r\n\r\n    constructor(params: IGeoObjectPropertiesDialog) {\r\n        super({\r\n            title: \"GeoObject Properties\",\r\n            visible: false,\r\n            resizable: true,\r\n            useHide: true,\r\n            top: 25,\r\n            right: 85,\r\n            width: 252,\r\n            height: 480,\r\n            minHeight: 100,\r\n            minWidth: 100,\r\n            model: params.model\r\n        });\r\n\r\n        this._relativePositionView = new Checkbox({\r\n            label: \"Relative position\"\r\n        });\r\n\r\n        this._lonView = new Input({\r\n            label: \"Lon\",\r\n            type: \"number\",\r\n            min: -180,\r\n            max: 180,\r\n            maxFixed: 10\r\n        });\r\n\r\n        this._latView = new Input({\r\n            label: \"Lat\",\r\n            type: \"number\",\r\n            min: -90,\r\n            max: 90,\r\n            maxFixed: 10\r\n        });\r\n\r\n        this._heightView = new Input({\r\n            label: \"Height\",\r\n            type: \"number\",\r\n            maxFixed: 4\r\n        });\r\n\r\n        this._xView = new Input({\r\n            label: \"X\",\r\n            type: \"number\",\r\n            maxFixed: 10\r\n        });\r\n\r\n        this._yView = new Input({\r\n            label: \"Y\",\r\n            type: \"number\",\r\n        });\r\n\r\n        this._zView = new Input({\r\n            label: \"Z\",\r\n            type: \"number\",\r\n        });\r\n\r\n        this._absXView = new Input({\r\n            label: \"Absolute X\",\r\n            type: \"number\",\r\n            maxFixed: 10\r\n        });\r\n\r\n        this._absYView = new Input({\r\n            label: \"Absolute Y\",\r\n            type: \"number\",\r\n        });\r\n\r\n        this._absZView = new Input({\r\n            label: \"Absolute Z\",\r\n            type: \"number\",\r\n        });\r\n\r\n        this._pitchView = new Input({\r\n            label: \"Pitch\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._yawView = new Input({\r\n            label: \"Yaw\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._rollView = new Input({\r\n            label: \"Roll\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._absolutePitchView = new Input({\r\n            label: \"Absolute pitch\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._absoluteYawView = new Input({\r\n            label: \"Absolute yaw\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._absoluteRollView = new Input({\r\n            label: \"Absolute roll\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._scaleView = new Input({\r\n            label: \"Scale\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._scaleXView = new Input({\r\n            label: \"Scale X\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._scaleYView = new Input({\r\n            label: \"Scale Y\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._scaleZView = new Input({\r\n            label: \"Scale Z\",\r\n            type: \"number\",\r\n            maxFixed: 2\r\n        });\r\n\r\n        this._groundBtn = new Button({\r\n            text: \"Ground\",\r\n            title: \"Put on the ground\",\r\n            name: \"ground\",\r\n            classList: [\"og-editor-ground_button\"]\r\n        });\r\n    }\r\n\r\n    public override render(params: any): this {\r\n        super.render(params);\r\n\r\n        this._initSceneEvents();\r\n\r\n        let $toolbar = document.createElement(\"div\");\r\n        $toolbar.classList.add(\"og-editor_toolbar\");\r\n        this.container?.appendChild($toolbar);\r\n\r\n        let cameraLockBtn = new ToggleButton({\r\n            classList: [\"og-editor_toolbar-button\"],\r\n            icon: ICON_LOCK_BUTTON_SVG,\r\n            title: \"Lock/Unlock camera view\"\r\n        });\r\n        cameraLockBtn.appendTo($toolbar);\r\n\r\n        cameraLockBtn.events.on(\"change\", (isActive: boolean) => {\r\n            if (isActive) {\r\n                this.model.lockView();\r\n            } else {\r\n                this.model.unlockView();\r\n            }\r\n        });\r\n\r\n        this.events.on(\"visibility\", (vis: boolean) => {\r\n            if (!vis) {\r\n                cameraLockBtn.events.stopPropagation();\r\n                cameraLockBtn.setActive(false);\r\n            }\r\n        })\r\n\r\n        this.events.on(\"visibility\", this._onVisibility);\r\n\r\n        this._relativePositionView.appendTo(this.container!);\r\n\r\n        if (this.model.planet) {\r\n            this._lonView.appendTo(this.container!);\r\n            this._latView.appendTo(this.container!);\r\n            this._heightView.appendTo(this.container!);\r\n        }\r\n        this._xView.appendTo(this.container!);\r\n        this._yView.appendTo(this.container!);\r\n        this._zView.appendTo(this.container!);\r\n\r\n        this._absXView.appendTo(this.container!);\r\n        this._absYView.appendTo(this.container!);\r\n        this._absZView.appendTo(this.container!);\r\n\r\n        this._pitchView.appendTo(this.container!);\r\n        this._yawView.appendTo(this.container!);\r\n        this._rollView.appendTo(this.container!);\r\n\r\n        this._absolutePitchView.appendTo(this.container!);\r\n        this._absoluteYawView.appendTo(this.container!);\r\n        this._absoluteRollView.appendTo(this.container!);\r\n\r\n        this._scaleView.appendTo(this.container!);\r\n        this._scaleXView.appendTo(this.container!);\r\n        this._scaleYView.appendTo(this.container!);\r\n        this._scaleZView.appendTo(this.container!);\r\n\r\n        if (this.model.planet) {\r\n            this._groundBtn.appendTo(this.container!);\r\n        }\r\n\r\n        this._relativePositionView.events.on(\"change\", this._onChangeRelativePosition);\r\n\r\n        this._lonView.events.on(\"change\", this._onChangeLon);\r\n        this._latView.events.on(\"change\", this._onChangeLat);\r\n        this._heightView.events.on(\"change\", this._onChangeHeight);\r\n\r\n        this._xView.events.on(\"change\", this._onChangeX);\r\n        this._yView.events.on(\"change\", this._onChangeY);\r\n        this._zView.events.on(\"change\", this._onChangeZ);\r\n\r\n        this._absXView.events.on(\"change\", this._onChangeAbsoluteX);\r\n        this._absYView.events.on(\"change\", this._onChangeAbsoluteY);\r\n        this._absZView.events.on(\"change\", this._onChangeAbsoluteZ);\r\n\r\n        this._pitchView.events.on(\"change\", this._onChangePitch);\r\n        this._yawView.events.on(\"change\", this._onChangeYaw);\r\n        this._rollView.events.on(\"change\", this._onChangeRoll);\r\n\r\n        this._absolutePitchView.events.on(\"change\", this._onChangeAbsolutePitch);\r\n        this._absoluteYawView.events.on(\"change\", this._onChangeAbsoluteYaw);\r\n        this._absoluteRollView.events.on(\"change\", this._onChangeAbsoluteRoll);\r\n\r\n        this._scaleView.events.on(\"change\", this._onChangeScale);\r\n        this._scaleXView.events.on(\"change\", this._onChangeScaleX);\r\n        this._scaleYView.events.on(\"change\", this._onChangeScaleY);\r\n        this._scaleZView.events.on(\"change\", this._onChangeScaleZ);\r\n\r\n        this._groundBtn.appendTo(this.container!);\r\n\r\n        this._groundBtn.events.on(\"click\", this._onGround);\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _onVisibility = (vis: boolean) => {\r\n        this.model.setVisibility(vis);\r\n    }\r\n\r\n    public override remove(): void {\r\n        super.remove();\r\n        this._clearSceneEvents();\r\n    }\r\n\r\n    protected _initSceneEvents() {\r\n        this.model.events.on(\"select\", this._onSelect);\r\n        this.model.events.on(\"unselect\", this._onUnselect);\r\n        this.model.events.on(\"position\", this._onPosition);\r\n        this.model.events.on(\"pitch\", this._onPitch);\r\n        this.model.events.on(\"yaw\", this._onYaw);\r\n        this.model.events.on(\"roll\", this._onRoll);\r\n    }\r\n\r\n    protected _clearSceneEvents() {\r\n        this.model.events.off(\"select\", this._onSelect);\r\n        this.model.events.off(\"unselect\", this._onUnselect);\r\n        this.model.events.off(\"position\", this._onPosition);\r\n        this.model.events.off(\"pitch\", this._onPitch);\r\n        this.model.events.off(\"yaw\", this._onYaw);\r\n        this.model.events.off(\"roll\", this._onRoll);\r\n    }\r\n\r\n    protected _onSelect = (entity: Entity) => {\r\n        this.show();\r\n        this._refresh(entity);\r\n    }\r\n\r\n    protected _refresh(entity: Entity) {\r\n\r\n        if (!entity.parent) {\r\n            this._relativePositionView.disabled = true;\r\n        } else {\r\n            this._relativePositionView.disabled = false;\r\n        }\r\n        //this._relativePositionView.stopPropagation();\r\n        this._relativePositionView.checked = entity.relativePosition;\r\n\r\n        let ll = entity.getLonLat();\r\n        this._lonView.stopPropagation();\r\n        this._latView.stopPropagation();\r\n        this._heightView.stopPropagation();\r\n        this._lonView.value = ll.lon;\r\n        this._latView.value = ll.lat;\r\n        this._heightView.value = ll.height;\r\n\r\n        let cart = entity.getCartesian();\r\n        this._xView.stopPropagation();\r\n        this._yView.stopPropagation();\r\n        this._zView.stopPropagation();\r\n        this._xView.value = cart.x;\r\n        this._yView.value = cart.y;\r\n        this._zView.value = cart.z;\r\n\r\n        cart = entity.getAbsoluteCartesian();\r\n        this._absXView.stopPropagation();\r\n        this._absYView.stopPropagation();\r\n        this._absZView.stopPropagation();\r\n        this._absXView.value = cart.x;\r\n        this._absYView.value = cart.y;\r\n        this._absZView.value = cart.z;\r\n\r\n        this._pitchView.stopPropagation();\r\n        this._yawView.stopPropagation();\r\n        this._rollView.stopPropagation();\r\n        this._pitchView.value = entity.getPitch() * DEGREES;\r\n        this._yawView.value = entity.getYaw() * DEGREES;\r\n        this._rollView.value = entity.getRoll() * DEGREES;\r\n\r\n        this._absolutePitchView.stopPropagation();\r\n        this._absoluteYawView.stopPropagation();\r\n        this._absoluteRollView.stopPropagation();\r\n        this._absolutePitchView.value = entity.getAbsolutePitch() * DEGREES;\r\n        this._absoluteYawView.value = entity.getAbsoluteYaw() * DEGREES;\r\n        this._absoluteRollView.value = entity.getAbsoluteRoll() * DEGREES;\r\n\r\n        this._scaleView.stopPropagation();\r\n        let scl = entity.getScale();\r\n        if ((scl.x === scl.y) && (scl.y === scl.z)) {\r\n            this._scaleView.value = scl.x;\r\n        } else {\r\n            this._scaleView.value = 1;\r\n        }\r\n\r\n        this._scaleXView.stopPropagation();\r\n        this._scaleYView.stopPropagation();\r\n        this._scaleZView.stopPropagation();\r\n        this._scaleXView.value = scl.x;\r\n        this._scaleYView.value = scl.y;\r\n        this._scaleZView.value = scl.z;\r\n    }\r\n\r\n    public override hide() {\r\n        super.hide();\r\n        this.model.events.stopPropagation();\r\n        this.model.unselect();\r\n    }\r\n\r\n    protected _onUnselect = (entity: Entity) => {\r\n        this.hide();\r\n    }\r\n\r\n    protected _onChangeRelativePosition = (checked: boolean) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.relativePosition = checked;\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onPosition = (pos: Vec3, entity: Entity) => {\r\n        this._refresh(entity);\r\n    }\r\n\r\n    protected _onPitch = (a: number, entity: Entity) => {\r\n        this._pitchView.stopPropagation();\r\n        this._pitchView.value = entity.getPitch() * DEGREES;\r\n\r\n        this._absolutePitchView.stopPropagation();\r\n        this._absolutePitchView.value = entity.getAbsolutePitch() * DEGREES;\r\n    }\r\n\r\n    protected _onYaw = (a: number, entity: Entity) => {\r\n        this._yawView.stopPropagation();\r\n        this._yawView.value = entity.getYaw() * DEGREES;\r\n\r\n        this._absoluteYawView.stopPropagation();\r\n        this._absoluteYawView.value = entity.getAbsoluteYaw() * DEGREES;\r\n    }\r\n\r\n    protected _onRoll = (a: number, entity: Entity) => {\r\n        this._rollView.stopPropagation();\r\n        this._rollView.value = entity.getRoll() * DEGREES;\r\n\r\n        this._absoluteRollView.stopPropagation();\r\n        this._absoluteRollView.value = entity.getAbsoluteRoll() * DEGREES;\r\n    }\r\n\r\n    protected _onChangeLon = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let ll = entity.getLonLat();\r\n            entity.setLonLat2(parseFloat(val), ll.lat, ll.height);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeLat = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let ll = entity.getLonLat();\r\n            entity.setLonLat2(ll.lon, parseFloat(val), ll.height);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeHeight = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let ll = entity.getLonLat();\r\n            entity.setLonLat2(ll.lon, ll.lat, parseFloat(val));\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeX = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let cart = entity.getCartesian();\r\n            entity.setCartesian(parseFloat(val), cart.y, cart.z);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeY = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let cart = entity.getCartesian();\r\n            entity.setCartesian(cart.x, parseFloat(val), cart.z);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeZ = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let cart = entity.getCartesian();\r\n            entity.setCartesian(cart.x, cart.y, parseFloat(val));\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeAbsoluteX = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let cart = entity.getAbsoluteCartesian();\r\n            entity.setAbsoluteCartesian(parseFloat(val), cart.y, cart.z);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeAbsoluteY = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let cart = entity.getAbsoluteCartesian();\r\n            entity.setAbsoluteCartesian(cart.x, parseFloat(val), cart.z);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeAbsoluteZ = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let cart = entity.getAbsoluteCartesian();\r\n            entity.setAbsoluteCartesian(cart.x, cart.y, parseFloat(val));\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangePitch = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.setPitch(parseFloat(val) * RADIANS);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeYaw = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.setYaw(parseFloat(val) * RADIANS);\r\n            this._refresh(entity);\r\n\r\n        }\r\n    }\r\n\r\n    protected _onChangeRoll = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.setRoll(parseFloat(val) * RADIANS);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeAbsolutePitch = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.setAbsolutePitch(parseFloat(val) * RADIANS);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeAbsoluteYaw = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.setAbsoluteYaw(parseFloat(val) * RADIANS);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeAbsoluteRoll = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            entity.setAbsoluteRoll(parseFloat(val) * RADIANS);\r\n            this._refresh(entity);\r\n        }\r\n    }\r\n\r\n    protected _onChangeScale = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let s = parseFloat(val);\r\n            entity.setScale(s);\r\n            this._scaleXView.stopPropagation();\r\n            this._scaleYView.stopPropagation();\r\n            this._scaleZView.stopPropagation();\r\n            this._scaleXView.value = s;\r\n            this._scaleYView.value = s;\r\n            this._scaleZView.value = s;\r\n        }\r\n    }\r\n    protected _onChangeScaleX = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let s = entity.getScale();\r\n            entity.setScale3v(new Vec3(parseFloat(val), s.y, s.z));\r\n        }\r\n    }\r\n    protected _onChangeScaleY = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let s = entity.getScale();\r\n            entity.setScale3v(new Vec3(s.x, parseFloat(val), s.z));\r\n        }\r\n    }\r\n    protected _onChangeScaleZ = (val: string) => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity) {\r\n            let s = entity.getScale();\r\n            entity.setScale3v(new Vec3(s.x, s.y, parseFloat(val)));\r\n        }\r\n    }\r\n\r\n    protected _onGround = () => {\r\n        let entity = this.model.getSelectedEntity();\r\n        if (entity && this.model.planet) {\r\n            if (this.model.planet.terrain) {\r\n                this.model.planet.terrain.getHeightAsync(entity.getLonLat(), (height: number) => {\r\n                    this._heightView.value = height;\r\n                });\r\n            } else {\r\n                this._heightView.value = 0;\r\n            }\r\n        }\r\n    }\r\n}","import {Control, type IControlParams} from \"./Control\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {createEvents, type EventsHandler} from \"../Events\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport type {IMouseState} from \"../renderer/RendererEvents\";\r\nimport {MouseNavigation} from \"./MouseNavigation\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {input} from \"../input/input\";\r\nimport {RADIANS} from \"../math\";\r\n\r\nconst MIN_LOCK_DISTANCE = 0.001;\r\nconst MIN_VIEW_DISTANCE = 120.0;\r\n\r\nlet qOrientationRot = new Quat();\r\nconst t: number = 0.08;\r\n\r\ntype CameraLockEventsList = [\"lockview\", \"unlockview\"];\r\n\r\nconst CameraLockEvents: CameraLockEventsList = [\"lockview\", \"unlockview\"];\r\n\r\n\r\ninterface ICameraLockParams extends IControlParams {\r\n    planet?: Planet | null\r\n}\r\n\r\nexport class CameraLock extends Control {\r\n\r\n    public events: EventsHandler<CameraLockEventsList>;\r\n\r\n    protected _lockDistance: number;\r\n    protected _isFromTheBack: boolean;\r\n    protected _lockEntity: Entity | null;\r\n    protected _viewDir: Vec3;\r\n\r\n    constructor(options: ICameraLockParams = {}) {\r\n        super(options);\r\n\r\n        this.events = createEvents(CameraLockEvents);\r\n\r\n        this._name = \"CameraLock\";\r\n\r\n        this.planet = options.planet || null;\r\n\r\n        this._lockDistance = 0;\r\n        this._isFromTheBack = false;\r\n        this._lockEntity = null;\r\n        this._viewDir = new Vec3(0, 0, 0);\r\n    }\r\n\r\n    public override onactivate() {\r\n        if (this.renderer) {\r\n        }\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        if (this.renderer) {\r\n            this.unlockView();\r\n        }\r\n    }\r\n\r\n    public override oninit() {\r\n        this.activate();\r\n        if (this.renderer) {\r\n\r\n        }\r\n    }\r\n\r\n    public flyCartesian(cartesian: Vec3, dist = MIN_VIEW_DISTANCE) {\r\n        if (cartesian.isZero() || !this.renderer) {\r\n            return;\r\n        }\r\n        this.unlockView();\r\n        if (this.planet) {\r\n            let cam = this.planet.camera;\r\n            if (this.isVisibleDistance(cartesian)) {\r\n                cam.flyDistance(cartesian, dist);\r\n            }\r\n            if (cam.eye.distance(cartesian) < 1000000.0) {\r\n                cam.flyDistance(cartesian, dist);\r\n            } else {\r\n                cam.viewDistance(cartesian, dist);\r\n            }\r\n        } else {\r\n            this.renderer.activeCamera.viewDistance(cartesian, dist);\r\n        }\r\n    }\r\n\r\n    public lockView(entity: Entity, fromTheBack = false) {\r\n\r\n        if (!this.renderer) return;\r\n\r\n        this._lockDistance = this._getDistance(entity, this._lockEntity);\r\n\r\n        this._isFromTheBack = fromTheBack;\r\n\r\n        this._deactivateLockViewEvents();\r\n\r\n        this._lockEntity = entity;\r\n        let cam = this.renderer.activeCamera;\r\n        if (this.planet) {\r\n            this.planet.camera.stopFlying();\r\n        }\r\n        cam.viewDistance(entity.getAbsoluteCartesian(), this._lockDistance);\r\n\r\n        this._deactivateNav();\r\n\r\n        this._activateLockViewEvents();\r\n\r\n        this._viewDir = entity.getAbsoluteCartesian().sub(cam.eye).normalize();\r\n\r\n        this.events.dispatch(this.events.lockview, this._lockEntity, fromTheBack);\r\n    }\r\n\r\n    protected _activateNav() {\r\n        if (this.renderer && this.renderer.controls.mouseNavigation) {\r\n            this.renderer.controls.mouseNavigation.activate();\r\n        }\r\n\r\n        if (this.renderer && this.renderer.controls.simpleNavigation) {\r\n            this.renderer.controls.simpleNavigation.activate();\r\n        }\r\n    }\r\n\r\n    protected _deactivateNav() {\r\n        if (this.renderer && this.renderer.controls.mouseNavigation) {\r\n            this.renderer.controls.mouseNavigation.deactivate();\r\n            (this.renderer.controls.mouseNavigation as MouseNavigation).stop();\r\n        }\r\n\r\n        if (this.renderer && this.renderer.controls.simpleNavigation) {\r\n            this.renderer.controls.simpleNavigation.deactivate();\r\n        }\r\n    }\r\n\r\n    public unlockView() {\r\n        if (this._lockEntity) {\r\n            this._deactivateLockViewEvents();\r\n            this._activateNav();\r\n            this.events.dispatch(this.events.unlockview, this._lockEntity);\r\n            this._lockEntity = null;\r\n        }\r\n    }\r\n\r\n    private _getCenterDist(): number {\r\n        if (this.renderer) {\r\n            return this.renderer.getDistanceFromPixel(this.renderer.handler.getCenter()) || 0;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    protected _getDistance(entity: Entity, prevEntity?: Entity | null): number {\r\n        if (this.renderer) {\r\n\r\n            let cartesian = entity.getAbsoluteCartesian();\r\n            let cam = this.renderer.activeCamera;\r\n\r\n            let dist = cam.eye.distance(cartesian);\r\n            if (prevEntity) {\r\n                dist = cam.eye.distance(prevEntity.getAbsoluteCartesian());\r\n            }\r\n\r\n            if (this.isVisibleDistance(cartesian)) {\r\n                return dist;\r\n            }\r\n            if (cam.eye.distance(cartesian) < 1000000.0) {\r\n                return this._getCenterDist();\r\n            } else {\r\n                return MIN_VIEW_DISTANCE;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public isVisibleDistance(cart: Vec3, C: number = 0.0): boolean {\r\n        if (this.planet) {\r\n            let R = this.planet.ellipsoid.equatorialSize;\r\n            let eye = this.planet.camera.eye;\r\n            let camDist = eye.distance(cart);\r\n            return camDist < Math.sqrt(eye.length2() - R * R) + C;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    public get lockEntity() {\r\n        return this._lockEntity;\r\n    }\r\n\r\n    public flyLonLat(lonLat: LonLat, dist = MIN_VIEW_DISTANCE) {\r\n        if (this.planet) {\r\n            let cartesian = this.planet.ellipsoid.lonLatToCartesian(lonLat);\r\n            this.flyCartesian(cartesian, dist);\r\n        }\r\n    }\r\n\r\n    protected _activateLockViewEvents() {\r\n        if (this.renderer) {\r\n            this.renderer.events.on(\"mousewheel\", this._onMouseWheel);\r\n            this.renderer.events.on(\"mousemove\", this._onMouseMove);\r\n            this.renderer.events.on(\"draw\", this._onLockViewDraw);\r\n        }\r\n    }\r\n\r\n    protected _deactivateLockViewEvents() {\r\n        if (this.renderer) {\r\n            this.renderer.events.off(\"mousewheel\", this._onMouseWheel);\r\n            this.renderer.events.off(\"mousemove\", this._onMouseMove);\r\n            if (this._lockEntity) {\r\n                this.renderer.events.off(\"draw\", this._onLockViewDraw);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _onLockViewDraw = () => {\r\n        if (this.renderer && this._lockEntity) {\r\n            if (this._isFromTheBack) {\r\n                // let cam = this.planet.camera;\r\n                // let vehPos = this._lockEntity.getCartesian(),\r\n                //     vehDir = this._lockEntity.direction;\r\n                // let currPos = vehPos.sub(this._viewDir.scaleTo(this._lockDistance));\r\n                // let dh = new Vec3();\r\n                // let currPosProj = new Plane(vehPos, vehPos.normal()).getProjectionPoint(currPos, dh);\r\n                // let projViewDir = vehPos.sub(currPosProj);\r\n                // Quat.getRotationBetweenVectorsRes(projViewDir.normal(), vehDir, qOrientationRot);\r\n                // let rot = qOrientationRot.slerp(Quat.IDENTITY, 1.0 - t).normalize();\r\n                // let projViewDir_t = rot.mulVec3(projViewDir.normal());\r\n                // projViewDir = projViewDir_t.scale(projViewDir.length());\r\n                // let newPos = vehPos.add(dh).sub(projViewDir);\r\n                // this._viewDir = vehPos.sub(newPos).normalize();\r\n                // cam.set(newPos, vehPos, vehPos.normal());\r\n                // cam.update();\r\n            } else {\r\n                this.renderer.activeCamera.viewDistance(this._lockEntity.getAbsoluteCartesian(), this._lockDistance);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onMouseWheel = (e: IMouseState) => {\r\n        if (this.renderer && this._lockEntity) {\r\n            if (this._isFromTheBack) {\r\n                //...\r\n            } else {\r\n                let d = this.renderer.activeCamera.eye.distance(this._lockEntity.getAbsoluteCartesian());\r\n                this._lockDistance -= 0.33 * d * Math.sign(e.wheelDelta);\r\n                if (this._lockDistance < MIN_LOCK_DISTANCE) {\r\n                    this._lockDistance = MIN_LOCK_DISTANCE;\r\n                }\r\n                this.renderer.activeCamera.viewDistance(this._lockEntity.getAbsoluteCartesian(), this._lockDistance);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _onMouseMove = (ms: IMouseState) => {\r\n        if (this._lockEntity && this.renderer) {\r\n            if (ms.rightButtonDown || this.renderer.events.isKeyPressed(input.KEY_ALT)) {\r\n\r\n                let p = this._lockEntity.getAbsoluteCartesian(),\r\n                    cam = this.renderer.activeCamera,\r\n                    l = 0.5 / RADIANS;\r\n\r\n                if (l > 0.007) l = 0.007;\r\n\r\n                if (this.planet) {\r\n                    cam.rotateHorizontal(l * (ms.x - ms.prev_x), false, p, p.isZero() ? Vec3.UP : p.normal());\r\n                } else {\r\n                    cam.rotateHorizontal(l * (ms.x - ms.prev_x), false, p, Vec3.UP);\r\n                }\r\n                cam.rotateVertical(l * (ms.y - ms.prev_y), p);\r\n\r\n                this._viewDir = p.sub(cam.eye).normalize();\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n","import {Control, type IControlParams} from \"../Control\";\r\nimport {GeoObjectEditorScene} from \"./GeoObjectEditorScene\";\r\nimport {GeoObjectPropertiesDialog} from \"./GeoObjectEditorDialog\";\r\nimport {CameraLock} from \"../CameraLock\";\r\n\r\nexport interface IGeoObjectEditorParams extends IControlParams {\r\n}\r\n\r\nexport class GeoObjectEditor extends Control {\r\n    protected _geoObjectEditopScene: GeoObjectEditorScene;\r\n    protected _dialog: GeoObjectPropertiesDialog;\r\n\r\n    constructor(options: IGeoObjectEditorParams = {}) {\r\n        super(options);\r\n\r\n        this._geoObjectEditopScene = new GeoObjectEditorScene({\r\n            name: `geoObjectEditorScene:${this.__id}`\r\n        });\r\n\r\n        this._dialog = new GeoObjectPropertiesDialog({\r\n            model: this._geoObjectEditopScene\r\n        });\r\n    }\r\n\r\n    public override oninit() {\r\n        if (this.renderer) {\r\n            this.renderer.addControl(new CameraLock({planet: this.planet}));\r\n            this._geoObjectEditopScene.bindPlanet(this.planet!);\r\n            this._dialog.appendTo(this.renderer.div || document.body);\r\n            this.activate();\r\n        }\r\n    }\r\n\r\n    public override onactivate() {\r\n        this.renderer && this.renderer.addNode(this._geoObjectEditopScene);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        this.renderer && this.renderer.removeNode(this._geoObjectEditopScene);\r\n        this._dialog.hide();\r\n    }\r\n}\r\n","import {IViewParams, View, type ViewEventsList} from \"../../ui/View\";\r\nimport {IObject3dItem} from \"./Object3dCollection\";\r\nimport {createEvents, EventsHandler} from \"../../Events\";\r\nimport {stringTemplate} from \"../../utils/shared\";\r\n\r\ntype Object3dItemViewEvents = [\"click\"];\r\n\r\nconst EVENT_NAMES: Object3dItemViewEvents = [\r\n    \"click\",\r\n];\r\n\r\nconst ITEM_TEMPLATE =\r\n    `<button class=\"og-object3d-collection__item\">\r\n        <div class=\"og-object3d-collection__item_name\">{name}</div>\r\n    </button>`;\r\n\r\nexport class Object3dItemView extends View<IObject3dItem> {\r\n\r\n    public override events: EventsHandler<Object3dItemViewEvents> & EventsHandler<ViewEventsList>;\r\n\r\n    constructor(params: IViewParams) {\r\n        super({\r\n            template: stringTemplate(ITEM_TEMPLATE, {\r\n                name: params.model.name\r\n            }),\r\n            ...params\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = createEvents<Object3dItemViewEvents>(EVENT_NAMES);\r\n    }\r\n\r\n    public override render(params?: any): this {\r\n        super.render(params);\r\n        this.el?.addEventListener(\"click\", (e) => {\r\n            this.events.dispatch(this.events.click, this.model, this, e);\r\n        });\r\n        return this;\r\n    }\r\n}","import {IViewParams, View, type ViewEventsList} from \"../../ui/View\";\r\nimport {IObject3dItem, Object3dCollection} from \"./Object3dCollection\";\r\nimport {Object3dItemView} from \"./Object3dItemView\";\r\nimport {type EventsHandler, createEvents} from \"../../Events\";\r\nimport {Object3d} from \"../../Object3d\";\r\n\r\ntype Object3dCollectionViewEvents = [\"select\"];\r\n\r\nconst EVENT_NAMES: Object3dCollectionViewEvents = [\r\n    \"select\",\r\n];\r\n\r\nconst TEMPLATE = `<div class=\"og-object3d-collection\"></div>`;\r\n\r\nexport class Object3dCollectionView extends View<Object3dCollection> {\r\n\r\n    public override events: EventsHandler<Object3dCollectionViewEvents> & EventsHandler<ViewEventsList>;\r\n\r\n    protected _activeView: Object3dItemView | null;\r\n\r\n    constructor(params: IViewParams) {\r\n        super({\r\n            template: TEMPLATE,\r\n            model: params.model,\r\n            ...params\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = createEvents<Object3dItemViewEvents>(EVENT_NAMES);\r\n\r\n        this._activeView = null;\r\n    }\r\n\r\n    protected _addItem(item: IObject3dItem) {\r\n        let itemView = new Object3dItemView({model: item});\r\n        itemView.appendTo(this.el!);\r\n        itemView.events.on(\"click\", (item: IObject3dItem) => {\r\n            if (this._activeView) {\r\n                this._activeView.el?.classList.remove(\"active\");\r\n            }\r\n            this._activeView = itemView;\r\n            this._activeView.el?.classList.add(\"active\");\r\n            this.events.dispatch(this.events.select, item, itemView);\r\n        });\r\n    }\r\n\r\n    public override render(params: IViewParams) {\r\n        super.render(params);\r\n        let items = this.model.getItems();\r\n        for (let item of items) {\r\n            this._addItem(item);\r\n        }\r\n\r\n        this._initEvents();\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        this.model.events.on(\"add\", this._onAdd);\r\n    }\r\n\r\n    protected _onAdd = (item: IObject3dItem) => {\r\n        this._addItem(item);\r\n    }\r\n}","import {Dialog, type IDialogParams, type DialogEventsList} from \"../../ui/Dialog\";\r\nimport {IObject3dItem, Object3dCollection} from \"./Object3dCollection\";\r\nimport {Button} from \"../../ui/Button\";\r\nimport {Object3dCollectionView} from \"./Object3dCollectionView\";\r\nimport {type EventsHandler, createEvents} from \"../../Events\";\r\nimport {type ViewEventsList} from \"../../ui/View\";\r\nimport {View} from \"../../ui/View\";\r\nimport {Object3d} from \"../../Object3d\";\r\n\r\ntype Object3dManagerDialogEvents = [\"select\"];\r\n\r\nconst EVENT_NAMES: Object3dManagerDialogEvents = [\r\n    \"select\",\r\n];\r\n\r\nconst ICON_LOAD_BUTTON_SVG = `<svg class=\"svg-icon\" style=\"vertical-align: middle;fill: currentColor;overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M426.666667 170.666667H170.666667c-47.146667 0-84.906667 38.186667-84.906667 85.333333L85.333333 768c0 47.146667 38.186667 85.333333 85.333334 85.333333h682.666666c47.146667 0 85.333333-38.186667 85.333334-85.333333V341.333333c0-47.146667-38.186667-85.333333-85.333334-85.333333H512l-85.333333-85.333333z\"  /></svg>`;\r\n\r\ninterface IObject3dManagerDialogParams extends IDialogParams {\r\n    model: Object3dCollection\r\n}\r\n\r\ntype Object3dManagerDialogEventsExt =\r\n    EventsHandler<Object3dManagerDialogEvents>\r\n    & EventsHandler<DialogEventsList>\r\n    & EventsHandler<ViewEventsList>;\r\n\r\nexport class Object3dManagerDialog extends Dialog<null> {\r\n\r\n    public override events: Object3dManagerDialogEventsExt;\r\n\r\n    protected _object3dCollectionView: Object3dCollectionView;\r\n\r\n    constructor(params: IObject3dManagerDialogParams) {\r\n        super({\r\n            classList: [\"og-object3d-manager\"],\r\n            title: \"Object3D Collection\",\r\n            visible: false,\r\n            resizable: true,\r\n            useHide: true,\r\n            top: 25,\r\n            right: 85,\r\n            width: 252,\r\n            height: 480,\r\n            minHeight: 100,\r\n            minWidth: 100,\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = createEvents<Object3dManagerDialogEventsExt>(EVENT_NAMES);\r\n\r\n        this._object3dCollectionView = new Object3dCollectionView({model: params.model});\r\n    }\r\n\r\n    public override render(params: any): this {\r\n        super.render(params);\r\n\r\n        let $toolbar = document.createElement(\"div\");\r\n        $toolbar.classList.add(\"og-editor_toolbar\");\r\n        this.container?.appendChild($toolbar);\r\n\r\n        let loadBtn = new Button({\r\n            classList: [\"og-editor_toolbar-button\"],\r\n            icon: ICON_LOAD_BUTTON_SVG,\r\n            title: \"Load 3D object\"\r\n        });\r\n        loadBtn.appendTo($toolbar);\r\n\r\n        loadBtn.events.on(\"click\", this._onLoadClick);\r\n\r\n        this._object3dCollectionView.appendTo(this.container!);\r\n\r\n        this._object3dCollectionView.events.on(\"select\", (item: IObject3dItem): void => {\r\n            this.events.dispatch(this.events.select, item);\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    protected _onLoadClick = () => {\r\n\r\n        let fileInp = new View({\r\n            initRender: true,\r\n            template: `<input type=\"file\" accept=\".obj,.mtl\" multiple />`\r\n        });\r\n\r\n        if (fileInp.el) {\r\n            fileInp.el.addEventListener(\"change\", (e) => {\r\n                const target = e.target as HTMLInputElement;\r\n                if (target.files) {\r\n                    const files = Array.from(target.files);\r\n                    const objFile = files.find(file => file.name.toLowerCase().endsWith(\".obj\"));\r\n                    const mtlFile = files.find(file => file.name.toLowerCase().endsWith(\".mtl\"));\r\n                    if (objFile) {\r\n                        loadObj(objFile, mtlFile).then(this._addObject);\r\n                    }\r\n                }\r\n            });\r\n            fileInp.el.click();\r\n        }\r\n    }\r\n\r\n    protected _addObject = (item: { name: string; objects: Object3d[] }) => {\r\n        this._object3dCollectionView.model.addItem(item);\r\n    }\r\n}\r\n\r\nasync function loadObj(objFile: File, mtlFile?: File): Promise<{ name: string; objects: Object3d[] }> {\r\n    return await Object3d.readFileObj(objFile, mtlFile).then(objects => ({\r\n        name: objFile.name,\r\n        objects: mtlFile ? objects : [Object3d.merge(objects)]\r\n    }))\r\n}\r\n","import {Object3d} from \"../../Object3d\";\r\nimport {type EventsHandler, createEvents} from \"../../Events\";\r\n\r\ntype Object3dCollectionEvents = [\"add\", \"remove\"];\r\n\r\nconst EVENT_NAMES: Object3dCollectionEvents = [\r\n    \"add\",\r\n    \"remove\"\r\n];\r\n\r\nexport interface IObject3dItem {\r\n    name: string;\r\n    objects: Object3d[];\r\n    scale?: number\r\n}\r\n\r\ninterface Object3dCollectionParams {\r\n    collection?: IObject3dItem[]\r\n}\r\n\r\nexport class Object3dCollection {\r\n\r\n    protected _items: Map<string, IObject3dItem>;\r\n\r\n    public events: EventsHandler<Object3dCollectionEvents>;\r\n\r\n    constructor(params: Object3dCollectionParams = {}) {\r\n\r\n        this.events = createEvents<Object3dCollectionEvents>(EVENT_NAMES, this);\r\n\r\n        this._items = Object3dCollection.createItemsMap(params.collection || []);\r\n    }\r\n\r\n    static createItemsMap(items: IObject3dItem[]): Map<string, IObject3dItem> {\r\n        let res: Map<string, IObject3dItem> = new Map();\r\n        for (let i = 0; i < items.length; i++) {\r\n            res.set(items[i].name, items[i]);\r\n        }\r\n        return res;\r\n    }\r\n\r\n    public getItem(name: string): IObject3dItem | undefined {\r\n        return this._items.get(name);\r\n    }\r\n\r\n    public addItem(item: IObject3dItem, force: boolean = false) {\r\n        if (!this._items.has(item.name) || force) {\r\n            this._items.set(item.name, item);\r\n            this.events.dispatch(this.events.add, item);\r\n        }\r\n    }\r\n\r\n    public getItems(): IObject3dItem[] {\r\n        return Array.from(this._items, ([name, objects]) => (objects));\r\n    }\r\n}","import {Control, type IControlParams} from \"../Control\";\r\nimport {Object3dManagerDialog} from \"./Object3dManagerDialog\";\r\nimport {Object3dCollection} from \"./Object3dCollection\";\r\nimport {IObject3dItem} from \"./Object3dCollection\";\r\nimport {Vector} from \"../../layer/Vector\";\r\nimport {IMouseState} from \"../../renderer/RendererEvents\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {input} from \"../../input/input\";\r\n\r\nexport interface IObject3dManagerParams extends IControlParams {\r\n    collection?: IObject3dItem[],\r\n    layer?: Vector\r\n}\r\n\r\nexport class Object3dManager extends Control {\r\n    protected _dialog: Object3dManagerDialog;\r\n    protected _collection: Object3dCollection;\r\n    protected _layer: Vector | null;\r\n    protected _currentItem: IObject3dItem | null;\r\n\r\n    constructor(options: IObject3dManagerParams = {}) {\r\n        super(options);\r\n\r\n        this._layer = options.layer || null;\r\n\r\n        this._currentItem = null;\r\n\r\n        this._collection = new Object3dCollection({\r\n            collection: options.collection\r\n        });\r\n\r\n        this._dialog = new Object3dManagerDialog({\r\n            model: this._collection\r\n        });\r\n    }\r\n\r\n    public override oninit() {\r\n        if (this.renderer) {\r\n            this._dialog.appendTo(this.renderer.div || document.body);\r\n            this._dialog.events.on(\"select\", this._onSelect);\r\n            this.activate();\r\n        }\r\n    }\r\n\r\n    public override onactivate() {\r\n        this._dialog.show();\r\n        this._initEvents();\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        this._dialog.hide();\r\n        this._clearEvents();\r\n    }\r\n\r\n    protected _onSelect = (item: IObject3dItem) => {\r\n        this._currentItem = item;\r\n    }\r\n\r\n    public bindLayer(layer: Vector) {\r\n        this._layer = layer;\r\n    }\r\n\r\n    protected _initEvents() {\r\n        if (this.planet && this.planet.renderer) {\r\n            this.planet.renderer.events.on(\"lclick\", this._onClick);\r\n        }\r\n    }\r\n\r\n    protected _clearEvents() {\r\n        if (this.planet && this.planet.renderer) {\r\n            this.planet.renderer.events.off(\"lclick\", this._onClick);\r\n        }\r\n    }\r\n\r\n    protected _onClick = (e: IMouseState) => {\r\n        if (!this.planet) return;\r\n        if (!this._layer) return;\r\n        if (!this._currentItem) return;\r\n\r\n        let lonLat = this.planet.getLonLatFromPixelTerrain(e.pos);\r\n\r\n        if (lonLat) {\r\n            this.renderer!.setRelativeCenter(this.planet.camera.eye);\r\n            if (this.renderer!.events.isKeyPressed(input.KEY_CTRL)) {\r\n                let entity = this._createEntity(this._currentItem, lonLat);\r\n                this._layer.add(entity);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _createEntity(item: IObject3dItem, lonLat: LonLat): Entity {\r\n\r\n        let name = item.name;\r\n        let scale = item.scale;\r\n\r\n        let entity = new Entity({\r\n            lonlat: lonLat,\r\n            pitch: 0,\r\n            yaw: 0,\r\n            roll: 0,\r\n            scale,\r\n        });\r\n\r\n        for (let i = 0; i < item.objects.length; i++) {\r\n            let obj3d = item.objects[i];\r\n            let childEntity = new Entity({\r\n                forceGlobalPosition: true,\r\n                forceGlobalRotation: true,\r\n                forceGlobalScale: true,\r\n                geoObject: {\r\n                    tag: `${name}:${i.toString()}`,\r\n                    object3d: obj3d\r\n                }\r\n            });\r\n\r\n            entity.appendChild(childEntity);\r\n        }\r\n\r\n        return entity;\r\n    }\r\n}\r\n","import {Control, IControlParams} from \"./Control\";\r\nimport {Camera} from \"../camera/Camera\";\r\nimport {Framebuffer} from \"../webgl/Framebuffer\";\r\nimport {WebGLContextExt} from \"../webgl/Handler\";\r\n\r\ntype HandlerFunc = (camera?: Camera, framebuffer?: Framebuffer, gl?: WebGLContextExt | null) => void;\r\n\r\nexport interface ICameraFrameHadler {\r\n    camera: Camera,\r\n    frameBuffer: Framebuffer,\r\n    handler: HandlerFunc\r\n}\r\n\r\nexport class CameraFrameHandler {\r\n    public camera: Camera;\r\n    public frameBuffer: Framebuffer;\r\n    public handler: HandlerFunc | null;\r\n    protected _composer: CameraFrameComposer | null;\r\n    protected _composerIndex: number;\r\n\r\n    constructor(params: ICameraFrameHadler) {\r\n        this.camera = params.camera;\r\n        this.frameBuffer = params.frameBuffer;\r\n        this.handler = params.handler || null;\r\n        this._composer = null;\r\n        this._composerIndex = -1;\r\n        this.frameBuffer.init();\r\n    }\r\n\r\n    public addTo(composer: CameraFrameComposer) {\r\n        if (!this._composer) {\r\n            this._composer = composer;\r\n            this._composerIndex = composer.handlers.length;\r\n            //@ts-ignore\r\n            this._composer._handlers.push(this);\r\n        }\r\n    }\r\n\r\n    public remove() {\r\n        if (this._composer) {\r\n            //@ts-ignore\r\n            this._composer._handlers.splice(this._composerIndex, 1);\r\n            this._composer = null;\r\n            this._composerIndex = -1;\r\n        }\r\n    }\r\n\r\n    public frame() {\r\n        if (this.handler) {\r\n            this.handler(this.camera, this.frameBuffer, this.frameBuffer.handler.gl);\r\n        }\r\n    }\r\n}\r\n\r\nexport interface ICameraFrameComposerParams extends IControlParams {\r\n    handlers: CameraFrameHandler[]\r\n}\r\n\r\nexport class CameraFrameComposer extends Control {\r\n\r\n    protected _handlers: CameraFrameHandler[];\r\n\r\n    constructor(params: ICameraFrameComposerParams) {\r\n        super({\r\n            name: \"CameraFrameComposer\",\r\n            autoActivate: true,\r\n            ...params\r\n        });\r\n\r\n        this._handlers = params.handlers || [];\r\n    }\r\n\r\n    public get handlers(): CameraFrameHandler[] {\r\n        return [...this._handlers];\r\n    }\r\n\r\n    public add(handler: CameraFrameHandler) {\r\n        handler.addTo(this);\r\n    }\r\n\r\n    public override oninit() {\r\n        super.oninit();\r\n    }\r\n\r\n    public override activate() {\r\n        super.activate();\r\n        this.renderer?.events.on(\"postdraw\", this._onPostdraw);\r\n    }\r\n\r\n    public override deactivate() {\r\n        super.deactivate();\r\n        this.renderer?.events.off(\"postdraw\", this._onPostdraw);\r\n    }\r\n\r\n    protected _onPostdraw = () => {\r\n        for (let i = 0; i < this._handlers.length; i++) {\r\n            this._handlers[i].frame();\r\n        }\r\n    }\r\n}","import {Program} from '../webgl/Program';\r\nimport {RenderNode} from './RenderNode';\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\n\r\nclass Axes extends RenderNode {\r\n\r\n    public size: number;\r\n    public axesBuffer: WebGLBufferExt | null;\r\n    public axesColorBuffer: WebGLBufferExt | null;\r\n\r\n    constructor(size: number = 100) {\r\n        super(\"Axes\");\r\n\r\n        this.size = size;\r\n        this.axesBuffer = null;\r\n        this.axesColorBuffer = null;\r\n    }\r\n\r\n    public override init() {\r\n        this.createAxesBuffer(this.size);\r\n        this.drawMode = this.renderer!.handler.gl!.LINES;\r\n        this.renderer!.handler.addProgram(new Program(\"axesShader\", {\r\n            uniforms: {\r\n                projectionViewMatrix: 'mat4'\r\n            },\r\n            attributes: {\r\n                aVertexPosition: 'vec3',\r\n                aVertexColor: 'vec4'\r\n            },\r\n            vertexShader:\r\n                `attribute vec3 aVertexPosition;\r\n            attribute vec4 aVertexColor;\r\n            uniform mat4 projectionViewMatrix;\r\n            varying vec4 vColor;\r\n            void main(void) {\r\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition, 1.0);\r\n                vColor = aVertexColor;\r\n            }`,\r\n            fragmentShader:\r\n                `precision highp float;\r\n            varying vec4 vColor;\r\n            void main(void) {\r\n                gl_FragColor = vColor;\r\n            }`\r\n        }));\r\n    }\r\n\r\n    public override frame() {\r\n\r\n        this.renderer!.handler.programs.axesShader.activate().set({\r\n            projectionViewMatrix: this.renderer!.activeCamera!.getProjectionViewMatrix(),\r\n            aVertexPosition: this.axesBuffer,\r\n            aVertexColor: this.axesColorBuffer\r\n        });\r\n\r\n        this.renderer!.handler.programs.axesShader.drawArrays(this.drawMode, this.axesBuffer!.numItems);\r\n    }\r\n\r\n    public createAxesBuffer(gridSize: number) {\r\n\r\n        const vertices = [\r\n            0.0, 0.0, 0.0, gridSize - 1, 0.0, 0.0, // x - R\r\n            0.0, 0.0, 0.0, 0.0, gridSize - 1, 0.0, // y - B  \r\n            0.0, 0.0, 0.0, 0.0, 0.0, gridSize - 1  // z - G\r\n        ];\r\n\r\n        const colors = [\r\n            1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0,   // x - R\r\n            0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0,   // y - B\r\n            0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0    // z - G\r\n        ];\r\n\r\n        this.axesBuffer = this.renderer!.handler.createArrayBuffer(new Float32Array(vertices), 3, 6);\r\n        this.axesColorBuffer = this.renderer!.handler.createArrayBuffer(new Float32Array(colors), 4, 6);\r\n    }\r\n}\r\n\r\nexport {Axes};\r\n","/**\r\n * @module og/segment/SegmentHelper\r\n */\r\n\r\nimport {N, W, S, E} from '../quadTree/quadTree';\r\n\r\ntype IndexTypeArray = Uint32Array;\r\ntype IndexesTable = [IndexTypeArray[][], IndexTypeArray[][], IndexTypeArray[][], IndexTypeArray[][]];\r\n\r\n\r\nfunction NewIndexesTypedArray(arr: number[]): IndexTypeArray {\r\n    return new Uint32Array(arr);\r\n}\r\n\r\nfunction NewIndexesTypedArrayEmpty(size: number): IndexTypeArray {\r\n    return new Uint32Array(size);\r\n}\r\n\r\nfunction createCenterBodyIndexes(size: number): IndexTypeArray {\r\n\r\n    let indexes = [];\r\n\r\n    let i0 = 1,\r\n        j0 = 1;\r\n\r\n    let i1 = 1,\r\n        j1 = 1;\r\n\r\n    let ind1 = 0, ind2 = 0, nr = 0;\r\n    for (let i = i0; i < size - 1 - i1; i++) {\r\n        for (let j = j0; j < size - j1; j++) {\r\n            ind1 = i * size + j;\r\n            nr = (i + 1) * size;\r\n            ind2 = nr + j;\r\n            indexes.push(ind1, ind2);\r\n        }\r\n        indexes.push(ind2, nr + j0);\r\n    }\r\n    indexes.push(indexes[indexes.length - 1], size * size - size);\r\n\r\n    return NewIndexesTypedArray(indexes);\r\n}\r\n\r\nfunction createWestNeighborSkirt(size: number, deltaGr: number): IndexTypeArray {\r\n    let indexes = [];\r\n    const grCount = (size - 1) / deltaGr;\r\n    const b = size * size - size;\r\n    let k = 0;\r\n    for (let i = 0; i < size - 2; i++) {\r\n        if (i % grCount === 0) {\r\n            k = i;\r\n        }\r\n        let rind = b - size * i - size + 1,\r\n            lind = b - size * k;\r\n        indexes.push(lind, rind);\r\n    }\r\n\r\n    if (deltaGr === (size - 1)) {\r\n        indexes.push(size);\r\n        indexes.push(0);\r\n    }\r\n\r\n    return NewIndexesTypedArray(indexes);\r\n}\r\n\r\nfunction createNorthNeighborSkirt(size: number, deltaGr: number): IndexTypeArray {\r\n    let indexes = [];\r\n    const grCount = (size - 1) / deltaGr;\r\n    let k = 0;\r\n    for (let i = 0; i < size - 2; i++) {\r\n        if (i % grCount === 0) {\r\n            k = i;\r\n        }\r\n        let rind = size + i + 1,\r\n            lind = k;\r\n        indexes.push(lind, rind);\r\n    }\r\n\r\n    if (deltaGr === (size - 1)) {\r\n        indexes.push(size - 2);\r\n        indexes.push(size - 1);\r\n    }\r\n\r\n    return NewIndexesTypedArray(indexes);\r\n}\r\n\r\nfunction createEastNeighborSkirt(size: number, deltaGr: number): IndexTypeArray {\r\n    let indexes = [];\r\n    const grCount = (size - 1) / deltaGr;\r\n    let k = 0;\r\n    for (let i = 0; i < size - 2; i++) {\r\n        if (i % grCount === 0) {\r\n            k = i;\r\n        }\r\n        let rind = size * (i + 1) + size - 2,\r\n            lind = size + size * k - 1;\r\n        indexes.push(lind, rind);\r\n    }\r\n\r\n    if (deltaGr === (size - 1)) {\r\n        indexes.push(size * (size - 1) - 1);\r\n        indexes.push(size * size - 1);\r\n    }\r\n\r\n    return NewIndexesTypedArray(indexes);\r\n}\r\n\r\nfunction createSouthNeighborSkirt(size: number, deltaGr: number): IndexTypeArray {\r\n    let indexes = [];\r\n    const grCount = (size - 1) / deltaGr;\r\n    let k = 0;\r\n    const rb = size * (size - 1) - 2;\r\n    const lb = size * size - 1;\r\n    for (let i = 0; i < size - 2; i++) {\r\n        if (i % grCount === 0) {\r\n            k = i;\r\n        }\r\n        let rind = rb - i,\r\n            lind = lb - k;\r\n        indexes.push(lind, rind);\r\n    }\r\n\r\n    if (deltaGr === (size - 1)) {\r\n        indexes.push(size * size - size + 1);\r\n    }\r\n    indexes.push(size * size - size);\r\n\r\n    return NewIndexesTypedArray(indexes);\r\n}\r\n\r\nfunction initIndexesBodySkirts(pow: number): IndexesTable {\r\n    let table: IndexesTable = [[], [], [], []];\r\n\r\n    for (let i = 0; i <= pow; i++) {\r\n        let d = Math.pow(2, i),\r\n            d1 = d + 1;\r\n\r\n        table[N][i] = [];\r\n        table[W][i] = [];\r\n        table[S][i] = [];\r\n        table[E][i] = [];\r\n\r\n        for (let j = 0; j <= pow; j++) {\r\n            let dd = Math.pow(2, j);\r\n            table[W][i][j] = createWestNeighborSkirt(d1, dd);\r\n            table[N][i][j] = createNorthNeighborSkirt(d1, dd);\r\n            table[E][i][j] = createEastNeighborSkirt(d1, dd);\r\n            table[S][i][j] = createSouthNeighborSkirt(d1, dd);\r\n\r\n        }\r\n    }\r\n    return table;\r\n}\r\n\r\nfunction initIndexBodiesTable(pow: number): IndexTypeArray[] {\r\n    let table = [];\r\n    for (let i = 0; i <= pow; i++) {\r\n        const d = Math.pow(2, i);\r\n        table[i] = createCenterBodyIndexes(d + 1);\r\n    }\r\n    return table;\r\n}\r\n\r\nfunction createTextureCoords(size: number): Uint16Array {\r\n    let texCoords = new Uint16Array((size + 1) * (size + 1) * 2);\r\n    let k = 0;\r\n    for (let i = 0; i <= size; i++) {\r\n        for (let j = 0; j <= size; j++) {\r\n            texCoords[k++] = j / size * 0xFFFF;\r\n            texCoords[k++] = i / size * 0xFFFF;\r\n        }\r\n    }\r\n    return texCoords;\r\n}\r\n\r\nclass SegmentHelper {\r\n\r\n    protected _maxGridSize: number;\r\n    public centerIndexesTable: IndexTypeArray[];\r\n    public skirtsIndexesTable: IndexesTable;\r\n\r\n    constructor(maxGridSize: number = 0) {\r\n        this._maxGridSize = maxGridSize;\r\n        this.centerIndexesTable = initIndexBodiesTable(this._maxGridSize)\r\n        this.skirtsIndexesTable = initIndexesBodySkirts(this._maxGridSize);\r\n    }\r\n\r\n    public get maxGridSize(): number {\r\n        return this._maxGridSize;\r\n    }\r\n\r\n    public init() {\r\n        this.centerIndexesTable = initIndexBodiesTable(this._maxGridSize);\r\n        this.skirtsIndexesTable = initIndexesBodySkirts(this._maxGridSize);\r\n    }\r\n\r\n    public setMaxGridSize(gridSize: number) {\r\n        this._maxGridSize = gridSize;\r\n        this.init();\r\n    }\r\n\r\n    public createSegmentIndexes(size: number, sidesSizes: [number, number, number, number]) {\r\n        if (size) {\r\n            let c = this.centerIndexesTable[size],\r\n                w = this.skirtsIndexesTable[W][size][sidesSizes[W]],\r\n                n = this.skirtsIndexesTable[N][size][sidesSizes[N]],\r\n                e = this.skirtsIndexesTable[E][size][sidesSizes[E]],\r\n                s = this.skirtsIndexesTable[S][size][sidesSizes[S]];\r\n\r\n            let indexes = NewIndexesTypedArrayEmpty(c.length + w.length + n.length + e.length + s.length);\r\n\r\n            indexes.set(c, 0);\r\n            indexes.set(w, c.length);\r\n            indexes.set(n, c.length + w.length);\r\n            indexes.set(e, c.length + w.length + n.length);\r\n            indexes.set(s, c.length + w.length + n.length + e.length);\r\n\r\n            return indexes;\r\n        } else {\r\n            return NewIndexesTypedArray([0, 2, 1, 3]);\r\n        }\r\n    }\r\n\r\n    public initTextureCoordsTable(pow: number): Uint16Array[] {\r\n        let table = [];\r\n        for (let i = 0; i <= pow; i++) {\r\n            const d = Math.pow(2, i);\r\n            table[i] = createTextureCoords(d);\r\n        }\r\n        return table;\r\n    }\r\n}\r\n\r\nlet instance = new SegmentHelper();\r\n\r\nexport function getInstance() {\r\n    return instance;\r\n}","precision highp float;\r\n\r\nattribute vec3 aVertexPositionHigh;\r\nattribute vec3 aVertexPositionLow;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float height;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void) {\r\n\r\n    vTextureCoord = aTextureCoord;\r\n    vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n    mat4 m = projectionMatrix * viewMatrixRTE;\r\n\r\n    vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n    vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n\r\n    // This is works for Mac Chrome, prevent some weird optimization I suppose\r\n    gl_Position = m * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n}","precision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\nuniform vec4 tileOffsetArr[SLICE_SIZE];\r\nuniform float layerOpacityArr[SLICE_SIZE];\r\nuniform sampler2D defaultTexture;\r\nuniform sampler2D samplerArr[SLICE_SIZE];\r\nuniform int samplerCount;\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void) {\r\n    gl_FragColor = texture2D(defaultTexture, vTextureCoord);\r\n    if (samplerCount == 0) return;\r\n\r\n    vec4 src;\r\n\r\n    blend(gl_FragColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\r\n    if (samplerCount == 1) return;\r\n\r\n    blend(gl_FragColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\r\n    if (samplerCount == 2) return;\r\n\r\n    blend(gl_FragColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\r\n    if (samplerCount == 3) return;\r\n\r\n    blend(gl_FragColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\r\n    if (samplerCount == 4) return;\r\n\r\n    blend(gl_FragColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\r\n}","\r\nattribute vec3 aVertexPositionHigh;\r\nattribute vec3 aVertexPositionLow;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec4 uGlobalTextureCoord;\r\nuniform vec3 uNormalMapBias;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float height;\r\n\r\nvarying vec4 vTextureCoord;\r\nvarying vec3 v_vertex;\r\nvarying vec3 cameraPosition;\r\nvarying vec2 vGlobalTextureCoord;\r\nvarying float v_height;\r\n\r\nvoid main(void) {\r\n\r\n    vec3 aVertexPosition = aVertexPositionHigh + aVertexPositionLow;\r\n    vec3 nh = height * normalize(aVertexPosition);\r\n\r\n    vTextureCoord.xy = aTextureCoord;\r\n    vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\r\n    vTextureCoord.zw = uNormalMapBias.z * ( aTextureCoord + uNormalMapBias.xy );\r\n\r\n    cameraPosition = eyePositionHigh + eyePositionLow;\r\n\r\n    vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n    vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    v_height = height;\r\n    v_vertex = aVertexPosition + nh;\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n}","precision highp float;\r\n\r\n#include \"../common/utils.glsl\"\r\n#include \"./common.glsl\"\r\n\r\nuniform vec4 specular;\r\nuniform vec3 diffuse;\r\nuniform vec3 ambient;\r\n\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D nightTexture;\r\nuniform sampler2D specularTexture;\r\nuniform sampler2D defaultTexture;\r\nuniform sampler2D samplerArr[SLICE_SIZE];\r\n\r\nuniform vec4 tileOffsetArr[SLICE_SIZE];\r\nuniform vec3 lightPosition;\r\nuniform float layerOpacityArr[SLICE_SIZE];\r\n\r\nuniform int samplerCount;\r\nuniform float nightTextureCoefficient;\r\nuniform float camHeight;\r\n\r\nvarying vec4 vTextureCoord;\r\nvarying vec3 v_vertex;\r\nvarying vec3 cameraPosition;\r\nvarying vec2 vGlobalTextureCoord;\r\nvarying float v_height;\r\n\r\nvec3 sunPos;\r\n\r\nvoid main(void) {\r\n\r\n    sunPos = lightPosition;\r\n\r\n    vec3 texNormal = texture2D(uNormalMap, vTextureCoord.zw).rgb;\r\n    vec3 normal = normalize((texNormal - 0.5) * 2.0);\r\n\r\n    float minH = 1200000.0;\r\n    float maxH = minH * 3.0;\r\n    float nightCoef = getLerpValue(minH, maxH, camHeight) * nightTextureCoefficient;\r\n\r\n    // if(camHeight > 6000000.0)\r\n    // {\r\n    //     normal = normalize(v_vertex);\r\n    // }\r\n\r\n    vec3 lightDir = normalize(sunPos);\r\n    vec3 viewDir = normalize(cameraPosition - v_vertex);\r\n\r\n    float overGround = 1.0 - step(0.1, v_height);\r\n\r\n    float shininess = texture2D(specularTexture, vGlobalTextureCoord.st).r * 255.0 * overGround;\r\n    vec3 reflectionDirection = reflect(-lightDir, normal);\r\n    float reflection = max(dot(reflectionDirection, viewDir), 0.0);\r\n    vec3 spec = specular.rgb * pow(reflection, specular.w) * shininess;\r\n    float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);\r\n    vec4 nightImageColor = texture2D(nightTexture, vGlobalTextureCoord.st);\r\n    vec3 night = nightStep * (.18 - diffuseLightWeighting * 3.0) * nightImageColor.rgb * nightCoef;\r\n    night *= overGround * step(0.0, night);\r\n    vec4 lightWeighting = vec4(ambient + diffuse * diffuseLightWeighting + night, 1.0);\r\n\r\n    gl_FragColor = texture2D(defaultTexture, vTextureCoord.xy);\r\n    if (samplerCount == 0) {\r\n        gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\r\n        return;\r\n    }\r\n\r\n    vec4 src;\r\n\r\n    blend(gl_FragColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\r\n    if (samplerCount == 1) {\r\n        gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\r\n        return;\r\n    }\r\n\r\n    blend(gl_FragColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\r\n    if (samplerCount == 2) {\r\n        gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\r\n        return;\r\n    }\r\n\r\n    blend(gl_FragColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\r\n    if (samplerCount == 3) {\r\n        gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\r\n        return;\r\n    }\r\n\r\n    blend(gl_FragColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\r\n    if (samplerCount == 4) {\r\n        gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\r\n        return;\r\n    }\r\n\r\n    blend(gl_FragColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\r\n    gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\nin vec3 aVertexPositionHigh;\r\nin vec3 aVertexPositionLow;\r\nin vec2 aTextureCoord;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec4 uGlobalTextureCoord;\r\nuniform vec3 uNormalMapBias;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float height;\r\n\r\nout vec4 vTextureCoord;\r\nout vec3 v_vertex;\r\nout vec3 cameraPosition;\r\nout vec2 vGlobalTextureCoord;\r\nout float v_height;\r\n\r\nvoid main(void) {\r\n\r\n    vec3 aVertexPosition = aVertexPositionHigh + aVertexPositionLow;\r\n    vec3 nh = height * normalize(aVertexPosition);\r\n\r\n    vTextureCoord.xy = aTextureCoord;\r\n    vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\r\n    vTextureCoord.zw = uNormalMapBias.z * (aTextureCoord + uNormalMapBias.xy);\r\n\r\n    cameraPosition = eyePositionHigh + eyePositionLow;\r\n\r\n    vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n    vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    v_height = height;\r\n    v_vertex = aVertexPosition + nh;\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\n#include \"../atmos/common.glsl\"\r\n//#include \"../common/utils.glsl\"\r\n\r\nuniform vec4 specular;\r\nuniform vec3 diffuse;\r\nuniform vec3 ambient;\r\n\r\nuniform vec3 lightPosition;\r\n\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D nightTexture;\r\nuniform sampler2D specularTexture;\r\nuniform sampler2D transmittanceTexture;\r\nuniform sampler2D scatteringTexture;\r\nuniform sampler2D defaultTexture;\r\nuniform sampler2D samplerArr[SLICE_SIZE];\r\n\r\nuniform vec4 tileOffsetArr[SLICE_SIZE];\r\nuniform float layerOpacityArr[SLICE_SIZE];\r\n\r\nuniform int samplerCount;\r\nuniform float nightTextureCoefficient;\r\n\r\nuniform vec2 maxMinOpacity;\r\nuniform float camHeight;\r\n\r\nuniform float transitionOpacity;\r\n\r\nin vec4 vTextureCoord;\r\nin vec3 v_vertex;\r\nin vec3 cameraPosition;\r\nin vec2 vGlobalTextureCoord;\r\nin float v_height;\r\n\r\nvec3 sunPos;\r\n\r\nlayout (location = 0) out vec4 diffuseColor;\r\n\r\nvec3 transmittanceFromTexture(float height, float angle)\r\n{\r\n    float u = (angle + 1.0) * 0.5;\r\n    float v = height / ATMOS_HEIGHT;\r\n    return texture(transmittanceTexture, vec2(u, v)).xyz;\r\n}\r\n\r\nvec3 multipleScatteringContributionFromTexture(float height, float angle)\r\n{\r\n    float u = (angle + 1.0) * 0.5;\r\n    float v = height / ATMOS_HEIGHT;\r\n    return texture(scatteringTexture, vec2(u, v)).xyz;\r\n}\r\n\r\nvoid getSunIlluminance(in vec3 point, in vec3 lightDir, out vec3 sunIlluminance)\r\n{\r\n    //     float r = length(point);\r\n    //     float mu_s = dot(point, sun_direction) / r;\r\n    //     float height = r - BOTTOM_RADIUS;\r\n\r\n    float mu_s = dot(normalize(point), lightDir);\r\n    float height = length(point) - BOTTOM_RADIUS;\r\n    sunIlluminance = SUN_INTENSITY * transmittanceFromTexture(height, mu_s);\r\n}\r\n\r\nvoid atmosGroundColor(out vec4 fragColor, in vec3 normal)\r\n{\r\n    vec3 cameraPosition = cameraPosition;\r\n\r\n    if (length(cameraPosition * SPHERE_TO_ELLIPSOID_SCALE) < BOTTOM_RADIUS + 1.0) {\r\n        cameraPosition = normalize(cameraPosition * SPHERE_TO_ELLIPSOID_SCALE) * (BOTTOM_RADIUS + 1.0) / SPHERE_TO_ELLIPSOID_SCALE;\r\n    }\r\n\r\n    vec3 rayDirection = normalize(v_vertex - cameraPosition);\r\n    vec3 lightDir = normalize(sunPos);\r\n\r\n    rayDirection = normalize(rayDirection * SPHERE_TO_ELLIPSOID_SCALE);\r\n    vec3 camPos = cameraPosition * SPHERE_TO_ELLIPSOID_SCALE;\r\n    lightDir = normalize(lightDir * SPHERE_TO_ELLIPSOID_SCALE);\r\n\r\n\r\n    vec3 light = vec3(0.0);\r\n    vec3 transmittanceFromCameraToSpace = vec3(1.0);\r\n    float offset = 0.0;\r\n    float distanceToSpace = 0.0;\r\n\r\n    intersectSphere(camPos, rayDirection, TOP_RADIUS, offset, distanceToSpace);\r\n\r\n    vec3 rayOrigin = camPos;\r\n\r\n    // above atmosphere\r\n    if (offset > 0.0)\r\n    {\r\n        // intersection of camera ray with atmosphere\r\n        rayOrigin += rayDirection * offset;\r\n    }\r\n\r\n    float height = length(rayOrigin) - BOTTOM_RADIUS;\r\n    float rayAngle = dot(rayOrigin, rayDirection) / length(rayOrigin);\r\n    bool cameraBelow = rayAngle < 0.0;\r\n\r\n    transmittanceFromCameraToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\r\n\r\n    float phaseAngle = dot(lightDir, rayDirection);\r\n    float rayleighPhase = rayleighPhase(phaseAngle);\r\n    float miePhase = miePhase(phaseAngle);\r\n\r\n    float distanceToGround = 0.0;\r\n\r\n    bool hitGround = intersectSphere(camPos, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\r\n    //intersectSphere(camPos, rayDirection, BOTTOM_RADIUS, distanceToGround);\r\n\r\n\r\n    if (length(v_vertex * SPHERE_TO_ELLIPSOID_SCALE) > BOTTOM_RADIUS) {\r\n        distanceToGround = distance(camPos, v_vertex * SPHERE_TO_ELLIPSOID_SCALE);\r\n    }\r\n\r\n    float segmentLength = (distanceToGround - max(offset, 0.0)) / float(SAMPLE_COUNT);\r\n\r\n    float t = segmentLength * 0.5;\r\n\r\n    vec3 transmittanceCamera;\r\n    vec3 transmittanceLight;\r\n\r\n    for (int i = 0; i < SAMPLE_COUNT; i++)\r\n    {\r\n        vec3 position = rayOrigin + t * rayDirection;\r\n        float height = length(position) - BOTTOM_RADIUS;\r\n        vec3 up = position / length(position);\r\n        float rayAngle = dot(up, rayDirection);\r\n        float lightAngle = dot(up, lightDir);\r\n        vec3 transmittanceToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\r\n        transmittanceCamera = cameraBelow ? (transmittanceToSpace / transmittanceFromCameraToSpace) : (transmittanceFromCameraToSpace / transmittanceToSpace);\r\n        transmittanceLight = transmittanceFromTexture(height, lightAngle);\r\n        vec2 opticalDensity = exp(-height / rayleighMieHeights);\r\n        vec3 scatteredLight = transmittanceLight * (rayleighScatteringCoefficient * opticalDensity.x * rayleighPhase + mieScatteringCoefficient * opticalDensity.y * miePhase);\r\n        scatteredLight += multipleScatteringContributionFromTexture(height, lightAngle) * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y);\r\n        light += transmittanceCamera * scatteredLight * segmentLength;\r\n        t += segmentLength;\r\n    }\r\n\r\n    light *= SUN_INTENSITY;\r\n\r\n    vec3 hitPoint = camPos + rayDirection * distanceToGround;\r\n    vec3 up = normalize(hitPoint);\r\n    float diffuseAngle = max(dot(up, lightDir), 0.0);\r\n\r\n    float lightAngle = dot(normal, lightDir);\r\n    vec3 tA = transmittanceCamera * GROUND_ALBEDO * SUN_INTENSITY;\r\n    vec3 scatteringLight = multipleScatteringContributionFromTexture(height, lightAngle);\r\n    vec3 diffuseTransmittanceLight = transmittanceLight * diffuseAngle;\r\n    light += tA * (scatteringLight + diffuseTransmittanceLight);\r\n\r\n    fragColor = vec4(pow(light * 8.0, vec3(1.0 / 2.2)), 1.0);\r\n}\r\n\r\nvoid getAtmosFadingOpacity(out float opacity)\r\n{\r\n    float c = length(cameraPosition);\r\n    float maxDist = sqrt(c * c - BOTTOM_RADIUS * BOTTOM_RADIUS);\r\n    float minDist = c - BOTTOM_RADIUS;\r\n    float vertDist = distance(cameraPosition, v_vertex);\r\n    opacity = clamp(maxMinOpacity.y + (maxMinOpacity.x - maxMinOpacity.y) * getLerpValue(minDist, maxDist, vertDist), 0.0, 1.0);\r\n}\r\n\r\nvoid main(void) {\r\n\r\n    sunPos = lightPosition;\r\n\r\n    vec3 texNormal = texture(uNormalMap, vTextureCoord.zw).rgb;\r\n    vec3 normal = normalize((texNormal - 0.5) * 2.0);\r\n\r\n    float minH = 1200000.0;\r\n    float maxH = minH * 3.0;\r\n    float nightCoef = getLerpValue(minH, maxH, camHeight) * nightTextureCoefficient;\r\n\r\n    // if(camHeight > 6000000.0)\r\n    // {\r\n    //    normal = normalize(v_vertex);\r\n    // }\r\n\r\n    vec3 lightDir = normalize(sunPos);\r\n    vec3 viewDir = normalize(cameraPosition - v_vertex);\r\n\r\n    vec4 atmosColor;\r\n    atmosGroundColor(atmosColor, normal);\r\n\r\n    vec3 sunIlluminance;\r\n    getSunIlluminance(v_vertex * SPHERE_TO_ELLIPSOID_SCALE, lightDir * SPHERE_TO_ELLIPSOID_SCALE, sunIlluminance);\r\n\r\n    float overGround = 1.0 - step(0.1, v_height);\r\n\r\n    float shininess = texture(specularTexture, vGlobalTextureCoord.st).r * 255.0 * overGround;\r\n    vec3 reflectionDirection = reflect(-lightDir, normal);\r\n    float reflection = max(dot(reflectionDirection, viewDir), 0.0);\r\n    vec3 spec = sunIlluminance * specular.rgb * pow(reflection, specular.w) * shininess;\r\n    float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);\r\n\r\n    vec4 nightImageColor = texture(nightTexture, vGlobalTextureCoord.st);\r\n    vec3 night = nightStep * (.18 - diffuseLightWeighting * 3.0) * nightImageColor.rgb * nightCoef;\r\n    night *= overGround * step(0.0, night);\r\n    vec4 lightWeighting = vec4(ambient + sunIlluminance * diffuse * diffuseLightWeighting + night, 1.0);\r\n\r\n    float fadingOpacity;\r\n    getAtmosFadingOpacity(fadingOpacity);\r\n\r\n    getSunIlluminance(cameraPosition, viewDir * SPHERE_TO_ELLIPSOID_SCALE, sunIlluminance);\r\n\r\n    spec *= sunIlluminance;\r\n\r\n    diffuseColor = texture(defaultTexture, vTextureCoord.xy);\r\n    if (samplerCount == 0) {\r\n        diffuseColor = mix(diffuseColor * lightWeighting, atmosColor, fadingOpacity) + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    vec4 src;\r\n\r\n    blend(diffuseColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\r\n    if (samplerCount == 1) {\r\n        diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\r\n    if (samplerCount == 2) {\r\n        diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\r\n    if (samplerCount == 3) {\r\n        diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\r\n    if (samplerCount == 4) {\r\n        diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\r\n    diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\r\n    diffuseColor *= transitionOpacity;\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\nin vec3 aVertexPositionHigh;\r\nin vec3 aVertexPositionLow;\r\nin vec2 aTextureCoord;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec4 uGlobalTextureCoord;\r\nuniform vec3 uNormalMapBias;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float height;\r\n\r\nout vec4 vTextureCoord;\r\nout vec3 v_vertex;\r\nout vec3 cameraPosition;\r\nout vec2 vGlobalTextureCoord;\r\nout float v_height;\r\n\r\nvoid main(void) {\r\n\r\n    vec3 aVertexPosition = aVertexPositionHigh + aVertexPositionLow;\r\n    vec3 nh = height * normalize(aVertexPosition);\r\n\r\n    vTextureCoord.xy = aTextureCoord;\r\n    vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\r\n    vTextureCoord.zw = uNormalMapBias.z * (aTextureCoord + uNormalMapBias.xy);\r\n\r\n    cameraPosition = eyePositionHigh + eyePositionLow;\r\n\r\n    vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n    vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    v_height = height;\r\n    v_vertex = aVertexPosition + nh;\r\n\r\n    gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\n#include \"../common/utils.glsl\"\r\n#include \"./common.glsl\"\r\n\r\nuniform vec4 specular;\r\nuniform vec3 diffuse;\r\nuniform vec3 ambient;\r\n\r\nuniform sampler2D uNormalMap;\r\nuniform sampler2D nightTexture;\r\nuniform sampler2D specularTexture;\r\nuniform sampler2D defaultTexture;\r\nuniform sampler2D samplerArr[SLICE_SIZE];\r\n\r\nuniform vec4 tileOffsetArr[SLICE_SIZE];\r\nuniform vec3 lightPosition;\r\nuniform float layerOpacityArr[SLICE_SIZE];\r\n\r\nuniform int samplerCount;\r\nuniform float nightTextureCoefficient;\r\n\r\nuniform float transitionOpacity;\r\n\r\nuniform float camHeight;\r\n\r\nin vec4 vTextureCoord;\r\nin vec3 v_vertex;\r\nin vec3 cameraPosition;\r\nin vec2 vGlobalTextureCoord;\r\nin float v_height;\r\n\r\nvec3 sunPos;\r\n\r\nlayout (location = 0) out vec4 diffuseColor;\r\n\r\nvoid main(void) {\r\n\r\n    sunPos = lightPosition;\r\n\r\n    vec3 texNormal = texture(uNormalMap, vTextureCoord.zw).rgb;\r\n    vec3 normal = normalize((texNormal - 0.5) * 2.0);\r\n\r\n    float minH = 1200000.0;\r\n    float maxH = minH * 3.0;\r\n    float nightCoef = getLerpValue(minH, maxH, camHeight) * nightTextureCoefficient;\r\n\r\n    // if(camHeight > 6000000.0)\r\n    // {\r\n    //     normal = normalize(v_vertex);\r\n    // }\r\n\r\n    vec3 lightDir = normalize(sunPos);\r\n    vec3 viewDir = normalize(cameraPosition - v_vertex);\r\n\r\n    float overGround = 1.0 - step(0.1, v_height);\r\n\r\n    float shininess = texture(specularTexture, vGlobalTextureCoord.st).r * 255.0 * overGround;\r\n    vec3 reflectionDirection = reflect(-lightDir, normal);\r\n    float reflection = max(dot(reflectionDirection, viewDir), 0.0);\r\n    vec3 spec = specular.rgb * pow(reflection, specular.w) * shininess;\r\n    float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);\r\n    vec4 nightImageColor = texture(nightTexture, vGlobalTextureCoord.st);\r\n    vec3 night = nightStep * (.18 - diffuseLightWeighting * 3.0) * nightImageColor.rgb * nightCoef;\r\n    night *= overGround * step(0.0, night);\r\n    vec4 lightWeighting = vec4(ambient + diffuse * diffuseLightWeighting + night, 1.0);\r\n\r\n    diffuseColor = texture(defaultTexture, vTextureCoord.xy);\r\n\r\n    if (samplerCount == 0) {\r\n        diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    vec4 src;\r\n\r\n    blend(diffuseColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\r\n    if (samplerCount == 1) {\r\n        diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\r\n    if (samplerCount == 2) {\r\n        diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\r\n    if (samplerCount == 3) {\r\n        diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\r\n    if (samplerCount == 4) {\r\n        diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\r\n        diffuseColor *= transitionOpacity;\r\n        return;\r\n    }\r\n\r\n    blend(diffuseColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\r\n    diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\r\n    diffuseColor *= transitionOpacity;\r\n}","precision highp float;\r\n\r\nattribute vec3 aVertexPositionHigh;\r\nattribute vec3 aVertexPositionLow;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float height;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void) {\r\n\r\n    vTextureCoord = aTextureCoord;\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    mat4 m = projectionMatrix * viewMatrixRTE;\r\n\r\n    vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\r\n\r\n    vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n    vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n\r\n    gl_Position = m * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n}","precision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\nuniform vec4 tileOffsetArr[SLICE_SIZE];\r\nuniform vec4 pickingColorArr[SLICE_SIZE];\r\nuniform sampler2D samplerArr[SLICE_SIZE];\r\nuniform sampler2D pickingMaskArr[SLICE_SIZE];\r\nuniform int samplerCount;\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void) {\r\n\r\n    gl_FragColor = vec4(0.0);\r\n\r\n    if (samplerCount == 0) return;\r\n\r\n    vec2 tc;\r\n    vec4 t;\r\n    vec4 p;\r\n\r\n    blendPicking(gl_FragColor, tileOffsetArr[0], samplerArr[0], pickingMaskArr[0], pickingColorArr[0], 1.0);\r\n    if (samplerCount == 1) return;\r\n\r\n    blendPicking(gl_FragColor, tileOffsetArr[1], samplerArr[1], pickingMaskArr[1], pickingColorArr[1], 1.0);\r\n    if (samplerCount == 2) return;\r\n\r\n    blendPicking(gl_FragColor, tileOffsetArr[2], samplerArr[2], pickingMaskArr[2], pickingColorArr[2], 1.0);\r\n    if (samplerCount == 3) return;\r\n\r\n    blendPicking(gl_FragColor, tileOffsetArr[3], samplerArr[3], pickingMaskArr[3], pickingColorArr[3], 1.0);\r\n    if (samplerCount == 4) return;\r\n\r\n    blendPicking(gl_FragColor, tileOffsetArr[4], samplerArr[4], pickingMaskArr[4], pickingColorArr[4], 1.0);\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\nin vec3 aVertexPositionHigh;\r\nin vec3 aVertexPositionLow;\r\n\r\nuniform mat4 projectionMatrix;\r\nuniform mat4 viewMatrix;\r\nuniform vec3 eyePositionHigh;\r\nuniform vec3 eyePositionLow;\r\nuniform float height;\r\n\r\nvoid main(void) {\r\n\r\n    mat4 viewMatrixRTE = viewMatrix;\r\n    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    mat4 m = projectionMatrix * viewMatrixRTE;\r\n\r\n    vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\r\n\r\n    vec3 eyePosition = eyePositionHigh + eyePositionLow;\r\n    vec3 vertexPosition = aVertexPositionHigh + aVertexPositionLow;\r\n\r\n    vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n    vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n\r\n    gl_Position = m * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\nuniform float frustumPickingColor;\r\n\r\nlayout (location = 0) out vec4 frustumColor;\r\nlayout (location = 1) out vec4 depthColor;\r\n\r\nvoid main(void) {\r\n    frustumColor = vec4(frustumPickingColor, frustumPickingColor, frustumPickingColor, 1.0);\r\n    depthColor = vec4(gl_FragCoord.z, gl_FragCoord.z, gl_FragCoord.z, 1.0);\r\n}","import type {AtmosphereParameters} from \"../atmos/atmos\";\r\nimport {Program} from \"../../webgl/Program\";\r\n\r\nimport drawnode_screen_nl_vert from './drawnode_screen_nl.vert.glsl';\r\nimport drawnode_screen_nl_frag from './drawnode_screen_nl.frag.glsl';\r\n\r\nimport drawnode_screen_wl_webgl1NoAtmos_vert from './drawnode_screen_wl_webgl1NoAtmos.vert.glsl';\r\nimport drawnode_screen_wl_webgl1NoAtmos_frag from './drawnode_screen_wl_webgl1NoAtmos.frag.glsl';\r\n\r\nimport drawnode_screen_wl_webgl2Atmos_vert from './drawnode_screen_wl_webgl2Atmos.vert.glsl';\r\nimport drawnode_screen_wl_webgl2Atmos_frag from './drawnode_screen_wl_webgl2Atmos.frag.glsl';\r\n\r\nimport drawnode_screen_wl_webgl2NoAtmos_vert from './drawnode_screen_wl_webgl2NoAtmos.vert.glsl';\r\nimport drawnode_screen_wl_webgl2NoAtmos_frag from './drawnode_screen_wl_webgl2NoAtmos.frag.glsl';\r\n\r\nimport drawnode_colorPicking_vert from './drawnode_colorPicking.vert.glsl';\r\nimport drawnode_colorPicking_frag from './drawnode_colorPicking.frag.glsl';\r\n\r\nimport drawnode_depth_vert from './drawnode_depth.vert.glsl';\r\nimport drawnode_depth_frag from './drawnode_depth.frag.glsl';\r\nimport {stringTemplate2} from \"../../utils/shared\";\r\n\r\n// REMEMBER!\r\n// src*(1)+dest*(1-src.alpha)\r\n// glBlendFunc(GL_ONE, GL_ONE_MINUS_SRC_ALPHA);\r\n// src*(src.alpha)+dest*(1-src.alpha)\r\n// glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);\r\n\r\n\r\nconst NIGHT = `const vec3 nightStep = 10.0 * vec3(0.58, 0.48, 0.25);`;\r\n\r\nconst DEF_BLEND = `#define blend(DEST, SAMPLER, OFFSET, OPACITY) \\\r\n                    src = texture( SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw );\\\r\n                    DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;`;\r\n\r\nconst SLICE_SIZE = 4;\r\n\r\nexport function drawnode_screen_nl(): Program {\r\n    return new Program(\"drawnode_screen_nl\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            samplerCount: \"int\",\r\n            tileOffsetArr: \"vec4\",\r\n            layerOpacityArr: \"float\",\r\n            samplerArr: \"sampler2darray\",\r\n            defaultTexture: \"sampler2d\",\r\n            height: \"float\"\r\n        }, attributes: {\r\n            aVertexPositionHigh: \"vec3\",\r\n            aVertexPositionLow: \"vec3\",\r\n            aTextureCoord: \"vec2\"\r\n        },\r\n        vertexShader: drawnode_screen_nl_vert,\r\n        fragmentShader: drawnode_screen_nl_frag\r\n    });\r\n}\r\n\r\nexport function drawnode_screen_wl_webgl1NoAtmos(): Program {\r\n    return new Program(\"drawnode_screen_wl\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            height: \"float\",\r\n            uGlobalTextureCoord: \"vec4\",\r\n            uNormalMapBias: \"vec3\",\r\n            samplerCount: \"int\",\r\n            tileOffsetArr: \"vec4\",\r\n            layerOpacityArr: \"float\",\r\n            samplerArr: \"sampler2darray\",\r\n            defaultTexture: \"sampler2d\",\r\n            uNormalMap: \"sampler2d\",\r\n            nightTexture: \"sampler2d\",\r\n            specularTexture: \"sampler2d\",\r\n            lightPosition: \"vec3\",\r\n            diffuse: \"vec3\",\r\n            ambient: \"vec3\",\r\n            specular: \"vec4\",\r\n            camHeight: \"float\",\r\n            nightTextureCoefficient: \"float\"\r\n        }, attributes: {\r\n            aVertexPositionHigh: \"vec3\",\r\n            aVertexPositionLow: \"vec3\",\r\n            aTextureCoord: \"vec2\"\r\n        },\r\n        vertexShader: drawnode_screen_wl_webgl1NoAtmos_vert,\r\n        fragmentShader: drawnode_screen_wl_webgl1NoAtmos_frag\r\n    });\r\n}\r\n\r\nexport function drawnode_screen_wl_webgl2NoAtmos(): Program {\r\n    return new Program(\"drawnode_screen_wl\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            height: \"float\",\r\n            uGlobalTextureCoord: \"vec4\",\r\n            uNormalMapBias: \"vec3\",\r\n            samplerCount: \"int\",\r\n            tileOffsetArr: \"vec4\",\r\n            layerOpacityArr: \"float\",\r\n            samplerArr: \"sampler2darray\",\r\n            defaultTexture: \"sampler2d\",\r\n            uNormalMap: \"sampler2d\",\r\n            nightTexture: \"sampler2d\",\r\n            specularTexture: \"sampler2d\",\r\n            lightPosition: \"vec3\",\r\n            diffuse: \"vec3\",\r\n            ambient: \"vec3\",\r\n            specular: \"vec4\",\r\n            camHeight: \"float\",\r\n            nightTextureCoefficient: \"float\",\r\n            transitionOpacity: \"float\"\r\n        }, attributes: {\r\n            aVertexPositionHigh: \"vec3\",\r\n            aVertexPositionLow: \"vec3\",\r\n            aTextureCoord: \"vec2\"\r\n        },\r\n        vertexShader: drawnode_screen_wl_webgl2NoAtmos_vert,\r\n        fragmentShader: drawnode_screen_wl_webgl2NoAtmos_frag\r\n    });\r\n}\r\n\r\nexport function drawnode_screen_wl_webgl2Atmos(atmosParams?: AtmosphereParameters): Program {\r\n    return new Program(\"drawnode_screen_wl\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            height: \"float\",\r\n            uGlobalTextureCoord: \"vec4\",\r\n            uNormalMapBias: \"vec3\",\r\n            samplerCount: \"int\",\r\n            tileOffsetArr: \"vec4\",\r\n            layerOpacityArr: \"float\",\r\n            samplerArr: \"sampler2darray\",\r\n            defaultTexture: \"sampler2d\",\r\n            uNormalMap: \"sampler2d\",\r\n            nightTexture: \"sampler2d\",\r\n            specularTexture: \"sampler2d\",\r\n            lightPosition: \"vec3\",\r\n            diffuse: \"vec3\",\r\n            ambient: \"vec3\",\r\n            specular: \"vec4\",\r\n            transmittanceTexture: \"sampler2D\",\r\n            scatteringTexture: \"sampler2D\",\r\n            camHeight: \"float\",\r\n            nightTextureCoefficient: \"float\",\r\n            maxMinOpacity: \"vec2\",\r\n            transitionOpacity: \"float\"\r\n        }, attributes: {\r\n            aVertexPositionHigh: \"vec3\",\r\n            aVertexPositionLow: \"vec3\",\r\n            aTextureCoord: \"vec2\"\r\n        },\r\n        vertexShader: drawnode_screen_wl_webgl2Atmos_vert,\r\n        fragmentShader: stringTemplate2(drawnode_screen_wl_webgl2Atmos_frag, atmosParams)\r\n    });\r\n}\r\n\r\nexport function drawnode_colorPicking(): Program {\r\n    return new Program(\"drawnode_colorPicking\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            samplerCount: \"int\",\r\n            tileOffsetArr: \"vec4\",\r\n            samplerArr: \"sampler2darray\",\r\n            pickingMaskArr: \"sampler2darray\",\r\n            pickingColorArr: \"vec4\",\r\n            height: \"float\"\r\n        }, attributes: {\r\n            aVertexPositionHigh: \"vec3\",\r\n            aVertexPositionLow: \"vec3\",\r\n            aTextureCoord: \"vec2\"\r\n        },\r\n        vertexShader: drawnode_colorPicking_vert,\r\n        fragmentShader: drawnode_colorPicking_frag\r\n    });\r\n}\r\n\r\nexport function drawnode_depth(): Program {\r\n    return new Program(\"drawnode_depth\", {\r\n        uniforms: {\r\n            projectionMatrix: \"mat4\",\r\n            viewMatrix: \"mat4\",\r\n            height: \"float\",\r\n            eyePositionHigh: \"vec3\",\r\n            eyePositionLow: \"vec3\",\r\n            frustumPickingColor: \"float\"\r\n        }, attributes: {\r\n            aVertexPositionHigh: \"vec3\",\r\n            aVertexPositionLow: \"vec3\"\r\n        },\r\n        vertexShader: drawnode_depth_vert,\r\n        fragmentShader: drawnode_depth_frag\r\n    });\r\n}\r\n\r\n\r\n// export const ENCODE24 = `vec3 encode24(highp float f) {\r\n//                 float F = abs(f);\r\n//                 float s = step( 0.0, -f );\r\n//                 float e = floor( log2(F) );\r\n//                 float m = exp2(- e) * F;\r\n//                 e = floor( log2(F) + 127.0 ) + floor( log2(m) );\r\n//                 return vec3(\r\n//                     ( 128.0 * s + floor( e * exp2(-1.0) ) ) / 255.0,\r\n//                     ( 128.0 * mod( e, 2.0 ) + mod( floor( m * 128.0 ), 128.0 ) ) / 255.0,\r\n//                     floor( mod( floor( m * exp2( 23.0 - 8.0) ), exp2(8.0) ) ) / 255.0);\r\n//             }`\r\n\r\n// export function drawnode_heightPicking(): Program {\r\n//     return new Program(\"drawnode_heightPicking\", {\r\n//         uniforms: {\r\n//             projectionMatrix: \"mat4\",\r\n//             viewMatrix: \"mat4\",\r\n//             height: \"float\",\r\n//             eyePositionHigh: \"vec3\",\r\n//             eyePositionLow: \"vec3\"\r\n//         }, attributes: {\r\n//             aVertexPositionHigh: \"vec3\", aVertexPositionLow: \"vec3\"\r\n//         },\r\n//\r\n//         vertexShader:\r\n//             `precision highp float;\r\n//\r\n//             attribute vec3 aVertexPositionHigh;\r\n//             attribute vec3 aVertexPositionLow;\r\n//\r\n//             uniform mat4 projectionMatrix;\r\n//             uniform mat4 viewMatrix;\r\n//             uniform vec3 eyePositionHigh;\r\n//             uniform vec3 eyePositionLow;\r\n//             uniform float height;\r\n//\r\n//             varying vec4 vert;\r\n//\r\n//             void main(void) {\r\n//\r\n//                 mat4 viewMatrixRTE = viewMatrix;\r\n//                 viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\r\n//\r\n//                 vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\r\n//\r\n//                 vec3 eyePosition = eyePositionHigh + eyePositionLow;\r\n//                 vec3 vertexPosition = aVertexPositionHigh + aVertexPositionLow;\r\n//\r\n//                 vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\r\n//                 vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\r\n//\r\n//                 vert = viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);\r\n//\r\n//                 gl_Position =  projectionMatrix * vert;\r\n//             }`,\r\n//\r\n//         fragmentShader:\r\n//             `precision highp float;\r\n//\r\n//             varying vec4 vert;\r\n//\r\n//             ${ENCODE24}\r\n//\r\n//             void main(void) {\r\n//                 gl_FragColor = vec4(encode24(length(vert.xyz)), 1.0);\r\n//             }`\r\n//     });\r\n// }\r\n","attribute vec2 a_position;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4(a_position, 0.0, 1.0);\r\n}","precision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\nuniform vec2 iResolution;\r\n\r\nvoid main(void)\r\n{\r\n    vec2 uv = gl_FragCoord.xy / iResolution.xy;\r\n    float height = uv.y * ATMOS_HEIGHT;\r\n    float angle = uv.x * 2.0 - 1.0;\r\n    gl_FragColor = vec4(transmittance(height, angle), 1.0);\r\n}","attribute vec2 a_position;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4(a_position, 0.0, 1.0);\r\n}","precision highp float;\r\n\r\n#include \"./common.glsl\"\r\n\r\nuniform sampler2D transmittanceTexture;\r\nuniform vec2 iResolution;\r\n\r\nvec3 transmittanceFromTexture(float height, float angle)\r\n{\r\n    float u = (angle + 1.0) * 0.5;\r\n    float v = height / ATMOS_HEIGHT;\r\n    return texture2D(transmittanceTexture, vec2(u, v)).xyz;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    vec2 uv = gl_FragCoord.xy / iResolution.xy;\r\n\r\n    float height = uv.y * ATMOS_HEIGHT;\r\n    float angle = uv.x * 2.0 - 1.0;\r\n\r\n    vec3 rayOrigin = vec3(0.0, BOTTOM_RADIUS + height, 0.0);\r\n    vec3 up = rayOrigin / length(rayOrigin);\r\n    vec3 lightDirection = vec3(sqrt(1.0 - angle * angle), angle, 0.0);\r\n\r\n    const float isotropicPhase = 1.0 / (4.0 * PI);\r\n\r\n    vec3 light = vec3(0.0);\r\n    vec3 lightTransferFactor = vec3(0.0);\r\n\r\n    for (int i = 0; i < SQRT_SAMPLE_COUNT; i++)\r\n    {\r\n        for (int j = 0; j < SQRT_SAMPLE_COUNT; j++)\r\n        {\r\n            float u = ((0.5 + float(i)) / float(SQRT_SAMPLE_COUNT)) * 2.0 - 1.0;\r\n            float v = (0.5 + float(j)) / float(SQRT_SAMPLE_COUNT);\r\n            float r = sqrt(1.0 - u * u);\r\n            float theta = 2.0 * PI * v;\r\n            vec3 rayDirection = vec3(cos(theta) * r, sin(theta) * r, u);\r\n\r\n            float rayAngle = dot(up, rayDirection);\r\n            bool cameraBelow = rayAngle < 0.0;\r\n\r\n            vec3 transmittanceFromCameraToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\r\n\r\n            float offset = 0.0;\r\n            float distanceToSpace = 0.0;\r\n\r\n            intersectSphere(rayOrigin, rayDirection, TOP_RADIUS, offset, distanceToSpace);\r\n\r\n            float distanceToGround = 0.0;\r\n            bool hitGround = intersectSphere(rayOrigin, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\r\n            float segmentLength = (hitGround ? distanceToGround : distanceToSpace) / float(SAMPLE_COUNT);\r\n            float t = segmentLength * 0.5;\r\n\r\n            vec3 transmittanceCamera;\r\n            vec3 transmittanceLight;\r\n\r\n            for (int k = 0; k < SAMPLE_COUNT; k++)\r\n            {\r\n                vec3 position = rayOrigin + t * rayDirection;\r\n                float height = length(position) - BOTTOM_RADIUS;\r\n                vec3 up = position / length(position);\r\n                float rayAngle = dot(up, rayDirection);\r\n                float lightAngle = dot(up, lightDirection);\r\n\r\n                float distanceToGround;\r\n                float shadow = intersectSphere(position, lightDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround >= 0.0 ? 0.0 : 1.0;\r\n                vec3 transmittanceToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\r\n\r\n                transmittanceCamera = cameraBelow ? (transmittanceToSpace / transmittanceFromCameraToSpace) : (transmittanceFromCameraToSpace / transmittanceToSpace);\r\n                transmittanceLight = transmittanceFromTexture(height, lightAngle);\r\n\r\n                vec2 opticalDensity = exp(-height / rayleighMieHeights);\r\n                vec3 scatteredLight = transmittanceLight * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y) * isotropicPhase;\r\n\r\n                light += shadow * transmittanceCamera * scatteredLight * segmentLength;\r\n                lightTransferFactor += transmittanceCamera * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y) * segmentLength;\r\n\r\n                t += segmentLength;\r\n            }\r\n\r\n            if (hitGround)\r\n            {\r\n                vec3 hitPoint = rayOrigin + rayDirection * distanceToGround;\r\n                vec3 normal = normalize(hitPoint);\r\n                float diffuseAngle = max(dot(normal, lightDirection), 0.0);\r\n                light += transmittanceCamera * transmittanceLight * GROUND_ALBEDO * diffuseAngle;\r\n            }\r\n        }\r\n    }\r\n\r\n    light /= float(SAMPLE_COUNT);\r\n    lightTransferFactor /= float(SAMPLE_COUNT);\r\n    vec3 color = light / (1.0 - lightTransferFactor);\r\n    gl_FragColor = vec4(color, 1.0);\r\n}","import {Program} from '../../webgl/Program';\r\n\r\nimport transmittance_vert from './transmittance.vert.glsl';\r\nimport transmittance_frag from './transmittance.frag.glsl';\r\n\r\nimport scattering_vert from './scattering.vert.glsl';\r\nimport scattering_frag from './scattering.frag.glsl';\r\n\r\nimport {stringTemplate2} from \"../../utils/shared\";\r\n\r\nexport interface AtmosphereParameters {\r\n    ATMOS_HEIGHT: number,\r\n    RAYLEIGH_SCALE: number,\r\n    MIE_SCALE: number,\r\n    GROUND_ALBEDO: number,\r\n    BOTTOM_RADIUS: number\r\n    rayleighScatteringCoefficient_0: number,\r\n    rayleighScatteringCoefficient_1: number,\r\n    rayleighScatteringCoefficient_2: number,\r\n    mieScatteringCoefficient: number,\r\n    mieExtinctionCoefficient: number,\r\n    ozoneAbsorptionCoefficient_0: number,\r\n    ozoneAbsorptionCoefficient_1: number,\r\n    ozoneAbsorptionCoefficient_2: number,\r\n    SUN_ANGULAR_RADIUS: number,\r\n    SUN_INTENSITY: number,\r\n    ozoneDensityHeight: number,\r\n    ozoneDensityWide: number,\r\n}\r\n\r\nconst DEFAULT_PARAMS: AtmosphereParameters = {\r\n    ATMOS_HEIGHT: 100000.0,\r\n    RAYLEIGH_SCALE: 0.08,\r\n    MIE_SCALE: 0.012,\r\n    GROUND_ALBEDO: 0.05,\r\n    BOTTOM_RADIUS: 6356752.3142451793,\r\n    rayleighScatteringCoefficient_0: 5.802,\r\n    rayleighScatteringCoefficient_1: 13.558,\r\n    rayleighScatteringCoefficient_2: 33.100,\r\n    mieScatteringCoefficient: 3.996,\r\n    mieExtinctionCoefficient: 4.440,\r\n    ozoneAbsorptionCoefficient_0: 0.650,\r\n    ozoneAbsorptionCoefficient_1: 1.881,\r\n    ozoneAbsorptionCoefficient_2: 0.085,\r\n    SUN_ANGULAR_RADIUS: 0.004685,\r\n    SUN_INTENSITY: 1.0,\r\n    ozoneDensityHeight: 25e3,\r\n    ozoneDensityWide: 15e3,\r\n}\r\n\r\nexport function transmittance(atmosParams?: AtmosphereParameters): Program {\r\n    return new Program(\"transmittance\", {\r\n        uniforms: {\r\n            iResolution: \"vec2\"\r\n        },\r\n        attributes: {\r\n            a_position: \"vec2\"\r\n        },\r\n        vertexShader: transmittance_vert,\r\n        fragmentShader: stringTemplate2(transmittance_frag, atmosParams)\r\n    });\r\n}\r\n\r\nexport function scattering(atmosParams?: AtmosphereParameters): Program {\r\n    return new Program(\"scattering\", {\r\n        uniforms: {\r\n            iResolution: \"vec2\",\r\n            transmittanceTexture: \"sampler2d\"\r\n        },\r\n        attributes: {\r\n            a_position: \"vec2\"\r\n        },\r\n        vertexShader: scattering_vert,\r\n        fragmentShader: stringTemplate2(scattering_frag, atmosParams)\r\n    });\r\n}\r\n\r\n// const vec3 solar_irradiance = vec3(1.474000,1.850400,1.911980);\r\n// float GetTextureCoordFromUnitRange(float x, int texture_size) {\r\n//     return 0.5 / float(texture_size) + x * (1.0 - 1.0 / float(texture_size));\r\n// }\r\n//\r\n// float ClampDistance(float d) {\r\n//     return max(d, 0.0 * m);\r\n// }\r\n//\r\n// float SafeSqrt(float a) {\r\n//     return sqrt(max(a, 0.0 * m2));\r\n// }\r\n\r\n// float DistanceToTopAtmosphereBoundary(float r, float mu) {\r\n//\r\n//     //assert(r <= atmosphere.top_radius);\r\n//     //assert(mu >= -1.0 && mu <= 1.0);\r\n//\r\n//     float discriminant = r * r * (mu * mu - 1.0) + TOP_RADIUS * TOP_RADIUS;\r\n//     return ClampDistance(-r * mu + SafeSqrt(discriminant));\r\n// }\r\n\r\n// vec2 GetTransmittanceTextureUvFromRMu(\r\n//     float r,\r\n//     float mu)\r\n// {\r\n//     //assert(r >= atmosphere.BOTTOM_RADIUS && r <= TOP_RADIUS);\r\n//     //assert(mu >= -1.0 && mu <= 1.0);\r\n//\r\n//     float H = sqrt(TOP_RADIUS * TOP_RADIUS - BOTTOM_RADIUS * BOTTOM_RADIUS);\r\n//     float rho = SafeSqrt(r * r - BOTTOM_RADIUS * BOTTOM_RADIUS);\r\n//     float d = DistanceToTopAtmosphereBoundary(r, mu);\r\n//     float d_min = TOP_RADIUS - r;\r\n//     float d_max = rho + H;\r\n//     float x_mu = (d - d_min) / (d_max - d_min);\r\n//     float x_r = rho / H;\r\n//\r\n//     return vec2(\r\n//         GetTextureCoordFromUnitRange(x_mu, TRANSMITTANCE_TEXTURE_WIDTH),\r\n//         GetTextureCoordFromUnitRange(x_r, TRANSMITTANCE_TEXTURE_HEIGHT)\r\n//     );\r\n// }\r\n\r\n// vec3 GetTransmittanceToTopAtmosphereBoundary(in sampler2D transmittance_texture, float r, float mu)\r\n// {\r\n//     //assert(r >= BOTTOM_RADIUS && r <= TOP_RADIUS);\r\n//\r\n//     vec2 uv = GetTransmittanceTextureUvFromRMu(r, mu);\r\n//     return texture(transmittance_texture, uv).xyz;\r\n// }\r\n\r\n// vec3 GetTransmittanceToSun(\r\n//     in sampler2D transmittance_texture,\r\n//     float r,\r\n//     float mu_s)\r\n// {\r\n//     float sin_theta_h = BOTTOM_RADIUS / r;\r\n//     float cos_theta_h = -sqrt(max(1.0 - sin_theta_h * sin_theta_h, 0.0));\r\n//\r\n//     return GetTransmittanceToTopAtmosphereBoundary(transmittance_texture, r, mu_s) * smoothstep(\r\n//         -sin_theta_h * SUN_ANGULAR_RADIUS / rad, sin_theta_h * SUN_ANGULAR_RADIUS / rad,\r\n//         mu_s - cos_theta_h\r\n//     );\r\n// }\r\n\r\n// vec3 GetSunAndSkyIrradiance(\r\n//     in sampler2D transmittance_texture,\r\n//     in vec3 point,\r\n//     in vec3 normal,\r\n//     in vec3 sun_direction,\r\n//     out vec3 sky_irradiance)\r\n// {\r\n//     float r = length(point);\r\n//     float mu_s = dot(point, sun_direction) / r;\r\n//\r\n//     sky_irradiance = vec3(0.0);  // GetIrradiance(atmosphere, irradiance_texture, r, mu_s) * (1.0 + dot(normal, point) / r) * 0.5;\r\n//\r\n//     return solar_irradiance * GetTransmittanceToSun(transmittance_texture, r, mu_s) * max(dot(normal, sun_direction), 0.0);\r\n// }","import {Handler} from \"./Handler\";\r\n\r\nexport interface IBaseFramebufferParams {\r\n    width?: number;\r\n    height?: number;\r\n    useDepth?: boolean;\r\n    depthComponent?: string;\r\n    size?: number;\r\n    filter?: string;\r\n}\r\n\r\nexport class BaseFramebuffer {\r\n    public handler: Handler;\r\n    public _fbo: WebGLFramebuffer | null;\r\n    protected _depthRenderbuffer: WebGLRenderbuffer | null;\r\n    public _width: number;\r\n    public _height: number;\r\n    protected _depthComponent: string;\r\n    protected _size: number;\r\n    protected _active: boolean;\r\n    protected _useDepth: boolean;\r\n    protected _filter: string;\r\n\r\n    constructor(handler: Handler, options: IBaseFramebufferParams = {}) {\r\n        this.handler = handler;\r\n        this._fbo = null;\r\n        this._width = options.width || handler.canvas!.width;\r\n        this._height = options.height || handler.canvas!.height;\r\n        this._depthComponent = options.depthComponent != undefined ? options.depthComponent : \"DEPTH_COMPONENT16\";\r\n        this._useDepth = options.useDepth != undefined ? options.useDepth : true;\r\n        this._active = false;\r\n        this._size = options.size || 1;\r\n        this._depthRenderbuffer = null;\r\n        this._filter = options.filter || \"NEAREST\";\r\n    }\r\n\r\n    public get width(): number {\r\n        return this._width;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this._height;\r\n    }\r\n\r\n    /**\r\n     * Sets framebuffer viewport size.\r\n     * @public\r\n     * @param {number} width - Framebuffer width.\r\n     * @param {number} height - Framebuffer height.\r\n     * @param {boolean} [forceDestroy] -\r\n     */\r\n    public setSize(width: number, height: number, forceDestroy: boolean = false) {\r\n        this._width = width;\r\n        this._height = height;\r\n\r\n        if (this._active) {\r\n            this.handler.gl!.viewport(0, 0, this._width, this._height);\r\n        }\r\n\r\n        if (this._useDepth || forceDestroy) {\r\n            this.destroy();\r\n            this.init();\r\n        }\r\n    }\r\n\r\n    public init() {\r\n    }\r\n\r\n    public destroy() {\r\n    }\r\n\r\n    /**\r\n     * Returns framebuffer completed.\r\n     * @public\r\n     * @returns {boolean} -\r\n     */\r\n    public isComplete(): boolean {\r\n        let gl = this.handler.gl!;\r\n        return gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE;\r\n    }\r\n\r\n    public checkStatus(): number {\r\n        let gl = this.handler.gl!;\r\n        return gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n    }\r\n\r\n    /**\r\n     * Activate framebuffer frame to draw.\r\n     * @public\r\n     * @returns {Framebuffer} Returns Current framebuffer.\r\n     */\r\n    public activate() {\r\n        let gl = this.handler.gl!;\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\r\n        gl.viewport(0, 0, this._width, this._height);\r\n        this._active = true;\r\n\r\n        let c = this.handler.framebufferStack.current().data;\r\n        c && (c._active = false);\r\n        this.handler.framebufferStack.push(this);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Deactivate framebuffer frame.\r\n     * @public\r\n     */\r\n    public deactivate() {\r\n        let h = this.handler,\r\n            gl = h.gl!;\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\r\n        this._active = false;\r\n\r\n        let f = this.handler.framebufferStack.popPrev();\r\n\r\n        if (f) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, f._fbo);\r\n            gl.viewport(0, 0, f._width, f._height);\r\n        } else {\r\n            gl.viewport(0, 0, h.canvas!.width, h.canvas!.height);\r\n        }\r\n    }\r\n}","/**\r\n * Usefull class for working with JS canvas object.\r\n * @class\r\n * @param {number} [width] - Canvas width. Default 256.\r\n * @param {number} [height] - Canvas height. Default 256.\r\n */\r\nclass ImageCanvas {\r\n\r\n    /**\r\n     * Canvas object.\r\n     * @protected\r\n     * @type {HTMLCanvasElement}\r\n     */\r\n    protected _canvas: HTMLCanvasElement;\r\n\r\n    /**\r\n     * Canvas context.\r\n     * @protected\r\n     * @type {CanvasRenderingContext2D}\r\n     */\r\n    protected _context: CanvasRenderingContext2D;\r\n\r\n    constructor(width: number = 256, height: number = 256) {\r\n        this._canvas = document.createElement(\"canvas\");\r\n        this._canvas.width = width;\r\n        this._canvas.height = height;\r\n\r\n        this._context = this._canvas.getContext(\"2d\", {\r\n            willReadFrequently: true\r\n        })!;\r\n    }\r\n\r\n    /**\r\n     * Returns canvas object.\r\n     * @public\r\n     * @returns {HTMLCanvasElement}\r\n     */\r\n    public getCanvas(): HTMLCanvasElement {\r\n        return this._canvas;\r\n    }\r\n\r\n    /**\r\n     * Returns canvas context pointer.\r\n     * @public\r\n     * @returns {CanvasRenderingContext2D}\r\n     */\r\n    public getContext(): CanvasRenderingContext2D {\r\n        return this._context;\r\n    }\r\n\r\n    /**\r\n     * Fills canvas RGBA with zeroes.\r\n     * @public\r\n     */\r\n    public fillEmpty() {\r\n        let imgd = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\r\n        let pixels = imgd.data;\r\n        for (let i = 0, n = pixels.length; i < n; i += 4) {\r\n            pixels[i] = pixels[i + 1] = pixels[i + 2] = pixels[i + 3] = 0;\r\n        }\r\n        this._context.putImageData(imgd, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * Fills canvas RGBA with color.\r\n     * @public\r\n     * @param {string} color - CSS string color.\r\n     */\r\n    public fill(color: string) {\r\n        this._context.fillStyle = color\r\n        this._context.fill()\r\n    }\r\n\r\n    /**\r\n     * Gets canvas pixels RGBA data.\r\n     * @public\r\n     * @returns {Uint8ClampedArray}\r\n     */\r\n    public getData(): Uint8ClampedArray {\r\n        let imgd = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\r\n        return imgd.data;\r\n    }\r\n\r\n    /**\r\n     * Fill the canvas by color.\r\n     * @public\r\n     * @param {string} color - CSS string color.\r\n     */\r\n    public fillColor(color: string) {\r\n        this._context.fillStyle = color;\r\n        this._context.fillRect(0, 0, this._canvas.width, this._canvas.height);\r\n    }\r\n\r\n    /**\r\n     * Sets RGBA pixel data.\r\n     * @public\r\n     * @param {Array.<number>} data - Array RGBA data.\r\n     */\r\n    public setData(data: ArrayLike<number>) {\r\n        let imageData = this._context.createImageData(this._canvas.width, this._canvas.height);\r\n        imageData.data.set(data);\r\n        this._context.putImageData(imageData, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * Resize canvas.\r\n     * @public\r\n     * @param {number} width - Width.\r\n     * @param {number} height - Height.\r\n     */\r\n    public resize(width: number, height: number) {\r\n        this._canvas.width = width;\r\n        this._canvas.height = height;\r\n        this._context = this._canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    }\r\n\r\n    /**\r\n     * Draw an image on the canvas.\r\n     * @public\r\n     * @param {Image} img - Draw image.\r\n     * @param {number} [x] - Left top image corner X coordinate on the canvas.\r\n     * @param {number} [y] - Left top image corner Y coordinate on the canvas.\r\n     * @param {number} [width] - Image width slice. Image width is default.\r\n     * @param {number} [height] - Image height slice. Image height is default.\r\n     */\r\n    public drawImage(img: HTMLImageElement, x: number, y: number, width: number, height: number) {\r\n        this._context.drawImage(img, x || 0, y || 0, width || img.width, height || img.height);\r\n    }\r\n\r\n    /**\r\n     * Converts canvas to JS image object.\r\n     * @public\r\n     * @returns {Image}\r\n     */\r\n    public getImage(): HTMLImageElement {\r\n        let img = new Image();\r\n        img.width = this.getWidth();\r\n        img.height = this.getHeight();\r\n        img.src = this._canvas.toDataURL(\"image/png\");\r\n        return img;\r\n    }\r\n\r\n    /**\r\n     * Get measured text width.\r\n     * @public\r\n     * @param {string} text - Measured text.\r\n     * @returns {number}\r\n     */\r\n    public getTextWidth(text: string): number {\r\n        let metrics = this._context.measureText(text);\r\n        return Math.round(metrics.width);\r\n    }\r\n\r\n    /**\r\n     * Draw a text on the canvas.\r\n     * @public\r\n     * @param {string} text - Text.\r\n     * @param {number} [x] - Canvas X - coordinate. 0 - default.\r\n     * @param {number} [y] - Canvas Y - coordinate. 0 - default.\r\n     * @param {string} [font] - Font style. 'normal 14px Verdana' - is default.\r\n     * @param {string} [color] - Css font color.\r\n     */\r\n    public drawText(text: string, x: number = 0, y: number = 14, font: string = \"normal 14px Verdana\", color: string = \"black\") {\r\n        this._context.fillStyle = color;\r\n        this._context.font = font;\r\n        this._context.fillText(text, x, y);\r\n    }\r\n\r\n    /**\r\n     * Gets canvas width.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getWidth(): number {\r\n        return this._canvas.width;\r\n    }\r\n\r\n    /**\r\n     * Gets canvas height.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getHeight(): number {\r\n        return this._canvas.height;\r\n    }\r\n\r\n    /**\r\n     * Load image to canvas.\r\n     * @public\r\n     * @param {string} url - Image url.\r\n     * @param {Function} [callback] - Image onload callback.\r\n     */\r\n    public load(url: string, callback: Function) {\r\n        let img = new Image();\r\n        let that = this;\r\n        img.onload = function () {\r\n            that.resize(img.width, img.height);\r\n            that._context.drawImage(img, 0, 0, img.width, img.height);\r\n            callback && callback(img);\r\n        };\r\n        img.src = url;\r\n    }\r\n\r\n    /**\r\n     * Open canvas image in the new window.\r\n     * @public\r\n     */\r\n    public openImage() {\r\n        let img = this.getImage();\r\n        let dataUrl = img.src;\r\n\r\n        let windowContent = \"<!DOCTYPE html>\";\r\n        windowContent += \"<html>\";\r\n        windowContent += \"<head><title>Print</title></head>\";\r\n        windowContent += \"<body>\";\r\n        windowContent += '<img src=\"' + dataUrl + '\">';\r\n        windowContent += \"</body>\";\r\n        windowContent += \"</html>\";\r\n\r\n        let printWin = window.open(\r\n            \"\",\r\n            \"\",\r\n            \"width=\" + img.width + \"px ,height=\" + img.height + \"px\"\r\n        );\r\n\r\n        if (printWin) {\r\n            printWin.document.open();\r\n            printWin.document.write(windowContent);\r\n            printWin.document.close();\r\n            printWin.focus();\r\n        }\r\n    }\r\n\r\n    public destroy() {\r\n        this._canvas.width = 1;\r\n        this._canvas.height = 1;\r\n        //@ts-ignore\r\n        this._canvas = null;\r\n        //@ts-ignore\r\n        this._context = null;\r\n    }\r\n}\r\n\r\nexport {ImageCanvas};\r\n","import {BaseFramebuffer} from \"./BaseFramebuffer\";\r\nimport type {IBaseFramebufferParams} from \"./BaseFramebuffer\";\r\nimport {ImageCanvas} from \"../ImageCanvas\";\r\nimport {Handler} from \"./Handler\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\n\r\nexport interface ITargetParams {\r\n    internalFormat?: string;\r\n    format?: string;\r\n    type?: string;\r\n    attachment?: string;\r\n    filter?: string;\r\n    readAsync?: boolean;\r\n}\r\n\r\nexport interface IFrameBufferParams extends IBaseFramebufferParams {\r\n    isBare?: boolean;\r\n    renderbufferTarget?: string;\r\n    textures?: WebGLTexture[];\r\n    targets?: ITargetParams[];\r\n}\r\n\r\ntype TypedArrayConstructor = Uint8ArrayConstructor | Float32ArrayConstructor;\r\n\r\ninterface ITarget {\r\n    internalFormat: string;\r\n    format: string;\r\n    type: string;\r\n    attachment: string;\r\n    filter: string;\r\n    pixelBufferIndex: number;\r\n    TypeArrayConstructor: TypedArrayConstructor\r\n}\r\n\r\ninterface IPixelBuffer {\r\n    buffer: WebGLBuffer | null;\r\n    data: TypedArray | null;\r\n    glType: number;\r\n    glAttachment: number;\r\n}\r\n\r\nconst TypeArrayConstructor: Record<string, TypedArrayConstructor> = {\r\n    \"UNSIGNED_BYTE\": Uint8Array,\r\n    \"FLOAT\": Float32Array\r\n}\r\n\r\nexport function clientWaitAsync(gl: WebGL2RenderingContext, sync: WebGLSync, flags: number): Promise<void> {\r\n    return new Promise<void>((resolve, reject) => {\r\n        function check() {\r\n            const res = gl.clientWaitSync(sync, flags, 0);\r\n            if (res == gl.WAIT_FAILED) {\r\n                reject();\r\n            } else if (res == gl.TIMEOUT_EXPIRED) {\r\n                requestAnimationFrame(check);\r\n            } else {\r\n                resolve();\r\n            }\r\n        }\r\n\r\n        check();\r\n    });\r\n}\r\n\r\n/**\r\n * Class represents framebuffer.\r\n * @class\r\n * @param {Handler} handler - WebGL handler.\r\n * @param {IFrameBufferParams} [options] - Framebuffer options:\r\n */\r\nexport class Framebuffer extends BaseFramebuffer {\r\n\r\n    protected _renderbufferTarget: string;\r\n\r\n    protected _targets: ITarget[];\r\n\r\n    /**\r\n     * Framebuffer texture.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public textures: WebGLTexture[];\r\n\r\n    public pixelBuffers: IPixelBuffer[];\r\n\r\n    protected _skipFrame: boolean;\r\n\r\n    constructor(handler: Handler, options: IFrameBufferParams = {}) {\r\n\r\n        super(handler, options);\r\n\r\n        this._targets = Framebuffer.createTargets(options.targets);\r\n\r\n        this._size = this._targets.length;\r\n\r\n        this._renderbufferTarget = options.renderbufferTarget != undefined ? options.renderbufferTarget : \"DEPTH_ATTACHMENT\";\r\n\r\n        this.textures = options.textures || new Array(this._size);\r\n\r\n        this.pixelBuffers = [];\r\n\r\n        this._skipFrame = false;\r\n    }\r\n\r\n    static createTargets(targets?: ITargetParams[]): ITarget[] {\r\n        let attInd = 0;\r\n        let pbInd = 0;\r\n        if (targets) {\r\n            return targets.map<ITarget>((ti): ITarget => {\r\n                let attachment = ti.attachment || \"COLOR_ATTACHMENT\";\r\n                if (attachment === \"COLOR_ATTACHMENT\") {\r\n                    attachment = `COLOR_ATTACHMENT${attInd++}`;\r\n                }\r\n                let type = ti.type || \"UNSIGNED_BYTE\";\r\n                return {\r\n                    internalFormat: ti.internalFormat || \"RGBA\",\r\n                    format: ti.format || \"RGBA\",\r\n                    type,\r\n                    attachment,\r\n                    filter: ti.filter || \"NEAREST\",\r\n                    pixelBufferIndex: ti.readAsync ? pbInd++ : -1,\r\n                    TypeArrayConstructor: TypeArrayConstructor[type]\r\n                }\r\n            });\r\n        }\r\n\r\n        return [{\r\n            internalFormat: \"RGBA\",\r\n            format: \"RGBA\",\r\n            type: \"UNSIGNED_BYTE\",\r\n            attachment: \"COLOR_ATTACHMENT0\",\r\n            filter: \"NEAREST\",\r\n            pixelBufferIndex: -1,\r\n            TypeArrayConstructor: TypeArrayConstructor.UNSIGNED_BYTE\r\n        }];\r\n    }\r\n\r\n    // static blit(sourceFramebuffer: Framebuffer, destFramebuffer: Framebuffer, glAttachment: number, glMask: number, glFilter: number) {\r\n    //     let gl = sourceFramebuffer.handler.gl!;\r\n    //\r\n    //     gl.bindFramebuffer(gl.READ_FRAMEBUFFER, sourceFramebuffer._fbo);\r\n    //     gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, destFramebuffer._fbo);\r\n    //     gl.readBuffer(glAttachment);\r\n    //\r\n    //     gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 0.0, 1.0]);\r\n    //\r\n    //     gl.blitFramebuffer(0, 0, sourceFramebuffer._width, sourceFramebuffer._height, 0, 0, destFramebuffer._width, destFramebuffer._height, glMask, glFilter);\r\n    //\r\n    //     gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\r\n    //     gl.bindFramebuffer(gl.READ_FRAMEBUFFER, null!);\r\n    //     gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null!);\r\n    // }\r\n\r\n    public override destroy() {\r\n        let gl = this.handler.gl;\r\n\r\n        if (!gl) return;\r\n\r\n        for (let i = 0; i < this.textures.length; i++) {\r\n            gl.deleteTexture(this.textures[i]);\r\n        }\r\n        this.textures = new Array(this._size);\r\n\r\n        for (let i = 0; i < this.pixelBuffers.length; i++) {\r\n            this.pixelBuffers[i].data = null;\r\n            gl.deleteBuffer(this.pixelBuffers[i].buffer);\r\n        }\r\n        this.pixelBuffers = [];\r\n\r\n        gl.deleteFramebuffer(this._fbo);\r\n        gl.deleteRenderbuffer(this._depthRenderbuffer);\r\n\r\n        this._depthRenderbuffer = null;\r\n        this._fbo = null;\r\n\r\n        this._active = false;\r\n    }\r\n\r\n    /**\r\n     * Framebuffer initialization.\r\n     * @public\r\n     * @override\r\n     */\r\n    public override init() {\r\n        let gl = this.handler.gl;\r\n\r\n        if (!gl) return;\r\n\r\n        this._fbo = gl.createFramebuffer();\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\r\n\r\n        let attachmentArr = [];\r\n        for (let i = 0; i < this._targets.length; i++) {\r\n            let tr = this._targets[i];\r\n            let ti = this.textures[i] || this.handler.createEmptyTexture2DExt(this._width, this._height, tr.filter, tr.internalFormat, tr.format, tr.type);\r\n            let att_i = (gl as any)[tr.attachment];\r\n\r\n            if (ti) {\r\n                this.bindOutputTexture(ti, att_i);\r\n                this.textures[i] = ti;\r\n            }\r\n\r\n            if (tr.attachment !== \"DEPTH_ATTACHMENT\") {\r\n                attachmentArr.push(att_i);\r\n            }\r\n\r\n            if (tr.pixelBufferIndex !== -1) {\r\n                this._createPixelBuffer(tr);\r\n            }\r\n        }\r\n\r\n        gl.drawBuffers && gl.drawBuffers(attachmentArr);\r\n\r\n        if (this._useDepth) {\r\n            this._depthRenderbuffer = gl.createRenderbuffer();\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this._depthRenderbuffer);\r\n            gl.renderbufferStorage(gl.RENDERBUFFER, (gl as any)[this._depthComponent], this._width, this._height);\r\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, (gl as any)[this._renderbufferTarget], gl.RENDERBUFFER, this._depthRenderbuffer);\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        }\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\r\n    }\r\n\r\n    public readPixelBuffersAsync = (callback?: (buf: this) => void) => {\r\n\r\n        const gl = this.handler.gl!;\r\n\r\n        if (this._skipFrame) return;\r\n\r\n        this._skipFrame = true;\r\n\r\n        let w = this.width,\r\n            h = this.height;\r\n\r\n        let pb = this.pixelBuffers;\r\n\r\n        this.activate();\r\n\r\n        for (let i = 0; i < pb.length; i++) {\r\n            let pbi = pb[i];\r\n            gl.bindBuffer(gl.PIXEL_PACK_BUFFER, pbi.buffer);\r\n            gl.bufferData(gl.PIXEL_PACK_BUFFER, pbi.data!.byteLength, gl.STREAM_READ);\r\n            gl.readBuffer(pbi.glAttachment);\r\n            gl.readPixels(0, 0, w, h, gl.RGBA, pbi.glType, 0);\r\n            gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\r\n        }\r\n\r\n        this.deactivate();\r\n\r\n        const sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0)!;\r\n        gl.flush();\r\n\r\n        clientWaitAsync(gl, sync, 0).then(() => {\r\n            this._skipFrame = false;\r\n            gl.deleteSync(sync);\r\n\r\n            for (let i = 0; i < pb.length; i++) {\r\n                let pbi = pb[i];\r\n                if (pbi.data) {\r\n                    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, pbi.buffer);\r\n                    gl.getBufferSubData(gl.PIXEL_PACK_BUFFER, 0, pbi.data!);\r\n                    callback && callback(this);\r\n                }\r\n            }\r\n\r\n            gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\r\n        });\r\n    }\r\n\r\n    public getPixelBufferData(targetIndex: number): TypedArray | null {\r\n        let pbInd = this._targets[targetIndex].pixelBufferIndex;\r\n        return pbInd !== -1 ? this.pixelBuffers[pbInd].data : null;\r\n    }\r\n\r\n    protected _createPixelBuffer(target: ITarget) {\r\n        let gl = this.handler.gl!;\r\n        let pbInd = target.pixelBufferIndex;\r\n        let pb = this.pixelBuffers[pbInd];\r\n\r\n        if (!pb) {\r\n            pb = this.pixelBuffers[pbInd] = {\r\n                buffer: null,\r\n                data: null,\r\n                glType: -1,\r\n                glAttachment: -1\r\n            };\r\n        }\r\n\r\n        let size = this.width * this.height * 4;\r\n\r\n        // clear current pixel buffer\r\n        pb.data = null;\r\n        pb.data = new target.TypeArrayConstructor(size);\r\n\r\n        //gl.deleteBuffer(pb.buffer);\r\n        pb.buffer = gl.createBuffer();\r\n        gl.bindBuffer(gl.PIXEL_PACK_BUFFER, pb.buffer);\r\n        gl.bufferData(gl.PIXEL_PACK_BUFFER, size, gl.STREAM_READ);\r\n        gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\r\n\r\n        pb.glType = (gl as any)[target.type];\r\n        pb.glAttachment = (gl as any)[target.attachment];\r\n    }\r\n\r\n    /**\r\n     * Bind buffer texture.\r\n     * @public\r\n     * @param {WebGLTexture} texture - Output texture.\r\n     * @param {number} [glAttachment=0] - color attachment index.\r\n     */\r\n    public bindOutputTexture(texture: WebGLTexture, glAttachment?: number) {\r\n        let gl = this.handler.gl!;\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, glAttachment || gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n    }\r\n\r\n    /**\r\n     * Gets pixel RGBA color from framebuffer by coordinates.\r\n     * @public\r\n     * @param {TypedArray} res - Normalized x - coordinate.\r\n     * @param {number} nx - Normalized x - coordinate.\r\n     * @param {number} ny - Normalized y - coordinate.\r\n     * @param {number} [w=1] - Normalized width.\r\n     * @param {number} [h=1] - Normalized height.\r\n     * @param {number} [index=0] - color attachment index.\r\n     */\r\n    public readPixels(res: TypedArray, nx: number, ny: number, index: number = 0, w: number = 1, h: number = 1) {\r\n        let gl = this.handler.gl!;\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\r\n        gl.readBuffer && gl.readBuffer(gl.COLOR_ATTACHMENT0 + index || 0);\r\n        gl.readPixels(nx * this._width, ny * this._height, w, h, gl.RGBA, (gl as any)[this._targets[index].type], res);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\r\n    }\r\n\r\n    /**\r\n     * Reads all pixels(RGBA colors) from framebuffer.\r\n     * @public\r\n     * @param {TypedArray} res - Result array.\r\n     * @param {number} [attachmentIndex=0] - color attachment index.\r\n     */\r\n    public readAllPixels(res: TypedArray, attachmentIndex: number = 0) {\r\n        let gl = this.handler.gl!;\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\r\n        gl.readBuffer && gl.readBuffer(gl.COLOR_ATTACHMENT0 + attachmentIndex);\r\n        gl.readPixels(0, 0, this._width, this._height, gl.RGBA, (gl as any)[this._targets[attachmentIndex].type], res);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\r\n    }\r\n\r\n    /**\r\n     * Gets JavaScript image that in the framebuffer.\r\n     * @public\r\n     * @returns {HTMLImageElement} -\r\n     */\r\n    public getImage(): HTMLImageElement {\r\n        let data = new Uint8Array(4 * this._width * this._height);\r\n        this.readAllPixels(data);\r\n        let imageCanvas = new ImageCanvas(this._width, this._height);\r\n        imageCanvas.setData(data);\r\n        return imageCanvas.getImage();\r\n    }\r\n\r\n    /**\r\n     * Reads pixel data from the buffer at the specified normalized coordinates.\r\n     *\r\n     * @param {number} nx - Normalized X coordinate in the range [0, 1], multiplied by the buffer width.\r\n     * @param {number} ny - Normalized Y coordinate in the range [0, 1], multiplied by the buffer height.\r\n     * @param {NumberArray4 | Float32Array} outData - Output array where the RGBA pixel values will be written.\r\n     * @param {number} [attachmentIndex=0] - Index of the color attachment (buffer) to read from.\r\n     *\r\n     * @returns {void}\r\n     *\r\n     * @example\r\n     * const color = new Float32Array(4);\r\n     * framebuffer.readData(0.5, 0.5, color); // Reads the color at the center of the buffer\r\n     */\r\n    public readData(nx: number, ny: number, outData: NumberArray4 | TypedArray, attachmentIndex: number = 0) {\r\n        const w = this.width;\r\n        const h = this.height;\r\n\r\n        const x = Math.floor(nx * (w - 1));\r\n        const y = Math.floor(ny * (h - 1));\r\n\r\n        const ind = (y * w + x) * 4;\r\n\r\n        const data = this.pixelBuffers[attachmentIndex].data;\r\n\r\n        if (data) {\r\n            outData[0] = data[ind];\r\n            outData[1] = data[ind + 1];\r\n            outData[2] = data[ind + 2];\r\n            outData[3] = data[ind + 3];\r\n        }\r\n    }\r\n}\r\n","attribute vec2 corners;\r\n\r\nvoid main(void) {\r\n    gl_Position = vec4(corners, 0.0, 1.0);\r\n}","precision lowp float;\r\n\r\n#include \"../../shaders/atmos/common.glsl\"\r\n\r\nuniform mat4 viewMatrix;\r\nuniform vec3 sunPos;\r\nuniform vec3 camPos;\r\nuniform vec2 iResolution;\r\nuniform float fov;\r\nuniform float opacity;\r\n\r\nuniform sampler2D transmittanceTexture;\r\nuniform sampler2D scatteringTexture;\r\n\r\nvec3 transmittanceFromTexture(float height, float angle)\r\n{\r\n    float u = (angle + 1.0) * 0.5;\r\n    float v = height / ATMOS_HEIGHT;\r\n    return texture2D(transmittanceTexture, vec2(u, v)).xyz;\r\n}\r\n\r\nvec3 multipleScatteringContributionFromTexture(float height, float angle)\r\n{\r\n    float u = (angle + 1.0) * 0.5;\r\n    float v = height / ATMOS_HEIGHT;\r\n    return texture2D(scatteringTexture, vec2(u, v)).xyz;\r\n}\r\n\r\nbool intersectEllipsoidToSphere(in vec3 ro, in vec3 rd, in vec3 ellRadii, in float sphereRadius, out float t1, out float t2)\r\n{\r\n    float offset = 0.0,\r\n    distanceToSpace = 0.0;\r\n\r\n    if (intersectEllipsoid(ro, rd, ellRadii, offset, distanceToSpace)) {\r\n        vec3 hitEll = ro + rd * offset;\r\n        vec3 nEll = normalEllipsoid(hitEll, ellRadii);\r\n        float t = 0.0;\r\n        bool intersectsSphere = intersectSphere(hitEll, nEll, sphereRadius, t);\r\n        vec3 hitSphere = hitEll + nEll * t;\r\n        t1 = length(hitSphere - ro);\r\n\r\n        hitEll = ro + rd * distanceToSpace;\r\n        nEll = normalEllipsoid(hitEll, ellRadii);\r\n        t = 0.0;\r\n        intersectsSphere = intersectSphere(hitEll, nEll, sphereRadius, t);\r\n        hitSphere = hitEll + nEll * t;\r\n        t2 = length(hitSphere - ro);\r\n\r\n        return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nmat4 transpose(in mat4 m)\r\n{\r\n    vec4 i0 = m[0];\r\n    vec4 i1 = m[1];\r\n    vec4 i2 = m[2];\r\n    vec4 i3 = m[3];\r\n\r\n    mat4 outMatrix = mat4(\r\n    vec4(i0.x, i1.x, i2.x, i3.x),\r\n    vec4(i0.y, i1.y, i2.y, i3.y),\r\n    vec4(i0.z, i1.z, i2.z, i3.z),\r\n    vec4(i0.w, i1.w, i2.w, i3.w)\r\n    );\r\n\r\n    return outMatrix;\r\n}\r\n\r\nvoid mainImage(out vec4 fragColor)\r\n{\r\n    vec3 cameraPosition = camPos;\r\n\r\n    vec3 lightDirection = normalize(sunPos);\r\n\r\n    vec2 uv = (2.0 * gl_FragCoord.xy - iResolution.xy) / iResolution.y;\r\n    float fieldOfView = fov;\r\n    float z = 1.0 / tan(fieldOfView * 0.5 * PI / 180.0);\r\n    vec3 rayDirection = normalize(vec3(uv, -z));\r\n    vec4 rd = transpose(viewMatrix) * vec4(rayDirection, 1.0);\r\n    rayDirection = rd.xyz;\r\n\r\n    vec3 light = vec3(0.0);\r\n    vec3 transmittanceFromCameraToSpace = vec3(1.0);\r\n    float offset = 0.0;\r\n    float distanceToSpace = 0.0;\r\n\r\n    rayDirection = normalize(rayDirection * SPHERE_TO_ELLIPSOID_SCALE);\r\n    cameraPosition *= SPHERE_TO_ELLIPSOID_SCALE;\r\n    lightDirection = normalize(lightDirection * SPHERE_TO_ELLIPSOID_SCALE);\r\n\r\n    if (length(cameraPosition) < BOTTOM_RADIUS + 100.0) {\r\n        cameraPosition = normalize(cameraPosition) * (BOTTOM_RADIUS + 100.0);\r\n    }\r\n\r\n    if (intersectSphere(cameraPosition, rayDirection, TOP_RADIUS, offset, distanceToSpace))\r\n    {\r\n        vec3 rayOrigin = cameraPosition;\r\n\r\n        // above atmosphere\r\n        if (offset > 0.0) {\r\n            // intersection of camera ray with atmosphere\r\n            rayOrigin = cameraPosition + rayDirection * offset;\r\n        }\r\n\r\n        float height = length(rayOrigin) - BOTTOM_RADIUS;\r\n        float rayAngle = dot(rayOrigin, rayDirection) / length(rayOrigin);\r\n        bool cameraBelow = rayAngle < 0.0;\r\n\r\n        transmittanceFromCameraToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\r\n\r\n        float phaseAngle = dot(lightDirection, rayDirection);\r\n        float rayleighPhase = rayleighPhase(phaseAngle);\r\n        float miePhase = miePhase(phaseAngle);\r\n\r\n        float distanceToGround = 0.0;\r\n\r\n        bool hitGround = intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\r\n\r\n        if (intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS - 100000.0, distanceToGround) && hitGround)\r\n        {\r\n            discard;\r\n        }\r\n\r\n        float segmentLength = ((hitGround ? distanceToGround : distanceToSpace) - max(offset, 0.0)) / float(SAMPLE_COUNT);\r\n\r\n        float t = segmentLength * 0.5;\r\n\r\n        vec3 transmittanceCamera;\r\n        vec3 transmittanceLight;\r\n\r\n        for (int i = 0; i < SAMPLE_COUNT; i++)\r\n        {\r\n            vec3 position = rayOrigin + t * rayDirection;\r\n            float height = length(position) - BOTTOM_RADIUS;\r\n            vec3 up = position / length(position);\r\n            float rayAngle = dot(up, rayDirection);\r\n            float lightAngle = dot(up, lightDirection);\r\n            vec3 transmittanceToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\r\n            transmittanceCamera = cameraBelow ? (transmittanceToSpace / transmittanceFromCameraToSpace) : (transmittanceFromCameraToSpace / transmittanceToSpace);\r\n            transmittanceLight = transmittanceFromTexture(height, lightAngle);\r\n            vec2 opticalDensity = exp(-height / rayleighMieHeights);\r\n            vec3 scatteredLight = transmittanceLight * (rayleighScatteringCoefficient * opticalDensity.x * rayleighPhase + mieScatteringCoefficient * opticalDensity.y * miePhase);\r\n            scatteredLight += multipleScatteringContributionFromTexture(height, lightAngle) * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y);\r\n            light += transmittanceCamera * scatteredLight * segmentLength;\r\n            t += segmentLength;\r\n        }\r\n\r\n        light *= SUN_INTENSITY;\r\n\r\n        if (hitGround)\r\n        {\r\n            vec3 hitPoint = cameraPosition + rayDirection * distanceToGround;\r\n            vec3 up = hitPoint / length(hitPoint);\r\n            float diffuseAngle = max(dot(up, lightDirection), 0.0);\r\n            float lightAngle = dot(up, lightDirection);\r\n            light += transmittanceCamera * GROUND_ALBEDO * multipleScatteringContributionFromTexture(height, lightAngle) * SUN_INTENSITY;\r\n            light += transmittanceCamera * transmittanceLight * GROUND_ALBEDO * diffuseAngle * SUN_INTENSITY;\r\n        }\r\n    }\r\n\r\n    // sun disk\r\n    // float distanceToGround;\r\n    // bool hitGround = intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\r\n    // if (!hitGround) {\r\n    //    float angle = dot(rayDirection, lightDirection);\r\n    //    if (angle > cos(SUN_ANGULAR_RADIUS)) {\r\n    //       light = SUN_INTENSITY * transmittanceFromCameraToSpace;\r\n    //    }\r\n    // }\r\n\r\n    float distanceToGround = 0.0;\r\n    bool hitGround = intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\r\n    if (!hitGround)\r\n    {\r\n        vec3 sunLum = sunWithBloom(rayDirection, lightDirection) * vec3(1.0, 1.0, 0.8);\r\n        // limit the bloom effect\r\n        sunLum = smoothstep(0.002, 1.0, sunLum);\r\n        light += sunLum * SUN_INTENSITY * transmittanceFromCameraToSpace;\r\n    }\r\n\r\n    fragColor = vec4(pow(light * 8.0, vec3(1.0 / 2.2)), clamp(opacity, 0.0, 1.0));\r\n}\r\n\r\nvoid main(void)\r\n{\r\n    mainImage(gl_FragColor);\r\n}","import {type AtmosphereParameters, transmittance, scattering} from \"../../shaders/atmos/atmos\";\r\nimport {Framebuffer} from \"../../webgl/Framebuffer\";\r\nimport {Program} from '../../webgl/Program';\r\nimport {Control, type IControlParams} from \"../Control\";\r\n\r\nimport atmosphere_vert from './atmosphere.vert.glsl';\r\nimport atmosphere_frag from './atmosphere.frag.glsl';\r\n\r\nimport {stringTemplate2} from \"../../utils/shared\";\r\n\r\nexport interface IAtmosphereParams extends IControlParams {\r\n    height?: number,\r\n    rayleighScale?: number,\r\n    mieScale?: number,\r\n    groundAlbedo?: number,\r\n    bottomRadius?: number,\r\n    rayleighScatteringCoefficient_0?: number,\r\n    rayleighScatteringCoefficient_1?: number,\r\n    rayleighScatteringCoefficient_2?: number,\r\n    mieScatteringCoefficient?: number,\r\n    mieExtinctionCoefficient?: number,\r\n    ozoneAbsorptionCoefficient_0?: number,\r\n    ozoneAbsorptionCoefficient_1?: number,\r\n    ozoneAbsorptionCoefficient_2?: number,\r\n    sunAngularRadius?: number,\r\n    sunIntensity?: number,\r\n    ozoneDensityHeight?: number,\r\n    ozoneDensityWide?: number,\r\n}\r\n\r\nexport class Atmosphere extends Control {\r\n    public _transmittanceBuffer: Framebuffer | null;\r\n    public _scatteringBuffer: Framebuffer | null;\r\n    public opacity: number;\r\n\r\n    protected _parameters: AtmosphereParameters;\r\n\r\n    constructor(options: IAtmosphereParams = {}) {\r\n        super({\r\n            name: \"Atmosphere\",\r\n            ...options\r\n        });\r\n\r\n        this._transmittanceBuffer = null;\r\n        this._scatteringBuffer = null;\r\n\r\n        this.opacity = 1.0;\r\n\r\n        this._parameters = {\r\n            ATMOS_HEIGHT: options.height || 100000.0,\r\n            RAYLEIGH_SCALE: options.rayleighScale || 0.08,\r\n            MIE_SCALE: options.mieScale || 0.012,\r\n            GROUND_ALBEDO: options.groundAlbedo || 0.05,\r\n            BOTTOM_RADIUS: options.bottomRadius || 6356752.3142451793,\r\n            rayleighScatteringCoefficient_0: options.rayleighScatteringCoefficient_0 || 5.802,\r\n            rayleighScatteringCoefficient_1: options.rayleighScatteringCoefficient_1 || 13.558,\r\n            rayleighScatteringCoefficient_2: options.rayleighScatteringCoefficient_2 || 33.100,\r\n            mieScatteringCoefficient: options.mieScatteringCoefficient || 3.996,\r\n            mieExtinctionCoefficient: options.mieExtinctionCoefficient || 4.440,\r\n            ozoneAbsorptionCoefficient_0: options.ozoneAbsorptionCoefficient_0 || 0.650,\r\n            ozoneAbsorptionCoefficient_1: options.ozoneAbsorptionCoefficient_1 || 1.881,\r\n            ozoneAbsorptionCoefficient_2: options.ozoneAbsorptionCoefficient_2 || 0.085,\r\n            SUN_ANGULAR_RADIUS: options.sunAngularRadius || 0.004685,\r\n            SUN_INTENSITY: options.sunIntensity || 1.0,\r\n            ozoneDensityHeight: options.ozoneDensityHeight || 25e3,\r\n            ozoneDensityWide: options.ozoneDensityWide || 15e3,\r\n        }\r\n    }\r\n\r\n    public setParameters(parameters: AtmosphereParameters) {\r\n\r\n        this._parameters = JSON.parse(JSON.stringify(parameters));\r\n\r\n        this.initLookupTexturesShaders();\r\n        this.drawLookupTextures();\r\n        this.removeLookupTexturesShaders();\r\n\r\n        this.initPlanetAtmosphereShader();\r\n    }\r\n\r\n    public get parameters(): AtmosphereParameters {\r\n        return JSON.parse(JSON.stringify(this._parameters));\r\n    }\r\n\r\n    public initPlanetAtmosphereShader() {\r\n        this.planet?.initAtmosphereShader(this._parameters);\r\n    }\r\n\r\n    public override oninit() {\r\n        if (this.renderer) {\r\n\r\n            //\r\n            // Draw atmosphere lookup textures\r\n            //\r\n            this._initLookupTextures();\r\n\r\n            this.initLookupTexturesShaders();\r\n            this.drawLookupTextures();\r\n            this.removeLookupTexturesShaders();\r\n\r\n            this.initBackgroundShader();\r\n\r\n            this.activate();\r\n        }\r\n    }\r\n\r\n    public initLookupTexturesShaders() {\r\n        if (this.renderer) {\r\n            this.renderer.handler.addProgram(transmittance(this._parameters), true);\r\n            this.renderer.handler.addProgram(scattering(this._parameters), true);\r\n        }\r\n    }\r\n\r\n    public initBackgroundShader() {\r\n        if (this.renderer) {\r\n            this.renderer.handler.addProgram(atmosphereBackgroundShader(this._parameters), true);\r\n        }\r\n    }\r\n\r\n    public removeBackgroundShader() {\r\n        if (this.renderer) {\r\n            this.renderer.handler.removeProgram(\"atmosphereBackground\");\r\n        }\r\n    }\r\n\r\n    public removeLookupTexturesShaders() {\r\n        if (this.renderer) {\r\n            let h = this.renderer.handler;\r\n\r\n            if (this._scatteringBuffer?.isComplete()) {\r\n                h.removeProgram(\"scattering\");\r\n            }\r\n\r\n            if (this._transmittanceBuffer?.isComplete()) {\r\n                h.removeProgram(\"transmittance\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public override onactivate() {\r\n        super.onactivate();\r\n        this.planet && this.planet.events.on(\"draw\", this._drawBackground, this);\r\n    }\r\n\r\n    public override ondeactivate() {\r\n        super.ondeactivate();\r\n        this.planet && this.planet.events.off(\"draw\", this._drawBackground);\r\n    }\r\n\r\n    protected _initLookupTextures() {\r\n\r\n        let width = 1024,\r\n            height = 1024;\r\n\r\n        this._transmittanceBuffer = new Framebuffer(this.renderer!.handler, {\r\n            width: width,\r\n            height: height,\r\n            useDepth: false,\r\n            targets: [{\r\n                filter: \"LINEAR\",\r\n                type: \"FLOAT\",\r\n                internalFormat: \"RGBA16F\"\r\n            }]\r\n        });\r\n\r\n        this._transmittanceBuffer.init();\r\n\r\n        this._scatteringBuffer = new Framebuffer(this.renderer!.handler, {\r\n            width: width,\r\n            height: height,\r\n            useDepth: false,\r\n            targets: [{\r\n                filter: \"LINEAR\",\r\n                type: \"FLOAT\",\r\n                internalFormat: \"RGBA16F\"\r\n            }]\r\n        });\r\n\r\n        this._scatteringBuffer.init();\r\n    }\r\n\r\n    protected _renderLookupTextures() {\r\n        if (!this.renderer) return;\r\n\r\n        let positionBuffer = this.renderer.screenFramePositionBuffer;\r\n\r\n        let h = this.renderer.handler;\r\n        let gl = h.gl!;\r\n\r\n        //\r\n        // Draw transmittance texture\r\n        //\r\n        if (this._transmittanceBuffer) {\r\n            this._transmittanceBuffer.activate();\r\n\r\n            let p = h.programs.transmittance;\r\n            let sha = p._program.attributes;\r\n            let shu = p._program.uniforms;\r\n            p.activate();\r\n\r\n            gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n            gl.uniform2fv(shu.iResolution, [this._transmittanceBuffer.width, this._transmittanceBuffer.height]);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer!);\r\n            gl.vertexAttribPointer(sha.a_position, positionBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, positionBuffer!.numItems);\r\n\r\n            this._transmittanceBuffer.deactivate();\r\n        }\r\n\r\n        //\r\n        // Draw scattering texture\r\n        //\r\n        if (this._scatteringBuffer && this._transmittanceBuffer) {\r\n            this._scatteringBuffer.activate();\r\n\r\n            let p = h.programs.scattering;\r\n            let sha = p._program.attributes;\r\n            let shu = p._program.uniforms;\r\n            p.activate();\r\n\r\n            gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n            gl.uniform2fv(shu.iResolution, [this._scatteringBuffer.width, this._scatteringBuffer.height]);\r\n\r\n            gl.activeTexture(gl.TEXTURE0);\r\n            gl.bindTexture(gl.TEXTURE_2D, this._transmittanceBuffer.textures[0]);\r\n            gl.uniform1i(shu.transmittanceTexture, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer!);\r\n            gl.vertexAttribPointer(sha.a_position, positionBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, positionBuffer!.numItems);\r\n\r\n            this._scatteringBuffer.deactivate();\r\n        }\r\n    }\r\n\r\n    public drawLookupTextures() {\r\n        this._renderLookupTextures();\r\n    }\r\n\r\n    protected _drawBackground() {\r\n        let h = this.renderer!.handler;\r\n        let sh = h.programs.atmosphereBackground,\r\n            p = sh._program,\r\n            shu = p.uniforms,\r\n            gl = h.gl!;\r\n        let r = this.renderer!;\r\n        let cam = this.planet!.camera;\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        sh.activate();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, r.screenFramePositionBuffer!);\r\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this._transmittanceBuffer!.textures[0]);\r\n        gl.uniform1i(shu.transmittanceTexture, 0);\r\n\r\n        gl.activeTexture(gl.TEXTURE1);\r\n        gl.bindTexture(gl.TEXTURE_2D, this._scatteringBuffer!.textures[0]);\r\n        gl.uniform1i(shu.scatteringTexture, 1);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n\r\n        let sunPos = this.planet!.sunPos;\r\n        gl.uniform3fv(shu.sunPos, [sunPos.x, sunPos.y, sunPos.z]);\r\n        gl.uniform3fv(shu.camPos, [cam.eye.x, cam.eye.y, cam.eye.z]);\r\n        gl.uniform2fv(shu.iResolution, [r.sceneFramebuffer!.width, r.sceneFramebuffer!.height]);\r\n        gl.uniform1f(shu.fov, cam.getViewAngle());\r\n        gl.uniform1f(shu.opacity, this.opacity);\r\n\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n    }\r\n}\r\n\r\nfunction atmosphereBackgroundShader(atmosParams?: AtmosphereParameters): Program {\r\n    return new Program(\"atmosphereBackground\", {\r\n        uniforms: {\r\n            iResolution: \"vec2\",\r\n            fov: \"float\",\r\n            camPos: \"vec3\",\r\n            viewMatrix: \"mat4\",\r\n            transmittanceTexture: \"sampler2D\",\r\n            scatteringTexture: \"sampler2D\",\r\n            sunPos: \"vec3\",\r\n            opacity: \"float\"\r\n        },\r\n        attributes: {\r\n            corners: \"vec3\"\r\n        },\r\n        vertexShader: atmosphere_vert,\r\n        fragmentShader: stringTemplate2(atmosphere_frag, atmosParams)\r\n    });\r\n}\r\n","interface IProjParams {\r\n    units: string;\r\n    code: string;\r\n}\r\n\r\n/**\r\n * Projection units: 'degrees', 'ft', 'm' or 'km'.\r\n * @enum {string}\r\n * @api\r\n */\r\nexport const Units = {\r\n    DEGREES: \"degrees\",\r\n    FEET: \"ft\",\r\n    METERS: \"m\",\r\n    KILOMETERS: \"km\"\r\n};\r\n\r\n/**\r\n * Meters per unit lookup table.\r\n * @const\r\n * @type {Record<string, number>}\r\n */\r\nexport const METERS_PER_UNIT: Record<string, number> = {};\r\nMETERS_PER_UNIT[Units.FEET] = 0.3048;\r\nMETERS_PER_UNIT[Units.METERS] = 1;\r\nMETERS_PER_UNIT[Units.KILOMETERS] = 1000;\r\n\r\nlet _counter = 0;\r\n\r\nclass Proj {\r\n\r\n    public id: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public code: string;\r\n\r\n    /**\r\n     * @public\r\n     * @type {Units}\r\n     */\r\n    public units: string;\r\n\r\n    constructor(options: IProjParams) {\r\n        this.id = _counter++;\r\n        this.code = options.code;\r\n        this.units = options.units;\r\n    }\r\n\r\n    /**\r\n     * Compare projections.\r\n     * @public\r\n     * @param {Proj} proj - Projection object.\r\n     * @returns {boolean}\r\n     */\r\n    public equal(proj: Proj): boolean {\r\n        return proj.id === this.id;\r\n    }\r\n}\r\n\r\nexport {Proj};","/**\r\n * @module og/proj/EPSG3857\r\n */\r\n\r\nimport { Proj, Units } from \"./Proj\";\r\n\r\n/**\r\n * EPSG:3857 projection object.\r\n * @type {Proj}\r\n */\r\nexport const EPSG3857 = new Proj({ code: \"epsg:3857\", units: Units.METERS });\r\n","import {Layer} from \"../layer/Layer\";\r\nimport {Segment} from \"./Segment\";\r\nimport {Material} from \"../layer/Material\";\r\n\r\nclass Slice {\r\n    public segment: Segment;\r\n    public layers: Layer[];\r\n    public tileOffsetArr: Float32Array;\r\n    public layerOpacityArr: Float32Array;\r\n\r\n    constructor(segment: Segment) {\r\n        this.segment = segment;\r\n        this.layers = [];\r\n        this.tileOffsetArr = new Float32Array(segment.planet.SLICE_SIZE_4);\r\n        this.layerOpacityArr = new Float32Array(segment.planet.SLICE_SIZE);\r\n    }\r\n\r\n    public clear() {\r\n        // @ts-ignore\r\n        this.layers = null;\r\n        // @ts-ignore\r\n        this.tileOffsetArr = null;\r\n        // @ts-ignore\r\n        this.layerOpacityArr = null;\r\n    }\r\n\r\n    public append(layer: Layer, material: Material) {\r\n        let n = this.layers.length;\r\n\r\n        this.layers.push(layer);\r\n\r\n        this.layerOpacityArr[n] = layer.screenOpacity;\r\n\r\n        let n4 = n * 4;\r\n\r\n        let arr = layer.applyMaterial(material);\r\n        this.tileOffsetArr[n4] = arr[0];\r\n        this.tileOffsetArr[n4 + 1] = arr[1];\r\n        this.tileOffsetArr[n4 + 2] = arr[2];\r\n        this.tileOffsetArr[n4 + 3] = arr[3];\r\n\r\n        //arr = this.segment._getLayerExtentOffset(layer);\r\n        //slice.visibleExtentOffsetArr[n4] = arr[0];\r\n        //slice.visibleExtentOffsetArr[n4 + 1] = arr[1];\r\n        //slice.visibleExtentOffsetArr[n4 + 2] = arr[2];\r\n        //slice.visibleExtentOffsetArr[n4 + 3] = arr[3];\r\n\r\n    }\r\n}\r\n\r\nexport {Slice}","import * as mercator from \"../mercator\";\r\nimport * as segmentHelper from \"../segment/segmentHelper\";\r\nimport {Box} from \"../bv/Box\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport {EPSG3857} from \"../proj/EPSG3857\";\r\nimport {E, N, OPSIDE, S, W} from \"../quadTree/quadTree\";\r\nimport {getMatrixSubArray64} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport type {WebGLBufferExt, WebGLTextureExt} from \"../webgl/Handler\";\r\nimport type {ITerrainWorkerData} from \"../utils/TerrainWorker\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Material} from \"../layer/Material\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {PlanetCamera} from \"../camera/PlanetCamera\";\r\nimport {Program} from \"../webgl/Program\";\r\nimport {Proj} from \"../proj/Proj\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport type {NumberArray6} from \"../bv/Sphere\";\r\nimport {Slice} from \"./Slice\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {IPlainSegmentWorkerData} from \"../utils/PlainSegmentWorker\";\r\nimport {MAX_LAT, MIN_LAT, POLE} from \"../mercator\";\r\n\r\n//Math.round(Math.abs(-pole - extent.southWest.lon) / (extent.northEast.lon - extent.southWest.lon));\r\n\r\nexport function getTileCellIndex(coordinate: number, tileSize: number, worldEdge: number): number {\r\n    return Math.floor(Math.abs(worldEdge - coordinate) / tileSize);\r\n}\r\n\r\nexport function getTileCellExtent(x: number, y: number, z: number, worldExtent: Extent): Extent {\r\n    let pz = 1.0 / (1 << z);\r\n\r\n    let worldWidth = worldExtent.getWidth(),\r\n        worldHeight = worldExtent.getHeight();\r\n\r\n    let w = worldWidth * pz,\r\n        h = worldHeight * pz;\r\n\r\n    let sw_lon = worldExtent.southWest.lon + x * w,\r\n        ne_lat = worldExtent.northEast.lat - y * h;\r\n\r\n    return new Extent(new LonLat(sw_lon, ne_lat - h), new LonLat(sw_lon + w, ne_lat));\r\n}\r\n\r\nexport const TILEGROUP_COMMON = 0;\r\nexport const TILEGROUP_NORTH = 20;\r\nexport const TILEGROUP_SOUTH = 300;\r\n\r\nexport function getTileGroupByLat(lat: number, maxLat: number = MAX_LAT): number {\r\n    if (lat > maxLat) {\r\n        return TILEGROUP_NORTH;\r\n    } else if (lat < -maxLat) {\r\n        return TILEGROUP_SOUTH;\r\n    }\r\n    return TILEGROUP_COMMON;\r\n}\r\n\r\nlet _tempHigh = new Vec3();\r\nlet _tempLow = new Vec3();\r\n\r\nlet _v0 = new Vec3(),\r\n    _v1 = new Vec3(),\r\n    _v2 = new Vec3(),\r\n    _v3 = new Vec3();\r\n\r\nlet _ray = new Ray(),\r\n    _rayEx = new Ray();\r\n\r\nconst _S = new Array(4);\r\n_S[N] = 0;\r\n_S[E] = 1;\r\n_S[S] = 1;\r\n_S[W] = 0;\r\n\r\nconst _V = new Array(4);\r\n_V[N] = false;\r\n_V[E] = true;\r\n_V[S] = false;\r\n_V[W] = true;\r\n\r\n/**\r\n * Planet segment Web Mercator tile class that stored and rendered with a quad-tree.\r\n * @class\r\n * @param {Node} node - Segment node.\r\n * @param {Planet} planet - Planet scene.\r\n * @param {number} tileZoom - Zoom index.\r\n * @param {Extent} extent - Segment extent.\r\n */\r\nclass Segment {\r\n\r\n    public _isNorth?: boolean;\r\n\r\n    public isPole: boolean;\r\n\r\n    public _tileGroup: number;\r\n\r\n    public _projection: Proj;\r\n\r\n    public elevationData: TypedArray | null;\r\n\r\n    /**\r\n     * Quad tree node of the segment.\r\n     * @type {Node}\r\n     */\r\n    public node: Node;\r\n\r\n    /**\r\n     * Planet pointer.\r\n     * @type {Planet}\r\n     */\r\n    public planet: Planet;\r\n\r\n    /**\r\n     * WebGl handler pointer.\r\n     * @type {Handler}\r\n     */\r\n    public handler: Handler;\r\n\r\n    /**\r\n     * Segment bounding sphere\r\n     * @type {Sphere}\r\n     */\r\n    public bsphere: Sphere;\r\n\r\n    public _plainRadius: number;\r\n\r\n    /**\r\n     * Segment bounding box.\r\n     * @type {Box}\r\n     */\r\n    public bbox: Box;\r\n\r\n    public _sw: Vec3;\r\n    public _nw: Vec3;\r\n    public _se: Vec3;\r\n    public _ne: Vec3;\r\n\r\n    public centerNormal: Vec3;\r\n\r\n    /**\r\n     * Geographical extent.\r\n     * @type {Extent}\r\n     */\r\n    public _extent: Extent;\r\n\r\n    public _extentMerc: Extent;\r\n\r\n    public _extentLonLat: Extent;\r\n\r\n    /**\r\n     * Vertices grid size.\r\n     * @type {number}\r\n     */\r\n    public gridSize: number;\r\n\r\n    public fileGridSize: number;\r\n\r\n    /**\r\n     * Tile zoom index.\r\n     * @type {number}\r\n     */\r\n    public tileZoom: number;\r\n\r\n    /**\r\n     * Equals to pow(2, tileZoom).\r\n     * @type {number}\r\n     */\r\n    public powTileZoom: number;\r\n\r\n    /**\r\n     * Horizontal tile index.\r\n     * @type {number}\r\n     */\r\n    public tileX: number;\r\n\r\n    public tileXE: number;\r\n\r\n    public tileXW: number;\r\n\r\n    public tileYN: number;\r\n\r\n    public tileYS: number;\r\n\r\n    /**\r\n     * Vertical tile index.\r\n     * @type {number}\r\n     */\r\n    public tileY: number;\r\n\r\n    public tileIndex: string;\r\n\r\n    /**\r\n     * Texture materials array.\r\n     * @type {Array.<Material>}\r\n     *\r\n     * @toso: Check it should be Map<number, Material> instead of array\r\n     *\r\n     */\r\n    public materials: Material[];\r\n\r\n    /**\r\n     * Plain segment vertices was created.\r\n     * @type {boolean}\r\n     */\r\n    public plainReady: boolean;\r\n\r\n    /**\r\n     * Segment is ready to create plain vertices.\r\n     * @type {boolean}\r\n     */\r\n    public initialized: boolean;\r\n\r\n    /**\r\n     * Normal map is allready made.\r\n     * @type {boolean}\r\n     */\r\n    public normalMapReady: boolean;\r\n\r\n    /**\r\n     * Terrain is allready applied flag.\r\n     * @type {boolean}\r\n     */\r\n    public terrainReady: boolean;\r\n\r\n    /**\r\n     * Terrain is loading now flag.\r\n     * @type {boolean}\r\n     */\r\n    public terrainIsLoading: boolean;\r\n\r\n    /**\r\n     * Terrain existing flag.\r\n     * @type {boolean}\r\n     */\r\n    public terrainExists: boolean;\r\n\r\n    /**\r\n     * Means that tree passage reach the segment, and the segment terrain is ready.\r\n     * @type {boolean}\r\n     */\r\n    public passReady: boolean;\r\n\r\n    public plainVertices: Float64Array | null;\r\n    public plainVerticesHigh: Float32Array | null;\r\n    public plainVerticesLow: Float32Array | null;\r\n\r\n    public plainNormals: Float32Array | null;\r\n\r\n    public terrainVertices: Float64Array | null;\r\n    public terrainVerticesHigh: Float32Array | null;\r\n    public terrainVerticesLow: Float32Array | null;\r\n    public noDataVertices: Uint8Array | null;\r\n\r\n    public tempVertices: Float64Array | null;\r\n    public tempVerticesHigh: Float32Array | null;\r\n    public tempVerticesLow: Float32Array | null;\r\n\r\n    public normalMapTexture: WebGLTextureExt | null;\r\n    public normalMapTextureBias: Float32Array;\r\n    public normalMapVertices: Float64Array | null;\r\n    public normalMapVerticesHigh: Float32Array | null;\r\n    public normalMapVerticesLow: Float32Array | null;\r\n    public normalMapNormals: Float32Array | null;\r\n\r\n    public vertexNormalBuffer: WebGLBufferExt | null;\r\n    public vertexPositionBuffer: WebGLBufferExt | null;\r\n    public vertexPositionBufferHigh: WebGLBufferExt | null;\r\n    public vertexPositionBufferLow: WebGLBufferExt | null;\r\n    public vertexTextureCoordBuffer: WebGLBufferExt | null;\r\n\r\n    public _globalTextureCoordinates: Float32Array;\r\n    public _inTheQueue: boolean;\r\n    public _appliedNeighborsZoom: [number, number, number, number];\r\n\r\n    public _slices: Slice[];\r\n\r\n    public _indexBuffer: WebGLBufferExt | null;\r\n\r\n    public readyToEngage: boolean;\r\n\r\n    public plainProcessing: boolean;\r\n\r\n    public normalMapTexturePtr: WebGLTextureExt | null;\r\n\r\n    public _transitionOpacity: number;\r\n\r\n    public _transitionTimestamp: number;\r\n\r\n    constructor(node: Node, planet: Planet, tileZoom: number, extent: Extent) {\r\n\r\n        this.isPole = false;\r\n\r\n        this._tileGroup = TILEGROUP_COMMON;\r\n\r\n        this._projection = EPSG3857;\r\n\r\n        this.node = node;\r\n\r\n        this.planet = planet;\r\n\r\n        this.handler = planet.renderer!.handler;\r\n\r\n        this.bsphere = new Sphere();\r\n\r\n        this._plainRadius = 0;\r\n\r\n        this.bbox = new Box();\r\n\r\n        this._sw = new Vec3();\r\n        this._nw = new Vec3();\r\n        this._se = new Vec3();\r\n        this._ne = new Vec3();\r\n\r\n        this.centerNormal = new Vec3();\r\n\r\n        this._extent = this._extentMerc = extent;\r\n\r\n        this._extentLonLat = new Extent();\r\n\r\n        this.gridSize = planet.terrain!.gridSizeByZoom[tileZoom];\r\n\r\n        this.fileGridSize = 0;\r\n\r\n        this.tileZoom = tileZoom;\r\n\r\n        this.powTileZoom = 1 << tileZoom; //Math.pow(2, tileZoom);\r\n\r\n        this.tileX = 0;\r\n\r\n        this.tileXE = 0;\r\n\r\n        this.tileXW = 0;\r\n\r\n        this.tileYN = 0;\r\n\r\n        this.tileYS = 0;\r\n\r\n        this.tileY = 0;\r\n\r\n        this.tileIndex = \"\";\r\n\r\n        this.elevationData = null;\r\n\r\n        this._assignTileIndexes();\r\n\r\n        /**\r\n         * @toso: Check it should be Map<number, Material> instead of array\r\n         */\r\n        this.materials = [];\r\n\r\n        this.plainReady = false;\r\n\r\n        this.initialized = false;\r\n\r\n        this.normalMapReady = false;\r\n\r\n        this.terrainReady = false;\r\n\r\n        this.terrainIsLoading = false;\r\n\r\n        this.terrainExists = false;\r\n\r\n        this.passReady = false;\r\n\r\n        this.plainVertices = null;\r\n        this.plainVerticesHigh = null;\r\n        this.plainVerticesLow = null;\r\n\r\n        this.plainNormals = null;\r\n\r\n        this.terrainVertices = null;\r\n        this.terrainVerticesHigh = null;\r\n        this.terrainVerticesLow = null;\r\n        this.noDataVertices = null;\r\n\r\n        this.tempVertices = null;\r\n        this.tempVerticesHigh = null;\r\n        this.tempVerticesLow = null;\r\n\r\n        this.normalMapTexture = null;\r\n        this.normalMapTextureBias = new Float32Array(3);\r\n        this.normalMapVertices = null;\r\n        this.normalMapVerticesHigh = null;\r\n        this.normalMapVerticesLow = null;\r\n        this.normalMapNormals = null;\r\n\r\n        this.vertexNormalBuffer = null;\r\n        this.vertexPositionBuffer = null;\r\n        this.vertexPositionBufferHigh = null;\r\n        this.vertexPositionBufferLow = null;\r\n        this.vertexTextureCoordBuffer = null;\r\n\r\n        this._globalTextureCoordinates = new Float32Array(4);\r\n        this._inTheQueue = false;\r\n        this._appliedNeighborsZoom = [0, 0, 0, 0];\r\n\r\n        this._slices = [];\r\n\r\n        this._indexBuffer = null;\r\n\r\n        this.readyToEngage = false;\r\n\r\n        this.plainProcessing = false;\r\n\r\n        this.normalMapTexturePtr = null;\r\n\r\n        this._transitionOpacity = 1.0;\r\n\r\n        this._transitionTimestamp = 0;\r\n    }\r\n\r\n    public checkZoom(): boolean {\r\n        return this.tileZoom < this.planet.terrain!._maxNodeZoom;\r\n    }\r\n\r\n    /**\r\n     * Returns entity terrain point.\r\n     * @public\r\n     * @param {Entity} entity - Entity.\r\n     * @param {Vec3} res - Point coordinates.\r\n     * @returns {Vec3} -\r\n     */\r\n    public getEntityTerrainPoint(entity: Entity, res: Vec3): number {\r\n        return this.getTerrainPoint(entity._cartesian, this.getInsideLonLat(entity), res);\r\n    }\r\n\r\n    public getInsideLonLat(obj: Entity | PlanetCamera): LonLat {\r\n        return obj._lonLatMerc;\r\n    }\r\n\r\n    public isEntityInside(entity: Entity): boolean {\r\n        return this._extentLonLat!.isInside(entity._lonLat);\r\n    }\r\n\r\n    /**\r\n     * Returns distance from object to terrain coordinates and terrain point that calculates out in the res parameter.\r\n     * @public\r\n     * @param {Vec3} xyz - Cartesian object position.\r\n     * @param {LonLat} insideSegmentPosition - Geodetic object position.\r\n     * @param {Vec3} [res] - Result cartesian coordinates on the terrain.\r\n     * @returns {number} -\r\n     */\r\n    public getTerrainPoint(xyz: Vec3, insideSegmentPosition: LonLat, res: Vec3): number {\r\n        let verts = this.tempVertices;\r\n\r\n        if (verts && verts.length) {\r\n            let norm = this.planet.ellipsoid.getSurfaceNormal3v(xyz);\r\n            _ray.set(xyz, norm.negateTo());\r\n\r\n            let ne = this._extent.northEast,\r\n                sw = this._extent.southWest,\r\n                size = Math.sqrt(verts.length / 3) - 1;\r\n\r\n            let xmax = ne.lon,\r\n                ymax = ne.lat,\r\n                xmin = sw.lon,\r\n                ymin = sw.lat,\r\n                x = insideSegmentPosition.lon,\r\n                y = insideSegmentPosition.lat;\r\n\r\n            let sxn = xmax - xmin,\r\n                syn = ymax - ymin;\r\n\r\n            let qx = sxn / size,\r\n                qy = syn / size;\r\n\r\n            let xn = x - xmin,\r\n                yn = y - ymin;\r\n\r\n            let indX = Math.floor(xn / qx),\r\n                indY = Math.floor(size - yn / qy);\r\n\r\n            let ind_v0 = ((size + 1) * indY + indX) * 3;\r\n            let ind_v2 = ((size + 1) * (indY + 1) + indX) * 3;\r\n\r\n            _v0.set(verts[ind_v0], verts[ind_v0 + 1], verts[ind_v0 + 2]);\r\n            _v1.set(verts[ind_v0 + 3], verts[ind_v0 + 4], verts[ind_v0 + 5]);\r\n            _v2.set(verts[ind_v2], verts[ind_v2 + 1], verts[ind_v2 + 2]);\r\n\r\n            let d = _ray.hitTriangleRes(_v0, _v1, _v2, res);\r\n\r\n            if (d === Ray.INSIDE) {\r\n                return xyz.distance(res);\r\n            } else if (d === Ray.AWAY) {\r\n                _rayEx.set(xyz, norm);\r\n                let d = _rayEx.hitTriangleRes(_v0, _v1, _v2, res);\r\n                if (d === Ray.INSIDE) {\r\n                    return -xyz.distance(res);\r\n                }\r\n            }\r\n\r\n            _v3.set(verts[ind_v2 + 3], verts[ind_v2 + 4], verts[ind_v2 + 5]);\r\n\r\n            d = _ray.hitTriangleRes(_v1, _v3, _v2, res);\r\n            if (d === Ray.INSIDE) {\r\n                return xyz.distance(res);\r\n            } else if (d === Ray.AWAY) {\r\n                _rayEx.set(xyz, norm);\r\n                let d = _rayEx.hitTriangleRes(_v1, _v3, _v2, res);\r\n                if (d === Ray.INSIDE) {\r\n                    return -xyz.distance(res);\r\n                }\r\n            }\r\n\r\n            if (d === Ray.AWAY) {\r\n                return -xyz.distance(res);\r\n            }\r\n\r\n            return xyz.distance(res);\r\n        } else {\r\n            return xyz.distance(this.planet.ellipsoid.hitRay(_ray.origin, _ray.direction)!);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Project wgs86 to segment native projection.\r\n     * @public\r\n     * @param {LonLat} lonlat - Coordinates to project.\r\n     * @returns {LonLat} -\r\n     */\r\n    public projectNative(lonlat: LonLat): LonLat {\r\n        return lonlat.forwardMercator();\r\n    }\r\n\r\n    public loadTerrain(forceLoading: boolean = false) {\r\n        if (this.tileZoom < this.planet.terrain!.minZoom || this.planet.terrain!.isEmpty) {\r\n            this.terrainIsLoading = true;\r\n\r\n            this.elevationsNotExists();\r\n\r\n            if (!this._inTheQueue) {\r\n                this.planet._normalMapCreator.queue(this);\r\n            }\r\n        } else {\r\n            if (this.tileZoom > this.planet.terrain!.maxZoom) {\r\n                this.elevationsNotExists();\r\n            } else if (!this.terrainIsLoading && !this.terrainReady) {\r\n                this.planet.terrain!.loadTerrain(this, forceLoading);\r\n            }\r\n            // if (!this.terrainIsLoading && !this.terrainReady) {\r\n            //     this.planet.terrain.loadTerrain(this, forceLoading);\r\n            // }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Terrain obtained from server.\r\n     * @param {Float32Array} elevations - Elevation data.\r\n     */\r\n    public elevationsExists(elevations: number[] | TypedArray) {\r\n        if (this.plainReady && this.terrainIsLoading) {\r\n\r\n            let _elevations = new Float32Array(elevations.length);\r\n            _elevations.set(elevations);\r\n\r\n            this.elevationData = new Float32Array(elevations.length);\r\n            this.elevationData.set(elevations);\r\n\r\n            this.planet._terrainWorker.make({segment: this, elevations: _elevations});\r\n\r\n            this.plainVerticesHigh = null;\r\n            this.plainVerticesLow = null;\r\n\r\n            this.normalMapVerticesHigh = null;\r\n            this.normalMapVerticesLow = null;\r\n\r\n            if (!this.planet.terrain!.equalizeVertices) {\r\n                this.tempVerticesHigh = null;\r\n                this.tempVerticesLow = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Keep plain elevation segment for rendering\r\n     *\r\n     * 'this.tileZoom <= this.planet.terrain.maxZoom' it means, that the segment is plain\r\n     *\r\n     */\r\n    public elevationsNotExists() {\r\n        if (this.planet && this.tileZoom <= this.planet.terrain!.maxNativeZoom) {\r\n\r\n            if (this.plainReady && this.terrainIsLoading) {\r\n                this.terrainIsLoading = false;\r\n\r\n                let n = this.node;\r\n                n.appliedTerrainNodeId = this.node.nodeId;\r\n                n.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[S] =\r\n                    n.equalizedSideWithNodeId[W] = n.appliedTerrainNodeId;\r\n\r\n                if (this.planet.lightEnabled && !this._inTheQueue) {\r\n                    this.planet._normalMapCreator.queue(this);\r\n                }\r\n\r\n                this.readyToEngage = true;\r\n            }\r\n\r\n            // plain terrain only\r\n            this.terrainVertices = this.plainVertices;\r\n            this.terrainVerticesHigh = this.plainVerticesHigh;\r\n            this.terrainVerticesLow = this.plainVerticesLow;\r\n\r\n            this.tempVertices = this.terrainVertices;\r\n            this.tempVerticesHigh = this.terrainVerticesHigh;\r\n            this.tempVerticesLow = this.terrainVerticesLow;\r\n\r\n            this.noDataVertices = null;\r\n\r\n            this.fileGridSize = Math.sqrt(this.terrainVertices!.length / 3) - 1;\r\n            this.gridSize = this.fileGridSize;\r\n            this.terrainReady = true;\r\n            this.terrainExists = false;\r\n\r\n        } else {\r\n\r\n            if (this.plainReady && this.terrainIsLoading) {\r\n                this.terrainIsLoading = false;\r\n\r\n                let n = this.node;\r\n                n.appliedTerrainNodeId = this.node.nodeId;\r\n                n.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[S] =\r\n                    n.equalizedSideWithNodeId[W] = n.appliedTerrainNodeId;\r\n\r\n                this.readyToEngage = true;\r\n                this.terrainReady = true;\r\n                this.passReady = true;\r\n\r\n                this.terrainExists = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _checkEqualization(neighborSide: number, neigborNode: Node): boolean {\r\n        return neigborNode && neigborNode.segment && this.tileZoom >= neigborNode.segment.tileZoom &&\r\n            this.node.equalizedSideWithNodeId[neighborSide] !== neigborNode.equalizedSideWithNodeId[OPSIDE[neighborSide]];\r\n    }\r\n\r\n    public equalize() {\r\n\r\n        // Equalization doesnt work correctly for gridSize equals 2\r\n        if (this.tileZoom < 2 || this.gridSize < 2) {\r\n            return;\r\n        }\r\n\r\n        this.readyToEngage = true;\r\n\r\n        let nn = this.node.neighbors;\r\n\r\n        let v = this.tempVertices!,\r\n            vHigh = this.tempVerticesHigh!,\r\n            vLow = this.tempVerticesLow!;\r\n\r\n        let gs = this.gridSize,\r\n            gsOne = gs + 1;\r\n\r\n        let n = nn[N][0];\r\n        if (this._checkEqualization(N, n)) {\r\n\r\n            this.node.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[S];\r\n\r\n            this.readyToEngage = true;\r\n\r\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, N);\r\n\r\n            let nv = n.segment.tempVertices!,\r\n                nvHigh = n.segment.tempVerticesHigh!,\r\n                nvLow = n.segment.tempVerticesLow!;\r\n\r\n            let n_gs = n.segment.gridSize,\r\n                n_gsOne = n_gs + 1;\r\n\r\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\r\n\r\n            let inc = Math.max(gs / (n_gs * dz), 1),\r\n                n_inc = Math.max((n_gs * dz) / gs, 1),\r\n                n_offset = offset * n_gs;\r\n\r\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\r\n                const index = k * 3;\r\n                const n_index = (n_gsOne * n_gs + nk) * 3;\r\n\r\n                v[index] = nv[n_index];\r\n                v[index + 1] = nv[n_index + 1];\r\n                v[index + 2] = nv[n_index + 2];\r\n\r\n                vHigh[index] = nvHigh[n_index];\r\n                vHigh[index + 1] = nvHigh[n_index + 1];\r\n                vHigh[index + 2] = nvHigh[n_index + 2];\r\n\r\n                vLow[index] = nvLow[n_index];\r\n                vLow[index + 1] = nvLow[n_index + 1];\r\n                vLow[index + 2] = nvLow[n_index + 2];\r\n            }\r\n        }\r\n\r\n        n = nn[E][0];\r\n        if (this._checkEqualization(E, n)) {\r\n\r\n            this.node.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[W];\r\n\r\n            this.readyToEngage = true;\r\n\r\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, E);\r\n\r\n            let nv = n.segment.tempVertices!,\r\n                nvHigh = n.segment.tempVerticesHigh!,\r\n                nvLow = n.segment.tempVerticesLow!;\r\n\r\n            let n_gs = n.segment.gridSize,\r\n                n_gsOne = n_gs + 1;\r\n\r\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\r\n\r\n            let inc = Math.max(gs / (n_gs * dz), 1),\r\n                n_inc = Math.max((n_gs * dz) / gs, 1),\r\n                n_offset = offset * n_gs;\r\n\r\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\r\n                const index = (gsOne * k + gs) * 3;\r\n                const n_index = n_gsOne * nk * 3;\r\n\r\n                v[index] = nv[n_index];\r\n                v[index + 1] = nv[n_index + 1];\r\n                v[index + 2] = nv[n_index + 2];\r\n\r\n                vHigh[index] = nvHigh[n_index];\r\n                vHigh[index + 1] = nvHigh[n_index + 1];\r\n                vHigh[index + 2] = nvHigh[n_index + 2];\r\n\r\n                vLow[index] = nvLow[n_index];\r\n                vLow[index + 1] = nvLow[n_index + 1];\r\n                vLow[index + 2] = nvLow[n_index + 2];\r\n            }\r\n        }\r\n\r\n        n = nn[S][0];\r\n        if (this._checkEqualization(S, n)) {\r\n\r\n            this.node.equalizedSideWithNodeId[S] = n.equalizedSideWithNodeId[N];\r\n\r\n            this.readyToEngage = true;\r\n\r\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, S);\r\n\r\n            let nv = n.segment.tempVertices!,\r\n                nvHigh = n.segment.tempVerticesHigh!,\r\n                nvLow = n.segment.tempVerticesLow!;\r\n\r\n            let n_gs = n.segment.gridSize; // n_gsOne = n_gs + 1;\r\n\r\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\r\n\r\n            let inc = Math.max(gs / (n_gs * dz), 1),\r\n                n_inc = Math.max((n_gs * dz) / gs, 1),\r\n                n_offset = offset * n_gs;\r\n\r\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\r\n                const index = (gsOne * gs + k) * 3;\r\n                const n_index = nk * 3;\r\n\r\n                v[index] = nv[n_index];\r\n                v[index + 1] = nv[n_index + 1];\r\n                v[index + 2] = nv[n_index + 2];\r\n\r\n                vHigh[index] = nvHigh[n_index];\r\n                vHigh[index + 1] = nvHigh[n_index + 1];\r\n                vHigh[index + 2] = nvHigh[n_index + 2];\r\n\r\n                vLow[index] = nvLow[n_index];\r\n                vLow[index + 1] = nvLow[n_index + 1];\r\n                vLow[index + 2] = nvLow[n_index + 2];\r\n            }\r\n        }\r\n\r\n        n = nn[W][0];\r\n        if (this._checkEqualization(W, n)) {\r\n\r\n            this.node.equalizedSideWithNodeId[W] = n.equalizedSideWithNodeId[E];\r\n\r\n            this.readyToEngage = true;\r\n\r\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, W);\r\n\r\n            let nv = n.segment.tempVertices!,\r\n                nvHigh = n.segment.tempVerticesHigh!,\r\n                nvLow = n.segment.tempVerticesLow!;\r\n\r\n            let n_gs = n.segment.gridSize,\r\n                n_gsOne = n_gs + 1;\r\n\r\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\r\n\r\n            let inc = Math.max(gs / (n_gs * dz), 1),\r\n                n_inc = Math.max((n_gs * dz) / gs, 1),\r\n                n_offset = offset * n_gs;\r\n\r\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\r\n                const index = gsOne * k * 3;\r\n                const n_index = (n_gsOne * nk + n_gs) * 3;\r\n\r\n                v[index] = nv[n_index];\r\n                v[index + 1] = nv[n_index + 1];\r\n                v[index + 2] = nv[n_index + 2];\r\n\r\n                vHigh[index] = nvHigh[n_index];\r\n                vHigh[index + 1] = nvHigh[n_index + 1];\r\n                vHigh[index + 2] = nvHigh[n_index + 2];\r\n\r\n                vLow[index] = nvLow[n_index];\r\n                vLow[index + 1] = nvLow[n_index + 1];\r\n                vLow[index + 2] = nvLow[n_index + 2];\r\n            }\r\n        }\r\n    }\r\n\r\n    public engage() {\r\n        this.readyToEngage = false;\r\n        this.createCoordsBuffers(this.tempVerticesHigh!, this.tempVerticesLow!, this.gridSize);\r\n    }\r\n\r\n    public _terrainWorkerCallback(data: ITerrainWorkerData) {\r\n        if (this.plainReady) {\r\n            this.readyToEngage = true;\r\n\r\n            this.normalMapNormals = null;\r\n\r\n            this.normalMapVertices = null;\r\n            this.normalMapVerticesHigh = null;\r\n            this.normalMapVerticesLow = null;\r\n\r\n            this.terrainVertices = null;\r\n            this.terrainVerticesHigh = null;\r\n            this.terrainVerticesLow = null;\r\n            this.noDataVertices = null;\r\n\r\n            this.tempVertices = null;\r\n            this.tempVerticesHigh = null;\r\n            this.tempVerticesLow = null;\r\n\r\n            this.normalMapNormals = data.normalMapNormals;\r\n            this.normalMapVertices = data.normalMapVertices;\r\n            this.normalMapVerticesHigh = data.normalMapVerticesHigh;\r\n            this.normalMapVerticesLow = data.normalMapVerticesLow;\r\n\r\n            this.terrainVertices = data.terrainVertices;\r\n            this.terrainVerticesHigh = data.terrainVerticesHigh;\r\n            this.terrainVerticesLow = data.terrainVerticesLow;\r\n\r\n            this.noDataVertices = data.noDataVertices;\r\n\r\n            this.tempVertices = this.terrainVertices;\r\n            this.tempVerticesHigh = this.terrainVerticesHigh;\r\n            this.tempVerticesLow = this.terrainVerticesLow;\r\n\r\n            this.setBoundingVolumeArr(data.bounds);\r\n\r\n            this.gridSize = Math.sqrt(this.terrainVertices!.length / 3) - 1;\r\n\r\n            let n = this.node;\r\n            n.appliedTerrainNodeId = n.nodeId;\r\n            n.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[S] =\r\n                n.equalizedSideWithNodeId[W] = n.appliedTerrainNodeId;\r\n\r\n            this.terrainReady = true;\r\n            this.terrainIsLoading = false;\r\n            this.terrainExists = true;\r\n\r\n            if (!this.normalMapTexturePtr) {\r\n                const nmc = this.planet._normalMapCreator;\r\n                this.normalMapTexturePtr = this.planet.renderer!.handler.createEmptyTexture_l(nmc.width, nmc.height);\r\n            }\r\n\r\n            if (this.planet.lightEnabled) {\r\n                this.planet._normalMapCreator.queue(this);\r\n            }\r\n        }\r\n    }\r\n\r\n    public _normalMapEdgeEqualize(side: number) {\r\n        let nn = this.node.neighbors;\r\n        let nns = nn[side];\r\n        let n: Node | undefined = nns && nns[0];\r\n        let maxZ = this.planet.terrain!.maxZoom;\r\n\r\n        if (this.tileZoom === maxZ) {\r\n            if (nns && !(nn[0].length || nn[1].length || nn[2].length || nn[3].length)) {\r\n                n = this.node.getEqualNeighbor(side);\r\n            }\r\n        }\r\n\r\n        let b = n && n.segment,\r\n            s = this;\r\n\r\n        if (\r\n            n &&\r\n            b &&\r\n            b.terrainReady &&\r\n            b.terrainExists &&\r\n            b.tileZoom <= maxZ &&\r\n            s._appliedNeighborsZoom[side] !== b.tileZoom\r\n        ) {\r\n            s._appliedNeighborsZoom[side] = b.tileZoom;\r\n\r\n            let seg_a = s.normalMapNormals,\r\n                seg_b = b.normalMapNormals;\r\n\r\n            if (!(seg_a && seg_b)) return;\r\n\r\n            let seg_a_raw = s.normalMapNormals!,\r\n                seg_b_raw = b.normalMapNormals!;\r\n\r\n            // let seg_a_verts = s.terrainVertices,\r\n            //     seg_b_verts = s.terrainVertices;\r\n\r\n            let s_gs = Math.sqrt(seg_a.length / 3),\r\n                // b_gs = Math.sqrt(seg_b.length / 3),\r\n                s_gs1 = s_gs - 1;\r\n            // b_gs1 = b_gs - 1;\r\n\r\n            const i_a = s_gs1 * _S[side];\r\n\r\n            let nx, ny, nz, q;\r\n\r\n            if (s.tileZoom === b.tileZoom) {\r\n                const i_b = s_gs1 - i_a;\r\n\r\n                if (_V[side]) {\r\n                    for (let k = 0; k < s_gs; k++) {\r\n                        let vInd_a = (k * s_gs + i_a) * 3,\r\n                            vInd_b = (k * s_gs + i_b) * 3;\r\n\r\n                        nx = seg_a_raw[vInd_a] + seg_b_raw[vInd_b];\r\n                        ny = seg_a_raw[vInd_a + 1] + seg_b_raw[vInd_b + 1];\r\n                        nz = seg_a_raw[vInd_a + 2] + seg_b_raw[vInd_b + 2];\r\n\r\n                        q = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\r\n\r\n                        seg_b[vInd_b] = seg_a[vInd_a] = nx * q;\r\n                        seg_b[vInd_b + 1] = seg_a[vInd_a + 1] = ny * q;\r\n                        seg_b[vInd_b + 2] = seg_a[vInd_a + 2] = nz * q;\r\n                    }\r\n                } else {\r\n                    for (let k = 0; k < s_gs; k++) {\r\n                        let vInd_a = (i_a * s_gs + k) * 3,\r\n                            vInd_b = (i_b * s_gs + k) * 3;\r\n\r\n                        nx = seg_a_raw[vInd_a] + seg_b_raw[vInd_b];\r\n                        ny = seg_a_raw[vInd_a + 1] + seg_b_raw[vInd_b + 1];\r\n                        nz = seg_a_raw[vInd_a + 2] + seg_b_raw[vInd_b + 2];\r\n\r\n                        q = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\r\n\r\n                        seg_b[vInd_b] = seg_a[vInd_a] = nx * q;\r\n                        seg_b[vInd_b + 1] = seg_a[vInd_a + 1] = ny * q;\r\n                        seg_b[vInd_b + 2] = seg_a[vInd_a + 2] = nz * q;\r\n                    }\r\n                }\r\n\r\n                if (!b._inTheQueue && b._appliedNeighborsZoom[OPSIDE[side]] !== s.tileZoom) {\r\n                    b._appliedNeighborsZoom[OPSIDE[side]] = s.tileZoom;\r\n                    s.planet._normalMapCreator.queue(b);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public applyTerrain(elevations?: number[] | TypedArray | null) {\r\n        if (elevations) {\r\n            this.elevationsExists(elevations);\r\n        } else {\r\n            this.elevationsNotExists();\r\n        }\r\n    }\r\n\r\n    public deleteBuffers() {\r\n\r\n        const gl = this.handler.gl!;\r\n\r\n        gl.deleteBuffer(this.vertexNormalBuffer!);\r\n        gl.deleteBuffer(this.vertexPositionBuffer!);\r\n        gl.deleteBuffer(this.vertexPositionBufferHigh!);\r\n        gl.deleteBuffer(this.vertexPositionBufferLow!);\r\n\r\n        this.vertexNormalBuffer = null;\r\n        this.vertexPositionBuffer = null;\r\n        this.vertexPositionBufferHigh = null;\r\n        this.vertexPositionBufferLow = null;\r\n        this.vertexTextureCoordBuffer = null;\r\n    }\r\n\r\n    public deleteMaterials() {\r\n        let m = this.materials;\r\n        for (let i = 0; i < m.length; i++) {\r\n            let mi = m[i];\r\n            if (mi) {\r\n                mi.clear();\r\n            }\r\n        }\r\n        this.materials.length = 0;\r\n    }\r\n\r\n    public deleteElevations() {\r\n        this.terrainExists = false;\r\n        this.terrainReady = false;\r\n        this.terrainIsLoading = false;\r\n\r\n        this.normalMapVertices = null;\r\n        this.normalMapVerticesHigh = null;\r\n        this.normalMapVerticesLow = null;\r\n        this.normalMapNormals = null;\r\n\r\n        this.tempVertices = null;\r\n        this.tempVerticesHigh = null;\r\n        this.tempVerticesLow = null;\r\n\r\n        this.terrainVertices = null;\r\n        this.terrainVerticesHigh = null;\r\n        this.terrainVerticesLow = null;\r\n        this.noDataVertices = null;\r\n\r\n        this.plainVertices = null;\r\n        this.plainVerticesHigh = null;\r\n        this.plainVerticesLow = null;\r\n        this.plainNormals = null;\r\n\r\n        if (this.normalMapReady) {\r\n            this.handler.gl!.deleteTexture(this.normalMapTexture!);\r\n            this.normalMapReady = false;\r\n        }\r\n\r\n        this._appliedNeighborsZoom = [0, 0, 0, 0];\r\n\r\n        this.normalMapTextureBias[0] = 0;\r\n        this.normalMapTextureBias[1] = 0;\r\n        this.normalMapTextureBias[2] = 1;\r\n\r\n        this._inTheQueue = false;\r\n    }\r\n\r\n    public clearSegment() {\r\n        this.plainReady = false;\r\n        this.initialized = false;\r\n        this.deleteBuffers();\r\n        this.deleteMaterials();\r\n        this.deleteElevations();\r\n    }\r\n\r\n    public childrenInitialized(): boolean {\r\n        let n = this.node.nodes;\r\n        return n.length === 4 && n[0].segment.initialized && n[1].segment.initialized && n[2].segment.initialized && n[3].segment.initialized;\r\n    }\r\n\r\n    public destroySegment() {\r\n\r\n        this.clearSegment();\r\n\r\n        let i = this._slices.length;\r\n        while (i--) {\r\n            this._slices[i].clear();\r\n        }\r\n\r\n        //@ts-ignore\r\n        this._slices = null;\r\n        //@ts-ignore\r\n        this.node = null;\r\n        //@ts-ignore\r\n        this.planet = null;\r\n        //@ts-ignore\r\n        this.handler = null;\r\n        //@ts-ignore\r\n        this.bbox = null;\r\n        //@ts-ignore\r\n        this.bsphere = null;\r\n        //@ts-ignore\r\n        this._extent = null;\r\n        //@ts-ignore\r\n        this.materials = null;\r\n\r\n        this.plainVertices = null;\r\n        this.plainVerticesHigh = null;\r\n        this.plainVerticesLow = null;\r\n        this.plainNormals = null;\r\n\r\n        this.terrainVertices = null;\r\n        this.terrainVerticesHigh = null;\r\n        this.terrainVerticesLow = null;\r\n        this.noDataVertices = null;\r\n\r\n        this.tempVertices = null;\r\n        this.tempVerticesHigh = null;\r\n        this.tempVerticesLow = null;\r\n\r\n        //@ts-ignore\r\n        this.normalMapTextureBias = null;\r\n        this.normalMapTexture = null;\r\n        this.normalMapVertices = null;\r\n        this.normalMapVerticesHigh = null;\r\n        this.normalMapVerticesLow = null;\r\n        this.normalMapNormals = null;\r\n\r\n        this.vertexNormalBuffer = null;\r\n        this.vertexPositionBuffer = null;\r\n        this.vertexPositionBufferHigh = null;\r\n        this.vertexPositionBufferLow = null;\r\n        this.vertexTextureCoordBuffer = null;\r\n\r\n        // @ts-ignore\r\n        this._projection = null;\r\n        // @ts-ignore\r\n        this._appliedNeighborsZoom = null;\r\n        // @ts-ignore\r\n        this._globalTextureCoordinates = null;\r\n    }\r\n\r\n    /**\r\n     * @todo: looks like it could be simplified in Segment contructor\r\n     */\r\n    public _setExtentLonLat() {\r\n        this._extentLonLat = this._extent.inverseMercator();\r\n    }\r\n\r\n    protected _createExtentNormals() {\r\n        const ellipsoid = this.planet.ellipsoid;\r\n        const extent = this._extentLonLat;\r\n\r\n        const coord_sw = ellipsoid.geodeticToCartesian(extent.southWest.lon, extent.southWest.lat);\r\n        const coord_ne = ellipsoid.geodeticToCartesian(extent.northEast.lon, extent.northEast.lat);\r\n\r\n        const coord_nw = ellipsoid.geodeticToCartesian(\r\n            extent.southWest.lon,\r\n            extent.northEast.lat\r\n        );\r\n\r\n        const coord_se = ellipsoid.geodeticToCartesian(\r\n            extent.northEast.lon,\r\n            extent.southWest.lat\r\n        );\r\n\r\n        this._sw.copy(coord_sw);\r\n        this._nw.copy(coord_nw);\r\n        this._ne.copy(coord_ne);\r\n        this._se.copy(coord_se);\r\n    }\r\n\r\n    public createBoundsByExtent() {\r\n        this._createExtentNormals();\r\n        this.setBoundingVolume3v(this._sw, this._ne);\r\n    }\r\n\r\n    public createBoundsByParent() {\r\n        let pn = this.node;\r\n\r\n        while (pn.parentNode && !pn.segment.terrainReady) {\r\n            pn = pn.parentNode;\r\n        }\r\n\r\n        let dZ2 = 1 << (this.tileZoom - pn.segment.tileZoom);\r\n\r\n        let offsetX = this.tileX - pn.segment.tileX * dZ2,\r\n            offsetY = this.tileY - pn.segment.tileY * dZ2;\r\n\r\n        if (pn.segment.terrainReady && pn.segment.tileZoom >= this.planet.terrain!.minZoom) {\r\n            let gridSize = pn.segment.gridSize / dZ2;\r\n\r\n            if (gridSize >= 1.0) {\r\n                //\r\n                // (*) Actually, we get parent whole bounding volume\r\n                //\r\n                this.bsphere.center.x = pn.segment.bsphere.center.x;\r\n                this.bsphere.center.y = pn.segment.bsphere.center.y;\r\n                this.bsphere.center.z = pn.segment.bsphere.center.z;\r\n                this.bsphere.radius = pn.segment.bsphere.radius;\r\n\r\n                let i0 = gridSize * offsetY;\r\n                let j0 = gridSize * offsetX;\r\n\r\n                let pnGsOne = pn.segment.gridSize + 1;\r\n\r\n                let ind_sw = 3 * ((i0 + gridSize) * pnGsOne + j0),\r\n                    ind_nw = 3 * (i0 * pnGsOne + j0),\r\n                    ind_ne = 3 * (i0 * pnGsOne + j0 + gridSize),\r\n                    ind_se = 3 * ((i0 + gridSize) * pnGsOne + j0 + gridSize);\r\n\r\n                let pVerts = pn.segment.tempVertices!;\r\n\r\n                let v_sw = new Vec3(pVerts[ind_sw], pVerts[ind_sw + 1], pVerts[ind_sw + 2]),\r\n                    v_ne = new Vec3(pVerts[ind_ne], pVerts[ind_ne + 1], pVerts[ind_ne + 2]);\r\n\r\n                // check for segment zoom\r\n                let v_nw = new Vec3(pVerts[ind_nw], pVerts[ind_nw + 1], pVerts[ind_nw + 2]),\r\n                    v_se = new Vec3(pVerts[ind_se], pVerts[ind_se + 1], pVerts[ind_se + 2]);\r\n\r\n                this._sw.copy(v_sw);\r\n                this._nw.copy(v_nw);\r\n                this._ne.copy(v_ne);\r\n                this._se.copy(v_se);\r\n\r\n            } else {\r\n                let pseg = pn.segment;\r\n\r\n                let i0 = Math.floor(gridSize * offsetY),\r\n                    j0 = Math.floor(gridSize * offsetX);\r\n\r\n                let insideSize = 1.0 / gridSize;\r\n\r\n                let t_i0 = offsetY - insideSize * i0,\r\n                    t_j0 = offsetX - insideSize * j0;\r\n\r\n                let bigOne;\r\n                if (pseg.gridSize === 1) {\r\n                    bigOne = pseg.tempVertices!;\r\n                } else {\r\n                    bigOne = getMatrixSubArray64(pseg.tempVertices!, pseg.gridSize, i0, j0, 1);\r\n                }\r\n\r\n                let v_lt = new Vec3(bigOne[0], bigOne[1], bigOne[2]),\r\n                    v_rb = new Vec3(bigOne[9], bigOne[10], bigOne[11]);\r\n\r\n                let vn = new Vec3(\r\n                        bigOne[3] - bigOne[0],\r\n                        bigOne[4] - bigOne[1],\r\n                        bigOne[5] - bigOne[2]\r\n                    ),\r\n                    vw = new Vec3(\r\n                        bigOne[6] - bigOne[0],\r\n                        bigOne[7] - bigOne[1],\r\n                        bigOne[8] - bigOne[2]\r\n                    ),\r\n                    ve = new Vec3(\r\n                        bigOne[3] - bigOne[9],\r\n                        bigOne[4] - bigOne[10],\r\n                        bigOne[5] - bigOne[11]\r\n                    ),\r\n                    vs = new Vec3(\r\n                        bigOne[6] - bigOne[9],\r\n                        bigOne[7] - bigOne[10],\r\n                        bigOne[8] - bigOne[11]\r\n                    );\r\n\r\n                let vi_y = t_i0,\r\n                    vi_x = t_j0;\r\n\r\n                let coords_lt, coords_rb;\r\n\r\n                if (vi_y + vi_x < insideSize) {\r\n                    coords_lt = Vec3.add(\r\n                        vn.scaleTo(vi_x / insideSize),\r\n                        vw.scaleTo(vi_y / insideSize)\r\n                    ).addA(v_lt);\r\n                } else {\r\n                    coords_lt = Vec3.add(\r\n                        vs.scaleTo(1 - vi_x / insideSize),\r\n                        ve.scaleTo(1 - vi_y / insideSize)\r\n                    ).addA(v_rb);\r\n                }\r\n\r\n                vi_y = t_i0 + 1;\r\n                vi_x = t_j0 + 1;\r\n\r\n                if (vi_y + vi_x < insideSize) {\r\n                    coords_rb = Vec3.add(\r\n                        vn.scaleTo(vi_x / insideSize),\r\n                        vw.scaleTo(vi_y / insideSize)\r\n                    ).addA(v_lt);\r\n                } else {\r\n                    coords_rb = Vec3.add(\r\n                        vs.scaleTo(1 - vi_x / insideSize),\r\n                        ve.scaleTo(1 - vi_y / insideSize)\r\n                    ).addA(v_rb);\r\n                }\r\n\r\n                this._createExtentNormals();\r\n                this.setBoundingVolume3v(coords_lt, coords_rb);\r\n            }\r\n        } else {\r\n            this.createBoundsByExtent();\r\n        }\r\n    }\r\n\r\n    public setBoundingSphere(x: number, y: number, z: number, v: Vec3) {\r\n        this.bsphere.center.x = x;\r\n        this.bsphere.center.y = y;\r\n        this.bsphere.center.z = z;\r\n        this.bsphere.radius = this.bsphere.center.distance(v);\r\n    }\r\n\r\n    public setBoundingVolume(xmin: number, ymin: number, zmin: number, xmax: number, ymax: number, zmax: number) {\r\n        this.bbox.setFromBoundsArr([xmin, ymin, zmin, xmax, ymax, zmax]);\r\n\r\n        let x = xmin + (xmax - xmin) * 0.5,\r\n            y = ymin + (ymax - ymin) * 0.5,\r\n            z = zmin + (zmax - zmin) * 0.5;\r\n\r\n        this.bsphere.center.set(x, y, z);\r\n        this.bsphere.radius = this.bsphere.center.distance(new Vec3(xmin, ymin, zmin));\r\n    }\r\n\r\n    public setBoundingVolume3v(vmin: Vec3, vmax: Vec3) {\r\n        this.bbox.setFromBoundsArr([vmin.x, vmin.y, vmin.z, vmax.x, vmax.y, vmax.z]);\r\n\r\n        let x = vmin.x + (vmax.x - vmin.x) * 0.5,\r\n            y = vmin.y + (vmax.y - vmin.y) * 0.5,\r\n            z = vmin.z + (vmax.z - vmin.z) * 0.5;\r\n\r\n        this.bsphere.center.set(x, y, z);\r\n        this.bsphere.radius = this.bsphere.center.distance(new Vec3(vmin.x, vmin.y, vmin.z));\r\n    }\r\n\r\n    public setBoundingVolumeArr(bounds: NumberArray6) {\r\n        this.bbox.setFromBoundsArr(bounds);\r\n\r\n        let x = bounds[0] + (bounds[3] - bounds[0]) * 0.5,\r\n            y = bounds[1] + (bounds[4] - bounds[1]) * 0.5,\r\n            z = bounds[2] + (bounds[5] - bounds[2]) * 0.5;\r\n\r\n        this.bsphere.center.set(x, y, z);\r\n        this.bsphere.radius = this.bsphere.center.distance(\r\n            new Vec3(bounds[0], bounds[1], bounds[2])\r\n        );\r\n    }\r\n\r\n    public createCoordsBuffers(verticesHigh: Float32Array, verticesLow: Float32Array, gridSize: number) {\r\n        const gsgs = (gridSize + 1) * (gridSize + 1);\r\n        const h = this.handler;\r\n\r\n        if (this.vertexPositionBufferHigh && this.vertexPositionBufferHigh.numItems === gsgs) {\r\n            h.setStreamArrayBuffer(this.vertexPositionBufferHigh!, verticesHigh);\r\n            h.setStreamArrayBuffer(this.vertexPositionBufferLow!, verticesLow);\r\n        } else {\r\n            h.gl!.deleteBuffer(this.vertexPositionBufferHigh!);\r\n            h.gl!.deleteBuffer(this.vertexPositionBufferLow!);\r\n\r\n            this.vertexTextureCoordBuffer = this.planet._textureCoordsBufferCache[Math.log2(gridSize)];\r\n\r\n            // @todo use it!\r\n            //this.vertexPositionBufferHigh = h.createStreamArrayBuffer(3, gsgs);\r\n            //h.setStreamArrayBuffer(this.vertexPositionBufferHigh, verticesHigh);\r\n            //this.vertexPositionBufferLow = h.createStreamArrayBuffer(3, gsgs);\r\n            //h.setStreamArrayBuffer(this.vertexPositionBufferLow, verticesLow);\r\n\r\n            // It works, but I'm not sure that it is correct and better use the comment above\r\n            this.vertexPositionBufferHigh = h.createArrayBuffer(verticesHigh, 3, gsgs);\r\n            this.vertexPositionBufferLow = h.createArrayBuffer(verticesLow, 3, gsgs);\r\n        }\r\n    }\r\n\r\n    public _addViewExtent() {\r\n        const ext = this._extentLonLat;\r\n\r\n        let viewExt = this.planet._viewExtent;\r\n\r\n        if (ext.southWest.lon < viewExt.southWest.lon) {\r\n            viewExt.southWest.lon = ext.southWest.lon;\r\n        }\r\n\r\n        if (ext.northEast.lon > viewExt.northEast.lon) {\r\n            viewExt.northEast.lon = ext.northEast.lon;\r\n        }\r\n\r\n        if (ext.southWest.lat < viewExt.southWest.lat) {\r\n            viewExt.southWest.lat = ext.southWest.lat;\r\n        }\r\n\r\n        if (ext.northEast.lat > viewExt.northEast.lat) {\r\n            viewExt.northEast.lat = ext.northEast.lat;\r\n        }\r\n    }\r\n\r\n    protected _assignTileIndexes() {\r\n\r\n        this._tileGroup = TILEGROUP_COMMON;\r\n\r\n        const tileZoom = this.tileZoom;\r\n        const extent = this._extent;\r\n        const pole = mercator.POLE;\r\n\r\n        // this.tileX = Math.round(Math.abs(-pole - extent.southWest.lon) / (extent.northEast.lon - extent.southWest.lon));\r\n        // this.tileY = Math.round(Math.abs(pole - extent.northEast.lat) / (extent.northEast.lat - extent.southWest.lat));\r\n        this.tileX = getTileCellIndex(extent.getCenter().lon, extent.getWidth(), -pole);\r\n        this.tileY = getTileCellIndex(extent.getCenter().lat, extent.getHeight(), pole);\r\n\r\n        const p2 = this.powTileZoom;//Math.pow(2, tileZoom);\r\n\r\n        this.tileXE = (this.tileX + 1) % p2;\r\n        this.tileXW = (p2 + this.tileX - 1) % p2;\r\n\r\n        this.tileYN = this.tileY - 1;\r\n        this.tileYS = this.tileY + 1;\r\n\r\n        this.tileIndex = Layer.getTileIndex(this.tileX, this.tileY, tileZoom, this._tileGroup);\r\n    }\r\n\r\n    public initialize() {\r\n        const p = this.planet;\r\n        const n = this.node;\r\n\r\n        this.gridSize = p.terrain!.gridSizeByZoom[this.tileZoom] || p.terrain!.plainGridSize;\r\n\r\n        n.sideSizeLog2[0] = n.sideSizeLog2[1] = n.sideSizeLog2[2] = n.sideSizeLog2[3] = Math.log2(this.gridSize);\r\n\r\n        if (this.tileZoom <= p.terrain!.maxZoom) {\r\n            const nmc = this.planet._normalMapCreator;\r\n            this.normalMapTexturePtr = p.renderer!.handler.createEmptyTexture_l(nmc.width, nmc.height);\r\n        }\r\n\r\n        this.normalMapTexture = this.planet.transparentTexture;\r\n\r\n        this._assignGlobalTextureCoordinates();\r\n\r\n        this.initialized = true;\r\n    }\r\n\r\n    protected _assignGlobalTextureCoordinates() {\r\n        const e = this._extent;\r\n        this._globalTextureCoordinates[0] =\r\n            (e.southWest.lon + mercator.POLE) * mercator.ONE_BY_POLE_DOUBLE;\r\n        this._globalTextureCoordinates[1] =\r\n            (mercator.POLE - e.northEast.lat) * mercator.ONE_BY_POLE_DOUBLE;\r\n        this._globalTextureCoordinates[2] =\r\n            (e.northEast.lon + mercator.POLE) * mercator.ONE_BY_POLE_DOUBLE;\r\n        this._globalTextureCoordinates[3] =\r\n            (mercator.POLE - e.southWest.lat) * mercator.ONE_BY_POLE_DOUBLE;\r\n    }\r\n\r\n    public createPlainSegmentAsync() {\r\n        let p = this.planet,\r\n            t = p.terrain!;\r\n\r\n        if (t.isReady() && !this.plainReady && this.tileZoom <= t.maxZoom) {\r\n            this.plainProcessing = true;\r\n            p._plainSegmentWorker.make(this);\r\n        }\r\n    }\r\n\r\n    public _plainSegmentWorkerCallback(data: IPlainSegmentWorkerData) {\r\n        this.plainProcessing = false;\r\n\r\n        if (this.initialized && !this.terrainReady) {\r\n            this.plainReady = true;\r\n\r\n            this.plainVertices = data.plainVertices;\r\n            this.plainVerticesHigh = data.plainVerticesHigh;\r\n            this.plainVerticesLow = data.plainVerticesLow;\r\n            this.plainNormals = data.plainNormals;\r\n            this._plainRadius = data.plainRadius;\r\n\r\n            this.normalMapNormals = data.normalMapNormals;\r\n            this.normalMapVertices = data.normalMapVertices;\r\n            this.normalMapVerticesHigh = data.normalMapVerticesHigh;\r\n            this.normalMapVerticesLow = data.normalMapVerticesLow;\r\n\r\n            //this.terrainVertices = this.plainVertices;\r\n            //this.terrainVerticesHigh = this.plainVerticesHigh;\r\n            //this.terrainVerticesLow = this.plainVerticesLow;\r\n\r\n            this.fileGridSize = Math.sqrt(data.normalMapVertices!.length / 3) - 1;\r\n        }\r\n    }\r\n\r\n    public createPlainSegment() {\r\n        this.initialize();\r\n        this._createPlainVertices();\r\n        this.readyToEngage = true;\r\n    }\r\n\r\n    protected _projToDeg(lon: number, lat: number): LonLat {\r\n        return LonLat.inverseMercator(lon, lat);\r\n    }\r\n\r\n    protected _createPlainVertices() {\r\n        const gridSize = this.planet.terrain!.gridSizeByZoom[this.tileZoom];\r\n        const fgs = this.planet.terrain!.plainGridSize;\r\n        const currGridSize = Math.max(fgs, gridSize);\r\n        const e = this._extent;\r\n        const lonSize = e.getWidth();\r\n        const latSize = e.getHeight();\r\n        const llStep = lonSize / currGridSize;\r\n        const ltStep = latSize / currGridSize;\r\n        const esw_lon = e.southWest.lon;\r\n        const ene_lat = e.northEast.lat;\r\n        const dg = Math.max(fgs / gridSize, 1);\r\n        const gs = currGridSize + 1;\r\n        const r2 = this.planet.ellipsoid._invRadii2;\r\n        const gsgs = gs * gs;\r\n        const gridSize3 = (gridSize + 1) * (gridSize + 1) * 3;\r\n\r\n        let ind = 0,\r\n            nmInd = 0;\r\n\r\n        this.plainNormals = new Float32Array(gridSize3);\r\n        this.plainVertices = new Float64Array(gridSize3);\r\n        this.plainVerticesHigh = new Float32Array(gridSize3);\r\n        this.plainVerticesLow = new Float32Array(gridSize3);\r\n\r\n        this.normalMapNormals = new Float32Array(gsgs * 3);\r\n        this.normalMapVertices = new Float64Array(gsgs * 3);\r\n        this.normalMapVerticesHigh = new Float32Array(gsgs * 3);\r\n        this.normalMapVerticesLow = new Float32Array(gsgs * 3);\r\n\r\n        let verts = this.plainVertices,\r\n            vertsHigh = this.plainVerticesHigh,\r\n            vertsLow = this.plainVerticesLow,\r\n            norms = this.plainNormals,\r\n            nmVerts = this.normalMapVertices,\r\n            nmVertsHigh = this.normalMapVerticesHigh,\r\n            nmVertsLow = this.normalMapVerticesLow,\r\n            nmNorms = this.normalMapNormals;\r\n\r\n        for (let k = 0; k < gsgs; k++) {\r\n            let j = k % gs,\r\n                i = ~~(k / gs);\r\n\r\n            let v = this.planet.ellipsoid.lonLatToCartesian(\r\n                this._projToDeg(esw_lon + j * llStep, ene_lat - i * ltStep)\r\n            );\r\n\r\n            let nx = v.x * r2.x,\r\n                ny = v.y * r2.y,\r\n                nz = v.z * r2.z;\r\n\r\n            let l = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\r\n\r\n            let nxl = nx * l,\r\n                nyl = ny * l,\r\n                nzl = nz * l;\r\n\r\n            Vec3.doubleToTwoFloats(v, _tempHigh, _tempLow);\r\n\r\n            nmVerts[nmInd] = v.x;\r\n            nmVertsHigh[nmInd] = _tempHigh.x;\r\n            nmVertsLow[nmInd] = _tempLow.x;\r\n            nmNorms[nmInd++] = nxl;\r\n\r\n            nmVerts[nmInd] = v.y;\r\n            nmVertsHigh[nmInd] = _tempHigh.y;\r\n            nmVertsLow[nmInd] = _tempLow.y;\r\n            nmNorms[nmInd++] = nyl;\r\n\r\n            nmVerts[nmInd] = v.z;\r\n            nmVertsHigh[nmInd] = _tempHigh.z;\r\n            nmVertsLow[nmInd] = _tempLow.z;\r\n            nmNorms[nmInd++] = nzl;\r\n\r\n            if (i % dg === 0 && j % dg === 0) {\r\n                verts[ind] = v.x;\r\n                vertsHigh[ind] = _tempHigh.x;\r\n                vertsLow[ind] = _tempLow.x;\r\n                norms[ind++] = nxl;\r\n\r\n                verts[ind] = v.y;\r\n                vertsHigh[ind] = _tempHigh.y;\r\n                vertsLow[ind] = _tempLow.y;\r\n                norms[ind++] = nyl;\r\n\r\n                verts[ind] = v.z;\r\n                vertsHigh[ind] = _tempHigh.z;\r\n                vertsLow[ind] = _tempLow.z;\r\n                norms[ind++] = nzl;\r\n            }\r\n        }\r\n\r\n        this.terrainVertices = verts;\r\n        this.terrainVerticesHigh = vertsHigh;\r\n        this.terrainVerticesLow = vertsLow;\r\n\r\n        this.plainReady = true;\r\n    }\r\n\r\n    /**\r\n     * Gets specific layer material.\r\n     * @public\r\n     * @param {Layer} layer - Layer object.\r\n     * @returns {Material | undefined} - Segment material.\r\n     */\r\n    public getMaterialByLayer(layer: Layer): Material | undefined {\r\n        return this.materials[layer.__id];\r\n    }\r\n\r\n    /**\r\n     * @param layer\r\n     * @protected\r\n     *\r\n     * @todo siplify layer._extentMerc in this.getLayerExtent(layer)\r\n     *\r\n     */\r\n\r\n    protected _getLayerExtentOffset(layer: Layer): [number, number, number, number] {\r\n        const v0s = layer._extentMerc;\r\n        const v0t = this._extent;\r\n        const sSize_x = v0s.northEast.lon - v0s.southWest.lon;\r\n        const sSize_y = v0s.northEast.lat - v0s.southWest.lat;\r\n        const dV0s_x = (v0t.southWest.lon - v0s.southWest.lon) / sSize_x;\r\n        const dV0s_y = (v0s.northEast.lat - v0t.northEast.lat) / sSize_y;\r\n        const dSize_x = (v0t.northEast.lon - v0t.southWest.lon) / sSize_x;\r\n        const dSize_y = (v0t.northEast.lat - v0t.southWest.lat) / sSize_y;\r\n        return [dV0s_x, dV0s_y, dSize_x, dSize_y];\r\n    }\r\n\r\n    public initSlice(sliceIndex: number): Slice {\r\n        let slice = this._slices[sliceIndex];\r\n\r\n        if (!slice) {\r\n            slice = this._slices[sliceIndex] = new Slice(this);\r\n        } else {\r\n            //TODO: optimization!!!\r\n            slice.layers = [];\r\n        }\r\n\r\n        return slice;\r\n    }\r\n\r\n    public screenRendering(sh: Program, layerSlice: Layer[], sliceIndex: number, defaultTexture?: WebGLTextureExt | null, isOverlay: boolean = false, forcedOpacity?: number) {\r\n        const gl = this.handler.gl!;\r\n        const sha = sh.attributes;\r\n        const shu = sh.uniforms;\r\n\r\n        const pm = this.materials;\r\n        const p = this.planet;\r\n\r\n        let currHeight, li;\r\n        if (layerSlice && layerSlice.length) {\r\n            li = layerSlice[0];\r\n            currHeight = li._height;\r\n        } else {\r\n            currHeight = 0;\r\n        }\r\n\r\n        // First always draw whole planet base layer segment with solid texture.\r\n        gl.activeTexture(gl.TEXTURE0 + p.SLICE_SIZE + 2);\r\n        gl.bindTexture(gl.TEXTURE_2D, (defaultTexture || this.getDefaultTexture())!);\r\n        gl.uniform1i(shu.defaultTexture, p.SLICE_SIZE + 2);\r\n\r\n        let n = 0,\r\n            i = 0;\r\n\r\n        let notEmpty = false;\r\n\r\n        let slice = this.initSlice(sliceIndex);\r\n\r\n        this._indexBuffer = this._getIndexBuffer();\r\n\r\n        while (li) {\r\n            if (\r\n                this.layerOverlap(li) &&\r\n                ((li._fading && li._fadingOpacity > 0.0) ||\r\n                    ((li.minZoom >= p.minCurrZoom || li.maxZoom >= p.minCurrZoom) &&\r\n                        (li.minZoom <= p.maxCurrZoom || li.maxZoom <= p.maxCurrZoom)))\r\n            ) {\r\n                notEmpty = true;\r\n\r\n                let m = pm[li.__id];\r\n\r\n                if (!m) {\r\n                    m = pm[li.__id] = li.createMaterial(this);\r\n                }\r\n\r\n                if (!m.isReady) {\r\n                    this.planet._renderCompleted = false;\r\n                }\r\n\r\n                slice.append(li, m);\r\n\r\n                p._samplerArr[n] = n;\r\n\r\n                gl.activeTexture(gl.TEXTURE0 + n);\r\n                gl.bindTexture(gl.TEXTURE_2D, (m.texture || p.transparentTexture)!);\r\n\r\n                n++;\r\n            }\r\n            i++;\r\n            li = layerSlice[i];\r\n        }\r\n\r\n        if (notEmpty || !isOverlay) {\r\n\r\n            gl.uniform1f(shu.transitionOpacity, forcedOpacity || this._transitionOpacity > 1.0 ? 1.0 : this._transitionOpacity);\r\n\r\n            gl.uniform1i(shu.samplerCount, n);\r\n            gl.uniform1f(shu.height, currHeight);\r\n            gl.uniform1iv(shu.samplerArr, p._samplerArr);\r\n\r\n            //slice.uniform(gl, shu);\r\n\r\n            gl.uniform4fv(shu.tileOffsetArr, slice.tileOffsetArr);\r\n            gl.uniform1fv(shu.layerOpacityArr, slice.layerOpacityArr);\r\n            //gl.uniform4fv(shu.visibleExtentOffsetArr, slice.visibleExtentOffsetArr);\r\n\r\n            // bind normalmap texture\r\n            if (p.lightEnabled) {\r\n                gl.activeTexture(gl.TEXTURE0 + p.SLICE_SIZE + 3);\r\n                gl.bindTexture(gl.TEXTURE_2D, (this.normalMapTexture || p.transparentTexture)!);\r\n                gl.uniform1i(shu.uNormalMap, p.SLICE_SIZE + 3);\r\n\r\n                gl.uniform3fv(shu.uNormalMapBias, this.normalMapTextureBias);\r\n\r\n                // bind segment specular and night material texture coordinates\r\n                gl.uniform4fv(shu.uGlobalTextureCoord, this._globalTextureCoordinates);\r\n            }\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh!);\r\n            gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh!.itemSize, gl.FLOAT, false, 0, 0);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow!);\r\n            gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexTextureCoordBuffer!);\r\n            gl.vertexAttribPointer(sha.aTextureCoord, 2, gl.UNSIGNED_SHORT, true, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\r\n            gl.drawElements(p.drawMode, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\r\n        }\r\n    }\r\n\r\n    public heightPickingRendering(sh: Program, layerSlice: Layer[]) {\r\n        const gl = this.handler.gl!;\r\n        const sha = sh.attributes;\r\n        const shu = sh.uniforms;\r\n\r\n        // var pm = this.materials,\r\n        //     p = this.planet;\r\n\r\n        let currHeight;\r\n        if (layerSlice && layerSlice.length) {\r\n            currHeight = layerSlice[0]._height;\r\n        } else {\r\n            currHeight = 0;\r\n        }\r\n\r\n        gl.uniform1f(shu.height, currHeight);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh!);\r\n        gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow!);\r\n        gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer!);\r\n        gl.drawElements(gl.TRIANGLE_STRIP, this._indexBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n    }\r\n\r\n    public increaseTransitionOpacity() {\r\n        //this._transitionOpacity += 0.01;\r\n        this._transitionOpacity += (window.performance.now() - this._transitionTimestamp) / this.planet.transitionTime;\r\n        this._transitionTimestamp = window.performance.now();\r\n        if (this._transitionOpacity > 2.0) {\r\n            this._transitionOpacity = 2.0;\r\n        }\r\n\r\n        let i = this.node._fadingNodes.length;\r\n        while (i--) {\r\n            let n = this.node._fadingNodes[i];\r\n            if (n.segment) {\r\n                if (n.segment._transitionOpacity > 0 && !this.planet._fadingNodes.has(n.__id)) {\r\n                    this.planet._fadingNodes.set(n.__id, n);\r\n                    n.segment._transitionOpacity = 2.0 - this._transitionOpacity;\r\n                    if (n.segment._transitionOpacity === 0) {\r\n                        this.node._fadingNodes.splice(i, 1);\r\n                    }\r\n                }\r\n            } else {\r\n                this._transitionOpacity = 1.0;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    public fadingTransitionOpacity() {\r\n        this._transitionOpacity -= 0.01;\r\n        // this._transitionOpacity -= (window.performance.now() - this._transitionTimestamp) / this.planet.transitionTime;\r\n        this._transitionTimestamp = window.performance.now();\r\n        if (this._transitionOpacity < 0.0) {\r\n            this._transitionOpacity = 0;\r\n        }\r\n    }\r\n\r\n    public colorPickingRendering(sh: Program, layerSlice: Layer[], sliceIndex: number, defaultTexture?: WebGLTextureExt | null, isOverlay: boolean = false) {\r\n        const gl = this.handler.gl!;\r\n        const sha = sh.attributes;\r\n        const shu = sh.uniforms;\r\n\r\n        let pm = this.materials,\r\n            p = this.planet;\r\n\r\n        let currHeight;\r\n        if (layerSlice && layerSlice.length) {\r\n            currHeight = layerSlice[0]._height;\r\n        } else {\r\n            currHeight = 0;\r\n        }\r\n\r\n        let notEmpty = false;\r\n\r\n        let slice = this._slices[sliceIndex];\r\n\r\n        let len = slice.layers.length;\r\n\r\n        for (let n = 0; n < len; n++) {\r\n            notEmpty = true;\r\n\r\n            let li = slice.layers[n];\r\n            let n4 = n * 4;\r\n\r\n            p._pickingColorArr[n4] = li._pickingColor.x / 255.0;\r\n            p._pickingColorArr[n4 + 1] = li._pickingColor.y / 255.0;\r\n            p._pickingColorArr[n4 + 2] = li._pickingColor.z / 255.0;\r\n            p._pickingColorArr[n4 + 3] = Number(li._pickingEnabled);\r\n\r\n            p._samplerArr[n] = n;\r\n            gl.activeTexture(gl.TEXTURE0 + n);\r\n            gl.bindTexture(gl.TEXTURE_2D, (pm[li.__id].texture || this.planet.transparentTexture)!);\r\n\r\n            p._pickingMaskArr[n] = n + p.SLICE_SIZE;\r\n            gl.activeTexture(gl.TEXTURE0 + n + p.SLICE_SIZE);\r\n            gl.bindTexture(gl.TEXTURE_2D, (pm[li.__id].pickingMask || this.planet.transparentTexture)!);\r\n        }\r\n\r\n        if (notEmpty || !isOverlay) {\r\n            gl.uniform1i(shu.samplerCount, len);\r\n            gl.uniform1f(shu.height, currHeight);\r\n            gl.uniform1iv(shu.samplerArr, p._samplerArr);\r\n            gl.uniform1iv(shu.pickingMaskArr, p._pickingMaskArr);\r\n            gl.uniform4fv(shu.pickingColorArr, p._pickingColorArr);\r\n\r\n            //slice.uniform(gl, shu);\r\n\r\n            gl.uniform4fv(shu.tileOffsetArr, slice.tileOffsetArr);\r\n            gl.uniform1fv(shu.layerOpacityArr, slice.layerOpacityArr);\r\n            //gl.uniform4fv(shu.visibleExtentOffsetArr, slice.visibleExtentOffsetArr);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh!);\r\n            gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh!.itemSize, gl.FLOAT, false, 0, 0);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow!);\r\n            gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexTextureCoordBuffer!);\r\n            gl.vertexAttribPointer(sha.aTextureCoord, 2, gl.UNSIGNED_SHORT, true, 0, 0);\r\n\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer!);\r\n            gl.drawElements(gl.TRIANGLE_STRIP, this._indexBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n        }\r\n    }\r\n\r\n    public depthRendering(sh: Program, layerSlice?: Layer[]) {\r\n        const gl = this.handler.gl!;\r\n        const sha = sh.attributes;\r\n        const shu = sh.uniforms;\r\n\r\n        var currHeight;\r\n        if (layerSlice && layerSlice.length) {\r\n            currHeight = layerSlice[0]._height;\r\n        } else {\r\n            currHeight = 0;\r\n        }\r\n\r\n        gl.uniform1f(shu.height, currHeight);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh!);\r\n        gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow!);\r\n        gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer!);\r\n        gl.drawElements(gl.TRIANGLE_STRIP, this._indexBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n    }\r\n\r\n    protected _getIndexBuffer(): WebGLBufferExt {\r\n        const s = this.node.sideSizeLog2;\r\n        let cache = this.planet._indexesCache[Math.log2(this.gridSize)][s[0]][s[1]][s[2]][s[3]];\r\n        if (!cache.buffer) {\r\n            let indexes = segmentHelper.getInstance().createSegmentIndexes(Math.log2(this.gridSize), [s[0], s[1], s[2], s[3]]);\r\n            cache.buffer = this.planet.renderer!.handler.createElementArrayBuffer(indexes, 1);\r\n            this.planet._indexesCacheToRemoveCounter++;\r\n        }\r\n        return cache.buffer;\r\n    }\r\n\r\n    public layerOverlap(layer: Layer): boolean {\r\n        return this._extent.overlaps(layer._extentMerc);\r\n    }\r\n\r\n    public getDefaultTexture(): WebGLTextureExt | null {\r\n        return this.planet.solidTextureOne;\r\n    }\r\n\r\n    public getExtentLonLat(): Extent {\r\n        return this._extentLonLat;\r\n    }\r\n\r\n    public getExtentMerc(): Extent {\r\n        return this._extentMerc;\r\n    }\r\n\r\n    public getExtent(): Extent {\r\n        return this._extent;\r\n    }\r\n\r\n    public getNeighborSide(b: Segment) {\r\n        if (this.tileY === b.tileY) {\r\n            if (this.tileX === b.tileXE) {\r\n                return W;\r\n            } else if (this.tileX === b.tileXW) {\r\n                return E;\r\n            }\r\n        } else if (this.tileX === b.tileX) {\r\n            if (this.tileY === b.tileYS) {\r\n                return N;\r\n            } else if (this.tileY === b.tileYN) {\r\n                return S;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n}\r\n\r\nexport {Segment};","import {Extent} from \"../Extent\";\r\nimport {EPSG3857} from \"../proj/EPSG3857\";\r\nimport {EPSG4326} from \"../proj/EPSG4326\";\r\nimport {binaryInsert, getMatrixSubArray32, getMatrixSubArray64, getMatrixSubArrayBoundsExt} from \"../utils/shared\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {MAX, MIN} from \"../math\";\r\nimport {MAX_LAT} from \"../mercator\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Segment} from \"../segment/Segment\";\r\n\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {\r\n    E,\r\n    MAX_RENDERED_NODES,\r\n    N,\r\n    NE,\r\n    NEIGHBOUR,\r\n    NOTRENDERING,\r\n    NW,\r\n    OPPART,\r\n    OPSIDE,\r\n    PARTOFFSET,\r\n    RENDERING,\r\n    S,\r\n    SE,\r\n    SW,\r\n    W,\r\n    WALKTHROUGH\r\n} from \"./quadTree\";\r\n\r\nimport {\r\n    TILEGROUP_COMMON,\r\n    TILEGROUP_NORTH,\r\n    TILEGROUP_SOUTH\r\n} from \"../segment/Segment\";\r\n\r\nimport {PlanetCamera} from \"../camera/PlanetCamera\";\r\n\r\nlet _tempHigh = new Vec3(),\r\n    _tempLow = new Vec3();\r\n\r\nconst _vertOrder: Vec2[] = [\r\n    new Vec2(0, 0), new Vec2(1, 0),\r\n    new Vec2(0, 1), new Vec2(1, 1)\r\n];\r\n\r\nconst _neGridSize = Math.sqrt(_vertOrder.length) - 1;\r\n\r\ntype BoundsType = {\r\n    xmin: number; ymin: number; zmin: number;\r\n    xmax: number; ymax: number; zmax: number\r\n};\r\n\r\nlet BOUNDS: BoundsType = {\r\n    xmin: 0.0, ymin: 0.0, zmin: 0.0,\r\n    xmax: 0.0, ymax: 0.0, zmax: 0.0\r\n};\r\n\r\nlet __staticCounter = 0;\r\n\r\n/**\r\n * Quad tree planet segment node.\r\n * @constructor\r\n * @param {Segment} segmentPrototype - Planet segment node constructor.\r\n * @param {Planet} planet - Planet scene instance.\r\n * @param {number} partId - NorthEast, SouthWest etc.\r\n * @param {Node} parent - Parent of this node.\r\n * @param {number} id - Tree node identifier (id * 4 + 1);\r\n * @param {number} tileZoom - Deep index of the quad tree.\r\n * @param {Extent} extent - Planet segment extent.\r\n */\r\nclass Node {\r\n    public __id: number;\r\n    public SegmentPrototype: typeof Segment;\r\n    public planet: Planet;\r\n    public parentNode: Node | null;\r\n    public partId: number;\r\n    public nodeId: number;\r\n    public state: number | null;\r\n    public prevState: number | null;\r\n    public appliedTerrainNodeId: number;\r\n    public sideSizeLog2: [number, number, number, number];\r\n    public ready: boolean;\r\n    public neighbors: [Node[], Node[], Node[], Node[]];\r\n    public equalizedSideWithNodeId: number[];\r\n    public nodes: [Node, Node, Node, Node] | [];\r\n    public segment: Segment;\r\n    public _cameraInside: boolean;\r\n    public inFrustum: number;\r\n    public _fadingNodes: Node[];\r\n\r\n    constructor(\r\n        SegmentPrototype: typeof Segment,\r\n        planet: Planet,\r\n        partId: number,\r\n        parent: Node | null,\r\n        tileZoom: number,\r\n        extent: Extent\r\n    ) {\r\n        planet._createdNodesCount++;\r\n\r\n        this.__id = __staticCounter++;\r\n\r\n        this.SegmentPrototype = SegmentPrototype;\r\n        this.planet = planet;\r\n        this.parentNode = parent;\r\n        this.partId = partId;\r\n        this.nodeId = partId + (parent ? parent.nodeId * 4 + 1 : 0);\r\n        this.state = null;\r\n        this.prevState = null;\r\n        this.appliedTerrainNodeId = -1;\r\n        this.sideSizeLog2 = [0, 0, 0, 0];\r\n        this.ready = false;\r\n        this.neighbors = [[], [], [], []];\r\n        this.equalizedSideWithNodeId = [this.nodeId, this.nodeId, this.nodeId, this.nodeId];\r\n        // @todo: this.nodes = null;\r\n        this.nodes = [];\r\n        this.segment = new SegmentPrototype(this, planet, tileZoom, extent);\r\n        this._cameraInside = false;\r\n        this.inFrustum = 0;\r\n        this._fadingNodes = [];\r\n        this.createBounds();\r\n    }\r\n\r\n    public createChildNodes() {\r\n        this.ready = true;\r\n        const p = this.planet;\r\n        const ps = this.segment;\r\n        const ext = ps._extent;\r\n        const z = ps.tileZoom + 1;\r\n        const size_x = ext.getWidth() * 0.5;\r\n        const size_y = ext.getHeight() * 0.5;\r\n        const ne = ext.northEast;\r\n        const sw = ext.southWest;\r\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\r\n        const nd = this.nodes;\r\n\r\n        nd[NW] = new Node(this.SegmentPrototype, p, NW, this, z, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)));\r\n        nd[NE] = new Node(this.SegmentPrototype, p, NE, this, z, new Extent(c, new LonLat(ne.lon, ne.lat)));\r\n        nd[SW] = new Node(this.SegmentPrototype, p, SW, this, z, new Extent(new LonLat(sw.lon, sw.lat), c));\r\n        nd[SE] = new Node(this.SegmentPrototype, p, SE, this, z, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)));\r\n    }\r\n\r\n    public createBounds() {\r\n\r\n        let seg = this.segment;\r\n\r\n        seg._setExtentLonLat();\r\n\r\n        if (seg.tileZoom === 0) {\r\n            seg.setBoundingSphere(0.0, 0.0, 0.0, new Vec3(0.0, 0.0, seg.planet.ellipsoid.equatorialSize));\r\n        } else if (seg.tileZoom < seg.planet.terrain!.minZoom) {\r\n            seg.createBoundsByExtent();\r\n        } else {\r\n            seg.createBoundsByParent();\r\n        }\r\n\r\n        let x = seg.bsphere.center.x,\r\n            y = seg.bsphere.center.y,\r\n            z = seg.bsphere.center.z;\r\n\r\n        let length = 1.0 / Math.sqrt(x * x + y * y + z * z);\r\n        seg.centerNormal.x = x * length;\r\n        seg.centerNormal.y = y * length;\r\n        seg.centerNormal.z = z * length;\r\n    }\r\n\r\n    public getState(): number | null {\r\n        if (this.state === -1) {\r\n            return this.state;\r\n        }\r\n        let pn = this.parentNode;\r\n        while (pn) {\r\n            if (pn.state !== WALKTHROUGH) {\r\n                return NOTRENDERING;\r\n            }\r\n            pn = pn.parentNode;\r\n        }\r\n        return this.state;\r\n    }\r\n\r\n    /**\r\n     * Returns the same deep existent neighbour node.\r\n     * @public\r\n     * @param {number} side - Neighbour side index e.g. og.quadTree.N, og.quadTree.W etc.\r\n     * @returns {Node} -\r\n     */\r\n    public getEqualNeighbor(side: number): Node | undefined {\r\n        let pn: Node = this;\r\n        let part = NEIGHBOUR[side][pn.partId];\r\n        if (part !== -1) {\r\n            // (!) it means that we would never ask to get head node neighbors\r\n            return pn.parentNode!.nodes[part];\r\n        } else {\r\n            let pathId = [];\r\n            while (pn.parentNode) {\r\n                pathId.push(pn.partId);\r\n                part = NEIGHBOUR[side][pn.partId];\r\n                pn = pn.parentNode;\r\n                if (part !== -1) {\r\n                    let i = pathId.length;\r\n                    side = OPSIDE[side];\r\n                    while (pn && i--) {\r\n                        part = OPPART[side][pathId[i]];\r\n                        pn = pn.nodes[part];\r\n                    }\r\n                    return pn;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // public isBrother(node: Node): boolean {\r\n    //     return !(this.parentNode || node.parentNode) || (this.parentNode!.nodeId === node.parentNode!.nodeId);\r\n    // }\r\n\r\n    public traverseNodes(cam: PlanetCamera, maxZoom?: number | null, terrainReadySegment?: Segment | null, stopLoading?: boolean, zoomPassNode?: Node) {\r\n        if (!this.ready) {\r\n            this.createChildNodes();\r\n        }\r\n\r\n        let n = this.nodes;\r\n\r\n        n[0]!.renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\r\n        n[1]!.renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\r\n        n[2]!.renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\r\n        n[3]!.renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\r\n    }\r\n\r\n    public renderTree(cam: PlanetCamera, maxZoom?: number | null, terrainReadySegment?: Segment | null, stopLoading?: boolean, zoomPassNode?: Node) {\r\n        if (this.planet._renderedNodes.length >= MAX_RENDERED_NODES) {\r\n            return;\r\n        }\r\n\r\n        if (!maxZoom || zoomPassNode && this.segment.tileZoom > zoomPassNode.segment.tileZoom) {\r\n            this.prevState = this.state;\r\n        }\r\n        this.state = WALKTHROUGH;\r\n\r\n        this.clearNeighbors();\r\n\r\n        let seg = this.segment,\r\n            planet = this.planet;\r\n\r\n        this._cameraInside = false;\r\n\r\n        // Search a node which the camera is flying over.\r\n        if (!this.parentNode || this.parentNode._cameraInside) {\r\n            let inside;\r\n            if (/*Math.abs(cam._lonLat.lat) <= MAX_LAT && */seg._projection.id === EPSG3857.id) {\r\n                inside = seg._extent.isInside(cam._lonLatMerc);\r\n            } else /*if (seg._projection.id === EPSG4326.id)*/ {\r\n                inside = seg._extent.isInside(cam._lonLat);\r\n            }\r\n\r\n            if (inside) {\r\n                cam._insideSegment = seg;\r\n                this._cameraInside = true;\r\n            }\r\n        }\r\n\r\n        this.inFrustum = 0;\r\n\r\n        let frustums = cam.frustums, numFrustums = frustums.length;\r\n\r\n        if (seg.tileZoom < 6) {\r\n            for (let i = 0; i < numFrustums; i++) {\r\n                if (frustums[i].containsSphere(seg.bsphere)) {\r\n                    this.inFrustum |= 1 << i;\r\n                }\r\n            }\r\n        } else {\r\n            for (let i = 0; i < numFrustums; i++) {\r\n                if (seg.terrainReady) {\r\n                    if (frustums[i].containsBox(seg.bbox)) {\r\n                        this.inFrustum |= 1 << i;\r\n                    }\r\n                } else {\r\n                    if (frustums[i].containsSphere(seg.bsphere)) {\r\n                        this.inFrustum |= 1 << i;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.inFrustum || this._cameraInside || seg.tileZoom < 3) {\r\n            let h = Math.abs(cam._lonLat.height);\r\n\r\n            let horizonDist = cam.eye.length2() - planet.ellipsoid.polarSizeSqr;\r\n            horizonDist = horizonDist < 106876472875.63281 * planet._heightFactor ? 106876472875.63281 * planet._heightFactor : horizonDist;\r\n\r\n            let altVis = seg.tileZoom < 2 || seg.tileZoom > 19 ||\r\n                /* Could be replaced with camera frustum always looking down check,\r\n                and not to go through nodes from the opposite of the globe*/\r\n                (seg.tileZoom < 6 && !seg.terrainReady);\r\n\r\n            altVis = altVis ||\r\n                cam.eye.distance2(seg._sw) < horizonDist ||\r\n                cam.eye.distance2(seg._nw) < horizonDist ||\r\n                cam.eye.distance2(seg._ne) < horizonDist ||\r\n                cam.eye.distance2(seg._se) < horizonDist;\r\n\r\n            if ((this.inFrustum && (altVis || h > 10000.0)) || this._cameraInside) {\r\n                planet.quadTreeStrategy.collectVisibleNode(this);\r\n            }\r\n\r\n            if (seg.tileZoom < 2) {\r\n                this.traverseNodes(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\r\n            } else if (\r\n                seg.terrainReady && (!maxZoom && cam.projectedSize(seg.bsphere.center, seg._plainRadius) < planet.lodSize\r\n                    || maxZoom && ((seg.tileZoom === maxZoom) || !altVis))\r\n            ) {\r\n\r\n                if (altVis) {\r\n                    seg.passReady = true;\r\n                    this.renderNode(this.inFrustum, !this.inFrustum, terrainReadySegment, stopLoading);\r\n                } else {\r\n                    this.state = NOTRENDERING;\r\n                }\r\n\r\n            } else if (seg.terrainReady && seg.checkZoom() && (!maxZoom || cam.projectedSize(seg.bsphere.center, seg.bsphere.radius) > this.planet._maxLodSize)) {\r\n                this.traverseNodes(cam, maxZoom, seg, stopLoading, zoomPassNode);\r\n            } else if (altVis) {\r\n                seg.passReady = maxZoom ? seg.terrainReady : false;\r\n                this.renderNode(this.inFrustum, !this.inFrustum, terrainReadySegment, stopLoading);\r\n            } else {\r\n                this.state = NOTRENDERING;\r\n            }\r\n        } else {\r\n            this.state = NOTRENDERING;\r\n        }\r\n    }\r\n\r\n    public renderNode(inFrustum: number, onlyTerrain?: boolean, terrainReadySegment?: Segment | null, stopLoading?: boolean) {\r\n        let seg = this.segment;\r\n\r\n        // Create and load terrain data\r\n        if (!seg.terrainReady) {\r\n            if (!seg.initialized) {\r\n                seg.initialize();\r\n            }\r\n\r\n            this.whileTerrainLoading(terrainReadySegment);\r\n\r\n            if (!seg.plainProcessing) {\r\n                seg.createPlainSegmentAsync();\r\n            }\r\n\r\n            if (seg.plainReady && !stopLoading) {\r\n                seg.loadTerrain();\r\n            }\r\n        }\r\n\r\n        // Create normal map texture\r\n        if (seg.planet.lightEnabled && !seg.normalMapReady) {\r\n            this.whileNormalMapCreating();\r\n        }\r\n\r\n        if (onlyTerrain) {\r\n            this.state = -1;\r\n            return;\r\n        }\r\n\r\n        // Calculate minimal and maximal zoom index on the screen\r\n        if (!this._cameraInside && seg.tileZoom > this.planet.maxCurrZoom) {\r\n            this.planet.maxCurrZoom = seg.tileZoom;\r\n        }\r\n\r\n        if (seg.tileZoom < this.planet.minCurrZoom) {\r\n            this.planet.minCurrZoom = seg.tileZoom;\r\n        }\r\n\r\n        seg._addViewExtent();\r\n\r\n        // Finally this node proceeds to rendering.\r\n        this.addToRender(inFrustum);\r\n    }\r\n\r\n    public childrenPrevStateEquals(state: number): boolean {\r\n        let n = this.nodes;\r\n        return n.length === 4 && n[0].prevState === state && n[1].prevState === state && n[2].prevState === state && n[3].prevState === state;\r\n    }\r\n\r\n    public isFading(): boolean {\r\n        let n = this.nodes;\r\n        return this.state === WALKTHROUGH && this.segment._transitionOpacity > 0.0 && n.length === 4 && (n[0].state === RENDERING && n[1].state === RENDERING && n[2].state === RENDERING && n[3].state === RENDERING);\r\n    }\r\n\r\n    public _collectFadingNodes() {\r\n\r\n        if (this.segment.tileZoom < 3) {\r\n            this.segment._transitionOpacity = 1.0;\r\n            return;\r\n        }\r\n\r\n        // Light up the node\r\n        if (this.prevState !== RENDERING) {\r\n\r\n            // means that the node is lighting up\r\n            this.segment._transitionOpacity = 0.0;\r\n\r\n            // store fading nodes, could be a parent or children nodes\r\n            this._fadingNodes = [];\r\n\r\n            let timestamp = window.performance.now();\r\n            this.segment._transitionTimestamp = timestamp;\r\n\r\n            if (this.parentNode) {\r\n                // Parent was visible the last frame, make the parent fading\r\n                if (this.parentNode.prevState === RENDERING) {\r\n\r\n                    let pn: Node | null = this.parentNode.parentNode;\r\n                    while (pn) {\r\n                        if (pn.isFading()) {\r\n                            for (let i = 0; i < pn.nodes.length; i++) {\r\n                                pn.nodes[i].segment._transitionOpacity = 1.0;\r\n                                pn.nodes[i]._fadingNodes = [];\r\n                            }\r\n                            pn.segment._transitionOpacity = 0.0;\r\n                            break;\r\n                        }\r\n                        pn = pn.parentNode;\r\n                    }\r\n\r\n                    // not sure it's necessary here\r\n                    this.parentNode.whileTerrainLoading();\r\n\r\n                    this._fadingNodes.push(this.parentNode);\r\n                    this.parentNode.segment._transitionOpacity = 2.0;\r\n                    this.parentNode.segment._transitionTimestamp = timestamp;\r\n                } else {\r\n                    // Check if the children were visible last frame, and make them fading\r\n                    if (this.segment.childrenInitialized() && this.childrenPrevStateEquals(RENDERING)) {\r\n                        for (let i = 0; i < this.nodes.length; i++) {\r\n                            let ni = this.nodes[i];\r\n\r\n                            // not sure it's necessary here\r\n                            ni.whileTerrainLoading();\r\n\r\n                            this._fadingNodes.push(ni);\r\n                            ni.segment._transitionOpacity = 2.0;\r\n                            ni.segment._transitionTimestamp = timestamp;\r\n                            ni.prevState = ni.state;\r\n                            ni.state = NOTRENDERING;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public clearNeighbors() {\r\n        //this.sideSizeLog2[0] = this.sideSizeLog2[1] = this.sideSizeLog2[2] = this.sideSizeLog2[3] = Math.log2(this.segment.gridSize);\r\n        if (this.neighbors) {\r\n            // @ts-ignore\r\n            this.neighbors[0] = this.neighbors[1] = this.neighbors[2] = this.neighbors[3] = null;\r\n\r\n            this.neighbors[0] = [];\r\n            this.neighbors[1] = [];\r\n            this.neighbors[2] = [];\r\n            this.neighbors[3] = [];\r\n        }\r\n    }\r\n\r\n    public _refreshTransitionOpacity() {\r\n        if (this._fadingNodes.length === 0) {\r\n            this.segment._transitionOpacity = 1.0;\r\n        } else {\r\n            if (this._fadingNodes.length === 4 && !this.childrenPrevStateEquals(RENDERING)) {\r\n                this.segment._transitionOpacity = 1.0;\r\n                this._fadingNodes = [];\r\n            } else {\r\n                // Looks like a bug fix for suddenly empty spaces\r\n                for (let i = 0; i < this._fadingNodes.length; i++) {\r\n                    if (this.segment._transitionOpacity < 1.0 && this._fadingNodes[i].segment._transitionOpacity === 0) {\r\n                        this._fadingNodes[i].segment._transitionOpacity = 0;\r\n                        this.segment._transitionOpacity = 1.0;\r\n                    }\r\n                }\r\n                this.segment.increaseTransitionOpacity();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Picking up current node to render processing.\r\n     * @public\r\n     */\r\n    public addToRender(inFrustum: number) {\r\n        this.state = RENDERING;\r\n\r\n        let nodes = this.planet._renderedNodes;\r\n\r\n        //@ts-ignore\r\n        if (!this.planet._transitionOpacityEnabled) {\r\n            this.getRenderedNodesNeighbors(nodes);\r\n            nodes.push(this);\r\n        } else {\r\n            //@todo: check if it's possible to get rid of the sorting when using breadth traverse tree\r\n            binaryInsert(nodes, this, (a: Node, b: Node) => {\r\n                return a.segment.tileZoom - b.segment.tileZoom;\r\n            });\r\n        }\r\n\r\n        if (!this.segment.terrainReady) {\r\n            this.planet._renderCompleted = false;\r\n            this.planet._terrainCompleted = false;\r\n        }\r\n\r\n        let k = 0,\r\n            rf = this.planet._renderedNodesInFrustum;\r\n        while (inFrustum) {\r\n            if (inFrustum & 1) {\r\n                rf[k].push(this);\r\n            }\r\n            k++;\r\n            inFrustum >>= 1;\r\n        }\r\n    }\r\n\r\n    public applyNeighbor(node: Node, side: number) {\r\n\r\n        const opcs = OPSIDE[side];\r\n\r\n        if (this.neighbors[side].length === 0 || node.neighbors[opcs].length === 0) {\r\n            const ap = this.segment;\r\n            const bp = node.segment;\r\n\r\n            const ld = ap.gridSize / (bp.gridSize * Math.pow(2, bp.tileZoom - ap.tileZoom));\r\n\r\n            let cs_size = ap.gridSize,\r\n                opcs_size = bp.gridSize;\r\n\r\n            if (ld > 1) {\r\n                cs_size = Math.ceil(ap.gridSize / ld);\r\n                opcs_size = bp.gridSize;\r\n            } else if (ld < 1) {\r\n                cs_size = ap.gridSize;\r\n                opcs_size = Math.ceil(bp.gridSize * ld);\r\n            }\r\n\r\n            this.sideSizeLog2[side] = Math.log2(cs_size);\r\n            node.sideSizeLog2[opcs] = Math.log2(opcs_size);\r\n        }\r\n\r\n        //@todo: fix dupe neighbors\r\n        this.neighbors[side].push(node);\r\n        node.neighbors[opcs].push(this);\r\n    }\r\n\r\n    /**\r\n     * Searching current node for its neighbours.\r\n     * @public\r\n     */\r\n    public getRenderedNodesNeighbors(nodes: Node[]) {\r\n\r\n        for (let i = nodes.length - 1; i >= 0; --i) {\r\n\r\n            let ni = nodes[i];\r\n            let cs = this.getCommonSide(ni);\r\n\r\n            if (cs !== -1) {\r\n                this.applyNeighbor(ni, cs);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Checking if current node has a common side with input node and return side index N, E, S or W. Otherwise returns -1.\r\n     * @param {Node} node - Input node\r\n     * @returns {number} - Node side index\r\n     */\r\n    public getCommonSide(node: Node): number {\r\n        const as = this.segment;\r\n        const bs = node.segment;\r\n\r\n        if (as.tileZoom === bs.tileZoom && as._tileGroup === bs._tileGroup) {\r\n            return as.getNeighborSide(bs);\r\n        } else {\r\n            const a = as._extentLonLat;\r\n            const b = bs._extentLonLat;\r\n\r\n            let a_ne = a.northEast, a_sw = a.southWest,\r\n                b_ne = b.northEast, b_sw = b.southWest;\r\n\r\n            let a_ne_lon = a_ne.lon, a_ne_lat = a_ne.lat,\r\n                a_sw_lon = a_sw.lon, a_sw_lat = a_sw.lat,\r\n                b_ne_lon = b_ne.lon, b_ne_lat = b_ne.lat,\r\n                b_sw_lon = b_sw.lon, b_sw_lat = b_sw.lat;\r\n\r\n            if (as._tileGroup === bs._tileGroup) {\r\n                if (a_ne_lon === b_sw_lon && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\r\n                    return E;\r\n                } else if (a_sw_lon === b_ne_lon && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\r\n                    return W;\r\n                } else if (a_ne_lat === b_sw_lat && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\r\n                    return N;\r\n                } else if (a_sw_lat === b_ne_lat && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\r\n                    return S;\r\n                }\r\n                // World edge 180 to -180\r\n                else if (bs.tileX === 0 && b_sw_lon === -a_ne_lon && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\r\n                    return E;\r\n                } else if (as.tileX === 0 && a_sw_lon === -b_ne_lon && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\r\n                    return W;\r\n                }\r\n            }\r\n\r\n            // @todo: replace to the default strategy\r\n            if (as._tileGroup === TILEGROUP_COMMON && bs._tileGroup === TILEGROUP_NORTH && as.tileY === 0 && bs.tileY === bs.powTileZoom/*Math.pow(2, bs.tileZoom)*/ - 1 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\r\n                return N;\r\n            } else if (as._tileGroup === TILEGROUP_COMMON && bs._tileGroup === TILEGROUP_SOUTH && as.tileY === as.powTileZoom/*Math.pow(2, as.tileZoom)*/ - 1 && bs.tileY === 0 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\r\n                return S;\r\n            } else if (as._tileGroup === TILEGROUP_SOUTH && bs._tileGroup === TILEGROUP_COMMON && as.tileY === 0 && bs.tileY === bs.powTileZoom/*Math.pow(2, bs.tileZoom)*/ - 1 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\r\n                return N;\r\n            } else if (as._tileGroup === TILEGROUP_NORTH && bs._tileGroup === TILEGROUP_COMMON && as.tileY === as.powTileZoom/*Math.pow(2, as.tileZoom)*/ - 1 && bs.tileY === 0 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\r\n                return S;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    public whileNormalMapCreating() {\r\n\r\n        const seg = this.segment;\r\n\r\n        if (!seg.terrainIsLoading && seg.terrainExists && !seg._inTheQueue) {\r\n            seg.planet._normalMapCreator.queue(seg);\r\n        }\r\n\r\n        let pn: Node = this;\r\n        while (pn.parentNode && !pn.segment.normalMapReady) {\r\n            pn = pn.parentNode;\r\n        }\r\n\r\n        const dZ2 = 2 << (seg.tileZoom - pn.segment.tileZoom - 1);\r\n\r\n        seg.normalMapTexture = pn.segment.normalMapTexture;\r\n        seg.normalMapTextureBias[0] = seg.tileX - pn.segment.tileX * dZ2;\r\n        seg.normalMapTextureBias[1] = seg.tileY - pn.segment.tileY * dZ2;\r\n        seg.normalMapTextureBias[2] = 1.0 / dZ2;\r\n    }\r\n\r\n    public whileTerrainLoading(terrainReadySegment?: Segment | null) {\r\n\r\n        const seg = this.segment;\r\n\r\n        let pn: Node = this;\r\n\r\n        if (terrainReadySegment && terrainReadySegment.terrainReady) {\r\n            pn = terrainReadySegment.node;\r\n        } else {\r\n            while (pn.parentNode && !pn.segment.terrainReady) {\r\n                pn = pn.parentNode;\r\n            }\r\n        }\r\n\r\n        if (pn.segment.terrainReady && this.appliedTerrainNodeId !== pn.nodeId) {\r\n\r\n            let dZ2 = 2 << (seg.tileZoom - pn.segment.tileZoom - 1), // 2 * Math.pow(2, dZ-1)\r\n                offsetX = seg.tileX - pn.segment.tileX * dZ2,\r\n                offsetY = seg.tileY - pn.segment.tileY * dZ2;\r\n\r\n            const pseg = pn.segment;\r\n\r\n            let tempVertices: Float64Array,\r\n                tempVerticesHigh: Float32Array,\r\n                tempVerticesLow: Float32Array,\r\n                noDataVertices: Uint8Array;\r\n\r\n            this.appliedTerrainNodeId = pn.nodeId;\r\n            this.equalizedSideWithNodeId[N] = this.equalizedSideWithNodeId[E] = this.equalizedSideWithNodeId[S] = this.equalizedSideWithNodeId[W] = this.appliedTerrainNodeId;\r\n\r\n            let gridSize = pn.segment.gridSize / dZ2,\r\n                gridSizeExt = pn.segment.fileGridSize / dZ2;\r\n\r\n            BOUNDS.xmin = MAX;\r\n            BOUNDS.xmax = MIN;\r\n            BOUNDS.ymin = MAX;\r\n            BOUNDS.ymax = MIN;\r\n            BOUNDS.zmin = MAX;\r\n            BOUNDS.zmax = MIN;\r\n\r\n            if (gridSize >= 1) {\r\n                seg.gridSize = gridSize;\r\n\r\n                let len = (gridSize + 1) * (gridSize + 1) * 3;\r\n                tempVertices = new Float64Array(len);\r\n                tempVerticesHigh = new Float32Array(len);\r\n                tempVerticesLow = new Float32Array(len);\r\n\r\n                if (pseg.noDataVertices) {\r\n                    noDataVertices = new Uint8Array(len / 3);\r\n                }\r\n\r\n                getMatrixSubArrayBoundsExt(\r\n                    pseg.terrainVertices!,\r\n                    pseg.terrainVerticesHigh!,\r\n                    pseg.terrainVerticesLow!,\r\n                    pseg.noDataVertices!,\r\n                    pseg.gridSize,\r\n                    gridSize * offsetY,\r\n                    gridSize * offsetX,\r\n                    gridSize,\r\n                    tempVertices,\r\n                    tempVerticesHigh,\r\n                    tempVerticesLow,\r\n                    BOUNDS,\r\n                    noDataVertices!\r\n                );\r\n\r\n            } else if (gridSizeExt >= 1 && pn.segment.terrainExists) {\r\n\r\n                seg.gridSize = gridSizeExt;\r\n\r\n                let len = (gridSizeExt + 1) * (gridSizeExt + 1) * 3;\r\n                tempVertices = new Float64Array(len);\r\n                tempVerticesHigh = new Float32Array(len);\r\n                tempVerticesLow = new Float32Array(len);\r\n\r\n                if (pseg.noDataVertices) {\r\n                    noDataVertices = new Uint8Array(len / 3);\r\n                }\r\n\r\n                getMatrixSubArrayBoundsExt(\r\n                    pseg.normalMapVertices!,\r\n                    pseg.normalMapVerticesHigh!,\r\n                    pseg.normalMapVerticesLow!,\r\n                    pseg.noDataVertices!,\r\n                    pn.segment.fileGridSize,\r\n                    gridSizeExt * offsetY,\r\n                    gridSizeExt * offsetX,\r\n                    gridSizeExt,\r\n                    tempVertices,\r\n                    tempVerticesHigh,\r\n                    tempVerticesLow,\r\n                    BOUNDS,\r\n                    noDataVertices!\r\n                );\r\n\r\n            } else {\r\n\r\n                seg.gridSize = _neGridSize;\r\n\r\n                let i0 = Math.floor(gridSize * offsetY),\r\n                    j0 = Math.floor(gridSize * offsetX);\r\n\r\n                let bigOne;\r\n                if (pseg.gridSize === 1) {\r\n                    bigOne = pseg.terrainVertices!;\r\n                } else {\r\n                    bigOne = getMatrixSubArray64(pseg.terrainVertices!, pseg.gridSize, i0, j0, 1);\r\n                }\r\n\r\n                let insideSize = 1.0 / gridSize;\r\n\r\n                let t_i0 = offsetY - insideSize * i0, t_j0 = offsetX - insideSize * j0;\r\n\r\n                let v_lt = new Vec3(bigOne[0], bigOne[1], bigOne[2]),\r\n                    v_rb = new Vec3(bigOne[9], bigOne[10], bigOne[11]);\r\n\r\n                let vn = new Vec3(bigOne[3] - bigOne[0], bigOne[4] - bigOne[1], bigOne[5] - bigOne[2]),\r\n                    vw = new Vec3(bigOne[6] - bigOne[0], bigOne[7] - bigOne[1], bigOne[8] - bigOne[2]),\r\n                    ve = new Vec3(bigOne[3] - bigOne[9], bigOne[4] - bigOne[10], bigOne[5] - bigOne[11]),\r\n                    vs = new Vec3(bigOne[6] - bigOne[9], bigOne[7] - bigOne[10], bigOne[8] - bigOne[11]);\r\n\r\n                let coords = new Vec3();\r\n\r\n                tempVertices = new Float64Array(3 * _vertOrder.length);\r\n                tempVerticesHigh = new Float32Array(3 * _vertOrder.length);\r\n                tempVerticesLow = new Float32Array(3 * _vertOrder.length);\r\n\r\n                for (let i = 0; i < _vertOrder.length; i++) {\r\n                    let vi_y = _vertOrder[i].y + t_i0, vi_x = _vertOrder[i].x + t_j0;\r\n\r\n                    let vi_x_is = vi_x * gridSize, vi_y_is = vi_y * gridSize;\r\n\r\n                    if (vi_y + vi_x < insideSize) {\r\n                        coords = vn.scaleTo(vi_x_is).addA(vw.scaleTo(vi_y_is)).addA(v_lt);\r\n                    } else {\r\n                        coords = vs.scaleTo(1 - vi_x_is).addA(ve.scaleTo(1 - vi_y_is)).addA(v_rb);\r\n                    }\r\n\r\n                    Vec3.doubleToTwoFloats(coords, _tempHigh, _tempLow);\r\n\r\n                    let i3 = i * 3;\r\n\r\n                    tempVertices[i3] = coords.x;\r\n                    tempVertices[i3 + 1] = coords.y;\r\n                    tempVertices[i3 + 2] = coords.z;\r\n\r\n                    tempVerticesHigh[i3] = _tempHigh.x;\r\n                    tempVerticesHigh[i3 + 1] = _tempHigh.y;\r\n                    tempVerticesHigh[i3 + 2] = _tempHigh.z;\r\n\r\n                    tempVerticesLow[i3] = _tempLow.x;\r\n                    tempVerticesLow[i3 + 1] = _tempLow.y;\r\n                    tempVerticesLow[i3 + 2] = _tempLow.z;\r\n\r\n                    if (coords.x < BOUNDS.xmin) BOUNDS.xmin = coords.x;\r\n                    if (coords.x > BOUNDS.xmax) BOUNDS.xmax = coords.x;\r\n                    if (coords.y < BOUNDS.ymin) BOUNDS.ymin = coords.y;\r\n                    if (coords.y > BOUNDS.ymax) BOUNDS.ymax = coords.y;\r\n                    if (coords.z < BOUNDS.zmin) BOUNDS.zmin = coords.z;\r\n                    if (coords.z > BOUNDS.zmax) BOUNDS.zmax = coords.z;\r\n                }\r\n            }\r\n\r\n            seg.readyToEngage = true;\r\n\r\n            seg.terrainVertices = tempVertices;\r\n            seg.terrainVerticesHigh = tempVerticesHigh;\r\n            seg.terrainVerticesLow = tempVerticesLow;\r\n\r\n            seg.tempVertices = tempVertices;\r\n            seg.tempVerticesHigh = tempVerticesHigh;\r\n            seg.tempVerticesLow = tempVerticesLow;\r\n\r\n            seg.noDataVertices = noDataVertices!;\r\n\r\n            seg.setBoundingVolume(BOUNDS.xmin, BOUNDS.ymin, BOUNDS.zmin, BOUNDS.xmax, BOUNDS.ymax, BOUNDS.zmax);\r\n\r\n            if (seg.tileZoom > seg.planet.terrain!.maxZoom) {\r\n                if (pn.segment.tileZoom >= seg.planet.terrain!.maxZoom) {\r\n\r\n                    seg._plainRadius = pn.segment._plainRadius / dZ2;\r\n\r\n                    seg.terrainReady = true;\r\n                    seg.terrainIsLoading = false;\r\n\r\n                    seg.terrainVertices = tempVertices;\r\n                    seg.terrainVerticesHigh = tempVerticesHigh;\r\n                    seg.terrainVerticesLow = tempVerticesLow;\r\n\r\n                    seg.passReady = true;\r\n\r\n                    this.appliedTerrainNodeId = this.nodeId;\r\n                    this.equalizedSideWithNodeId[N] = this.equalizedSideWithNodeId[E] = this.equalizedSideWithNodeId[S] = this.equalizedSideWithNodeId[W] = this.appliedTerrainNodeId;\r\n\r\n                    if (pn.segment.terrainExists) {\r\n                        seg.normalMapVertices = tempVertices;\r\n                        seg.fileGridSize = Math.sqrt(tempVertices.length / 3) - 1;\r\n\r\n                        let fgs = Math.sqrt(pseg.normalMapNormals!.length / 3) - 1,\r\n                            fgsZ = fgs / dZ2;\r\n\r\n                        if (fgs > 1) {\r\n                            seg.normalMapNormals = getMatrixSubArray32(pseg.normalMapNormals!, fgs, fgsZ * offsetY, fgsZ * offsetX, fgsZ);\r\n                        } else {\r\n                            // TODO: interpolation\r\n                            seg.normalMapNormals = pseg.normalMapNormals;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public destroy() {\r\n\r\n        this.prevState = this.state = NOTRENDERING;\r\n        this.segment.destroySegment();\r\n\r\n        let n = this.neighbors;\r\n        for (let i = 0, len = n.length; i < len; i++) {\r\n            let ni = n[i];\r\n            if (ni) {\r\n                for (let j = 0; j < ni.length; j++) {\r\n                    let nij = ni[j];\r\n                    if (nij && nij.neighbors) {\r\n                        nij.clearNeighbors();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // @ts-ignore\r\n        this.neighbors = null;\r\n        // @ts-ignore\r\n        this.parentNode = null;\r\n        // @ts-ignore\r\n        this.sideSizeLog2 = null;\r\n        // @ts-ignore\r\n        this.segment = null;\r\n    }\r\n\r\n    public clearTree() {\r\n        const state = this.getState();\r\n        if (state === NOTRENDERING || state === RENDERING) {\r\n            this.destroyBranches();\r\n        } else {\r\n            for (let i = 0; i < this.nodes.length; i++) {\r\n                this.nodes[i] && this.nodes[i].clearTree();\r\n            }\r\n        }\r\n    }\r\n\r\n    public clearBranches() {\r\n        for (let i = 0; i < this.nodes.length; i++) {\r\n            this.nodes[i]!.clearBranches();\r\n            this.nodes[i]!.segment.deleteMaterials();\r\n        }\r\n    }\r\n\r\n    public destroyBranches() {\r\n        if (this.ready) {\r\n            let nodesToRemove: Node[] = [],\r\n                i;\r\n\r\n            for (i = 0; i < this.nodes.length; i++) {\r\n                nodesToRemove[i] = this.nodes[i]!;\r\n            }\r\n\r\n            this.ready = false;\r\n            this.nodes = [];\r\n\r\n            for (i = 0; i < nodesToRemove.length; i++) {\r\n                nodesToRemove[i].destroyBranches();\r\n                nodesToRemove[i].destroy();\r\n                //@ts-ignore\r\n                nodesToRemove[i] = null;\r\n            }\r\n\r\n            nodesToRemove.length = 0;\r\n\r\n            // @ts-ignore\r\n            nodesToRemove = null;\r\n        }\r\n    }\r\n\r\n    public traverseTree(callback: Function) {\r\n        callback(this);\r\n        if (this.ready) {\r\n            for (let i = 0; i < this.nodes.length; i++) {\r\n                this.nodes[i]!.traverseTree(callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    public getOffsetOppositeNeighbourSide(neighbourNode: Node, side: number): number {\r\n        let pNode: Node = this,\r\n            neighbourZoom = neighbourNode.segment.tileZoom,\r\n            offset = 0;\r\n\r\n        while (pNode.segment.tileZoom > neighbourZoom) {\r\n            offset += PARTOFFSET[pNode.partId][side] / (1 << (pNode.segment.tileZoom - neighbourZoom));\r\n            pNode = pNode.parentNode!;\r\n        }\r\n\r\n        return offset;\r\n    }\r\n}\r\n\r\nexport {Node};","class QueueArray<T> {\r\n    protected _size: number;\r\n    protected _array: T[];\r\n    protected _popIndex: number;\r\n    protected _shiftIndex: number;\r\n    public length: number;\r\n\r\n    constructor(size: number = 2048) {\r\n        this._size = size;\r\n        this._array = new Array(this._size);\r\n        this._popIndex = Math.floor(this._size * 0.5);\r\n        this._shiftIndex = this._popIndex;\r\n        this.length = 0;\r\n    }\r\n\r\n    public reset() {\r\n        this._popIndex = Math.floor(this._size * 0.5);\r\n        this._shiftIndex = this._popIndex;\r\n        this.length = 0;\r\n    }\r\n\r\n    public clear() {\r\n        this._array.length = 0;\r\n        this._array = new Array(this._size);\r\n        this._popIndex = Math.floor(this._size * 0.5);\r\n        this._shiftIndex = this._popIndex;\r\n        this.length = 0;\r\n    }\r\n\r\n    public push(data: T) {\r\n        this.length++;\r\n        this._array[this._popIndex++] = data;\r\n    }\r\n\r\n    public pop(): T | undefined {\r\n        if (this.length) {\r\n            this.length--;\r\n            let res = this._array[--this._popIndex]!;\r\n            // @ts-ignore\r\n            this._array[this._popIndex] = null;\r\n            if (!this._array[this._popIndex - 1]) {\r\n                this._popIndex = Math.floor(this._size * 0.5);\r\n                this._shiftIndex = this._popIndex;\r\n            }\r\n            return res;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    public unshift(data: T) {\r\n        this.length++;\r\n        this._array[--this._shiftIndex] = data;\r\n    }\r\n\r\n    public shift(): T | undefined {\r\n        if (this.length) {\r\n            this.length--;\r\n            let res = this._array[this._shiftIndex]!;\r\n            // @ts-ignore\r\n            this._array[this._shiftIndex++] = null;\r\n            if (!this._array[this._shiftIndex]) {\r\n                this._popIndex = Math.floor(this._size * 0.5);\r\n                this._shiftIndex = this._popIndex;\r\n            }\r\n            return res;\r\n        }\r\n        return undefined;\r\n    }\r\n    public forEach(callback: (el: T) => void) {\r\n        for (let i = this._shiftIndex; i < this._popIndex; i++) {\r\n            callback(this._array[i]);\r\n        }\r\n    }\r\n}\r\n\r\nexport {QueueArray};\r\n","import {Vector} from \"../layer/Vector\";\r\nimport {EntityCollectionNode} from \"./EntityCollectionNode\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport {EntityCollection} from \"../entity/EntityCollection\";\r\nimport {QueueArray} from \"../QueueArray\";\r\n\r\nexport class EntityCollectionsTreeStrategy {\r\n\r\n    public _layer: Vector;\r\n\r\n    /**\r\n     * Maximum entities quantity in the tree node.\r\n     * @public\r\n     */\r\n    public _nodeCapacity: number;\r\n\r\n    public _secondPASS: EntityCollectionNode[];\r\n\r\n    protected _counter: number;\r\n    protected _deferredEntitiesPendingQueue: QueueArray<EntityCollectionNode>;\r\n\r\n    public _renderingNodes: Record<number, boolean>;\r\n\r\n    constructor(layer: Vector, nodeCapacity: number) {\r\n        this._layer = layer;\r\n        this._nodeCapacity = nodeCapacity;\r\n        this._secondPASS = [];\r\n\r\n        this._counter = 0;\r\n        this._deferredEntitiesPendingQueue = new QueueArray<EntityCollectionNode>();\r\n\r\n        this._renderingNodes = {};\r\n    }\r\n\r\n    public insertEntity(entity: Entity, rightNow: boolean = false) {\r\n\r\n    }\r\n\r\n    public setPickingEnabled(pickingEnabled: boolean) {\r\n\r\n    }\r\n\r\n    public dispose() {\r\n\r\n    }\r\n\r\n    public insertEntities(entitiesForTree: Entity[]) {\r\n\r\n    }\r\n\r\n    public collectVisibleEntityCollections(outArr: EntityCollection[]) {\r\n    }\r\n\r\n    public _queueDeferredNode(node: EntityCollectionNode) {\r\n        if (this._layer.getVisibility()) {\r\n            node._inTheQueue = true;\r\n            if (this._counter >= 1) {\r\n                this._deferredEntitiesPendingQueue.push(node);\r\n            } else {\r\n                this._execDeferredNode(node);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _execDeferredNode(node: EntityCollectionNode) {\r\n        this._counter++;\r\n        requestAnimationFrame(() => {\r\n            node.applyCollection();\r\n            this._counter--;\r\n            if (this._deferredEntitiesPendingQueue.length && this._counter < 1) {\r\n                while (this._deferredEntitiesPendingQueue.length) {\r\n                    let n = this._deferredEntitiesPendingQueue.pop()!;\r\n                    n._inTheQueue = false;\r\n                    if (n.isVisible()) {\r\n                        this._execDeferredNode(n);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}","import {EPSG3857} from \"../proj/EPSG3857\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {Vector} from \"../layer/Vector\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Proj} from \"../proj/Proj\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {getTileCellExtent, getTileCellIndex, TILEGROUP_COMMON} from \"../segment/Segment\";\r\nimport {Extent} from \"../Extent\";\r\nimport {EntityCollectionsTreeStrategy} from \"./EntityCollectionsTreeStrategy\";\r\n\r\nexport class QuadTreeStrategy {\r\n    public name: string;\r\n    public projection: Proj;\r\n    protected _planet: Planet;\r\n\r\n    /**\r\n     * grid tree list.\r\n     * @protected\r\n     * @type {Node[]}\r\n     */\r\n    protected _quadTreeList: Node[];\r\n\r\n    /**\r\n     * Current visible mercator segments tree nodes array.\r\n     * @public\r\n     * @type {Node}\r\n     */\r\n    public _visibleNodes: Record<number, Node>;\r\n\r\n    constructor(planet: Planet, name: string = \"\", proj: Proj = EPSG3857) {\r\n        this.name = name;\r\n        this.projection = proj;\r\n        this._planet = planet;\r\n        this._quadTreeList = [];\r\n        this._visibleNodes = {};\r\n    }\r\n\r\n    public createEntitiCollectionsTreeStrategy(layer: Vector, nodeCapacity: number): EntityCollectionsTreeStrategy {\r\n        return new EntityCollectionsTreeStrategy(layer, nodeCapacity);\r\n    }\r\n\r\n    public destroyBranches() {\r\n        for (let i = 0, len = this._quadTreeList.length; i < len; i++) {\r\n            this._quadTreeList[i].destroyBranches();\r\n        }\r\n    }\r\n\r\n    public clearLayerMaterial(layer: Layer) {\r\n        let lid = layer.__id;\r\n        for (let i = 0, len = this._quadTreeList.length; i < len; i++) {\r\n            this._quadTreeList[i].traverseTree(function (node: Node) {\r\n                let mats = node.segment.materials;\r\n                if (mats[lid]) {\r\n                    mats[lid].clear();\r\n                    //@ts-ignore\r\n                    mats[lid] = null;\r\n                    //delete mats[lid];\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    public get planet() {\r\n        return this._planet;\r\n    }\r\n\r\n    public init() {\r\n\r\n    }\r\n\r\n    public preRender() {\r\n        for (let i = 0; i < this._quadTreeList.length; i++) {\r\n\r\n            let quadTree = this._quadTreeList[i];\r\n            quadTree.createChildNodes();\r\n            quadTree.segment.createPlainSegment();\r\n\r\n            for (let j = 0; j < quadTree.nodes.length; j++) {\r\n                quadTree.nodes[j].segment.createPlainSegment();\r\n            }\r\n        }\r\n    }\r\n\r\n    public preLoad() {\r\n\r\n        for (let i = 0; i < this._quadTreeList.length; i++) {\r\n\r\n            let quadTree = this._quadTreeList[i];\r\n            quadTree.segment.passReady = true;\r\n            quadTree.renderNode(1);\r\n            this._planet.normalMapCreator.drawSingle(quadTree.segment);\r\n\r\n            for (let j = 0; j < quadTree.nodes.length; j++) {\r\n                quadTree.nodes[j].segment.passReady = true;\r\n                quadTree.nodes[j].renderNode(1);\r\n                this._planet._normalMapCreator.drawSingle(quadTree.nodes[j].segment);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _clearVisibleNodes() {\r\n        this._visibleNodes = {};\r\n    }\r\n\r\n    public collectRenderNodes() {\r\n        this._clearVisibleNodes();\r\n        for (let i = 0; i < this._quadTreeList.length; i++) {\r\n            this._quadTreeList[i].renderTree(this._planet.camera, 0, null);\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        for (let i = 0; i < this._quadTreeList.length; i++) {\r\n            this._quadTreeList[i].clearTree();\r\n        }\r\n    }\r\n\r\n    public get quadTreeList(): Node[] {\r\n        return this._quadTreeList;\r\n    }\r\n\r\n    public getTileXY(lonLat: LonLat, zoom: number): [number, number, number, number] {\r\n        let z = zoom,\r\n            x = -1,\r\n            y = -1,\r\n            pz = (1 << z);\r\n\r\n        x = getTileCellIndex(lonLat.lon, 360 / pz, -180);\r\n        y = getTileCellIndex(lonLat.lat, 180 / pz, 90);\r\n\r\n        return [x, y, z, TILEGROUP_COMMON];\r\n    }\r\n\r\n    public getLonLatTileOffset(lonLat: LonLat, x: number, y: number, z: number, gridSize: number): [number, number] {\r\n        let coords = lonLat;\r\n        let extent = new Extent();\r\n\r\n        let worldExtent = Extent.createFromArray([-180, -90, 180, 90]);\r\n        extent = getTileCellExtent(x, y, z, worldExtent);\r\n\r\n        let sizeImgW = extent.getWidth() / (gridSize - 1),\r\n            sizeImgH = extent.getHeight() / (gridSize - 1);\r\n\r\n        let i = gridSize - Math.ceil((coords.lat - extent.southWest.lat) / sizeImgH) - 1,\r\n            j = Math.floor((coords.lon - extent.southWest.lon) / sizeImgW);\r\n\r\n        return [i, j];\r\n    }\r\n\r\n    public collectVisibleNode(node: Node) {\r\n        this._visibleNodes[node.nodeId] = node;\r\n    }\r\n}","/**\r\n * @module og/proj/EPSG4326\r\n */\r\n\r\nimport { Proj, Units } from \"./Proj\";\r\n\r\n/**\r\n * EPSG:4326 projection object.\r\n * @type {Proj}\r\n */\r\nexport const EPSG4326 = new Proj({ code: \"epsg:4326\", units: Units.DEGREES });\r\n","import * as mercator from \"../mercator\";\r\nimport {EPSG4326} from \"../proj/EPSG4326\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {getTileCellIndex, Segment, TILEGROUP_NORTH, TILEGROUP_SOUTH} from \"./Segment\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport {PlanetCamera} from \"../camera/PlanetCamera\";\r\nimport type {WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\nconst MAX_POLE_ZOOM = 7;\r\nexport const POLE_PIECE_SIZE = (90.0 - mercator.MAX_LAT) / Math.pow(2, MAX_POLE_ZOOM);\r\n\r\n/**\r\n * Planet segment Web Mercator tile class that stored and rendered with quad tree.\r\n * @class\r\n * @extends {Segment}\r\n */\r\nclass SegmentLonLat extends Segment {\r\n    constructor(node: Node, planet: Planet, tileZoom: number, extent: Extent) {\r\n        super(node, planet, tileZoom, extent);\r\n\r\n        this._projection = EPSG4326;\r\n\r\n        this._extentLonLat = this._extent;\r\n\r\n        this._extentMerc = new Extent(\r\n            extent.southWest.forwardMercatorEPS01(),\r\n            extent.northEast.forwardMercatorEPS01()\r\n        );\r\n\r\n        this._isNorth = this._extent.northEast.lat > 0;\r\n\r\n        this.isPole = true;\r\n    }\r\n\r\n    public override _setExtentLonLat() {\r\n        this._extentLonLat = this._extent;\r\n    }\r\n\r\n    public override projectNative(coords: LonLat): LonLat {\r\n        return coords;\r\n    }\r\n\r\n    public override getInsideLonLat(obj: Entity | PlanetCamera): LonLat {\r\n        return obj._lonLat;\r\n    }\r\n\r\n    protected _getMaxZoom() {\r\n        let maxPoleZoom = 0;\r\n        if (this._isNorth) {\r\n            //north pole limits\r\n            let Yz = Math.floor((90.0 - this._extent.northEast.lat) / POLE_PIECE_SIZE);\r\n            maxPoleZoom = Math.floor(Yz / 16) + 7;\r\n        } else {\r\n            //south pole limits\r\n            let Yz = Math.floor((mercator.MIN_LAT - this._extent.northEast.lat) / POLE_PIECE_SIZE);\r\n            maxPoleZoom = 12 - Math.floor(Yz / 16);\r\n        }\r\n        return maxPoleZoom;\r\n    }\r\n\r\n    public override checkZoom() {\r\n        return super.checkZoom() && this.tileZoom <= this._getMaxZoom();\r\n    }\r\n\r\n    protected override _assignTileIndexes() {\r\n        this._assignTileXIndexes(this._extent);\r\n        this._assignTileYIndexes(this._extent);\r\n        this.tileIndex = Layer.getTileIndex(this.tileX, this.tileY, this.tileZoom, this._tileGroup);\r\n    }\r\n\r\n    protected _assignTileXIndexes(extent: Extent) {\r\n        this.tileX = getTileCellIndex(extent.getCenter().lon, extent.getWidth(), -180);\r\n        let p2 = 1 << this.tileZoom;\r\n        this.tileXE = (this.tileX + 1) % p2;\r\n        this.tileXW = (p2 + this.tileX - 1) % p2;\r\n    }\r\n\r\n    protected _assignTileYIndexes(extent: Extent) {\r\n        const lat = extent.getCenter().lat;//extent.northEast.lat;\r\n        if (lat > 0) {\r\n            this._tileGroup = TILEGROUP_NORTH;\r\n            this.tileY = getTileCellIndex(lat, extent.getHeight(), 90.0);\r\n        } else {\r\n            this._tileGroup = TILEGROUP_SOUTH;\r\n            this.tileY = getTileCellIndex(lat, extent.getHeight(), mercator.MIN_LAT);\r\n        }\r\n        this.tileYN = this.tileY - 1;\r\n        this.tileYS = this.tileY + 1;\r\n    }\r\n\r\n    protected override _projToDeg(lon: number, lat: number): LonLat {\r\n        return new LonLat(lon, lat);\r\n    }\r\n\r\n    protected override _assignGlobalTextureCoordinates() {\r\n        const e = this._extent;\r\n        this._globalTextureCoordinates[0] = (e.southWest.lon + 180.0) / 360.0;\r\n        this._globalTextureCoordinates[1] = (90 - e.northEast.lat) / 180.0;\r\n        this._globalTextureCoordinates[2] = (e.northEast.lon + 180.0) / 360.0;\r\n        this._globalTextureCoordinates[3] = (90 - e.southWest.lat) / 180.0;\r\n    }\r\n\r\n    /**\r\n     * @param layer\r\n     * @protected\r\n     *\r\n     * @todo simplify layer._extentMerc in layer.getNativeExtent(this)\r\n     *\r\n     */\r\n    protected override _getLayerExtentOffset(layer: Layer): [number, number, number, number] {\r\n        const v0s = layer._extent;\r\n        const v0t = this._extent;\r\n        const sSize_x = v0s.northEast.lon - v0s.southWest.lon;\r\n        const sSize_y = v0s.northEast.lat - v0s.southWest.lat;\r\n        const dV0s_x = (v0t.southWest.lon - v0s.southWest.lon) / sSize_x;\r\n        const dV0s_y = (v0s.northEast.lat - v0t.northEast.lat) / sSize_y;\r\n        const dSize_x = (v0t.northEast.lon - v0t.southWest.lon) / sSize_x;\r\n        const dSize_y = (v0t.northEast.lat - v0t.southWest.lat) / sSize_y;\r\n        return [dV0s_x, dV0s_y, dSize_x, dSize_y];\r\n    }\r\n\r\n    public override layerOverlap(layer: Layer): boolean {\r\n        return this._extent.overlaps(layer._extent);\r\n    }\r\n\r\n    public override getDefaultTexture(): WebGLTextureExt | null {\r\n        return this._isNorth ? this.planet.solidTextureOne : this.planet.solidTextureTwo;\r\n    }\r\n\r\n    public override getExtentLonLat(): Extent {\r\n        return this._extent;\r\n    }\r\n\r\n}\r\n\r\nexport {SegmentLonLat};\r\n","import * as mercator from '../mercator';\r\nimport {NW, NE, SW, SE, RENDERING, VISIBLE_DISTANCE} from './quadTree';\r\nimport {EntityCollection} from '../entity/EntityCollection';\r\nimport {Extent} from '../Extent';\r\nimport {LonLat} from '../LonLat';\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Sphere} from '../bv/Sphere';\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {Vec3} from '../math/Vec3';\r\nimport {Vector} from \"../layer/Vector\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport {EntityCollectionsTreeStrategy} from \"./EntityCollectionsTreeStrategy\";\r\n\r\n\r\nexport type NodesDict = Record<number, Node>;\r\n\r\n/**\r\n * @todo: remove planet parameter. It's already available in the layer.\r\n */\r\nclass EntityCollectionNode {\r\n\r\n    public layer: Vector;\r\n    public strategy: EntityCollectionsTreeStrategy\r\n    public parentNode: EntityCollectionNode | null;\r\n    public childNodes: EntityCollectionNode[];\r\n    public partId: number;\r\n    public nodeId: number;\r\n    public state: number | null;\r\n    public extent: Extent;\r\n    public count: number;\r\n    public deferredEntities: Entity[];\r\n    public entityCollection: EntityCollection | null;\r\n    public zoom: number;\r\n    public bsphere: Sphere;\r\n\r\n    public _inTheQueue: boolean;\r\n\r\n    constructor(strategy: EntityCollectionsTreeStrategy, partId: number, parent: EntityCollectionNode | null, extent: Extent, planet: Planet, zoom: number) {\r\n        this.strategy = strategy;\r\n        this.layer = strategy._layer;\r\n        this.parentNode = parent;\r\n        this.childNodes = [];\r\n        this.partId = partId;\r\n        //this.nodeId = partId + id;\r\n        this.nodeId = partId + (parent ? parent.nodeId * 4 + 1 : 0);\r\n        this.state = null;\r\n        this.extent = extent;\r\n        this.count = 0;\r\n        this.deferredEntities = [];\r\n        this.entityCollection = null;\r\n        this.zoom = zoom;\r\n        this._inTheQueue = false;\r\n\r\n        this.bsphere = new Sphere();\r\n\r\n        planet && this._setExtentBounds();\r\n    }\r\n\r\n    public insertEntity(entity: Entity, rightNow: boolean = false) {\r\n        this.buildTree([entity], rightNow);\r\n    }\r\n\r\n    protected _addEntitiesToCollection(entities: Entity[], rightNow: boolean = false) {\r\n        if (entities.length) {\r\n            const l = this.layer;\r\n            const p = l._planet!;\r\n\r\n            let ec = this.entityCollection;\r\n\r\n            if (!ec) {\r\n                ec = new EntityCollection({\r\n                    pickingEnabled: l._pickingEnabled,\r\n                    labelMaxLetters: l.labelMaxLetters\r\n                });\r\n                ec._layer = this.layer;\r\n                ec.addTo(p, true);\r\n                ec._quadNode = this;\r\n                l._bindEventsDefault(ec);\r\n                this.entityCollection = ec;\r\n            }\r\n\r\n            if (rightNow || !l.async) {\r\n                this.entityCollection!.addEntities(entities);\r\n            } else {\r\n                this.deferredEntities.push.apply(this.deferredEntities, entities);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _setExtentBounds() {\r\n        if (!this.nodeId) {\r\n            this.bsphere.radius = this.layer._planet!.ellipsoid.equatorialSize;\r\n            this.bsphere.center = new Vec3();\r\n        } else {\r\n            this.bsphere.setFromExtent(this.layer._planet!.ellipsoid, this.extent.inverseMercator());\r\n        }\r\n    }\r\n\r\n    public __setLonLat__(entity: Entity): LonLat {\r\n\r\n        if (entity._lonLat.isZero() && !entity._cartesian.isZero()) {\r\n            entity._lonLat = this.layer._planet!.ellipsoid.cartesianToLonLat(entity._cartesian);\r\n        }\r\n\r\n        if (Math.abs(entity._lonLat.lat) < mercator.MAX_LAT) {\r\n            entity._lonLatMerc = entity._lonLat.forwardMercator();\r\n        } else {\r\n            entity._lonLatMerc = new LonLat();\r\n        }\r\n        return entity._lonLatMerc;\r\n    }\r\n\r\n    public buildTree(entities: Entity[], rightNow: boolean = false) {\r\n\r\n        this.count += entities.length;\r\n\r\n        if (entities.length > this.layer._nodeCapacity) {\r\n            const cn = this.childNodes;\r\n            if (!cn.length) {\r\n                this.createChildNodes();\r\n            }\r\n\r\n            let en_nw = [],\r\n                en_ne = [],\r\n                en_sw = [],\r\n                en_se = [];\r\n\r\n            let i = entities.length;\r\n            while (i--) {\r\n                const ei = entities[i];\r\n                if (cn[NW].isInside(ei)) {\r\n                    ei._nodePtr = cn[NW];\r\n                    en_nw.push(ei);\r\n                } else if (cn[NE].isInside(ei)) {\r\n                    ei._nodePtr = cn[NE];\r\n                    en_ne.push(ei);\r\n                } else if (cn[SW].isInside(ei)) {\r\n                    ei._nodePtr = cn[SW];\r\n                    en_sw.push(ei);\r\n                } else if (cn[SE].isInside(ei)) {\r\n                    ei._nodePtr = cn[SE];\r\n                    en_se.push(ei);\r\n                }\r\n            }\r\n\r\n            en_nw.length && cn[NW].buildTree(en_nw, rightNow);\r\n            en_ne.length && cn[NE].buildTree(en_ne, rightNow);\r\n            en_sw.length && cn[SW].buildTree(en_sw, rightNow);\r\n            en_se.length && cn[SE].buildTree(en_se, rightNow);\r\n\r\n        } else {\r\n            this._addEntitiesToCollection(entities, rightNow);\r\n        }\r\n    }\r\n\r\n    public isInside(entity: Entity): boolean {\r\n        if (entity._lonLatMerc) {\r\n            return this.extent.isInside(entity._lonLatMerc);\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    public createChildNodes() {\r\n        const s = this.strategy;\r\n        const ext = this.extent;\r\n        const size_x = ext.getWidth() * 0.5;\r\n        const size_y = ext.getHeight() * 0.5;\r\n        const ne = ext.northEast;\r\n        const sw = ext.southWest;\r\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\r\n        const nd = this.childNodes;\r\n        const p = this.layer._planet!;\r\n        const z = this.zoom + 1;\r\n\r\n        nd[NW] = new EntityCollectionNode(s, NW, this, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)), p, z);\r\n        nd[NE] = new EntityCollectionNode(s, NE, this, new Extent(c, new LonLat(ne.lon, ne.lat)), p, z);\r\n        nd[SW] = new EntityCollectionNode(s, SW, this, new Extent(new LonLat(sw.lon, sw.lat), c), p, z);\r\n        nd[SE] = new EntityCollectionNode(s, SE, this, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)), p, z);\r\n    }\r\n\r\n    public collectRenderCollectionsPASS1(visibleNodes: NodesDict, outArr: EntityCollection[]) {\r\n        const n = visibleNodes[this.nodeId];\r\n        if (n) {\r\n            const cn = this.childNodes;\r\n            if (this.entityCollection) {\r\n                this.renderCollection(outArr, visibleNodes);\r\n            } else if (cn.length) {\r\n                if (n.state === RENDERING) {\r\n                    this.strategy._secondPASS.push(this);\r\n                } else {\r\n                    cn[NW].collectRenderCollectionsPASS1(visibleNodes, outArr);\r\n                    cn[NE].collectRenderCollectionsPASS1(visibleNodes, outArr);\r\n                    cn[SW].collectRenderCollectionsPASS1(visibleNodes, outArr);\r\n                    cn[SE].collectRenderCollectionsPASS1(visibleNodes, outArr);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public collectRenderCollectionsPASS2(visibleNodes: NodesDict, outArr: EntityCollection[], renderingNodeId: number) {\r\n        const p = this.layer._planet!;\r\n        const cam = p.camera;\r\n\r\n        const altVis = (cam.eye.distance(this.bsphere.center) - this.bsphere.radius <\r\n            VISIBLE_DISTANCE * Math.sqrt(cam._lonLat.height)) || cam._lonLat.height > 10000;\r\n\r\n        if (this.count > 0 && altVis && cam.containsSphere(this.bsphere)) {\r\n\r\n            const cn = this.childNodes;\r\n\r\n            if (this.entityCollection) {\r\n                this.renderCollection(outArr, visibleNodes, renderingNodeId);\r\n            } else if (cn.length) {\r\n                cn[NW].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\r\n                cn[NE].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\r\n                cn[SW].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\r\n                cn[SE].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\r\n            }\r\n        }\r\n    }\r\n\r\n    public applyCollection() {\r\n        this.entityCollection!.addEntities(this.deferredEntities);\r\n        this.deferredEntities.length = 0;\r\n        this.deferredEntities = [];\r\n        this._inTheQueue = false;\r\n    }\r\n\r\n    public traverseTree(callback: Function) {\r\n\r\n        const cn = this.childNodes;\r\n\r\n        if (this.entityCollection) {\r\n            callback(this);\r\n        } else if (cn.length) {\r\n            cn[NW].traverseTree(callback);\r\n            cn[NE].traverseTree(callback);\r\n            cn[SW].traverseTree(callback);\r\n            cn[SE].traverseTree(callback);\r\n        }\r\n    }\r\n\r\n    public renderCollection(outArr: EntityCollection[], visibleNodes: NodesDict, renderingNodeId?: number) {\r\n\r\n        const s = this.strategy;\r\n\r\n        s._renderingNodes[this.nodeId] = true;\r\n\r\n        if (this.deferredEntities.length && !this._inTheQueue) {\r\n            if (this.layer.async) {\r\n                s._queueDeferredNode(this);\r\n            } else {\r\n                this.applyCollection();\r\n            }\r\n        }\r\n\r\n        let ec = this.entityCollection!;\r\n        let l = this.layer;\r\n\r\n        ec._fadingOpacity = l._fadingOpacity;\r\n        ec.scaleByDistance = l.scaleByDistance;\r\n        ec.pickingScale = l.pickingScale;\r\n        ec.polygonOffsetUnits = l.polygonOffsetUnits;\r\n\r\n        outArr.push(ec);\r\n\r\n        if (l.clampToGround || l.relativeToGround) {\r\n            const e = ec._entities;\r\n            let i = e.length;\r\n\r\n            if (visibleNodes[this.nodeId] && visibleNodes[this.nodeId].state === RENDERING) {\r\n                while (i--) {\r\n                    let ei = e[i];\r\n                    this.alignEntityToTheGround(ei, visibleNodes[this.nodeId].segment);\r\n                }\r\n            } else if (renderingNodeId) {\r\n                while (i--) {\r\n                    let ei = e[i];\r\n                    this.alignEntityToTheGround(ei, visibleNodes[renderingNodeId].segment);\r\n                }\r\n            } else {\r\n                const n = l._planet!._renderedNodes;\r\n                while (i--) {\r\n                    let ei = e[i];\r\n                    let j = n.length;\r\n                    while (j--) {\r\n                        if (n[j].segment.isEntityInside(ei)) {\r\n                            this.alignEntityToTheGround(ei, n[j].segment);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public alignEntityToTheGround(entity: Entity, segment: Segment) {\r\n        let res = new Vec3();\r\n        segment.getEntityTerrainPoint(entity, res);\r\n        let alt = (Number(this.layer.relativeToGround) && entity._altitude) || 0.0;\r\n        if (alt) {\r\n            let n = this.layer._planet!.ellipsoid.getSurfaceNormal3v(res);\r\n            entity._setCartesian3vSilent(res.addA(n.scale(alt)));\r\n        } else {\r\n            entity._setCartesian3vSilent(res);\r\n        }\r\n    }\r\n\r\n    public isVisible(): boolean {\r\n        if (this.strategy._renderingNodes[this.nodeId]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\nexport {EntityCollectionNode}\r\n","import {EarthEntityCollectionsTreeStrategy} from \"./EarthEntityCollectionsTreeStrategy\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {NE, NW, SE, SW} from \"../quadTree\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {EntityCollection} from \"../../entity/EntityCollection\";\r\nimport {EntityCollectionNode} from \"../EntityCollectionNode\";\r\nimport type {NodesDict} from \"../EntityCollectionNode\";\r\n\r\nexport class EarthEntityCollectionNodeLonLat extends EntityCollectionNode {\r\n\r\n    public isNorth: boolean;\r\n\r\n    public override strategy: EarthEntityCollectionsTreeStrategy;\r\n\r\n    constructor(strategy: EarthEntityCollectionsTreeStrategy, partId: number, parent: EarthEntityCollectionNodeLonLat | null, extent: Extent, planet: Planet, zoom: number) {\r\n        super(strategy, partId, parent, extent, planet, zoom);\r\n        this.strategy = strategy;\r\n        this.isNorth = false;\r\n    }\r\n\r\n    public override createChildNodes() {\r\n        const s = this.strategy;\r\n        const ext = this.extent;\r\n        const size_x = ext.getWidth() * 0.5;\r\n        const size_y = ext.getHeight() * 0.5;\r\n        const ne = ext.northEast;\r\n        const sw = ext.southWest;\r\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\r\n        const nd = this.childNodes;\r\n        const p = this.layer._planet!;\r\n        const z = this.zoom + 1;\r\n\r\n        nd[NW] = new EarthEntityCollectionNodeLonLat(s, NW, this, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)), p, z);\r\n        nd[NE] = new EarthEntityCollectionNodeLonLat(s, NE, this, new Extent(c, new LonLat(ne.lon, ne.lat)), p, z);\r\n        nd[SW] = new EarthEntityCollectionNodeLonLat(s, SW, this, new Extent(new LonLat(sw.lon, sw.lat), c), p, z);\r\n        nd[SE] = new EarthEntityCollectionNodeLonLat(s, SE, this, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)), p, z);\r\n    }\r\n\r\n    protected override _setExtentBounds() {\r\n        if (this.extent.northEast.lat > 0) {\r\n            this.isNorth = true;\r\n        }\r\n        this.bsphere.setFromExtent(this.layer._planet!.ellipsoid, this.extent);\r\n    }\r\n\r\n    public override __setLonLat__(entity: Entity): LonLat {\r\n        if (entity._lonLat.isZero()) {\r\n            entity._lonLat = this.layer._planet!.ellipsoid.cartesianToLonLat(entity._cartesian);\r\n        }\r\n        return entity._lonLat;\r\n    }\r\n\r\n    public override isVisible(): boolean {\r\n        if (this.isNorth && this.strategy._renderingNodesNorth[this.nodeId]) {\r\n            return true;\r\n        } else if (this.strategy._renderingNodesSouth[this.nodeId]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public override isInside(entity: Entity): boolean {\r\n        return this.extent.isInside(entity._lonLat);\r\n    }\r\n\r\n    public override renderCollection(outArr: EntityCollection[], visibleNodes: NodesDict, renderingNode: number) {\r\n\r\n        if (this.isNorth) {\r\n            this.strategy._renderingNodesNorth[this.nodeId] = true;\r\n        } else {\r\n            this.strategy._renderingNodesSouth[this.nodeId] = true;\r\n        }\r\n\r\n        if (this.deferredEntities.length && !this._inTheQueue) {\r\n            if (this.layer.async) {\r\n                this.strategy._queueDeferredNode(this);\r\n            } else {\r\n                this.applyCollection();\r\n            }\r\n        }\r\n\r\n        const ec = this.entityCollection!;\r\n\r\n        ec._fadingOpacity = this.layer._fadingOpacity;\r\n        ec.scaleByDistance = this.layer.scaleByDistance;\r\n        ec.pickingScale = this.layer.pickingScale;\r\n\r\n        if (!ec.isEmpty()) {\r\n            outArr.push(ec);\r\n        }\r\n    }\r\n}\r\n","import {EntityCollectionNode} from \"../EntityCollectionNode\";\r\nimport {EarthEntityCollectionNodeLonLat} from \"./EarthEntityCollectionNodeLonLat\";\r\nimport {Vector} from \"../../layer/Vector\";\r\nimport * as quadTree from \"../quadTree\";\r\nimport {Extent} from \"../../Extent\";\r\nimport * as mercator from \"../../mercator\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {EntityCollection} from \"../../entity/EntityCollection\";\r\nimport {EarthQuadTreeStrategy} from \"./EarthQuadTreeStrategy\";\r\nimport {EntityCollectionsTreeStrategy} from \"../EntityCollectionsTreeStrategy\";\r\n\r\nexport class EarthEntityCollectionsTreeStrategy extends EntityCollectionsTreeStrategy {\r\n\r\n    protected _entityCollectionsTree: EntityCollectionNode;\r\n    protected _entityCollectionsTreeNorth: EarthEntityCollectionNodeLonLat;\r\n    protected _entityCollectionsTreeSouth: EarthEntityCollectionNodeLonLat;\r\n\r\n    public _renderingNodesNorth: Record<number, boolean>;\r\n    public _renderingNodesSouth: Record<number, boolean>;\r\n\r\n    constructor(layer: Vector, nodeCapacity: number) {\r\n        super(layer, nodeCapacity);\r\n\r\n        let planet = layer._planet!;\r\n\r\n        this._entityCollectionsTree = new EntityCollectionNode(\r\n            this,\r\n            quadTree.NW,\r\n            null,\r\n            Extent.createFromArray([-20037508.34, -20037508.34, 20037508.34, 20037508.34]),\r\n            planet,\r\n            0\r\n        );\r\n\r\n        this._entityCollectionsTreeNorth = new EarthEntityCollectionNodeLonLat(\r\n            this,\r\n            quadTree.NW,\r\n            null,\r\n            Extent.createFromArray([-180, mercator.MAX_LAT, 180, 90]),\r\n            planet,\r\n            0\r\n        );\r\n\r\n        this._entityCollectionsTreeSouth = new EarthEntityCollectionNodeLonLat(\r\n            this,\r\n            quadTree.NW,\r\n            null,\r\n            Extent.createFromArray([-180, -90, 180, mercator.MIN_LAT]),\r\n            planet,\r\n            0\r\n        );\r\n\r\n        this._renderingNodes = {};\r\n        this._renderingNodesNorth = {};\r\n        this._renderingNodesSouth = {};\r\n    }\r\n\r\n    public override insertEntity(entity: Entity, rightNow: boolean = false) {\r\n        if (entity._lonLat.lat > mercator.MAX_LAT) {\r\n            this._entityCollectionsTreeNorth!.__setLonLat__(entity);\r\n            this._entityCollectionsTreeNorth!.insertEntity(entity, rightNow);\r\n        } else if (entity._lonLat.lat < mercator.MIN_LAT) {\r\n            this._entityCollectionsTreeSouth!.__setLonLat__(entity);\r\n            this._entityCollectionsTreeSouth!.insertEntity(entity, rightNow);\r\n        } else {\r\n            this._entityCollectionsTree!.__setLonLat__(entity);\r\n            this._entityCollectionsTree!.insertEntity(entity, rightNow);\r\n        }\r\n    }\r\n\r\n    public override setPickingEnabled(pickingEnabled: boolean) {\r\n        this._entityCollectionsTree && this._entityCollectionsTree.traverseTree((node: EntityCollectionNode) => {\r\n            node.entityCollection!.setPickingEnabled(pickingEnabled);\r\n        });\r\n\r\n        this._entityCollectionsTreeNorth && this._entityCollectionsTreeNorth.traverseTree((node: EarthEntityCollectionNodeLonLat) => {\r\n            node.entityCollection!.setPickingEnabled(pickingEnabled);\r\n        });\r\n\r\n        this._entityCollectionsTreeSouth && this._entityCollectionsTreeSouth.traverseTree((node: EarthEntityCollectionNodeLonLat) => {\r\n            node.entityCollection!.setPickingEnabled(pickingEnabled);\r\n        });\r\n    }\r\n\r\n    public override dispose() {\r\n        //@ts-ignore\r\n        this._entityCollectionsTree = null;\r\n        //@ts-ignore\r\n        this._entityCollectionsTreeNorth = null;\r\n        //@ts-ignore\r\n        this._entityCollectionsTreeSouth = null;\r\n\r\n        this._renderingNodes = {};\r\n        this._renderingNodesNorth = {};\r\n        this._renderingNodesSouth = {};\r\n    }\r\n\r\n    public override insertEntities(entitiesForTree: Entity[]) {\r\n        let northEntities: Entity[] = [],\r\n            southEntities: Entity[] = [],\r\n            mercEntities: Entity[] = [];\r\n        for (let i = 0, len = entitiesForTree.length; i < len; i++) {\r\n            let entity = entitiesForTree[i];\r\n            // north tree\r\n            if (entity._lonLat.lat > mercator.MAX_LAT) {\r\n                northEntities.push(entity);\r\n                this._entityCollectionsTreeNorth.__setLonLat__(entity);\r\n            } else if (entity._lonLat.lat < mercator.MIN_LAT) {\r\n                southEntities.push(entity);\r\n                this._entityCollectionsTreeSouth.__setLonLat__(entity);\r\n            } else {\r\n                mercEntities.push(entity);\r\n                this._entityCollectionsTree.__setLonLat__(entity);\r\n            }\r\n        }\r\n\r\n        this._entityCollectionsTree.buildTree(mercEntities);\r\n        this._entityCollectionsTreeNorth.buildTree(northEntities);\r\n        this._entityCollectionsTreeSouth.buildTree(southEntities);\r\n    }\r\n\r\n    public override collectVisibleEntityCollections(outArr: EntityCollection[]) {\r\n        this._renderingNodes = {};\r\n        this._renderingNodesNorth = {};\r\n        this._renderingNodesSouth = {};\r\n\r\n        let pqs = this._layer._planet!.quadTreeStrategy as EarthQuadTreeStrategy;\r\n\r\n        // Merc nodes\r\n        this._secondPASS = [];\r\n        this._entityCollectionsTree.collectRenderCollectionsPASS1(pqs._visibleNodes, outArr);\r\n        let i = this._secondPASS.length;\r\n        while (i--) {\r\n            this._secondPASS[i].collectRenderCollectionsPASS2(pqs._visibleNodes, outArr, this._secondPASS[i].nodeId);\r\n        }\r\n\r\n        // North nodes\r\n        this._secondPASS = [];\r\n        this._entityCollectionsTreeNorth.collectRenderCollectionsPASS1(pqs._visibleNodesNorth, outArr);\r\n        i = this._secondPASS.length;\r\n        while (i--) {\r\n            this._secondPASS[i].collectRenderCollectionsPASS2(pqs._visibleNodesNorth, outArr, this._secondPASS[i].nodeId);\r\n        }\r\n\r\n        // South nodes\r\n        this._secondPASS = [];\r\n        this._entityCollectionsTreeSouth.collectRenderCollectionsPASS1(pqs._visibleNodesSouth, outArr);\r\n        i = this._secondPASS.length;\r\n        while (i--) {\r\n            this._secondPASS[i].collectRenderCollectionsPASS2(pqs._visibleNodesSouth, outArr, this._secondPASS[i].nodeId);\r\n        }\r\n    }\r\n}","import * as mercator from \"../../mercator\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {Node} from \"../Node\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {QuadTreeStrategy} from \"../QuadTreeStrategy\";\r\nimport {\r\n    Segment,\r\n    TILEGROUP_NORTH,\r\n    TILEGROUP_SOUTH,\r\n    getTileGroupByLat,\r\n    getTileCellExtent,\r\n    getTileCellIndex\r\n} from \"../../segment/Segment\";\r\nimport {SegmentLonLat} from \"../../segment/SegmentLonLat\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {Vector} from \"../../layer/Vector\";\r\nimport {EarthEntityCollectionsTreeStrategy} from \"./EarthEntityCollectionsTreeStrategy\";\r\n\r\nexport class EarthQuadTreeStrategy extends QuadTreeStrategy {\r\n\r\n    /**\r\n     * Current visible north pole nodes tree nodes array.\r\n     * @public\r\n     * @type {Node}\r\n     */\r\n    public _visibleNodesNorth: Record<number, Node>;\r\n\r\n    /**\r\n     * Current visible south pole nodes tree nodes array.\r\n     * @public\r\n     * @type {Node}\r\n     */\r\n    public _visibleNodesSouth: Record<number, Node>;\r\n\r\n    constructor(planet: Planet) {\r\n        super(planet, \"Earth\");\r\n\r\n        this._visibleNodesNorth = {};\r\n        this._visibleNodesSouth = {};\r\n    }\r\n\r\n    public override collectVisibleNode(node: Node) {\r\n        let tg = node.segment._tileGroup;\r\n        if (tg === TILEGROUP_NORTH) {\r\n            this._visibleNodesNorth[node.nodeId] = node;\r\n        } else if (tg === TILEGROUP_SOUTH) {\r\n            this._visibleNodesSouth[node.nodeId] = node;\r\n        } else {\r\n            this._visibleNodes[node.nodeId] = node;\r\n        }\r\n    }\r\n\r\n    protected override _clearVisibleNodes() {\r\n        super._clearVisibleNodes();\r\n        this._visibleNodesNorth = {};\r\n        this._visibleNodesSouth = {};\r\n    }\r\n\r\n    public override createEntitiCollectionsTreeStrategy(layer: Vector, nodeCapacity: number): EarthEntityCollectionsTreeStrategy {\r\n        return new EarthEntityCollectionsTreeStrategy(layer, nodeCapacity);\r\n    }\r\n\r\n    public override init() {\r\n        this._quadTreeList = [\r\n            new Node(Segment, this.planet, 0, null, 0,\r\n                Extent.createFromArray([-20037508.34, -20037508.34, 20037508.34, 20037508.34])\r\n            ),\r\n            new Node(SegmentLonLat, this.planet, 0, null, 0,\r\n                Extent.createFromArray([-180, mercator.MAX_LAT, 180, 90])\r\n            ),\r\n            new Node(SegmentLonLat, this.planet, 0, null, 0,\r\n                Extent.createFromArray([-180, -90, 180, mercator.MIN_LAT])\r\n            )\r\n        ];\r\n    }\r\n\r\n    public override getTileXY(lonLat: LonLat, zoom: number): [number, number, number, number] {\r\n        let tileGroup = getTileGroupByLat(lonLat.lat, mercator.MAX_LAT),\r\n            z = zoom,\r\n            x = -1,\r\n            y = -1,\r\n            pz = (1 << z)/*Math.pow(2, z)*/;\r\n\r\n        if (tileGroup === TILEGROUP_NORTH) {\r\n            x = getTileCellIndex(lonLat.lon, 360 / pz, -180);\r\n            y = getTileCellIndex(lonLat.lat, (90 - mercator.MAX_LAT) / pz, 90);\r\n        } else if (tileGroup === TILEGROUP_SOUTH) {\r\n            x = getTileCellIndex(lonLat.lon, 360 / pz, -180);\r\n            y = getTileCellIndex(lonLat.lat, (90 - mercator.MAX_LAT) / pz, mercator.MIN_LAT);\r\n        } else {\r\n            let merc = mercator.forward(lonLat);\r\n            x = getTileCellIndex(merc.lon, mercator.POLE2 / pz, -mercator.POLE);\r\n            y = getTileCellIndex(merc.lat, mercator.POLE2 / pz, mercator.POLE);\r\n        }\r\n\r\n        return [x, y, z, tileGroup];\r\n    }\r\n\r\n    public override getLonLatTileOffset(lonLat: LonLat, x: number, y: number, z: number, gridSize: number): [number, number] {\r\n        let coords = lonLat;\r\n        let extent = new Extent();\r\n\r\n        if (lonLat.lat > mercator.MAX_LAT) {\r\n            let worldExtent = Extent.createFromArray([-180, mercator.MAX_LAT, 180, 90]);\r\n            extent = getTileCellExtent(x, y, z, worldExtent);\r\n        } else if (lonLat.lat < mercator.MIN_LAT) {\r\n            let worldExtent = Extent.createFromArray([-180, -90, 180, mercator.MIN_LAT]);\r\n            extent = getTileCellExtent(x, y, z, worldExtent);\r\n        } else {\r\n            coords = mercator.forward(lonLat);\r\n            extent = mercator.getTileExtent(x, y, z);\r\n        }\r\n\r\n        let sizeImgW = extent.getWidth() / (gridSize - 1),\r\n            sizeImgH = extent.getHeight() / (gridSize - 1);\r\n\r\n        let i = gridSize - Math.ceil((coords.lat - extent.southWest.lat) / sizeImgH) - 1,\r\n            j = Math.floor((coords.lon - extent.southWest.lon) / sizeImgW);\r\n\r\n        return [i, j];\r\n    }\r\n}","/* This file is mostly a straight translation of\r\n * GeographicLib/src/Geoid.cpp from C++ to JavaScript\r\n * by Kim Vandry <vandry@TZoNE.ORG>\r\n *\r\n * @license\r\n *  **\r\n * * \\file Geoid.cpp\r\n * * \\brief Implementation for GeographicLib::Geoid class\r\n * *\r\n * * Copyright (c) Charles Karney (2009) <charles@karney.com>\r\n * * and licensed under the LGPL.  For more information, see\r\n * * http://geographiclib.sourceforge.net/\r\n * **********************************************************************\r\n *\r\n * Geoid height grade not supported\r\n * The files can be downloaded from here:\r\n * http://geographiclib.sourceforge.net/1.18/geoid.html\r\n */\r\n\r\n//window.myGeoid = new Geoid();\r\n\r\n//Geoid.loadModel(\"./res/egm84-30.pgm\")\r\n//    .then(function (model) {\r\n//        myGeoid.setModel(model);\r\n\r\n//        globe.planet.renderer.events.on(\"lclick\", (e) => {\r\n//            let c = globe.planet.getLonLatFromPixelTerrain(e);\r\n//            let h = myGeoid.getHeight(c.lon, c.lat);\r\n//            console.log(`${c.lat} ${c.lon} h=${h}`);\r\n//        });\r\n//    })\r\n//    .catch(function (err) {\r\n//        // If we get here, the model failed to load\r\n//        console.log(err);\r\n//    });\r\n\r\nimport {LonLat} from \"../LonLat\";\r\n\r\ninterface IGeoidParams {\r\n    model?: GeoidModel;\r\n    src?: string | null;\r\n}\r\n\r\n\r\nexport type GeoidModel = {\r\n    scale: number;\r\n    offset: number,\r\n    width: number;\r\n    height: number;\r\n    rlonres: number;\r\n    rlatres: number;\r\n    i: number;\r\n    rawfile: Uint8Array\r\n};\r\n\r\nclass Geoid {\r\n\r\n    public model: GeoidModel | null;\r\n    public src: string | null;\r\n\r\n    protected _cached_ix: number;\r\n    protected _cached_iy: number;\r\n    protected _v00: number;\r\n    protected _v01: number;\r\n    protected _v10: number;\r\n    protected _v11: number;\r\n    protected _t: number;\r\n\r\n    constructor(options: IGeoidParams = {}) {\r\n\r\n        this.model = options.model || null;\r\n        this.src = options.src || null;\r\n\r\n        this._cached_ix = 0;\r\n        this._cached_iy = 0;\r\n        this._v00 = 0;\r\n        this._v01 = 0;\r\n        this._v10 = 0;\r\n        this._v11 = 0;\r\n        this._t = 0;\r\n    }\r\n\r\n    static loadModel(url?: string | null): Promise<GeoidModel | null> {\r\n        if (!url) {\r\n            return new Promise((resolve: any) => {\r\n                resolve(null);\r\n            });\r\n        } else\r\n            return fetch(url, {})\r\n\r\n                .then((r: Response) => {\r\n                    if (!r.ok) {\r\n                        throw Error(\"Geoid model file: HTTP error \" + r.status);\r\n                    }\r\n                    return r.arrayBuffer();\r\n                })\r\n\r\n                .then((r: ArrayBuffer) => {\r\n                    if (r) {\r\n                        return new Uint8Array(r);\r\n                    } else {\r\n                        throw Error(\"Geoid model file: no data from \" + url);\r\n                    }\r\n                })\r\n\r\n                .then(function (rawfile: Uint8Array) {\r\n\r\n                    if (!((rawfile[0] === 80) && (rawfile[1] === 53) && (\r\n                        ((rawfile[2] === 13) && (rawfile[3] === 10)) ||\r\n                        (rawfile[2] === 10)\r\n                    ))) {\r\n                        throw new Error(\"Geoid model file: no PGM header\");\r\n                    }\r\n\r\n                    var i: number = (rawfile[2] === 13) ? 4 : 3;\r\n                    var offset: number | null = null;\r\n                    var scale: number | null = null;\r\n\r\n                    function getline(): string {\r\n                        let start = i;\r\n                        for (var j = i; ; j++) {\r\n                            if (j >= rawfile.length) {\r\n                                throw new Error(\"Geoid model file: missing newline in header\");\r\n                            }\r\n                            if (rawfile[j] === 10) {\r\n                                i = j + 1;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if ((j > start) && (rawfile[j - 1] === 13)) j--;\r\n                        return String.fromCharCode.apply(null, rawfile.slice(start, j) as any);\r\n                    }\r\n\r\n                    var m, s;\r\n                    for (; ;) {\r\n                        s = getline();\r\n                        if (s[0] !== '#') break;\r\n                        m = s.match(/^# Offset (.*)$/);\r\n                        if (m) {\r\n                            offset = parseInt(m[1], 10);\r\n                            if (!isFinite(offset)) {\r\n                                throw new Error(\"Geoid model file: bad offset \" + m[1]);\r\n                            }\r\n                        } else {\r\n                            m = s.match(/^# Scale (.*)$/);\r\n                            if (m) {\r\n                                scale = parseFloat(m[1]);\r\n                                if (!isFinite(scale)) {\r\n                                    throw new Error(\"Geoid model file: bad scale \" + m[1]);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    m = s.match(/^\\s*(\\d+)\\s+(\\d+)\\s*$/);\r\n\r\n                    let width: number = 0;\r\n                    let height: number = 0;\r\n\r\n                    if (m) {\r\n                        width = parseInt(m[1], 10);\r\n                        height = parseInt(m[2], 10);\r\n                    }\r\n\r\n                    if (!(m && (width >= 0) && (height >= 0))) {\r\n                        throw new Error(\"Geoid model file: bad PGM width&height line\");\r\n                    }\r\n\r\n                    let levels = parseInt(getline());\r\n\r\n                    if (levels != 65535) {\r\n                        throw new Error(\"Geoid model file: PGM file must have 65535 gray levels\");\r\n                    }\r\n                    if (offset === null) {\r\n                        throw new Error(\"Geoid model file: PGM file does not contain offset\");\r\n                    }\r\n                    if (scale === null) {\r\n                        throw new Error(\"Geoid model file: PGM file does not contain scale\");\r\n                    }\r\n                    if ((width < 2) || (height < 2)) {\r\n                        throw new Error(\"Geoid model file: Raster size too small\");\r\n                    }\r\n\r\n                    let payload_len = rawfile.length - i;\r\n\r\n                    if (payload_len !== (width * height * 2)) {\r\n                        throw new Error(\"Geoid model file: File has the wrong length\");\r\n                    }\r\n\r\n                    return {\r\n                        scale: scale,\r\n                        offset: offset,\r\n                        width: width,\r\n                        height: height,\r\n                        rlonres: width / 360,\r\n                        rlatres: (height - 1) / 180,\r\n                        i: i,\r\n                        rawfile: rawfile\r\n                    };\r\n                });\r\n    }\r\n\r\n    setModel(model: GeoidModel | null) {\r\n        this.model = model;\r\n    }\r\n\r\n    protected _rawval(ix: number, iy: number): number {\r\n        let model = this.model!;\r\n\r\n        if (iy < 0) {\r\n            iy = -iy;\r\n            ix += model.width / 2;\r\n        } else if (iy >= model.height) {\r\n            iy = 2 * (model.height - 1) - iy;\r\n            ix += model.width / 2;\r\n        }\r\n\r\n        if (ix < 0) {\r\n            ix += model.width;\r\n        } else if (ix >= model.width) {\r\n            ix -= model.width;\r\n        }\r\n\r\n        let k = (iy * model.width + ix) * 2 + model.i;\r\n\r\n        return (model.rawfile[k] << 8) | model.rawfile[k + 1];\r\n    }\r\n\r\n    public getHeightLonLat(lonlat: LonLat): number {\r\n        return this.getHeight(lonlat.lon, lonlat.lat);\r\n    }\r\n\r\n    public getHeight(lon: number, lat: number): number {\r\n\r\n        if (!this.model) return 0;\r\n\r\n        let model = this.model;\r\n\r\n        if (lon < 0) lon += 360.0;\r\n\r\n        let fy = (90 - lat) * model.rlatres;\r\n        let fx = lon * model.rlonres;\r\n        let iy = Math.floor(fy);\r\n        let ix = Math.floor(fx);\r\n\r\n        fx -= ix;\r\n        fy -= iy;\r\n\r\n        if (iy === (model.height - 1)) {\r\n            iy--;\r\n        }\r\n\r\n        if ((this._cached_ix !== ix) || (this._cached_iy !== iy)) {\r\n\r\n            this._cached_ix = ix;\r\n            this._cached_iy = iy;\r\n\r\n            this._v00 = this._rawval(ix, iy);\r\n            this._v01 = this._rawval(ix + 1, iy);\r\n            this._v10 = this._rawval(ix, iy + 1);\r\n            this._v11 = this._rawval(ix + 1, iy + 1);\r\n        }\r\n\r\n        let a = (1 - fx) * this._v00 + fx * this._v01;\r\n        let b = (1 - fx) * this._v10 + fx * this._v11;\r\n\r\n        let h = (1 - fy) * a + fy * b;\r\n\r\n        return model.offset + model.scale * h;\r\n    }\r\n}\r\n\r\nexport {Geoid};","import * as utils from '../utils/shared';\r\nimport {BaseGeoImage} from \"../layer/BaseGeoImage\";\r\nimport {Framebuffer} from '../webgl/Framebuffer';\r\nimport {LonLat} from '../LonLat';\r\nimport {Program} from '../webgl/Program';\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {doubleToTwoFloats2} from \"../math/coder\";\r\nimport type {WebGLBufferExt, WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\nexport class GeoImageCreator {\r\n\r\n    public MAX_FRAMES: number;\r\n\r\n    protected _gridSize: number;\r\n    protected _planet: Planet;\r\n    public _framebuffer: Framebuffer | null;\r\n    protected _framebufferMercProj: Framebuffer | null;\r\n    public _texCoordsBuffer: WebGLBufferExt | null;\r\n    public _indexBuffer: WebGLBufferExt | null;\r\n    protected _currentFrame: number;\r\n    protected _queue: BaseGeoImage[];\r\n    protected _animate: BaseGeoImage[];\r\n    protected _quadTexCoordsBuffer: WebGLBufferExt | null;\r\n    protected _quadVertexBuffer: WebGLTextureExt | null;\r\n\r\n    constructor(planet: Planet, maxFrames: number = 5) {\r\n        this.MAX_FRAMES = maxFrames;\r\n        this._gridSize = 64;\r\n        this._planet = planet;\r\n        this._framebuffer = null;\r\n        this._framebufferMercProj = null;\r\n        this._texCoordsBuffer = null;\r\n        this._indexBuffer = null;\r\n        this._currentFrame = 0;\r\n        this._queue = [];\r\n        this._animate = [];\r\n        this._quadTexCoordsBuffer = null;\r\n        this._quadVertexBuffer = null;\r\n    }\r\n\r\n    public init() {\r\n        this._initShaders();\r\n        this._initBuffers();\r\n    }\r\n\r\n    /**\r\n     * Creates geoImage corners coordinates grid buffer.\r\n     * @public\r\n     * @param{Array.<LonLat>} c - GeoImage corners coordinates.\r\n     * @param{boolean} [toMerc=false] - Transform to web mercator.\r\n     * @return{WebGLBuffer} Grid coordinates buffer.\r\n     */\r\n    public createGridBuffer(c: LonLat[], toMerc: boolean = false): [WebGLBufferExt, WebGLBufferExt] {\r\n        let gs = this._gridSize;\r\n\r\n        let v03 = new LonLat((c[3].lon - c[0].lon) / gs, (c[3].lat - c[0].lat) / gs),\r\n            v12 = new LonLat((c[2].lon - c[1].lon) / gs, (c[2].lat - c[1].lat) / gs),\r\n            v01 = new LonLat((c[1].lon - c[0].lon) / gs, (c[1].lat - c[0].lat) / gs),\r\n            v32 = new LonLat((c[2].lon - c[3].lon) / gs, (c[2].lat - c[3].lat) / gs);\r\n\r\n        const size = (gs + 1) * (gs + 1) * 2,\r\n            halfSize = size / 2;\r\n\r\n        let gridHigh = new Float32Array(size),\r\n            gridLow = new Float32Array(size);\r\n\r\n        let lonLatArr = new Array(halfSize);\r\n\r\n        let kh = 0,\r\n            kl = 0,\r\n            k = 0;\r\n\r\n        let tempArr = new Float32Array(2);\r\n\r\n        for (let i = 0; i <= gs; i++) {\r\n\r\n            let P03i = new LonLat(c[0].lon + i * v03.lon, c[0].lat + i * v03.lat),\r\n                P12i = new LonLat(c[1].lon + i * v12.lon, c[1].lat + i * v12.lat);\r\n\r\n            for (let j = 0; j <= gs; j++) {\r\n                let P01j = new LonLat(c[0].lon + j * v01.lon, c[0].lat + j * v01.lat),\r\n                    P32j = new LonLat(c[3].lon + j * v32.lon, c[3].lat + j * v32.lat);\r\n                let xx = utils.getLinesIntersectionLonLat(P03i, P12i, P01j, P32j)!;\r\n                doubleToTwoFloats2(xx.lon, tempArr);\r\n                gridHigh[kh++] = tempArr[0];\r\n                gridLow[kl++] = tempArr[1];\r\n                doubleToTwoFloats2(xx.lat, tempArr);\r\n                gridHigh[kh++] = tempArr[0];\r\n                gridLow[kl++] = tempArr[1];\r\n\r\n                lonLatArr[k++] = xx;\r\n            }\r\n        }\r\n\r\n        if (toMerc) {\r\n            for (let i = 0; i < halfSize; i++) {\r\n                let c = lonLatArr[i].forwardMercator();\r\n                doubleToTwoFloats2(c.lon, tempArr);\r\n                gridHigh[i * 2] = tempArr[0];\r\n                gridLow[i * 2] = tempArr[1];\r\n\r\n                doubleToTwoFloats2(c.lat, tempArr);\r\n                gridHigh[i * 2 + 1] = tempArr[0];\r\n                gridLow[i * 2 + 1] = tempArr[1];\r\n            }\r\n        }\r\n\r\n        return [\r\n            this._planet.renderer!.handler.createArrayBuffer(gridHigh, 2, halfSize),\r\n            this._planet.renderer!.handler.createArrayBuffer(gridLow, 2, halfSize)\r\n        ];\r\n    }\r\n\r\n    public frame() {\r\n        let i = this.MAX_FRAMES;\r\n        while (i-- && this._queue.length) {\r\n            const q = this._queue.shift()!;\r\n            q._isRendering = false;\r\n            q.rendering();\r\n            q.events.dispatch(q.events.loadend);\r\n        }\r\n\r\n        i = this._animate.length;\r\n        while (i--) {\r\n            this._animate[i].rendering();\r\n        }\r\n    }\r\n\r\n    public add(geoImage: BaseGeoImage) {\r\n        if (!geoImage._isRendering) {\r\n            geoImage._isRendering = true;\r\n            if (geoImage._animate) {\r\n                this._animate.push(geoImage);\r\n            } else {\r\n                this._queue.push(geoImage);\r\n            }\r\n        }\r\n    }\r\n\r\n    public remove(geoImage: BaseGeoImage) {\r\n        if (geoImage._isRendering) {\r\n            geoImage._creationProceeding = false;\r\n            geoImage._isRendering = false;\r\n            let arr: BaseGeoImage[];\r\n            if (geoImage._animate) {\r\n                arr = this._animate;\r\n            } else {\r\n                arr = this._queue;\r\n            }\r\n            for (let i = 0; i < arr.length; i++) {\r\n                if (arr[i].isEqual(geoImage)) {\r\n                    arr.splice(i, 1);\r\n                    return;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _initBuffers() {\r\n\r\n        let h = this._planet.renderer!.handler!;\r\n\r\n        this._framebuffer = new Framebuffer(h, {width: 2, height: 2, useDepth: false});\r\n        this._framebuffer.init();\r\n\r\n        this._framebufferMercProj = new Framebuffer(h, {width: 2, height: 2, useDepth: false});\r\n        this._framebufferMercProj.init();\r\n\r\n        let gs = Math.log2(this._gridSize);\r\n\r\n        this._texCoordsBuffer = this._planet._textureCoordsBufferCache[gs];\r\n\r\n        this._indexBuffer = this._planet._indexesCache[gs][gs][gs][gs][gs].buffer;\r\n\r\n        this._quadTexCoordsBuffer = h.createArrayBuffer(new Float32Array([0, 1, 1, 1, 0, 0, 1, 0]), 2, 4);\r\n        this._quadVertexBuffer = h.createArrayBuffer(new Float32Array([-1, 1, 1, 1, -1, -1, 1, -1]), 2, 4);\r\n    }\r\n\r\n    protected _initShaders() {\r\n\r\n        this._planet.renderer!.handler.addProgram(new Program(\"geoImageTransform\", {\r\n            uniforms: {\r\n                sourceTexture: \"sampler2d\",\r\n                extentParamsHigh: \"vec4\",\r\n                extentParamsLow: \"vec4\",\r\n                isFullExtent: \"bool\"\r\n            },\r\n            attributes: {\r\n                cornersHigh: \"vec2\",\r\n                cornersLow: \"vec2\",\r\n                texCoords: \"vec2\"\r\n            },\r\n            vertexShader:\r\n                `attribute vec2 cornersHigh; \r\n                     attribute vec2 cornersLow;\r\n                      attribute vec2 texCoords; \r\n                      uniform vec4 extentParamsHigh; \r\n                      uniform vec4 extentParamsLow; \r\n                      varying vec2 v_texCoords;\r\n                      void main() {                                                             \r\n                          v_texCoords = texCoords; \r\n                          vec2 highDiff = cornersHigh - extentParamsHigh.xy;\r\n                          vec2 lowDiff = cornersLow - extentParamsLow.xy;                                        \r\n                          gl_Position = vec4((-1.0 + (highDiff * step(1.0, length(highDiff)) + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0), 0.0, 1.0); \r\n                      }`,\r\n            fragmentShader:\r\n                `precision highp float;\r\n                        uniform sampler2D sourceTexture;\r\n                        uniform bool isFullExtent;\r\n                        varying vec2 v_texCoords;\r\n                        void main () {\r\n                            if(!isFullExtent && (v_texCoords.x <= 0.001 || v_texCoords.x >= 0.999 ||\r\n                                v_texCoords.y <= 0.001 || v_texCoords.y >= 0.999)) {\r\n                                discard;\r\n                            }\r\n                            gl_FragColor = texture2D(sourceTexture, v_texCoords);\r\n                        }`\r\n        }));\r\n    }\r\n}","import {createEvents} from '../Events';\r\nimport type {EventsHandler} from '../Events';\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Segment} from \"../segment/Segment\";\r\n\r\ntype LoaderEventsList = [\"loadend\", \"layerloadend\"];\r\n\r\nconst LOADER_EVENTS: LoaderEventsList = [\"loadend\", \"layerloadend\"];\r\n\r\nexport interface IResponse {\r\n    status: string;\r\n    data?: any;\r\n    msg?: string;\r\n}\r\n\r\ntype IResponseCallback = (response: IResponse) => void;\r\n\r\n// interface IResponseHandler {\r\n//     json: (r: Response) => Promise<any>;\r\n//     blob: (r: Response) => Promise<Blob>;\r\n//     arrayBuffer: (r: Response) => Promise<ArrayBuffer>;\r\n//     imageBitmap: (r: Response) => Promise<ImageBitmap>;\r\n//     text: (r: Response) => Promise<string>;\r\n// }\r\n\r\ninterface Obj<T> {\r\n    __id: number;\r\n    isIdle: boolean;\r\n    isEqual: (obj: T) => boolean;\r\n    events: EventsHandler<any>\r\n    _planet: Planet | null;\r\n\r\n}\r\n\r\ntype QueryParams<T> = {\r\n    sender?: T,\r\n    src: string,\r\n    type: string,\r\n    filter?: (val: QueryParams<T>) => boolean,\r\n    options?: any,\r\n    segment?: Segment\r\n};\r\n\r\ntype QueueData<T> = {\r\n    params: QueryParams<T>,\r\n    callback: IResponseCallback\r\n};\r\n\r\ntype RequestCounter<T> = {\r\n    sender: T,\r\n    counter: number,\r\n    __requestCounterFrame__: number\r\n};\r\n\r\n\r\nexport class Loader<T extends Obj<T>> {\r\n    public MAX_REQUESTS: number;\r\n\r\n    public events: EventsHandler<LoaderEventsList>;\r\n\r\n    protected _loading: number;\r\n\r\n    protected _queue: QueueData<T>[];//new QueueArray();\r\n\r\n    protected _senderRequestCounter: RequestCounter<T>[];\r\n\r\n    protected _promises: { [key: string]: (r: Response) => Promise<any> };//IResponseHandler;\r\n\r\n    constructor(maxRequests: number = 24) {\r\n\r\n        this.MAX_REQUESTS = maxRequests;\r\n\r\n        this.events = createEvents(LOADER_EVENTS);\r\n\r\n        this._loading = 0;\r\n\r\n        this._queue = [];//new QueueArray();\r\n\r\n        this._senderRequestCounter = [];\r\n\r\n        this._promises = {\r\n            'json': r => r.json(),\r\n            'blob': r => r.blob(),\r\n            'arrayBuffer': r => r.arrayBuffer(),\r\n            'imageBitmap': r => r.blob().then(\r\n                (r: Blob) => createImageBitmap(r, {\r\n                    premultiplyAlpha: \"premultiply\"\r\n                })),\r\n            'text': r => r.text()\r\n        };\r\n    }\r\n\r\n    public load(params: QueryParams<T>, callback: IResponseCallback) {\r\n        if (params.sender) {\r\n            if (!this._senderRequestCounter[params.sender.__id]) {\r\n                this._senderRequestCounter[params.sender.__id] = {\r\n                    sender: params.sender, counter: 0, __requestCounterFrame__: 0\r\n                };\r\n            }\r\n            this._senderRequestCounter[params.sender.__id].counter++;\r\n        }\r\n        this._queue.push({params, callback});\r\n        this._exec();\r\n    }\r\n\r\n    public fetch(params: QueryParams<T>) {\r\n        return fetch(params.src, params.options || {})\r\n            .then((response: Response) => {\r\n                if (!response.ok) {\r\n                    throw Error(`Unable to load '${params.src}'`);\r\n                }\r\n                return this._promises[params.type || \"blob\"](response);\r\n            })\r\n\r\n            .then((data: any) => {\r\n                return {status: \"ready\", data: data};\r\n\r\n            })\r\n\r\n            .catch((err: Error) => {\r\n                return {status: \"error\", msg: err.toString()};\r\n            });\r\n    }\r\n\r\n    public getRequestCounter(sender: T): number {\r\n        if (sender) {\r\n            let r = this._senderRequestCounter[sender.__id];\r\n            if (r) {\r\n                return r.counter;\r\n            }\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    public isIdle(sender: T): boolean {\r\n        return sender.isIdle;\r\n    }\r\n\r\n    protected _checkLoadend(request: RequestCounter<T>, sender: T) {\r\n        if (request.counter === 0 && (!sender._planet || sender._planet._terrainCompletedActivated)) {\r\n            sender.events.dispatch(sender.events.loadend, sender);\r\n            this.events.dispatch(this.events.layerloadend, sender);\r\n            request.__requestCounterFrame__ = 0;\r\n        } else {\r\n            request.__requestCounterFrame__ = requestAnimationFrame(() => {\r\n                this._checkLoadend(request, sender);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected _handleResponse(q: QueueData<T>, response: IResponse) {\r\n        q.callback(response);\r\n        let sender = q.params.sender;\r\n        if (sender && (sender.events.loadend!.handlers.length || this.events.layerloadend!.handlers.length)) {\r\n            let request = this._senderRequestCounter[sender.__id];\r\n            if (request && request.counter > 0) {\r\n                request.counter--;\r\n                cancelAnimationFrame(request.__requestCounterFrame__!);\r\n                request.__requestCounterFrame__ = requestAnimationFrame(() => {\r\n                    this._checkLoadend(request, sender!);\r\n                });\r\n            }\r\n        }\r\n        this._exec();\r\n    }\r\n\r\n    protected _exec() {\r\n\r\n        if (this._queue.length > 0 && this._loading < this.MAX_REQUESTS) {\r\n\r\n            let q = this._queue.pop()!;\r\n\r\n            if (!q) return;\r\n\r\n            let p = q.params;\r\n\r\n            if (!p.filter || p.filter(p)) {\r\n\r\n                this._loading++;\r\n\r\n                return fetch(p.src!, p.options || {})\r\n                    .then((response: Response) => {\r\n                        if (!response.ok) {\r\n                            throw Error(`Unable to load '${p.src}'`);\r\n                        }\r\n                        return this._promises[p.type || \"blob\"](response);\r\n                    })\r\n                    .then((data: any) => {\r\n                        this._loading--;\r\n                        this._handleResponse(q, {status: \"ready\", data: data});\r\n                    })\r\n                    .catch((err: Error) => {\r\n                        this._loading--;\r\n                        this._handleResponse(q, {status: \"error\", msg: err.toString()});\r\n                    });\r\n\r\n            } else {\r\n                this._handleResponse(q, {status: \"abort\"});\r\n            }\r\n        } else if (this._loading === 0) {\r\n            this.events.dispatch(this.events.loadend);\r\n        }\r\n    }\r\n\r\n    public abort(sender: T) {\r\n\r\n        if (this._senderRequestCounter[sender.__id]) {\r\n            this._senderRequestCounter[sender.__id].counter = 0;\r\n            cancelAnimationFrame(this._senderRequestCounter[sender.__id].__requestCounterFrame__);\r\n            this._senderRequestCounter[sender.__id].__requestCounterFrame__ = 0;\r\n        }\r\n\r\n        for (let i = 0, len = this._queue.length; i < len; i++) {\r\n            let qi = this._queue[i];\r\n            if (qi && qi.params.sender && sender.isEqual(qi.params.sender)) {\r\n                qi.callback({'status': \"abort\"});\r\n                //@ts-ignore\r\n                this._queue[i] = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    public abortAll() {\r\n        for (let i = 0, len = this._queue.length; i < len; i++) {\r\n            let qi = this._queue[i];\r\n            if (qi) {\r\n                let sender = qi.params.sender;\r\n                if (sender && this._senderRequestCounter[sender.__id]) {\r\n                    this._senderRequestCounter[sender.__id].counter = 0;\r\n                    cancelAnimationFrame(this._senderRequestCounter[sender.__id].__requestCounterFrame__);\r\n                    this._senderRequestCounter[sender.__id].__requestCounterFrame__ = 0;\r\n                }\r\n                qi.callback({'status': \"abort\"});\r\n                //@ts-ignore\r\n                this._queue[i] = null;\r\n            }\r\n        }\r\n        this._queue = [];\r\n    }\r\n\r\n    public get loading(): number {\r\n        return this._loading;\r\n    }\r\n\r\n    public get queue(): QueueData<T>[] {\r\n        return this._queue;\r\n    }\r\n}","import * as quadTree from \"../quadTree/quadTree\";\r\nimport {Framebuffer} from \"../webgl/Framebuffer\";\r\nimport {Lock, Key} from \"../Lock\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Program} from \"../webgl/Program\";\r\nimport {QueueArray} from \"../QueueArray\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport type {WebGLBufferExt, WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\ninterface INormalMapCreatorParams {\r\n    minTableSize?: number;\r\n    maxTableSize?: number;\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\nexport class NormalMapCreator {\r\n\r\n    protected _minTabelSize: number;\r\n    protected _maxTableSize: number;\r\n\r\n    protected _planet: Planet;\r\n    protected _handler: Handler | null;\r\n    protected _verticesBufferArray: WebGLBufferExt[];\r\n    protected _indexBufferArray: WebGLBufferExt[];\r\n    protected _positionBuffer: WebGLBufferExt | null;\r\n    protected _framebuffer: Framebuffer | null;\r\n    protected _normalMapVerticesTexture: WebGLTextureExt | null;\r\n\r\n    protected _width: number;\r\n    protected _height: number;\r\n\r\n    protected _queue: QueueArray<Segment>;\r\n\r\n    protected _lock: Lock;\r\n\r\n    constructor(planet: Planet, options: INormalMapCreatorParams = {}) {\r\n\r\n        this._minTabelSize = options.minTableSize || 1;\r\n        this._maxTableSize = options.maxTableSize || 8;\r\n\r\n        this._planet = planet;\r\n        this._handler = null;\r\n        this._verticesBufferArray = [];\r\n        this._indexBufferArray = [];\r\n        this._positionBuffer = null;\r\n        this._framebuffer = null;\r\n        this._normalMapVerticesTexture = null;\r\n\r\n        this._width = options.width || 128;\r\n        this._height = options.height || 128;\r\n\r\n        this._queue = new QueueArray(1024);\r\n\r\n        this._lock = new Lock();\r\n    }\r\n\r\n    public get width(): number {\r\n        return this._width;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this._height;\r\n    }\r\n\r\n    public init() {\r\n\r\n        this._maxTableSize = this._planet.maxGridSize || 8;\r\n\r\n        this._handler = this._planet.renderer!.handler;\r\n\r\n        let isWebkit = false; //('WebkitAppearance' in document.documentElement.style) && !/^((?!chrome).)*safari/i.test(navigator.userAgent);\r\n\r\n        /*==================================================================================\r\n         * http://www.sunsetlakesoftware.com/2013/10/21/optimizing-gaussian-blurs-mobile-gpu\r\n         *=================================================================================*/\r\n        const normalMapBlur = new Program(\"normalMapBlur\", {\r\n            attributes: {\r\n                a_position: \"vec2\"\r\n            },\r\n            uniforms: {\r\n                s_texture: \"sampler2d\"\r\n            },\r\n            vertexShader:\r\n                `attribute vec2 a_position;\r\n                       attribute vec2 a_texCoord;\r\n\r\n                      varying vec2 blurCoordinates[5];\r\n\r\n                      void main() {\r\n                          vec2 vt = a_position * 0.5 + 0.5; \r\n                          ${isWebkit ? \"vt.y = 1.0 - vt.y; \" : \" \"}\r\n                          gl_Position = vec4(a_position, 0.0, 1.0);\r\n                          blurCoordinates[0] = vt;\r\n                          blurCoordinates[1] = vt + ${(1.0 / this._width) * 1.407333};\r\n                          blurCoordinates[2] = vt - ${(1.0 / this._height) * 1.407333};\r\n                          blurCoordinates[3] = vt + ${(1.0 / this._width) * 3.294215};\r\n                          blurCoordinates[4] = vt - ${(1.0 / this._height) * 3.294215};\r\n                }`,\r\n            fragmentShader: `precision lowp float;\r\n                        uniform sampler2D s_texture;                        \r\n                        varying vec2 blurCoordinates[5];                        \r\n\r\n                        void main() {\r\n                            lowp vec4 sum = vec4(0.0);\r\n                            //if(blurCoordinates[0].x <= 0.01 || blurCoordinates[0].x >= 0.99 ||\r\n                            //    blurCoordinates[0].y <= 0.01 || blurCoordinates[0].y >= 0.99){\r\n                            //    sum = texture2D(s_texture, blurCoordinates[0]);\r\n                            //} else {\r\n                                sum += texture2D(s_texture, blurCoordinates[0]) * 0.204164;\r\n                                sum += texture2D(s_texture, blurCoordinates[1]) * 0.304005;\r\n                                sum += texture2D(s_texture, blurCoordinates[2]) * 0.304005;\r\n                                sum += texture2D(s_texture, blurCoordinates[3]) * 0.093913;\r\n                                sum += texture2D(s_texture, blurCoordinates[4]) * 0.093913;\r\n                            //}\r\n                            gl_FragColor = sum;\r\n                        }`\r\n        });\r\n\r\n        const normalMap = new Program(\"normalMap\", {\r\n            attributes: {\r\n                a_position: \"vec2\",\r\n                a_normal: \"vec3\"\r\n            },\r\n            uniforms: {},\r\n            vertexShader: `attribute vec2 a_position;\r\n                      attribute vec3 a_normal;\r\n                      \r\n                      varying vec3 v_color;\r\n                      \r\n                      void main() {\r\n                          gl_Position = vec4(a_position, 0, 1);\r\n                          v_color = normalize(a_normal) * 0.5 + 0.5;\r\n                      }`,\r\n            fragmentShader: `precision highp float;\r\n                        \r\n                        varying vec3 v_color;\r\n                        \r\n                        void main () {\r\n                            gl_FragColor = vec4(v_color, 1.0);\r\n                        }`\r\n        });\r\n\r\n        this._handler.addProgram(normalMapBlur);\r\n        this._handler.addProgram(normalMap);\r\n\r\n        //create hidden handler buffer\r\n        this._framebuffer = new Framebuffer(this._handler, {\r\n            width: this._width,\r\n            height: this._height,\r\n            useDepth: false\r\n        });\r\n\r\n        this._framebuffer.init();\r\n\r\n        this._normalMapVerticesTexture = this._handler.createEmptyTexture_l(this._width, this._height);\r\n\r\n        //create vertices hasharray for different grid size segments from 2^4(16) to 2^7(128)\r\n        for (let p = this._minTabelSize; p <= this._maxTableSize; p++) {\r\n\r\n            const gs = (1 << p);//Math.pow(2, p);\r\n            const gs2 = gs / 2;\r\n\r\n            let vertices = new Float32Array((gs + 1) * (gs + 1) * 2);\r\n\r\n            for (let i = 0; i <= gs; i++) {\r\n                for (let j = 0; j <= gs; j++) {\r\n                    let ind = (i * (gs + 1) + j) * 2;\r\n                    vertices[ind] = -1 + j / gs2;\r\n                    vertices[ind + 1] = -1 + i / gs2;\r\n                }\r\n            }\r\n\r\n            this._verticesBufferArray[gs] = this._handler.createArrayBuffer(\r\n                vertices,\r\n                2,\r\n                vertices.length / 2\r\n            );\r\n\r\n            this._indexBufferArray[gs] =\r\n                this._planet._indexesCache[Math.log2(gs)][Math.log2(gs)][Math.log2(gs)][Math.log2(gs)][Math.log2(gs)].buffer!;\r\n        }\r\n\r\n        //create 2d screen square buffer\r\n        const positions = new Float32Array([-1.0, -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0]);\r\n\r\n        this._positionBuffer = this._handler.createArrayBuffer(positions, 2, positions.length / 2);\r\n    }\r\n\r\n    protected _drawNormalMapBlur(segment: Segment): boolean {\r\n        let normals = segment.normalMapNormals;\r\n        if (\r\n            segment.node &&\r\n            segment.node.getState() !== quadTree.NOTRENDERING &&\r\n            normals &&\r\n            normals.length\r\n        ) {\r\n            const size = normals.length / 3;\r\n            const gridSize = Math.sqrt(size) - 1;\r\n\r\n            let indBuf = this._verticesBufferArray[gridSize];\r\n\r\n            if (indBuf) {\r\n                if (segment.planet.terrain!.equalizeNormals) {\r\n                    segment._normalMapEdgeEqualize(quadTree.N);\r\n                    segment._normalMapEdgeEqualize(quadTree.S);\r\n                    segment._normalMapEdgeEqualize(quadTree.W);\r\n                    segment._normalMapEdgeEqualize(quadTree.E);\r\n                }\r\n\r\n                let outTexture = segment.normalMapTexturePtr;\r\n\r\n                const h = this._handler!;\r\n                const gl = h.gl!;\r\n\r\n                let _normalsBuffer = h.createArrayBuffer(normals, 3, size, gl.DYNAMIC_DRAW);\r\n\r\n                const f = this._framebuffer!;\r\n                let p = h.programs.normalMap;\r\n                let sha = p._program.attributes;\r\n\r\n                f.bindOutputTexture(this._normalMapVerticesTexture!);\r\n\r\n                p.activate();\r\n\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, indBuf);\r\n                gl.vertexAttribPointer(sha.a_position, indBuf.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, _normalsBuffer);\r\n                gl.vertexAttribPointer(sha.a_normal, _normalsBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBufferArray[gridSize]);\r\n                gl.drawElements(\r\n                    gl.TRIANGLE_STRIP,\r\n                    this._indexBufferArray[gridSize].numItems,\r\n                    gl.UNSIGNED_INT,\r\n                    0\r\n                );\r\n\r\n                gl.deleteBuffer(_normalsBuffer);\r\n\r\n                //\r\n                // blur pass\r\n                //\r\n                f.bindOutputTexture(outTexture!);\r\n\r\n                p = h.programs.normalMapBlur;\r\n\r\n                p.activate();\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, this._positionBuffer!);\r\n                gl.vertexAttribPointer(\r\n                    p._program.attributes.a_position,\r\n                    this._positionBuffer!.itemSize,\r\n                    gl.FLOAT,\r\n                    false,\r\n                    0,\r\n                    0\r\n                );\r\n                gl.activeTexture(gl.TEXTURE0);\r\n                gl.bindTexture(gl.TEXTURE_2D, this._normalMapVerticesTexture!);\r\n                gl.uniform1i(p._program.uniforms.s_texture, 0);\r\n                gl.drawArrays(gl.TRIANGLE_STRIP, 0, this._positionBuffer!.numItems);\r\n                return true;\r\n            } else {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected _drawNormalMapNoBlur(segment: Segment): boolean {\r\n        let normals = segment.normalMapNormals;\r\n        if (\r\n            segment.node &&\r\n            segment.node.getState() !== quadTree.NOTRENDERING &&\r\n            normals &&\r\n            normals.length\r\n        ) {\r\n            const size = normals.length / 3;\r\n            const gridSize = Math.sqrt(size) - 1;\r\n\r\n            let indBuf = this._verticesBufferArray[gridSize];\r\n\r\n            if (indBuf) {\r\n                if (segment.planet.terrain!.equalizeNormals) {\r\n                    segment._normalMapEdgeEqualize(quadTree.N);\r\n                    segment._normalMapEdgeEqualize(quadTree.S);\r\n                    segment._normalMapEdgeEqualize(quadTree.W);\r\n                    segment._normalMapEdgeEqualize(quadTree.E);\r\n                }\r\n\r\n                let outTexture = segment.normalMapTexturePtr;\r\n\r\n                const h = this._handler!;\r\n                const gl = h.gl!;\r\n\r\n                let _normalsBuffer = h.createArrayBuffer(normals, 3, size, gl.DYNAMIC_DRAW);\r\n\r\n                const f = this._framebuffer!;\r\n                const p = h.programs.normalMap;\r\n                const sha = p._program.attributes;\r\n\r\n                f.bindOutputTexture(outTexture!);\r\n\r\n                p.activate();\r\n\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, indBuf);\r\n                gl.vertexAttribPointer(sha.a_position, indBuf.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                gl.bindBuffer(gl.ARRAY_BUFFER, _normalsBuffer);\r\n                gl.vertexAttribPointer(sha.a_normal, _normalsBuffer.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBufferArray[gridSize]);\r\n                gl.drawElements(\r\n                    gl.TRIANGLE_STRIP,\r\n                    this._indexBufferArray[gridSize].numItems,\r\n                    gl.UNSIGNED_INT,\r\n                    0\r\n                );\r\n\r\n                gl.deleteBuffer(_normalsBuffer);\r\n\r\n                return true;\r\n            } else {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected _drawNormalMap(segment: Segment) {\r\n        if (segment.planet.terrain!.isBlur(segment)) {\r\n            return this._drawNormalMapBlur(segment);\r\n        } else {\r\n            return this._drawNormalMapNoBlur(segment);\r\n        }\r\n    }\r\n\r\n    public drawSingle(segment: Segment) {\r\n        const h = this._handler!;\r\n        const gl = h.gl!;\r\n\r\n        this._framebuffer!.activate();\r\n\r\n        gl.disable(gl.CULL_FACE);\r\n        gl.disable(gl.DEPTH_TEST);\r\n        gl.disable(gl.BLEND);\r\n\r\n        if (segment.terrainReady && this._drawNormalMap(segment)) {\r\n            segment.normalMapReady = true;\r\n            segment.normalMapTexture = segment.normalMapTexturePtr;\r\n            segment.normalMapTextureBias[0] = 0;\r\n            segment.normalMapTextureBias[1] = 0;\r\n            segment.normalMapTextureBias[2] = 1;\r\n        }\r\n        segment._inTheQueue = false;\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n        gl.enable(gl.CULL_FACE);\r\n        gl.enable(gl.BLEND);\r\n\r\n        this._framebuffer!.deactivate();\r\n    }\r\n\r\n    public frame() {\r\n        if (this._queue.length) {\r\n            const h = this._handler!;\r\n            const gl = h.gl!;\r\n\r\n            this._framebuffer!.activate();\r\n\r\n            gl.disable(gl.CULL_FACE);\r\n            gl.disable(gl.DEPTH_TEST);\r\n            gl.disable(gl.BLEND);\r\n\r\n            let deltaTime = 0,\r\n                startTime = window.performance.now();\r\n\r\n            while (this._lock.isFree() && this._queue.length && deltaTime < 0.25) {\r\n                const segment = this._queue.shift()!;\r\n                if (segment.terrainReady && this._drawNormalMap(segment)) {\r\n                    segment.normalMapReady = true;\r\n                    segment.normalMapTexture = segment.normalMapTexturePtr;\r\n                    segment.normalMapTextureBias[0] = 0;\r\n                    segment.normalMapTextureBias[1] = 0;\r\n                    segment.normalMapTextureBias[2] = 1;\r\n                }\r\n                segment._inTheQueue = false;\r\n                deltaTime = window.performance.now() - startTime;\r\n            }\r\n\r\n            gl.enable(gl.BLEND);\r\n            gl.enable(gl.DEPTH_TEST);\r\n            gl.enable(gl.CULL_FACE);\r\n\r\n            this._framebuffer!.deactivate();\r\n        }\r\n    }\r\n\r\n    public get queueSize(): number {\r\n        return this._queue.length;\r\n    }\r\n\r\n    public queue(segment: Segment) {\r\n        segment._inTheQueue = true;\r\n        this._queue.push(segment);\r\n    }\r\n\r\n    public unshift(segment: Segment) {\r\n        segment._inTheQueue = true;\r\n        this._queue.unshift(segment);\r\n    }\r\n\r\n    public remove(segment: Segment) {\r\n        //...\r\n    }\r\n\r\n    public clear() {\r\n        while (this._queue.length) {\r\n            let s = this._queue.pop()!;\r\n            s._inTheQueue = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set activity off\r\n     * @public\r\n     */\r\n    public lock(key: Key) {\r\n        this._lock.lock(key);\r\n    }\r\n\r\n    /**\r\n     * Set activity on\r\n     * @public\r\n     */\r\n    public free(key: Key) {\r\n        this._lock.free(key);\r\n    }\r\n\r\n}","/**\r\n * @module og/proj/equi\r\n */\r\n\r\nimport { Proj, Units } from \"./Proj\";\r\n\r\n/**\r\n * Any equrectangualr projection object.\r\n * @type {Proj}\r\n */\r\nexport const equi = new Proj({ code: \"equi\", units: Units.DEGREES });\r\n","// import { QueueArray } from '../QueueArray.js';\r\nimport {EPSG4326} from \"../proj/EPSG4326\";\r\nimport {equi} from \"../proj/equi\";\r\nimport {BaseWorker} from \"./BaseWorker\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {Geoid} from \"../terrain/Geoid\";\r\n//@ts-ignore\r\nimport PlainSegmentWorkerImpl from './PlainSegmentWorker.worker.js?worker&inline';\r\n\r\nexport interface IPlainSegmentWorkerData {\r\n    plainVertices: Float64Array | null;\r\n    plainVerticesHigh: Float32Array | null;\r\n    plainVerticesLow: Float32Array | null;\r\n    plainNormals: Float32Array | null;\r\n    plainRadius: number;\r\n\r\n    normalMapNormals: Float32Array | null;\r\n    normalMapVertices: Float64Array | null;\r\n    normalMapVerticesHigh: Float32Array | null;\r\n    normalMapVerticesLow: Float32Array | null;\r\n}\r\n\r\ntype MessageEventExt = MessageEvent & {\r\n    data: IPlainSegmentWorkerData\r\n}\r\n\r\nclass PlainSegmentWorker extends BaseWorker<Segment> {\r\n    constructor(numWorkers: number = 2) {\r\n        super(numWorkers, PlainSegmentWorkerImpl);\r\n    }\r\n\r\n    protected override _onMessage(e: MessageEventExt) {\r\n        this._source.get(e.data.id)!._plainSegmentWorkerCallback(e.data);\r\n\r\n        e.data.plainVertices = null;\r\n        e.data.plainVerticesHigh = null;\r\n        e.data.plainVerticesLow = null;\r\n        e.data.plainNormals = null;\r\n        e.data.normalMapNormals = null;\r\n        e.data.normalMapVertices = null;\r\n        e.data.normalMapVerticesHigh = null;\r\n        e.data.normalMapVerticesLow = null;\r\n\r\n        this._source.delete(e.data.id)\r\n    }\r\n\r\n    public setGeoid(geoid: Geoid) {\r\n\r\n        if (geoid.model) {\r\n            let m = geoid.model;\r\n            let model = {\r\n                scale: m.scale,\r\n                offset: m.offset,\r\n                width: m.width,\r\n                height: m.height,\r\n                rlonres: m.rlonres,\r\n                rlatres: m.rlatres,\r\n                i: m.i\r\n            };\r\n\r\n            this._workerQueue.forEach((w) => {\r\n                let rawfile = new Uint8Array(m.rawfile.length);\r\n                rawfile.set(m.rawfile);\r\n\r\n                w.postMessage({\r\n                        model: model,\r\n                        rawfile: rawfile\r\n                    }, [\r\n                        rawfile.buffer\r\n                    ]\r\n                );\r\n            });\r\n        } else {\r\n            this._workerQueue.forEach((w) => {\r\n                w.postMessage({\r\n                    model: null\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n    public override make(segment: Segment) {\r\n        if (segment.initialized) {\r\n            if (this._workerQueue.length) {\r\n                let w = this._workerQueue.pop()!;\r\n\r\n                this._source.set(this._sourceId, segment);\r\n\r\n                let isLonLat = (segment._projection.id === EPSG4326.id || segment._projection.id === equi.id) ? 1.0 : 0.0;\r\n\r\n                let params = new Float64Array([\r\n                    this._sourceId,\r\n                    isLonLat,\r\n                    segment.planet.terrain!.gridSizeByZoom[segment.tileZoom],\r\n                    segment.planet.terrain!.plainGridSize,\r\n                    segment._extent.southWest.lon,\r\n                    segment._extent.southWest.lat,\r\n                    segment._extent.northEast.lon,\r\n                    segment._extent.northEast.lat,\r\n                    // @ts-ignore\r\n                    segment.planet.ellipsoid._e2,\r\n                    segment.planet.ellipsoid.equatorialSize,\r\n                    segment.planet.ellipsoid._invRadii2.x,\r\n                    segment.planet.ellipsoid._invRadii2.y,\r\n                    segment.planet.ellipsoid._invRadii2.z,\r\n                    segment.planet._heightFactor\r\n                ]);\r\n\r\n                this._sourceId++;\r\n\r\n                w.postMessage({\r\n                    params: params\r\n                }, [\r\n                    params.buffer\r\n                ]);\r\n            } else {\r\n                this._pendingQueue.push(segment);\r\n            }\r\n        } else {\r\n            this.check();\r\n        }\r\n    }\r\n}\r\n\r\nexport {PlainSegmentWorker};\r\n","import {Box} from \"../bv/Box\";\r\nimport {Mat4, type NumberArray16} from \"../math/Mat4\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {RADIANS_HALF} from \"../math\";\r\n\r\nfunction planeNormalize(plane: NumberArray4) {\r\n    let t = 1.0 / Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\r\n    plane[0] *= t;\r\n    plane[1] *= t;\r\n    plane[2] *= t;\r\n    plane[3] *= t;\r\n}\r\n\r\ninterface IFrustumParams {\r\n    cameraFrustumIndex?: number;\r\n    fov?: number;\r\n    aspect?: number,\r\n    near?: number;\r\n    far?: number;\r\n}\r\n\r\n/**\r\n * Frustum object, part of the camera object.\r\n * @class\r\n * @param {*} options\r\n */\r\nclass Frustum {\r\n\r\n    protected _f: [NumberArray4, NumberArray4, NumberArray4, NumberArray4, NumberArray4, NumberArray4];\r\n\r\n    /**\r\n     * Camera projection matrix.\r\n     * @protected\r\n     * @type {Mat4}\r\n     */\r\n    public projectionMatrix: Mat4;\r\n\r\n    /**\r\n     * Camera inverse projection matrix.\r\n     * @protected\r\n     * @type {Mat4}\r\n     */\r\n    public inverseProjectionMatrix: Mat4;\r\n\r\n    /**\r\n     * Product of projection and view matrices.\r\n     * @protected\r\n     * @type {Mat4}\r\n     */\r\n    public projectionViewMatrix: Mat4;\r\n\r\n    public projectionViewRTEMatrix: Mat4;\r\n\r\n    /**\r\n     * Inverse projectionView Matrix.\r\n     * @protected\r\n     * @type {Mat4}\r\n     */\r\n    public inverseProjectionViewMatrix: Mat4;\r\n\r\n    /**\r\n     * Projection frustum left value.\r\n     * @public\r\n     */\r\n    public left: number;\r\n    /**\r\n     * Projection frustum right value.\r\n     * @public\r\n     */\r\n    public right: number;\r\n    /**\r\n     * Projection frustum bottom value.\r\n     * @public\r\n     */\r\n    public bottom: number;\r\n    /**\r\n     * Projection frustum top value.\r\n     * @public\r\n     */\r\n    public top: number;\r\n    /**\r\n     * Projection frustum near value.\r\n     * @public\r\n     */\r\n    public near: number;\r\n    /**\r\n     * Projection frustum far value.\r\n     * @public\r\n     */\r\n    public far: number;\r\n\r\n    public cameraFrustumIndex: number;\r\n\r\n    public _pickingColorU: Float32Array = new Float32Array([0, 0, 0]);\r\n\r\n    constructor(options: IFrustumParams = {}) {\r\n\r\n        this._f = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]];\r\n\r\n        this.projectionMatrix = new Mat4();\r\n\r\n        this.inverseProjectionMatrix = new Mat4();\r\n\r\n        this.projectionViewMatrix = new Mat4();\r\n\r\n        this.projectionViewRTEMatrix = new Mat4();\r\n\r\n        this.inverseProjectionViewMatrix = new Mat4();\r\n\r\n        this.left = 0.0;\r\n\r\n        this.right = 0.0;\r\n\r\n        this.bottom = 0.0;\r\n\r\n        this.top = 0.0;\r\n\r\n        this.near = 0.0;\r\n\r\n        this.far = 0.0;\r\n\r\n        this.cameraFrustumIndex = options.cameraFrustumIndex != undefined ? options.cameraFrustumIndex : -1;\r\n\r\n        this.setProjectionMatrix(\r\n            options.fov || 30.0,\r\n            options.aspect || 1.0,\r\n            options.near || 1.0,\r\n            options.far || 1000.0\r\n        );\r\n    }\r\n\r\n    public getRightPlane(): NumberArray4 {\r\n        return this._f[0];\r\n    }\r\n\r\n    public getLeftPlane(): NumberArray4 {\r\n        return this._f[1];\r\n    }\r\n\r\n    public getBottomPlane(): NumberArray4 {\r\n        return this._f[2];\r\n    }\r\n\r\n    public getTopPlane(): NumberArray4 {\r\n        return this._f[3];\r\n    }\r\n\r\n    public getBackwardPlane(): NumberArray4 {\r\n        return this._f[4];\r\n    }\r\n\r\n    public getForwardPlane(): NumberArray4 {\r\n        return this._f[5];\r\n    }\r\n\r\n    public getProjectionViewMatrix(): NumberArray16 {\r\n        return this.projectionViewMatrix._m;\r\n    }\r\n\r\n    public getProjectionViewRTEMatrix(): NumberArray16 {\r\n        return this.projectionViewRTEMatrix._m;\r\n    }\r\n\r\n    public getProjectionMatrix(): NumberArray16 {\r\n        return this.projectionMatrix._m;\r\n    }\r\n\r\n    public getInverseProjectionMatrix(): NumberArray16 {\r\n        return this.inverseProjectionMatrix._m;\r\n    }\r\n\r\n    /**\r\n     * Sets up camera projection matrix.\r\n     * @public\r\n     * @param {number} angle - Camera's vertical fov view angle.\r\n     * @param {number} aspect - Screen aspect ratio.\r\n     * @param {number} near - Near camera distance.\r\n     * @param {number} far - Far camera distance.\r\n     */\r\n    public setProjectionMatrix(angle: number, aspect: number, near: number, far: number) {\r\n        this.top = near * Math.tan(angle * RADIANS_HALF);\r\n        this.bottom = -this.top;\r\n        this.right = this.top * aspect;\r\n        this.left = -this.right;\r\n        this.near = near;\r\n        this.far = far;\r\n\r\n        this.projectionMatrix.setPerspective(\r\n            this.left,\r\n            this.right,\r\n            this.bottom,\r\n            this.top,\r\n            near,\r\n            far\r\n        );\r\n        this.projectionMatrix.inverseTo(this.inverseProjectionMatrix);\r\n    }\r\n\r\n    public setProjectionViewRTEMatrix(viewRTEMatrix: Mat4) {\r\n        this.projectionViewRTEMatrix = this.projectionMatrix.mul(viewRTEMatrix);\r\n    }\r\n\r\n    /**\r\n     * Camera's projection matrix values.\r\n     * @public\r\n     * @param {Mat4} viewMatrix - View matrix.\r\n     */\r\n    public setViewMatrix(viewMatrix: Mat4) {\r\n        this.projectionViewMatrix = this.projectionMatrix.mul(viewMatrix);\r\n        this.projectionViewMatrix.inverseTo(this.inverseProjectionViewMatrix);\r\n\r\n        let m = this.projectionViewMatrix._m;\r\n\r\n        /* Right */\r\n        this._f[0][0] = m[3] - m[0];\r\n        this._f[0][1] = m[7] - m[4];\r\n        this._f[0][2] = m[11] - m[8];\r\n        this._f[0][3] = m[15] - m[12];\r\n        planeNormalize(this._f[0]);\r\n\r\n        /* Left */\r\n        this._f[1][0] = m[3] + m[0];\r\n        this._f[1][1] = m[7] + m[4];\r\n        this._f[1][2] = m[11] + m[8];\r\n        this._f[1][3] = m[15] + m[12];\r\n        planeNormalize(this._f[1]);\r\n\r\n        /* Bottom */\r\n        this._f[2][0] = m[3] + m[1];\r\n        this._f[2][1] = m[7] + m[5];\r\n        this._f[2][2] = m[11] + m[9];\r\n        this._f[2][3] = m[15] + m[13];\r\n        planeNormalize(this._f[2]);\r\n\r\n        /* Top */\r\n        this._f[3][0] = m[3] - m[1];\r\n        this._f[3][1] = m[7] - m[5];\r\n        this._f[3][2] = m[11] - m[9];\r\n        this._f[3][3] = m[15] - m[13];\r\n        planeNormalize(this._f[3]);\r\n\r\n        /* Backward */\r\n        this._f[4][0] = m[3] - m[2];\r\n        this._f[4][1] = m[7] - m[6];\r\n        this._f[4][2] = m[11] - m[10];\r\n        this._f[4][3] = m[15] - m[14];\r\n        planeNormalize(this._f[4]);\r\n\r\n        /* Forward */\r\n        this._f[5][0] = m[3] + m[2];\r\n        this._f[5][1] = m[7] + m[6];\r\n        this._f[5][2] = m[11] + m[10];\r\n        this._f[5][3] = m[15] + m[14];\r\n        planeNormalize(this._f[5]);\r\n    }\r\n\r\n    /**\r\n     * Returns true if a point in the frustum.\r\n     * @public\r\n     * @param {Vec3} point - Cartesian point.\r\n     * @returns {boolean} -\r\n     */\r\n    public containsPoint(point: Vec3): boolean {\r\n        for (let p = 0; p < 6; p++) {\r\n            let d = point.dotArr(this._f[p]) + this._f[p][3];\r\n            if (d <= 0) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the frustum contains a bonding sphere, but bottom plane exclude.\r\n     * @public\r\n     * @param {Sphere} sphere - Bounding sphere.\r\n     * @returns {boolean} -\r\n     */\r\n    public containsSphereBottomExc(sphere: Sphere): boolean {\r\n        let r = -sphere.radius,\r\n            f = this._f;\r\n        if (sphere.center.dotArr(f[0]) + f[0][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[1]) + f[1][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[3]) + f[3][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[4]) + f[4][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[5]) + f[5][3] <= r) return false;\r\n        return true;\r\n    }\r\n\r\n    public containsSphereButtom(sphere: Sphere): boolean {\r\n        let r = -sphere.radius,\r\n            f = this._f;\r\n        if (sphere.center.dotArr(f[2]) + f[2][3] <= r)\r\n            return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the frustum contains a bonding sphere.\r\n     * @public\r\n     * @param {Sphere} sphere - Bounding sphere.\r\n     * @returns {boolean} -\r\n     */\r\n    public containsSphere(sphere: Sphere): boolean {\r\n        let r = -sphere.radius,\r\n            f = this._f;\r\n        if (sphere.center.dotArr(f[0]) + f[0][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[1]) + f[1][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[2]) + f[2][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[3]) + f[3][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[4]) + f[4][3] <= r) return false;\r\n        if (sphere.center.dotArr(f[5]) + f[5][3] <= r) return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the frustum contains a bonding sphere.\r\n     * @public\r\n     * @param {Vec3} center - Sphere center.\r\n     * @param {number} radius - Sphere radius.\r\n     * @returns {boolean} -\r\n     */\r\n    public containsSphere2(center: Vec3, radius: number): boolean {\r\n        let r = -radius;\r\n        if (center.dotArr(this._f[0]) + this._f[0][3] <= r) return false;\r\n        if (center.dotArr(this._f[1]) + this._f[1][3] <= r) return false;\r\n        if (center.dotArr(this._f[2]) + this._f[2][3] <= r) return false;\r\n        if (center.dotArr(this._f[3]) + this._f[3][3] <= r) return false;\r\n        if (center.dotArr(this._f[4]) + this._f[4][3] <= r) return false;\r\n        if (center.dotArr(this._f[5]) + this._f[5][3] <= r) return false;\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if the frustum contains a bounding box.\r\n     * @public\r\n     * @param {Box} box - Bounding box.\r\n     * @returns {boolean} -\r\n     */\r\n    public containsBox(box: Box): boolean {\r\n        let result: boolean = true,\r\n            cout: number,\r\n            cin: number;\r\n\r\n        for (let i = 0; i < 6; i++) {\r\n            cout = 0;\r\n            cin = 0;\r\n            for (let k = 0; k < 8 && (cin === 0 || cout === 0); k++) {\r\n                let d = box.vertices[k].dotArr(this._f[i]) + this._f[i][3];\r\n                if (d < 0) {\r\n                    cout++;\r\n                } else {\r\n                    cin++;\r\n                }\r\n            }\r\n\r\n            if (cin === 0) {\r\n                return false;\r\n            } else if (cout > 0) {\r\n                result = true;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nexport {Frustum};\r\n","import * as math from \"../math\";\r\nimport {type EventsHandler, createEvents} from \"../Events\";\r\nimport {Frustum} from \"./Frustum\";\r\nimport {Mat3} from \"../math/Mat3\";\r\nimport type {NumberArray9} from \"../math/Mat3\";\r\nimport {Mat4} from \"../math/Mat4\";\r\nimport type {NumberArray16} from \"../math/Mat4\";\r\nimport {Renderer} from \"../renderer/Renderer\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Vec4} from \"../math/Vec4\";\r\nimport {Sphere} from \"../bv/Sphere\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {DEGREES_DOUBLE, RADIANS, RADIANS_HALF} from \"../math\";\r\n\r\ntype CameraEvents = [\"viewchange\", \"moveend\"];\r\n\r\nconst EVENT_NAMES: CameraEvents = [\r\n    /**\r\n     * When camera has been updated.\r\n     * @event og.Camera#viewchange\r\n     */\r\n    \"viewchange\",\r\n\r\n    /**\r\n     * Camera is stopped.\r\n     * @event og.Camera#moveend\r\n     */\r\n    \"moveend\"\r\n];\r\n\r\nexport interface ICameraParams {\r\n    eye?: Vec3;\r\n    viewAngle?: number;\r\n    look?: Vec3;\r\n    up?: Vec3;\r\n    frustums?: NumberArray2[]\r\n    width?: number;\r\n    height?: number;\r\n}\r\n\r\nconst getHorizontalViewAngleByFov = (fov: number, aspect: number) => DEGREES_DOUBLE * Math.atan(Math.tan(RADIANS_HALF * fov) * aspect);\r\n\r\n/**\r\n * Camera class.\r\n * @class\r\n * //@param {Renderer} [renderer] - Renderer uses the camera instance.\r\n * @param {Object} [options] - Camera options:\r\n * @param {Object} [options.name] - Camera name.\r\n * @param {number} [options.viewAngle=47] - Camera angle of view. Default is 47.0\r\n * @param {number} [options.near=1] - Camera near plane distance. Default is 1.0\r\n * @param {number} [options.far=og.math.MAX] - Camera far plane distance. Default is og.math.MAX\r\n * @param {Vec3} [options.eye=[0,0,0]] - Camera eye position. Default (0,0,0)\r\n * @param {Vec3} [options.look=[0,0,0]] - Camera look position. Default (0,0,0)\r\n * @param {Vec3} [options.up=[0,1,0]] - Camera eye position. Default (0,1,0)\r\n *\r\n * @fires EventsHandler<CameraEvents>#viewchange\r\n * @fires EventsHandler<CameraEvents>#moveend\r\n */\r\nclass Camera {\r\n\r\n    // /**\r\n    //  * Assigned renderer\r\n    //  * @public\r\n    //  * @type {Renderer}\r\n    //  */\r\n    // public renderer: Renderer | null;\r\n\r\n    /**\r\n     * Camera events handler\r\n     * @public\r\n     * @type {Events}\r\n     */\r\n    public events: EventsHandler<CameraEvents>;\r\n\r\n    /**\r\n     * Camera position.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public eye: Vec3;\r\n\r\n    /**\r\n     * Camera RTE high position\r\n     * @public\r\n     * @type {Float32Array}\r\n     */\r\n    public eyeHigh: Float32Array;\r\n\r\n    /**\r\n     * Camera RTE low position\r\n     * @public\r\n     * @type {Float32Array}\r\n     */\r\n    public eyeLow: Float32Array;\r\n\r\n    // /**\r\n    //  * Aspect ratio.\r\n    //  * @protected\r\n    //  * @type {Number}\r\n    //  */\r\n    // protected _aspect: number;\r\n\r\n    /**\r\n     * Camera view angle in degrees\r\n     * @protected\r\n     * @type {Number}\r\n     */\r\n    protected _viewAngle: number;\r\n\r\n    protected _horizontalViewAngle: number;\r\n\r\n    /**\r\n     * Camera view matrix.\r\n     * @protected\r\n     * @type {Mat4}\r\n     */\r\n    protected _viewMatrix: Mat4;\r\n    protected _viewMatrixRTE: Mat4;\r\n\r\n    /**\r\n     * Camera normal matrix.\r\n     * @protected\r\n     * @type {Mat3}\r\n     */\r\n    protected _normalMatrix: Mat3;\r\n\r\n    /**\r\n     * Camera right vector.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    public _r: Vec3;\r\n\r\n    /**\r\n     * Camera up vector.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    public _u: Vec3;\r\n\r\n    /**\r\n     * Camera backward vector.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    public _b: Vec3;\r\n\r\n    /**\r\n     * Camera forward vector.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    public _f: Vec3;\r\n\r\n    protected _pr: Vec3;\r\n    protected _pu: Vec3;\r\n    protected _pb: Vec3;\r\n    protected _peye: Vec3;\r\n\r\n    public isMoving: boolean;\r\n\r\n    protected _tanViewAngle_hrad: number;\r\n\r\n    public _tanViewAngle_hradOneByHeight: number;\r\n\r\n    protected _projSizeConst: number;\r\n\r\n    public frustums: Frustum[];\r\n\r\n    public frustumColors: number[];\r\n\r\n    public FARTHEST_FRUSTUM_INDEX: number;\r\n\r\n    public currentFrustumIndex: number;\r\n\r\n    public frustumColorIndex: number;\r\n\r\n    public isFirstPass: boolean;\r\n\r\n    public _width: number;\r\n\r\n    public _height: number;\r\n\r\n    // public dirForwardNED: Vec3;\r\n    // public dirUpNED: Vec3;\r\n    // public dirRightNED: Vec3;\r\n\r\n    constructor(options: ICameraParams = {}) {\r\n        //this.renderer = renderer;\r\n\r\n        this.events = createEvents<CameraEvents>(EVENT_NAMES, this);\r\n\r\n        this._width = options.width || 1;\r\n\r\n        this._height = options.height || 1;\r\n\r\n        this.eye = options.eye || new Vec3();\r\n\r\n        this.eyeHigh = new Float32Array(3);\r\n\r\n        this.eyeLow = new Float32Array(3);\r\n\r\n        this._viewAngle = options.viewAngle || 47.0;\r\n\r\n        this._horizontalViewAngle = 0;\r\n\r\n        this._viewMatrix = new Mat4();\r\n        this._viewMatrixRTE = new Mat4();\r\n\r\n        this._normalMatrix = new Mat3();\r\n\r\n        this._r = new Vec3(1.0, 0.0, 0.0);\r\n        this._u = new Vec3(0.0, 1.0, 0.0);\r\n        this._b = new Vec3(0.0, 0.0, 1.0);\r\n        this._f = this._b.negateTo();\r\n\r\n        // Previous frame values\r\n        this._pr = this._r.clone();\r\n        this._pu = this._u.clone();\r\n        this._pb = this._b.clone();\r\n        this._peye = this.eye.clone();\r\n        this.isMoving = false;\r\n\r\n        this._tanViewAngle_hrad = 0.0;\r\n        this._tanViewAngle_hradOneByHeight = 0.0;\r\n\r\n        this.frustums = [];\r\n\r\n        this.frustumColors = [];\r\n\r\n        if (options.frustums) {\r\n            for (let i = 0, len = options.frustums.length; i < len; i++) {\r\n                let fi = options.frustums[i];\r\n\r\n                let fr = new Frustum({\r\n                    fov: this._viewAngle,\r\n                    aspect: this.getAspectRatio(),//this._aspect,\r\n                    near: fi[0],\r\n                    far: fi[1]\r\n                });\r\n\r\n                fr.cameraFrustumIndex = this.frustums.length;\r\n                this.frustums.push(fr);\r\n                //this.frustumColors.push.apply(this.frustumColors, fr._pickingColorU);\r\n                this.frustumColors.push(fr._pickingColorU[0], fr._pickingColorU[1], fr._pickingColorU[2]);\r\n            }\r\n        } else {\r\n            let near = 0.1,\r\n                far = 1000.0;\r\n\r\n            let fr = new Frustum({\r\n                fov: this._viewAngle,\r\n                aspect: this.getAspectRatio(),\r\n                near: near,\r\n                far: far\r\n            });\r\n\r\n            fr.cameraFrustumIndex = this.frustums.length;\r\n            this.frustums.push(fr);\r\n            //this.frustumColors.push.apply(this.frustumColors, fr._pickingColorU);\r\n            this.frustumColors.push(fr._pickingColorU[0], fr._pickingColorU[1], fr._pickingColorU[2]);\r\n        }\r\n\r\n        this.FARTHEST_FRUSTUM_INDEX = this.frustums.length - 1;\r\n\r\n        this.currentFrustumIndex = 0;\r\n        this.frustumColorIndex = 0;\r\n\r\n        this.isFirstPass = false;\r\n\r\n        this._projSizeConst = 0;\r\n\r\n        this.set(\r\n            options.eye || new Vec3(0.0, 0.0, 1.0),\r\n            options.look || new Vec3(),\r\n            options.up || new Vec3(0.0, 1.0, 0.0)\r\n        );\r\n    }\r\n\r\n    public checkMoveEnd() {\r\n        let r = this._r,\r\n            u = this._u,\r\n            b = this._b,\r\n            eye = this.eye;\r\n\r\n        if (this._peye.equal(eye) && this._pr.equal(r) && this._pu.equal(u) && this._pb.equal(b)) {\r\n            if (this.isMoving) {\r\n                this.events.dispatch(this.events.moveend, this);\r\n            }\r\n            this.isMoving = false;\r\n        } else {\r\n            this.isMoving = true;\r\n        }\r\n\r\n        this._pr.copy(r);\r\n        this._pu.copy(u);\r\n        this._pb.copy(b);\r\n        this._peye.copy(eye);\r\n    }\r\n\r\n    public bindFrustumsPickingColors(renderer: Renderer) {\r\n        for (let i = 0; i < this.frustums.length; i++) {\r\n            renderer.assignPickingColor<Frustum>(this.frustums[i]);\r\n        }\r\n    }\r\n\r\n    // public bindRenderer(renderer: Renderer) {\r\n    //     this.renderer = renderer;\r\n    //     for (let i = 0; i < this.frustums.length; i++) {\r\n    //         this.renderer.assignPickingColor<Frustum>(this.frustums[i]);\r\n    //     }\r\n    //     this._aspect = this.renderer.handler.getClientAspect();\r\n    //\r\n    //     this._setProj(this._viewAngle, this._aspect);\r\n    // }\r\n\r\n    /**\r\n     * Camera initialization.\r\n     * @public\r\n     * @param {Object} [options] - Camera options:\r\n     * @param {number} [options.viewAngle] - Camera angle of view.\r\n     * @param {number} [options.near] - Camera near plane distance. Default is 1.0\r\n     * @param {number} [options.far] - Camera far plane distance. Default is math.MAX\r\n     * @param {Vec3} [options.eye] - Camera eye position. Default (0,0,0)\r\n     * @param {Vec3} [options.look] - Camera look position. Default (0,0,0)\r\n     * @param {Vec3} [options.up] - Camera eye position. Default (0,1,0)\r\n     */\r\n    protected _init(options: ICameraParams) {\r\n\r\n        this._setProj(this._viewAngle, this.getAspectRatio());\r\n\r\n        this.set(\r\n            options.eye || new Vec3(0.0, 0.0, 1.0),\r\n            options.look || new Vec3(),\r\n            options.up || new Vec3(0.0, 1.0, 0.0)\r\n        );\r\n    }\r\n\r\n    public getUp(): Vec3 {\r\n        return this._u.clone();\r\n    }\r\n\r\n    public getDown(): Vec3 {\r\n        return this._u.negateTo();\r\n    }\r\n\r\n    public getRight(): Vec3 {\r\n        return this._r.clone();\r\n    }\r\n\r\n    public getLeft(): Vec3 {\r\n        return this._r.negateTo();\r\n    }\r\n\r\n    public getForward(): Vec3 {\r\n        return this._f.clone();\r\n    }\r\n\r\n    public getBackward(): Vec3 {\r\n        return this._b.clone();\r\n    }\r\n\r\n    /**\r\n     * Updates camera view space\r\n     * @public\r\n     * @virtual\r\n     */\r\n    public update() {\r\n        let u = this._r,\r\n            v = this._u,\r\n            n = this._b,\r\n            eye = this.eye;\r\n\r\n        Vec3.doubleToTwoFloat32Array(eye, this.eyeHigh, this.eyeLow);\r\n\r\n        this._viewMatrix.set([\r\n            u.x, v.x, n.x, 0.0,\r\n            u.y, v.y, n.y, 0.0,\r\n            u.z, v.z, n.z, 0.0,\r\n            -eye.dot(u), -eye.dot(v), -eye.dot(n), 1.0\r\n        ]);\r\n\r\n        this._viewMatrixRTE.set([\r\n            u.x, v.x, n.x, 0.0,\r\n            u.y, v.y, n.y, 0.0,\r\n            u.z, v.z, n.z, 0.0,\r\n            0, 0, 0, 1.0\r\n        ]);\r\n\r\n        // do not clean up, someday it will be using\r\n        //this._normalMatrix = this._viewMatrix.toMatrix3(); // this._viewMatrix.toInverseMatrix3().transposeTo();\r\n\r\n        for (let i = 0, len = this.frustums.length; i < len; i++) {\r\n            this.frustums[i].setViewMatrix(this._viewMatrix);\r\n            this.frustums[i].setProjectionViewRTEMatrix(this._viewMatrixRTE);\r\n        }\r\n\r\n        this.events.dispatch(this.events.viewchange, this);\r\n    }\r\n\r\n    /**\r\n     * Refresh camera matrices\r\n     * @public\r\n     */\r\n    public refresh() {\r\n        this._setProj(this._viewAngle, this.getAspectRatio());\r\n        this.update();\r\n    }\r\n\r\n    // /**\r\n    //  * Sets aspect ratio\r\n    //  * @public\r\n    //  * @param {Number} aspect - Camera aspect ratio\r\n    //  */\r\n    // public setAspectRatio(aspect: number) {\r\n    //     this._aspect = aspect;\r\n    //     this.refresh();\r\n    // }\r\n\r\n    public get width(): number {\r\n        return this._width;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this._height;\r\n    }\r\n\r\n    public setViewportSize(width: number, height: number) {\r\n        this._width = width;\r\n        this._height = height;\r\n        this.refresh();\r\n    }\r\n\r\n    /**\r\n     * Returns aspect ratio\r\n     * @public\r\n     * @returns {number} - Aspect ratio\r\n     */\r\n    public getAspectRatio(): number {\r\n        return this._width / this._height;\r\n    }\r\n\r\n    /**\r\n     * Sets up camera projection\r\n     * @public\r\n     * @param {number} angle - Camera view angle\r\n     * @param {number} aspect - Screen aspect ratio\r\n     */\r\n    protected _setProj(angle: number, aspect: number) {\r\n        this._viewAngle = angle;\r\n        for (let i = 0, len = this.frustums.length; i < len; i++) {\r\n            this.frustums[i].setProjectionMatrix(\r\n                angle,\r\n                aspect,\r\n                this.frustums[i].near,\r\n                this.frustums[i].far\r\n            );\r\n        }\r\n\r\n        this._horizontalViewAngle = getHorizontalViewAngleByFov(angle, aspect);\r\n\r\n        this._updateViewportParameters();\r\n    }\r\n\r\n    protected _updateViewportParameters() {\r\n        this._tanViewAngle_hrad = Math.tan(this._viewAngle * math.RADIANS_HALF);\r\n        this._tanViewAngle_hradOneByHeight = this._tanViewAngle_hrad * (1.0 / this._height);\r\n        this._projSizeConst = Math.min(this._width < 512 ? 512 : this._width, this._height < 512 ? 512 : this._height) / (this._viewAngle * RADIANS);\r\n    }\r\n\r\n    /**\r\n     * Sets camera view angle in degrees\r\n     * @public\r\n     * @param {number} angle - View angle\r\n     */\r\n    public setViewAngle(angle: number) {\r\n        this._viewAngle = angle;\r\n        this.refresh();\r\n    }\r\n\r\n    /**\r\n     * Gets camera view angle in degrees\r\n     * @public\r\n     * @returns {number} angle -\r\n     */\r\n    public getViewAngle(): number {\r\n        return this._viewAngle;\r\n    }\r\n\r\n    public get viewAngle(): number {\r\n        return this._viewAngle;\r\n    }\r\n\r\n    public get verticalViewAngle(): number {\r\n        return this._viewAngle;\r\n    }\r\n\r\n    public get horizontalViewAngle(): number {\r\n        return this._horizontalViewAngle;\r\n    }\r\n\r\n    /**\r\n     * Sets camera to eye position\r\n     * @public\r\n     * @param {Vec3} eye - Camera position\r\n     * @param {Vec3} look - Look point\r\n     * @param {Vec3} up - Camera up vector\r\n     * @returns {Camera} - This camera\r\n     */\r\n    public set(eye: Vec3, look?: Vec3, up?: Vec3): this {\r\n        this.eye.x = eye.x;\r\n        this.eye.y = eye.y;\r\n        this.eye.z = eye.z;\r\n        look = look || this._b;\r\n        up = up || this._u;\r\n        this._b.x = eye.x - look.x;\r\n        this._b.y = eye.y - look.y;\r\n        this._b.z = eye.z - look.z;\r\n        this._r.copy(up.cross(this._b));\r\n        this._b.normalize();\r\n        this._r.normalize();\r\n        this._u.copy(this._b.cross(this._r));\r\n        this._f.set(-this._b.x, -this._b.y, -this._b.z);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets camera look point\r\n     * @public\r\n     * @param {Vec3} look - Look point\r\n     * @param {Vec3} [up] - Camera up vector otherwise camera current up vector(this._u)\r\n     */\r\n    public look(look: Vec3, up?: Vec3) {\r\n        this._b.set(this.eye.x - look.x, this.eye.y - look.y, this.eye.z - look.z);\r\n        this._r.copy((up || this._u).cross(this._b));\r\n        this._b.normalize();\r\n        this._f.set(-this._b.x, -this._b.y, -this._b.z);\r\n        this._r.normalize();\r\n        this._u.copy(this._b.cross(this._r));\r\n    }\r\n\r\n    /**\r\n     * Slides camera to vector d - (du, dv, dn)\r\n     * @public\r\n     * @param {number} du - delta X\r\n     * @param {number} dv - delta Y\r\n     * @param {number} dn - delta Z\r\n     */\r\n    public slide(du: number, dv: number, dn: number) {\r\n        this.eye.x += du * this._r.x + dv * this._u.x + dn * this._b.x;\r\n        this.eye.y += du * this._r.y + dv * this._u.y + dn * this._b.y;\r\n        this.eye.z += du * this._r.z + dv * this._u.z + dn * this._b.z;\r\n    }\r\n\r\n    /**\r\n     * Roll the camera to the angle in radians\r\n     * @public\r\n     * @param {number} angle - Delta roll angle in radians\r\n     */\r\n    public setRoll(angle: number) {\r\n        let cs = Math.cos(angle);\r\n        let sn = Math.sin(angle);\r\n        let t = this._r.clone();\r\n        this._r.set(\r\n            cs * t.x - sn * this._u.x,\r\n            cs * t.y - sn * this._u.y,\r\n            cs * t.z - sn * this._u.z\r\n        );\r\n        this._u.set(\r\n            sn * t.x + cs * this._u.x,\r\n            sn * t.y + cs * this._u.y,\r\n            sn * t.z + cs * this._u.z\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Pitch the camera to the angle in radians\r\n     * @public\r\n     * @param {number} angle - Delta pitch angle in radians\r\n     */\r\n    public setPitch(angle: number) {\r\n        let cs = Math.cos(angle);\r\n        let sn = Math.sin(angle);\r\n        let t = this._b;\r\n        this._b.set(\r\n            cs * t.x - sn * this._u.x,\r\n            cs * t.y - sn * this._u.y,\r\n            cs * t.z - sn * this._u.z\r\n        );\r\n        this._u.set(\r\n            sn * t.x + cs * this._u.x,\r\n            sn * t.y + cs * this._u.y,\r\n            sn * t.z + cs * this._u.z\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Yaw the camera to the angle in radians\r\n     * @public\r\n     * @param {number} angle - Delta yaw angle in radians\r\n     */\r\n    public setYaw(angle: number) {\r\n        let cs = Math.cos(angle);\r\n        let sn = Math.sin(angle);\r\n        let t = this._r;\r\n        this._r.set(\r\n            cs * t.x - sn * this._b.x,\r\n            cs * t.y - sn * this._b.y,\r\n            cs * t.z - sn * this._b.z\r\n        );\r\n        this._b.set(\r\n            sn * t.x + cs * this._b.x,\r\n            sn * t.y + cs * this._b.y,\r\n            sn * t.z + cs * this._b.z\r\n        );\r\n    }\r\n\r\n    public setPitchYawRoll(pitch: number, yaw: number, roll: number) {\r\n        let qRot = new Quat();\r\n        qRot.setPitchYawRoll(pitch, yaw, roll);\r\n        this.setRotation(qRot);\r\n    }\r\n\r\n    public getPitch(): number {\r\n        return this.getRotation().getPitch();\r\n    }\r\n\r\n    public getYaw(): number {\r\n        return this.getRotation().getYaw();\r\n    }\r\n\r\n    public getRoll(): number {\r\n        return this.getRotation().getRoll();\r\n    }\r\n\r\n    /**\r\n     * Returns camera quaternion\r\n     */\r\n    public getRotation(): Quat {\r\n        return Quat.getLookRotation(this._f, this._u).conjugate();\r\n    }\r\n\r\n    public setRotation(rot: Quat, up?: Vec3, right?: Vec3, back?: Vec3) {\r\n        rot.mulVec3Res(up || new Vec3(0, 1, 0), this._u);\r\n        rot.mulVec3Res(right || new Vec3(1, 0, 0), this._r);\r\n        rot.mulVec3Res(back || new Vec3(0, 0, 1), this._b);\r\n        this._f.set(-this._b.x, -this._b.y, -this._b.z);\r\n    }\r\n\r\n    public rotate(rot: Quat) {\r\n        rot.mulVec3Res(this._u, this._u);\r\n        rot.mulVec3Res(this._r, this._r);\r\n        rot.mulVec3Res(this._b, this._b);\r\n        this._f.set(-this._b.x, -this._b.y, -this._b.z);\r\n    }\r\n\r\n    /**\r\n     * Returns normal vector direction to the unprojected screen point from camera eye\r\n     * @public\r\n     * @param {Vec2} pos - Screen X coordinate\r\n     * @returns {Vec3} - Direction vector\r\n     */\r\n    public unproject2v(pos: Vec2) {\r\n        return this.unproject(pos.x, pos.y);\r\n    }\r\n\r\n    /**\r\n     * Returns normal vector direction to the unprojected screen point from camera eye\r\n     * @public\r\n     * @param {number} x - Screen X coordinate\r\n     * @param {number} y - Screen Y coordinate\r\n     * @returns {Vec3} - Direction vector\r\n     */\r\n    public unproject(x: number, y: number) {\r\n        // let c = this.renderer!.handler.canvas!,\r\n        //     w = c.width * 0.5,\r\n        //     h = c.height * 0.5;\r\n\r\n        let w = this._width * 0.5,\r\n            h = this._height * 0.5;\r\n\r\n        let px = (x - w) / w,\r\n            py = -(y - h) / h;\r\n\r\n        let world1 = this.frustums[0].inverseProjectionViewMatrix.mulVec4(new Vec4(px, py, -1.0, 1.0)).affinity(),\r\n            world2 = this.frustums[0].inverseProjectionViewMatrix.mulVec4(new Vec4(px, py, 0.0, 1.0)).affinity();\r\n\r\n        return world2.subA(world1).toVec3().normalize();\r\n    }\r\n\r\n    /**\r\n     * Gets projected 3d point to the 2d screen coordinates\r\n     * @public\r\n     * @param {Vec3} v - Cartesian 3d coordinates\r\n     * @returns {Vec2} - Screen point coordinates\r\n     */\r\n    public project3v(v: Vec3): Vec2 {\r\n        return this.project(v.x, v.y, v.z);\r\n    }\r\n\r\n    /**\r\n     * Gets projected 3d point to the 2d screen coordinates\r\n     * @public\r\n     * @param {number} x - X coordinate\r\n     * @param {number} y - Y coordinate\r\n     * @param {number} z - Z coordinate\r\n     * @returns {Vec2} - Screen point coordinates\r\n     */\r\n    public project(x: number, y: number, z: number): Vec2 {\r\n        let r = this.frustums[0].projectionViewMatrix.mulVec4(new Vec4(x, y, z, 1.0));\r\n        return new Vec2((1 + r.x / r.w) * this._width * 0.5, (1 - r.y / r.w) * this._height * 0.5);\r\n    }\r\n\r\n    /**\r\n     * Rotates camera around center point\r\n     * @public\r\n     * @param {number} angle - Rotation angle in radians\r\n     * @param {boolean} [isArc] - If true camera up vector gets from current up vector every frame,\r\n     * otherwise up is always input parameter.\r\n     * @param {Vec3} [center] - Point that the camera rotates around\r\n     * @param {Vec3} [up] - Camera up vector\r\n     */\r\n    public rotateAround(angle: number, isArc: boolean = false, center: Vec3 = Vec3.ZERO, up: Vec3 = Vec3.UP) {\r\n        up = isArc ? this._u : up;\r\n        let rot = Mat4.getRotation(angle, up);\r\n        let trm = Mat4.getRotationAroundPoint(angle, center, up);\r\n        this.eye = trm.mulVec3(this.eye);\r\n        this._u = rot.mulVec3(this._u).normalize();\r\n        this._r = rot.mulVec3(this._r).normalize();\r\n        this._b = rot.mulVec3(this._b).normalize();\r\n        this._f.set(-this._b.x, -this._b.y, -this._b.z);\r\n    }\r\n\r\n    /**\r\n     * Rotates camera around center point by horizontal.\r\n     * @public\r\n     * @param {number} angle - Rotation angle in radians.\r\n     * @param {boolean} [isArc] - If true camera up vector gets from current up vector every frame,\r\n     * otherwise up is always input parameter.\r\n     * @param {Vec3} [center] - Point that the camera rotates around.\r\n     * @param {Vec3} [up] - Camera up vector.\r\n     */\r\n    public rotateHorizontal(angle: number, isArc?: boolean, center?: Vec3, up?: Vec3) {\r\n        this.rotateAround(angle, isArc, center, up);\r\n    }\r\n\r\n    /**\r\n     * Rotates camera around center point by vertical.\r\n     * @param {number} angle - Rotation angle in radians.\r\n     * @param {Vec3} [center] - Point that the camera rotates around.\r\n     */\r\n    public rotateVertical(angle: number, center?: Vec3) {\r\n        this.rotateAround(angle, false, center, this._r);\r\n    }\r\n\r\n    /**\r\n     * Gets 3d size factor. Uses in LOD distance calculation.\r\n     * @public\r\n     * @param {Vec3} p - Far point.\r\n     * @param {Vec3} r - Far point.\r\n     * @returns {number} - Size factor.\r\n     */\r\n    public projectedSize(p: Vec3, r: number): number {\r\n        return Math.atan(r / this.eye.distance(p)) * this._projSizeConst;\r\n    }\r\n\r\n    /**\r\n     * Returns model matrix.\r\n     * @public\r\n     * @returns {NumberArray16} - View matrix.\r\n     */\r\n    public getViewMatrix(): NumberArray16 {\r\n        return this._viewMatrix._m;\r\n    }\r\n\r\n    /**\r\n     * Returns normal matrix.\r\n     * @public\r\n     * @returns {NumberArray9} - Normal matrix.\r\n     */\r\n    public getNormalMatrix(): NumberArray9 {\r\n        return this._normalMatrix._m;\r\n    }\r\n\r\n    public setCurrentFrustum(k: number) {\r\n        this.currentFrustumIndex = k;\r\n        this.frustumColorIndex = (k + 1) * 10.0 / 255.0;\r\n        this.isFirstPass = k === this.FARTHEST_FRUSTUM_INDEX;\r\n    }\r\n\r\n    public getCurrentFrustum(): number {\r\n        return this.currentFrustumIndex;\r\n    }\r\n\r\n    public containsSphere(sphere: Sphere): boolean {\r\n        for (let i = 0; i < this.frustums.length; i++) {\r\n            if (this.frustums[i].containsSphere(sphere)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public get frustum(): Frustum {\r\n        return this.frustums[this.currentFrustumIndex];\r\n    }\r\n\r\n    /**\r\n     * Returns projection matrix.\r\n     * @public\r\n     * @returns {Mat4} - Projection matrix.\r\n     */\r\n    public getProjectionMatrix(): NumberArray16 {\r\n        return this.frustum.projectionMatrix._m;\r\n    }\r\n\r\n    /**\r\n     * Returns projection and model matrix product.\r\n     * @public\r\n     * @return {Mat4} - Projection-view matrix.\r\n     */\r\n    public getProjectionViewMatrix(): NumberArray16 {\r\n        return this.frustum.projectionViewMatrix._m;\r\n    }\r\n\r\n    /**\r\n     * Returns projection and model RTE matrix product.\r\n     * @public\r\n     * @return {Mat4} - Projection-view matrix.\r\n     */\r\n    public getProjectionViewRTEMatrix(): NumberArray16 {\r\n        return this.frustum.projectionViewRTEMatrix._m;\r\n    }\r\n\r\n    /**\r\n     * Returns inverse projection and model matrix product.\r\n     * @public\r\n     * @returns {Mat4} - Inverse projection-view matrix.\r\n     */\r\n    public getInverseProjectionViewMatrix(): NumberArray16 {\r\n        return this.frustum.inverseProjectionViewMatrix._m;\r\n    }\r\n\r\n    /**\r\n     * Returns inverse projection matrix.\r\n     * @public\r\n     * @returns {Mat4} - Inverse projection-view matrix.\r\n     */\r\n    public getInverseProjectionMatrix(): NumberArray16 {\r\n        return this.frustum.inverseProjectionMatrix._m;\r\n    }\r\n\r\n    public viewDistance(cartesian: Vec3, distance: number = 10000.0) {\r\n        let p0 = this.eye.add(this.getForward().scaleTo(distance));\r\n        let _rot = Quat.getRotationBetweenVectors(p0.getNormal(), cartesian.getNormal());\r\n        let newPos = cartesian.add(this.getBackward().scaleTo(distance));\r\n        this.set(newPos, cartesian);\r\n        this.update();\r\n    }\r\n\r\n    public copy(cam: Camera) {\r\n        this.eye.copy(cam.eye);\r\n        this._r.copy(cam._r);\r\n        this._u.copy(cam._u);\r\n        this._b.copy(cam._b);\r\n        this._f.copy(cam._f);\r\n        this._width = cam.width;\r\n        this._height = cam.height;\r\n        this.setViewAngle(cam.viewAngle);\r\n        this.update();\r\n    }\r\n\r\n    public getAltitude(): number {\r\n        return this.eye.y;\r\n    }\r\n}\r\n\r\nexport {Camera};\r\n","import * as mercator from \"../mercator\";\r\nimport * as math from \"../math\";\r\nimport {Camera, type ICameraParams} from \"./Camera\";\r\nimport {Key} from \"../Lock\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Mat4} from \"../math/Mat4\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {RADIANS} from \"../math\";\r\n\r\ninterface IPlanetCameraParams extends ICameraParams {\r\n    minAltitude?: number;\r\n    maxAltitude?: number;\r\n}\r\n\r\ntype CameraFrame = {\r\n    eye: Vec3;\r\n    n: Vec3;\r\n    u: Vec3;\r\n    v: Vec3;\r\n}\r\n\r\n/**\r\n * Planet camera.\r\n * @class\r\n * @extends {Camera}\r\n * @param {Planet} planet - Planet render node.\r\n * @param {IPlanetCameraParams} [options] - Planet camera options:\r\n * @param {string} [options.name] - Camera name.\r\n * @param {number} [options.viewAngle] - Camera angle of view.\r\n * @param {number} [options.near] - Camera near plane distance. Default is 1.0\r\n * @param {number} [options.far] - Camera far plane distance. Default is og.math.MAX\r\n * @param {number} [options.minAltitude] - Minimal altitude for the camera. Default is 5\r\n * @param {number} [options.maxAltitude] - Maximal altitude for the camera. Default is 20000000\r\n * @param {Vec3} [options.eye] - Camera eye position. Default (0,0,0)\r\n * @param {Vec3} [options.look] - Camera look position. Default (0,0,0)\r\n * @param {Vec3} [options.up] - Camera eye position. Default (0,1,0)\r\n */\r\nclass PlanetCamera extends Camera {\r\n    /**\r\n     * Assigned camera's planet.\r\n     * @public\r\n     * @type {Planet}\r\n     */\r\n    public planet: Planet;\r\n\r\n    /**\r\n     * Minimal altitude that camera can reach over the terrain.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public minAltitude: number;\r\n\r\n    /**\r\n     * Maximal altitude that camera can reach over the globe.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public maxAltitude: number;\r\n\r\n    /**\r\n     * Current geographical degree position.\r\n     * @public\r\n     * @type {LonLat}\r\n     */\r\n    public _lonLat: LonLat;\r\n\r\n    /**\r\n     * Current geographical mercator position.\r\n     * @public\r\n     * @type {LonLat}\r\n     */\r\n    public _lonLatMerc: LonLat;\r\n\r\n    /**\r\n     * Current altitude.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _terrainAltitude: number;\r\n\r\n    /**\r\n     * Cartesian coordinates on the terrain.\r\n     * @protected\r\n     * @type {Vec3}\r\n     */\r\n    protected _terrainPoint: Vec3;\r\n\r\n    /**\r\n     * Quad node that camera flies over.\r\n     * @protected\r\n     * @type {Segment}\r\n     */\r\n\r\n    public _insideSegment: Segment | null;\r\n\r\n    public slope: number;\r\n\r\n    protected _keyLock: Key;\r\n    protected _framesArr: CameraFrame[];\r\n    protected _framesCounter: number;\r\n    protected _numFrames: number;\r\n    protected _completeCallback: Function | null;\r\n    protected _frameCallback: Function | null;\r\n\r\n    protected _flying: boolean;\r\n    protected _checkTerrainCollision: boolean;\r\n\r\n    public eyeNorm: Vec3;\r\n\r\n    constructor(planet: Planet, options: IPlanetCameraParams = {}) {\r\n        super({\r\n                ...options,\r\n                frustums: options.frustums || [[1, 100 + 0.075], [100, 1000 + 0.075], [1000, 1e6 + 10000], [1e6, 1e9]],\r\n            }\r\n        );\r\n\r\n        this.planet = planet;\r\n\r\n        this.minAltitude = options.minAltitude || 1;\r\n\r\n        this.maxAltitude = options.maxAltitude || 20000000;\r\n\r\n        this._lonLat = this.planet.ellipsoid.cartesianToLonLat(this.eye);\r\n\r\n        this._lonLatMerc = this._lonLat.forwardMercator();\r\n\r\n        this._terrainAltitude = this._lonLat.height;\r\n\r\n        this._terrainPoint = new Vec3();\r\n\r\n        this._insideSegment = null;\r\n\r\n        this.slope = 0;\r\n\r\n        this._keyLock = new Key();\r\n\r\n        this._framesArr = [];\r\n        this._framesCounter = 0;\r\n        this._numFrames = 50;\r\n        this._completeCallback = null;\r\n        this._frameCallback = null;\r\n        this._flying = false;\r\n        this._checkTerrainCollision = true;\r\n\r\n        this.eyeNorm = this.eye.getNormal();\r\n    }\r\n\r\n    public setTerrainCollisionActivity(isActive: boolean) {\r\n        this._checkTerrainCollision = isActive;\r\n    }\r\n\r\n    /**\r\n     * Updates camera view space.\r\n     * @public\r\n     * @virtual\r\n     */\r\n    public override update() {\r\n        this.events.stopPropagation();\r\n\r\n        let maxAlt = this.maxAltitude + this.planet.ellipsoid.getEquatorialSize();\r\n\r\n        if (this.eye.length() > maxAlt) {\r\n            this.eye.copy(this.eye.getNormal().scale(maxAlt));\r\n        }\r\n\r\n        super.update();\r\n\r\n        this.updateGeodeticPosition();\r\n\r\n        this.eyeNorm = this.eye.getNormal();\r\n        this.slope = this._b.dot(this.eyeNorm);\r\n\r\n        this.events.dispatch(this.events.viewchange, this);\r\n    }\r\n\r\n    public updateGeodeticPosition() {\r\n        this.planet.ellipsoid.cartesianToLonLatRes(this.eye, this._lonLat);\r\n        if (Math.abs(this._lonLat.lat) <= mercator.MAX_LAT) {\r\n            LonLat.forwardMercatorRes(this._lonLat, this._lonLatMerc);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets altitude over the terrain.\r\n     * @public\r\n     * @param {number} alt - Altitude over the terrain.\r\n     */\r\n    public setAltitude(alt: number) {\r\n\r\n        let t = this._terrainPoint;\r\n        let n = this.planet.ellipsoid.getSurfaceNormal3v(this.eye);\r\n\r\n        this.eye.x = n.x * alt + t.x;\r\n        this.eye.y = n.y * alt + t.y;\r\n        this.eye.z = n.z * alt + t.z;\r\n\r\n        this._terrainAltitude = alt;\r\n    }\r\n\r\n    /**\r\n     * Gets altitude over the terrain.\r\n     * @public\r\n     */\r\n    public override getAltitude(): number {\r\n        return this._terrainAltitude;\r\n    }\r\n\r\n    /**\r\n     * Places camera to view to the geographical point.\r\n     * @public\r\n     * @param {LonLat} lonlat - New camera and camera view position.\r\n     * @param {LonLat} [lookLonLat] - Look up coordinates.\r\n     * @param {Vec3} [up] - Camera UP vector. Default (0,1,0)\r\n     */\r\n    public setLonLat(lonlat: LonLat, lookLonLat?: LonLat, up?: Vec3) {\r\n        this.stopFlying();\r\n        this._lonLat.set(lonlat.lon, lonlat.lat, lonlat.height || this._lonLat.height);\r\n        let el = this.planet.ellipsoid;\r\n        let newEye = el.lonLatToCartesian(this._lonLat);\r\n        let newLook = lookLonLat ? el.lonLatToCartesian(lookLonLat) : Vec3.ZERO;\r\n        this.set(newEye, newLook, up || newEye.getNormal());\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * Returns camera geographical position.\r\n     * @public\r\n     * @returns {LonLat}\r\n     */\r\n    public getLonLat(): LonLat {\r\n        return this._lonLat;\r\n    }\r\n\r\n    /**\r\n     * Returns camera height.\r\n     * @public\r\n     * @returns {number}\r\n     */\r\n    public getHeight(): number {\r\n        return this._lonLat.height;\r\n    }\r\n\r\n    /**\r\n     * Gets position by viewable extent.\r\n     * @public\r\n     * @param {Extent} extent - Viewable extent.\r\n     * @param {Number} height - Camera height\r\n     * @returns {Vec3}\r\n     */\r\n    public getExtentPosition(extent: Extent, height?: number | null): Vec3 {\r\n\r\n        height = height || 0;\r\n\r\n        let north = extent.getNorth();\r\n        let south = extent.getSouth();\r\n        let east = extent.getEast();\r\n        let west = extent.getWest();\r\n\r\n        if (west > east) {\r\n            east += 360;\r\n        }\r\n\r\n        let e = this.planet.ellipsoid;\r\n\r\n        let cart = new LonLat(east, north);\r\n        let northEast = e.lonLatToCartesian(cart);\r\n        cart.lat = south;\r\n        let southEast = e.lonLatToCartesian(cart);\r\n        cart.lon = west;\r\n        let southWest = e.lonLatToCartesian(cart);\r\n        cart.lat = north;\r\n        let northWest = e.lonLatToCartesian(cart);\r\n\r\n        let center = Vec3.sub(northEast, southWest).scale(0.5).addA(southWest);\r\n\r\n        let mag = center.length();\r\n        if (mag < 0.000001) {\r\n            cart.lon = (east + west) * 0.5;\r\n            cart.lat = (north + south) * 0.5;\r\n            center = e.lonLatToCartesian(cart);\r\n        }\r\n\r\n        northWest.subA(center);\r\n        southEast.subA(center);\r\n        northEast.subA(center);\r\n        southWest.subA(center);\r\n\r\n        let direction = center.getNormal(); // ellipsoid.getSurfaceNormal(center).negate().normalize();\r\n        let right = direction.cross(Vec3.NORTH).normalize();\r\n        let up = right.cross(direction).normalize();\r\n\r\n        let _h = Math.max(\r\n            Math.abs(up.dot(northWest)),\r\n            Math.abs(up.dot(southEast)),\r\n            Math.abs(up.dot(northEast)),\r\n            Math.abs(up.dot(southWest))\r\n        );\r\n\r\n        let _w = Math.max(\r\n            Math.abs(right.dot(northWest)),\r\n            Math.abs(right.dot(southEast)),\r\n            Math.abs(right.dot(northEast)),\r\n            Math.abs(right.dot(southWest))\r\n        );\r\n\r\n        let tanPhi = Math.tan(this._viewAngle * RADIANS * 0.5);\r\n        let tanTheta = this.getAspectRatio() * tanPhi;\r\n        let d = Math.max(_w / tanTheta, _h / tanPhi);\r\n\r\n        center.normalize();\r\n        center.scale(mag + d + height);\r\n\r\n        return center;\r\n    }\r\n\r\n    /**\r\n     * View current extent.\r\n     * @public\r\n     * @param {Extent} extent - Current extent.\r\n     * @param {number} [height]\r\n     */\r\n    public viewExtent(extent: Extent, height?: number) {\r\n        this.stopFlying();\r\n        this.set(this.getExtentPosition(extent, height), Vec3.ZERO, Vec3.NORTH);\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * Flies to the current extent.\r\n     * @public\r\n     * @param {Extent} extent - Current extent.\r\n     * @param {number} [height] - Destination height.\r\n     * @param {Vec3} [up] - Camera UP in the end of flying. Default - (0,1,0)\r\n     * @param {Number} [ampl] - Altitude amplitude factor.\r\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\r\n     * @param {Function} [startCallback] - Callback that calls before the flying begins.\r\n     * @param {Function} [frameCallback] - Each frame callback\r\n     */\r\n    public flyExtent(\r\n        extent: Extent,\r\n        height?: number | null,\r\n        up?: Vec3 | null,\r\n        ampl?: number | null,\r\n        completeCallback?: Function | null,\r\n        startCallback?: Function | null,\r\n        frameCallback?: Function | null) {\r\n        this.flyCartesian(\r\n            this.getExtentPosition(extent, height),\r\n            Vec3.ZERO,\r\n            up,\r\n            ampl == null ? 1 : ampl,\r\n            completeCallback,\r\n            startCallback,\r\n            frameCallback\r\n        );\r\n    }\r\n\r\n    public override viewDistance(cartesian: Vec3, distance: number = 10000.0) {\r\n        let p0 = this.eye.add(this.getForward().scaleTo(distance));\r\n        let _rot = Quat.getRotationBetweenVectors(p0.getNormal(), cartesian.getNormal());\r\n        if (_rot.isZero()) {\r\n            let newPos = cartesian.add(this.getBackward().scaleTo(distance));\r\n            this.set(newPos, cartesian);\r\n        } else {\r\n            let newPos = cartesian.add(_rot.mulVec3(this.getBackward()).scale(distance)),\r\n                newUp = _rot.mulVec3(this.getUp());\r\n            this.set(newPos, cartesian, newUp);\r\n        }\r\n        this.update();\r\n    }\r\n\r\n    public flyDistance(\r\n        cartesian: Vec3,\r\n        distance: number = 10000.0,\r\n        ampl: number = 0.0,\r\n        completeCallback?: Function,\r\n        startCallback?: Function,\r\n        frameCallback?: Function\r\n    ) {\r\n        let p0 = this.eye.add(this.getForward().scaleTo(distance));\r\n        let _rot = Quat.getRotationBetweenVectors(p0.getNormal(), cartesian.getNormal());\r\n        if (_rot.isZero()) {\r\n            let newPos = cartesian.add(this.getBackward().scaleTo(distance));\r\n            this.set(newPos, cartesian);\r\n        } else {\r\n            let newPos = cartesian.add(_rot.mulVec3(this.getBackward()).scale(distance)),\r\n                newUp = _rot.mulVec3(this.getUp());\r\n            this.flyCartesian(\r\n                newPos,\r\n                cartesian,\r\n                newUp,\r\n                ampl,\r\n                completeCallback,\r\n                startCallback,\r\n                frameCallback\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Flies to the cartesian coordinates.\r\n     * @public\r\n     * @param {Vec3} cartesian - Finish cartesian coordinates.\r\n     * @param {Vec3} [look] - Camera LOOK in the end of flying. Default - (0,0,0)\r\n     * @param {Vec3} [up] - Camera UP vector in the end of flying. Default - (0,1,0)\r\n     * @param {Number} [ampl=1.0] - Altitude amplitude factor.\r\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\r\n     * @param {Function} [startCallback] - Callback that calls before the flying begins.\r\n     * @param {Function} [frameCallback] - Each frame callback\r\n     */\r\n    flyCartesian(\r\n        cartesian: Vec3,\r\n        look: Vec3 | LonLat | null = Vec3.ZERO,\r\n        up: Vec3 | null = Vec3.NORTH,\r\n        ampl: number = 1.0,\r\n        completeCallback: Function | null = () => {\r\n        },\r\n        startCallback: Function | null = () => {\r\n        },\r\n        frameCallback: Function | null = () => {\r\n        }) {\r\n\r\n        this.stopFlying();\r\n\r\n        look = look || Vec3.ZERO;\r\n        up = up || Vec3.NORTH;\r\n\r\n        this._completeCallback = completeCallback;\r\n\r\n        this._frameCallback = frameCallback;\r\n\r\n        if (startCallback) {\r\n            startCallback.call(this);\r\n        }\r\n\r\n        if (look instanceof LonLat) {\r\n            look = this.planet.ellipsoid.lonLatToCartesian(look);\r\n        }\r\n\r\n        let ground_a = this.planet.ellipsoid.lonLatToCartesian(\r\n            new LonLat(this._lonLat.lon, this._lonLat.lat)\r\n        );\r\n\r\n        let v_a = this._u,\r\n            n_a = this._b;\r\n\r\n        let lonlat_b = this.planet.ellipsoid.cartesianToLonLat(cartesian);\r\n        let up_b = up;\r\n        let ground_b = this.planet.ellipsoid.lonLatToCartesian(\r\n            new LonLat(lonlat_b.lon, lonlat_b.lat, 0)\r\n        );\r\n        let n_b = Vec3.sub(cartesian, look as Vec3);\r\n        let u_b = up_b.cross(n_b);\r\n        n_b.normalize();\r\n        u_b.normalize();\r\n        let v_b = n_b.cross(u_b);\r\n\r\n        let an = ground_a.getNormal();\r\n        let bn = ground_b.getNormal();\r\n        let anbn = 1.0 - an.dot(bn);\r\n        let hM_a = ampl * math.SQRT_HALF * Math.sqrt(anbn > 0.0 ? anbn : 0.0);\r\n\r\n        let maxHeight = 6639613;\r\n        let currMaxHeight = Math.max(this._lonLat.height, lonlat_b.height);\r\n        if (currMaxHeight > maxHeight) {\r\n            maxHeight = currMaxHeight;\r\n        }\r\n        let max_h = currMaxHeight + 2.5 * hM_a * (maxHeight - currMaxHeight);\r\n        let zero = Vec3.ZERO;\r\n\r\n        // camera path and orientations calculation\r\n        for (let i = 0; i <= this._numFrames; i++) {\r\n            let d = 1 - i / this._numFrames;\r\n            d = d * d * (3 - 2 * d);\r\n            d *= d;\r\n\r\n            let g_i = ground_a.smerp(ground_b, d).normalize();\r\n            let ground_i = this.planet.getRayIntersectionEllipsoid(new Ray(zero, g_i));\r\n            let t = 1 - d;\r\n            let height_i =\r\n                this._lonLat.height * d * d * d +\r\n                max_h * 3 * d * d * t +\r\n                max_h * 3 * d * t * t +\r\n                lonlat_b.height * t * t * t;\r\n\r\n            let eye_i = ground_i!.addA(g_i.scale(height_i));\r\n            let up_i = v_a.smerp(v_b, d);\r\n            let look_i = Vec3.add(eye_i, n_a.smerp(n_b, d).negateTo());\r\n\r\n            let n = new Vec3(eye_i.x - look_i.x, eye_i.y - look_i.y, eye_i.z - look_i.z);\r\n            let u = up_i.cross(n);\r\n            n.normalize();\r\n            u.normalize();\r\n\r\n            let v = n.cross(u);\r\n            this._framesArr[i] = {\r\n                eye: eye_i,\r\n                n: n,\r\n                u: u,\r\n                v: v\r\n            };\r\n        }\r\n\r\n        this._framesCounter = this._numFrames;\r\n        this._flying = true;\r\n    }\r\n\r\n    /**\r\n     * Flies to the geo coordinates.\r\n     * @public\r\n     * @param {LonLat} lonlat - Finish coordinates.\r\n     * @param {Vec3 | LonLat} [look] - Camera LOOK in the end of flying. Default - (0,0,0)\r\n     * @param {Vec3} [up] - Camera UP vector in the end of flying. Default - (0,1,0)\r\n     * @param {number} [ampl] - Altitude amplitude factor.\r\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\r\n     * @param {Function} [startCallback] - Callback that calls befor the flying begins.\r\n     * @param {Function} [frameCallback] - each frame callback\r\n     */\r\n    flyLonLat(\r\n        lonlat: LonLat,\r\n        look?: Vec3 | LonLat,\r\n        up?: Vec3,\r\n        ampl?: number,\r\n        completeCallback?: Function,\r\n        startCallback?: Function,\r\n        frameCallbak?: Function\r\n    ) {\r\n        let _lonLat = new LonLat(lonlat.lon, lonlat.lat, lonlat.height || this._lonLat.height);\r\n        this.flyCartesian(\r\n            this.planet.ellipsoid.lonLatToCartesian(_lonLat),\r\n            look,\r\n            up,\r\n            ampl,\r\n            completeCallback,\r\n            startCallback,\r\n            frameCallbak\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Breaks the flight.\r\n     * @public\r\n     */\r\n    stopFlying() {\r\n        this.planet.layerLock.free(this._keyLock);\r\n        this.planet.terrainLock.free(this._keyLock);\r\n        this.planet.normalMapCreator.free(this._keyLock);\r\n\r\n        this._flying = false;\r\n        this._framesArr.length = 0;\r\n        this._framesArr = [];\r\n        this._framesCounter = -1;\r\n        this._frameCallback = null;\r\n\r\n        this.planet.stopDragging();\r\n    }\r\n\r\n    /**\r\n     * Returns camera is flying.\r\n     * @public\r\n     * @returns {boolean}\r\n     */\r\n    isFlying() {\r\n        return this._flying;\r\n    }\r\n\r\n    /**\r\n     * Rotates around planet to the left.\r\n     * @public\r\n     * @param {number} angle - Rotation angle.\r\n     * @param {boolean} [spin] - If its true rotates around globe spin.\r\n     */\r\n    public rotateLeft(angle: number, spin: boolean) {\r\n        this.rotateHorizontal(angle, spin !== true, Vec3.ZERO);\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * Rotates around planet to the right.\r\n     * @public\r\n     * @param {number} angle - Rotation angle.\r\n     * @param {boolean} [spin] - If its true rotates around globe spin.\r\n     */\r\n    public rotateRight(angle: number, spin: boolean) {\r\n        this.rotateHorizontal(-angle, spin !== true, Vec3.ZERO);\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * Rotates around planet to the North Pole.\r\n     * @public\r\n     * @param {number} angle - Rotation angle.\r\n     */\r\n    public rotateUp(angle: number) {\r\n        this.rotateVertical(angle, Vec3.ZERO);\r\n        this.update();\r\n    }\r\n\r\n    /**\r\n     * Rotates around planet to the South Pole.\r\n     * @public\r\n     * @param {number} angle - Rotation angle.\r\n     */\r\n    public rotateDown(angle: number) {\r\n        this.rotateVertical(-angle, Vec3.ZERO);\r\n        this.update();\r\n    }\r\n\r\n    public override rotateVertical(angle: number, center: Vec3, minSlope: number = 0) {\r\n        let rot = new Mat4().setRotation(this._r, angle);\r\n        let tr = new Mat4().setIdentity().translate(center);\r\n        let ntr = new Mat4().setIdentity().translate(center.negateTo());\r\n        let trm = tr.mul(rot).mul(ntr);\r\n\r\n        let eye = trm.mulVec3(this.eye);\r\n        let u = rot.mulVec3(this._u).normalize();\r\n        let r = rot.mulVec3(this._r).normalize();\r\n        let b = rot.mulVec3(this._b).normalize();\r\n\r\n        let eyeNorm = eye.getNormal();\r\n        let slope = b.dot(eyeNorm);\r\n\r\n        if (minSlope) {\r\n            let dSlope = slope - this.slope;\r\n\r\n            if (slope < minSlope && dSlope < 0) return;\r\n\r\n            if (\r\n                (slope > 0.1 && u.dot(eyeNorm) > 0) ||\r\n                this.slope <= 0.1 ||\r\n                this._u.dot(this.eye.getNormal()) <= 0.0\r\n            ) {\r\n                this.eye = eye;\r\n                this._u = u;\r\n                this._r = r;\r\n                this._b = b;\r\n                this._f.set(-b.x, -b.y, -b.z);\r\n            }\r\n        } else {\r\n            this.eye = eye;\r\n            this._u = u;\r\n            this._r = r;\r\n            this._b = b;\r\n            this._f.set(-b.x, -b.y, -b.z);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Prepare camera to the frame. Used in render node frame function.\r\n     * @public\r\n     */\r\n    public checkFly() {\r\n        if (this._flying) {\r\n            let c = this._numFrames - this._framesCounter;\r\n\r\n            this.planet.layerLock.lock(this._keyLock);\r\n            this.planet.terrainLock.lock(this._keyLock);\r\n            this.planet.normalMapCreator.lock(this._keyLock);\r\n\r\n            this.eye = this._framesArr[c].eye;\r\n            this._r = this._framesArr[c].u;\r\n            this._u = this._framesArr[c].v;\r\n            this._b = this._framesArr[c].n;\r\n            this._f.set(-this._b.x, -this._b.y, -this._b.z);\r\n\r\n            if (this._frameCallback) {\r\n                this._frameCallback();\r\n            }\r\n\r\n            this.update();\r\n\r\n            this._framesCounter--;\r\n\r\n            if (this._framesCounter < 0) {\r\n                this.stopFlying();\r\n                if (this._completeCallback) {\r\n                    this._completeCallback();\r\n                    this._completeCallback = null;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public checkTerrainCollision() {\r\n        this._terrainAltitude = this._lonLat.height;\r\n        if (this._insideSegment && this._insideSegment.planet) {\r\n            this._terrainAltitude = this._insideSegment.getTerrainPoint(\r\n                this.eye,\r\n                this._insideSegment.getInsideLonLat(this),\r\n                this._terrainPoint\r\n            );\r\n            if (this._terrainAltitude < this.minAltitude && this._checkTerrainCollision) {\r\n                this.setAltitude(this.minAltitude);\r\n            }\r\n            return this._terrainPoint;\r\n        }\r\n    }\r\n\r\n    public getSurfaceVisibleDistance(d: number): number {\r\n        let R = this.planet.ellipsoid.equatorialSize;\r\n        return R * Math.acos(R / (R + this._lonLat.height + d));\r\n    }\r\n\r\n    /**\r\n     * should be yje same as getYaw\r\n     */\r\n    public getHeading(): number {\r\n        let u = this.eye.getNormal();\r\n        let f = Vec3.proj_b_to_plane(\r\n                this.slope >= 0.97 ? this.getUp() : this.getForward(),\r\n                u\r\n            ).normalize(),\r\n            n = Vec3.proj_b_to_plane(Vec3.NORTH, u).normalize();\r\n        let res = Math.sign(u.dot(f.cross(n))) * Math.acos(f.dot(n)) * math.DEGREES;\r\n        if (res < 0.0) {\r\n            return 360.0 + res;\r\n        }\r\n        return res;\r\n    }\r\n\r\n    public isVisible(poi: Vec3): boolean {\r\n        let e = this.eye.length();\r\n        return this.eye.distance(poi) < Math.sqrt(e * e - this.planet.ellipsoid.equatorialSizeSqr);\r\n    }\r\n\r\n    public override getPitch(): number {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        return qFrame.conjugate().inverse().mul(this.getRotation()).getPitch();\r\n    }\r\n\r\n    /**\r\n     * should be the same as getHeading\r\n     */\r\n    public override getYaw(): number {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        return qFrame.conjugate().inverse().mul(this.getRotation()).getYaw();\r\n    }\r\n\r\n    public override getRoll(): number {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        return qFrame.conjugate().inverse().mul(this.getRotation()).getRoll();\r\n    }\r\n\r\n    public override setPitch(a: number) {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        let qRot = new Quat();\r\n        qRot.setPitchYawRoll(a, this.getYaw(), this.getRoll(), qFrame);\r\n        this.setRotation(qRot);\r\n    }\r\n\r\n    public override setYaw(a: number) {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        let qRot = new Quat();\r\n        qRot.setPitchYawRoll(this.getPitch(), a, this.getRoll(), qFrame);\r\n        this.setRotation(qRot);\r\n    }\r\n\r\n    public override setRoll(a: number) {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        let qRot = new Quat();\r\n        qRot.setPitchYawRoll(this.getPitch(), this.getYaw(), a, qFrame);\r\n        this.setRotation(qRot);\r\n    }\r\n\r\n    public override setPitchYawRoll(pitch: number, yaw: number, roll: number) {\r\n        let qFrame = this.planet.getFrameRotation(this.eye);\r\n        let qRot = new Quat();\r\n        qRot.setPitchYawRoll(pitch, yaw, roll, qFrame).conjugate();\r\n        this.setRotation(qRot);\r\n    }\r\n}\r\n\r\nexport {PlanetCamera};\r\n","// import { QueueArray } from '../QueueArray.js';\r\n\r\nimport {BaseWorker} from \"./BaseWorker\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport type {NumberArray6} from \"../bv/Sphere\";\r\n\r\n//@ts-ignore\r\nimport TerrainWorkerImpl from './TerrainWorker.worker.js?worker&inline';\r\n\r\ninterface TerrainInfo {\r\n    segment: Segment;\r\n    elevations: Float32Array;\r\n}\r\n\r\nexport interface ITerrainWorkerData {\r\n    id: number;\r\n    normalMapNormals: Float32Array | null;\r\n    normalMapVertices: Float64Array | null;\r\n    normalMapVerticesHigh: Float32Array | null;\r\n    normalMapVerticesLow: Float32Array | null;\r\n    terrainVertices: Float64Array | null;\r\n    terrainVerticesHigh: Float32Array | null;\r\n    terrainVerticesLow: Float32Array | null;\r\n    noDataVertices: Uint8Array | null;\r\n    bounds: NumberArray6;\r\n}\r\n\r\ntype MessageEventExt = MessageEvent & {\r\n    data: ITerrainWorkerData\r\n}\r\n\r\nclass TerrainWorker extends BaseWorker<TerrainInfo> {\r\n    constructor(numWorkers: number = 2) {\r\n        super(numWorkers, TerrainWorkerImpl);\r\n    }\r\n\r\n    protected override _onMessage(e: MessageEventExt) {\r\n        this._source.get(e.data.id)!.segment._terrainWorkerCallback(e.data);\r\n        this._source.delete(e.data.id);\r\n\r\n        e.data.normalMapNormals = null;\r\n        e.data.normalMapVertices = null;\r\n        e.data.normalMapVerticesHigh = null;\r\n        e.data.normalMapVerticesLow = null;\r\n        e.data.terrainVertices = null;\r\n        e.data.terrainVerticesHigh = null;\r\n        e.data.terrainVerticesLow = null;\r\n    }\r\n\r\n    public override make(info: TerrainInfo) {\r\n        if (info.segment.plainReady && info.segment.terrainIsLoading) {\r\n\r\n            if (this._workerQueue.length) {\r\n\r\n                const w = this._workerQueue.pop()!;\r\n\r\n                this._source.set(this._sourceId, info);\r\n\r\n                let segment = info.segment;\r\n\r\n                w.postMessage({\r\n                    'elevations': info.elevations,\r\n                    'this_plainVertices': segment.plainVertices,\r\n                    'this_plainNormals': segment.plainNormals,\r\n                    'this_normalMapVertices': segment.normalMapVertices,\r\n                    'this_normalMapNormals': segment.normalMapNormals,\r\n                    'heightFactor': segment.planet._heightFactor,\r\n                    'gridSize': segment.planet.terrain!.gridSizeByZoom[segment.tileZoom],\r\n                    'noDataValues': segment.planet.terrain!.noDataValues,\r\n                    'id': this._sourceId\r\n                }, [\r\n                    info.elevations.buffer,\r\n                    segment.plainVertices!.buffer,\r\n                    segment.plainNormals!.buffer,\r\n                    segment.normalMapVertices!.buffer,\r\n                    segment.normalMapNormals!.buffer\r\n                ]);\r\n\r\n                this._sourceId++;\r\n\r\n            } else {\r\n                this._pendingQueue.push(info);\r\n            }\r\n        } else {\r\n            this.check();\r\n        }\r\n    }\r\n}\r\n\r\nexport {TerrainWorker};\r\n","import {doubleToTwoFloats2} from '../math/coder';\r\nimport {Framebuffer} from '../webgl/Framebuffer';\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport {Material} from \"../layer/Material\";\r\nimport {Program} from '../webgl/Program';\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {RENDERING} from '../quadTree/quadTree';\r\nimport {Vector} from \"../layer/Vector\";\r\n\r\nlet tempArr = new Float32Array(2);\r\n\r\nconst MAX_FRAME_TIME = 25.0;\r\n\r\nexport class VectorTileCreator {\r\n    protected _width: number;\r\n    protected _height: number;\r\n    protected _planet: Planet;\r\n    protected _framebuffer: Framebuffer | null;\r\n    protected _queue: Material[];\r\n    protected _handler: Handler | null;\r\n\r\n    constructor(planet: Planet, width: number = 512, height: number = 512) {\r\n        this._width = width;\r\n        this._height = height;\r\n        this._planet = planet;\r\n        this._framebuffer = null;\r\n        this._queue = [];\r\n        this._handler = null;\r\n    }\r\n\r\n    public init() {\r\n\r\n        this._handler = this._planet.renderer!.handler;\r\n\r\n        //Line\r\n        if (!this._handler.programs.vectorTileLineRasterization) {\r\n            this._handler.addProgram(new Program(\"vectorTileLineRasterization\", {\r\n                uniforms: {\r\n                    'viewport': \"vec2\",\r\n                    'thicknessOutline': \"float\",\r\n                    'alpha': \"float\",\r\n                    'extentParamsHigh': \"vec4\",\r\n                    'extentParamsLow': \"vec4\"\r\n                },\r\n                attributes: {\r\n                    'prevHigh': \"vec2\",\r\n                    'currentHigh': \"vec2\",\r\n                    'nextHigh': \"vec2\",\r\n\r\n                    'prevLow': \"vec2\",\r\n                    'currentLow': \"vec2\",\r\n                    'nextLow': \"vec2\",\r\n\r\n                    'order': \"float\",\r\n                    'color': \"vec4\",\r\n                    'thickness': \"float\"\r\n                },\r\n                vertexShader:\r\n                    `attribute vec2 prevHigh;\r\n                attribute vec2 currentHigh;\r\n                attribute vec2 nextHigh;\r\n\r\n                attribute vec2 prevLow;\r\n                attribute vec2 currentLow;\r\n                attribute vec2 nextLow;\r\n\r\n                attribute float order;\r\n                attribute float thickness;\r\n                attribute vec4 color;\r\n                uniform float thicknessOutline;\r\n                uniform vec2 viewport;\r\n                uniform vec4 extentParamsHigh;\r\n                uniform vec4 extentParamsLow;\r\n                varying vec4 vColor;\r\n                \r\n                vec2 proj(vec2 coordHigh, vec2 coordLow) {\r\n                    vec2 highDiff = coordHigh - extentParamsHigh.xy;\r\n                    vec2 lowDiff = coordLow - extentParamsLow.xy;                    \r\n                    return vec2(-1.0 + (highDiff * step(1.0, length(highDiff)) + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0);\r\n                }\r\n                \r\n                void main(){\r\n                    vColor = color;\r\n\r\n                    vec2 vNext = proj(nextHigh, nextLow),\r\n                         vCurrent = proj(currentHigh, currentLow),\r\n                         vPrev = proj(prevHigh, prevLow);\r\n\r\n                    vec2 _next = vNext;\r\n                    vec2 _prev = vPrev;\r\n                    vec2 _current = vCurrent;\r\n\r\n                    if(_prev == _current){\r\n                        if(_next == _current){\r\n                            _next = _current + vec2(1.0, 0.0);\r\n                            _prev = _current - _next;\r\n                        }else{\r\n                            _prev = _current + normalize(_current - _next);\r\n                        }\r\n                    }\r\n\r\n                    if(_next == _current){\r\n                        _next = _current + normalize(_current - _prev);\r\n                    }\r\n\r\n                    vec2 sNext = _next;\r\n                    vec2 sCurrent = _current;\r\n                    vec2 sPrev = _prev;\r\n                    \r\n                    vec2 dirNext = normalize(sNext - sCurrent);\r\n                    vec2 dirPrev = normalize(sPrev - sCurrent);\r\n                    float dotNP = dot(dirNext, dirPrev);\r\n                    \r\n                    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));\r\n                    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));\r\n                    vec2 d = (thickness + thicknessOutline) * 0.5 * sign(order) / viewport;\r\n                    \r\n                    vec2 m;\r\n                    if(dotNP >= 0.99991){\r\n                        m = sCurrent - normalPrev * d;\r\n                    }else{\r\n                        vec2 dir = normalPrev + normalNext;\r\n                        m = sCurrent + dir * d / (dirNext.x * dir.y - dirNext.y * dir.x);\r\n                        \r\n                        if( dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0 ){\r\n                            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);\r\n                            if(occw == -1.0){\r\n                                m = sCurrent + normalPrev * d;\r\n                            }else if(occw == 1.0){\r\n                                m = sCurrent + normalNext * d;\r\n                            }else if(occw == -2.0){\r\n                                m = sCurrent + normalNext * d;\r\n                            }else if(occw == 2.0){\r\n                                m = sCurrent + normalPrev * d;\r\n                            }\r\n                        }else if(distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))){\r\n                            m = sCurrent + normalNext * d;\r\n                        }\r\n                    }\r\n                    gl_Position = vec4(m.x, m.y, 0.0, 1.0);\r\n                }`,\r\n                fragmentShader: `precision highp float;\r\n                uniform float alpha;\r\n                varying vec4 vColor;\r\n                void main() {\r\n                    gl_FragColor = vec4(vColor.rgb, alpha * vColor.a);\r\n                }`\r\n            }));\r\n        }\r\n\r\n        //Polygon\r\n        if (!this._handler.programs.vectorTilePolygonRasterization) {\r\n            this._handler.addProgram(new Program(\"vectorTilePolygonRasterization\", {\r\n                uniforms: {\r\n                    'extentParamsHigh': \"vec4\",\r\n                    'extentParamsLow': \"vec4\"\r\n                },\r\n                attributes: {\r\n                    'coordinatesHigh': \"vec2\",\r\n                    'coordinatesLow': \"vec2\",\r\n                    'colors': \"vec4\"\r\n                },\r\n                vertexShader:\r\n                    `attribute vec2 coordinatesHigh;\r\n                attribute vec2 coordinatesLow; \r\n                attribute vec4 colors; \r\n                uniform vec4 extentParamsHigh; \r\n                uniform vec4 extentParamsLow; \r\n                varying vec4 color;\r\n\r\n                vec2 proj(vec2 coordHigh, vec2 coordLow) {\r\n                    vec2 highDiff = coordHigh - extentParamsHigh.xy;\r\n                    vec2 lowDiff = coordLow - extentParamsLow.xy;\r\n                    return vec2(-1.0 + (highDiff * step(1.0, length(highDiff)) + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0);\r\n                }\r\n\r\n                void main() { \r\n                    color = colors;\r\n                    gl_Position = vec4(proj(coordinatesHigh, coordinatesLow), 0.0, 1.0); \r\n                }`,\r\n                fragmentShader:\r\n                    `precision highp float;\r\n                varying vec4 color;\r\n                void main () {  \r\n                    gl_FragColor = color; \r\n                }`\r\n            }));\r\n        }\r\n\r\n        this._framebuffer = new Framebuffer(this._handler, {\r\n            width: this._width,\r\n            height: this._height,\r\n            useDepth: false\r\n        });\r\n\r\n        this._framebuffer.init();\r\n    }\r\n\r\n    public frame() {\r\n        if (this._planet.layerLock.isFree() && this._queue.length) {\r\n            let h = this._handler!,\r\n                gl = h.gl!;\r\n\r\n            gl.disable(gl.CULL_FACE);\r\n            gl.disable(gl.DEPTH_TEST);\r\n\r\n            let hLine = h.programs.vectorTileLineRasterization,\r\n                hPoly = h.programs.vectorTilePolygonRasterization;\r\n\r\n            let _w = this._width,\r\n                _h = this._height,\r\n                width = _w,\r\n                height = _h,\r\n                _w2 = width << 1,\r\n                _h2 = height << 1;\r\n\r\n            // var prevLayerId = -1;\r\n\r\n            let extentParamsHigh = new Float32Array(4);\r\n            let extentParamsLow = new Float32Array(4);\r\n\r\n            let f = this._framebuffer!.activate();\r\n\r\n            let deltaTime = 0,\r\n                startTime = window.performance.now();\r\n\r\n            while (this._queue.length && deltaTime < MAX_FRAME_TIME) {\r\n                let material = this._queue.shift()!;\r\n                if (material.isLoading && material.segment.node.getState() === RENDERING) {\r\n                    let pickingEnabled = material.layer._pickingEnabled;\r\n\r\n                    if (material.segment.tileZoom < 4) {\r\n                        width = _w2;\r\n                        height = _h2;\r\n                    } else {\r\n                        width = _w;\r\n                        height = _h;\r\n                    }\r\n\r\n                    let texture = material._updateTexture || h.createEmptyTexture_l(width, height);\r\n                    let pickingMask = pickingEnabled ? material._updatePickingMask || h.createEmptyTexture_n(width, height) : null;\r\n\r\n                    material.applyTexture(texture, pickingMask);\r\n\r\n                    f.setSize(width, height);\r\n\r\n                    f.bindOutputTexture(texture!);\r\n\r\n                    gl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n                    gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n                    let extent = material.segment.getExtentMerc();\r\n\r\n                    doubleToTwoFloats2(extent.southWest.lon, tempArr);\r\n                    extentParamsHigh[0] = tempArr[0];\r\n                    extentParamsLow[0] = tempArr[1];\r\n\r\n                    doubleToTwoFloats2(extent.southWest.lat, tempArr);\r\n                    extentParamsHigh[1] = tempArr[0];\r\n                    extentParamsLow[1] = tempArr[1];\r\n\r\n                    extentParamsHigh[2] = 2.0 / extent.getWidth();\r\n                    extentParamsHigh[3] = 2.0 / extent.getHeight();\r\n\r\n                    hPoly.activate();\r\n                    let sh = hPoly._program;\r\n                    let sha = sh.attributes,\r\n                        shu = sh.uniforms;\r\n\r\n                    let geomHandler = (material.layer as Vector)._geometryHandler;\r\n\r\n                    //=========================================\r\n                    //Polygon rendering\r\n                    //=========================================\r\n                    gl.uniform4fv(shu.extentParamsHigh, extentParamsHigh);\r\n                    gl.uniform4fv(shu.extentParamsLow, extentParamsLow);\r\n\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyVerticesHighBufferMerc!);\r\n                    gl.vertexAttribPointer(sha.coordinatesHigh, geomHandler._polyVerticesHighBufferMerc!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyVerticesLowBufferMerc!);\r\n                    gl.vertexAttribPointer(sha.coordinatesLow, geomHandler._polyVerticesLowBufferMerc!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyColorsBuffer!);\r\n                    gl.vertexAttribPointer(sha.colors, geomHandler._polyColorsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, geomHandler._polyIndexesBuffer!);\r\n\r\n                    gl.drawElements(gl.TRIANGLES, geomHandler._polyIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n\r\n                    //Polygon picking PASS\r\n                    if (pickingEnabled) {\r\n                        f.bindOutputTexture(pickingMask!);\r\n\r\n                        gl.clearColor(0.0, 0.0, 0.0, 0.0);\r\n                        gl.clear(gl.COLOR_BUFFER_BIT);\r\n\r\n                        gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyPickingColorsBuffer!);\r\n                        gl.vertexAttribPointer(sha.colors, geomHandler._polyPickingColorsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                        gl.drawElements(gl.TRIANGLES, geomHandler._polyIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n                    }\r\n\r\n                    //=========================================\r\n                    //Strokes and linestrings rendering\r\n                    //=========================================\r\n                    f.bindOutputTexture(texture!);\r\n\r\n                    hLine.activate();\r\n                    sh = hLine._program;\r\n                    sha = sh.attributes;\r\n                    shu = sh.uniforms;\r\n\r\n                    gl.uniform2fv(shu.viewport, [width, height]);\r\n\r\n                    gl.uniform4fv(shu.extentParamsHigh, extentParamsHigh);\r\n                    gl.uniform4fv(shu.extentParamsLow, extentParamsLow);\r\n\r\n                    //vertex\r\n                    let mb = geomHandler._lineVerticesHighBufferMerc!;\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, mb);\r\n\r\n                    gl.vertexAttribPointer(sha.prevHigh, mb.itemSize, gl.FLOAT, false, 8, 0);\r\n                    gl.vertexAttribPointer(sha.currentHigh, mb.itemSize, gl.FLOAT, false, 8, 32);\r\n                    gl.vertexAttribPointer(sha.nextHigh, mb.itemSize, gl.FLOAT, false, 8, 64);\r\n\r\n                    mb = geomHandler._lineVerticesLowBufferMerc!;\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, mb);\r\n\r\n                    gl.vertexAttribPointer(sha.prevLow, mb.itemSize, gl.FLOAT, false, 8, 0);\r\n                    gl.vertexAttribPointer(sha.currentLow, mb.itemSize, gl.FLOAT, false, 8, 32);\r\n                    gl.vertexAttribPointer(sha.nextLow, mb.itemSize, gl.FLOAT, false, 8, 64);\r\n\r\n                    //order\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineOrdersBuffer!);\r\n                    gl.vertexAttribPointer(sha.order, geomHandler._lineOrdersBuffer!.itemSize, gl.FLOAT, false, 4, 0);\r\n\r\n                    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, geomHandler._lineIndexesBuffer!);\r\n\r\n                    //PASS - stroke\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineStrokesBuffer!);\r\n                    gl.vertexAttribPointer(sha.thickness, geomHandler._lineStrokesBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineStrokeColorsBuffer!);\r\n                    gl.vertexAttribPointer(sha.color, geomHandler._lineStrokeColorsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    //Antialias pass\r\n                    gl.uniform1f(shu.thicknessOutline, 2);\r\n                    gl.uniform1f(shu.alpha, 0.54);\r\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n                    //\r\n                    //Aliased pass\r\n                    gl.uniform1f(shu.thicknessOutline, 1);\r\n                    gl.uniform1f(shu.alpha, 1.0);\r\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n\r\n                    //PASS - inside line\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineThicknessBuffer!);\r\n                    gl.vertexAttribPointer(sha.thickness, geomHandler._lineThicknessBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineColorsBuffer!);\r\n                    gl.vertexAttribPointer(sha.color, geomHandler._lineColorsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n                    //Antialias pass\r\n                    gl.uniform1f(shu.thicknessOutline, 2);\r\n                    gl.uniform1f(shu.alpha, 0.54);\r\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n                    //\r\n                    //Aliased pass\r\n                    gl.uniform1f(shu.thicknessOutline, 1);\r\n                    gl.uniform1f(shu.alpha, 1.0);\r\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n\r\n                    if (pickingEnabled) {\r\n                        f.bindOutputTexture(pickingMask!);\r\n                        gl.uniform1f(shu.thicknessOutline, 8);\r\n                        gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._linePickingColorsBuffer!);\r\n                        gl.vertexAttribPointer(sha.color, geomHandler._linePickingColorsBuffer!.itemSize, gl.FLOAT, false, 0, 0);\r\n                        gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer!.numItems, gl.UNSIGNED_INT, 0);\r\n                    }\r\n                } else {\r\n                    material.isLoading = false;\r\n                }\r\n\r\n                deltaTime = window.performance.now() - startTime;\r\n            }\r\n\r\n            gl.enable(gl.DEPTH_TEST);\r\n            gl.enable(gl.CULL_FACE);\r\n\r\n            f.deactivate();\r\n        }\r\n    }\r\n\r\n    public add(material: Material) {\r\n        this._queue.push(material);\r\n    }\r\n\r\n    public remove(material: Material) {\r\n        //...\r\n    }\r\n\r\n    public get queueSize(): number {\r\n        return this._queue.length;\r\n    }\r\n}\r\n","import * as math from \"../math\";\r\nimport * as segmentHelper from \"../segment/segmentHelper\";\r\nimport * as shaders from \"../shaders/drawnode/drawnode\";\r\nimport * as utils from \"../utils/shared\";\r\nimport {Atmosphere} from \"../control/atmosphere/Atmosphere\";\r\nimport type {IAtmosphereParams} from \"../control/atmosphere/Atmosphere\";\r\nimport {Control} from \"../control/Control\";\r\nimport {createColorRGB} from \"../utils/shared\";\r\nimport {createEvents} from \"../Events\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {EarthQuadTreeStrategy} from \"../quadTree/earth/EarthQuadTreeStrategy\";\r\nimport {EmptyTerrain} from \"../terrain/EmptyTerrain\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport {Ellipsoid} from \"../ellipsoid/Ellipsoid\";\r\nimport {EntityCollection} from \"../entity/EntityCollection\";\r\nimport {Geoid} from \"../terrain/Geoid\";\r\nimport type {GeoidModel} from \"../terrain/Geoid\";\r\nimport {GeoImageCreator} from \"../utils/GeoImageCreator\";\r\nimport type {IBaseInputState} from \"../renderer/RendererEvents\";\r\nimport {Key, Lock} from \"../Lock\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {Loader} from \"../utils/Loader\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {NormalMapCreator} from \"../utils/NormalMapCreator\";\r\nimport {PlainSegmentWorker} from \"../utils/PlainSegmentWorker\";\r\nimport {PlanetCamera} from \"../camera/PlanetCamera\";\r\nimport {Quat} from \"../math/Quat\";\r\nimport {QuadTreeStrategy} from \"../quadTree/QuadTreeStrategy\";\r\nimport {Ray} from \"../math/Ray\";\r\nimport {RenderNode} from \"./RenderNode\";\r\nimport {SimpleSkyBackground} from \"../control/SimpleSkyBackground\";\r\nimport {Sun} from \"../control/Sun\";\r\nimport {TerrainWorker} from \"../utils/TerrainWorker\";\r\nimport {Vec2, Vec3} from \"../math/index\";\r\nimport type {NumberArray2, NumberArray3, NumberArray4} from \"../math/index\";\r\nimport {Vector} from \"../layer/Vector\";\r\nimport {VectorTileCreator} from \"../utils/VectorTileCreator\";\r\nimport {wgs84} from \"../ellipsoid/wgs84\";\r\nimport type {WebGLBufferExt, WebGLTextureExt, IDefaultTextureParams} from \"../webgl/Handler\";\r\nimport {Program} from \"../webgl/Program\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport type {AtmosphereParameters} from \"../shaders/atmos/atmos\";\r\n\r\nexport interface IPlanetParams {\r\n    name?: string;\r\n    ellipsoid?: Ellipsoid;\r\n    minAltitude?: number;\r\n    maxAltitude?: number;\r\n    frustums?: NumberArray2[];\r\n    maxEqualZoomAltitude?: number;\r\n    minEqualZoomAltitude?: number;\r\n    minEqualZoomCameraSlope?: number;\r\n    quadTreeStrategyPrototype?: typeof QuadTreeStrategy;\r\n    ambient?: string | NumberArray3 | Vec3;\r\n    diffuse?: string | NumberArray3 | Vec3;\r\n    specular?: string | NumberArray3 | Vec3;\r\n    shininess?: number;\r\n    nightTextureSrc?: string | null;\r\n    specularTextureSrc?: string | null;\r\n    maxGridSize?: number;\r\n    maxLoadingRequests?: number;\r\n    atmosphereEnabled?: boolean;\r\n    transitionOpacityEnabled?: boolean;\r\n    atmosphereParameters?: IAtmosphereParams;\r\n}\r\n\r\nexport type PlanetEventsList = [\r\n    \"draw\",\r\n    \"layeradd\",\r\n    \"baselayerchange\",\r\n    \"layerremove\",\r\n    \"layervisibilitychange\",\r\n    \"rendercompleted\",\r\n    \"terraincompleted\",\r\n    \"layerloadend\"\r\n];\r\n\r\nconst CUR_LOD_SIZE = 256; //px\r\nconst MIN_LOD_SIZE = 512; //px\r\nconst MAX_LOD_SIZE = 256; //px\r\n\r\n/**\r\n * Maximum created nodes count. The more nodes count the more memory usage.\r\n * @const\r\n * @type {number}\r\n * @default\r\n */\r\nconst MAX_NODES = 200;\r\n\r\nconst HORIZON_TANGENT = 0.81;\r\n\r\ntype IndexBufferCacheData = { buffer: WebGLBufferExt | null };\r\n\r\n/**\r\n * Main class for rendering planet\r\n * @class\r\n * @extends {RenderNode}\r\n * @param {string} [options.name=\"Earth\"] - Planet name(Earth by default)\r\n * @param {Ellipsoid} [options.ellipsoid] - Planet ellipsoid(WGS84 by default)\r\n * @param {Number} [options.maxGridSize=128] - Segment maximal grid size\r\n * @param {Number} [options.maxEqualZoomAltitude=15000000.0] - Maximal altitude since segments on the screen become the same zoom level\r\n * @param {Number} [options.minEqualZoomAltitude=10000.0] - Minimal altitude since segments on the screen become the same zoom level\r\n * @param {Number} [options.minEqualZoomCameraSlope=0.8] - Minimal camera slope above te globe where segments on the screen become the same zoom level\r\n *\r\n * @fires EventsHandler<PlanetEventList>#draw\r\n * @fires EventsHandler<PlanetEventList>#layeradd\r\n * @fires EventsHandler<PlanetEventList>#baselayerchange\r\n * @fires EventsHandler<PlanetEventList>#layerremove\r\n * @fires EventsHandler<PlanetEventList>#layervisibilitychange\r\n * @fires EventsHandler<PlanetEventList>#geoimageadd\r\n */\r\nexport class Planet extends RenderNode {\r\n\r\n    public events: EventsHandler<PlanetEventsList>;\r\n\r\n    /**\r\n     * @public\r\n     * @type {Ellipsoid}\r\n     */\r\n    public ellipsoid: Ellipsoid;\r\n\r\n    /**\r\n     * @public\r\n     * @override\r\n     * @type {Boolean}\r\n     */\r\n    public override lightEnabled: boolean;\r\n\r\n    /**\r\n     * Squared ellipsoid radius.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _planetRadius2: number;\r\n\r\n    /**\r\n     * Layers array.\r\n     * @public\r\n     * @type {Array.<Layer>}\r\n     */\r\n    public _layers: Layer[];\r\n\r\n    /**\r\n     * Flag to trigger layer update in a next frame\r\n     * @type {boolean}\r\n     * @protected\r\n     */\r\n    protected _updateLayer: boolean;\r\n\r\n    /**\r\n     * Current visible imagery tile layers array.\r\n     * @public\r\n     * @type {Array.<Layer>}\r\n     */\r\n    public visibleTileLayers: Layer[];\r\n\r\n    /**\r\n     * Current visible vector layers array.\r\n     * @protected\r\n     * @type {Array.<Layer>}\r\n     */\r\n    protected visibleVectorLayers: Vector[];\r\n    protected _visibleVectorLayersByDepthOrder: Vector[][];\r\n\r\n    protected _visibleTileLayerSlices: Layer[][];\r\n\r\n    /**\r\n     * Vector layers visible nodes with collections.\r\n     * @protected\r\n     * @type {EntityCollection[][]}\r\n     */\r\n    protected _visibleEntityCollections: EntityCollection[][];\r\n\r\n    /**\r\n     * There is only one base layer on the globe when layer.isBaseLayer is true.\r\n     * @public\r\n     * @type {Layer}\r\n     */\r\n    public baseLayer: Layer | null;\r\n\r\n    /**\r\n     * Terrain provider.\r\n     * @public\r\n     * @type {EmptyTerrain}\r\n     */\r\n    public terrain: EmptyTerrain | null;\r\n\r\n    /**\r\n     * Camera is this.renderer.activeCamera pointer.\r\n     * @public\r\n     * @type {PlanetCamera}\r\n     */\r\n    public camera: PlanetCamera;\r\n\r\n    public maxEqualZoomAltitude: number;\r\n    public minEqualZoomAltitude: number;\r\n    public minEqualZoomCameraSlope: number;\r\n\r\n    /**\r\n     * Screen mouse pointer projected to planet cartesian position.\r\n     * @public\r\n     * @type {Vec3}\r\n     */\r\n    public mousePositionOnEarth: Vec3;\r\n\r\n    public emptyTexture: WebGLTextureExt | null;\r\n    public transparentTexture: WebGLTextureExt | null;\r\n    public defaultTexture: WebGLTextureExt | null;\r\n\r\n    /**\r\n     * Current visible minimal zoom index planet segment.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public minCurrZoom: number;\r\n\r\n    /**\r\n     * Current visible maximal zoom index planet segment.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public maxCurrZoom: number;\r\n\r\n    public _viewExtent: Extent;\r\n\r\n    protected _initialViewExtent: Extent | null;\r\n\r\n    public _createdNodesCount: number;\r\n\r\n    /**\r\n     * Planet's segments collected for rendering frame.\r\n     * @public\r\n     * @type {Node}\r\n     */\r\n    public _renderedNodes: Node[];\r\n\r\n    public _renderedNodesInFrustum: Node[][];\r\n\r\n    public _fadingNodes: Map<number, Node>;\r\n\r\n    public _fadingNodesInFrustum: Node[][];\r\n\r\n    protected _fadingOpaqueSegments: Segment[];\r\n\r\n    /**\r\n     * Layers activity lock.\r\n     * @public\r\n     * @type {Lock}\r\n     */\r\n    public layerLock: Lock;\r\n\r\n    /**\r\n     * Terrain providers activity lock.\r\n     * @public\r\n     * @type {Lock}\r\n     */\r\n    public terrainLock: Lock;\r\n\r\n    /**\r\n     * Height scale factor. 1 - is normal elevation scale.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public _heightFactor: number;\r\n\r\n    /**\r\n     * Precomputed indexes array for different grid size segments.\r\n     * @protected\r\n     * @type {Array.<Array.<number>>}\r\n     */\r\n    public _indexesCache: IndexBufferCacheData[][][][][];\r\n\r\n    protected _indexesCacheToRemove: IndexBufferCacheData[];\r\n    public _indexesCacheToRemoveCounter: number;\r\n\r\n    /**\r\n     * Precomputed texture coordinates buffers for different grid size segments.\r\n     * @public\r\n     * @type {Array.<Array.<number>>}\r\n     */\r\n    public _textureCoordsBufferCache: WebGLBufferExt[];\r\n\r\n    public quadTreeStrategy: QuadTreeStrategy;\r\n\r\n    /**\r\n     * Night glowing gl texture.\r\n     * @protected\r\n     */\r\n    protected _nightTexture: WebGLTextureExt | null;\r\n\r\n    /**\r\n     * Specular mask gl texture.\r\n     * @protected\r\n     */\r\n    protected _specularTexture: WebGLTextureExt | null;\r\n\r\n\r\n    public _ambient: Float32Array;\r\n    public _diffuse: Float32Array;\r\n    public _specular: Float32Array;\r\n\r\n    protected _maxGridSize: number;\r\n\r\n    /**\r\n     * Segment multiple textures size.(4 - convenient value for the most devices)\r\n     * @const\r\n     * @public\r\n     */\r\n    public SLICE_SIZE: number;\r\n    public SLICE_SIZE_4: number;\r\n    public SLICE_SIZE_3: number;\r\n\r\n    /**\r\n     * Level of details of visible segments.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _lodSize: number;\r\n    protected _curLodSize: number;\r\n    protected _minLodSize: number;\r\n    public _maxLodSize: number;\r\n\r\n    public _pickingColorArr: Float32Array;\r\n    public _samplerArr: Int32Array;\r\n    public _pickingMaskArr: Int32Array;\r\n\r\n    /**\r\n     * GeoImage creator.\r\n     * @public\r\n     * @type{GeoImageCreator}\r\n     */\r\n    public _geoImageCreator: GeoImageCreator;\r\n\r\n    /**\r\n     * VectorTileCreator creator.\r\n     * @public\r\n     * @type{VectorTileCreator}\r\n     */\r\n    public _vectorTileCreator: VectorTileCreator;\r\n\r\n    /**\r\n     * NormalMapCreator creator.\r\n     * @public\r\n     * @type{NormalMapCreator}\r\n     */\r\n    public _normalMapCreator: NormalMapCreator;\r\n\r\n    public _terrainWorker: TerrainWorker;\r\n\r\n    public _plainSegmentWorker: PlainSegmentWorker;\r\n\r\n    public _tileLoader: Loader<Layer>;\r\n\r\n    protected _memKey: Key;\r\n\r\n    public _distBeforeMemClear: number;\r\n\r\n    protected _prevCamEye: Vec3;\r\n\r\n    protected _initialized: boolean;\r\n\r\n    protected always: any[];\r\n\r\n    public _renderCompleted: boolean\r\n    public _renderCompletedActivated: boolean;\r\n\r\n    public _terrainCompleted: boolean;\r\n    public _terrainCompletedActivated: boolean;\r\n\r\n    protected _collectRenderNodesIsActive: boolean;\r\n\r\n    /**\r\n     * Night texture brightness coefficient\r\n     * @type {number}\r\n     */\r\n    public nightTextureCoefficient: number;\r\n\r\n    protected _renderScreenNodesPASS: () => void;\r\n    protected _renderScreenNodesWithHeightPASS: () => void;\r\n\r\n    protected _atmosphereEnabled: boolean;\r\n    protected _atmosphereMaxMinOpacity: Float32Array;\r\n\r\n    public solidTextureOne: WebGLTextureExt | null;\r\n    public solidTextureTwo: WebGLTextureExt | null;\r\n\r\n    protected _skipPreRender: boolean;\r\n\r\n    protected _nightTextureSrc: string | null;\r\n    protected _specularTextureSrc: string | null;\r\n\r\n    public transitionTime: number;\r\n\r\n    public _prevNodes: Map<number, Node>;\r\n    public _currNodes: Map<number, Node>;\r\n\r\n    protected _transitionOpacityEnabled: boolean;\r\n\r\n    protected _atmosphere: Atmosphere;\r\n\r\n    constructor(options: IPlanetParams = {}) {\r\n        super(options.name);\r\n\r\n        this._atmosphere = new Atmosphere(options.atmosphereParameters);\r\n\r\n        this._prevNodes = new Map<number, Node>();\r\n        this._currNodes = new Map<number, Node>();\r\n\r\n        this.transitionTime = 580;\r\n\r\n        this.ellipsoid = options.ellipsoid || wgs84;\r\n\r\n        this.lightEnabled = true;\r\n\r\n        this._planetRadius2 = (this.ellipsoid.getPolarSize() - 10000.0) * (this.ellipsoid.getPolarSize() - 10000.0);\r\n\r\n        this._layers = [];\r\n\r\n        this._updateLayer = false;\r\n\r\n        this.visibleTileLayers = [];\r\n\r\n        this.visibleVectorLayers = [];\r\n        this._visibleVectorLayersByDepthOrder = [];\r\n\r\n        this._visibleTileLayerSlices = [];\r\n\r\n        this._visibleEntityCollections = [[]];\r\n\r\n        this.baseLayer = null;\r\n\r\n        this.terrain = null;\r\n\r\n        this.camera = new PlanetCamera(this, {\r\n            frustums: options.frustums,\r\n            eye: new Vec3(25000000, 0, 0),\r\n            look: Vec3.ZERO,\r\n            up: Vec3.NORTH,\r\n            minAltitude: options.minAltitude,\r\n            maxAltitude: options.maxAltitude\r\n        });\r\n\r\n        this.maxEqualZoomAltitude = options.maxEqualZoomAltitude || 15000000.0;\r\n        this.minEqualZoomAltitude = options.minEqualZoomAltitude || 10000.0;\r\n        this.minEqualZoomCameraSlope = options.minEqualZoomCameraSlope || 0.8;\r\n\r\n        this.mousePositionOnEarth = new Vec3();\r\n\r\n        this.emptyTexture = null;\r\n        this.transparentTexture = null;\r\n        this.defaultTexture = null;\r\n\r\n        this.minCurrZoom = math.MAX;\r\n\r\n        this.maxCurrZoom = math.MIN;\r\n\r\n        this._viewExtent = new Extent(new LonLat(180, 180), new LonLat(-180, -180));\r\n\r\n        this._skipPreRender = false;\r\n\r\n        this._initialViewExtent = null;\r\n\r\n        this._createdNodesCount = 0;\r\n\r\n        this._renderedNodes = [];\r\n        this._renderedNodesInFrustum = [];\r\n\r\n        this._fadingNodes = new Map<number, Node>;\r\n        this._fadingNodesInFrustum = [];\r\n        this._fadingOpaqueSegments = [];\r\n\r\n        this.layerLock = new Lock();\r\n\r\n        this.terrainLock = new Lock();\r\n\r\n        this._heightFactor = 1.0;\r\n\r\n        this._indexesCache = [];\r\n        this._indexesCacheToRemove = [];\r\n        this._indexesCacheToRemoveCounter = 0;\r\n\r\n        this._textureCoordsBufferCache = [];\r\n\r\n        this.quadTreeStrategy = options.quadTreeStrategyPrototype ? new options.quadTreeStrategyPrototype(this) : new EarthQuadTreeStrategy(this);\r\n\r\n        this._nightTexture = null;\r\n\r\n        this._specularTexture = null;\r\n\r\n        let a = utils.createColorRGB(options.ambient, new Vec3(0.2, 0.2, 0.3));\r\n        let d = utils.createColorRGB(options.diffuse, new Vec3(1.0, 1.0, 1.0));\r\n        let s = utils.createColorRGB(options.specular, new Vec3(0.00063, 0.00055, 0.00032));\r\n        let shininess = options.shininess || 18.0;\r\n\r\n        this._ambient = new Float32Array([a.x, a.y, a.z]);\r\n        this._diffuse = new Float32Array([d.x, d.y, d.z]);\r\n        this._specular = new Float32Array([s.x, s.y, s.z, shininess]);\r\n\r\n        this._maxGridSize = Math.log2(options.maxGridSize || 256);\r\n\r\n        this.SLICE_SIZE = 4;\r\n        this.SLICE_SIZE_4 = this.SLICE_SIZE * 4;\r\n        this.SLICE_SIZE_3 = this.SLICE_SIZE * 3;\r\n\r\n        this._lodSize = CUR_LOD_SIZE;\r\n        this._curLodSize = CUR_LOD_SIZE;\r\n        this._minLodSize = MIN_LOD_SIZE;\r\n        this._maxLodSize = MAX_LOD_SIZE;\r\n\r\n        this._pickingColorArr = new Float32Array(this.SLICE_SIZE_4);\r\n        this._samplerArr = new Int32Array(this.SLICE_SIZE);\r\n        this._pickingMaskArr = new Int32Array(this.SLICE_SIZE);\r\n\r\n        this._geoImageCreator = new GeoImageCreator(this);\r\n\r\n        this._vectorTileCreator = new VectorTileCreator(this);\r\n\r\n        this._normalMapCreator = new NormalMapCreator(this);\r\n\r\n        this._terrainWorker = new TerrainWorker(3);\r\n\r\n        this._plainSegmentWorker = new PlainSegmentWorker(3);\r\n\r\n        this._tileLoader = new Loader(options.maxLoadingRequests || 12);\r\n\r\n        this._memKey = new Key();\r\n\r\n        this.events = createEvents<PlanetEventsList>(PLANET_EVENTS);\r\n\r\n        this._distBeforeMemClear = 0.0;\r\n\r\n        this._prevCamEye = new Vec3();\r\n\r\n        this._initialized = false;\r\n\r\n        this.always = [];\r\n\r\n        this._renderCompleted = false;\r\n        this._renderCompletedActivated = false;\r\n\r\n        this._terrainCompleted = false;\r\n        this._terrainCompletedActivated = false;\r\n        this._collectRenderNodesIsActive = true;\r\n\r\n        this.nightTextureCoefficient = 2.0;\r\n\r\n        this._renderScreenNodesPASS = this._renderScreenNodesPASSNoAtmos;\r\n        this._renderScreenNodesWithHeightPASS = this._renderScreenNodesWithHeightPASSNoAtmos;\r\n\r\n        this._atmosphereEnabled = options.atmosphereEnabled || false;\r\n        this._atmosphereMaxMinOpacity = new Float32Array([0.95, 0.28]);\r\n\r\n        this.solidTextureOne = null;\r\n        this.solidTextureTwo = null;\r\n\r\n        this._nightTextureSrc = options.nightTextureSrc || null;\r\n        this._specularTextureSrc = options.specularTextureSrc || null;\r\n\r\n        this._transitionOpacityEnabled = options.transitionOpacityEnabled != undefined ? options.transitionOpacityEnabled : true;\r\n    }\r\n\r\n    /**\r\n     * Returns true if current terrain data set is loaded\r\n     */\r\n    public get terrainReady(): boolean {\r\n        return this._terrainCompleted && this._terrainCompletedActivated;\r\n    }\r\n\r\n    public get maxGridSize(): number {\r\n        return this._maxGridSize;\r\n    }\r\n\r\n    public getNorthFrameRotation(cartesian: Vec3): Quat {\r\n        return this.getFrameRotation(cartesian);\r\n    }\r\n\r\n    public override getFrameRotation(cartesian: Vec3): Quat {\r\n        return this.ellipsoid.getNorthFrameRotation(cartesian);\r\n    }\r\n\r\n\r\n    public set atmosphereMaxOpacity(opacity: number) {\r\n        this._atmosphereMaxMinOpacity[0] = opacity;\r\n    }\r\n\r\n    public get atmosphereMaxOpacity(): number {\r\n        return this._atmosphereMaxMinOpacity[0];\r\n    }\r\n\r\n    public set atmosphereMinOpacity(opacity: number) {\r\n        this._atmosphereMaxMinOpacity[1] = opacity;\r\n    }\r\n\r\n    public get atmosphereMinOpacity(): number {\r\n        return this._atmosphereMaxMinOpacity[1];\r\n    }\r\n\r\n    public set atmosphereEnabled(enabled: boolean) {\r\n        if (enabled != this._atmosphereEnabled) {\r\n            this._atmosphereEnabled = enabled;\r\n            this._initializeAtmosphere();\r\n        }\r\n    }\r\n\r\n    public get atmosphereEnabled(): boolean {\r\n        return this._atmosphereEnabled;\r\n    }\r\n\r\n    public set diffuse(rgb: string | NumberArray3 | Vec3) {\r\n        let vec = createColorRGB(rgb);\r\n        this._diffuse = new Float32Array(vec.toArray());\r\n    }\r\n\r\n    public set ambient(rgb: string | NumberArray3 | Vec3) {\r\n        let vec = createColorRGB(rgb);\r\n        this._ambient = new Float32Array(vec.toArray());\r\n    }\r\n\r\n    public set specular(rgb: string | NumberArray3 | Vec3) {\r\n        let vec = createColorRGB(rgb);\r\n        this._specular = new Float32Array([vec.x, vec.y, vec.y, this._specular[3]]);\r\n    }\r\n\r\n    public set shininess(v: number) {\r\n        this._specular[3] = v;\r\n    }\r\n\r\n    public get normalMapCreator(): NormalMapCreator {\r\n        return this._normalMapCreator;\r\n    }\r\n\r\n    public get layers(): Layer[] {\r\n        return [...this._layers];\r\n    }\r\n\r\n    /**\r\n     * @todo: remove after tests\r\n     * Get the collection of layers associated with this planet.\r\n     * @return {Array.<Layer>} Layers array.\r\n     * @public\r\n     */\r\n    public getLayers(): Layer[] {\r\n        return this.layers;\r\n    }\r\n\r\n    public get sun(): Sun | undefined {\r\n        if (this.renderer && this.renderer.controls.sun)\r\n            return this.renderer.controls.sun as Sun;\r\n    }\r\n\r\n    public get sunPos(): Vec3 {\r\n        return this.sun!.sunlight.getPosition();\r\n    }\r\n\r\n    /**\r\n     * Add the given control to the renderer of the planet scene.\r\n     * @param {Control} control - Control.\r\n     */\r\n    public addControl(control: Control) {\r\n        control.planet = this;\r\n        control.addTo(this.renderer!);\r\n    }\r\n\r\n    public get lodSize(): number {\r\n        return this._lodSize;\r\n    }\r\n\r\n    public setLodSize(currentLodSize: number, minLodSize?: number, maxLodSize?: number) {\r\n        this._maxLodSize = maxLodSize || this._maxLodSize;\r\n        this._minLodSize = minLodSize || this._minLodSize;\r\n        this._curLodSize = currentLodSize;\r\n        this._renderCompletedActivated = false;\r\n        this._terrainCompletedActivated = false;\r\n    }\r\n\r\n    /**\r\n     * Add the given controls array to the renderer of the planet.\r\n     * @param {Array.<Control>} cArr - Control array.\r\n     */\r\n    public addControls(cArr: Control[]) {\r\n        for (let i = 0; i < cArr.length; i++) {\r\n            this.addControl(cArr[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return layer by it name\r\n     * @param {string} name - Name of the layer. og.Layer.prototype.name\r\n     * @public\r\n     * @returns {Layer} -\r\n     */\r\n    public getLayerByName(name: string): Layer | undefined {\r\n        for (let i = 0, len = this._layers.length; i < len; i++) {\r\n            if (name === this._layers[i].name) {\r\n                return this._layers[i];\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds layer to the planet.\r\n     * @param {Layer} layer - Layer object.\r\n     * @public\r\n     */\r\n    public addLayer(layer: Layer) {\r\n        layer.addTo(this);\r\n    }\r\n\r\n    /**\r\n     * Dispatch layer visibility changing event.\r\n     * @param {Layer} layer - Changed layer.\r\n     * @public\r\n     */\r\n    public _onLayerVisibilityChanged(layer: Layer) {\r\n        this.events.dispatch(this.events.layervisibilitychange, layer);\r\n    }\r\n\r\n    /**\r\n     * Adds the given layers array to the planet.\r\n     * @param {Array.<Layer>} layers - Layers array.\r\n     * @public\r\n     */\r\n    public addLayers(layers: Layer[]) {\r\n        for (let i = 0, len = layers.length; i < len; i++) {\r\n            this.addLayer(layers[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes the given layer from the planet.\r\n     * @param {Layer} layer - Layer to remove.\r\n     * @public\r\n     */\r\n    public removeLayer(layer: Layer) {\r\n        layer.remove();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @public\r\n     * @param {Layer} layer - Material layer.\r\n     */\r\n    public _clearLayerMaterial(layer: Layer) {\r\n        this.quadTreeStrategy.clearLayerMaterial(layer);\r\n    }\r\n\r\n    /**\r\n     * Sets base layer coverage to the planet.\r\n     * @param {Layer} layer - Layer object.\r\n     * @public\r\n     */\r\n    public setBaseLayer(layer: Layer) {\r\n        if (this.baseLayer) {\r\n            if (!this.baseLayer.isEqual(layer)) {\r\n                this.baseLayer.setVisibility(false);\r\n                this.baseLayer = layer;\r\n                layer.setVisibility(true);\r\n                this.events.dispatch(this.events.baselayerchange, layer);\r\n            }\r\n        } else {\r\n            this.baseLayer = layer;\r\n            this.baseLayer.setVisibility(true);\r\n            this.events.dispatch(this.events.baselayerchange, layer);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets elevation scale. 1.0 is default.\r\n     * @param {number} factor - Elevation scale.\r\n     */\r\n    public setHeightFactor(factor: number) {\r\n        this._renderCompletedActivated = false;\r\n        this._terrainCompletedActivated = false;\r\n\r\n        if (this._heightFactor !== factor) {\r\n            this._heightFactor = factor;\r\n            this.quadTreeStrategy.destroyBranches();\r\n            this._clearRenderedNodeList();\r\n            this._clearRenderNodesInFrustum();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets elevation scale.\r\n     * @returns {number} Terrain elevation scale\r\n     */\r\n    public getHeightFactor(): number {\r\n        return this._heightFactor;\r\n    }\r\n\r\n    /**\r\n     * Sets terrain provider\r\n     * @public\r\n     * @param {EmptyTerrain} terrain - Terrain provider.\r\n     */\r\n    public setTerrain(terrain: EmptyTerrain) {\r\n        this._renderCompletedActivated = false;\r\n        this._terrainCompletedActivated = false;\r\n\r\n        if (this._initialized) {\r\n            this.memClear();\r\n        }\r\n\r\n        if (this.terrain) {\r\n            this.terrain.abortLoading();\r\n            this.terrain.clearCache();\r\n            this.terrain._planet = null;\r\n        }\r\n\r\n        this.terrain = terrain;\r\n        this.terrain._planet = this;\r\n\r\n        this.quadTreeStrategy.destroyBranches();\r\n\r\n        if (terrain._geoid.model) {\r\n            this._plainSegmentWorker.setGeoid(terrain.getGeoid());\r\n            terrain._isReady = true;\r\n        } else {\r\n            Geoid.loadModel(terrain.geoid.src)\r\n                .then((m: GeoidModel | null) => {\r\n                    terrain.geoid.setModel(m);\r\n                    this._plainSegmentWorker.setGeoid(terrain.getGeoid());\r\n                    terrain._isReady = true;\r\n                })\r\n                .catch((err) => {\r\n                    console.warn(err);\r\n                });\r\n        }\r\n    }\r\n\r\n    public initAtmosphereShader(atmosParams?: AtmosphereParameters) {\r\n        if (this.renderer && this.renderer.handler && this._atmosphereEnabled) {\r\n            let h = this.renderer.handler;\r\n            if (h.isWebGl2()) {\r\n                h.removeProgram(\"drawnode_screen_wl\");\r\n                h.addProgram(shaders.drawnode_screen_wl_webgl2Atmos(atmosParams), true);\r\n            } else {\r\n                console.warn(\"Atmosphere WebGL2 only\");\r\n            }\r\n        }\r\n    }\r\n\r\n    public get atmosphereControl(): Atmosphere {\r\n        return this._atmosphere;\r\n    }\r\n\r\n    protected _initializeAtmosphere() {\r\n\r\n        if (!this.renderer) return;\r\n\r\n        let h = this.renderer.handler;\r\n\r\n        h.removeProgram(\"drawnode_screen_wl\");\r\n\r\n        if (this._atmosphereEnabled) {\r\n\r\n            this._renderScreenNodesPASS = this._renderScreenNodesPASSAtmos;\r\n            this._renderScreenNodesWithHeightPASS = this._renderScreenNodesWithHeightPASSAtmos;\r\n\r\n            if (!this.renderer.controls.Atmosphere) {\r\n                this.addControl(this._atmosphere);\r\n            }\r\n\r\n            this._atmosphere.activate();\r\n\r\n            if (h.isWebGl2()) {\r\n                h.addProgram(shaders.drawnode_screen_wl_webgl2Atmos(this._atmosphere.parameters), true);\r\n            } else {\r\n                h.addProgram(shaders.drawnode_screen_wl_webgl1NoAtmos(), true);\r\n            }\r\n\r\n            if (this.renderer.controls.SimpleSkyBackground) {\r\n                this.renderer.controls.SimpleSkyBackground.deactivate();\r\n            }\r\n\r\n        } else {\r\n\r\n            this._renderScreenNodesPASS = this._renderScreenNodesPASSNoAtmos;\r\n            this._renderScreenNodesWithHeightPASS = this._renderScreenNodesWithHeightPASSNoAtmos;\r\n\r\n            this._atmosphere.deactivate();\r\n\r\n            if (!this.renderer.controls.SimpleSkyBackground) {\r\n                this.addControl(new SimpleSkyBackground());\r\n            } else {\r\n                this.renderer.controls.SimpleSkyBackground.activate();\r\n            }\r\n\r\n            if (h.isWebGl2()) {\r\n                h.addProgram(shaders.drawnode_screen_wl_webgl2NoAtmos(), true);\r\n            } else {\r\n                h.addProgram(shaders.drawnode_screen_wl_webgl1NoAtmos(), true);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _initializeShaders() {\r\n        let h = this.renderer!.handler;\r\n\r\n        h.addProgram(shaders.drawnode_screen_nl(), true);\r\n        h.addProgram(shaders.drawnode_colorPicking(), true);\r\n        h.addProgram(shaders.drawnode_depth(), true);\r\n        //h.addProgram(shaders.drawnode_heightPicking(), true);\r\n\r\n        this.renderer!.addPickingCallback(this, this._renderColorPickingFramebufferPASS);\r\n        this.renderer!.addDepthCallback(this, this._renderDepthFramebufferPASS);\r\n    }\r\n\r\n    protected _onLayerLoadend(layer: Layer) {\r\n        this.events.dispatch(this.events.layerloadend, layer);\r\n    }\r\n\r\n    public override init() {\r\n\r\n        this._tileLoader.events.on(\"layerloadend\", this._onLayerLoadend, this);\r\n\r\n        // Initialization indexes table\r\n        segmentHelper.getInstance().setMaxGridSize(this._maxGridSize);\r\n\r\n        const TABLESIZE = this._maxGridSize;\r\n\r\n        let kk = 0;\r\n        // Initialization indexes buffers cache. It takes about 120mb RAM!\r\n        for (let i = 0; i <= TABLESIZE; i++) {\r\n            !this._indexesCache[i] && (this._indexesCache[i] = new Array(TABLESIZE));\r\n            for (let j = 0; j <= TABLESIZE; j++) {\r\n                !this._indexesCache[i][j] && (this._indexesCache[i][j] = new Array(TABLESIZE));\r\n                for (let k = 0; k <= TABLESIZE; k++) {\r\n                    !this._indexesCache[i][j][k] && (this._indexesCache[i][j][k] = new Array(TABLESIZE));\r\n                    for (let m = 0; m <= TABLESIZE; m++) {\r\n                        !this._indexesCache[i][j][k][m] && (this._indexesCache[i][j][k][m] = new Array(TABLESIZE));\r\n                        for (let q = 0; q <= TABLESIZE; q++) {\r\n\r\n                            let ptr: IndexBufferCacheData = {\r\n                                buffer: null\r\n                            };\r\n\r\n                            if (i >= 1 && i === j && i === k && i === m && i === q) {\r\n                                let indexes = segmentHelper.getInstance().createSegmentIndexes(i, [j, k, m, q]);\r\n                                ptr.buffer = this.renderer!.handler.createElementArrayBuffer(indexes, 1);\r\n                            } else {\r\n                                this._indexesCacheToRemove[kk++] = ptr;\r\n                            }\r\n\r\n                            this._indexesCache[i][j][k][m][q] = ptr;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this.renderer!.events.on(\"resize\", () => {\r\n            this._renderCompletedActivated = false;\r\n            this._terrainCompletedActivated = false;\r\n        });\r\n\r\n        this.renderer!.events.on(\"drawtransparent\", () => {\r\n            this._renderScreenNodesWithHeightPASS();\r\n        });\r\n\r\n        // Initialize texture coordinates buffer pool\r\n        this._textureCoordsBufferCache = [];\r\n\r\n        let texCoordCache = segmentHelper.getInstance().initTextureCoordsTable(TABLESIZE + 1);\r\n\r\n        for (let i = 0; i <= TABLESIZE; i++) {\r\n            this._textureCoordsBufferCache[i] = this.renderer!.handler.createArrayBuffer(texCoordCache[i], 2, ((1 << i) + 1) * ((1 << i) + 1));\r\n        }\r\n\r\n        // creating empty textures\r\n        this.renderer!.handler.createDefaultTexture(null, (t: WebGLTextureExt) => {\r\n            this.solidTextureOne = t;\r\n            this.solidTextureTwo = t;\r\n        });\r\n\r\n        this.transparentTexture = this.renderer!.handler.transparentTexture;\r\n\r\n        this._renderedNodesInFrustum = new Array(this.camera.frustums.length);\r\n        for (let i = 0, len = this._renderedNodesInFrustum.length; i < len; i++) {\r\n            this._renderedNodesInFrustum[i] = [];\r\n        }\r\n\r\n        // Creating quad trees nodes\r\n        this.quadTreeStrategy.init();\r\n\r\n        this.drawMode = this.renderer!.handler.gl!.TRIANGLE_STRIP;\r\n\r\n        // Applying shaders\r\n        this._initializeShaders();\r\n\r\n        this._initializeAtmosphere();\r\n\r\n        this._updateVisibleLayers();\r\n\r\n        // loading Earth night glowing texture\r\n        if (this._nightTextureSrc) {\r\n\r\n            let img = new Image();\r\n            img.crossOrigin = \"Anonymous\";\r\n            img.onload = () => {\r\n                this._nightTexture = this.renderer!.handler.createTextureDefault(img)!;\r\n                this._nightTexture.default = true;\r\n            };\r\n            img.src = this._nightTextureSrc;\r\n\r\n            // createImageBitmap(NIGHT).then((e: ImageBitmap) => {\r\n            //     this._nightTexture = this.renderer!.handler!.createTextureDefault(e);\r\n            // });\r\n        }\r\n\r\n        // load water specular mask\r\n        if (this._specularTextureSrc) {\r\n            let img = new Image();\r\n            img.crossOrigin = \"Anonymous\";\r\n            img.onload = () => {\r\n                this._specularTexture = this.renderer!.handler.createTextureDefault(img)!;\r\n                this._specularTexture.default = true;\r\n            };\r\n            img.src = this._specularTextureSrc;\r\n\r\n            // createImageBitmap(SPECULAR).then((e: ImageBitmap) => {\r\n            //     this._specularTexture = this.renderer!.handler!.createTexture_l(e);\r\n            // });\r\n        }\r\n\r\n        this._geoImageCreator.init();\r\n\r\n        this._vectorTileCreator.init();\r\n\r\n        this._normalMapCreator.init();\r\n\r\n        this.renderer!.events.on(\"draw\", this._globalPreDraw, this, -100);\r\n\r\n        // Loading first nodes for better viewing if you have started on a lower altitude.\r\n        this._preRender();\r\n\r\n        this.renderer!.events.on(\"postdraw\", () => {\r\n            this._checkRendercompleted();\r\n        });\r\n\r\n        this.initLayers();\r\n\r\n        this._initialized = true;\r\n\r\n        //\r\n        // after init\r\n        //\r\n        if (this._initialViewExtent) {\r\n            this.viewExtent(this._initialViewExtent);\r\n        }\r\n\r\n        this.renderer!.activeCamera = this.camera;\r\n        //this.camera.bindRenderer(this.renderer!);\r\n        this.camera.bindFrustumsPickingColors(this.renderer!);\r\n        this.camera.update();\r\n    }\r\n\r\n    public initLayers() {\r\n        let temp = [...this._layers];\r\n        for (let i = 0; i < temp.length; i++) {\r\n            this.removeLayer(temp[i]);\r\n            this.addLayer(temp[i]);\r\n        }\r\n    }\r\n\r\n    protected _clearIndexesCache() {\r\n        this._indexesCacheToRemoveCounter = 0;\r\n        let c = this._indexesCacheToRemove,\r\n            gl = this.renderer!.handler.gl!;\r\n        for (let i = 0, len = c.length; i < len; i++) {\r\n            let ci = c[i];\r\n            gl.deleteBuffer(ci.buffer as WebGLBuffer);\r\n            ci.buffer = null;\r\n        }\r\n    }\r\n\r\n    protected _preRender() {\r\n        this.quadTreeStrategy.preRender();\r\n        this._preLoad();\r\n    }\r\n\r\n    protected _preLoad() {\r\n        this._clearRenderedNodeList();\r\n        this._skipPreRender = false;\r\n        this.quadTreeStrategy.preLoad();\r\n    }\r\n\r\n    /**\r\n     * Creates default textures first for the North Pole and whole globe and second for the South Pole.\r\n     * @public\r\n     * @param{IDefaultTextureParams} param0 -\r\n     * @param{IDefaultTextureParams} param1 -\r\n     */\r\n    public createDefaultTextures(param0: IDefaultTextureParams, param1: IDefaultTextureParams) {\r\n        this.renderer!.handler.gl!.deleteTexture(this.solidTextureOne!);\r\n        this.renderer!.handler.gl!.deleteTexture(this.solidTextureTwo!);\r\n        this.renderer!.handler.createDefaultTexture(param0, (texture: WebGLTextureExt) => {\r\n            this.solidTextureOne = texture;\r\n        });\r\n        this.renderer!.handler.createDefaultTexture(param1, (texture: WebGLTextureExt) => {\r\n            this.solidTextureTwo = texture;\r\n        });\r\n    }\r\n\r\n    protected _getLayerAttributionHTML(layer: Layer) {\r\n        return `<div class=\"og-attribution__layer\">${layer.getAttribution()}</div>`;\r\n    }\r\n\r\n    /**\r\n     * Updates attribution lists\r\n     * @public\r\n     */\r\n    public updateAttributionsList() {\r\n        let html = \"\";\r\n        for (let i = 0, len = this._layers.length; i < len; i++) {\r\n            let li = this._layers[i];\r\n            if (li.getVisibility()) {\r\n                if (li.getAttribution().length) {\r\n                    html += this._getLayerAttributionHTML(li);\r\n                }\r\n            }\r\n        }\r\n        this._applyAttribution(html)\r\n    }\r\n\r\n    public updateVisibleLayers() {\r\n        this._updateLayer = true;\r\n    }\r\n\r\n    protected _updateVisibleLayers() {\r\n        this.visibleTileLayers = [];\r\n        this.visibleTileLayers.length = 0;\r\n\r\n        this.visibleVectorLayers = [];\r\n        this.visibleVectorLayers.length = 0;\r\n\r\n        let html = \"\";\r\n        for (let i = 0, len = this._layers.length; i < len; i++) {\r\n            let li = this._layers[i];\r\n            if (li.getVisibility()) {\r\n                if (li.isBaseLayer()) {\r\n                    this.createDefaultTextures(li._defaultTextures[0]!, li._defaultTextures[1]!);\r\n                    this.baseLayer = li;\r\n                }\r\n\r\n                if (li.hasImageryTiles()) {\r\n                    this.visibleTileLayers.push(li);\r\n                }\r\n\r\n                if (li.isVector) {\r\n                    this.visibleVectorLayers.push(li as Vector);\r\n                }\r\n\r\n                if (li.getAttribution().length) {\r\n                    html += this._getLayerAttributionHTML(li);\r\n                }\r\n\r\n            } else if (li._fading && li._fadingOpacity > 0) {\r\n                if (li.hasImageryTiles()) {\r\n                    this.visibleTileLayers.push(li);\r\n                }\r\n\r\n                if (li.isVector) {\r\n                    this.visibleVectorLayers.push(li as Vector);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._applyAttribution(html);\r\n\r\n        this._sortLayers();\r\n    }\r\n\r\n    /**\r\n     * Apply to render list of layer attributions\r\n     * @protected\r\n     */\r\n    protected _applyAttribution(html: string) {\r\n        if (this.renderer && this.renderer.div) {\r\n            if (html.length) {\r\n                if (this.renderer.div.attributions!.innerHTML !== html) {\r\n                    this.renderer.div.attributions!.innerHTML = html;\r\n                }\r\n            } else {\r\n                this.renderer.div.attributions!.innerHTML = \"\";\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sort visible layer - preparing for rendering.\r\n     * @protected\r\n     */\r\n    protected _sortLayers() {\r\n\r\n        this.visibleVectorLayers.sort((a, b) => (a.getZIndex() - b.getZIndex()) || (a.getHeight() - b.getHeight()));\r\n\r\n        let grouped: Record<number, Vector[]> = {0: []};\r\n        for (const vi of this.visibleVectorLayers) {\r\n            if (!grouped[vi.depthOrder]) {\r\n                grouped[vi.depthOrder] = [];\r\n            }\r\n            grouped[vi.depthOrder].push(vi);\r\n        }\r\n\r\n        this._visibleVectorLayersByDepthOrder.length = 0;\r\n        this._visibleVectorLayersByDepthOrder = [];\r\n        this._visibleVectorLayersByDepthOrder = Object.keys(grouped)\r\n            .sort((a, b) => Number(a) - Number(b))\r\n            .map(key => grouped[Number(key)]);\r\n\r\n        this._visibleTileLayerSlices = [];\r\n        this._visibleTileLayerSlices.length = 0;\r\n\r\n        if (this.visibleTileLayers.length) {\r\n            this.visibleTileLayers.sort((a, b) => (a.getHeight() - b.getHeight()) || (a.getZIndex() - b.getZIndex()));\r\n\r\n            let k = -1;\r\n            let currHeight = this.visibleTileLayers[0].getHeight();\r\n            for (let i = 0, len = this.visibleTileLayers.length; i < len; i++) {\r\n                if (i % this.SLICE_SIZE === 0 || this.visibleTileLayers[i].getHeight() !== currHeight) {\r\n                    k++;\r\n                    this._visibleTileLayerSlices[k] = [];\r\n                    currHeight = this.visibleTileLayers[i].getHeight();\r\n                }\r\n                this._visibleTileLayerSlices[k].push(this.visibleTileLayers[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _clearRenderedNodeList() {\r\n        this._renderedNodes.length = 0;\r\n        this._renderedNodes = [];\r\n    }\r\n\r\n    protected _clearRenderNodesInFrustum() {\r\n        for (let i = 0, len = this._renderedNodesInFrustum.length; i < len; i++) {\r\n            this._renderedNodesInFrustum[i].length = 0;\r\n            this._renderedNodesInFrustum[i] = [];\r\n        }\r\n    }\r\n\r\n    protected _collectRenderedNodesMaxZoom(cam: PlanetCamera) {\r\n        if (cam.slope > this.minEqualZoomCameraSlope && cam._lonLat.height < this.maxEqualZoomAltitude && cam._lonLat.height > this.minEqualZoomAltitude) {\r\n\r\n            this.minCurrZoom = this.maxCurrZoom;\r\n\r\n            let temp = this._renderedNodes,\r\n                rf = this._renderedNodesInFrustum,\r\n                temp2 = [];\r\n\r\n            this._clearRenderNodesInFrustum();\r\n            this._renderedNodes = [];\r\n\r\n            for (let i = 0, len = temp.length; i < len; i++) {\r\n                let ri = temp[i];\r\n                let ht = ri.segment.centerNormal.dot(cam.getBackward());\r\n                if (ri.segment.tileZoom === this.maxCurrZoom || ht < HORIZON_TANGENT) {\r\n                    this._renderedNodes.push(ri);\r\n                    let k = 0, inFrustum = ri.inFrustum;\r\n                    while (inFrustum) {\r\n                        if (inFrustum & 1) {\r\n                            rf[k].push(ri);\r\n                        }\r\n                        k++;\r\n                        inFrustum >>= 1;\r\n                    }\r\n                } else {\r\n                    temp2.push(ri);\r\n                }\r\n            }\r\n\r\n            for (let i = 0, len = temp2.length; i < len; i++) {\r\n                temp2[i].renderTree(cam, this.maxCurrZoom, null, false, temp2[i]);\r\n            }\r\n        }\r\n    }\r\n\r\n    public set transitionOpacityEnabled(isEnabled: boolean) {\r\n        this._transitionOpacityEnabled = isEnabled;\r\n        //@todo: set render nodes transition opacity to one\r\n    }\r\n\r\n    public get transitionOpacityEnabled(): boolean {\r\n        return this._transitionOpacityEnabled;\r\n    }\r\n\r\n    /**\r\n     * Collects visible quad nodes.\r\n     * @protected\r\n     */\r\n    protected _collectRenderNodes(cam: PlanetCamera) {\r\n        this._lodSize = math.lerp(cam.slope < 0.0 ? 0.0 : cam.slope, this._curLodSize, this._minLodSize);\r\n        cam._insideSegment = null;\r\n\r\n        // clear first\r\n        this._clearRenderedNodeList();\r\n        this._clearRenderNodesInFrustum();\r\n\r\n        this._viewExtent.southWest.set(180, 180);\r\n        this._viewExtent.northEast.set(-180, -180);\r\n\r\n        // todo: replace to camera\r\n        this.minCurrZoom = math.MAX;\r\n        this.maxCurrZoom = math.MIN;\r\n\r\n        this.quadTreeStrategy.collectRenderNodes();\r\n\r\n        this._collectRenderedNodesMaxZoom(cam);\r\n\r\n        // main camera effect\r\n        this._fadingNodes.clear();\r\n\r\n        if (this._transitionOpacityEnabled) {\r\n\r\n            let opaqueNodes: Node[] = [];\r\n\r\n            for (let i = 0; i < this._renderedNodes.length; i++) {\r\n                let ri = this._renderedNodes[i];\r\n                // it's not impossible to move the code into Node.addToRender, because\r\n                // we can't know actual state before _collectRenderedNodesMaxZoom pass\r\n                ri._collectFadingNodes();\r\n                ri._refreshTransitionOpacity();\r\n\r\n                if (ri.segment._transitionOpacity >= 1.0) {\r\n                    ri.clearNeighbors();\r\n                    ri.getRenderedNodesNeighbors(opaqueNodes);\r\n                    opaqueNodes.push(ri);\r\n                } else {\r\n                    for (let j = 0; j < ri._fadingNodes.length; j++) {\r\n                        let rij = ri._fadingNodes[j];\r\n                        if (rij.segment && rij.segment._transitionOpacity >= 1.0) {\r\n                            rij.clearNeighbors();\r\n                            rij.getRenderedNodesNeighbors(opaqueNodes);\r\n                            opaqueNodes.push(rij);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _renderScreenNodesPASSNoAtmos() {\r\n        let cam = this.renderer!.activeCamera as PlanetCamera;\r\n        let sh = this._setUniformsNoAtmos(cam);\r\n        //\r\n        // PASS 0: rendering base slice of layers, which is often zero height\r\n        this._renderingScreenNodes(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\r\n    }\r\n\r\n    protected _renderScreenNodesPASSAtmos() {\r\n        let cam = this.renderer!.activeCamera as PlanetCamera;\r\n        let sh = this._setUniformsAtmos(cam);\r\n        //\r\n        // PASS 0: rendering base slice of layers, which is often zero height\r\n        this._renderingScreenNodes(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\r\n    }\r\n\r\n    protected _renderScreenNodesWithHeightPASSNoAtmos() {\r\n        let cam = this.renderer!.activeCamera as PlanetCamera;\r\n        let sh = this._setUniformsNoAtmos(cam);\r\n        //\r\n        // PASS 1: rendering slices, and layers with heights, without transition opacity effect\r\n        this._renderingScreenNodesWithHeight(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\r\n    }\r\n\r\n    protected _renderScreenNodesWithHeightPASSAtmos() {\r\n        let cam = this.renderer!.activeCamera as PlanetCamera;\r\n        let sh = this._setUniformsAtmos(cam);\r\n        //\r\n        // PASS 1: rendering slices, and layers with heights, without transition opacity effect\r\n        this._renderingScreenNodesWithHeight(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\r\n    }\r\n\r\n    protected _globalPreDraw() {\r\n        let cam = this.camera;\r\n\r\n        this._distBeforeMemClear += this._prevCamEye.distance(cam.eye);\r\n        this._prevCamEye.copy(cam.eye);\r\n        cam.checkFly();\r\n\r\n        // free memory\r\n        if (this._createdNodesCount > MAX_NODES && this._distBeforeMemClear > 1000.0) {\r\n            this.terrain!.clearCache();\r\n            this.memClear();\r\n        }\r\n\r\n        if (this._indexesCacheToRemoveCounter > 600) {\r\n            this._clearIndexesCache();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Render node callback.\r\n     * @public\r\n     */\r\n    public override preFrame() {\r\n\r\n        if (this._updateLayer) {\r\n            this._updateLayer = false;\r\n            this._updateVisibleLayers();\r\n        }\r\n\r\n        if (this.camera.isFirstPass) {\r\n            this.camera.update();\r\n\r\n            if (this._skipPreRender && this._collectRenderNodesIsActive) {\r\n                this._collectRenderNodes(this.camera);\r\n            }\r\n\r\n            this._skipPreRender = true;\r\n\r\n            //this.transformLights();\r\n\r\n            // creates terrain normal maps\r\n            this._normalMapCreator.frame();\r\n\r\n            // Creating geoImages textures.\r\n            this._geoImageCreator.frame();\r\n\r\n            // Vector tiles rasterization\r\n            this._vectorTileCreator.frame();\r\n\r\n            this.camera.checkTerrainCollision();\r\n            this.camera.update();\r\n\r\n            // Here is the planet node dispatches a draw event before\r\n            // rendering begins, and we have got render nodes.\r\n            this.events.dispatch(this.events.draw, this);\r\n\r\n            // Collect entity collections from vector layers\r\n            this._collectVectorLayerCollections();\r\n        }\r\n\r\n        for (let i = 0; i < this._visibleEntityCollections.length; i++) {\r\n            this.drawEntityCollections(this._visibleEntityCollections[i], i);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Render node callback.\r\n     * Frame function is called for each renderer activrCamera frustum.\r\n     * @public\r\n     * @override\r\n     */\r\n    public override frame() {\r\n        this._renderScreenNodesPASS();\r\n    }\r\n\r\n    protected _checkRendercompleted() {\r\n        if (this._renderCompleted) {\r\n            if (!this._renderCompletedActivated) {\r\n                this._renderCompletedActivated = true;\r\n                this.events.dispatch(this.events.rendercompleted, true);\r\n            }\r\n        } else {\r\n            this._renderCompletedActivated = false;\r\n        }\r\n        this._renderCompleted = true;\r\n\r\n        if (this._terrainCompleted) {\r\n            if (!this._terrainCompletedActivated) {\r\n                this._terrainCompletedActivated = true;\r\n                this.events.dispatch(this.events.terraincompleted, true);\r\n            }\r\n        } else {\r\n            this._terrainCompletedActivated = false;\r\n        }\r\n\r\n        this._terrainCompleted = true;\r\n    }\r\n\r\n    public lockQuadTree() {\r\n        this._collectRenderNodesIsActive = false;\r\n        this.camera.setTerrainCollisionActivity(false);\r\n    }\r\n\r\n    public unlockQuadTree() {\r\n        this._collectRenderNodesIsActive = true;\r\n        this.camera.setTerrainCollisionActivity(true);\r\n    }\r\n\r\n\r\n    protected _setUniformsNoAtmos(cam: PlanetCamera): Program {\r\n        let sh, shu;\r\n        let renderer = this.renderer!;\r\n\r\n        let h = renderer.handler;\r\n        let gl = h.gl!;\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n        renderer.enableBlendOneSrcAlpha();\r\n\r\n        if (this.lightEnabled) {\r\n            h.programs.drawnode_screen_wl.activate();\r\n            sh = h.programs.drawnode_screen_wl._program;\r\n            shu = sh.uniforms;\r\n\r\n            gl.uniform3fv(shu.lightPosition, this._lightPosition);\r\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\r\n\r\n            if (this.baseLayer) {\r\n                gl.uniform3fv(shu.diffuse, this.baseLayer._diffuse || this._diffuse);\r\n                gl.uniform3fv(shu.ambient, this.baseLayer._ambient || this._ambient);\r\n                gl.uniform4fv(shu.specular, this.baseLayer._specular || this._specular);\r\n                gl.uniform1f(shu.nightTextureCoefficient, this.baseLayer.nightTextureCoefficient || this.nightTextureCoefficient);\r\n            } else {\r\n                gl.uniform3fv(shu.diffuse, this._diffuse);\r\n                gl.uniform3fv(shu.ambient, this._ambient);\r\n                gl.uniform4fv(shu.specular, this._specular);\r\n                gl.uniform1f(shu.nightTextureCoefficient, this.nightTextureCoefficient);\r\n            }\r\n\r\n            //\r\n            // Night and specular\r\n            //\r\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE);\r\n            gl.bindTexture(gl.TEXTURE_2D, this._nightTexture! || this.transparentTexture!);\r\n            gl.uniform1i(shu.nightTexture, this.SLICE_SIZE);\r\n\r\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 1);\r\n            gl.bindTexture(gl.TEXTURE_2D, this._specularTexture! || this.transparentTexture!);\r\n            gl.uniform1i(shu.specularTexture, this.SLICE_SIZE + 1);\r\n\r\n            gl.uniform1f(shu.camHeight, cam.getHeight());\r\n\r\n        } else {\r\n            h.programs.drawnode_screen_nl.activate();\r\n            sh = h.programs.drawnode_screen_nl._program;\r\n            shu = sh.uniforms;\r\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\r\n        }\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\r\n\r\n        return sh;\r\n    }\r\n\r\n    protected _setUniformsAtmos(cam: PlanetCamera): Program {\r\n\r\n        let sh, shu;\r\n        let renderer = this.renderer!;\r\n        let h = renderer.handler;\r\n        let gl = h.gl!;\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n        renderer.enableBlendOneSrcAlpha();\r\n\r\n        if (this.lightEnabled) {\r\n            h.programs.drawnode_screen_wl.activate();\r\n            sh = h.programs.drawnode_screen_wl._program;\r\n            shu = sh.uniforms;\r\n\r\n            gl.uniform3fv(shu.lightPosition, this._lightPosition);\r\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\r\n\r\n            if (this.baseLayer) {\r\n                gl.uniform3fv(shu.diffuse, this.baseLayer._diffuse || this._diffuse);\r\n                gl.uniform3fv(shu.ambient, this.baseLayer._ambient || this._ambient);\r\n                gl.uniform4fv(shu.specular, this.baseLayer._specular || this._specular);\r\n                gl.uniform1f(shu.nightTextureCoefficient, this.baseLayer.nightTextureCoefficient || this.nightTextureCoefficient);\r\n            } else {\r\n                gl.uniform3fv(shu.diffuse, this._diffuse);\r\n                gl.uniform3fv(shu.ambient, this._ambient);\r\n                gl.uniform4fv(shu.specular, this._specular);\r\n                gl.uniform1f(shu.nightTextureCoefficient, this.nightTextureCoefficient);\r\n            }\r\n\r\n            gl.uniform2fv(shu.maxMinOpacity, this._atmosphereMaxMinOpacity);\r\n\r\n            //\r\n            // Night and specular\r\n            //\r\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE);\r\n            gl.bindTexture(gl.TEXTURE_2D, this._nightTexture! || this.transparentTexture!);\r\n            gl.uniform1i(shu.nightTexture, this.SLICE_SIZE);\r\n\r\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 1);\r\n            gl.bindTexture(gl.TEXTURE_2D, this._specularTexture! || this.transparentTexture!);\r\n            gl.uniform1i(shu.specularTexture, this.SLICE_SIZE + 1);\r\n\r\n            //\r\n            // atmos precomputed textures\r\n            //\r\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 4);\r\n            gl.bindTexture(gl.TEXTURE_2D, (renderer.controls.Atmosphere as Atmosphere)._transmittanceBuffer!.textures[0]);\r\n            gl.uniform1i(shu.transmittanceTexture, this.SLICE_SIZE + 4);\r\n\r\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 5);\r\n            gl.bindTexture(gl.TEXTURE_2D, (renderer.controls.Atmosphere as Atmosphere)._scatteringBuffer!.textures[0]);\r\n            gl.uniform1i(shu.scatteringTexture, this.SLICE_SIZE + 5);\r\n\r\n            gl.uniform1f(shu.camHeight, cam.getHeight());\r\n\r\n        } else {\r\n            h.programs.drawnode_screen_nl.activate();\r\n            sh = h.programs.drawnode_screen_nl._program;\r\n            shu = sh.uniforms;\r\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\r\n        }\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\r\n\r\n        return sh;\r\n    }\r\n\r\n    protected _renderingFadingNodes = (nodes: Map<number, boolean>, sh: Program, currentNode: Node, sl: Layer[], sliceIndex: number, outTransparentSegments?: Segment[], outOpaqueSegments?: Segment[]) => {\r\n\r\n        let isFirstPass = sliceIndex === 0;\r\n        let isEq = this.terrain!.equalizeVertices;\r\n\r\n        for (let j = 0, len = currentNode._fadingNodes.length; j < len; j++) {\r\n            let f = currentNode._fadingNodes[j].segment;\r\n            if (this._fadingNodes.has(currentNode._fadingNodes[0].__id) && !nodes.has(f.node.__id)) {\r\n                nodes.set(f.node.__id, true);\r\n\r\n                if (f._transitionOpacity < 1.0) {\r\n                    outTransparentSegments!.push(f);\r\n                } else {\r\n                    if (isFirstPass) {\r\n                        isEq && f.equalize();\r\n                        f.readyToEngage && f.engage();\r\n                        f.screenRendering(sh, sl, sliceIndex);\r\n                        outOpaqueSegments!.push(f);\r\n                    } else {\r\n                        f.screenRendering(sh, sl, sliceIndex, this.transparentTexture, true);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _renderingFadingNodesNoDepth = (nodes: Map<number, boolean>, sh: Program, currentNode: Node, sl: Layer[], sliceIndex: number, outOpaqueSegments?: Segment[]) => {\r\n\r\n        let isFirstPass = sliceIndex === 0;\r\n        let isEq = this.terrain!.equalizeVertices;\r\n        let gl = sh.gl!;\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        for (let j = 0, len = currentNode._fadingNodes.length; j < len; j++) {\r\n            let f = currentNode._fadingNodes[j].segment;\r\n            if (this._fadingNodes.has(currentNode._fadingNodes[0].__id) && !nodes.has(f.node.__id)) {\r\n                nodes.set(f.node.__id, true);\r\n                if (isFirstPass) {\r\n                    isEq && f.equalize();\r\n                    f.readyToEngage && f.engage();\r\n                    f.screenRendering(sh, sl, sliceIndex);\r\n                    outOpaqueSegments!.push(f);\r\n                } else {\r\n                    f.screenRendering(sh, sl, sliceIndex, this.transparentTexture, true);\r\n                }\r\n            }\r\n        }\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n    }\r\n\r\n    /**\r\n     * Drawing nodes\r\n     */\r\n    protected _renderingScreenNodes(sh: Program, cam: PlanetCamera, renderedNodes: Node[]) {\r\n\r\n        let firstPass = cam.isFirstPass;\r\n\r\n        let sl = this._visibleTileLayerSlices;\r\n\r\n        if (sl.length) {\r\n            let sli = sl[0];\r\n            for (let i = sli.length - 1; i >= 0; --i) {\r\n                let li = sli[i];\r\n                if (li._fading && firstPass && li._refreshFadingOpacity()) {\r\n                    sli.splice(i, 1);\r\n                }\r\n            }\r\n        }\r\n\r\n        let nodes = new Map<number, boolean>;\r\n        let transparentSegments: Segment[] = [];\r\n\r\n        let isEq = this.terrain!.equalizeVertices;\r\n        let i = renderedNodes.length;\r\n\r\n        //\r\n        // Collect fading opaque segments, because we need them in the framebuffer passes,\r\n        // as the segments with equalized sides, which means that there are no gaps\r\n        // between currently rendered neighbours\r\n        //\r\n        this._fadingOpaqueSegments = [];\r\n\r\n        if (cam.slope > 0.8 || !this.terrain || this.terrain.isEmpty /*|| cam.getAltitude() > 10000*/) {\r\n            while (i--) {\r\n                let ri = renderedNodes[i];\r\n                let s = ri.segment;\r\n\r\n                this._renderingFadingNodesNoDepth(nodes, sh, ri, sl[0], 0, this._fadingOpaqueSegments);\r\n\r\n                isEq && s.equalize();\r\n                s.readyToEngage && s.engage();\r\n                s.screenRendering(sh, sl[0], 0);\r\n            }\r\n        } else {\r\n\r\n            //\r\n            // Render opaque segments on the first pass, remove transparent ones into second pass\r\n            //\r\n            while (i--) {\r\n                let ri = renderedNodes[i];\r\n                let s = ri.segment;\r\n\r\n                this._renderingFadingNodes(nodes, sh, ri, sl[0], 0, transparentSegments, this._fadingOpaqueSegments);\r\n\r\n                if (s._transitionOpacity < 1) {\r\n                    transparentSegments.push(s);\r\n                } else {\r\n                    isEq && s.equalize();\r\n                    s.readyToEngage && s.engage();\r\n                    s.screenRendering(sh, sl[0], 0);\r\n                }\r\n            }\r\n\r\n            //\r\n            // Render transparent segments\r\n            //\r\n            for (let j = 0; j < transparentSegments.length; j++) {\r\n                let tj = transparentSegments[j];\r\n\r\n                isEq && tj.equalize();\r\n                tj.readyToEngage && tj.engage();\r\n                tj.screenRendering(sh, sl[0], 0);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    protected _renderingScreenNodesWithHeight(sh: Program, cam: PlanetCamera, renderedNodes: Node[]) {\r\n        let gl = this.renderer!.handler.gl!;\r\n        let firstPass = cam.isFirstPass;\r\n\r\n        let sl = this._visibleTileLayerSlices;\r\n\r\n        gl.enable(gl.POLYGON_OFFSET_FILL);\r\n        gl.disable(gl.CULL_FACE);\r\n\r\n        let nodes = new Map<number, boolean>;\r\n        let transparentSegments: Segment[] = [];\r\n\r\n        for (let j = 1, len = sl.length; j < len; j++) {\r\n            let slj = sl[j];\r\n            for (let i = slj.length - 1; i >= 0; --i) {\r\n                let li = slj[i];\r\n                if (li._fading && firstPass && li._refreshFadingOpacity()) {\r\n                    slj.splice(i, 1);\r\n                }\r\n            }\r\n\r\n            gl.polygonOffset(0, -j);\r\n            let i = renderedNodes.length;\r\n            while (i--) {\r\n                let ri = renderedNodes[i];\r\n                this._renderingFadingNodes(nodes, sh, ri, sl[j], j, transparentSegments);\r\n                if (ri.segment._transitionOpacity < 1) {\r\n                    ri.segment.initSlice(j);\r\n                } else {\r\n                    ri.segment.screenRendering(sh, sl[j], j, this.transparentTexture, true);\r\n                }\r\n            }\r\n        }\r\n\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n        gl.enable(gl.CULL_FACE);\r\n    }\r\n\r\n    protected _renderColorPickingFramebufferPASS() {\r\n        let sh;\r\n        let renderer = this.renderer!;\r\n        let h = renderer.handler;\r\n        let gl = h.gl!;\r\n        h.programs.drawnode_colorPicking.activate();\r\n        sh = h.programs.drawnode_colorPicking._program;\r\n        let shu = sh.uniforms;\r\n        let cam = renderer.activeCamera!;\r\n\r\n        gl.enable(gl.CULL_FACE);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\r\n\r\n        // drawing planet nodes\r\n        let rn = this._renderedNodesInFrustum[cam.getCurrentFrustum()];\r\n        let sl = this._visibleTileLayerSlices;\r\n\r\n        let i = rn.length;\r\n        while (i--) {\r\n            if (rn[i].segment._transitionOpacity >= 1) {\r\n                rn[i].segment.colorPickingRendering(sh, sl[0], 0);\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this._fadingOpaqueSegments.length; ++i) {\r\n            this._fadingOpaqueSegments[i].colorPickingRendering(sh, sl[0], 0);\r\n        }\r\n\r\n        // Here is set blending for transparent overlays\r\n        renderer.enableBlendDefault();\r\n\r\n        gl.enable(gl.POLYGON_OFFSET_FILL);\r\n        for (let j = 1, len = sl.length; j < len; j++) {\r\n            i = rn.length;\r\n            gl.polygonOffset(0, -j);\r\n            while (i--) {\r\n                rn[i].segment.colorPickingRendering(sh, sl[j], j, this.transparentTexture, true);\r\n            }\r\n        }\r\n\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n    }\r\n\r\n    protected _renderDepthFramebufferPASS() {\r\n        let sh;\r\n        let renderer = this.renderer!;\r\n        let h = renderer.handler;\r\n        let gl = h.gl!;\r\n        h.programs.drawnode_depth.activate();\r\n        sh = h.programs.drawnode_depth._program;\r\n        let shu = sh.uniforms;\r\n        let cam = renderer.activeCamera!;\r\n\r\n        gl.disable(gl.BLEND);\r\n        gl.disable(gl.POLYGON_OFFSET_FILL);\r\n\r\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\r\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\r\n\r\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\r\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\r\n\r\n        gl.uniform1f(shu.frustumPickingColor, cam.frustumColorIndex);\r\n\r\n        // drawing planet nodes\r\n        let rn = this._renderedNodesInFrustum[cam.getCurrentFrustum()],\r\n            sl = this._visibleTileLayerSlices;\r\n\r\n        let i = rn.length;\r\n        while (i--) {\r\n            if (rn[i].segment._transitionOpacity >= 1) {\r\n                rn[i].segment.depthRendering(sh, sl[0]);\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this._fadingOpaqueSegments.length; ++i) {\r\n            this._fadingOpaqueSegments[i].depthRendering(sh, sl[0]);\r\n        }\r\n\r\n        gl.enable(gl.BLEND);\r\n    }\r\n\r\n    protected _collectVectorLayerCollections() {\r\n\r\n        let k = this._visibleVectorLayersByDepthOrder.length;\r\n        this._visibleEntityCollections.length = 0;\r\n        this._visibleEntityCollections = new Array(k);\r\n        for (let i = 0; i < this._visibleEntityCollections.length; i++) {\r\n            this._visibleEntityCollections[i] = [];\r\n        }\r\n\r\n        while (k--) {\r\n            let group = this._visibleVectorLayersByDepthOrder[k];\r\n            let j = group.length;\r\n            while (j--) {\r\n                let vi = group[j];\r\n                if (vi._fading && vi._refreshFadingOpacity()) {\r\n                    group.splice(j, 1);\r\n                    if (group.length === 0) {\r\n                        this._visibleVectorLayersByDepthOrder.splice(k, 1);\r\n                    }\r\n                }\r\n\r\n                vi.collectVisibleCollections(this._visibleEntityCollections[k]);\r\n                vi.update();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Starts clear memory thread.\r\n     * @public\r\n     */\r\n    public memClear() {\r\n        this._distBeforeMemClear = 0;\r\n\r\n        this.camera._insideSegment = null;\r\n\r\n        this.layerLock.lock(this._memKey);\r\n        this.terrainLock.lock(this._memKey);\r\n        this._normalMapCreator.lock(this._memKey);\r\n\r\n        this._normalMapCreator.clear();\r\n        this.terrain!.abortLoading();\r\n        this._tileLoader.abortAll();\r\n\r\n        this.quadTreeStrategy.clear();\r\n        this.layerLock.free(this._memKey);\r\n        this.terrainLock.free(this._memKey);\r\n        this._normalMapCreator.free(this._memKey);\r\n\r\n        this._createdNodesCount = 0;\r\n    }\r\n\r\n    /**\r\n     * Returns ray vector hit ellipsoid coordinates.\r\n     * If the ray doesn't hit ellipsoid it returns 'undefined'.\r\n     * @public\r\n     * @param {Ray} ray - Ray.\r\n     * @returns {Vec3 | undefined} -\r\n     */\r\n    public getRayIntersectionEllipsoid(ray: Ray): Vec3 | undefined {\r\n        return this.ellipsoid.hitRay(ray.origin, ray.direction);\r\n    }\r\n\r\n    /**\r\n     * Project screen coordinates to the planet ellipsoid.\r\n     * @public\r\n     * @param {Vec2 | IBaseInputState } px - Screen coordinates.\r\n     * @returns {Vec3 | undefined} - Cartesian coordinates.\r\n     */\r\n    public getCartesianFromPixelEllipsoid(px: Vec2 | IBaseInputState): Vec3 | undefined {\r\n        let cam = this.renderer!.activeCamera!;\r\n        return this.ellipsoid.hitRay(cam.eye, cam.unproject(px.x, px.y));\r\n    }\r\n\r\n    /**\r\n     * Project screen coordinates to the planet ellipsoid.\r\n     * @public\r\n     * @param {Vec2 | IBaseInputState} px - Screen coordinates.\r\n     * @returns {LonLat | undefined} - Geodetic coordinates.\r\n     */\r\n    public getLonLatFromPixelEllipsoid(px: Vec2): LonLat | undefined {\r\n        let coords = this.getCartesianFromPixelEllipsoid(px);\r\n        if (coords) {\r\n            return this.ellipsoid.cartesianToLonLat(coords);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns mouse position cartesian coordinates on the current terrain.\r\n     * @public\r\n     * @returns {Vec3 | undefined} -\r\n     */\r\n    public getCartesianFromMouseTerrain(): Vec3 | undefined {\r\n        let ms = this.renderer!.events.mouseState;\r\n        let distance = this.getDistanceFromPixel(ms);\r\n        if (distance) {\r\n            return ms.direction.scaleTo(distance).addA(this.renderer!.activeCamera!.eye);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns screen coordinates cartesian coordinates on the current terrain.\r\n     * position or null if input coordinates is outside the planet.\r\n     * @public\r\n     * @param {Vec2} px - Pixel screen 2d coordinates.\r\n     * @returns {Vec3 | undefined} -\r\n     */\r\n    public getCartesianFromPixelTerrain(px: Vec2 | IBaseInputState): Vec3 | undefined {\r\n        let distance = this.getDistanceFromPixel(px);\r\n        if (distance) {\r\n            let direction = (px as IBaseInputState).direction || this.renderer!.activeCamera!.unproject(px.x, px.y);\r\n            return direction.scaleTo(distance).addA(this.renderer!.activeCamera!.eye);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns geodetic coordinates on the current terrain planet by its screen coordinates.\r\n     * position or null if input coordinates is outside the planet.\r\n     * @public\r\n     * @param {Vec2 | IBaseInputState} px - Pixel screen 2d coordinates.\r\n     * @returns {LonLat | undefined} -\r\n     */\r\n    public getLonLatFromPixelTerrain(px: Vec2 | IBaseInputState): LonLat | undefined {\r\n        let coords = this.getCartesianFromPixelTerrain(px);\r\n        if (coords) {\r\n            return this.ellipsoid.cartesianToLonLat(coords);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Project cartesian coordinates to screen space.\r\n     * @public\r\n     * @param {Vec3} coords - Cartesian coordinates.\r\n     * @returns {Vec2} - Screen coordinates.\r\n     */\r\n    public getPixelFromCartesian(coords: Vec3): Vec2 {\r\n        return this.renderer!.activeCamera!.project3v(coords);\r\n    }\r\n\r\n    /**\r\n     * Project geodetic coordinates to screen space.\r\n     * @public\r\n     * @param {LonLat} lonlat - Geodetic coordinates.\r\n     * @returns {Vec2 | undefined} - Screen coordinates.\r\n     */\r\n    public getPixelFromLonLat(lonlat: LonLat): Vec2 | undefined {\r\n        let coords = this.ellipsoid.lonLatToCartesian(lonlat);\r\n        if (coords) {\r\n            return this.renderer!.activeCamera!.project3v(coords);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns distance from an active (screen) camera to the planet ellipsoid.\r\n     * @public\r\n     * @param {Vec2} px - Screen coordinates.\r\n     * @returns {number} -\r\n     */\r\n    public getDistanceFromPixelEllipsoid(px: Vec2 | IBaseInputState): number | undefined {\r\n        let coords = this.getCartesianFromPixelEllipsoid(px);\r\n        if (coords) {\r\n            return coords.distance(this.renderer!.activeCamera!.eye);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns distance from active (screen) camera to the planet terrain by screen coordinates.\r\n     * @public\r\n     * @param {Vec2 | IBaseInputState} px - Screen coordinates.\r\n     * @returns {number | undefined} -\r\n     */\r\n    public getDistanceFromPixel(px: Vec2 | IBaseInputState): number {\r\n        // if (this.terrain!.isEmpty) {\r\n        //     return this.getDistanceFromPixelEllipsoid(px) || 0;\r\n        // } else {\r\n        return this.renderer!.getDistanceFromPixel(px) || this.getDistanceFromPixelEllipsoid(px) || 0;\r\n        //}\r\n    }\r\n\r\n    /**\r\n     * Sets camera to the planet geographical extent.\r\n     * @public\r\n     * @param {Extent} extent - Geographical extent.\r\n     */\r\n    public viewExtent(extent: Extent) {\r\n        if (this.camera) {\r\n            this.camera.viewExtent(extent);\r\n        } else {\r\n            this._initialViewExtent = extent;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fits camera position for the view extent.\r\n     * @public\r\n     * @param {Array.<number>} extentArr - Geographical extent array, (exactly 4 entries)\r\n     * where index 0 - southwest longitude, 1 - latitude southwest, 2 - longitude northeast, 3 - latitude northeast.\r\n     */\r\n    public viewExtentArr(extentArr: NumberArray4) {\r\n        this.viewExtent(new Extent(new LonLat(extentArr[0], extentArr[1]), new LonLat(extentArr[2], extentArr[3])));\r\n    }\r\n\r\n    /**\r\n     * Gets current camera view extent.\r\n     * @public\r\n     * @returns {Extent} -\r\n     */\r\n    public getExtent(): Extent {\r\n        if (this.renderer) {\r\n\r\n            let w = this.renderer.handler.getWidth(),\r\n                h = this.renderer.handler.getHeight();\r\n\r\n            let extent = [\r\n                this.getLonLatFromPixelTerrain(new Vec2(0, 0)),\r\n                this.getLonLatFromPixelTerrain(new Vec2(w, 0)),\r\n                this.getLonLatFromPixelTerrain(new Vec2(w, h)),\r\n                this.getLonLatFromPixelTerrain(new Vec2(0, h))\r\n            ];\r\n\r\n            if (extent[0] && extent[1] && extent[2] && extent[3]) {\r\n\r\n                let min_lon = extent[0].lon, min_lat = extent[2].lat,\r\n                    max_lon = extent[1].lon, max_lat = extent[0].lat;\r\n\r\n                for (let i = 0; i < extent.length; i++) {\r\n                    if (extent[i]!.lon > max_lon) max_lon = extent[i]!.lon;\r\n                    if (extent[i]!.lat > max_lat) max_lat = extent[i]!.lat;\r\n                    if (extent[i]!.lon < min_lon) min_lon = extent[i]!.lon;\r\n                    if (extent[i]!.lat < min_lat) min_lat = extent[i]!.lat;\r\n                }\r\n\r\n                return new Extent(new LonLat(min_lon, min_lat), new LonLat(max_lon, max_lat));\r\n            }\r\n        }\r\n\r\n        return this._viewExtent;\r\n    }\r\n\r\n    public getViewExtent(): Extent {\r\n        return this._viewExtent;\r\n    }\r\n\r\n    /**\r\n     * Sets camera to the planet geographical position.\r\n     * @public\r\n     * @param {LonLat} lonlat - Camera position.\r\n     * @param {LonLat} [lookLonLat] - Viewpoint.\r\n     * @param {Vec3} [up] - Camera up vector.\r\n     */\r\n    public viewLonLat(lonlat: LonLat, lookLonLat?: LonLat, up?: Vec3) {\r\n        this.camera.setLonLat(lonlat, lookLonLat, up);\r\n    }\r\n\r\n    /**\r\n     * Fly active camera to the view extent.\r\n     * @public\r\n     * @param {Extent} extent - Geographical extent.\r\n     * @param {Number} [height] - Height on the end of the flight route.\r\n     * @param {Vec3} [up] - Camera UP vector on the end of a flying.\r\n     * @param {Number} [ampl] - Altitude amplitude factor.\r\n     * @param {Function} [startCallback] - Callback that calls before the flying begins.\r\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\r\n     */\r\n    public flyExtent(\r\n        extent: Extent,\r\n        height?: number,\r\n        up?: Vec3,\r\n        ampl?: number,\r\n        completeCallback?: Function,\r\n        startCallback?: Function\r\n    ) {\r\n        this.camera.flyExtent(extent, height, up, ampl, completeCallback, startCallback);\r\n    }\r\n\r\n    /**\r\n     * Fly camera to the point.\r\n     * @public\r\n     * @param {Vec3} cartesian - Point coordinates.\r\n     * @param {Vec3} [look] - Camera \"look at\" point.\r\n     * @param {Vec3} [up] - Camera UP vector on the end of a flying.\r\n     * @param {Number} [ampl] - Altitude amplitude factor.\r\n     * @param {Function} [completeCallback] - Call the function in the end of flight\r\n     * @param {Function} [startCallback] - Call the function in the beginning\r\n     * @param {Function} [frameCallback] - Each frame callback\r\n     */\r\n    public flyCartesian(\r\n        cartesian: Vec3,\r\n        look?: Vec3 | null,\r\n        up?: Vec3 | null,\r\n        ampl?: number,\r\n        completeCallback?: Function | null,\r\n        startCallback?: Function | null,\r\n        frameCallback?: Function | null\r\n    ) {\r\n        this.camera.flyCartesian(cartesian, look, up, ampl, completeCallback, startCallback, frameCallback);\r\n    }\r\n\r\n    /**\r\n     * Fly camera to the geodetic position.\r\n     * @public\r\n     * @param {LonLat} lonlat - Fly geographical coordinates.\r\n     * @param {Vec3 | LonLat} [look] - Camera viewpoint in the end of the flight.\r\n     * @param {Vec3} [up] - Camera UP vector on the end of a flying.\r\n     * @param {Number} [ampl] - Altitude amplitude factor.\r\n     * @param [completeCallback]\r\n     * @param [startCallback]\r\n     * @param [frameCallback]\r\n     */\r\n    public flyLonLat(\r\n        lonlat: LonLat,\r\n        look?: Vec3 | LonLat,\r\n        up?: Vec3,\r\n        ampl?: number,\r\n        completeCallback?: Function,\r\n        startCallback?: Function,\r\n        frameCallback?: Function\r\n    ) {\r\n        this.camera.flyLonLat(lonlat, look, up, ampl, completeCallback, startCallback, frameCallback);\r\n    }\r\n\r\n    /**\r\n     * Stop current flight.\r\n     * @public\r\n     */\r\n    public stopFlying() {\r\n        this.camera.stopFlying();\r\n    }\r\n\r\n    public override updateBillboardsTexCoords() {\r\n        for (let i = 0; i < this.entityCollections.length; i++) {\r\n            this.entityCollections[i].billboardHandler.refreshTexCoordsArr();\r\n        }\r\n\r\n        let readyCollections: Record<number, boolean> = {};\r\n        for (let i = 0; i < this._layers.length; i++) {\r\n            let li = this._layers[i];\r\n            if (li instanceof Vector) {\r\n                (li as Vector).each(function (e: Entity) {\r\n                    if (e._entityCollection && !readyCollections[e._entityCollection.id]) {\r\n                        e._entityCollection.billboardHandler.refreshTexCoordsArr();\r\n                        readyCollections[e._entityCollection.id] = true;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    public getEntityTerrainPoint(entity: Entity, res: Vec3) {\r\n        let n = this._renderedNodes, i = n.length;\r\n        while (i--) {\r\n            if (n[i].segment.isEntityInside(entity)) {\r\n                return n[i].segment.getEntityTerrainPoint(entity, res);\r\n            }\r\n        }\r\n    }\r\n\r\n    public async getHeightDefault(lonLat: LonLat): Promise<number> {\r\n        return new Promise<number>((resolve: (alt: number) => void) => {\r\n            if (this.terrain) {\r\n                this.terrain.getHeightAsync(lonLat.clone(), (alt: number) => {\r\n                    resolve(alt);\r\n                });\r\n            } else {\r\n                resolve(0);\r\n            }\r\n        });\r\n    }\r\n\r\n    public async getHeightAboveELL(lonLat: LonLat): Promise<number> {\r\n        return new Promise<number>((resolve: (alt: number) => void) => {\r\n            if (this.terrain) {\r\n                this.terrain.getHeightAsync(lonLat.clone(), (alt: number) => {\r\n                    resolve(alt + this.terrain!.geoid.getHeightLonLat(lonLat));\r\n                });\r\n            } else {\r\n                resolve(0);\r\n            }\r\n        });\r\n    }\r\n\r\n    public override onremove() {\r\n        this.memClear();\r\n        this.quadTreeStrategy.destroyBranches();\r\n        this._renderedNodes = [];\r\n    }\r\n\r\n    // function checkTerrainCollision(entity) {\r\n    //     let _tempTerrPoint = new Vec3();\r\n    //     let nodes = globus.planet._renderedNodes;\r\n    //     for (let j = 0; j < nodes.length; j++) {\r\n    //         let seg = nodes[j].segment;\r\n    //         if (seg && seg._extentLonLat.isInside(entity.getLonLat())) {\r\n    //             seg.getEntityTerrainPoint(entity, _tempTerrPoint);\r\n    //             entity.setCartesian3v(_tempTerrPoint);\r\n    //             break;\r\n    //         }\r\n    //     }\r\n    // }\r\n\r\n    /**\r\n     * @todo: refactor with events or something better\r\n     */\r\n    public stopDragging() {\r\n        if (this.renderer && this.renderer.controls.EarthNavigation) {\r\n            //@ts-ignore\r\n            this.renderer.controls.EarthNavigation.stop();\r\n        }\r\n    }\r\n}\r\n\r\nconst PLANET_EVENTS: PlanetEventsList = [\r\n    /**\r\n     * Triggered before globe frame begins to render.\r\n     * @event og.scene.Planet#draw\r\n     */\r\n    \"draw\",\r\n\r\n    /**\r\n     * Triggered when layer has added to the planet.\r\n     * @event og.scene.Planet#layeradd\r\n     */\r\n    \"layeradd\",\r\n\r\n    /**\r\n     * Triggered when base layer changed.\r\n     * @event og.scene.Planet#baselayerchange\r\n     */\r\n    \"baselayerchange\",\r\n\r\n    /**\r\n     * Triggered when layer has removed from the planet.\r\n     * @event og.scene.Planet#layerremove\r\n     */\r\n    \"layerremove\",\r\n\r\n    /**\r\n     * Triggered when some layer visibility changed.\r\n     * @event og.scene.Planet#layervisibilitychange\r\n     */\r\n    \"layervisibilitychange\",\r\n\r\n    /**\r\n     * Triggered when all data is loaded\r\n     * @event og.scene.Planet#rendercompleted\r\n     */\r\n    \"rendercompleted\",\r\n\r\n    /**\r\n     * Triggered when all data is loaded\r\n     * @event og.scene.Planet#terraincompleted\r\n     */\r\n    \"terraincompleted\",\r\n\r\n    /**\r\n     * Triggered when layer data is laded\r\n     * @event og.scene.Planet#terraincompleted\r\n     */\r\n    \"layerloadend\"\r\n];\r\n\r\n","import {Program} from '../webgl/Program';\r\nimport {types} from '../webgl/types';\r\n\r\nexport function skybox(): Program {\r\n    return new Program(\"skybox\", {\r\n        uniforms: {\r\n            projectionViewMatrix: {type: types.MAT4},\r\n            uSampler: {type: types.SAMPLERCUBE},\r\n            pos: {type: types.VEC3}\r\n        },\r\n        attributes: {\r\n            aVertexPosition: {type: types.VEC3, enableArray: true}\r\n        },\r\n        vertexShader:\r\n            `attribute vec3 aVertexPosition;\r\n            uniform mat4 projectionViewMatrix;\r\n            uniform vec3 pos;\r\n            varying vec3 vTextureCoord;\r\n            void main(void) {\r\n                vTextureCoord = aVertexPosition;\r\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition + pos, 1.0);\r\n            }`,\r\n        fragmentShader:\r\n            `precision lowp float;\r\n            varying vec3 vTextureCoord;\r\n            uniform samplerCube uSampler;\r\n            void main(void) {\r\n                gl_FragColor = textureCube(uSampler, vTextureCoord);\r\n            }`\r\n    });\r\n}","import * as shaders from '../shaders/skybox';\r\nimport {RenderNode} from './RenderNode';\r\nimport type {WebGLBufferExt, WebGLTextureExt, Texture3DParams} from \"../webgl/Handler\";\r\n\r\nclass SkyBox extends RenderNode {\r\n\r\n    public params: Texture3DParams;\r\n    public vertexPositionBuffer: WebGLBufferExt | null;\r\n    public texture: WebGLTextureExt | null;\r\n\r\n    constructor(params: Texture3DParams) {\r\n        super(\"skybox\");\r\n        this.params = params;\r\n        this.vertexPositionBuffer = null;\r\n        this.texture = null;\r\n    }\r\n\r\n    static createDefault(RESOURCES_URL: string) {\r\n        return new SkyBox({\r\n            nx: RESOURCES_URL + \"skybox/gal/_nx.jpg\",\r\n            px: RESOURCES_URL + \"skybox/gal/_px.jpg\",\r\n            py: RESOURCES_URL + \"skybox/gal/_py.jpg\",\r\n            ny: RESOURCES_URL + \"skybox/gal/_ny.jpg\",\r\n            pz: RESOURCES_URL + \"skybox/gal/_pz.jpg\",\r\n            nz: RESOURCES_URL + \"skybox/gal/_nz.jpg\"\r\n        });\r\n    }\r\n\r\n    public override init() {\r\n        this.renderer!.handler!.addProgram(shaders.skybox(), true);\r\n        this.texture = this.renderer!.handler.loadCubeMapTexture(this.params);\r\n        this._createBuffers();\r\n        this.drawMode = this.renderer!.handler.gl!.TRIANGLES;\r\n    }\r\n\r\n    public override frame() {\r\n        let h = this.renderer!.handler;\r\n        let gl = h.gl!;\r\n        let cam = this.renderer!.activeCamera!;\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        h.programs.skybox.activate();\r\n        let sh = h.programs.skybox._program;\r\n        let shu = sh.uniforms;\r\n        gl.uniformMatrix4fv(shu.projectionViewMatrix, false, cam.getProjectionViewMatrix());\r\n        gl.uniform3fv(shu.pos, cam.eye.toArray());\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_CUBE_MAP, this.texture!);\r\n        gl.uniform1i(shu.uSampler, 0);\r\n        let buf = this.vertexPositionBuffer!;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, buf);\r\n        gl.vertexAttribPointer(sh.attributes.aVertexPosition, buf.itemSize, gl.FLOAT, false, 0, 0);\r\n\r\n        gl.drawArrays(this.drawMode, 0, buf.numItems);\r\n        gl.enable(gl.DEPTH_TEST);\r\n    }\r\n\r\n    protected _createBuffers() {\r\n\r\n        const vertices = new Float32Array([\r\n            -100000000.0, 100000000.0, -100000000.0,\r\n            -100000000.0, -100000000.0, -100000000.0,\r\n            100000000.0, -100000000.0, -100000000.0,\r\n            100000000.0, -100000000.0, -100000000.0,\r\n            100000000.0, 100000000.0, -100000000.0,\r\n            -100000000.0, 100000000.0, -100000000.0,\r\n\r\n            -100000000.0, -100000000.0, 100000000.0,\r\n            -100000000.0, -100000000.0, -100000000.0,\r\n            -100000000.0, 100000000.0, -100000000.0,\r\n            -100000000.0, 100000000.0, -100000000.0,\r\n            -100000000.0, 100000000.0, 100000000.0,\r\n            -100000000.0, -100000000.0, 100000000.0,\r\n\r\n            100000000.0, -100000000.0, -100000000.0,\r\n            100000000.0, -100000000.0, 100000000.0,\r\n            100000000.0, 100000000.0, 100000000.0,\r\n            100000000.0, 100000000.0, 100000000.0,\r\n            100000000.0, 100000000.0, -100000000.0,\r\n            100000000.0, -100000000.0, -100000000.0,\r\n\r\n            -100000000.0, -100000000.0, 100000000.0,\r\n            -100000000.0, 100000000.0, 100000000.0,\r\n            100000000.0, 100000000.0, 100000000.0,\r\n            100000000.0, 100000000.0, 100000000.0,\r\n            100000000.0, -100000000.0, 100000000.0,\r\n            -100000000.0, -100000000.0, 100000000.0,\r\n\r\n            -100000000.0, 100000000.0, -100000000.0,\r\n            100000000.0, 100000000.0, -100000000.0,\r\n            100000000.0, 100000000.0, 100000000.0,\r\n            100000000.0, 100000000.0, 100000000.0,\r\n            -100000000.0, 100000000.0, 100000000.0,\r\n            -100000000.0, 100000000.0, -100000000.0,\r\n\r\n            -100000000.0, -100000000.0, -100000000.0,\r\n            -100000000.0, -100000000.0, 100000000.0,\r\n            100000000.0, -100000000.0, -100000000.0,\r\n            100000000.0, -100000000.0, -100000000.0,\r\n            -100000000.0, -100000000.0, 100000000.0,\r\n            100000000.0, -100000000.0, 100000000.0\r\n        ]);\r\n\r\n        this.vertexPositionBuffer = this.renderer!.handler.createArrayBuffer(vertices, 3, vertices.length / 3);\r\n    }\r\n}\r\n\r\nexport {SkyBox};\r\n","import {binarySearchFast} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {Geoid} from \"./Geoid\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {Segment} from \"../segment/Segment\";\r\n\r\nexport interface IEmptyTerrainParams {\r\n    equalizeVertices?: boolean;\r\n    name?: string;\r\n    minZoom?: number;\r\n    maxZoom?: number;\r\n    maxNativeZoom?: number;\r\n    geoidSrc?: string;\r\n    geoid?: Geoid;\r\n    gridSizeByZoom?: number[]\r\n}\r\n\r\nexport type UrlRewriteFunc = (tileX: number, tileY: number, tileZoom: number, tileGroup: number) => string | null | undefined;\r\n\r\n/**\r\n * Class represents terrain provider without elevation data.\r\n * @param {IEmptyTerrainParams} [options] - Provider options:\r\n * @param {string} [options.name=\"empty\"] - Provider name.\r\n * @param {boolean} [options.equalizeVertices] -\r\n * @param {number} [options.minZoom=2] - Minimal visible zoom index when terrain handler works.\r\n * @param {number} [options.minZoom=50] - Maximal visible zoom index when terrain handler works.\r\n * @param {number} [options.maxNativeZoom=19] - Maximal available terrain zoom level.\r\n * @param {Array.<number>} [options.gridSizeByZoom] - Array of segment triangulation grid sizes where array index agreed to the segment zoom index.\r\n * @param {Array.<number>} [gridSizeByZoom] - Array of values, where each value corresponds to the size of a tile(or segment) on the globe. Each value must be power of two.\r\n * @param {Geoid} [options.geoid] -\r\n * @param {string} [options.geoidSrc] -\r\n */\r\nclass EmptyTerrain {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    /**\r\n     * Uniq identifier.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public __id: number;\r\n\r\n    public equalizeVertices: boolean;\r\n\r\n    public equalizeNormals: boolean;\r\n\r\n    public isEmpty: boolean;\r\n\r\n    /**\r\n     * Provider name is \"empty\"\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public name: string;\r\n\r\n    /**\r\n     * Minimal z-index value for segment elevation data handling.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public minZoom: number;\r\n\r\n    /**\r\n     * Maximal z-index value for segment elevation data handling.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public maxZoom: number;\r\n\r\n    public noDataValues: number[];\r\n\r\n    /**\r\n     * Maximal existent available zoom\r\n     * @type {number}\r\n     */\r\n    public maxNativeZoom: number;\r\n\r\n    /**\r\n     * @public\r\n     * @type {Array.<number>}\r\n     */\r\n    public gridSizeByZoom: number[];\r\n\r\n    public _maxNodeZoom: number;\r\n\r\n    /**\r\n     * Elevation grid size. Current is 2x2 is the smallest grid size.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public plainGridSize: number;\r\n\r\n    /**\r\n     * Planet scene.\r\n     * @public\r\n     * @type {Planet}\r\n     */\r\n    public _planet: Planet | null;\r\n\r\n    public _geoid: Geoid;\r\n\r\n    public _isReady: boolean;\r\n\r\n    constructor(options: IEmptyTerrainParams = {}) {\r\n\r\n        this.__id = EmptyTerrain.__counter__++;\r\n\r\n        this.equalizeVertices = options.equalizeVertices || false;\r\n\r\n        this.equalizeNormals = false;\r\n\r\n        this.isEmpty = true;\r\n\r\n        this.name = options.name || \"empty\";\r\n\r\n        this.minZoom = options.minZoom || 2;\r\n\r\n        this.maxZoom = options.maxZoom || 19;\r\n\r\n        this.maxNativeZoom = options.maxNativeZoom || this.maxZoom;\r\n\r\n        this.gridSizeByZoom = options.gridSizeByZoom || [\r\n            64, 32, 16, 8, 4, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2\r\n        ];\r\n\r\n        this._maxNodeZoom = this.gridSizeByZoom.length - 1;\r\n\r\n        this.plainGridSize = 2;\r\n\r\n        this.noDataValues = [];\r\n\r\n        this._planet = null;\r\n\r\n        this._geoid = options.geoid || new Geoid({\r\n            src: options.geoidSrc || null\r\n        });\r\n\r\n        this._isReady = false;\r\n\r\n        // const _ellToAltFn = [\r\n        //     (lon, lat, alt, callback) => callback(alt),\r\n        //     (lon, lat, alt, callback) => callback(alt - this._geoid.getHeight(lon, lat)),\r\n        //     (lon, lat, alt, callback) => {\r\n\r\n        //         let x = mercator.getTileX(lon, zoom),\r\n        //             y = mercator.getTileY(lat, zoom);\r\n\r\n        //         let mslAlt = alt - this._geoid.getHeight(lon, lat);\r\n\r\n        //         if (true) {\r\n\r\n        //         } else {\r\n\r\n        //         }\r\n\r\n        //         return callback(mslAlt);\r\n        //     },\r\n        // ];\r\n    }\r\n\r\n    /**\r\n     * Sets url rewrite callback, used for custom url rewriting for every tile loading.\r\n     * @public\r\n     * @param {UrlRewriteFunc} ur - The callback that returns tile custom created url.\r\n     */\r\n    public setUrlRewriteCallback(ur: UrlRewriteFunc) {\r\n    }\r\n\r\n    public get isIdle(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public isEqual(obj: this): boolean {\r\n        return obj.__id === this.__id;\r\n    }\r\n\r\n    static checkNoDataValue(noDataValues: number[] | TypedArray, value: number): boolean {\r\n        return binarySearchFast(noDataValues, value) !== -1;\r\n    }\r\n\r\n    public isBlur(segment?: Segment): boolean {\r\n        return false;\r\n    }\r\n\r\n    public set maxNodeZoom(val: number) {\r\n        if (val > this.gridSizeByZoom.length - 1) {\r\n            val = this.gridSizeByZoom.length - 1;\r\n        }\r\n        this._maxNodeZoom = val;\r\n    }\r\n\r\n    public get maxNodeZoom(): number {\r\n        return this._maxNodeZoom;\r\n    }\r\n\r\n    public set geoid(geoid: Geoid) {\r\n        this._geoid = geoid;\r\n    }\r\n\r\n    public get geoid(): Geoid {\r\n        return this._geoid;\r\n    }\r\n\r\n    public getGeoid(): Geoid {\r\n        return this._geoid;\r\n    }\r\n\r\n    /**\r\n     * Loads or creates segment elevation data.\r\n     * @public\r\n     * @param {Segment} segment - Segment to create elevation data.\r\n     */\r\n    public handleSegmentTerrain(segment: Segment) {\r\n        segment.terrainIsLoading = false;\r\n        segment.terrainReady = true;\r\n        segment.terrainExists = true;\r\n    }\r\n\r\n    public isReady(): boolean {\r\n        return this._isReady;\r\n    }\r\n\r\n    public abortLoading() {\r\n    }\r\n\r\n    public clearCache() {\r\n    }\r\n\r\n    public getHeightAsync(lonLat: LonLat, callback: (height: number) => void): boolean {\r\n        callback(0);\r\n        return true;\r\n    }\r\n\r\n    public loadTerrain(segment: Segment, forceLoading: boolean = false) {\r\n\r\n    }\r\n}\r\n\r\nexport {EmptyTerrain};","import * as mercator from \"../mercator\";\r\nimport {createEvents} from \"../Events\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {createExtent, stringTemplate} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {EmptyTerrain} from \"./EmptyTerrain\";\r\nimport type {IEmptyTerrainParams, UrlRewriteFunc} from \"./EmptyTerrain\";\r\nimport {Extent} from \"../Extent\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {Loader} from \"../utils/Loader\";\r\nimport type {IResponse} from \"../utils/Loader\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {NOTRENDERING} from \"../quadTree/quadTree\";\r\nimport {Segment, TILEGROUP_COMMON} from \"../segment/Segment\";\r\n// import { QueueArray } from '../QueueArray';\r\nimport {Ray} from \"../math/Ray\";\r\nimport {Vec3} from \"../math/Vec3\";\r\n\r\nexport interface IGlobusTerrainParams extends IEmptyTerrainParams {\r\n    subdomains?: string[];\r\n    url?: string;\r\n    extent?: Extent | [[number, number], [number, number]];\r\n    urlRewrite?: UrlRewriteFunc;\r\n    noDataValues?: number[];\r\n    plainGridSize?: number;\r\n    heightFactor?: number;\r\n}\r\n\r\ntype TileData = {\r\n    heights: number[] | TypedArray | null,\r\n    extent: Extent | null\r\n}\r\n\r\n/**\r\n * @deprecated\r\n * Use GlobusRgbTerrain\r\n * Class that loads segment elevation data, converts it to the array and passes it to the planet segment.\r\n * @class\r\n * @extends {GlobusTerrain}\r\n * @param {string} [name=\"\"] - Terrain provider name.\r\n * @param {IGlobusTerrainParams} [options] - Provider options:\r\n * @param {number} [options.minZoom=3] - Minimal visible zoom index when terrain handler works.\r\n * @param {number} [options.minZoom=14] - Maximal visible zoom index when terrain handler works.\r\n * @param {number} [options.minNativeZoom=14] - Maximal available terrain zoom level.\r\n * @param {string} [options.url=\"//openglobus.org/heights/srtm3/{z}/{y}/{x}.ddm\"] - Terrain source path url template. Default is openglobus ddm elevation file.\r\n * @param {Array.<number>} [options.gridSizeByZoom] - Array of segment triangulation grid sizes where array index agreed to the segment zoom index.\r\n * @param {number} [options.plainGridSize=32] - Elevation grid size. Default is 32x32. Must be power of two.\r\n * @param {string} [options.responseType=\"arraybuffer\"] - Response type.\r\n * @param {number} [options.MAX_LOADING_TILES] - Maximum at one time loading tiles.\r\n * @param {Array.<number>} [gridSizeByZoom] - Array of values, where each value corresponds to the size of a tile(or segment) on the globe. Each value must be power of two.\r\n * @param {number} [heightFactor=1] - Elevation height multiplier.\r\n *\r\n * @fires GlobusTerrainEvents#load\r\n * @fires GlobusTerrainEvents#loadend\r\n */\r\nclass GlobusTerrain extends EmptyTerrain {\r\n\r\n    public events: GlobusTerrainEvents;\r\n\r\n    protected _s: string[];\r\n\r\n    protected _requestCount: number;\r\n\r\n    protected _requestsPeerSubdomain: number;\r\n\r\n    /**\r\n     * Terrain source path url template.\r\n     * @protected\r\n     * @type {string}\r\n     */\r\n    protected url: string;\r\n\r\n    protected _extent: Extent;\r\n\r\n    protected _dataType: string;\r\n\r\n    protected _elevationCache: Record<string, TileData>;\r\n\r\n    protected _fetchCache: Record<string, Promise<any>>;\r\n\r\n    protected _loader: Loader<GlobusTerrain>;\r\n\r\n    /**\r\n     * Rewrites elevation storage url query.\r\n     * @protected\r\n     * @type {Function}\r\n     */\r\n    protected _urlRewriteCallback: UrlRewriteFunc | null;\r\n\r\n    protected _heightFactor: number;\r\n\r\n\r\n    constructor(name: string = \"\", options: IGlobusTerrainParams = {}) {\r\n\r\n        super({\r\n            geoidSrc: \"https://openglobus.org/geoid/egm84-30.pgm\",\r\n            maxNativeZoom: options.maxNativeZoom || 14,\r\n            ...options\r\n        });\r\n\r\n        this._s = options.subdomains || [\"a\", \"b\", \"c\"];\r\n\r\n        this.events = createEvents(GLOBUSTERRAIN_EVENTS, this);\r\n\r\n        this._requestCount = 0;\r\n\r\n        this._requestsPeerSubdomain = 4;\r\n\r\n        this.isEmpty = false;\r\n\r\n        this.equalizeNormals = true;\r\n\r\n        this.name = name || \"openglobus\";\r\n\r\n        this.url = options.url || \"https://{s}.srtm3.openglobus.org/{z}/{y}/{x}.ddm\";\r\n\r\n        this.gridSizeByZoom = options.gridSizeByZoom || [\r\n            64, 32, 32, 16, 16, 8, 8, 8, 16, 16, 16, 32, 32, 32, 32, 16, 8, 4, 2, 2, 2, 2, 2, 2\r\n        ];\r\n\r\n        this._heightFactor = options.heightFactor != undefined ? options.heightFactor : 1.0;\r\n\r\n        this.noDataValues = options.noDataValues || [];\r\n\r\n        for (let i = 0; i < this.noDataValues.length; i++) {\r\n            this.noDataValues[i] *= this._heightFactor;\r\n        }\r\n\r\n        this.plainGridSize = options.plainGridSize || 32;\r\n\r\n        this._extent = createExtent(options.extent, new Extent(new LonLat(-180.0, -90.0), new LonLat(180.0, 90.0)));\r\n\r\n        this._dataType = \"arrayBuffer\";\r\n\r\n        this._maxNodeZoom = this.gridSizeByZoom.length - 1;\r\n\r\n        this._elevationCache = {};\r\n\r\n        this._fetchCache = {};\r\n\r\n        this._loader = new Loader<GlobusTerrain>();\r\n\r\n        this._urlRewriteCallback = options.urlRewrite || null;\r\n    }\r\n\r\n    public get loader(): Loader<GlobusTerrain> {\r\n        return this._loader;\r\n    }\r\n\r\n    public override clearCache() {\r\n        for (let c in this._elevationCache) {\r\n            this._elevationCache[c].heights = null;\r\n            this._elevationCache[c].extent = null;\r\n            delete this._elevationCache[c];\r\n        }\r\n        //@ts-ignore\r\n        this._elevationCache = null;\r\n        this._elevationCache = {};\r\n\r\n        for (let c in this._fetchCache) {\r\n            //@ts-ignore\r\n            this._fetchCache[c] = null;\r\n            delete this._fetchCache[c];\r\n        }\r\n        //@ts-ignore\r\n        this._fetchCache = null;\r\n        this._fetchCache = {};\r\n    }\r\n\r\n    public override isBlur(segment: Segment): boolean {\r\n        return segment.tileZoom >= 6;\r\n    }\r\n\r\n    public setElevationCache(tileIndex: string, tileData: TileData) {\r\n        this._elevationCache[tileIndex] = tileData;\r\n    }\r\n\r\n    public getElevationCache(tileIndex: string): TileData | undefined {\r\n        return this._elevationCache[tileIndex];\r\n    }\r\n\r\n    public override getHeightAsync(lonLat: LonLat, callback: (h: number) => void, zoom?: number, firstAttempt?: boolean): boolean {\r\n        if (!lonLat || lonLat.lat > mercator.MAX_LAT || lonLat.lat < mercator.MIN_LAT) {\r\n            callback(0);\r\n            return true;\r\n        }\r\n\r\n        firstAttempt = firstAttempt != undefined ? firstAttempt : true;\r\n\r\n        const [x, y, z, tileGroup] = this._planet!.quadTreeStrategy.getTileXY(lonLat, zoom || this.maxZoom);\r\n\r\n        let tileIndex = Layer.getTileIndex(x, y, z, tileGroup);\r\n\r\n        let cache = this.getElevationCache(tileIndex);\r\n\r\n        let merc = mercator.forward(lonLat)\r\n\r\n        if (cache) {\r\n            if (cache.heights) {\r\n                callback(this._getGroundHeightMerc(merc, cache));\r\n            } else {\r\n                callback(0);\r\n            }\r\n            return true;\r\n        } else {\r\n            let def = this._fetchCache[tileIndex];\r\n            if (!def) {\r\n                def = this._loader.fetch({\r\n                    src: this.buildURL(x, y, z, tileGroup),\r\n                    type: this._dataType\r\n                });\r\n                this._fetchCache[tileIndex] = def;\r\n            }\r\n\r\n            def!.then((response: IResponse) => {\r\n\r\n                let extent = mercator.getTileExtent(x, y, z);\r\n\r\n                if (response.status === \"ready\") {\r\n\r\n                    let cache: TileData = {\r\n                        heights: this._createHeights(response.data, null, tileGroup, x, y, z, extent),\r\n                        extent: extent\r\n                    };\r\n\r\n                    this.setElevationCache(tileIndex, cache);\r\n\r\n                    callback(this._getGroundHeightMerc(merc, cache));\r\n\r\n                } else if (response.status === \"error\") {\r\n                    if (firstAttempt && z > this.maxNativeZoom) {\r\n                        firstAttempt = false;\r\n                        this.getHeightAsync(lonLat, callback, this.maxNativeZoom, false);\r\n                        return;\r\n                    }\r\n\r\n                    this.setElevationCache(tileIndex, {\r\n                        heights: null,\r\n                        extent: extent\r\n                    });\r\n\r\n                    callback(0);\r\n\r\n                } else {\r\n                    // @ts-ignore\r\n                    this._fetchCache[tileIndex] = null;\r\n                    delete this._fetchCache[tileIndex];\r\n                }\r\n            });\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    protected _getGroundHeightMerc(merc: LonLat, tileData: TileData): number {\r\n        if (!(tileData.extent && tileData.heights)) {\r\n            return 0;\r\n        }\r\n\r\n        let w = tileData.extent.getWidth(),\r\n            gs = Math.sqrt(tileData.heights.length);\r\n\r\n        let size = w / (gs - 1);\r\n\r\n        /*\r\n        v2-----------v3\r\n        |            |\r\n        |            |\r\n        |            |\r\n        v0-----------v1\r\n        */\r\n\r\n        let i = gs - Math.ceil((merc.lat - tileData.extent.southWest.lat) / size) - 1,\r\n            j = Math.floor((merc.lon - tileData.extent.southWest.lon) / size);\r\n\r\n        let v0Ind = (i + 1) * gs + j,\r\n            v1Ind = v0Ind + 1,\r\n            v2Ind = i * gs + j,\r\n            v3Ind = v2Ind + 1;\r\n\r\n        let h0 = tileData.heights[v0Ind],\r\n            h1 = tileData.heights[v1Ind],\r\n            h2 = tileData.heights[v2Ind],\r\n            h3 = tileData.heights[v3Ind];\r\n\r\n        let v0 = new Vec3(tileData.extent.southWest.lon + size * j, h0, tileData.extent.northEast.lat - size * i - size),\r\n            v1 = new Vec3(v0.x + size, h1, v0.z),\r\n            v2 = new Vec3(v0.x, h2, v0.z + size),\r\n            v3 = new Vec3(v0.x + size, h3, v0.z + size);\r\n\r\n        let xyz = new Vec3(merc.lon, 100000.0, merc.lat),\r\n            ray = new Ray(xyz, new Vec3(0, -1, 0));\r\n\r\n        let res = new Vec3();\r\n        let d = ray.hitTriangleRes(v0, v1, v2, res);\r\n\r\n        if (d === Ray.INSIDE) {\r\n            return res.y;\r\n        }\r\n\r\n        d = ray.hitTriangleRes(v1, v3, v2, res);\r\n        if (d === Ray.INSIDE) {\r\n            return res.y;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Stop loading.\r\n     * @public\r\n     */\r\n    public override abortLoading() {\r\n        this._loader.abortAll();\r\n    }\r\n\r\n    /**\r\n     * Sets terrain data url template.\r\n     * @public\r\n     * @param {string} url - Url template.\r\n     * @example <caption>Default openglobus url template:</caption>:\r\n     * \"http://earth3.openglobus.org/{z}/{y}/{x}.ddm\"\r\n     */\r\n    public setUrl(url: string) {\r\n        this.url = url;\r\n    }\r\n\r\n    /**\r\n     * Sets provider name.\r\n     * @public\r\n     * @param {string} name - Name.\r\n     */\r\n    public setName(name: string) {\r\n        this.name = name;\r\n    }\r\n\r\n    public isReadyToLoad(segment: Segment): boolean {\r\n        return segment._tileGroup === TILEGROUP_COMMON && this._extent.overlaps(segment.getExtentLonLat());\r\n    }\r\n\r\n    /**\r\n     * Starts to load segment elevation data.\r\n     * @public\r\n     * @param {Segment} segment - Segment that wants a terrain data.\r\n     * @param {boolean} [forceLoading] -\r\n     */\r\n    public override loadTerrain(segment: Segment, forceLoading: boolean = false) {\r\n\r\n        if (this._planet!.terrainLock.isFree()) {\r\n\r\n            segment.terrainReady = false;\r\n            segment.terrainIsLoading = true;\r\n\r\n            if (this.isReadyToLoad(segment)) {\r\n\r\n                let cache = this.getElevationCache(segment.tileIndex);\r\n\r\n                if (cache) {\r\n                    this._applyElevationsData(segment, cache.heights);\r\n                } else {\r\n                    this._loader.load({\r\n                            sender: this,\r\n                            src: this._getHTTPRequestString(segment),\r\n                            segment: segment,\r\n                            type: this._dataType,\r\n                            filter: () => (segment.plainReady && segment.node.getState() !== NOTRENDERING) || forceLoading\r\n                        }, (response: IResponse) => {\r\n\r\n                            if (response.status === \"ready\") {\r\n\r\n                                let heights = this._createHeights(\r\n                                    response.data,\r\n                                    segment,\r\n                                    segment._tileGroup,\r\n                                    segment.tileX,\r\n                                    segment.tileY,\r\n                                    segment.tileZoom,\r\n                                    segment.getExtent(),\r\n                                    segment.tileZoom === this.maxZoom\r\n                                );\r\n\r\n                                this.setElevationCache(segment.tileIndex, {\r\n                                    heights: heights,\r\n                                    extent: segment.getExtent()\r\n                                });\r\n\r\n                                this._applyElevationsData(segment, heights);\r\n\r\n                            } else if (response.status === \"abort\") {\r\n                                segment.terrainIsLoading = false;\r\n                            } else if (response.status === \"error\") {\r\n                                this._applyElevationsData(segment, null);\r\n                            } else {\r\n                                segment.terrainIsLoading = false;\r\n                            }\r\n                        }\r\n                    );\r\n                }\r\n            } else {\r\n                segment.elevationsNotExists();\r\n            }\r\n        } else {\r\n            segment.terrainIsLoading = false;\r\n        }\r\n    }\r\n\r\n    protected _getSubdomain(): string {\r\n        this._requestCount++;\r\n        return this._s[Math.floor(this._requestCount % (this._requestsPeerSubdomain * this._s.length) / this._requestsPeerSubdomain)];\r\n    }\r\n\r\n    public buildURL(x: number, y: number, z: number, tileGroup: number): string {\r\n        return stringTemplate(this.url, {\r\n            s: this._getSubdomain(),\r\n            x: x.toString(),\r\n            y: y.toString(),\r\n            z: z.toString()\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates default query url string.\r\n     * @protected\r\n     * @param {Segment} segment -\r\n     * @returns {string} -\r\n     */\r\n    protected _createUrl(segment: Segment): string {\r\n        return this.buildURL(segment.tileX, segment.tileY, segment.tileZoom, segment._tileGroup);\r\n    }\r\n\r\n    /**\r\n     * Returns actual url query string.\r\n     * @protected\r\n     * @param {Segment} segment - Segment that loads image data.\r\n     * @returns {string} - Url string.\r\n     */\r\n    protected _getHTTPRequestString(segment: Segment): string {\r\n        if (this._urlRewriteCallback) {\r\n            return this._urlRewriteCallback(segment.tileX, segment.tileY, segment.tileZoom, segment._tileGroup) || this._createUrl(segment);\r\n        } else {\r\n            return this._createUrl(segment);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets url rewrite callback, used for custom url rewriting for every tile loading.\r\n     * @public\r\n     * @param {UrlRewriteFunc} ur - The callback that returns tile custom created url.\r\n     */\r\n    public override setUrlRewriteCallback(ur: UrlRewriteFunc) {\r\n        this._urlRewriteCallback = ur;\r\n    }\r\n\r\n    /**\r\n     * Converts loaded data to segment elevation data type(column major elevation data array in meters)\r\n     * @public\r\n     * @returns {Array.<number>} -\r\n     */\r\n    protected _createHeights(data: any, segment?: Segment | null, tileGroup?: number, x?: number, y?: number, z?: number, extent?: Extent, isMaxZoom?: boolean): TypedArray | number[] {\r\n        if (this._heightFactor !== 1) {\r\n            let res = new Float32Array(data);\r\n            for (let i = 0, len = res.length; i < len; i++) {\r\n                res[i] = res[i] * this._heightFactor;\r\n            }\r\n            return res;\r\n        }\r\n        return new Float32Array(data);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _applyElevationsData(segment: Segment, elevations: number[] | TypedArray | null) {\r\n        if (segment) {\r\n            let e = this.events.load!;\r\n            if (e.handlers.length) {\r\n                this.events.dispatch(e, {\r\n                    elevations: elevations,\r\n                    segment: segment\r\n                });\r\n            }\r\n            segment.applyTerrain(elevations);\r\n        }\r\n    }\r\n}\r\n\r\ntype GlobusTerrainEventsList = [\r\n    \"load\",\r\n    \"loadend\"\r\n];\r\n\r\ntype GlobusTerrainEvents = EventsHandler<GlobusTerrainEventsList>;\r\n\r\nconst GLOBUSTERRAIN_EVENTS: GlobusTerrainEventsList = [\r\n    /**\r\n     * Triggered when current elevation tile has loaded but before rendering.\r\n     * @event og.terrain.GlobusTerrain#load\r\n     */\r\n    \"load\",\r\n\r\n    /**\r\n     * Triggered when all elevation tiles have loaded or loading has stopped.\r\n     * @event og.terrain.GlobusTerrain#loadend\r\n     */\r\n    \"loadend\"\r\n];\r\n\r\n\r\nexport {GlobusTerrain};","import * as mercator from \"../mercator\";\r\nimport {Layer} from \"./Layer\";\r\nimport type {ILayerParams, LayerEventsList} from \"./Layer\";\r\nimport {RENDERING} from \"../quadTree/quadTree\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {stringTemplate} from \"../utils/shared\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {Material} from \"./Material\";\r\nimport type {NumberArray4} from \"../math/Vec4\";\r\nimport type {IResponse} from \"../utils/Loader\";\r\n\r\nexport interface IXYZParams extends ILayerParams {\r\n    url?: string;\r\n    subdomains?: string[];\r\n    minNativeZoom?: number;\r\n    maxNativeZoom?: number;\r\n    urlRewrite?: Function;\r\n}\r\n\r\ntype XYZEventsList = [\r\n    \"load\",\r\n    \"loadend\"\r\n];\r\n\r\ntype XYZEventsType = EventsHandler<XYZEventsList> & EventsHandler<LayerEventsList>;\r\n\r\n/**\r\n * Represents an imagery tiles source provider.\r\n * @class\r\n * @extends {Layer}\r\n * @param {string} name - Layer name.\r\n * @param {IXYZParams} options:\r\n * @param {number} [options.opacity=1.0] - Layer opacity.\r\n * @param {Array.<string>} [options.subdomains=['a','b','c']] - Subdomains of the tile service.\r\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\r\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\r\n * @param {number} [options.minNativeZoom=0] - Minimal available zoom level.\r\n * @param {number} [options.maxNativeZoom=19] - Maximal available zoom level.\r\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\r\n * @param {boolean} [options.isBaseLayer=false] - Base layer flag.\r\n * @param {boolean} [options.visibility=true] - Layer visibility.\r\n * @param {string} [options.crossOrigin=true] - If true, all tiles will have their crossOrigin attribute set to ''.\r\n * @param {string} options.url - Tile url source template(see example below).\r\n * @param {string} options.textureFilter - texture gl filter. NEAREST, LINEAR, MIPMAP, ANISOTROPIC.\r\n * @param {Function} options.urlRewrite - Url rewrite function.\r\n *\r\n * @fires EventsHandler<XYZEventsList>#load\r\n * @fires EventsHandler<XYZEventsList>#loadend\r\n *\r\n * @example <caption>Creates OpenStreetMap base tile layer</caption>\r\n * new og.layer.XYZ(\"OpenStreetMap\", {\r\n *     isBaseLayer: true,\r\n *     url: \"http://b.tile.openstreetmap.org/{z}/{x}/{y}.png\",\r\n *     visibility: true,\r\n *     attribution: 'Data @ <a href=\"http://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"http://www.openstreetmap.org/copyright\">ODbL</a>'\r\n * });\r\n */\r\nexport class XYZ extends Layer {\r\n\r\n    public override events: XYZEventsType;\r\n\r\n    /**\r\n     * Tile url source template.\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public url: string;\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _s: string[];\r\n\r\n    /**\r\n     * Minimal native zoom level when tiles are available.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public minNativeZoom: number;\r\n\r\n    /**\r\n     * Maximal native zoom level when tiles are available.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public maxNativeZoom: number;\r\n\r\n    /**\r\n     * Rewrites imagery tile url query.\r\n     * @private\r\n     * @param {Segment} segment - Segment to load.\r\n     * @param {string} url - Created url.\r\n     * @returns {string} - Url query string.\r\n     */\r\n    protected _urlRewriteCallback: Function | null;\r\n\r\n    protected _requestsPeerSubdomains: number;\r\n\r\n    protected _requestCount: number;\r\n\r\n    constructor(name: string | null, options: IXYZParams = {}) {\r\n        super(name, options);\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(XYZ_EVENTS);\r\n\r\n        this.url = options.url || \"\";\r\n\r\n        this._s = options.subdomains || [\"a\", \"b\", \"c\"];\r\n\r\n        this.minNativeZoom = options.minNativeZoom || 0;\r\n\r\n        this.maxNativeZoom = options.maxNativeZoom || 19;\r\n\r\n        this._urlRewriteCallback = options.urlRewrite || null;\r\n\r\n        this._requestsPeerSubdomains = 4;\r\n\r\n        this._requestCount = 0;\r\n    }\r\n\r\n    /**\r\n     * @warning Use XYZ.isIdle in requestAnimationFrame(after setVisibility)\r\n     */\r\n    public override get isIdle(): boolean {\r\n        return super.isIdle && this._planet!._tileLoader.getRequestCounter(this) === 0;\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"XYZ\";\r\n    }\r\n\r\n    /**\r\n     * Abort loading tiles.\r\n     * @public\r\n     */\r\n    public override abortLoading() {\r\n        if (this._planet) {\r\n            this._planet._tileLoader.abort(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets layer visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Layer visibility.\r\n     */\r\n    public override setVisibility(visibility: boolean) {\r\n        if (visibility !== this._visibility) {\r\n            super.setVisibility(visibility);\r\n            if (!visibility) {\r\n                this.abortLoading();\r\n            }\r\n        }\r\n    }\r\n\r\n    public override remove(): this {\r\n        this.abortLoading();\r\n        super.remove();\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Sets imagery tiles url source template.\r\n     * @public\r\n     * @param {string} url - Url template.\r\n     * @example\r\n     * http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\r\n     * where {z}, {x} and {y} - replaces by current tile values, {s} - random domain.\r\n     */\r\n    public setUrl(url: string) {\r\n        this.url = url;\r\n    }\r\n\r\n    public _checkSegment(segment: Segment) {\r\n        return segment._projection.id === this._planet!.quadTreeStrategy.projection.id;\r\n    }\r\n\r\n    /**\r\n     * Start to load tile material.\r\n     * @public\r\n     * @virtual\r\n     * @param {Material} material - Loads current material.\r\n     * @param {boolean} [forceLoading=false] -\r\n     */\r\n    public override loadMaterial(material: Material, forceLoading: boolean = false) {\r\n\r\n        let seg = material.segment;\r\n\r\n        if (this._isBaseLayer) {\r\n            material.texture = seg.getDefaultTexture();\r\n        } else {\r\n            material.texture = seg.planet.transparentTexture;\r\n        }\r\n\r\n        // Q: Maybe we should change \"<2\" to material.segment.tileZoom < (material.layer.minZoom + 1)\r\n        if (this._planet!.layerLock.isFree() || material.segment.tileZoom < 2) {\r\n            material.isReady = false;\r\n            material.isLoading = true;\r\n\r\n            if (this._checkSegment(seg)) {\r\n                material.loadingAttempts++;\r\n\r\n                this._planet!._tileLoader.load({\r\n                        sender: this,\r\n                        src: this._getHTTPRequestString(material.segment),\r\n                        type: \"imageBitmap\",\r\n                        filter: () => (seg.initialized && seg.node.getState() === RENDERING) || forceLoading,\r\n                        options: {}\r\n                    },\r\n                    (response: IResponse) => {\r\n                        if (response.status === \"ready\") {\r\n                            if (material.isLoading) {\r\n                                let e = this.events.load!;\r\n                                if (e.handlers.length) {\r\n                                    this.events.dispatch(e, material);\r\n                                }\r\n                                material.applyImage(response.data);\r\n                                response.data = null;\r\n                            }\r\n                        } else if (response.status === \"abort\") {\r\n                            material.isLoading = false;\r\n                        } else if (response.status === \"error\") {\r\n                            if (material.isLoading) {\r\n                                material.textureNotExists();\r\n                            }\r\n                        }\r\n                    }\r\n                );\r\n            } else {\r\n                material.textureNotExists();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates query url.\r\n     * @protected\r\n     * @virtual\r\n     * @param {Segment} segment - Creates specific url for current segment.\r\n     * @returns {string} - Returns url string.\r\n     */\r\n    protected _createUrl(segment: Segment): string {\r\n        return stringTemplate(this.url, {\r\n            s: this._getSubdomain(),\r\n            x: segment.tileX.toString(),\r\n            y: segment.tileY.toString(),\r\n            z: segment.tileZoom.toString()\r\n        });\r\n    }\r\n\r\n    protected _getSubdomain(): string {\r\n        this._requestCount++;\r\n        return this._s[Math.floor(this._requestCount % (this._requestsPeerSubdomains * this._s.length) / this._requestsPeerSubdomains)];\r\n    }\r\n\r\n    /**\r\n     * Returns actual url query string.\r\n     * @protected\r\n     * @param {Segment} segment - Segment that loads image data.\r\n     * @returns {string} - Url string.\r\n     */\r\n    protected _getHTTPRequestString(segment: Segment) {\r\n        return this._urlRewriteCallback ? this._urlRewriteCallback(segment, this.url) : this._createUrl(segment);\r\n    }\r\n\r\n    /**\r\n     * Sets url rewrite callback, used for custom url rewriting for every tile loading.\r\n     * @public\r\n     * @param {Function} ur - The callback that returns tile custom created url.\r\n     */\r\n    public setUrlRewriteCallback(ur: Function) {\r\n        this._urlRewriteCallback = ur;\r\n    }\r\n\r\n    public override applyMaterial(material: Material, forceLoading: boolean = false): NumberArray4 {\r\n        if (material.isReady) {\r\n            return material.texOffset;\r\n        } else if (material.segment.tileZoom < this.minNativeZoom) {\r\n            material.textureNotExists();\r\n        } else {\r\n\r\n            let segment = material.segment,\r\n                pn = segment.node,\r\n                notEmpty = false;\r\n\r\n            let mId = this.__id;\r\n            let psegm = material;\r\n            while (pn.parentNode) {\r\n                pn = pn.parentNode;\r\n                psegm = pn.segment.materials[mId];\r\n                if (psegm && psegm.textureExists) {\r\n                    notEmpty = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (segment.passReady) {\r\n                let maxNativeZoom = (material.layer as XYZ).maxNativeZoom;\r\n                if (pn.segment.tileZoom === maxNativeZoom) {\r\n                    material.textureNotExists();\r\n                } else if (material.segment.tileZoom <= maxNativeZoom) {\r\n                    !material.isLoading && !material.isReady && this.loadMaterial(material, forceLoading);\r\n                } else {\r\n                    let pn = segment.node;\r\n                    while (pn.segment.tileZoom > (material.layer as XYZ).maxNativeZoom) {\r\n                        pn = pn.parentNode!;\r\n                    }\r\n                    let pnm = pn.segment.materials[material.layer.__id];\r\n                    if (pnm) {\r\n                        !pnm.isLoading && !pnm.isReady && this.loadMaterial(pnm, true);\r\n                    } else {\r\n                        pnm = pn.segment.materials[material.layer.__id] = material.layer.createMaterial(\r\n                            pn.segment\r\n                        );\r\n                        this.loadMaterial(pnm, true);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (notEmpty) {\r\n                material.appliedNode = pn;\r\n                material.appliedNodeId = pn.nodeId;\r\n                material.texture = psegm.texture;\r\n                let dZ2 = 1.0 / (2 << (segment.tileZoom - pn.segment.tileZoom - 1));\r\n                material.texOffset[0] = segment.tileX * dZ2 - pn.segment.tileX;\r\n                material.texOffset[1] = segment.tileY * dZ2 - pn.segment.tileY;\r\n                material.texOffset[2] = dZ2;\r\n                material.texOffset[3] = dZ2;\r\n            } else {\r\n                material.texture = segment.planet.transparentTexture;\r\n                material.texOffset[0] = 0.0;\r\n                material.texOffset[1] = 0.0;\r\n                material.texOffset[2] = 1.0;\r\n                material.texOffset[3] = 1.0;\r\n            }\r\n        }\r\n\r\n        return material.texOffset;\r\n    }\r\n\r\n    public override clearMaterial(material: Material) {\r\n        if (material.isReady && material.textureExists) {\r\n            !material.texture!.default && material.segment.handler.gl!.deleteTexture(material.texture!);\r\n            material.texture = null;\r\n        }\r\n\r\n        material.isReady = false;\r\n        material.textureExists = false;\r\n        material.isLoading = false;\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected override _correctFullExtent() {\r\n        let e = this._extent,\r\n            em = this._extentMerc;\r\n        let ENLARGE_MERCATOR_LON = mercator.POLE + 50000;\r\n        let ENLARGE_MERCATOR_LAT = mercator.POLE + 50000;\r\n        if (e.northEast.lat === 90.0) {\r\n            em.northEast.lat = ENLARGE_MERCATOR_LAT;\r\n        }\r\n        if (e.northEast.lon === 180.0) {\r\n            em.northEast.lon = ENLARGE_MERCATOR_LON;\r\n        }\r\n        if (e.southWest.lat === -90.0) {\r\n            em.southWest.lat = -ENLARGE_MERCATOR_LAT;\r\n        }\r\n        if (e.southWest.lon === -180.0) {\r\n            em.southWest.lon = -ENLARGE_MERCATOR_LON;\r\n        }\r\n\r\n        // WHY!???\r\n        // if (e.northEast.lat >= mercator.MAX_LAT) {\r\n        //     e.northEast.lat = mercator.MAX_LAT;\r\n        // }\r\n        //\r\n        // if (e.northEast.lat <= mercator.MIN_LAT) {\r\n        //     e.northEast.lat = mercator.MIN_LAT;\r\n        // }\r\n    }\r\n}\r\n\r\nconst XYZ_EVENTS: XYZEventsList = [\r\n    /**\r\n     * Triggered when current tile image has loaded before rendering.\r\n     * @event #load\r\n     */\r\n    \"load\",\r\n\r\n    /**\r\n     * Triggered when all tiles have loaded or loading has stopped.\r\n     * @event #loadend\r\n     */\r\n    \"loadend\"\r\n];\r\n","import * as mercator from \"../mercator\";\r\nimport {Extent} from \"../Extent\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {XYZ} from \"./XYZ\";\r\nimport type {IXYZParams} from \"./XYZ\";\r\n\r\ninterface IWMSParams extends IXYZParams {\r\n    extra?: any;\r\n    layers: string;\r\n    imageWidth?: number;\r\n    imageHeight?: number;\r\n    version?: string;\r\n}\r\n\r\n/**\r\n * Used to display WMS services as tile layers on the globe.\r\n * @class\r\n * @extends {XYZ}\r\n * @param {string} name - Layer name.\r\n * @param {Object} options - Options:\r\n * @param {number} [options.opacity=1.0] - Layer opacity.\r\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\r\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\r\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\r\n * @param {boolean} [options.isBaseLayer=false] - Base layer flag.\r\n * @param {boolean} [options.visibility=true] - Layer visibility.\r\n * @param {string} options.url - WMS url source.\r\n * @param {number} [options.width=256] - Tile width.\r\n * @param {number} [options.height=256] - Tile height.\r\n * @param {string} options.layers - WMS layers string.\r\n * @param {string} [options.version=\"1.1.1\"] - WMS version.\r\n * @param {Object} extra  - Extra parameters (by WMS reference or by WMS service vendors) to pass to WMS service.\r\n * @example:\r\n * new og.layer.WMS(\"USA States\", {\r\n *     isBaseLayer: false,\r\n *     url: \"http://openglobus.org/geoserver/\",\r\n *     layers: \"topp:states\",\r\n *     opacity: 0.5,\r\n *     zIndex: 50,\r\n *     attribution: 'USA states - geoserver WMS example',\r\n *     version: \"1.1.1\",\r\n *     visibility: false }, {\r\n *     transparent: true,\r\n *     sld: \"style.sld\"}\r\n * );\r\n */\r\nclass WMS extends XYZ {\r\n\r\n    protected _extra: string;\r\n\r\n    /**\r\n     * WMS layers string.\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public layers: string;\r\n\r\n    /**\r\n     * WMS tile width.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public imageWidth: number;\r\n\r\n    /**\r\n     * WMS tile height.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public imageHeight: number;\r\n\r\n    protected _getBbox: (extent: Extent) => string;\r\n\r\n    protected _version: string;\r\n\r\n    constructor(name: string | null, options: IWMSParams) {\r\n        super(name, options);\r\n\r\n        this._extra = new URLSearchParams(options.extra).toString();\r\n\r\n        if (!options.extent) {\r\n            this.setExtent(new Extent(new LonLat(-180.0, -90), new LonLat(180.0, 90)));\r\n        }\r\n\r\n        this.layers = options.layers;\r\n\r\n        /**\r\n         * WMS tile width.\r\n         * @public\r\n         * @type {number}\r\n         */\r\n        this.imageWidth = options.imageWidth || 256;\r\n\r\n        /**\r\n         * WMS tile height.\r\n         * @public\r\n         * @type {number}\r\n         */\r\n        this.imageHeight = options.imageHeight || 256;\r\n\r\n        this._getBbox = WMS.get_bbox_v1_1_1;\r\n\r\n        this._version = \"\";\r\n\r\n        this.setVersion(options.version);\r\n    }\r\n\r\n    static createRequestUrl(\r\n        url: string,\r\n        layers: string,\r\n        format: string = \"image/png\",\r\n        version: string = \"1.1.1\",\r\n        request: string = \"GetMap\",\r\n        srs: string,\r\n        bbox: string,\r\n        width: number = 256,\r\n        height: number = 256,\r\n        extra?: string\r\n    ): string {\r\n        return `${url}/?LAYERS=${layers}&FORMAT=${format}&SERVICE=WMS&VERSION=${version}&REQUEST=${request}&SRS=${srs}&BBOX=${bbox}&WIDTH=${width}&HEIGHT=${height}` + (extra ? `&${extra}` : \"\");\r\n    }\r\n\r\n    static get_bbox_v1_1_1(extent: Extent): string {\r\n        return `${extent.getWest()},${extent.getSouth()},${extent.getEast()},${extent.getNorth()}`;\r\n    }\r\n\r\n    static get_bbox_v1_3_0(extent: Extent): string {\r\n        return `${extent.getSouth()},${extent.getWest()},${extent.getNorth()},${extent.getEast()}`;\r\n    }\r\n\r\n    public override _checkSegment(segment: Segment) {\r\n        return true;\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"WMS\";\r\n    }\r\n\r\n    protected override _createUrl(segment: Segment): string {\r\n        return WMS.createRequestUrl(\r\n            this.url,\r\n            this.layers,\r\n            \"image/png\",\r\n            this._version,\r\n            \"GetMap\",\r\n            segment._projection.code,\r\n            this._getBbox(segment.getExtent()),\r\n            this.imageWidth,\r\n            this.imageHeight,\r\n            this._extra\r\n        );\r\n    }\r\n\r\n    public setVersion(version?: string) {\r\n        if (version) {\r\n            this._version = version;\r\n        } else {\r\n            this._version = \"1.1.1\";\r\n        }\r\n\r\n        if (this._version === \"1.1.1\") {\r\n            this._getBbox = WMS.get_bbox_v1_1_1;\r\n        } else if (version === \"1.3.0\") {\r\n            this._getBbox = WMS.get_bbox_v1_3_0;\r\n        }\r\n    }\r\n\r\n    public override _correctFullExtent() {\r\n        const e = this._extent;\r\n        const em = this._extentMerc;\r\n\r\n        const ENLARGE_MERCATOR_LON = mercator.POLE + 50000;\r\n        const ENLARGE_MERCATOR_LAT = mercator.POLE + 50000;\r\n\r\n        if (e.northEast.lat === 90.0) {\r\n            em.northEast.lat = ENLARGE_MERCATOR_LAT;\r\n        }\r\n\r\n        if (e.northEast.lon === 180.0) {\r\n            em.northEast.lon = ENLARGE_MERCATOR_LON;\r\n        }\r\n\r\n        if (e.southWest.lat === -90.0) {\r\n            em.southWest.lat = -ENLARGE_MERCATOR_LAT;\r\n        }\r\n\r\n        if (e.southWest.lon === -180.0) {\r\n            em.southWest.lon = -ENLARGE_MERCATOR_LON;\r\n        }\r\n    }\r\n}\r\n\r\nexport {WMS};\r\n\r\n","import {getTileExtent} from \"../mercator\";\r\nimport {GlobusTerrain} from \"./GlobusTerrain\";\r\nimport type {IGlobusTerrainParams} from \"./GlobusTerrain\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {WMS} from \"../layer/WMS\";\r\nimport {isPowerOfTwo, nextHighestPowerOfTwo} from \"../math\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {Extent} from \"../Extent\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\n\r\ninterface IBilTerrainParams extends IGlobusTerrainParams {\r\n    layers?: string;\r\n    imageSize?: number;\r\n}\r\n\r\nclass BilTerrain extends GlobusTerrain {\r\n\r\n    protected _format: string;\r\n\r\n    protected _layers: string;\r\n\r\n    protected _imageSize: number;\r\n\r\n    constructor(options: IBilTerrainParams = {}) {\r\n        super(\"BilTerrain\", options);\r\n\r\n        this.equalizeVertices = true;\r\n\r\n        this.equalizeNormals = true;\r\n\r\n        this.minZoom = options.minZoom || 2;\r\n\r\n        this.maxZoom = options.maxZoom || 14;\r\n\r\n        this.noDataValues = options.noDataValues || [-9999, 32767];\r\n\r\n        this.url = options.url || \"\";\r\n\r\n        this._format = \"application/bil16\";\r\n\r\n        this._layers = options.layers || \"\";\r\n\r\n        this._imageSize = options.imageSize || 256;\r\n\r\n        this.plainGridSize = options.plainGridSize != undefined\r\n            ? options.plainGridSize\r\n            : isPowerOfTwo(this._imageSize) ? this._imageSize / 2 : nextHighestPowerOfTwo(this._imageSize) / 2;\r\n\r\n        this._dataType = \"arrayBuffer\";\r\n    }\r\n\r\n    public override isBlur(segment: Segment): boolean {\r\n        return segment.tileZoom >= 18;\r\n    }\r\n\r\n    protected override _createUrl(segment: Segment): string {\r\n        return WMS.createRequestUrl(\r\n            this.url,\r\n            this._layers,\r\n            this._format,\r\n            \"1.1.1\",\r\n            \"GetMap\",\r\n            segment._projection.code,\r\n            WMS.get_bbox_v1_1_1(segment.getExtent()),\r\n            this._imageSize,\r\n            this._imageSize\r\n        );\r\n    }\r\n\r\n    protected override _createHeights(data: number[], segment: Segment | null, tileGroup: number, tileX: number, tileY: number, tileZoom: number, extent: Extent, preventChildren: boolean): TypedArray | number[] {\r\n\r\n        let bil16 = new Int16Array(data);\r\n\r\n        //\r\n        //Non-power of two images\r\n        //\r\n        if (!isPowerOfTwo(this._imageSize)) {\r\n            let outCurrenElevations = new Float32Array(bil16.length);\r\n            //TODO: optimize\r\n            extractElevationTilesNonPowerOfTwo(bil16, outCurrenElevations);\r\n            return outCurrenElevations;\r\n        }\r\n\r\n        let elevationsSize = (this.plainGridSize + 1) * (this.plainGridSize + 1);\r\n\r\n        let d = 4;\r\n\r\n        let outChildrenElevations = new Array(d);\r\n\r\n        for (let i = 0; i < d; i++) {\r\n            outChildrenElevations[i] = [];\r\n            for (let j = 0; j < d; j++) {\r\n                outChildrenElevations[i][j] = new Float32Array(elevationsSize);\r\n            }\r\n        }\r\n\r\n        let outCurrenElevations = new Float32Array(elevationsSize);\r\n\r\n        extractElevationTiles(bil16, this.noDataValues, outCurrenElevations, outChildrenElevations);\r\n\r\n        let tileIndex = Layer.getTileIndex(tileX, tileY, tileZoom, tileGroup);\r\n\r\n        this.setElevationCache(tileIndex, {\r\n            heights: outCurrenElevations,\r\n            extent: extent\r\n        });\r\n\r\n        let dd = this._imageSize / this.plainGridSize;\r\n\r\n        for (let i = 0; i < dd; i++) {\r\n            for (let j = 0; j < dd; j++) {\r\n                let x = tileX * 2 + j,\r\n                    y = tileY * 2 + i,\r\n                    z = tileZoom + 1;\r\n                let tileIndex = Layer.getTileIndex(x, y, z, tileGroup);\r\n                this.setElevationCache(tileIndex, {\r\n                    heights: outChildrenElevations[i][j],\r\n                    extent: getTileExtent(x, y, z)\r\n                });\r\n            }\r\n        }\r\n\r\n        return outCurrenElevations;\r\n    }\r\n}\r\n\r\nfunction extractElevationTilesNonPowerOfTwo(data: number[] | TypedArray, outCurrenElevations: number[] | TypedArray) {\r\n    for (let i = 0, len = outCurrenElevations.length; i < len; i++) {\r\n        outCurrenElevations[i] = data[i];\r\n    }\r\n}\r\n\r\nfunction extractElevationTiles(data: number[] | TypedArray, noDataValues: number[] | TypedArray, outCurrenElevations: number[] | TypedArray, outChildrenElevations: number[][][] | TypedArray[][]) {\r\n    let destSize = Math.sqrt(outCurrenElevations.length) - 1;\r\n    let destSizeOne = destSize + 1;\r\n    let sourceSize = Math.sqrt(data.length);\r\n    let dt = sourceSize / destSize;\r\n\r\n    let rightHeight = 0,\r\n        bottomHeight = 0;\r\n\r\n    for (let k = 0, currIndex = 0, sourceDataLength = data.length; k < sourceDataLength; k++) {\r\n        let height = data[k];\r\n\r\n        let isNoDataCurrent = BilTerrain.checkNoDataValue(noDataValues, height),\r\n            isNoDataRight = false,\r\n            isNoDataBottom = false;\r\n\r\n        let i = Math.floor(k / sourceSize),\r\n            j = k % sourceSize;\r\n\r\n        let tileX = Math.floor(j / destSize),\r\n            tileY = Math.floor(i / destSize);\r\n\r\n        let destArr = outChildrenElevations[tileY][tileX];\r\n\r\n        let ii = i % destSize,\r\n            jj = j % destSize;\r\n\r\n        let destIndex = (ii + tileY) * destSizeOne + jj + tileX;\r\n\r\n        destArr[destIndex] = height;\r\n\r\n        if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\r\n            outCurrenElevations[currIndex++] = height;\r\n        }\r\n\r\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\r\n            //current tile\r\n            rightHeight = data[k];\r\n\r\n            isNoDataRight = BilTerrain.checkNoDataValue(noDataValues, rightHeight);\r\n\r\n            let middleHeight = height;\r\n            if (!(isNoDataCurrent || isNoDataRight)) {\r\n                middleHeight = (height + rightHeight) * 0.5;\r\n            }\r\n\r\n            destIndex = (ii + tileY) * destSizeOne + jj + 1;\r\n            destArr[destIndex] = middleHeight;\r\n\r\n            if ((i + tileY) % dt === 0) {\r\n                outCurrenElevations[currIndex++] = middleHeight;\r\n            }\r\n\r\n            //next right tile\r\n            let rightindex = (ii + tileY) * destSizeOne + ((jj + 1) % destSize);\r\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\r\n        }\r\n\r\n        if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\r\n            //current tile\r\n            bottomHeight = data[k + sourceSize];\r\n\r\n            isNoDataBottom = BilTerrain.checkNoDataValue(noDataValues, bottomHeight);\r\n\r\n            let middleHeight = height;\r\n\r\n            if (!(isNoDataCurrent || isNoDataBottom)) {\r\n                middleHeight = (height + bottomHeight) * 0.5;\r\n            }\r\n\r\n            destIndex = (ii + 1) * destSizeOne + jj + tileX;\r\n            destArr[destIndex] = middleHeight;\r\n\r\n            if ((j + tileX) % dt === 0) {\r\n                outCurrenElevations[currIndex++] = middleHeight;\r\n            }\r\n\r\n            //next bottom tile\r\n            let bottomindex = ((ii + 1) % destSize) * destSizeOne + jj + tileX;\r\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\r\n        }\r\n\r\n        if (\r\n            (j + 1) % destSize === 0 &&\r\n            j !== sourceSize - 1 &&\r\n            (i + 1) % destSize === 0 &&\r\n            i !== sourceSize - 1\r\n        ) {\r\n            //current tile\r\n            let rightBottomHeight = data[k + sourceSize + 1];\r\n\r\n            let isNoDataRightBottom = BilTerrain.checkNoDataValue(noDataValues, rightBottomHeight);\r\n\r\n            let middleHeight = height;\r\n\r\n            if (!(isNoDataCurrent || isNoDataRight || isNoDataBottom || isNoDataRightBottom)) {\r\n                middleHeight = (height + rightHeight + bottomHeight + rightBottomHeight) * 0.25;\r\n            }\r\n\r\n            destIndex = (ii + 1) * destSizeOne + (jj + 1);\r\n            destArr[destIndex] = middleHeight;\r\n\r\n            outCurrenElevations[currIndex++] = middleHeight;\r\n\r\n            //next right tile\r\n            let rightindex = (ii + 1) * destSizeOne;\r\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\r\n\r\n            //next bottom tile\r\n            let bottomindex = destSize;\r\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\r\n\r\n            //next right bottom tile\r\n            let rightBottomindex = 0;\r\n            outChildrenElevations[tileY + 1][tileX + 1][rightBottomindex] = middleHeight;\r\n        }\r\n    }\r\n}\r\n\r\nexport {BilTerrain};\r\n","import {Extent} from \"../Extent\";\r\nimport {getTileExtent} from \"../mercator\";\r\nimport {GlobusTerrain} from \"./GlobusTerrain\";\r\nimport type {IGlobusTerrainParams} from \"./GlobusTerrain\";\r\nimport {isPowerOfTwo} from \"../math\";\r\nimport {Layer} from \"../layer/Layer\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {binarySearchFast} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport type {IResponse} from \"../utils/Loader\";\r\n\r\nexport interface IRgbTerrainParams extends IGlobusTerrainParams {\r\n    equalizeNormals?: boolean;\r\n    key?: string;\r\n    imageSize?: number;\r\n    minHeight?: number;\r\n    resolution?: number;\r\n}\r\n\r\n/**\r\n * @class\r\n * @extends {GlobusTerrain}\r\n * @param {string} [name=\"\"] - Terrain provider name.\r\n * @param {IRgbTerrainParams} [options]:\r\n * @param {boolean} [equalizeNormals=true] - Make normal equalization on the edges of the tiles.\r\n * @param {string} [key=\"\"] - API key.\r\n * @param {number} [imageSize=256] - Image size.\r\n * @param {number} [minHeight=-10000] - Minimal height for rgb to height converter.\r\n * @param {number} [resolution=0.1] - Height converter resolution.\r\n */\r\nclass RgbTerrain extends GlobusTerrain {\r\n\r\n    protected _imageSize: number;\r\n\r\n    protected _ctx: CanvasRenderingContext2D;\r\n\r\n    protected _imageDataCache: Record<string, Uint8ClampedArray>;\r\n\r\n    protected _minHeight: number;\r\n\r\n    protected _resolution: number;\r\n\r\n    constructor(name: string | null, options: IRgbTerrainParams = {}) {\r\n        super(name || \"RgbTerrain\", {\r\n            equalizeVertices: options.equalizeVertices != undefined ? options.equalizeVertices : true,\r\n            maxZoom: options.maxZoom || 17,\r\n            noDataValues: options.noDataValues || [options.minHeight != undefined ? options.minHeight : -10000],\r\n            plainGridSize: options.plainGridSize || 128,\r\n            url: options.url != undefined\r\n                ? options.url\r\n                : `//api.mapbox.com/v4/mapbox.terrain-rgb/{z}/{x}/{y}.pngraw?access_token=${options.key || \"<key>\"}`,\r\n            gridSizeByZoom: options.gridSizeByZoom || [\r\n                64, 32, 16, 8, 8, 8, 16, 16, 16, 32, 32, 32, 32, 32, 32, 64, 64, 64, 32, 32, 16, 8\r\n            ],\r\n            ...options\r\n        });\r\n\r\n        this.equalizeNormals = options.equalizeNormals || false;\r\n\r\n        this._dataType = \"imageBitmap\";\r\n\r\n        this._imageSize = options.imageSize || 256;\r\n\r\n        this._ctx = this._createTemporalCanvas(this._imageSize);\r\n\r\n        this._imageDataCache = {};\r\n\r\n        this._minHeight = options.minHeight || -10000.0;\r\n        this._resolution = options.resolution || 0.1;\r\n    }\r\n\r\n    static override checkNoDataValue(noDataValues: number[] | TypedArray, value: number): boolean {\r\n        if (value > 50000) {\r\n            return true;\r\n        }\r\n        return binarySearchFast(noDataValues, value) !== -1;\r\n    }\r\n\r\n    public rgb2Height(r: number, g: number, b: number): number {\r\n        // Filter for \"yellowish\" pixels\r\n        if (r === 255) {\r\n            return this._minHeight;\r\n        }\r\n        return this._minHeight + this._resolution * (r * 256 * 256 + g * 256 + b);\r\n    }\r\n\r\n    public override isBlur(segment: Segment): boolean {\r\n        return segment.tileZoom >= 16;\r\n    }\r\n\r\n    protected _createTemporalCanvas(size: number): CanvasRenderingContext2D {\r\n        let canvas = document.createElement(\"canvas\");\r\n        canvas.width = size;\r\n        canvas.height = size;\r\n        return canvas.getContext(\"2d\", {\r\n            willReadFrequently: true\r\n        })!;\r\n    }\r\n\r\n    protected override _createHeights(data: HTMLImageElement | ImageBitmap, segment: Segment | null, tileGroup: number, tileX: number, tileY: number, tileZoom: number, extent: Extent, preventChildren: boolean): TypedArray | number[] {\r\n\r\n        this._ctx.clearRect(0, 0, this._imageSize, this._imageSize);\r\n        this._ctx.drawImage(data, 0, 0);\r\n        let rgbaData = this._ctx.getImageData(0, 0, this._imageSize, this._imageSize).data;\r\n\r\n        const SIZE = data.width;\r\n\r\n        let availableParentTileX = 0,\r\n            availableParentTileY = 0,\r\n            availableParentTileZoom = 0,\r\n            availableParentData: TypedArray | number[] | null = null,\r\n            skipPositiveHeights = false;\r\n\r\n        //\r\n        // Getting parent segment terrain data, for zero and nodata values for the current segment\r\n        //\r\n        if (segment) {\r\n            if (segment.tileZoom > this.maxNativeZoom) {\r\n                let pn = segment.node;\r\n                while (pn && !pn.segment.terrainExists) {\r\n                    pn = pn.parentNode!;\r\n                }\r\n                if (pn) {\r\n                    availableParentTileX = pn.segment.tileX;\r\n                    availableParentTileY = pn.segment.tileY;\r\n                    availableParentTileZoom = pn.segment.tileZoom;\r\n                    availableParentData = pn.segment.elevationData;\r\n                    // in this case maxNativeZoom means sea level\r\n                    skipPositiveHeights = availableParentTileZoom <= 8;\r\n                }\r\n            }\r\n        }\r\n\r\n        //\r\n        //Non-power of two images\r\n        //\r\n        if (!isPowerOfTwo(this._imageSize) && SIZE === this._imageSize) {\r\n            let outCurrenElevations = new Float32Array(SIZE * SIZE);\r\n            this.extractElevationTilesRgbNonPowerOfTwo(rgbaData, outCurrenElevations, this._heightFactor);\r\n            return outCurrenElevations;\r\n        }\r\n\r\n        //\r\n        // When image size equals grid size\r\n        //\r\n        if (this._imageSize === this.plainGridSize) {\r\n\r\n            let elevationsSize = (this.plainGridSize + 1) * (this.plainGridSize + 1);\r\n            let outCurrenElevations = new Float32Array(elevationsSize);\r\n\r\n            let [\r\n                availableParentOffsetX,\r\n                availableParentOffsetY,\r\n                availableZoomDiff\r\n            ] =\r\n                segment ? getTileOffset(\r\n                    segment.tileX, segment.tileY, segment.tileZoom,\r\n                    availableParentTileX, availableParentTileY, availableParentTileZoom\r\n                ) : [0, 0, 0];\r\n\r\n            this.extractElevationSimple(\r\n                rgbaData,\r\n                this.noDataValues,\r\n                availableParentData,\r\n                availableParentOffsetX,\r\n                availableParentOffsetY,\r\n                availableZoomDiff,\r\n                skipPositiveHeights,\r\n                outCurrenElevations,\r\n                this._heightFactor,\r\n                this._imageSize\r\n            );\r\n\r\n            return outCurrenElevations;\r\n        }\r\n\r\n        //\r\n        // Power of two images\r\n        //\r\n        let elevationsSize = (this.plainGridSize + 1) * (this.plainGridSize + 1);\r\n\r\n        let d = SIZE / this.plainGridSize;\r\n\r\n        let outCurrenElevations = new Float32Array(elevationsSize);\r\n        let outChildrenElevations = new Array(d);\r\n\r\n        for (let i = 0; i < d; i++) {\r\n            outChildrenElevations[i] = [];\r\n            for (let j = 0; j < d; j++) {\r\n                outChildrenElevations[i][j] = new Float32Array(elevationsSize);\r\n            }\r\n        }\r\n\r\n        if (!preventChildren) {\r\n            this.extractElevationTilesRgb(\r\n                rgbaData,\r\n                this._heightFactor,\r\n                this.noDataValues,\r\n                availableParentData,\r\n                availableParentTileX,\r\n                availableParentTileY,\r\n                availableParentTileZoom,\r\n                segment ? segment.tileX : 0,\r\n                segment ? segment.tileY : 0,\r\n                segment ? segment.tileZoom : 0,\r\n                skipPositiveHeights,\r\n                outCurrenElevations,\r\n                outChildrenElevations\r\n            );\r\n\r\n            // Save children data to cache\r\n            for (let i = 0; i < d; i++) {\r\n                for (let j = 0; j < d; j++) {\r\n                    let [x, y, z] = getChildTileIndex(tileX, tileY, tileZoom, j, i);\r\n                    let tileIndex = Layer.getTileIndex(x, y, z, tileGroup);\r\n                    this.setElevationCache(tileIndex, {\r\n                        heights: outChildrenElevations[i][j],\r\n                        //\r\n                        // @todo: must work for any grids\r\n                        //\r\n                        extent: getTileExtent(x, y, z)\r\n                    });\r\n                }\r\n            }\r\n        } else {\r\n            this.extractElevationTilesRgbNoChildren(\r\n                rgbaData,\r\n                this._heightFactor,\r\n                this.noDataValues,\r\n                availableParentData,\r\n                availableParentTileX,\r\n                availableParentTileY,\r\n                availableParentTileZoom,\r\n                segment ? segment.tileX : 0,\r\n                segment ? segment.tileY : 0,\r\n                segment ? segment.tileZoom : 0,\r\n                skipPositiveHeights,\r\n                outCurrenElevations\r\n            );\r\n        }\r\n\r\n        let tileIndex = Layer.getTileIndex(tileX, tileY, tileZoom, tileGroup);\r\n\r\n        // Save current data to cache\r\n        this.setElevationCache(tileIndex, {\r\n            heights: outCurrenElevations,\r\n            extent: extent\r\n        });\r\n\r\n        return outCurrenElevations;\r\n    }\r\n\r\n    public override getHeightAsync(lonLat: LonLat, callback: (h: number) => void, zoom?: number): boolean {\r\n\r\n        zoom = zoom != undefined ? zoom : this.maxZoom;\r\n\r\n        if (zoom === 0) {\r\n            callback(0);\r\n            return true;\r\n        }\r\n\r\n        const qts = this._planet!.quadTreeStrategy;\r\n        const [x, y, z, tileGroup] = qts.getTileXY(lonLat, zoom);\r\n        const [i, j] = qts.getLonLatTileOffset(lonLat, x, y, z, this._imageSize);\r\n        const index = (i * this._imageSize + j) * 4;\r\n        const tileIndex = Layer.getTileIndex(x, y, z, tileGroup);\r\n\r\n        if (this._imageDataCache[tileIndex]) {\r\n            let data = this._imageDataCache[tileIndex];\r\n            let height = this._heightFactor * this.rgb2Height(data[index], data[index + 1], data[index + 2]);\r\n            let isNoData = RgbTerrain.checkNoDataValue(this.noDataValues, height);\r\n            if (isNoData) {\r\n                return this.getHeightAsync(lonLat, callback, zoom - 1);\r\n            } else {\r\n                callback(this._heightFactor * this.rgb2Height(data[index], data[index + 1], data[index + 2]));\r\n                return true;\r\n            }\r\n        }\r\n\r\n        let def = this._fetchCache[tileIndex];\r\n        if (!def) {\r\n            def = this._loader.fetch({\r\n                src: this._urlRewriteCallback && this._urlRewriteCallback(x, y, z, tileGroup) || this.buildURL(x, y, z, tileGroup),\r\n                type: this._dataType\r\n            });\r\n            this._fetchCache[tileIndex] = def;\r\n        }\r\n\r\n        def!.then((response: IResponse) => {\r\n            if (response.status === \"ready\") {\r\n                this._ctx.clearRect(0, 0, this._imageSize, this._imageSize);\r\n                this._ctx.drawImage(response.data, 0, 0);\r\n                let data = this._ctx.getImageData(0, 0, 256, 256).data;\r\n                this._imageDataCache[tileIndex] = data;\r\n\r\n                let height = this._heightFactor * this.rgb2Height(data[index], data[index + 1], data[index + 2]);\r\n                let isNoData = RgbTerrain.checkNoDataValue(this.noDataValues, height);\r\n                if (isNoData) {\r\n                    return this.getHeightAsync(lonLat, callback, zoom! - 1);\r\n                } else {\r\n                    callback(this._heightFactor * this.rgb2Height(data[index], data[index + 1], data[index + 2]));\r\n                }\r\n            } else if (response.status === \"error\") {\r\n                return this.getHeightAsync(lonLat, callback, zoom! - 1);\r\n            } else {\r\n                //@ts-ignore\r\n                this._fetchCache[tileIndex] = null;\r\n                delete this._fetchCache[tileIndex];\r\n            }\r\n        });\r\n\r\n        return false;\r\n    }\r\n\r\n    public extractElevationSimple(\r\n        rgbaData: number[] | TypedArray,\r\n        noDataValues: number[] | TypedArray,\r\n        availableParentData: TypedArray | number[] | null = null,\r\n        availableParentOffsetX: number,\r\n        availableParentOffsetY: number,\r\n        availableZoomDiff: number,\r\n        skipPositiveHeights: boolean,\r\n        outCurrenElevations: number[] | TypedArray,\r\n        heightFactor: number = 1,\r\n        imageSize: number\r\n    ) {\r\n\r\n        for (let k = 0, len = imageSize * imageSize; k < len; k++) {\r\n            let j = k % imageSize,\r\n                i = Math.floor(k / imageSize);\r\n            let fromInd4 = k * 4;\r\n            let height = heightFactor * this.rgb2Height(rgbaData[fromInd4], rgbaData[fromInd4 + 1], rgbaData[fromInd4 + 2]);\r\n            let isNoData = RgbTerrain.checkNoDataValue(noDataValues, height);\r\n            if ((isNoData || height === 0) && availableParentData) {\r\n                height = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, i, j, skipPositiveHeights);\r\n            }\r\n            outCurrenElevations[i * (imageSize + 1) + j] = height;\r\n        }\r\n\r\n        for (let i = 0, len = imageSize; i < len; i++) {\r\n            let j = imageSize - 1;\r\n            let fromInd4 = (i * imageSize + j) * 4;\r\n            let height = heightFactor * this.rgb2Height(rgbaData[fromInd4], rgbaData[fromInd4 + 1], rgbaData[fromInd4 + 2]);\r\n            let isNoData = RgbTerrain.checkNoDataValue(noDataValues, height);\r\n            if ((isNoData || height === 0) && availableParentData) {\r\n                height = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, i, j, skipPositiveHeights);\r\n            }\r\n            outCurrenElevations[i * (imageSize + 1) + imageSize] = height;\r\n        }\r\n\r\n        for (let j = 0, len = imageSize; j < len; j++) {\r\n            let i = imageSize - 1;\r\n            let fromInd4 = (i * imageSize + j) * 4;\r\n            let height = heightFactor * this.rgb2Height(rgbaData[fromInd4], rgbaData[fromInd4 + 1], rgbaData[fromInd4 + 2]);\r\n            let isNoData = RgbTerrain.checkNoDataValue(noDataValues, height);\r\n            if ((isNoData || height === 0) && availableParentData) {\r\n                height = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, i, j, skipPositiveHeights);\r\n            }\r\n            outCurrenElevations[imageSize * (imageSize + 1) + j] = height;\r\n        }\r\n\r\n        let height = heightFactor * this.rgb2Height(rgbaData[rgbaData.length - 4], rgbaData[rgbaData.length - 3], rgbaData[rgbaData.length - 2]);\r\n        let isNoData = RgbTerrain.checkNoDataValue(noDataValues, height);\r\n        if ((isNoData || height === 0) && availableParentData) {\r\n            height = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, imageSize - 1, imageSize - 1, skipPositiveHeights);\r\n        }\r\n        outCurrenElevations[outCurrenElevations.length - 1] = height;\r\n    }\r\n\r\n    public extractElevationTilesRgbNonPowerOfTwo(rgbaData: number[] | TypedArray, outCurrenElevations: number[] | TypedArray, heightFactor: number = 1) {\r\n        for (let i = 0, len = outCurrenElevations.length; i < len; i++) {\r\n            let i4 = i * 4;\r\n            outCurrenElevations[i] = heightFactor * this.rgb2Height(rgbaData[i4], rgbaData[i4 + 1], rgbaData[i4 + 2]);\r\n        }\r\n    }\r\n\r\n    public extractElevationTilesRgb(\r\n        rgbaData: number[] | TypedArray,\r\n        heightFactor: number,\r\n        noDataValues: number[] | TypedArray,\r\n        availableParentData: TypedArray | number[] | null = null,\r\n        availableParentTileX: number,\r\n        availableParentTileY: number,\r\n        availableParentTileZoom: number,\r\n        currentTileX: number,\r\n        currentTileY: number,\r\n        currentTileZoom: number,\r\n        skipPositiveHeights: boolean,\r\n        outCurrenElevations: number[] | TypedArray,\r\n        outChildrenElevations: number[][][] | TypedArray[][]\r\n    ) {\r\n        let destSize = Math.sqrt(outCurrenElevations.length) - 1;\r\n        let destSizeOne = destSize + 1;\r\n        let sourceSize = Math.sqrt(rgbaData.length / 4);\r\n        let dt = sourceSize / destSize;\r\n\r\n        let rightHeight = 0,\r\n            bottomHeight = 0,\r\n            sourceSize4 = 0;\r\n\r\n        let [availableParentOffsetX, availableParentOffsetY, availableZoomDiff] = getTileOffset(\r\n            currentTileX, currentTileY, currentTileZoom,\r\n            availableParentTileX, availableParentTileY, availableParentTileZoom\r\n        );\r\n\r\n        for (\r\n            let k = 0, currIndex = 0, sourceDataLength = rgbaData.length / 4;\r\n            k < sourceDataLength;\r\n            k++\r\n        ) {\r\n            let k4 = k * 4;\r\n\r\n            let height = heightFactor * this.rgb2Height(rgbaData[k4], rgbaData[k4 + 1], rgbaData[k4 + 2]);\r\n\r\n            let isNoDataCurrent = RgbTerrain.checkNoDataValue(noDataValues, height),\r\n                isNoDataRight = false,\r\n                isNoDataBottom = false;\r\n\r\n            let i = Math.floor(k / sourceSize),\r\n                j = k % sourceSize;\r\n\r\n            //\r\n            // Try to get current height from the parent data\r\n            if ((isNoDataCurrent || height === 0) && availableParentData) {\r\n                height = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor(i / dt), Math.floor(j / dt), skipPositiveHeights);\r\n            }\r\n\r\n            let tileX = Math.floor(j / destSize),\r\n                tileY = Math.floor(i / destSize);\r\n\r\n            let destArr = outChildrenElevations[tileY][tileX];\r\n\r\n            let ii = i % destSize,\r\n                jj = j % destSize;\r\n\r\n            let destIndex = (ii + tileY) * destSizeOne + jj + tileX;\r\n\r\n            destArr[destIndex] = height;\r\n\r\n            if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\r\n                outCurrenElevations[currIndex++] = height;\r\n            }\r\n\r\n            if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\r\n                //current tile\r\n                rightHeight = heightFactor * this.rgb2Height(rgbaData[k4 + 4], rgbaData[k4 + 5], rgbaData[k4 + 6]);\r\n                isNoDataRight = RgbTerrain.checkNoDataValue(noDataValues, rightHeight);\r\n\r\n                //\r\n                // Try to get right height from the parent data\r\n                if ((isNoDataRight || rightHeight === 0) && availableParentData) {\r\n                    rightHeight = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor(i / dt), Math.floor((j + 1) / dt), skipPositiveHeights);\r\n                }\r\n\r\n                let middleHeight = height;\r\n\r\n                if (!(isNoDataCurrent || isNoDataRight)) {\r\n                    middleHeight = (height + rightHeight) * 0.5;\r\n                }\r\n\r\n                destIndex = (ii + tileY) * destSizeOne + jj + 1;\r\n                destArr[destIndex] = middleHeight;\r\n\r\n                if ((i + tileY) % dt === 0) {\r\n                    outCurrenElevations[currIndex++] = middleHeight;\r\n                }\r\n\r\n                //next right tile\r\n                let rightindex = (ii + tileY) * destSizeOne + ((jj + 1) % destSize);\r\n                outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\r\n            }\r\n\r\n            if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\r\n                //current tile\r\n                sourceSize4 = sourceSize * 4;\r\n\r\n                bottomHeight = heightFactor * this.rgb2Height(rgbaData[k4 + sourceSize4], rgbaData[k4 + sourceSize4 + 1], rgbaData[k4 + sourceSize4 + 2]);\r\n                isNoDataBottom = RgbTerrain.checkNoDataValue(noDataValues, bottomHeight);\r\n\r\n                //\r\n                // Try to get bottom height from the parent data\r\n                if ((isNoDataBottom || bottomHeight === 0) && availableParentData) {\r\n                    bottomHeight = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor((i + 1) / dt), Math.floor(j / dt), skipPositiveHeights);\r\n                }\r\n\r\n                let middleHeight = (height + bottomHeight) * 0.5;\r\n\r\n                if (!(isNoDataCurrent || isNoDataBottom)) {\r\n                    middleHeight = (height + bottomHeight) * 0.5;\r\n                }\r\n\r\n                destIndex = (ii + 1) * destSizeOne + jj + tileX;\r\n                destArr[destIndex] = middleHeight;\r\n\r\n                if ((j + tileX) % dt === 0) {\r\n                    outCurrenElevations[currIndex++] = middleHeight;\r\n                }\r\n\r\n                //next bottom tile\r\n                let bottomindex = ((ii + 1) % destSize) * destSizeOne + jj + tileX;\r\n                outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\r\n            }\r\n\r\n            if (\r\n                (j + 1) % destSize === 0 && j !== sourceSize - 1 &&\r\n                (i + 1) % destSize === 0 && i !== sourceSize - 1\r\n            ) {\r\n                //current tile\r\n                let rightBottomHeight = heightFactor * this.rgb2Height(rgbaData[k4 + sourceSize4 + 4], rgbaData[k4 + sourceSize4 + 5], rgbaData[k4 + sourceSize4 + 6]);\r\n                let isNoDataRightBottom = RgbTerrain.checkNoDataValue(noDataValues, rightBottomHeight);\r\n\r\n                //\r\n                // Try to get right bottom height from the parent data\r\n                if ((isNoDataRightBottom || rightBottomHeight === 0) && availableParentData) {\r\n                    rightBottomHeight = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor((i + 1) / dt), Math.floor((j + 1) / dt), skipPositiveHeights);\r\n                }\r\n\r\n                let middleHeight = height;\r\n\r\n                if (!(isNoDataCurrent || isNoDataRight || isNoDataBottom || isNoDataRightBottom)) {\r\n                    middleHeight = (height + rightHeight + bottomHeight + rightBottomHeight) * 0.25;\r\n                }\r\n\r\n                destIndex = (ii + 1) * destSizeOne + (jj + 1);\r\n                destArr[destIndex] = middleHeight;\r\n\r\n                outCurrenElevations[currIndex++] = middleHeight;\r\n\r\n                //next right tile\r\n                let rightindex = (ii + 1) * destSizeOne;\r\n                outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\r\n\r\n                //next bottom tile\r\n                let bottomindex = destSize;\r\n                outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\r\n\r\n                //next right bottom tile\r\n                let rightBottomindex = 0;\r\n                outChildrenElevations[tileY + 1][tileX + 1][rightBottomindex] = middleHeight;\r\n            }\r\n        }\r\n    }\r\n\r\n    public extractElevationTilesRgbNoChildren(\r\n        rgbaData: number[] | TypedArray,\r\n        heightFactor: number,\r\n        noDataValues: number[] | TypedArray,\r\n        availableParentData: TypedArray | number[] | null = null,\r\n        availableParentTileX: number,\r\n        availableParentTileY: number,\r\n        availableParentTileZoom: number,\r\n        currentTileX: number,\r\n        currentTileY: number,\r\n        currentTileZoom: number,\r\n        skipPositiveHeights: boolean,\r\n        outCurrenElevations: number[] | TypedArray\r\n    ) {\r\n        let destSize = Math.sqrt(outCurrenElevations.length) - 1;\r\n        let destSizeOne = destSize + 1;\r\n        let sourceSize = Math.sqrt(rgbaData.length / 4);\r\n        let dt = sourceSize / destSize;\r\n\r\n        let rightHeight = 0,\r\n            bottomHeight = 0,\r\n            sourceSize4 = 0;\r\n\r\n        let [availableParentOffsetX, availableParentOffsetY, availableZoomDiff] = getTileOffset(\r\n            currentTileX, currentTileY, currentTileZoom,\r\n            availableParentTileX, availableParentTileY, availableParentTileZoom\r\n        );\r\n\r\n        for (\r\n            let k = 0, currIndex = 0, sourceDataLength = rgbaData.length / 4;\r\n            k < sourceDataLength;\r\n            k++\r\n        ) {\r\n            let k4 = k * 4;\r\n\r\n            let height = heightFactor * this.rgb2Height(rgbaData[k4], rgbaData[k4 + 1], rgbaData[k4 + 2]);\r\n\r\n            let isNoDataCurrent = RgbTerrain.checkNoDataValue(noDataValues, height),\r\n                isNoDataRight = false,\r\n                isNoDataBottom = false;\r\n\r\n            let i = Math.floor(k / sourceSize),\r\n                j = k % sourceSize;\r\n\r\n            if ((isNoDataCurrent || height === 0) && availableParentData) {\r\n                height = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor(currIndex / destSizeOne), currIndex % destSizeOne, skipPositiveHeights);\r\n            }\r\n\r\n            let tileX = Math.floor(j / destSize),\r\n                tileY = Math.floor(i / destSize);\r\n\r\n            if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\r\n                outCurrenElevations[currIndex++] = height;\r\n            }\r\n\r\n            if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\r\n                //current tile\r\n                rightHeight = heightFactor * this.rgb2Height(rgbaData[k4 + 4], rgbaData[k4 + 5], rgbaData[k4 + 6]);\r\n                isNoDataRight = RgbTerrain.checkNoDataValue(noDataValues, rightHeight);\r\n\r\n                if ((isNoDataRight || rightHeight === 0) && availableParentData) {\r\n                    rightHeight = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor(currIndex / destSizeOne), currIndex % destSizeOne, skipPositiveHeights);\r\n                }\r\n\r\n                let middleHeight = height;\r\n\r\n                if (!(isNoDataCurrent || isNoDataRight)) {\r\n                    middleHeight = (height + rightHeight) * 0.5;\r\n                }\r\n\r\n                if ((i + tileY) % dt === 0) {\r\n                    outCurrenElevations[currIndex++] = middleHeight;\r\n                }\r\n            }\r\n\r\n            if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\r\n                //current tile\r\n                sourceSize4 = sourceSize * 4;\r\n\r\n                bottomHeight = heightFactor * this.rgb2Height(rgbaData[k4 + sourceSize4], rgbaData[k4 + sourceSize4 + 1], rgbaData[k4 + sourceSize4 + 2]);\r\n                isNoDataBottom = RgbTerrain.checkNoDataValue(noDataValues, bottomHeight);\r\n\r\n                if ((isNoDataBottom || bottomHeight === 0) && availableParentData) {\r\n                    bottomHeight = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor(currIndex / destSizeOne), currIndex % destSizeOne, skipPositiveHeights);\r\n                }\r\n\r\n                let middleHeight = (height + bottomHeight) * 0.5;\r\n\r\n                if (!(isNoDataCurrent || isNoDataBottom)) {\r\n                    middleHeight = (height + bottomHeight) * 0.5;\r\n                }\r\n\r\n                if ((j + tileX) % dt === 0) {\r\n                    outCurrenElevations[currIndex++] = middleHeight;\r\n                }\r\n            }\r\n\r\n            if (\r\n                (j + 1) % destSize === 0 && j !== sourceSize - 1 &&\r\n                (i + 1) % destSize === 0 && i !== sourceSize - 1\r\n            ) {\r\n                //current tile\r\n                let rightBottomHeight = heightFactor * this.rgb2Height(rgbaData[k4 + sourceSize4 + 4], rgbaData[k4 + sourceSize4 + 5], rgbaData[k4 + sourceSize4 + 6]);\r\n                let isNoDataRightBottom = RgbTerrain.checkNoDataValue(noDataValues, rightBottomHeight);\r\n\r\n                if ((isNoDataRightBottom || rightBottomHeight === 0) && availableParentData) {\r\n                    rightBottomHeight = getParentHeight(availableZoomDiff, availableParentOffsetX, availableParentOffsetY, availableParentData, Math.floor(currIndex / destSizeOne), currIndex % destSizeOne, skipPositiveHeights);\r\n                }\r\n\r\n                let middleHeight = height;\r\n\r\n                if (!(isNoDataCurrent || isNoDataRight || isNoDataBottom || isNoDataRightBottom)) {\r\n                    middleHeight = (height + rightHeight + bottomHeight + rightBottomHeight) * 0.25;\r\n                }\r\n\r\n                outCurrenElevations[currIndex++] = middleHeight;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction getTileOffset(\r\n    currentTileX: number,\r\n    currentTileY: number,\r\n    currentTileZoom: number,\r\n    parentTileX: number,\r\n    parentTileY: number,\r\n    parentTileZoom: number\r\n): [number, number, number] {\r\n    let dz2 = 2 << (currentTileZoom - parentTileZoom - 1);\r\n    return [currentTileX - dz2 * parentTileX, currentTileY - dz2 * parentTileY, 1.0 / dz2];\r\n}\r\n\r\nfunction getChildTileIndex(\r\n    currentParentTileX: number,\r\n    currentParentTileY: number,\r\n    currentParentTileZoom: number,\r\n    childOffsetX: number,\r\n    childOffsetY: number\r\n): [number, number, number] {\r\n    return [currentParentTileX * 2 + childOffsetX, currentParentTileY * 2 + childOffsetY, currentParentTileZoom + 1];\r\n}\r\n\r\nfunction getParentHeight(oneByDz2: number, offsetX: number, offsetY: number, heights: TypedArray | number[], i: number, j: number, skipPositiveHeights?: boolean) {\r\n    let parentGridSize = Math.sqrt(heights.length);\r\n    let pi = Math.floor(offsetY * oneByDz2 * parentGridSize + i * oneByDz2),\r\n        pj = Math.floor(offsetX * oneByDz2 * parentGridSize + j * oneByDz2);\r\n    let h = heights[pi * parentGridSize + pj];\r\n    return skipPositiveHeights ? (h > 0 ? 0 : h) : h;\r\n}\r\n\r\nexport {RgbTerrain};\r\n","import {RgbTerrain} from \"./RgbTerrain\";\r\nimport type {IRgbTerrainParams} from \"./RgbTerrain\";\r\nimport {Segment, TILEGROUP_NORTH, TILEGROUP_SOUTH} from \"../segment/Segment\";\r\n\r\nconst urlPref: Record<number, string> = {\r\n    [TILEGROUP_NORTH]: \"north\",\r\n    [TILEGROUP_SOUTH]: \"south\"\r\n}\r\n\r\nconst urlRewriteFunc = (tileX: number, tileY: number, tileZoom: number, tileGroup: number): string | undefined => {\r\n    let g = urlPref[tileGroup];\r\n    if (g) return `https://terrain.openglobus.org/poles/${g}/${tileZoom}/${tileX}/${tileY}.png`;\r\n}\r\n\r\nexport class GlobusRgbTerrain extends RgbTerrain {\r\n    constructor(name?: string | null, options?: IRgbTerrainParams) {\r\n        super(name || \"GlobusEarthRgb\", {\r\n            maxNativeZoom: 6,\r\n            maxZoom: 17,\r\n            url: \"https://{s}.terrain.openglobus.org/all/{z}/{x}/{y}.png\",\r\n            urlRewrite: urlRewriteFunc,\r\n            ...options\r\n        });\r\n    }\r\n\r\n    public override isReadyToLoad(segment: Segment): boolean {\r\n        return this._extent.overlaps(segment.getExtentLonLat());\r\n    }\r\n}","import {nextHighestPowerOfTwo} from \"../math\";\r\nimport {BaseGeoImage} from \"./BaseGeoImage\";\r\nimport type {IBaseGeoImageParams} from \"./BaseGeoImage\";\r\nimport {isImageLoaded} from \"../utils/shared\";\r\nimport {Material} from \"./Material\";\r\n\r\nexport interface IGeoImageParams extends IBaseGeoImageParams {\r\n    image?: HTMLImageElement | HTMLCanvasElement | ImageBitmap;\r\n    src?: string;\r\n}\r\n\r\n/**\r\n * Used to load and display a single image over specific corner coordinates on the globe.\r\n * @class\r\n * @extends {BaseGeoImage}\r\n */\r\nclass GeoImage extends BaseGeoImage {\r\n    /**\r\n     * Image object.\r\n     * @protected\r\n     * @type {HTMLImageElement | HTMLCanvasElement | ImageBitmap}\r\n     */\r\n    protected _image: HTMLImageElement | HTMLCanvasElement | ImageBitmap | null;\r\n\r\n    /**\r\n     * Image source url path.\r\n     * @protected\r\n     * @type {string}\r\n     */\r\n    protected _src: string | null;\r\n\r\n    protected _onLoad_: ((this: HTMLImageElement, ev: Event) => void) | null;\r\n\r\n    constructor(name: string | null, options: IGeoImageParams = {}) {\r\n        super(name, options);\r\n        this._image = options.image || null;\r\n        this._src = options.src || null;\r\n        this._onLoad_ = null;\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"GeoImage\";\r\n    }\r\n\r\n    public override abortLoading() {\r\n        if (this._image instanceof HTMLImageElement) {\r\n            this._image.src = \"\";\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets image source url path.\r\n     * @public\r\n     * @param {string} srs - Image url path.\r\n     */\r\n    public setSrc(src: string) {\r\n        this._planet && this._planet._geoImageCreator.remove(this);\r\n        this._src = src;\r\n        this._sourceReady = false;\r\n        this._sourceCreated = false;\r\n        this._image = new Image();\r\n        this._image.crossOrigin = \"Anonymous\";\r\n        this._onLoad_ = this._onLoad.bind(this);\r\n        this._image.addEventListener(\"load\", this._onLoad_);\r\n        this._image.src = src;\r\n    }\r\n\r\n    /**\r\n     * Sets image object.\r\n     * @public\r\n     * @param {Image} image - Image object.\r\n     */\r\n    public setImage(image: HTMLImageElement) {\r\n        this._planet && this._planet._geoImageCreator.remove(this);\r\n        this._sourceCreated = false;\r\n        this._sourceReady = false;\r\n        this._image = image;\r\n        this._image.crossOrigin = \"Anonymous\";\r\n        this._src = image.src;\r\n        if (isImageLoaded(this._image)) {\r\n            this._applyImage(this._image);\r\n        } else {\r\n            this._onLoad_ = this._onLoad.bind(this);\r\n            this._image.addEventListener(\"load\", this._onLoad_);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates source gl texture.\r\n     * @virtual\r\n     * @protected\r\n     */\r\n    protected override _createSourceTexture() {\r\n        if (!this._sourceCreated && this._image) {\r\n            this._sourceTexture = this._planet!.renderer!.handler.createTexture_l(this._image);\r\n            this._sourceCreated = true;\r\n        }\r\n    }\r\n\r\n    protected _onLoad(ev: Event) {\r\n        this._applyImage(this._image);\r\n        if (this._image instanceof HTMLImageElement) {\r\n            this._image.removeEventListener(\"load\", this._onLoad_!);\r\n        }\r\n        this._onLoad_ = null;\r\n    }\r\n\r\n    protected _applyImage(img: HTMLImageElement | HTMLCanvasElement | ImageBitmap | null) {\r\n        if (img) {\r\n            this._frameWidth = nextHighestPowerOfTwo(img.width * 2, 4096);\r\n            this._frameHeight = nextHighestPowerOfTwo(img.height * 3, 4096);\r\n            this._sourceReady = true;\r\n            if (this._planet) {\r\n                this._planet._geoImageCreator.add(this);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * Loads planet segment material. In this case - GeoImage source image.\r\n     * @public\r\n     * @param {Material} material - GeoImage planet material.\r\n     */\r\n    public override loadMaterial(material: Material) {\r\n        material.isLoading = true;\r\n        this._creationProceeding = true;\r\n        if (!this._sourceReady && this._src) {\r\n            if (this._image) {\r\n                if (this._image instanceof HTMLImageElement) {\r\n                    if (isImageLoaded(this._image)) {\r\n                        this._applyImage(this._image);\r\n                    } else {\r\n                        this._onLoad_ = this._onLoad.bind(this);\r\n                        this._image.addEventListener(\"load\", this._onLoad_);\r\n                    }\r\n                }\r\n            } else {\r\n                this._image = new Image();\r\n                this._image.crossOrigin = \"Anonymous\";\r\n                this._onLoad_ = this._onLoad.bind(this);\r\n                this._image.addEventListener(\"load\", this._onLoad_);\r\n                this._image.src = this._src;\r\n            }\r\n        } else if (this._planet) {\r\n            this._planet._geoImageCreator.add(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @param {Material} material - GeoImage material.\r\n     */\r\n    public override abortMaterialLoading(material: Material) {\r\n        if (this._image && this._image instanceof HTMLImageElement) {\r\n            this._image.src = \"\";\r\n        }\r\n        this._creationProceeding = false;\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n}\r\n\r\nexport {GeoImage};\r\n","import {BaseGeoImage} from './BaseGeoImage';\r\nimport type {IBaseGeoImageParams} from './BaseGeoImage';\r\nimport {Material} from \"../layer/Material\";\r\nimport {nextHighestPowerOfTwo} from '../math';\r\nimport type {WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\ninterface IGeoTexture2dParams extends IBaseGeoImageParams {\r\n    texture?: WebGLTextureExt;\r\n    frameWidth?: number;\r\n    frameHeight?: number;\r\n}\r\n\r\nclass GeoTexture2d extends BaseGeoImage {\r\n    constructor(name: string | null, options: IGeoTexture2dParams = {}) {\r\n        super(name, options);\r\n\r\n        this._sourceTexture = options.texture || null;\r\n\r\n        if (options.texture) {\r\n            this._sourceReady = true;\r\n            this._sourceCreated = true;\r\n        }\r\n\r\n        this._frameWidth = options.frameWidth != undefined ? nextHighestPowerOfTwo(options.frameWidth!) : 256;\r\n        this._frameHeight = options.frameHeight != undefined ? nextHighestPowerOfTwo(options.frameHeight!) : 256;\r\n\r\n        this._animate = true;\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"GeoTexture2d\";\r\n    }\r\n\r\n    public override loadMaterial(material: Material) {\r\n        this._planet!._geoImageCreator.add(this);\r\n    }\r\n\r\n    public bindTexture(texture: WebGLTextureExt) {\r\n        this._sourceReady = true;\r\n        this._sourceCreated = true;\r\n        this._sourceTexture = texture;\r\n    }\r\n\r\n    public setSize(width: number, height: number) {\r\n        this._frameWidth = width;\r\n        this._frameHeight = height;\r\n        this._frameCreated = false;\r\n    }\r\n\r\n    public override abortMaterialLoading(material: Material) {\r\n        this._creationProceeding = false;\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n}\r\n\r\nexport {GeoTexture2d};\r\n","import {BaseGeoImage} from \"./BaseGeoImage\";\r\nimport type {IBaseGeoImageParams} from \"./BaseGeoImage\";\r\nimport {Material} from \"./Material\";\r\n\r\nexport interface IGeoVideoParams extends IBaseGeoImageParams {\r\n    videoElement?: HTMLVideoElement;\r\n    src?: string;\r\n}\r\n\r\n/**\r\n * Used to load and display a video stream by specific corners coordinates on the globe.\r\n * @class\r\n * @extends {BaseGeoImage}\r\n */\r\nclass GeoVideo extends BaseGeoImage {\r\n\r\n    /**\r\n     * HTML5 video element object.\r\n     * @protected\r\n     * @type {HTMLVideoElement}\r\n     */\r\n    protected _video: HTMLVideoElement | null;\r\n\r\n    /**\r\n     * Video source url path.\r\n     * @protected\r\n     * @type {string}\r\n     */\r\n    protected _src: string | null;\r\n\r\n    constructor(name: string | null, options: IGeoVideoParams = {}) {\r\n        super(name, options);\r\n\r\n        this._animate = true;\r\n\r\n        this._video = options.videoElement || null;\r\n\r\n        this._src = options.src || null;\r\n    }\r\n\r\n    public override get instanceName(): string {\r\n        return \"GeoVideo\";\r\n    }\r\n\r\n    /**\r\n     * Sets video source url path.\r\n     * @public\r\n     * @param {string} src - Video url path.\r\n     */\r\n    public setSrc(src: string) {\r\n        this._planet && this._planet._geoImageCreator.remove(this);\r\n        this._src = src;\r\n        this._sourceReady = false;\r\n    }\r\n\r\n    /**\r\n     * Sets HTML5 video object.\r\n     * @public\r\n     * @param {HTMLVideoElement} video - HTML5 video element object.\r\n     */\r\n    public setVideoElement(video: HTMLVideoElement) {\r\n        this._planet && this._planet._geoImageCreator.remove(this);\r\n        this._video = video;\r\n        this._src = video.src;\r\n        this._sourceReady = false;\r\n    }\r\n\r\n    /**\r\n     * Sets layer visibility.\r\n     * @public\r\n     * @param {boolean} visibility - Layer visibility.\r\n     */\r\n    public override setVisibility(visibility: boolean) {\r\n        if (visibility != this._visibility) {\r\n            super.setVisibility(visibility);\r\n            if (this._planet) {\r\n                if (visibility) {\r\n                    this._sourceReady && this._planet._geoImageCreator.add(this);\r\n                    this._video && this._video.play();\r\n                } else {\r\n                    this._sourceReady && this._planet._geoImageCreator.remove(this);\r\n                    this._video && this._video.pause();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates or refresh source video GL texture.\r\n     * @virtual\r\n     * @protected\r\n     */\r\n    protected override _createSourceTexture() {\r\n        let gl = this._planet!.renderer!.handler.gl!;\r\n        if (this._sourceCreated) {\r\n            gl.bindTexture(gl.TEXTURE_2D, this._sourceTexture!);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this._video!);\r\n        } else {\r\n            this._sourceTexture = this._planet!.renderer!.handler.createTexture_n_webgl1(this._video!);\r\n            this._sourceCreated = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @private\r\n     */\r\n    protected _onCanPlay(video: HTMLVideoElement) {\r\n        this._frameWidth = video.videoWidth;\r\n        this._frameHeight = video.videoHeight;\r\n        video.width = video.videoWidth;\r\n        video.height = video.videoHeight;\r\n        video.play();\r\n        this._sourceReady = true;\r\n        this._planet!._geoImageCreator.add(this);\r\n    }\r\n\r\n    protected _onError(video: HTMLVideoElement) {\r\n        let err = \"unknown error\";\r\n        switch (video.error!.code) {\r\n            case 1:\r\n                err = \"video loading aborted\";\r\n                break;\r\n            case 2:\r\n                err = \"network loading error\";\r\n                break;\r\n            case 3:\r\n                err = \"video decoding failed / corrupted data or unsupported codec\";\r\n                break;\r\n            case 4:\r\n                err = \"video not supported\";\r\n                break;\r\n        }\r\n        console.warn(`Error: ${err} error-code=${video.error!.code})`);\r\n    }\r\n\r\n    /**\r\n     * Loads planet segment material. In this case - GeoImage source video.\r\n     * @public\r\n     * @param {Material} material - GeoImage planet material.\r\n     */\r\n    public override loadMaterial(material: Material) {\r\n        material.isLoading = true;\r\n        this._creationProceeding = true;\r\n        if (!this._sourceReady && this._src) {\r\n            if (this._video) {\r\n                if (this._video.readyState === this._video.HAVE_ENOUGH_DATA) {\r\n                    this._onCanPlay(this._video);\r\n                } else if (this._video.src) {\r\n                    let that = this;\r\n                    this._video.addEventListener(\"canplay\", function (e: Event) {\r\n                        that._onCanPlay(this);\r\n                    });\r\n                }\r\n            } else {\r\n                this._video = document.createElement(\"video\");\r\n                this._video.crossOrigin = \"Anonymous\";\r\n                let that = this;\r\n                this._video.addEventListener(\"canplay\", function () {\r\n                    that._onCanPlay(this);\r\n                });\r\n                this._video.addEventListener(\"error\", function () {\r\n                    that._onError(this);\r\n                });\r\n            }\r\n            this._video.autoplay = true;\r\n            this._video.loop = true;\r\n            this._video.src = this._src;\r\n            this._video.muted = true;\r\n            this._video.setAttribute(\"playsinline\", \"true\");\r\n            this._video.setAttribute(\"webkit-playsinline\", \"true\");\r\n        } else {\r\n            this._planet!._geoImageCreator.add(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @virtual\r\n     * @param {Material} material - GeoImage material.\r\n     */\r\n    public override abortMaterialLoading(material: Material) {\r\n        this._video && (this._video.src = \"\");\r\n        this._creationProceeding = false;\r\n        material.isLoading = false;\r\n        material.isReady = false;\r\n    }\r\n}\r\n\r\nexport {GeoVideo};\r\n","import {Billboard} from \"../entity/Billboard\";\r\nimport type {IBillboardParams} from \"../entity/Billboard\";\r\nimport {Entity} from \"../entity/Entity\";\r\nimport {Extent} from \"../Extent\";\r\nimport {LonLat} from \"../LonLat\";\r\nimport {Vector} from \"./Vector\";\r\nimport type {IVectorParams} from \"./Vector\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\n\r\ninterface IKMLParams extends IVectorParams {\r\n    color?: string;\r\n    billboard?: IBillboardParams;\r\n}\r\n\r\n/**\r\n * Layer to render KMLs files\r\n * @class\r\n * @extends {Vector}\r\n * @param {string} name\r\n * @param {*} [options]\r\n */\r\nexport class KML extends Vector {\r\n\r\n    protected _color: string;\r\n    protected _billboard: IBillboardParams;\r\n\r\n    constructor(name: string, options: IKMLParams = {}) {\r\n        super(name, options);\r\n        this._billboard = options.billboard || {\r\n            src: \"https://openglobus.org/examples/billboards/carrot.png\"\r\n        };\r\n\r\n        this._color = options.color || \"#6689db\";\r\n    }\r\n\r\n    public override get instanceName() {\r\n        return \"KML\";\r\n    }\r\n\r\n    protected _extractCoordonatesFromKml(xmlDoc: XMLDocument) {\r\n        const raw = Array.from(xmlDoc.getElementsByTagName(\"coordinates\"));\r\n        const rawText = raw.map(item => item.textContent!.trim());\r\n        const coordinates = rawText.map(item =>\r\n            item\r\n                .replace(/\\n/g, \" \")\r\n                .replace(/\\t/g, \" \")\r\n                .replace(/ +/g, \" \")\r\n                .split(\" \")\r\n                .map((co) => co.split(\",\").map(parseFloat))\r\n        );\r\n        return coordinates;\r\n    }\r\n\r\n    protected _AGBRtoRGBA(agbr: string): string | undefined {\r\n        if (!agbr || agbr.length != 8) return;\r\n\r\n        const a = parseInt(agbr.slice(0, 2), 16) / 255;\r\n        const b = parseInt(agbr.slice(2, 4), 16);\r\n        const g = parseInt(agbr.slice(4, 6), 16);\r\n        const r = parseInt(agbr.slice(6, 8), 16);\r\n\r\n        return `rgba(${r},${g},${b},${a})`;\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @returns array of longitude, latitude, altitude (altitude optional)\r\n     */\r\n    protected _parseKMLcoordinates(coords: Element): number[][] {\r\n        const coordinates = coords.innerHTML.trim()\r\n            .replace(/\\n/g, ' ')\r\n            .replace(/\\t/g, ' ')\r\n            .replace(/ +/g, ' ')\r\n            .split(\" \")\r\n            .map((co) => co.split(\",\").map(parseFloat))\r\n\r\n        return coordinates;\r\n    }\r\n\r\n    protected _kmlPlacemarkToEntity(placemark: Element | undefined | null, extent: Extent): Entity | undefined {\r\n        if (!placemark) return;\r\n\r\n        const nameTags: Element[] = Array.from(placemark.getElementsByTagName(\"name\"))\r\n        const name: string = nameTags && nameTags.length > 0 ? nameTags[0].innerHTML.trim() : '';\r\n\r\n        const {iconHeading, iconURL, iconColor, lineWidth, lineColor} = this._extractStyle(placemark);\r\n\r\n        // TODO handle MultiGeometry\r\n\r\n        const lonLats: LonLat[] = [];\r\n        for (const coord of placemark.getElementsByTagName(\"coordinates\")) {\r\n            const coordinates = this._parseKMLcoordinates(coord) || [[0, 0, 0]]\r\n\r\n            for (const lonlatalt of coordinates) {\r\n                const [lon, lat, alt] = lonlatalt\r\n\r\n                lonLats.push(new LonLat(lon, lat, alt));\r\n\r\n                if (lon < extent.southWest.lon) extent.southWest.lon = lon;\r\n                if (lat < extent.southWest.lat) extent.southWest.lat = lat;\r\n                if (lon > extent.northEast.lon) extent.northEast.lon = lon;\r\n                if (lat > extent.northEast.lat) extent.northEast.lat = lat;\r\n            }\r\n        }\r\n\r\n        if (lonLats.length === 1) {\r\n            const hdgrad = iconHeading * 0.01745329; // radians\r\n\r\n            return new Entity({\r\n                name,\r\n                lonlat: lonLats[0],\r\n                billboard: {\r\n                    src: iconURL,\r\n                    size: [24, 24],\r\n                    color: iconColor,\r\n                    rotation: hdgrad\r\n                },\r\n                properties: {\r\n                    color: iconColor,\r\n                    heading: iconHeading\r\n                }\r\n            });\r\n\r\n        } else {\r\n            return new Entity({\r\n                polyline: {\r\n                    pathLonLat: [lonLats],\r\n                    thickness: lineWidth,\r\n                    color: lineColor,\r\n                    isClosed: false\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    protected _extractStyle(placemark: Element): any {\r\n        let iconColor;\r\n        let iconHeading;\r\n        let iconURL;\r\n        let lineColor;\r\n        let lineWidth;\r\n\r\n        const style = placemark.getElementsByTagName(\"Style\")[0];\r\n        if (style) {\r\n            let iconstyle = style.getElementsByTagName(\"IconStyle\")[0];\r\n            if (iconstyle) {\r\n                let color = iconstyle.getElementsByTagName(\"color\")[0];\r\n                if (color)\r\n                    iconColor = this._AGBRtoRGBA(color.innerHTML.trim());\r\n\r\n                let heading = iconstyle.getElementsByTagName(\"heading\")[0];\r\n                if (heading) {\r\n                    const hdg = parseFloat(heading.innerHTML.trim());\r\n                    if (hdg >= 0 && hdg <= 360)\r\n                        iconHeading = hdg % 360;\r\n                }\r\n\r\n                let icon = iconstyle.getElementsByTagName(\"Icon\")[0];\r\n                if (icon) {\r\n                    let href = icon.getElementsByTagName(\"href\")[0];\r\n                    if (href) {\r\n                        iconURL = href.innerHTML.trim();\r\n                    }\r\n                }\r\n            }\r\n\r\n            let linestyle = style.getElementsByTagName(\"LineStyle\")[0];\r\n            if (linestyle) {\r\n                let color = linestyle.getElementsByTagName(\"color\")[0];\r\n                if (color)\r\n                    lineColor = this._AGBRtoRGBA(color.innerHTML.trim());\r\n                let width = linestyle.getElementsByTagName(\"width\")[0];\r\n                if (width !== undefined)\r\n                    lineWidth = parseFloat(width.innerHTML.trim());\r\n            }\r\n        }\r\n\r\n        if (!iconColor) iconColor = \"#FFFFFF\"\r\n        if (!iconHeading) iconHeading = 0\r\n        if (!iconURL) iconURL = \"https://openglobus.org/examples/billboards/carrot.png\"\r\n\r\n        if (!lineColor) lineColor = \"#FFFFFF\"\r\n        if (!lineWidth) lineWidth = 1\r\n\r\n        return {iconHeading, iconURL, iconColor, lineWidth, lineColor};\r\n    }\r\n\r\n    protected _parseKML(xml: XMLDocument, extent: Extent, entities?: Entity[]): Entity[] {\r\n        if (!entities)\r\n            entities = [];\r\n\r\n        if (xml.documentElement.nodeName !== \"kml\")\r\n            return entities;\r\n\r\n        for (const placemark of xml.getElementsByTagName(\"Placemark\")) {\r\n            const entity = this._kmlPlacemarkToEntity(placemark, extent);\r\n            if (entity) entities.push(entity);\r\n        }\r\n\r\n        return entities;\r\n    }\r\n\r\n    protected _convertKMLintoEntities(xml: XMLDocument): any {\r\n        const extent = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\r\n        const entities = this._parseKML(xml, extent);\r\n\r\n        return {entities, extent}\r\n    }\r\n\r\n    /**\r\n     * Creates billboards or polylines from array of lonlat.\r\n     * @protected\r\n     * @param {Array} coordonates\r\n     * @param {string} color\r\n     * @returns {any}\r\n     */\r\n    protected _convertCoordonatesIntoEntities(coordinates: number[][][][], color: string, billboard?: IBillboardParams): any {\r\n        const extent = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\r\n        const addToExtent = (c: number[]) => {\r\n            const lon = c[0],\r\n                lat = c[1];\r\n            if (lon < extent.southWest.lon) extent.southWest.lon = lon;\r\n            if (lat < extent.southWest.lat) extent.southWest.lat = lat;\r\n            if (lon > extent.northEast.lon) extent.northEast.lon = lon;\r\n            if (lat > extent.northEast.lat) extent.northEast.lat = lat;\r\n        };\r\n        const _pathes: number[][][] = [];\r\n\r\n        coordinates.forEach((kmlFile: number[][][]) => kmlFile.forEach((p: number[][]) => _pathes.push(p)));\r\n\r\n        const entities = _pathes.map((path) => {\r\n            if (path.length === 1) {\r\n                const lonlat = path[0] as NumberArray3;\r\n                const _entity = new Entity({lonlat, billboard});\r\n                addToExtent(lonlat);\r\n                return _entity;\r\n            } else if (path.length > 1) {\r\n                const pathLonLat = path.map((item: number[]) => {\r\n                    addToExtent(item);\r\n                    return new LonLat(item[0], item[1], item[2]);\r\n                });\r\n                const _entity = new Entity({\r\n                    polyline: {pathLonLat: [pathLonLat], thickness: 3, color, isClosed: false}\r\n                });\r\n                return _entity;\r\n            }\r\n        });\r\n        return {entities, extent};\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     * @returns {Document}\r\n     */\r\n    protected _getXmlContent(file: Blob): Promise<XMLDocument> {\r\n        return new Promise((resolve) => {\r\n            const fileReader = new FileReader();\r\n            fileReader.onload = async (i) =>\r\n                resolve(new DOMParser().parseFromString(i.target!.result as string, \"text/xml\"));\r\n            fileReader.readAsText(file);\r\n        });\r\n    }\r\n\r\n    protected _expandExtents(extent1: Extent | null | undefined, extent2: Extent): Extent {\r\n        if (!extent1) return extent2;\r\n        if (extent2.southWest.lon < extent1.southWest.lon)\r\n            extent1.southWest.lon = extent2.southWest.lon;\r\n        if (extent2.southWest.lat < extent1.southWest.lat)\r\n            extent1.southWest.lat = extent2.southWest.lat;\r\n        if (extent2.northEast.lon > extent1.northEast.lon)\r\n            extent1.northEast.lon = extent2.northEast.lon;\r\n        if (extent2.northEast.lat > extent1.northEast.lat)\r\n            extent1.northEast.lat = extent2.northEast.lat;\r\n        return extent1;\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @param {File[]} kmls\r\n     * @param {string} [color]\r\n     * @param {Billboard} [billboard]\r\n     * @returns {Promise<{entities: Entity[], extent: Extent}>}\r\n     */\r\n    public async addKmlFromFiles(kmls: Blob[], color?: string, billboard?: IBillboardParams) {\r\n        if (!Array.isArray(kmls)) return null\r\n        const kmlObjs = await Promise.all(kmls.map(this._getXmlContent));\r\n        const coordonates = kmlObjs.map(this._extractCoordonatesFromKml);\r\n        const {entities, extent} = this._convertCoordonatesIntoEntities(\r\n            coordonates,\r\n            color || this._color,\r\n            billboard || this._billboard\r\n        );\r\n        this._extent = this._expandExtents(this._extent, extent);\r\n        entities.forEach(this.add.bind(this));\r\n        return {entities, extent};\r\n    }\r\n\r\n    /**\r\n     * @param {string} color\r\n     * @public\r\n     */\r\n    public setColor(color: string) {\r\n        this._color = color;\r\n        this._billboard.color = color;\r\n    }\r\n\r\n    protected _getKmlFromUrl(url: string): Promise<Document> {\r\n        return new Promise<Document>((resolve, reject) => {\r\n            const request = new XMLHttpRequest();\r\n            request.open(\"GET\", url, true);\r\n            request.responseType = \"document\";\r\n            request.overrideMimeType(\"text/xml\");\r\n            request.onload = () => {\r\n                if (request.readyState === request.DONE && request.status === 200) {\r\n                    resolve(request.responseXML!);\r\n                } else {\r\n                    reject(new Error(\"no valid kml file\"));\r\n                }\r\n            };\r\n            request.send();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @param {string} url - Url of the KML to display. './myFile.kml' or 'http://mySite/myFile.kml' for example.\r\n     * @param {string} [color]\r\n     * @param {Billboard} [billboard]\r\n     * @returns {Promise<{entities: Entity[], extent: Extent}>}\r\n     */\r\n    public async addKmlFromUrl(url: string, color?: string, billboard?: Billboard | IBillboardParams): Promise<any> {\r\n        const kml = await this._getKmlFromUrl(url);\r\n        /*\r\n                const coordonates = this._extractCoordonatesFromKml(kml);\r\n                const { entities, extent } = this._convertCoordonatesIntoEntities(\r\n                    [coordonates],\r\n                    color || this._color,\r\n                    billboard || this._billboard\r\n                );\r\n        */\r\n        const {entities, extent} = this._convertKMLintoEntities(kml);\r\n\r\n        this._extent = this._expandExtents(this._extent, extent);\r\n\r\n        entities.forEach(this.add.bind(this));\r\n\r\n        return {entities, extent};\r\n    }\r\n}\r\n","import {XYZ} from \"./XYZ\";\r\nimport type {IXYZParams} from \"./XYZ\";\r\n\r\nexport class OpenStreetMap extends XYZ {\r\n    constructor(name: string | null, options: IXYZParams = {}) {\r\n        super(name || \"OpenStreetMap\", {\r\n            iconSrc: \"https://tile.openstreetmap.org/8/138/95.png\",\r\n            url: \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\r\n            attribution: 'Data @ OpenStreetMap contributors, ODbL',\r\n            isBaseLayer: true,\r\n            maxNativeZoom: 19,\r\n            defaultTextures: [{color: \"#AAD3DF\"}, {color: \"#F2EFE9\"}],\r\n            isSRGB: false,\r\n            shininess: 18,\r\n            specular: [0.00063, 0.00055, 0.00032],\r\n            ambient: [0.2, 0.2, 0.3],\r\n            diffuse: [0.9, 0.9, 0.7],\r\n            ...options\r\n        });\r\n    }\r\n}","import {XYZ} from \"./XYZ\";\r\nimport type {IXYZParams} from \"./XYZ\";\r\nimport {Segment} from \"../segment/Segment\";\r\nimport {stringTemplate} from \"../utils/shared\";\r\n\r\nfunction toQuadKey(x: number, y: number, z: number) {\r\n    var index = '';\r\n    for (let i = z; i > 0; i--) {\r\n        var b = 0;\r\n        var mask = 1 << (i - 1);\r\n        if ((x & mask) !== 0) b++;\r\n        if ((y & mask) !== 0) b += 2;\r\n        index += b.toString();\r\n    }\r\n    return index;\r\n}\r\n\r\nexport class Bing extends XYZ {\r\n    constructor(name: string | null, options: IXYZParams = {}) {\r\n        super(name || \"Bing\", {\r\n            iconSrc: \"https://ecn.t0.tiles.virtualearth.net/tiles/a120.jpeg?n=z&g=7146\",\r\n            subdomains: ['t0', 't1', 't2', 't3'],\r\n            url: \"https://ecn.{s}.tiles.virtualearth.net/tiles/a{quad}.jpeg?n=z&g=7146\",\r\n            isBaseLayer: true,\r\n            textureFilter: \"LINEAR\",\r\n            maxNativeZoom: 17,\r\n            defaultTextures: [{color: \"#001522\"}, {color: \"#E4E6F3\"}],\r\n            attribution: `<div style=\"transform: scale(0.8); margin-top:-2px;\"><a href=\"https://www.bing.com\" target=\"_blank\"><img style=\"position: relative; top: 2px;\" title=\"Bing Imagery\" src=\"https://sandcastle.cesium.com/CesiumUnminified/Assets/Images/bing_maps_credit.png\"></a> © 2021 Microsoft Corporation</div>`,\r\n            urlRewrite: (s: Segment, u: string) => {\r\n                return stringTemplate(u, {\r\n                    's': this._getSubdomain(),\r\n                    'quad': toQuadKey(s.tileX, s.tileY, s.tileZoom)\r\n                });\r\n            },\r\n            specular: [0.00063, 0.00055, 0.00032],\r\n            ambient: [0.35, 0.35, 0.35],\r\n            diffuse: [1.5, 1.5, 1.5],\r\n            shininess: 20,\r\n            nightTextureCoefficient: 2.7,\r\n            ...options\r\n        });\r\n    }\r\n}","import * as jd from \"./astro/jd\";\r\nimport {type EventsHandler, createEvents} from \"./Events\";\r\nimport type {JulianDate} from \"./astro/jd\";\r\nimport {Handler} from \"./webgl/Handler\";\r\n\r\ntype ClockEventsList = [\"tick\", \"end\", \"start\", \"stop\"];\r\n\r\nconst CLOCK_EVENTS: ClockEventsList = [\"tick\", \"end\", \"start\", \"stop\"];\r\n\r\nexport interface IClockParams {\r\n    name?: string;\r\n    startDate?: JulianDate;\r\n    endDate?: JulianDate;\r\n    currentDate?: JulianDate;\r\n    multiplier?: number;\r\n}\r\n\r\n/**\r\n * Class represents application timer that stores custom current julian datetime, and time speed multiplier.\r\n * @class\r\n * @param {Object} [params] - Clock parameters:\r\n * @param {JulianDate} [params.startDate=0.0] - Julian start date.\r\n * @param {JulianDate} [params.endDate=0.0] - Julian end date.\r\n * @param {JulianDate} [params.currentDate] - Julian current date. Default: current date.\r\n * @param {number} [params.multiplier=1.0] - Time speed multiplier.\r\n */\r\nclass Clock {\r\n    static __counter__: number = 0;\r\n    protected __id: number;\r\n    public __handler: Handler | null = null;\r\n\r\n    /**\r\n     * Clock events.\r\n     * @public\r\n     * @type {EventsHandler<ClockEventsList>}\r\n     */\r\n    public events: EventsHandler<ClockEventsList>;\r\n\r\n    /**\r\n     * Clock name.\r\n     * @public\r\n     * @type {string}\r\n     */\r\n    public name: string;\r\n\r\n    /**\r\n     * Start julian date clock loop.\r\n     * @public\r\n     * @type {JulianDate}\r\n     */\r\n    public startDate: JulianDate;\r\n\r\n    /**\r\n     * End julian date clock loop.\r\n     * @public\r\n     * @type {JulianDate}\r\n     */\r\n    public endDate: JulianDate;\r\n\r\n    /**\r\n     * Current julian datetime.\r\n     * @public\r\n     * @type {JulianDate}\r\n     */\r\n    public currentDate: JulianDate;\r\n\r\n    /**\r\n     * Animation frame delta time.\r\n     * @public\r\n     * @readonly\r\n     * @type {number}\r\n     */\r\n    public deltaTicks: number;\r\n\r\n    /**\r\n     * Timer activity.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public active: boolean = true;\r\n\r\n    /**\r\n     * Timer speed multiplier.\r\n     * @protected\r\n     * @type {number}\r\n     */\r\n    protected _multiplier: number;\r\n    protected _running: number;\r\n    protected _intervalDelay: number;\r\n    protected _intervalStart: number;\r\n    protected _intervalCallback: Function | null;\r\n\r\n\r\n    constructor(params: IClockParams = {}) {\r\n\r\n\r\n        this.__id = Clock.__counter__++;\r\n\r\n        this.events = createEvents<ClockEventsList>(CLOCK_EVENTS, this);\r\n\r\n        this.name = params.name || \"\";\r\n\r\n        this.startDate = params.startDate || 0;\r\n\r\n        this.endDate = params.endDate || 0;\r\n\r\n        let currentDate = params.currentDate || jd.DateToUTC(new Date());\r\n        if (params.startDate && currentDate < params.startDate) {\r\n            currentDate = params.startDate;\r\n        }\r\n        if (params.endDate && currentDate > params.endDate) {\r\n            currentDate = params.endDate;\r\n        }\r\n\r\n        this.currentDate = currentDate;\r\n\r\n        this._multiplier = params.multiplier !== undefined ? params.multiplier : 1.0;\r\n        this._running = 1;\r\n\r\n        this.deltaTicks = 0;\r\n\r\n        this.active = true;\r\n\r\n        this._intervalDelay = 0;\r\n        this._intervalStart = 0;\r\n        this._intervalCallback = null;\r\n    }\r\n\r\n    public clearInterval() {\r\n        this._intervalDelay = 0;\r\n        this._intervalStart = 0;\r\n        this._intervalCallback = null;\r\n    }\r\n\r\n    public setInterval(delay: number, callback: Function) {\r\n        this._intervalStart = this.currentDate;\r\n        this._intervalDelay = delay * jd.ONE_BY_MILLISECONDS_PER_DAY;\r\n        this._intervalCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Sets current clock datetime.\r\n     * @public\r\n     * @param {Object} date - JavaScript Date object.\r\n     */\r\n    public setDate(date: Date) {\r\n        let d = jd.DateToUTC(date);\r\n        if (this.startDate && d < this.startDate) {\r\n            d = this.startDate;\r\n        }\r\n        if (this.endDate && d > this.endDate) {\r\n            d = this.endDate;\r\n        }\r\n        this.currentDate = d;\r\n    }\r\n\r\n    /**\r\n     * Returns current application date.\r\n     * @public\r\n     * @returns {Date} - Current date.\r\n     */\r\n    public getDate(): Date {\r\n        return jd.UTCtoDate(this.currentDate);\r\n    }\r\n\r\n    public reset() {\r\n        if (this.startDate) {\r\n            this.currentDate = this.startDate;\r\n        }\r\n    }\r\n\r\n    public tick(dt: number) {\r\n        let m = this._multiplier * this._running;\r\n        this.deltaTicks = dt * m\r\n        if (this.active) {\r\n            let cd = jd.addMilliseconds(this.currentDate, this.deltaTicks);\r\n            if (m > 0) {\r\n                if (this.endDate && cd > this.endDate) {\r\n                    this.currentDate = this.startDate;\r\n                    this.events.dispatch(this.events.end, this);\r\n                } else {\r\n                    this.currentDate = cd;\r\n                }\r\n            } else {\r\n                if (this.startDate && cd < this.startDate) {\r\n                    this.currentDate = this.endDate;\r\n                    this.events.dispatch(this.events.end, this);\r\n                } else {\r\n                    this.currentDate = cd;\r\n                }\r\n            }\r\n\r\n            if (this._intervalCallback) {\r\n                if (this.currentDate - this._intervalStart >= this._intervalDelay) {\r\n                    this._intervalStart = this.currentDate;\r\n                    this._intervalCallback(this);\r\n                }\r\n            }\r\n\r\n            this.events.dispatch(this.events.tick, this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     * @param {Clock} clock - Clock instance to compare.\r\n     * @returns {boolean} - Returns true if a clock is the same instance.\r\n     */\r\n    public isEqual(clock: Clock) {\r\n        return this.__id === clock.__id;\r\n    }\r\n\r\n    public start() {\r\n        if (this._running === 0) {\r\n            this._running = 1;\r\n            this.events.dispatch(this.events.start, this);\r\n        }\r\n    }\r\n\r\n    public get multiplier(): number {\r\n        return this._multiplier;\r\n    }\r\n\r\n    public set multiplier(value: number) {\r\n        this._multiplier = value;\r\n    }\r\n\r\n    public stop() {\r\n        if (this._running === 1) {\r\n            this._running = 0;\r\n            this.events.dispatch(this.events.stop, this);\r\n        }\r\n    }\r\n}\r\n\r\nexport {Clock};\r\n","import {Handler} from \"./Handler\";\r\nimport type {WebGLBufferExt} from \"./Handler\";\r\nimport {Program} from \"./Program\";\r\n\r\n/**\r\n * This is shader program controller that used by handler object to access the shader\r\n * program capabilities, like switching program during the rendering.\r\n * Get access to the program from ...handler.programs.<program name> etc.\r\n * @class\r\n * @param {Handler} handler - Handler.\r\n * @param {Program} program - Shader program.\r\n */\r\nexport class ProgramController {\r\n\r\n    /**\r\n     * Handler.\r\n     * @protected\r\n     * @type {Handler}\r\n     */\r\n    protected _handler: Handler;\r\n\r\n    /**\r\n     * Shader program.\r\n     * @public\r\n     * @type {Program}\r\n     */\r\n    public _program: Program;\r\n\r\n    /**\r\n     * Program current frame activation flag.\r\n     * @public\r\n     * @type {boolean}\r\n     */\r\n    public _activated: boolean;\r\n\r\n    constructor(handler: Handler, program: Program) {\r\n        this._program = program;\r\n        this._handler = handler;\r\n        this._activated = false;\r\n    }\r\n\r\n    /**\r\n     * Lazy create program call.\r\n     * @public\r\n     */\r\n    public initialize() {\r\n        if (this._handler.gl) {\r\n            this._program.createProgram(this._handler.gl);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns controller's shader program.\r\n     * @public\r\n     * @return {Program} -\r\n     */\r\n    public getProgram(): Program {\r\n        return this._program;\r\n    }\r\n\r\n    /**\r\n     * Activates current shader program.\r\n     * @public\r\n     * @returns {ProgramController} -\r\n     */\r\n    public activate(): this {\r\n        if (!this._activated) {\r\n            this._handler.activeProgram!.deactivate();\r\n            this._handler.activeProgram = this;\r\n            let p = this._program;\r\n            this._activated = true;\r\n            p.enableAttribArrays();\r\n            p.use();\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Remove program from handler\r\n     * @public\r\n     */\r\n    public remove() {\r\n        let p = this._handler.programs;\r\n        if (p[this._program.name]) {\r\n            if (this._activated) {\r\n                this.deactivate();\r\n            }\r\n            this._program.delete();\r\n            delete p[this._program.name];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Deactivate shader program. This is not necessary while activate function used.\r\n     * @public\r\n     */\r\n    public deactivate() {\r\n        this._program.disableAttribArrays();\r\n        this._activated = false;\r\n    }\r\n\r\n    /**\r\n     * Returns program activity.\r\n     * @public\r\n     * @return {boolean} -\r\n     */\r\n    public isActive(): boolean {\r\n        return this._activated;\r\n    }\r\n\r\n    /**\r\n     * Sets program uniforms and attributes values and return controller instance.\r\n     * @public\r\n     * @param {Record<string, any>} params - Object with variable name and value like { value: 12, someArray:[1,2,3], uSampler: texture,... }\r\n     * @return {ProgramController} -\r\n     */\r\n    public set(params: Record<string, any>) {\r\n        this.activate();\r\n        this._program.set(params);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Draw index buffer with this program.\r\n     * @public\r\n     * @param {number} mode - Gl draw mode\r\n     * @param {WebGLBuffer} buffer - Buffer to draw.\r\n     * @return {ProgramController} Returns current shader controller instance.\r\n     */\r\n    public drawIndexBuffer(mode: number, buffer: WebGLBufferExt): ProgramController {\r\n        this._program.drawIndexBuffer(mode, buffer);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Calls Gl drawArray function.\r\n     * @param {number} mode - Gl draw mode.\r\n     * @param {number} numItems - draw items count.\r\n     * @return {ProgramController} Returns current shader controller instance.\r\n     */\r\n    public drawArrays(mode: number, numItems: number): ProgramController {\r\n        this._program.drawArrays(mode, numItems);\r\n        return this;\r\n    }\r\n}\r\n","class Node<T> {\r\n\r\n    public next: Node<T> | null;\r\n    public prev: Node<T> | null;\r\n    public data: T | null;\r\n\r\n    constructor() {\r\n        this.next = null;\r\n        this.prev = null;\r\n        this.data = null;\r\n    }\r\n}\r\n\r\n/**\r\n * @class Stack<T>\r\n * @param {number} [size=256] - Stack size\r\n */\r\nclass Stack<T> {\r\n\r\n    protected _current: Node<T>;\r\n    protected _head: Node<T>;\r\n\r\n    constructor(size: number = 256) {\r\n        this._current = new Node<T>();\r\n        this._head = this._current;\r\n\r\n        for (let i = 0; i < size; i++) {\r\n            let n = new Node<T>();\r\n            n.prev = this._current;\r\n            this._current.next = n;\r\n            this._current = n;\r\n        }\r\n        this._current = this._head;\r\n    }\r\n\r\n    public current(): Node<T> {\r\n        return this._current;\r\n    }\r\n\r\n    public push(data: T) {\r\n        this._current = this._current.next!;\r\n        this._current.data = data;\r\n    }\r\n\r\n    public pop(): T | null {\r\n        let res = this._current.data;\r\n        //this._current.data = null;\r\n        this._current = this._current.prev!;\r\n        return res;\r\n    }\r\n\r\n    public popPrev(): T | null {\r\n        this._current = this._current.prev!;\r\n        return this._current.data;\r\n    }\r\n}\r\n\r\nexport {Stack};\r\n","import {BaseFramebuffer} from \"./BaseFramebuffer\";\r\nimport {Clock} from \"../Clock\";\r\nimport {cons} from \"../cons\";\r\nimport {createEvents} from \"../Events\";\r\nimport type {EventsHandler} from \"../Events\";\r\nimport {getUrlParam, isEmpty} from \"../utils/shared\";\r\nimport type {TypedArray} from \"../utils/shared\";\r\nimport {ImageCanvas} from \"../ImageCanvas\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport type {NumberArray2} from \"../math/Vec2\";\r\nimport {ProgramController} from \"./ProgramController\";\r\nimport {Program} from \"./Program\";\r\nimport {Stack} from \"../Stack\";\r\nimport {throttle} from \"../utils/shared\";\r\n\r\nexport type WebGLContextExt = { type: string } & WebGL2RenderingContext;\r\nexport type WebGLBufferExt = { numItems: number; itemSize: number } & WebGLBuffer;\r\nexport type WebGLTextureExt = { default?: boolean } & WebGLTexture;\r\nexport type ImageSource = HTMLCanvasElement | ImageBitmap | ImageData | HTMLImageElement | HTMLVideoElement;\r\ntype CreateTextureFunc = (image: ImageSource, internalFormat?: number | null, texParami?: number | null, texture?: WebGLTextureExt) => WebGLTextureExt | null;\r\n\r\nexport interface IHandlerParameters {\r\n    anisotropy?: number;\r\n    width?: number;\r\n    height?: number;\r\n    pixelRatio?: number;\r\n    context?: {\r\n        stencil?: boolean;\r\n        alpha?: boolean;\r\n        antialias?: boolean;\r\n        premultipliedAlpha?: boolean;\r\n        preserveDrawingBuffer?: boolean;\r\n    },\r\n    extensions?: string[];\r\n    autoActivate?: boolean;\r\n}\r\n\r\nexport interface Texture3DParams {\r\n    nx: string,\r\n    px: string,\r\n    py: string,\r\n    ny: string,\r\n    pz: string,\r\n    nz: string\r\n}\r\n\r\nexport interface IDefaultTextureParams {\r\n    color?: string;\r\n    url?: string;\r\n}\r\n\r\nconst vendorPrefixes = [\"\", \"WEBKIT_\", \"MOZ_\"];\r\nconst CONTEXT_TYPE = [\"webgl2\", \"webgl\"];\r\n\r\n// Maximal mipmap levels\r\nconst MAX_LEVELS = 2;\r\n\r\n/**\r\n * @typedef {\"visibilitychange\" | \"resize\"} HandlerEventType\r\n */\r\n\r\n/**\r\n * A WebGL handler for accessing low-level WebGL capabilities.\r\n * @class\r\n * @param {string | HTMLCanvasElement} canvasTarget - Canvas element target.\r\n * or undefined creates hidden canvas and handler becomes hidden.\r\n * @param {Object} [params] - Handler options:\r\n * @param {number} [params.anisotropy] - Anisotropy filter degree. 8 is default.\r\n * @param {number} [params.width] - Hidden handler width. 256 is default.\r\n * @param {number} [params.height] - Hidden handler height. 256 is default.\r\n * @param {Array.<string>} [params.extensions] - Additional WebGL extension list. Available by default: EXT_texture_filter_anisotropic.\r\n */\r\nclass Handler {\r\n\r\n    protected _throttledDrawFrame: () => void\r\n\r\n    /**\r\n     * Events.\r\n     * @public\r\n     * @type {EventsHandler<Array<HandlerEventType>>}\r\n     */\r\n    public events: EventsHandler<[\"visibilitychange\", \"resize\"]>;\r\n\r\n    /**\r\n     * Application default timer.\r\n     * @public\r\n     * @type {Clock}\r\n     */\r\n    public defaultClock: Clock;\r\n\r\n    /**\r\n     * Custom timers.\r\n     * @protected\r\n     * @type{Clock[]}\r\n     */\r\n    protected _clocks: Clock[];\r\n\r\n    /**\r\n     * Draw frame time in milliseconds.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public deltaTime: number;\r\n    public prevDeltaTime: number;\r\n\r\n    /**\r\n     * WebGL rendering canvas element.\r\n     * @public\r\n     * @type {HTMLCanvasElement | null}\r\n     */\r\n    public canvas: HTMLCanvasElement | null;\r\n\r\n    /**\r\n     * WebGL context.\r\n     * @public\r\n     * @type {WebGLContextExt | null}\r\n     */\r\n    public gl: WebGLContextExt | null;\r\n\r\n    /**\r\n     * Shader program controller list.\r\n     * @public\r\n     * @type {Record<string, ProgramController>}\r\n     */\r\n    public programs: Record<string, ProgramController>;\r\n\r\n    /**\r\n     * Current active shader program controller.\r\n     * @public\r\n     * @type {ProgramController}\r\n     */\r\n    public activeProgram: ProgramController | null;\r\n\r\n    /**\r\n     * Handler parameters.\r\n     * @private\r\n     * @type {Object}\r\n     */\r\n    protected _params: {\r\n        anisotropy: number;\r\n        width: number;\r\n        height: number;\r\n        pixelRatio: number;\r\n        context: {\r\n            stencil?: boolean;\r\n            alpha?: boolean;\r\n            antialias?: boolean;\r\n            premultipliedAlpha?: boolean;\r\n            preserveDrawingBuffer?: boolean;\r\n        };\r\n        extensions: string[];\r\n    };\r\n\r\n    //public _oneByHeight: number;\r\n\r\n    /**\r\n     * Current WebGL extensions. Becomes here after context initialization.\r\n     * @public\r\n     * @type {Record<string, any>}\r\n     */\r\n    public extensions: Record<string, any>;\r\n\r\n    /**\r\n     * HTML Canvas target.\r\n     * @private\r\n     * @type {string | HTMLCanvasElement | undefined}\r\n     */\r\n    protected _canvasTarget: string | HTMLCanvasElement | undefined;\r\n\r\n    protected _lastAnimationFrameTime: number;\r\n\r\n    protected _initialized: boolean;\r\n\r\n    /**\r\n     * Animation frame function assigned from outside(Ex. from Renderer).\r\n     * @private\r\n     * @type {Function}\r\n     */\r\n    protected _frameCallback: Function;\r\n\r\n    protected _canvasSize: NumberArray2;\r\n\r\n    public transparentTexture: WebGLTextureExt | null;\r\n\r\n    public defaultTexture: WebGLTextureExt | null;\r\n\r\n    public framebufferStack = new Stack<BaseFramebuffer>();\r\n\r\n    public createTexture: Record<string, CreateTextureFunc>;\r\n\r\n    public createTextureDefault: CreateTextureFunc;\r\n\r\n    public ONCANVASRESIZE: Function | null;\r\n\r\n    public createTexture_n: CreateTextureFunc;\r\n    public createTexture_l: CreateTextureFunc;\r\n    public createTexture_mm: CreateTextureFunc;\r\n    public createTexture_a: CreateTextureFunc;\r\n\r\n    public intersectionObserver?: IntersectionObserver;\r\n    public resizeObserver?: ResizeObserver;\r\n\r\n    protected _requestAnimationFrameId: number = 0;\r\n\r\n    constructor(canvasTarget: string | HTMLCanvasElement | undefined, params: IHandlerParameters = {}) {\r\n\r\n        this.events = createEvents<[\"visibilitychange\", \"resize\"]>([\"visibilitychange\", \"resize\"]);\r\n\r\n        this._throttledDrawFrame = this.drawFrame;\r\n\r\n        this.defaultClock = new Clock();\r\n\r\n        this._clocks = [];\r\n\r\n        this.prevDeltaTime = 0;\r\n        this.deltaTime = 0;\r\n\r\n        this.canvas = null;\r\n\r\n        this.gl = null;\r\n\r\n        this.programs = {};\r\n\r\n        this.activeProgram = null;\r\n\r\n        this._canvasSize = [0, 0];\r\n\r\n        this._params = {\r\n            anisotropy: params.anisotropy || 4,\r\n            width: params.width || 256,\r\n            height: params.height || 256,\r\n            pixelRatio: getUrlParam('og_dpi') || params.pixelRatio || 1.0,\r\n            extensions: params.extensions || [],\r\n            context: params.context || {}\r\n        }\r\n\r\n        //this._oneByHeight = 1.0 / (this._params.height * this._params.pixelRatio);\r\n\r\n        this.extensions = {};\r\n\r\n        this._canvasTarget = canvasTarget;\r\n\r\n        this._lastAnimationFrameTime = 0;\r\n\r\n        this._initialized = false;\r\n\r\n        this._frameCallback = function () {\r\n        };\r\n\r\n        this.transparentTexture = null;\r\n\r\n        this.defaultTexture = null;\r\n\r\n        this.framebufferStack = new Stack();\r\n\r\n        this.createTexture_n = this.createTexture_n_webgl2.bind(this);\r\n        this.createTexture_l = this.createTexture_l_webgl2.bind(this);\r\n        this.createTexture_mm = this.createTexture_mm_webgl2.bind(this);\r\n        this.createTexture_a = this.createTexture_a_webgl2.bind(this);\r\n\r\n        this.createTexture = {\r\n            \"NEAREST\": this.createTexture_n,\r\n            \"LINEAR\": this.createTexture_l,\r\n            \"MIPMAP\": this.createTexture_mm,\r\n            \"ANISOTROPIC\": this.createTexture_a\r\n        };\r\n\r\n        this.createTextureDefault = this.createTexture_n;\r\n\r\n        this.ONCANVASRESIZE = null;\r\n\r\n        this._createCanvas();\r\n\r\n        if (params.autoActivate || isEmpty(params.autoActivate)) {\r\n            this.initialize();\r\n        }\r\n    }\r\n\r\n    public set frameDelay(delay: number) {\r\n        if (delay === 0) {\r\n            this._throttledDrawFrame = this.drawFrame;\r\n        } else {\r\n            this._throttledDrawFrame = throttle(this.drawFrame, delay);\r\n        }\r\n    }\r\n\r\n    public isInitialized(): boolean {\r\n        return this._initialized;\r\n    }\r\n\r\n    protected _createCanvas() {\r\n        if (this._canvasTarget) {\r\n            if (this._canvasTarget instanceof HTMLElement) {\r\n                this.canvas = this._canvasTarget;\r\n            } else {\r\n                this.canvas = (document.getElementById(this._canvasTarget) || document.querySelector(this._canvasTarget)) as HTMLCanvasElement;\r\n            }\r\n        } else {\r\n            this.canvas = document.createElement(\"canvas\");\r\n            this.canvas.width = this._params.width;\r\n            this.canvas.height = this._params.height;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * The return value is null if the extension is not supported, or an extension object otherwise.\r\n     * @param {WebGLRenderingContext | WebGL2RenderingContext | null} gl - WebGl context pointer.\r\n     * @param {string} name - Extension name.\r\n     * @returns {any} -\r\n     */\r\n    static getExtension(gl: WebGLRenderingContext | WebGL2RenderingContext | null, name: string): any | undefined {\r\n\r\n        if (!gl) return;\r\n\r\n        let i, ext;\r\n        for (i in vendorPrefixes) {\r\n            ext = gl.getExtension(vendorPrefixes[i] + name);\r\n            if (ext) {\r\n                return ext;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns a drawing context on the canvas, or null if the context identifier is not supported.\r\n     * @param {HTMLCanvasElement} canvas - HTML canvas object.\r\n     * @param {any} [contextAttributes] - See canvas.getContext contextAttributes.\r\n     * @returns {WebGLContextExt | null} -\r\n     */\r\n    static getContext(canvas: HTMLCanvasElement, contextAttributes?: any): WebGLContextExt | null {\r\n        let ctx: WebGLContextExt | null = null;\r\n\r\n        try {\r\n            let urlParams = new URLSearchParams(location.search);\r\n            let ver = urlParams.get('og_ver');\r\n            if (ver) {\r\n                ctx = canvas.getContext(ver, contextAttributes) as WebGLContextExt;\r\n                if (ctx) {\r\n                    ctx.type = ver;\r\n                }\r\n            } else {\r\n                for (let i = 0; i < CONTEXT_TYPE.length; i++) {\r\n                    ctx = canvas.getContext(CONTEXT_TYPE[i], contextAttributes) as WebGLContextExt;\r\n                    if (ctx) {\r\n                        ctx.type = CONTEXT_TYPE[i];\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        } catch (ex) {\r\n            cons.logErr(\"exception during the GL context initialization\");\r\n        }\r\n\r\n        if (!ctx) {\r\n            cons.logErr(\"could not initialise WebGL\");\r\n        }\r\n\r\n        return ctx;\r\n    }\r\n\r\n    /**\r\n     * Sets animation frame function.\r\n     * @public\r\n     * @param {Function} callback - Frame callback.\r\n     */\r\n    public setFrameCallback(callback: Function) {\r\n        callback && (this._frameCallback = callback);\r\n    }\r\n\r\n    /**\r\n     * Creates empty texture.\r\n     * @public\r\n     * @param {number} [width=1] - Specifies the width of the texture image.\r\n     * @param {number} [height=1] - Specifies the width of the texture image.\r\n     * @param {string} [filter=\"NEAREST\"] - Specifies GL_TEXTURE_MIN(MAX)_FILTER texture value.\r\n     * @param {string} [internalFormat=\"RGBA\"] - Specifies the color components in the texture.\r\n     * @param {string} [format=\"RGBA\"] - Specifies the format of the texel data.\r\n     * @param {string} [type=\"UNSIGNED_BYTE\"] - Specifies the data type of the texel data.\r\n     * @param {number} [level=0] - Specifies the level-of-detail number. Level 0 is the base image level. Level n is the nth mipmap reduction image.\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createEmptyTexture2DExt(\r\n        width: number = 1,\r\n        height: number = 1,\r\n        filter: string = \"NEAREST\",\r\n        internalFormat: string = \"RGBA\",\r\n        format: string = \"RGBA\",\r\n        type: string = \"UNSIGNED_BYTE\",\r\n        param: string = \"CLAMP_TO_EDGE\",\r\n        level: number = 0\r\n    ): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        let texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        gl.texImage2D(\r\n            gl.TEXTURE_2D,\r\n            level,\r\n            (gl as any)[internalFormat.toUpperCase()],\r\n            width,\r\n            height,\r\n            0,\r\n            (gl as any)[format.toUpperCase()],\r\n            (gl as any)[type.toUpperCase()],\r\n            null!\r\n        );\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, (gl as any)[filter.toUpperCase()]);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, (gl as any)[filter.toUpperCase()]);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, (gl as any)[param.toUpperCase()]);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, (gl as any)[param.toUpperCase()]);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates Empty NEAREST filtered texture.\r\n     * @public\r\n     * @param {number} width - Empty texture width.\r\n     * @param {number} height - Empty texture height.\r\n     * @param {number} [internalFormat]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createEmptyTexture_n(\r\n        width: number,\r\n        height: number,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null\r\n    ): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        let texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        gl.texImage2D(\r\n            gl.TEXTURE_2D,\r\n            0,\r\n            internalFormat || gl.RGBA,\r\n            width,\r\n            height,\r\n            0,\r\n            gl.RGBA,\r\n            gl.UNSIGNED_BYTE,\r\n            null!\r\n        );\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates empty LINEAR filtered texture.\r\n     * @public\r\n     * @param {number} width - Empty texture width.\r\n     * @param {number} height - Empty texture height.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createEmptyTexture_l(\r\n        width: number,\r\n        height: number,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null\r\n    ): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        let texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null!);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates NEAREST filter texture.\r\n     * @public\r\n     * @param {HTMLCanvasElement | Image} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture=null]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_n_webgl1(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates LINEAR filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_l_webgl1(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates MIPMAP filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_mm_webgl1(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates ANISOTROPY filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_a_webgl1(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\r\n        gl.texParameterf(gl.TEXTURE_2D, this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, this._params.anisotropy);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates NEAREST filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_n_webgl2(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n        gl.texStorage2D(gl.TEXTURE_2D, 1, internalFormat || gl.RGBA8, image.width, image.height);\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates LINEAR filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_l_webgl2(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n        gl.texStorage2D(gl.TEXTURE_2D, 1, internalFormat || gl.RGBA8, image.width, image.height);\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates MIPMAP filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_mm_webgl2(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n        gl.texStorage2D(gl.TEXTURE_2D, MAX_LEVELS, internalFormat || gl.RGBA8, image.width, image.height);\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates ANISOTROPY filter texture.\r\n     * @public\r\n     * @param {ImageSource} image - Image or Canvas object.\r\n     * @param {number} [internalFormat]\r\n     * @param {number} [texParami]\r\n     * @param {WebGLTexture | null} [texture]\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public createTexture_a_webgl2(\r\n        image: ImageSource,\r\n        internalFormat?: number | null,\r\n        texParami?: number | null,\r\n        texture: WebGLTexture | null = null): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        texture = texture || gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_2D, texture);\r\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\r\n        gl.texStorage2D(gl.TEXTURE_2D, MAX_LEVELS, internalFormat || gl.RGBA8, image.width, image.height);\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.generateMipmap(gl.TEXTURE_2D);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\r\n        gl.texParameterf(gl.TEXTURE_2D, this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, this._params.anisotropy);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, texParami || gl.CLAMP_TO_EDGE);\r\n        gl.bindTexture(gl.TEXTURE_2D, null!);\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Creates cube texture.\r\n     * @public\r\n     * @param {Texture3DParams} params - Face image urls:\r\n     * @param {string} params.px - Positive X or right image url.\r\n     * @param {string} params.nx - Negative X or left image url.\r\n     * @param {string} params.py - Positive Y or up image url.\r\n     * @param {string} params.ny - Negative Y or bottom image url.\r\n     * @param {string} params.pz - Positive Z or face image url.\r\n     * @param {string} params.nz - Negative Z or back image url.\r\n     * @returns {WebGLTexture | null} - WebGL texture object.\r\n     */\r\n    public loadCubeMapTexture(params: Texture3DParams): WebGLTexture | null {\r\n\r\n        let gl = this.gl!;\r\n\r\n        let texture = gl.createTexture();\r\n        gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\r\n        let faces: [string, number][] = [\r\n            [params.px, gl.TEXTURE_CUBE_MAP_POSITIVE_X],\r\n            [params.nx, gl.TEXTURE_CUBE_MAP_NEGATIVE_X],\r\n            [params.py, gl.TEXTURE_CUBE_MAP_POSITIVE_Y],\r\n            [params.ny, gl.TEXTURE_CUBE_MAP_NEGATIVE_Y],\r\n            [params.pz, gl.TEXTURE_CUBE_MAP_POSITIVE_Z],\r\n            [params.nz, gl.TEXTURE_CUBE_MAP_NEGATIVE_Z]\r\n        ];\r\n\r\n        let imageCanvas = new ImageCanvas();\r\n        imageCanvas.fillEmpty();\r\n        let emptyImage = imageCanvas.getImage();\r\n\r\n        for (let i = 0; i < faces.length; i++) {\r\n            let face = faces[i][1];\r\n            gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\r\n            //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n            gl.texImage2D(face, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, emptyImage);\r\n        }\r\n\r\n        for (let i = 0; i < faces.length; i++) {\r\n            let face = faces[i][1];\r\n            let image = new Image();\r\n            image.crossOrigin = \"\";\r\n            image.onload = (function (texture: WebGLTexture | null, face: number, image: HTMLImageElement) {\r\n                return function () {\r\n                    if (gl && texture) {\r\n                        gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\r\n                        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\r\n                        gl.texImage2D(face, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n                    }\r\n                };\r\n            })(texture, face, image);\r\n\r\n            image.src = faces[i][0];\r\n        }\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Adds shader program to the handler.\r\n     * @public\r\n     * @param {Program} program - Shader program.\r\n     * @param {boolean} [notActivate] - If it's true program will not compile.\r\n     * @return {Program} -\r\n     */\r\n    public addProgram(program: Program, notActivate: boolean = false): Program {\r\n        if (!this.programs[program.name]) {\r\n            let sc = new ProgramController(this, program);\r\n            this.programs[program.name] = sc;\r\n            this._initProgramController(sc);\r\n            if (notActivate) {\r\n                sc._activated = false;\r\n            }\r\n        } else {\r\n            console.warn(`Shader program: \"${program.name}\" already exists.`);\r\n        }\r\n        return program;\r\n    }\r\n\r\n    /**\r\n     * Removes shader program from handler.\r\n     * @public\r\n     * @param {string} name - Shader program name.\r\n     */\r\n    public removeProgram(name: string) {\r\n        this.programs[name] && this.programs[name].remove();\r\n    }\r\n\r\n    /**\r\n     * Adds shader programs to the handler.\r\n     * @public\r\n     * @param {Array.<Program>} programsArr - Shader program array.\r\n     */\r\n    public addPrograms(programsArr: Program[]) {\r\n        for (let i = 0; i < programsArr.length; i++) {\r\n            this.addProgram(programsArr[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Used in addProgram\r\n     * @protected\r\n     * @param {ProgramController} sc - Program controller\r\n     */\r\n    protected _initProgramController(sc: ProgramController) {\r\n        if (this._initialized) {\r\n            sc.initialize();\r\n            if (!this.activeProgram) {\r\n                this.activeProgram = sc;\r\n                sc.activate();\r\n            } else {\r\n                sc.deactivate();\r\n                this.activeProgram._program.enableAttribArrays();\r\n                this.activeProgram._program.use();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Used in init function.\r\n     * @private\r\n     */\r\n    protected _initPrograms() {\r\n        for (let p in this.programs) {\r\n            this._initProgramController(this.programs[p]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize additional WebGL extensions.\r\n     * @public\r\n     * @param {string} extensionStr - Extension name.\r\n     * @param {boolean} showLog - Show logging.\r\n     * @return {any} -\r\n     */\r\n    public initializeExtension(extensionStr: string, showLog: boolean = false): any {\r\n        if (!(this.extensions && this.extensions[extensionStr])) {\r\n            let ext = Handler.getExtension(this.gl, extensionStr);\r\n            if (ext) {\r\n                this.extensions[extensionStr] = ext;\r\n            } else if (showLog) {\r\n                console.warn(\r\n                    \"og.webgl.Handler: extension '\" + extensionStr + \"' doesn't initialize.\"\r\n                );\r\n            }\r\n        }\r\n        return this.extensions && this.extensions[extensionStr];\r\n    }\r\n\r\n    /**\r\n     * Main function that initialize handler.\r\n     * @public\r\n     */\r\n    public initialize() {\r\n\r\n        if (this._initialized) return;\r\n\r\n        if (!this.canvas) return;\r\n\r\n        this.gl = Handler.getContext(this.canvas, this._params.context);\r\n\r\n        if (!this.gl) return;\r\n\r\n        this._initialized = true;\r\n\r\n        /** Sets default extensions */\r\n        this._params.extensions.push(\"EXT_texture_filter_anisotropic\");\r\n\r\n        if (this.gl.type === \"webgl\") {\r\n            this._params.extensions.push(\"OES_standard_derivatives\");\r\n            this._params.extensions.push(\"OES_element_index_uint\");\r\n            this._params.extensions.push(\"WEBGL_depth_texture\");\r\n            this._params.extensions.push(\"ANGLE_instanced_arrays\");\r\n            //this._params.extensions.push(\"WEBGL_draw_buffers\");\r\n            //this._params.extensions.push(\"EXT_frag_depth\");\r\n        } else {\r\n            this._params.extensions.push(\"EXT_color_buffer_float\");\r\n            this._params.extensions.push(\"OES_texture_float_linear\");\r\n            //this._params.extensions.push(\"WEBGL_draw_buffers\");\r\n        }\r\n\r\n        let i = this._params.extensions.length;\r\n        while (i--) {\r\n            this.initializeExtension(this._params.extensions[i], true);\r\n        }\r\n\r\n        if (this.gl.type === \"webgl\") {\r\n            this.createTexture_n = this.createTexture_n_webgl1.bind(this);\r\n            this.createTexture_l = this.createTexture_l_webgl1.bind(this);\r\n            this.createTexture_mm = this.createTexture_mm_webgl1.bind(this);\r\n            this.createTexture_a = this.createTexture_a_webgl1.bind(this);\r\n        } else {\r\n            this.createTexture_n = this.createTexture_n_webgl2.bind(this);\r\n            this.createTexture_l = this.createTexture_l_webgl2.bind(this);\r\n            this.createTexture_mm = this.createTexture_mm_webgl2.bind(this);\r\n            this.createTexture_a = this.createTexture_a_webgl2.bind(this);\r\n        }\r\n\r\n        this.createTexture[\"NEAREST\"] = this.createTexture_n;\r\n        this.createTexture[\"LINEAR\"] = this.createTexture_l;\r\n        this.createTexture[\"MIPMAP\"] = this.createTexture_mm;\r\n        this.createTexture[\"ANISOTROPIC\"] = this.createTexture_a;\r\n\r\n        if (!this.extensions.EXT_texture_filter_anisotropic) {\r\n            this.createTextureDefault = this.createTexture_mm;\r\n        } else {\r\n            this.createTextureDefault = this.createTexture_a;\r\n        }\r\n\r\n        /** Initializing shaders and rendering parameters*/\r\n        this._initPrograms();\r\n        this._setDefaults();\r\n\r\n        this.intersectionObserver = new IntersectionObserver((entries) => {\r\n            this._toggleVisibilityChange(entries[entries.length - 1].isIntersecting);\r\n        }, {threshold: 0});\r\n\r\n        this.intersectionObserver.observe(this.canvas);\r\n\r\n        this.resizeObserver = new ResizeObserver(entries => {\r\n            this._toggleVisibilityChange(entries[0].contentRect.width !== 0 && entries[0].contentRect.height !== 0);\r\n        });\r\n\r\n        this.resizeObserver.observe(this.canvas);\r\n\r\n        document.addEventListener(\"visibilitychange\", () => {\r\n            this._toggleVisibilityChange(document.visibilityState === 'visible');\r\n        });\r\n    }\r\n\r\n    protected _toggleVisibilityChange(visibility: boolean) {\r\n        if (visibility) {\r\n            this.start();\r\n            this.ONCANVASRESIZE && this.ONCANVASRESIZE();\r\n            this.events.dispatch(this.events.visibilitychange, true);\r\n        } else {\r\n            this.events.dispatch(this.events.visibilitychange, false);\r\n            this.stop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets default gl render parameters. Used in init function.\r\n     * @protected\r\n     */\r\n    protected _setDefaults() {\r\n\r\n        let gl = this.gl;\r\n\r\n        if (!gl) return;\r\n        if (!this.canvas) return;\r\n\r\n        gl.depthFunc(gl.LESS);\r\n        gl.enable(gl.DEPTH_TEST);\r\n        this.setSize(\r\n            this.canvas.clientWidth || this._params.width,\r\n            this.canvas.clientHeight || this._params.height\r\n        );\r\n        gl.frontFace(gl.CCW);\r\n        gl.cullFace(gl.BACK);\r\n        gl.enable(gl.CULL_FACE);\r\n        gl.disable(gl.BLEND);\r\n        this.createDefaultTexture({color: \"rgba(0,0,0,0.0)\"}, (t: WebGLTextureExt) => {\r\n            this.transparentTexture = t;\r\n        });\r\n        this.createDefaultTexture({color: \"rgba(255, 255, 255, 1.0)\"}, (t: WebGLTextureExt) => {\r\n            this.defaultTexture = t;\r\n        });\r\n    }\r\n\r\n    public getCanvasSize(): NumberArray2 {\r\n        return this._canvasSize;\r\n    }\r\n\r\n    /**\r\n     * Creates STREAM_DRAW ARRAY buffer.\r\n     * @public\r\n     * @param {number} itemSize - Array item size.\r\n     * @param {number} numItems - Items quantity.\r\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\r\n     * @param {number} [bytes=4] -\r\n     * @return {WebGLBufferExt} -\r\n     */\r\n    public createStreamArrayBuffer(itemSize: number, numItems: number, usage?: number, bytes: number = 4): WebGLBufferExt {\r\n        let gl = this.gl!;\r\n        let buffer: WebGLBufferExt = gl.createBuffer() as WebGLBufferExt;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n        gl.bufferData(\r\n            gl.ARRAY_BUFFER,\r\n            numItems * itemSize * bytes,\r\n            usage || gl.STREAM_DRAW\r\n        );\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null!);\r\n        buffer.itemSize = itemSize;\r\n        buffer.numItems = numItems;\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * Sets stream buffer.\r\n     * @public\r\n     * @param {WebGLBufferExt} buffer -\r\n     * @param {TypedArray} array -\r\n     * @param {number} [offset=0] -\r\n     * @return {WebGLBufferExt} -\r\n     */\r\n    public setStreamArrayBuffer(buffer: WebGLBufferExt, array: TypedArray, offset: number = 0): WebGLBufferExt {\r\n        let gl = this.gl!;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n        gl.bufferSubData(gl.ARRAY_BUFFER, offset, array);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null!);\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * Creates ARRAY buffer.\r\n     * @public\r\n     * @param {TypedArray} array - Input array.\r\n     * @param {number} itemSize - Array item size.\r\n     * @param {number} numItems - Items quantity.\r\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\r\n     * @return {WebGLBufferExt} -\r\n     */\r\n    public createArrayBuffer(array: TypedArray, itemSize: number, numItems: number, usage?: number): WebGLBufferExt {\r\n        let gl = this.gl!;\r\n        let buffer: WebGLBufferExt = gl.createBuffer() as WebGLBufferExt;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, array, usage || gl.STATIC_DRAW);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null!);\r\n        buffer.itemSize = itemSize;\r\n        buffer.numItems = numItems;\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * Creates ARRAY buffer specific length.\r\n     * @public\r\n     * @param {number} size -\r\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\r\n     * @return {WebGLBufferExt} -\r\n     */\r\n    public createArrayBufferLength(size: number, usage?: number): WebGLBufferExt {\r\n        let gl = this.gl!;\r\n        let buffer: WebGLBufferExt = gl.createBuffer() as WebGLBufferExt;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n        gl.bufferData(gl.ARRAY_BUFFER, size, usage || gl.STATIC_DRAW);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null!);\r\n        buffer.itemSize = 1;\r\n        buffer.numItems = size;\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * Creates ELEMENT ARRAY buffer.\r\n     * @public\r\n     * @param {TypedArray} array - Input array.\r\n     * @param {number} itemSize - Array item size.\r\n     * @param {number} numItems - Items quantity.\r\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\r\n     * @return {Object} -\r\n     */\r\n    public createElementArrayBuffer(array: TypedArray, itemSize: number, numItems?: number, usage?: number): WebGLBufferExt {\r\n        let gl = this.gl!;\r\n        let buffer = gl.createBuffer() as WebGLBufferExt;\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, array, usage || gl.STATIC_DRAW);\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null!);\r\n        buffer.itemSize = itemSize;\r\n        buffer.numItems = numItems || array.length;\r\n        return buffer;\r\n    }\r\n\r\n    /**\r\n     * Sets handler canvas size.\r\n     * @public\r\n     * @param {number} w - Canvas width.\r\n     * @param {number} h - Canvas height.\r\n     */\r\n    public setSize(w: number, h: number) {\r\n        this._params.width = w;\r\n        this._params.height = h;\r\n        if (this.canvas) {\r\n            this.canvas.width = w * this._params.pixelRatio;\r\n            this.canvas.height = h * this._params.pixelRatio;\r\n\r\n            this._canvasSize[0] = this.canvas.width;\r\n            this._canvasSize[1] = this.canvas.height;\r\n\r\n            //this._oneByHeight = 1.0 / this.canvas.height;\r\n\r\n            this.gl && this.gl.viewport(0, 0, w, h);\r\n            this.ONCANVASRESIZE && this.ONCANVASRESIZE(this.canvas);\r\n            this.events.dispatch(this.events.resize, this);\r\n        }\r\n    }\r\n\r\n    public get pixelRatio(): number {\r\n        return this._params.pixelRatio;\r\n    }\r\n\r\n    public set pixelRatio(pr: number) {\r\n        this._params.pixelRatio = pr;\r\n        this.setSize(this._params.width, this._params.height);\r\n    }\r\n\r\n    /**\r\n     * Returns context screen width.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getWidth(): number {\r\n        return this.canvas ? this.canvas.width : 0;\r\n    }\r\n\r\n    /**\r\n     * Returns context screen height.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getHeight(): number {\r\n        return this.canvas ? this.canvas.height : 0;\r\n    }\r\n\r\n    /**\r\n     * Returns canvas aspect ratio.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getClientAspect(): number {\r\n        return this.canvas ? this.canvas.clientWidth / this.canvas.clientHeight : 0;\r\n    }\r\n\r\n    /**\r\n     * Returns canvas center coordinates.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getCenter(): Vec2 {\r\n        let c = this.canvas;\r\n        return c ? new Vec2(Math.round(c.width * 0.5), Math.round(c.height * 0.5)) : new Vec2();\r\n    }\r\n\r\n    /**\r\n     * Draw single frame.\r\n     * @public\r\n     */\r\n    public drawFrame = () => {\r\n        /** Calculating frame time */\r\n        let now = window.performance.now();\r\n        let prevDeltaTime = this.deltaTime;\r\n        //Make some filter:)\r\n        this.deltaTime = (now - this._lastAnimationFrameTime + this.prevDeltaTime) * 0.5;\r\n        if (this.deltaTime > 3) {\r\n            this.deltaTime = 3;\r\n        } else if (this.deltaTime < 1) {\r\n            this.deltaTime = 1;\r\n        }\r\n        this.prevDeltaTime = prevDeltaTime;\r\n        this._lastAnimationFrameTime = now;\r\n\r\n        this.defaultClock.tick(this.deltaTime);\r\n\r\n        for (let i = 0; i < this._clocks.length; i++) {\r\n            this._clocks[i].tick(this.deltaTime);\r\n        }\r\n\r\n        /** Canvas resize checking */\r\n        let canvas = this.canvas!;\r\n\r\n        if (Math.floor(canvas.clientWidth * this._params.pixelRatio) !== canvas.width || Math.floor(canvas.clientHeight * this._params.pixelRatio) !== canvas.height) {\r\n            if (canvas.clientWidth === 0 || canvas.clientHeight === 0) {\r\n                this.stop();\r\n            } else if (!document.hidden) {\r\n                this.start();\r\n                this.setSize(canvas.clientWidth, canvas.clientHeight);\r\n            }\r\n        }\r\n\r\n        /** Draw frame */\r\n        this._frameCallback();\r\n    }\r\n\r\n    /**\r\n     * Clearing gl frame.\r\n     * @public\r\n     */\r\n    public clearFrame() {\r\n        let gl = this.gl!;\r\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n    }\r\n\r\n    /**\r\n     * Starts animation loop.\r\n     * @public\r\n     */\r\n    public start() {\r\n        if (!this._requestAnimationFrameId && this._initialized) {\r\n            this._animationFrameCallback();\r\n        }\r\n    }\r\n\r\n    public stop() {\r\n        if (this._requestAnimationFrameId) {\r\n            window.cancelAnimationFrame(this._requestAnimationFrameId);\r\n            this._requestAnimationFrameId = 0;\r\n        }\r\n    }\r\n\r\n    public isStopped(): boolean {\r\n        return !this._requestAnimationFrameId;\r\n    }\r\n\r\n    /**\r\n     * Check is gl context type equals webgl2\r\n     * @public\r\n     */\r\n    public isWebGl2(): boolean {\r\n        return this.gl ? this.gl.type === \"webgl2\" : false;\r\n    }\r\n\r\n    /**\r\n     * Make animation.\r\n     * @protected\r\n     */\r\n    protected _animationFrameCallback() {\r\n        this._requestAnimationFrameId = window.requestAnimationFrame(() => {\r\n            this._throttledDrawFrame();\r\n            this._requestAnimationFrameId && this._animationFrameCallback();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Creates default texture object.\r\n     * @public\r\n     * @param {IDefaultTextureParams | null} params - Texture parameters.\r\n     * @param {function(WebGLTextureExt): void} [success] - Creation callback.\r\n     */\r\n    public createDefaultTexture(params: IDefaultTextureParams | null, success: (texture: WebGLTextureExt) => void) {\r\n\r\n        let imgCnv;\r\n        let texture;\r\n\r\n        if (params && params.color) {\r\n            imgCnv = new ImageCanvas(2, 2);\r\n            imgCnv.fillColor(params.color);\r\n            texture = this.createTexture_n(imgCnv.getCanvas())!;\r\n            texture.default = true;\r\n            success(texture);\r\n        } else if (params && params.url) {\r\n            let img = new Image();\r\n            let that = this;\r\n            img.onload = function () {\r\n                texture = that.createTextureDefault(img)!;\r\n                texture.default = true;\r\n                success(texture);\r\n            };\r\n            img.src = params.url;\r\n        } else {\r\n            imgCnv = new ImageCanvas(2, 2);\r\n            imgCnv.fillColor(\"#C5C5C5\");\r\n            texture = this.createTexture_n(imgCnv.getCanvas())!;\r\n            texture.default = true;\r\n            success(texture);\r\n        }\r\n    }\r\n\r\n    public deleteTexture(texture: WebGLTextureExt | null | undefined) {\r\n        if (texture && !texture.default) {\r\n            this.gl!.deleteTexture(texture);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @public\r\n     */\r\n    public destroy() {\r\n\r\n        this.resizeObserver?.disconnect();\r\n        this.intersectionObserver?.disconnect();\r\n\r\n        this.stop();\r\n\r\n        //\r\n        // Dispose shaders\r\n        //\r\n        for (let p in this.programs) {\r\n            this.removeProgram(p);\r\n        }\r\n\r\n        //\r\n        // Clear WebGL context\r\n        //\r\n        let gl = this.gl;\r\n\r\n        if (gl) {\r\n            gl.deleteTexture(this.transparentTexture as WebGLTexture);\r\n            this.transparentTexture = null;\r\n\r\n            gl.deleteTexture(this.defaultTexture as WebGLTexture);\r\n            this.defaultTexture = null;\r\n\r\n            this.framebufferStack = new Stack();\r\n\r\n            //\r\n            // Clear attrib pointers\r\n            //\r\n            let numAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\r\n            let tmp = gl.createBuffer();\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, tmp);\r\n            for (let ii = 0; ii < numAttribs; ++ii) {\r\n                gl.disableVertexAttribArray(ii);\r\n                gl.vertexAttribPointer(ii, 4, gl.FLOAT, false, 0, 0);\r\n                gl.vertexAttrib1f(ii, 0);\r\n            }\r\n            gl.deleteBuffer(tmp);\r\n\r\n            //\r\n            // Clear all possible textures\r\n            //\r\n            let numTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\r\n            for (let ii = 0; ii < numTextureUnits; ++ii) {\r\n                gl.activeTexture(gl.TEXTURE0 + ii);\r\n                gl.bindTexture(gl.TEXTURE_CUBE_MAP, null!);\r\n                gl.bindTexture(gl.TEXTURE_2D, null!);\r\n            }\r\n\r\n            //\r\n            // Hard reset\r\n            //\r\n            gl.activeTexture(gl.TEXTURE0);\r\n            gl.useProgram(null!);\r\n            gl.bindBuffer(gl.ARRAY_BUFFER, null!);\r\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null!);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null!);\r\n            gl.disable(gl.BLEND);\r\n            gl.disable(gl.CULL_FACE);\r\n            gl.disable(gl.DEPTH_TEST);\r\n            gl.disable(gl.DITHER);\r\n            gl.disable(gl.SCISSOR_TEST);\r\n            gl.blendColor(0, 0, 0, 0);\r\n            gl.blendEquation(gl.FUNC_ADD);\r\n            gl.blendFunc(gl.ONE, gl.ZERO);\r\n            gl.clearColor(0, 0, 0, 0);\r\n            gl.clearDepth(1);\r\n            gl.clearStencil(-1);\r\n        }\r\n\r\n        //\r\n        // Destroy canvas\r\n        //\r\n        if (this.canvas) {\r\n            if (this.canvas.parentNode) {\r\n                this.canvas.parentNode.removeChild(this.canvas);\r\n            }\r\n            this.canvas.width = 1;\r\n            this.canvas.height = 1;\r\n            this.canvas = null;\r\n        }\r\n\r\n        this.gl = null;\r\n\r\n        this._initialized = false;\r\n    }\r\n\r\n    public addClock(clock: Clock) {\r\n        if (!clock.__handler) {\r\n            clock.__handler = this;\r\n            this._clocks.push(clock);\r\n        }\r\n    }\r\n\r\n    public addClocks(clockArr: Clock[]) {\r\n        for (let i = 0; i < clockArr.length; i++) {\r\n            this.addClock(clockArr[i]);\r\n        }\r\n    }\r\n\r\n    public removeClock(clock: Clock) {\r\n        if (clock.__handler) {\r\n            let c = this._clocks;\r\n            let i = c.length;\r\n            while (i--) {\r\n                if (c[i].isEqual(clock)) {\r\n                    clock.__handler = null;\r\n                    c.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // var loadTextureData = function(textureName, callback) {\r\n    //     const xhr = new XMLHttpRequest();\r\n    //     xhr.open('GET', textureName);\r\n    //     xhr.responseType = 'arraybuffer';\r\n    //     xhr.onload = (event) => {\r\n    //         const data = new DataView(xhr.response);\r\n    //         const array =\r\n    //             new Float32Array(data.byteLength / Float32Array.BYTES_PER_ELEMENT);\r\n    //         for (let i = 0; i < array.length; ++i) {\r\n    //             array[i] = data.getFloat32(i * Float32Array.BYTES_PER_ELEMENT, true);\r\n    //         }\r\n    //         callback(array);\r\n    //     };\r\n    //     xhr.send();\r\n    // }\r\n\r\n    // loadTextureData('transmittance.dat', (data) => {\r\n    //\r\n    //     let gl = this.renderer.handler.gl;\r\n    //\r\n    //     const texture = gl.createTexture();\r\n    //     gl.activeTexture(gl.TEXTURE0);\r\n    //     gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    //     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n    //     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n    //     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n    //     gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n    //     gl.texImage2D(gl.TEXTURE_2D, 0, gl.getExtension('OES_texture_float_linear') ? gl.RGBA32F : gl.RGBA16F,\r\n    //         TRANSMITTANCE_TEXTURE_WIDTH, TRANSMITTANCE_TEXTURE_HEIGHT, 0, gl.RGBA,\r\n    //         gl.FLOAT, data);\r\n    //\r\n    //     this.transmittanceTextureBrn = texture;\r\n    // });\r\n}\r\n\r\nexport {Handler};\r\n","import {BaseFramebuffer} from \"./BaseFramebuffer\";\r\nimport type {IBaseFramebufferParams} from \"./BaseFramebuffer\";\r\nimport {Handler} from \"./Handler\";\r\n\r\ninterface IMultisampleParams extends IBaseFramebufferParams {\r\n    msaa?: number;\r\n    internalFormat?: string;\r\n}\r\n\r\n/**\r\n * Class represents multisample framebuffer.\r\n * @class\r\n * @param {Handler} handler - WebGL handler.\r\n * @param {Object} [options] - Framebuffer options:\r\n */\r\nexport class Multisample extends BaseFramebuffer {\r\n    protected _internalFormat: string;\r\n\r\n    protected _msaa: number;\r\n\r\n    protected _glFilter: number;\r\n\r\n    public renderbuffers: WebGLRenderbuffer[];\r\n\r\n    constructor(handler: Handler, options: IMultisampleParams = {}) {\r\n\r\n        super(handler, options);\r\n\r\n        this._internalFormat = options.internalFormat ? options.internalFormat.toUpperCase() : \"RGBA8\";\r\n\r\n        this._msaa = options.msaa != undefined ? options.msaa : 4;\r\n\r\n        this._glFilter = 0;\r\n\r\n        this.renderbuffers = new Array(this._size);\r\n    }\r\n\r\n    public override destroy() {\r\n        let gl = this.handler.gl;\r\n\r\n        if (!gl) return;\r\n\r\n        for (let i = 0; i < this.renderbuffers.length; i++) {\r\n            gl.deleteRenderbuffer(this.renderbuffers[i]);\r\n        }\r\n        this.renderbuffers = new Array(this._size);\r\n\r\n        gl.deleteFramebuffer(this._fbo);\r\n        gl.deleteRenderbuffer(this._depthRenderbuffer);\r\n\r\n        this._depthRenderbuffer = null;\r\n        this._fbo = null;\r\n\r\n        this._active = false;\r\n    }\r\n\r\n    /**\r\n     * Framebuffer initialization.\r\n     * @public\r\n     */\r\n    public override init() {\r\n        let gl = this.handler.gl;\r\n\r\n        if (!gl) return;\r\n\r\n        this._glFilter = (gl as any)[this._filter];\r\n\r\n        this._fbo = gl.createFramebuffer();\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\r\n\r\n        let colorAttachments = [];\r\n        for (let i = 0; i < this.renderbuffers.length; i++) {\r\n            let rb = gl.createRenderbuffer();\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, rb);\r\n\r\n            if (this._msaa > 0) {\r\n                gl.renderbufferStorageMultisample(\r\n                    gl.RENDERBUFFER,\r\n                    this._msaa,\r\n                    (gl as any)[this._internalFormat],\r\n                    this._width,\r\n                    this._height\r\n                );\r\n            } else {\r\n                gl.renderbufferStorage(\r\n                    gl.RENDERBUFFER,\r\n                    (gl as any)[this._internalFormat],\r\n                    this._width,\r\n                    this._height\r\n                );\r\n            }\r\n\r\n            gl.framebufferRenderbuffer(\r\n                gl.FRAMEBUFFER,\r\n                gl.COLOR_ATTACHMENT0 + i,\r\n                gl.RENDERBUFFER,\r\n                rb\r\n            );\r\n            colorAttachments.push(gl.COLOR_ATTACHMENT0 + i);\r\n            this.renderbuffers[i] = rb!;\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null!);\r\n        }\r\n        gl.drawBuffers(colorAttachments);\r\n\r\n        if (this._useDepth) {\r\n            this._depthRenderbuffer = gl.createRenderbuffer();\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this._depthRenderbuffer);\r\n            gl.renderbufferStorageMultisample(\r\n                gl.RENDERBUFFER,\r\n                this._msaa,\r\n                (gl as any)[this._depthComponent],\r\n                this._width,\r\n                this._height\r\n            );\r\n            gl.framebufferRenderbuffer(\r\n                gl.FRAMEBUFFER,\r\n                gl.DEPTH_ATTACHMENT,\r\n                gl.RENDERBUFFER,\r\n                this._depthRenderbuffer\r\n            );\r\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n        }\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n    }\r\n\r\n    public blitTo(framebuffer: BaseFramebuffer, attachmentIndex: number = 0) {\r\n        let gl = this.handler.gl!;\r\n\r\n        gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this._fbo);\r\n        gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, framebuffer._fbo);\r\n        gl.readBuffer(gl.COLOR_ATTACHMENT0 + attachmentIndex);\r\n\r\n        gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 0.0, 1.0]);\r\n\r\n        gl.blitFramebuffer(\r\n            0,\r\n            0,\r\n            this._width,\r\n            this._height,\r\n            0,\r\n            0,\r\n            framebuffer._width,\r\n            framebuffer._height,\r\n            gl.COLOR_BUFFER_BIT,\r\n            this._glFilter\r\n        );\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        gl.bindFramebuffer(gl.READ_FRAMEBUFFER, null);\r\n        gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\r\n    }\r\n}\r\n","import {input} from './input';\r\nimport {stamp} from \"../utils/shared\";\r\nimport type {EventCallback, EventCallbackStamp} from \"../Events\";\r\n\r\nconst STAMP_SPACER = \"_\";\r\n\r\ninterface ICallbackHandler {\r\n    callback: EventCallbackStamp,\r\n    sender: any,\r\n    priority: number\r\n}\r\n\r\nconst _sortByPriority = function (a: ICallbackHandler, b: ICallbackHandler): number {\r\n    return Number(a.priority < b.priority);\r\n};\r\n\r\nclass KeyboardHandler {\r\n    protected _currentlyPressedKeys: Record<number, boolean>;\r\n    protected _pressedKeysCallbacks: Record<number, ICallbackHandler[]>;\r\n    protected _unpressedKeysCallbacks: Record<number, ICallbackHandler[]>;\r\n    protected _charkeysCallbacks: Record<number, ICallbackHandler[]>;\r\n    protected _anykeyCallback: any;\r\n    protected _event: KeyboardEvent | null;\r\n    protected _active: boolean;\r\n    protected _stampCache: Record<string, number>;\r\n\r\n    constructor() {\r\n        this._currentlyPressedKeys = {};\r\n        this._pressedKeysCallbacks = {};\r\n        this._unpressedKeysCallbacks = {};\r\n        this._charkeysCallbacks = {};\r\n        this._anykeyCallback = null;\r\n        this._event = null;\r\n        this._active = true;\r\n        this._stampCache = {};\r\n\r\n        document.onkeydown = (event: KeyboardEvent) => {\r\n            this._event = event;\r\n            this._active && this.handleKeyDown();\r\n        };\r\n\r\n        document.onkeyup = (event: KeyboardEvent) => {\r\n            this._event = event;\r\n            this._active && this.handleKeyUp();\r\n        };\r\n    }\r\n\r\n    public getcurrentlyPressedKeys(): Record<number, boolean> {\r\n        return this._currentlyPressedKeys;\r\n    }\r\n\r\n    public getPressedKeysCallbacks() {\r\n        return this._pressedKeysCallbacks;\r\n    }\r\n\r\n    public getUnpressedKeysCallbacks() {\r\n        return this._unpressedKeysCallbacks;\r\n    }\r\n\r\n    public getCharkeysCallbacks() {\r\n        return this._charkeysCallbacks;\r\n    }\r\n\r\n    public removeEvent(event: string, keyCode: number, callback: EventCallback) {\r\n        let st = this._getStamp(event, keyCode, (callback as EventCallbackStamp)._openglobus_id!);\r\n        if ((callback as EventCallbackStamp)._openglobus_id && this._stampCache[st]) {\r\n            //this._stampCache[st] = null;\r\n            delete this._stampCache[st];\r\n\r\n            if (event === \"keypress\") {\r\n                this._removeCallback(this._pressedKeysCallbacks[keyCode], callback);\r\n            } else if (event === \"keyfree\") {\r\n                this._removeCallback(this._unpressedKeysCallbacks[keyCode], callback);\r\n            } else if (event === \"charkeypress\") {\r\n                this._removeCallback(this._charkeysCallbacks[keyCode], callback);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _removeCallback(handlers: ICallbackHandler[], callback: EventCallbackStamp) {\r\n        for (let i = 0; i < handlers.length; i++) {\r\n            if (handlers[i].callback._openglobus_id === callback._openglobus_id) {\r\n                handlers.splice(i, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _getStamp(name: string, keyCode: number, ogid: number) {\r\n        return `${name}${STAMP_SPACER}${keyCode}${STAMP_SPACER}${ogid}`;\r\n    }\r\n\r\n    protected _stamp(name: string, keyCode: number, obj: any) {\r\n        const ogid = stamp(obj);\r\n        const st = this._getStamp(name, keyCode, ogid);\r\n        if (!this._stampCache[st]) {\r\n            this._stampCache[st] = ogid;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public setActivity(activity: boolean) {\r\n        this._active = activity;\r\n    }\r\n\r\n    public releaseKeys() {\r\n        this._currentlyPressedKeys = {};\r\n    }\r\n\r\n    public addEvent(event: string, keyCode: number, callback: EventCallback, sender?: any, priority?: number) {\r\n\r\n        // Event is already bound with the callback\r\n        if (!this._stamp(event, keyCode, callback)) return;\r\n\r\n        if (priority === undefined) {\r\n            priority = 1600;\r\n        }\r\n        switch (event) {\r\n            case \"keyfree\":\r\n                if (!this._unpressedKeysCallbacks[keyCode]) {\r\n                    this._unpressedKeysCallbacks[keyCode] = [];\r\n                }\r\n                this._unpressedKeysCallbacks[keyCode].push({callback: callback, sender: sender, priority: priority});\r\n                this._unpressedKeysCallbacks[keyCode].sort(_sortByPriority);\r\n                break;\r\n\r\n            case \"keypress\":\r\n                if (keyCode == null) {\r\n                    this._anykeyCallback = {callback: callback, sender: sender || this};\r\n                } else {\r\n                    if (!this._pressedKeysCallbacks[keyCode]) {\r\n                        this._pressedKeysCallbacks[keyCode] = [];\r\n                    }\r\n                    this._pressedKeysCallbacks[keyCode].push({callback: callback, sender: sender, priority: priority});\r\n                    this._pressedKeysCallbacks[keyCode].sort(_sortByPriority);\r\n                }\r\n                break;\r\n\r\n            case \"charkeypress\":\r\n                if (!this._charkeysCallbacks[keyCode]) {\r\n                    this._charkeysCallbacks[keyCode] = [];\r\n                }\r\n                this._charkeysCallbacks[keyCode].push({callback: callback, sender: sender, priority: priority});\r\n                this._charkeysCallbacks[keyCode].sort(_sortByPriority);\r\n                break;\r\n        }\r\n    }\r\n\r\n    public isKeyPressed(keyCode: number) {\r\n        return this._currentlyPressedKeys[keyCode];\r\n    }\r\n\r\n    public handleKeyDown() {\r\n        // If you want to get a key code just uncomment and check console\r\n        //console.log(this._event!.keyCode);\r\n        this._anykeyCallback && this._anykeyCallback.callback.call(this._anykeyCallback.sender, this._event);\r\n        this._currentlyPressedKeys[this._event!.keyCode] = true;\r\n        for (let ch in this._charkeysCallbacks) {\r\n            if (String.fromCharCode(this._event!.keyCode) === String.fromCharCode(Number(ch))) {\r\n                let ccl = this._charkeysCallbacks[ch];\r\n                for (let i = 0; i < ccl.length; i++) {\r\n                    (ccl[i].callback as Function).call(ccl[i].sender, this._event);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._event!.keyCode == input.KEY_ALT || this._event!.keyCode == input.KEY_SHIFT) {\r\n            this._event!.preventDefault();\r\n        }\r\n    }\r\n\r\n    public handleKeyUp() {\r\n        if (this._currentlyPressedKeys[this._event!.keyCode] || this._event!.keyCode === input.KEY_PRINTSCREEN) {\r\n            for (let pk in this._unpressedKeysCallbacks) {\r\n                if (this._currentlyPressedKeys[pk] || this._event!.keyCode === input.KEY_PRINTSCREEN && Number(pk) === input.KEY_PRINTSCREEN) {\r\n                    let cpk = this._unpressedKeysCallbacks[pk];\r\n                    for (let i = 0; i < cpk.length; i++) {\r\n                        (cpk[i].callback as Function).call(cpk[i].sender, this._event);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this._currentlyPressedKeys[this._event!.keyCode] = false;\r\n    }\r\n\r\n    public handleEvents() {\r\n        for (let pk in this._pressedKeysCallbacks) {\r\n            if (this._currentlyPressedKeys[pk]) {\r\n                let cpk = this._pressedKeysCallbacks[pk];\r\n                for (let i = 0; i < cpk.length; i++) {\r\n                    (cpk[i].callback as Function).call(cpk[i].sender, this._event);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {KeyboardHandler};\r\n","export type MouseEventExt = MouseEvent & { wheelDelta?: number; deltaY?: number; isTouchPad?: boolean };\r\n\r\nexport interface MouseHandlerEvent {\r\n    button?: number;\r\n    clientX: number;\r\n    clientY: number;\r\n}\r\n\r\ntype MouseHandlerEventCallback = (sys: MouseEvent, event?: MouseHandlerEvent) => void;\r\n\r\nfunction _checkTouchPad(e: MouseEventExt): boolean {\r\n\r\n    //@ts-ignore\r\n    if (e.deltaMode !== 0) {\r\n        return false;\r\n    }\r\n\r\n    //@ts-ignore\r\n    return Math.abs(e.deltaY) < 50;\r\n\r\n    //@ts-ignore\r\n    //return e.wheelDeltaY ? e.wheelDeltaY === -3 * e.deltaY : e.deltaMode === 0\r\n}\r\n\r\nclass MouseHandler {\r\n\r\n    protected _htmlObject: HTMLElement;\r\n\r\n    constructor(htmlObject: HTMLElement) {\r\n        this._htmlObject = htmlObject;\r\n    }\r\n\r\n    public setEvent(event: string, sender: any, callback: MouseHandlerEventCallback) {\r\n        switch (event) {\r\n            case \"mousewheel\":\r\n                // this._htmlObject.addEventListener('mousewheel', function (event: WheelEventExt) {\r\n                //     let delta = event.deltaY || event.detail || event.wheelDelta || 0;\r\n                //     if (event.wheelDelta == undefined) {\r\n                //         event.wheelDelta = delta * (-120);\r\n                //     }\r\n                //     callback.call(sender, event);\r\n                //     event.preventDefault();\r\n                // }, false);\r\n\r\n                this._htmlObject.addEventListener('wheel', (event: MouseEventExt) => {\r\n                    let delta = event.deltaY || event.detail || event.wheelDelta || 0;\r\n\r\n                    if (event.wheelDelta == undefined) {\r\n                        event.wheelDelta = delta * (-120);\r\n                    }\r\n\r\n                    event.isTouchPad = _checkTouchPad(event);\r\n\r\n                    callback.call(sender, event);\r\n                    event.preventDefault();\r\n                }, false);\r\n                break;\r\n\r\n            case \"mousedown\":\r\n                this._htmlObject.addEventListener('mousedown', function (event: MouseEventExt) {\r\n                    let rect = this.getBoundingClientRect();\r\n                    callback.call(sender, event, {\r\n                        button: event.button,\r\n                        clientX: event.clientX - rect.left,\r\n                        clientY: event.clientY - rect.top\r\n                    });\r\n                });\r\n                this._htmlObject.addEventListener('contextmenu', function (event: MouseEventExt) {\r\n                    event.preventDefault();\r\n                    return false;\r\n                });\r\n                break;\r\n\r\n            case \"mouseup\":\r\n                this._htmlObject.addEventListener('mouseup', function (event: MouseEventExt) {\r\n                    let rect = this.getBoundingClientRect();\r\n                    callback.call(sender, event, {\r\n                        button: event.button,\r\n                        clientX: event.clientX - rect.left,\r\n                        clientY: event.clientY - rect.top\r\n                    });\r\n                });\r\n                break;\r\n\r\n            case \"mousemove\":\r\n                this._htmlObject.addEventListener('mousemove', function (event: MouseEventExt) {\r\n                    let rect = this.getBoundingClientRect();\r\n                    callback.call(sender, event, {\r\n                        clientX: event.clientX - rect.left,\r\n                        clientY: event.clientY - rect.top\r\n                    });\r\n                });\r\n                break;\r\n\r\n            case \"mouseleave\":\r\n                this._htmlObject.addEventListener('mouseleave', function (event: MouseEventExt) {\r\n                    callback.call(sender, event);\r\n                });\r\n                break;\r\n\r\n            case \"mouseout\":\r\n                this._htmlObject.addEventListener('mouseout', function (event: MouseEventExt) {\r\n                    callback.call(sender, event);\r\n                });\r\n                break;\r\n\r\n            case \"mouseover\":\r\n                this._htmlObject.addEventListener('mouseover', function (event: MouseEventExt) {\r\n                    callback.call(sender, event);\r\n                });\r\n                break;\r\n\r\n            case \"mouseenter\":\r\n                this._htmlObject.addEventListener('mouseenter', function (event: MouseEventExt) {\r\n                    callback.call(sender, event);\r\n                });\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nexport {MouseHandler};\r\n","export type TouchEventExt = TouchEvent & { offsetLeft: number; offsetTop: number };\r\ntype TouchHandlerEventCallback = (sys: TouchEventExt) => void;\r\n\r\nclass TouchHandler {\r\n\r\n    protected _htmlObject: HTMLElement;\r\n\r\n    constructor(htmlObject: HTMLElement) {\r\n        this._htmlObject = htmlObject;\r\n    }\r\n\r\n    public setEvent(event: string, sender: any, callback: TouchHandlerEventCallback) {\r\n        switch (event) {\r\n            case \"touchcancel\":\r\n                this._htmlObject.addEventListener('touchcancel', function (event: TouchEvent) {\r\n                    event.preventDefault();\r\n                    const rect = this.getBoundingClientRect();\r\n                    const eventExt: TouchEventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\r\n                    callback.call(sender, eventExt);\r\n                });\r\n                break;\r\n\r\n            case \"touchstart\":\r\n                this._htmlObject.addEventListener('touchstart', function (event: TouchEvent) {\r\n                    event.preventDefault();\r\n                    const rect = this.getBoundingClientRect();\r\n                    const eventExt: TouchEventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\r\n                    callback.call(sender, eventExt);\r\n                });\r\n                break;\r\n\r\n            case \"touchend\":\r\n                this._htmlObject.addEventListener('touchend', function (event: TouchEvent) {\r\n                    event.preventDefault();\r\n                    const rect = this.getBoundingClientRect();\r\n                    const eventExt: TouchEventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\r\n                    callback.call(sender, eventExt);\r\n                });\r\n                break;\r\n\r\n            case \"touchmove\":\r\n                this._htmlObject.addEventListener('touchmove', function (event: TouchEvent) {\r\n                    event.preventDefault();\r\n                    const rect = this.getBoundingClientRect();\r\n                    const eventExt: TouchEventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\r\n                    callback.call(sender, eventExt);\r\n                });\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\nexport {TouchHandler};\r\n\r\n","import {Events} from \"../Events\";\r\nimport type {EventsHandler, EventCallback} from \"../Events\";\r\nimport {input} from \"../input/input\";\r\nimport {KeyboardHandler} from \"../input/KeyboardHandler\";\r\nimport {MouseHandler} from \"../input/MouseHandler\";\r\nimport type {MouseHandlerEvent, MouseEventExt} from \"../input/MouseHandler\";\r\nimport {Renderer} from \"./Renderer\";\r\nimport {TouchHandler} from \"../input/TouchHandler\";\r\nimport type {TouchEventExt} from \"../input/TouchHandler\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\n\r\nexport type RendererEventsHandler = RendererEvents & EventsHandler<RendererEventsType>;\r\n\r\nexport function createRendererEvents(renderer: Renderer) {\r\n    return new RendererEvents(renderer);\r\n}\r\n\r\nexport type RendererEventsType = [\r\n    \"changerelativecenter\",\r\n    \"draw\",\r\n    \"drawtransparent\",\r\n    \"postdraw\",\r\n    \"resize\",\r\n    \"resizeend\",\r\n    \"mouseenter\",\r\n    \"mouseleave\",\r\n    \"mousemove\",\r\n    \"mousestop\",\r\n    \"lclick\",\r\n    \"rclick\",\r\n    \"mclick\",\r\n    \"ldblclick\",\r\n    \"rdblclick\",\r\n    \"mdblclick\",\r\n    \"lup\",\r\n    \"rup\",\r\n    \"mup\",\r\n    \"ldown\",\r\n    \"rdown\",\r\n    \"mdown\",\r\n    \"lhold\",\r\n    \"rhold\",\r\n    \"mhold\",\r\n    \"mousewheel\",\r\n    \"touchstart\",\r\n    \"touchend\",\r\n    \"touchcancel\",\r\n    \"touchmove\",\r\n    \"doubletouch\",\r\n    \"touchleave\",\r\n    \"touchenter\"\r\n];\r\n\r\nexport interface IBaseInputState {\r\n    /** Current screen mouse X position. */\r\n    clientX: number;\r\n    /** Current screen mouse Y position. */\r\n    clientY: number;\r\n    /** Current screen mouse position. */\r\n    pos: Vec2;\r\n    /** Current touch X - coordinate. */\r\n    x: number;\r\n    /** Current touch Y - coordinate. */\r\n    y: number;\r\n    /** Current touch X - coordinate from 0 to 1 */\r\n    nx: number;\r\n    /** Current touch Y - coordinate from 0 to 1 */\r\n    ny: number;\r\n    /** Previous touch X coordinate. */\r\n    prev_x: number;\r\n    /** Previous touch Y coordinate. */\r\n    prev_y: number,\r\n    /** Screen touch position world direction. */\r\n    direction: Vec3;\r\n    /** Current touched(picking) object. */\r\n    pickingObject: any | null;\r\n    /** Renderer instance. */\r\n    renderer: Renderer;\r\n    /** Touching is moving now. */\r\n    moving: boolean;\r\n}\r\n\r\nexport interface IMouseState extends IBaseInputState {\r\n    /** Left mouse button has stopped pushing down right now.*/\r\n    leftButtonUp: boolean;\r\n    /** Right mouse button has stopped pushing down right now.*/\r\n    rightButtonUp: boolean;\r\n    /** Middle mouse button has stopped pushing down right now.*/\r\n    middleButtonUp: boolean;\r\n    /** Left mouse button has pushed now.*/\r\n    leftButtonDown: boolean;\r\n    /** Right mouse button has pushed now.*/\r\n    rightButtonDown: boolean;\r\n    /** Middle mouse button has pushed now.*/\r\n    middleButtonDown: boolean;\r\n    /** Left mouse button is pushing.*/\r\n    leftButtonHold: boolean;\r\n    /** Right mouse button is pushing.*/\r\n    rightButtonHold: boolean;\r\n    /** Middle mouse button is pushing.*/\r\n    middleButtonHold: boolean;\r\n    /** Left mouse button has clicked twice now.*/\r\n    leftButtonDoubleClick: boolean;\r\n    /** Right mouse button has clicked twice now.*/\r\n    rightButtonDoubleClick: boolean;\r\n    /** Middle mouse button has clicked twice now.*/\r\n    middleButtonDoubleClick: boolean;\r\n    /** Left mouse button has clicked now. */\r\n    leftButtonClick: boolean;\r\n    /** Right mouse button has clicked now. */\r\n    rightButtonClick: boolean;\r\n    /** Middle mouse button has clicked now. */\r\n    middleButtonClick: boolean;\r\n    /** Mouse has just stopped now. */\r\n    justStopped: boolean;\r\n    /** Mose double click delay response time.*/\r\n    doubleClickDelay: number;\r\n    /** Mose click delay response time.*/\r\n    clickDelay: number;\r\n    /** Mouse wheel. */\r\n    wheelDelta: number;\r\n    /** JavaScript mouse system event message. */\r\n    sys: MouseEvent | null;\r\n    isTouchPad: boolean;\r\n}\r\n\r\nexport interface ITouchState extends IBaseInputState {\r\n    /** Touch has ended right now.*/\r\n    touchEnd: boolean;\r\n    /** Touch has started right now.*/\r\n    touchStart: boolean;\r\n    /** Touch canceled.*/\r\n    touchCancel: boolean;\r\n    /** Touched twice.*/\r\n    doubleTouch: boolean;\r\n    /** Double touching responce delay.*/\r\n    doubleTouchDelay: number;\r\n    /** Double touching responce radius in screen pixels.*/\r\n    doubleTouchRadius: number;\r\n    /** JavaScript mouse system event message. */\r\n    sys: TouchEventExt | null;\r\n}\r\n\r\nconst LB_M = 0b0001;\r\nconst RB_M = 0b0010;\r\nconst MB_M = 0b0100;\r\n\r\nconst ISBLACK = (c: NumberArray3 | Uint8Array): boolean => !(c[0] || c[1] || c[2]);\r\nconst NOTBLACK = (c: NumberArray3 | Uint8Array): boolean => !!(c[0] || c[1] || c[2]);\r\n\r\n/**\r\n * Stores current picking rgb color.\r\n * @type {Array.<number>}\r\n */\r\nlet _currPickingColor = new Uint8Array(4);\r\nlet _tempCurrPickingColor = new Uint8Array(4);\r\n\r\n/**\r\n * Stores previous picked rgb color.\r\n * @type {Array.<number>}\r\n */\r\nlet _prevPickingColor = new Uint8Array(4);\r\n\r\n/**\r\n * Renderer events handler.\r\n * @class\r\n * @param {Renderer} renderer - Renderer object, events that works for.\r\n */\r\nclass RendererEvents extends Events<RendererEventsType> implements RendererEventsHandler {\r\n    /**\r\n     * Assigned renderer.\r\n     * @public\r\n     * @type {Renderer}\r\n     */\r\n    public renderer: Renderer;\r\n\r\n    /**\r\n     * Low level touch events handler.\r\n     * @protected\r\n     * @type {TouchHandler}\r\n     */\r\n    protected _touchHandler: TouchHandler;\r\n\r\n    /**\r\n     * Low level mouse events handler.\r\n     * @protected\r\n     * @type {MouseHandler}\r\n     */\r\n    protected _mouseHandler: MouseHandler;\r\n\r\n    /**\r\n     * Low level keyboard events handler.\r\n     * @protected\r\n     * @type {KeyboardHandler}\r\n     */\r\n    protected _keyboardHandler: KeyboardHandler;\r\n\r\n    protected _active: boolean;\r\n\r\n    public clickRadius: number;\r\n\r\n    /**\r\n     * Current mouse state.\r\n     * @public\r\n     * @type {IMouseState}\r\n     */\r\n    public mouseState: IMouseState;\r\n\r\n    /**\r\n     * Current touch state.\r\n     * @public\r\n     * @type {ITouchState}\r\n     */\r\n    public touchState: ITouchState;\r\n\r\n    protected _dblTchCoords: Vec2;\r\n    protected _oneTouchStart: boolean;\r\n    protected _dblTchBegins: number;\r\n    protected _mousestopThread: any | null;\r\n    protected _ldblClkBegins: number;\r\n    protected _rdblClkBegins: number;\r\n    protected _mdblClkBegins: number;\r\n    protected _lClkBegins: number;\r\n    protected _rClkBegins: number;\r\n    protected _mClkBegins: number;\r\n    protected _lclickX: number;\r\n    protected _lclickY: number;\r\n    protected _rclickX: number;\r\n    protected _rclickY: number;\r\n    protected _mclickX: number;\r\n    protected _mclickY: number;\r\n\r\n    protected _isMouseInside: boolean;\r\n    protected _entityPickingEventsActive: boolean;\r\n\r\n    constructor(renderer: Renderer) {\r\n\r\n        super(RENDERER_EVENTS);\r\n\r\n        this.renderer = renderer;\r\n\r\n        this._touchHandler = new TouchHandler(renderer.handler.canvas!);\r\n\r\n        this._mouseHandler = new MouseHandler(renderer.handler.canvas!);\r\n\r\n        this._keyboardHandler = new KeyboardHandler();\r\n\r\n        this._active = true;\r\n\r\n        this.clickRadius = 15;\r\n\r\n        this.mouseState = {\r\n            clientX: 0,\r\n            clientY: 0,\r\n            pos: new Vec2(),\r\n            x: 0,\r\n            y: 0,\r\n            nx: 0,\r\n            ny: 0,\r\n            prev_x: 0,\r\n            prev_y: 0,\r\n            direction: new Vec3(),\r\n            leftButtonUp: false,\r\n            rightButtonUp: false,\r\n            middleButtonUp: false,\r\n            leftButtonDown: false,\r\n            rightButtonDown: false,\r\n            middleButtonDown: false,\r\n            leftButtonHold: false,\r\n            rightButtonHold: false,\r\n            middleButtonHold: false,\r\n            leftButtonDoubleClick: false,\r\n            rightButtonDoubleClick: false,\r\n            middleButtonDoubleClick: false,\r\n            leftButtonClick: false,\r\n            rightButtonClick: false,\r\n            middleButtonClick: false,\r\n            moving: false,\r\n            justStopped: false,\r\n            doubleClickDelay: 500,\r\n            clickDelay: 200,\r\n            wheelDelta: 0,\r\n            sys: null,\r\n            pickingObject: null,\r\n            renderer: renderer,\r\n            isTouchPad: false\r\n        };\r\n\r\n        this.touchState = {\r\n            moving: false,\r\n            touchEnd: false,\r\n            touchStart: false,\r\n            touchCancel: false,\r\n            doubleTouch: false,\r\n            doubleTouchDelay: 550,\r\n            doubleTouchRadius: 10,\r\n            clientX: 0,\r\n            clientY: 0,\r\n            pos: new Vec2(),\r\n            x: 0,\r\n            y: 0,\r\n            nx: 0,\r\n            ny: 0,\r\n            prev_x: 0,\r\n            prev_y: 0,\r\n            direction: new Vec3(),\r\n            sys: null,\r\n            pickingObject: null,\r\n            renderer: renderer\r\n        };\r\n\r\n        this._isMouseInside = true;\r\n        this._entityPickingEventsActive = true;\r\n\r\n        this._dblTchCoords = new Vec2();\r\n        this._oneTouchStart = false;\r\n        this._dblTchBegins = 0;\r\n        this._mousestopThread = null;\r\n        this._ldblClkBegins = 0;\r\n        this._rdblClkBegins = 0;\r\n        this._mdblClkBegins = 0;\r\n        this._lClkBegins = 0;\r\n        this._rClkBegins = 0;\r\n        this._mClkBegins = 0;\r\n        this._lclickX = 0;\r\n        this._lclickY = 0;\r\n        this._rclickX = 0;\r\n        this._rclickY = 0;\r\n        this._mclickX = 0;\r\n        this._mclickY = 0;\r\n    }\r\n\r\n    public pointerEvent(): boolean {\r\n        let ms = this.mouseState,\r\n            ts = this.touchState;\r\n        return (\r\n            ms.moving ||\r\n            ms.justStopped ||\r\n            ts.moving ||\r\n            ts.touchStart ||\r\n            ts.touchEnd ||\r\n            ms.wheelDelta !== 0\r\n        )\r\n    }\r\n\r\n    public get active(): boolean {\r\n        return this._active;\r\n    }\r\n\r\n    public set active(isActive: boolean) {\r\n        this._active = isActive;\r\n        this._keyboardHandler.setActivity(isActive);\r\n    }\r\n\r\n    /**\r\n     * Used in render node frame.\r\n     * @public\r\n     */\r\n    public handleEvents() {\r\n        if (this._active) {\r\n            this.mouseState.direction = this.renderer.activeCamera!.unproject(\r\n                this.mouseState.x,\r\n                this.mouseState.y\r\n            );\r\n            //\r\n            // TODO: Replace in some other place with a thought that we do\r\n            // not need to make unproject when we do not make touching\r\n            this.touchState.direction = this.renderer.activeCamera!.unproject(\r\n                this.touchState.x,\r\n                this.touchState.y\r\n            );\r\n\r\n            this._keyboardHandler.handleEvents();\r\n            this.handleMouseEvents();\r\n            this.handleTouchEvents();\r\n            this.entityPickingEvents();\r\n        }\r\n    }\r\n\r\n    public override on(name: string, p0: EventCallback | number, p1?: number | EventCallback, p2?: any, keyPriority?: number) {\r\n        if (name === \"keypress\" || name === \"charkeypress\" || name === \"keyfree\") {\r\n            this._keyboardHandler.addEvent(name, p0 as number, p1 as EventCallback, p2, keyPriority);\r\n        } else {\r\n            super.on(name, p0 as EventCallback, p1, p2);\r\n        }\r\n    }\r\n\r\n    public override off(name: string, p1?: EventCallback | number | null, p2?: EventCallback) {\r\n        if (name === \"keypress\" || name === \"charkeypress\" || name === \"keyfree\") {\r\n            this._keyboardHandler.removeEvent(name, p1 as number, p2 as EventCallback);\r\n        } else {\r\n            super.off(name, p1 as EventCallback);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check key is pressed.\r\n     * @public\r\n     * @param {number} keyCode - Key code\r\n     * @return {boolean}\r\n     */\r\n    public isKeyPressed(keyCode: number): boolean {\r\n        return this._keyboardHandler.isKeyPressed(keyCode);\r\n    }\r\n\r\n    public releaseKeys() {\r\n        this._keyboardHandler.releaseKeys();\r\n    }\r\n\r\n    /**\r\n     * Renderer events initialization.\r\n     * @public\r\n     */\r\n    public initialize() {\r\n        this._mouseHandler.setEvent(\"mouseup\", this, this.onMouseUp);\r\n        this._mouseHandler.setEvent(\"mousemove\", this, this.onMouseMove);\r\n        this._mouseHandler.setEvent(\"mousedown\", this, this.onMouseDown);\r\n        this._mouseHandler.setEvent(\"mousewheel\", this, this.onMouseWheel);\r\n        this._mouseHandler.setEvent(\"mouseleave\", this, this.onMouseLeave);\r\n        this._mouseHandler.setEvent(\"mouseenter\", this, this.onMouseEnter);\r\n\r\n        this._touchHandler.setEvent(\"touchstart\", this, this.onTouchStart);\r\n        this._touchHandler.setEvent(\"touchend\", this, this.onTouchEnd);\r\n        this._touchHandler.setEvent(\"touchcancel\", this, this.onTouchCancel);\r\n        this._touchHandler.setEvent(\"touchmove\", this, this.onTouchMove);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected onMouseWheel(event: MouseEventExt) {\r\n        this.mouseState.isTouchPad = event.isTouchPad || false;\r\n        this.mouseState.sys = event;\r\n        this.mouseState.wheelDelta = event.wheelDelta || 0;\r\n    }\r\n\r\n    public updateButtonsStates(buttons: number) {\r\n        let ms = this.mouseState;\r\n        if ((buttons & LB_M) && ms.leftButtonDown) {\r\n            ms.leftButtonDown = true;\r\n        } else {\r\n            ms.leftButtonHold = false;\r\n            ms.leftButtonDown = false;\r\n        }\r\n\r\n        if ((buttons & RB_M) && ms.rightButtonDown) {\r\n            ms.rightButtonDown = true;\r\n        } else {\r\n            ms.rightButtonHold = false;\r\n            ms.rightButtonDown = false;\r\n        }\r\n\r\n        if ((buttons & MB_M) && ms.middleButtonDown) {\r\n            ms.middleButtonDown = true;\r\n        } else {\r\n            ms.middleButtonHold = false;\r\n            ms.middleButtonDown = false;\r\n        }\r\n    }\r\n\r\n    protected onMouseMove(sys: MouseEvent, event?: MouseHandlerEvent) {\r\n\r\n        let ms = this.mouseState;\r\n        this.updateButtonsStates(sys.buttons);\r\n        ms.sys = sys;\r\n\r\n        let ex = event!.clientX,\r\n            ey = event!.clientY,\r\n            r = this.clickRadius;\r\n\r\n        if (Math.abs(this._lclickX - ex) >= r && Math.abs(this._lclickY - ey) >= r) {\r\n            this._ldblClkBegins = 0;\r\n            this._lClkBegins = 0;\r\n        }\r\n\r\n        if (Math.abs(this._rclickX - ex) >= r && Math.abs(this._rclickY - ey) >= r) {\r\n            this._rdblClkBegins = 0;\r\n            this._rClkBegins = 0;\r\n        }\r\n\r\n        if (Math.abs(this._mclickX - ex) >= r && Math.abs(this._mclickY - ey) >= r) {\r\n            this._mdblClkBegins = 0;\r\n            this._mClkBegins = 0;\r\n        }\r\n\r\n        if (ms.clientX === event!.clientX && ms.clientY === event!.clientY) {\r\n            return;\r\n        }\r\n\r\n        ms.clientX = event!.clientX;\r\n        ms.clientY = event!.clientY;\r\n\r\n        let h = this.renderer.handler;\r\n\r\n        ms.pos.x = ms.x = event!.clientX * h.pixelRatio;\r\n        ms.pos.y = ms.y = event!.clientY * h.pixelRatio;\r\n\r\n        ms.nx = ms.x / h.canvas!.width;\r\n        ms.ny = ms.y / h.canvas!.height;\r\n\r\n        ms.moving = true;\r\n\r\n        //dispatch stop mouse event\r\n        clearTimeout(this._mousestopThread);\r\n        this._mousestopThread = setTimeout(function () {\r\n            ms.justStopped = true;\r\n        }, 100);\r\n    }\r\n\r\n    protected onMouseLeave(sys: MouseEvent) {\r\n        this._isMouseInside = false;\r\n        this.mouseState.sys = sys;\r\n        this.dispatch((this as RendererEventsHandler).mouseleave, this.mouseState);\r\n    }\r\n\r\n    protected onMouseEnter(sys: MouseEvent) {\r\n        this._isMouseInside = true;\r\n        this.mouseState.sys = sys;\r\n        this.dispatch((this as RendererEventsHandler).mouseenter, this.mouseState);\r\n    }\r\n\r\n    protected onMouseDown(sys: MouseEvent, event?: MouseHandlerEvent) {\r\n        if (event!.button === input.MB_LEFT) {\r\n            this._lClkBegins = window.performance.now();\r\n            this._lclickX = event!.clientX;\r\n            this._lclickY = event!.clientY;\r\n            this.mouseState.sys = sys;\r\n            this.mouseState.leftButtonDown = true;\r\n        } else if (event!.button === input.MB_RIGHT) {\r\n            this._rClkBegins = window.performance.now();\r\n            this._rclickX = event!.clientX;\r\n            this._rclickY = event!.clientY;\r\n            this.mouseState.sys = sys;\r\n            this.mouseState.rightButtonDown = true;\r\n        } else if (event!.button === input.MB_MIDDLE) {\r\n            this._mClkBegins = window.performance.now();\r\n            this._mclickX = event!.clientX;\r\n            this._mclickY = event!.clientY;\r\n            this.mouseState.sys = sys;\r\n            this.mouseState.middleButtonDown = true;\r\n        }\r\n    }\r\n\r\n    protected onMouseUp(sys: MouseEvent, event?: MouseHandlerEvent) {\r\n        let ms = this.mouseState;\r\n        ms.sys = sys;\r\n        let t = window.performance.now();\r\n\r\n        if (event!.button === input.MB_LEFT) {\r\n            ms.leftButtonDown = false;\r\n            ms.leftButtonUp = true;\r\n\r\n            if (\r\n                Math.abs(this._lclickX - event!.clientX) < this.clickRadius &&\r\n                Math.abs(this._lclickY - event!.clientY) < this.clickRadius &&\r\n                t - this._lClkBegins <= ms.clickDelay\r\n            ) {\r\n                if (this._ldblClkBegins) {\r\n                    let deltatime = window.performance.now() - this._ldblClkBegins;\r\n                    if (deltatime <= ms.doubleClickDelay) {\r\n                        ms.leftButtonDoubleClick = true;\r\n                    }\r\n                    this._ldblClkBegins = 0;\r\n                } else {\r\n                    this._ldblClkBegins = window.performance.now();\r\n                }\r\n\r\n                ms.leftButtonClick = true;\r\n                this._lClkBegins = 0;\r\n            }\r\n        } else if (event!.button === input.MB_RIGHT) {\r\n            ms.rightButtonDown = false;\r\n            ms.rightButtonUp = true;\r\n\r\n            if (\r\n                Math.abs(this._rclickX - event!.clientX) < this.clickRadius &&\r\n                Math.abs(this._rclickY - event!.clientY) < this.clickRadius &&\r\n                t - this._rClkBegins <= ms.clickDelay\r\n            ) {\r\n                if (this._rdblClkBegins) {\r\n                    let deltatime = window.performance.now() - this._rdblClkBegins;\r\n                    if (deltatime <= ms.doubleClickDelay) {\r\n                        ms.rightButtonDoubleClick = true;\r\n                    }\r\n                    this._rdblClkBegins = 0;\r\n                } else {\r\n                    this._rdblClkBegins = window.performance.now();\r\n                }\r\n\r\n                ms.rightButtonClick = true;\r\n                this._rClkBegins = 0;\r\n            }\r\n        } else if (event!.button === input.MB_MIDDLE) {\r\n            ms.middleButtonDown = false;\r\n            ms.middleButtonUp = true;\r\n\r\n            if (\r\n                Math.abs(this._mclickX - event!.clientX) < this.clickRadius &&\r\n                Math.abs(this._mclickY - event!.clientY) < this.clickRadius &&\r\n                t - this._mClkBegins <= ms.clickDelay\r\n            ) {\r\n                if (this._mdblClkBegins) {\r\n                    let deltatime = window.performance.now() - this._mdblClkBegins;\r\n                    if (deltatime <= ms.doubleClickDelay) {\r\n                        ms.middleButtonDoubleClick = true;\r\n                    }\r\n                    this._mdblClkBegins = 0;\r\n                } else {\r\n                    this._mdblClkBegins = window.performance.now();\r\n                }\r\n\r\n                ms.middleButtonClick = true;\r\n                this._mClkBegins = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onTouchStart(event: TouchEventExt) {\r\n        let ts = this.touchState;\r\n        ts.sys = event;\r\n\r\n        ts.clientX = event.touches.item(0)!.clientX - event.offsetLeft;\r\n        ts.clientY = event.touches.item(0)!.clientY - event.offsetTop;\r\n\r\n        let h = this.renderer.handler;\r\n\r\n        ts.pos.x = ts.x = ts.clientX * h.pixelRatio;\r\n        ts.pos.y = ts.y = ts.clientY * h.pixelRatio;\r\n\r\n        ts.nx = ts.x / h.canvas!.width;\r\n        ts.ny = ts.y / h.canvas!.height;\r\n        ts.prev_x = ts.x;\r\n        ts.prev_y = ts.y;\r\n        ts.touchStart = true;\r\n\r\n        if (event.touches.length === 1) {\r\n            this._dblTchCoords.x = ts.x;\r\n            this._dblTchCoords.y = ts.y;\r\n            this._oneTouchStart = true;\r\n        } else {\r\n            this._oneTouchStart = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected onTouchEnd(event: TouchEventExt) {\r\n        let ts = this.touchState;\r\n        ts.sys = event;\r\n        ts.touchEnd = true;\r\n\r\n        if (event.touches.length === 0) {\r\n            ts.prev_x = ts.x;\r\n            ts.prev_y = ts.y;\r\n\r\n            if (this._oneTouchStart) {\r\n                if (this._dblTchBegins) {\r\n                    let deltatime = window.performance.now() - this._dblTchBegins;\r\n                    if (deltatime <= ts.doubleTouchDelay) {\r\n                        ts.doubleTouch = true;\r\n                    }\r\n                    this._dblTchBegins = 0;\r\n                }\r\n                this._dblTchBegins = window.performance.now();\r\n                this._oneTouchStart = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onTouchCancel(event: TouchEventExt) {\r\n        let ts = this.touchState;\r\n        ts.sys = event;\r\n        ts.touchCancel = true;\r\n    }\r\n\r\n    protected onTouchMove(event: TouchEventExt) {\r\n        let ts = this.touchState;\r\n\r\n        ts.clientX = event.touches.item(0)!.clientX - event.offsetLeft;\r\n        ts.clientY = event.touches.item(0)!.clientY - event.offsetTop;\r\n\r\n        let h = this.renderer.handler;\r\n\r\n        ts.x = ts.clientX * h.pixelRatio;\r\n        ts.y = ts.clientY * h.pixelRatio;\r\n\r\n        ts.nx = ts.x / h.canvas!.width;\r\n        ts.ny = ts.y / h.canvas!.height;\r\n\r\n        ts.sys = event;\r\n        ts.moving = true;\r\n\r\n        let dX = ts.x - ts.prev_x\r\n        let dY = ts.y - ts.prev_y\r\n        if (Math.abs(dX) > 9 || Math.abs(dY) > 9) {\r\n            this._dblTchBegins = 0;\r\n            this._oneTouchStart = false;\r\n        }\r\n    }\r\n\r\n    protected entityPickingEvents() {\r\n        let ts = this.touchState,\r\n            ms = this.mouseState;\r\n\r\n        // Triggers mouseleave when mouse goes outside the viewport\r\n        if (this._isMouseInside !== this._entityPickingEventsActive) {\r\n            this._entityPickingEventsActive = this._isMouseInside;\r\n            if (!this._entityPickingEventsActive) {\r\n                let r = this.renderer;\r\n                let c = _currPickingColor;\r\n                let co = r.getPickingObjectArr<any>(c);\r\n                if (co) {\r\n                    let pe = co.rendererEvents;\r\n                    ms.pickingObject = co;\r\n                    pe && pe.dispatch(pe.mouseleave, ms);\r\n                    ts.pickingObject = co;\r\n                    pe && pe.dispatch(pe.touchleave, ts);\r\n                }\r\n                _currPickingColor[0] = _currPickingColor[1] = _currPickingColor[2] = _currPickingColor[3] =\r\n                    _prevPickingColor[0] = _prevPickingColor[1] = _prevPickingColor[2] = _prevPickingColor[3] =\r\n                        _tempCurrPickingColor[0] = _tempCurrPickingColor[1] = _tempCurrPickingColor[2] = _tempCurrPickingColor[3] = 0.0;\r\n            }\r\n        }\r\n\r\n        if (this._isMouseInside && !(ms.leftButtonHold || ms.rightButtonHold || ms.middleButtonHold)) {\r\n\r\n            let r = this.renderer;\r\n            let c = _currPickingColor,\r\n                p = _prevPickingColor,\r\n                t = _tempCurrPickingColor;\r\n\r\n            if (ts.x || ts.y) {\r\n                r.readPickingColor(ts.nx, 1 - ts.ny, t);\r\n            } else {\r\n                r.readPickingColor(ms.nx, 1 - ms.ny, t);\r\n            }\r\n\r\n            p[0] = c[0];\r\n            p[1] = c[1];\r\n            p[2] = c[2];\r\n\r\n            c[0] = t[0];\r\n            c[1] = t[1];\r\n            c[2] = t[2];\r\n\r\n            ms.pickingObject = null;\r\n            ts.pickingObject = null;\r\n\r\n            let co = r.getPickingObjectArr<any>(c);\r\n\r\n            ms.pickingObject = co;\r\n            ts.pickingObject = co;\r\n\r\n            //object is changed\r\n            if (c[0] !== p[0] || c[1] !== p[1] || c[2] !== p[2]) {\r\n\r\n                //current is black\r\n                if (ISBLACK(c)) {\r\n                    let po = r.getPickingObjectArr<any>(p);\r\n                    if (po) {\r\n                        let pe = po.rendererEvents;\r\n                        ms.pickingObject = po;\r\n                        pe && pe.dispatch(pe.mouseleave, ms);\r\n                        ts.pickingObject = po;\r\n                        pe && pe.dispatch(pe.touchleave, ts);\r\n                    }\r\n                } else {\r\n                    //current ia not black\r\n\r\n                    //previous is not black\r\n                    if (NOTBLACK(p)) {\r\n                        let po = r.getPickingObjectArr<any>(p);\r\n                        if (po) {\r\n                            let pe = po.rendererEvents;\r\n                            ms.pickingObject = po;\r\n                            pe && pe.dispatch(pe.mouseleave, ms);\r\n                            ts.pickingObject = po;\r\n                            pe && pe.dispatch(pe.touchleave, ts);\r\n                        }\r\n                    }\r\n\r\n                    if (co) {\r\n                        let ce = co.rendererEvents;\r\n                        ms.pickingObject = co;\r\n                        ce && ce.dispatch(ce.mouseenter, ms);\r\n                        ts.pickingObject = co;\r\n                        ce && ce.dispatch(ce.touchenter, ts);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected handleMouseEvents() {\r\n        let _this = this as RendererEventsHandler;\r\n        let ms = this.mouseState;\r\n        let po = ms.pickingObject,\r\n            pe = null;\r\n\r\n        if (ms.leftButtonClick) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.lclick, ms);\r\n            }\r\n            this.dispatch(_this.lclick, ms);\r\n            ms.leftButtonClick = false;\r\n        }\r\n\r\n        if (ms.rightButtonClick) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.rclick, ms);\r\n            }\r\n            this.dispatch(_this.rclick, ms);\r\n            ms.rightButtonClick = false;\r\n        }\r\n\r\n        if (ms.middleButtonClick) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.mclick, ms);\r\n            }\r\n            this.dispatch(_this.mclick, ms);\r\n            ms.middleButtonClick = false;\r\n        }\r\n\r\n        if (ms.leftButtonDown) {\r\n            if (ms.leftButtonHold) {\r\n                if (po) {\r\n                    pe = po.rendererEvents;\r\n                    pe && pe.dispatch(pe.lhold, ms);\r\n                }\r\n                this.dispatch(_this.lhold, ms);\r\n            } else {\r\n                ms.leftButtonHold = true;\r\n                if (po) {\r\n                    pe = po.rendererEvents;\r\n                    pe && pe.dispatch(pe.ldown, ms);\r\n                }\r\n                this.dispatch(_this.ldown, ms);\r\n            }\r\n        }\r\n\r\n        if (ms.rightButtonDown) {\r\n            if (ms.rightButtonHold) {\r\n                if (po) {\r\n                    pe = po.rendererEvents;\r\n                    pe && pe.dispatch(pe.rhold, ms);\r\n                }\r\n                this.dispatch(_this.rhold, ms);\r\n            } else {\r\n                ms.rightButtonHold = true;\r\n                if (po) {\r\n                    pe = po.rendererEvents;\r\n                    pe && pe.dispatch(pe.rdown, ms);\r\n                }\r\n                this.dispatch(_this.rdown, ms);\r\n            }\r\n        }\r\n\r\n        if (ms.middleButtonDown) {\r\n            if (ms.middleButtonHold) {\r\n                if (po) {\r\n                    pe = po.rendererEvents;\r\n                    pe && pe.dispatch(pe.mhold, ms);\r\n                }\r\n                this.dispatch(_this.mhold, ms);\r\n            } else {\r\n                ms.middleButtonHold = true;\r\n                if (po) {\r\n                    pe = po.rendererEvents;\r\n                    pe && pe.dispatch(pe.mdown, ms);\r\n                }\r\n                this.dispatch(_this.mdown, ms);\r\n            }\r\n        }\r\n\r\n        if (ms.leftButtonUp) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.lup, ms);\r\n            }\r\n            this.dispatch(_this.lup, ms);\r\n            ms.leftButtonUp = false;\r\n            ms.leftButtonHold = false;\r\n        }\r\n\r\n        if (ms.rightButtonUp) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.rup, ms);\r\n            }\r\n            this.dispatch(_this.rup, ms);\r\n            ms.rightButtonUp = false;\r\n            ms.rightButtonHold = false;\r\n        }\r\n\r\n        if (ms.middleButtonUp) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.mup, ms);\r\n            }\r\n            this.dispatch(_this.mup, ms);\r\n            ms.middleButtonUp = false;\r\n            ms.middleButtonHold = false;\r\n        }\r\n\r\n        if (ms.leftButtonDoubleClick) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.ldblclick, ms);\r\n            }\r\n            this.dispatch(_this.ldblclick, ms);\r\n            ms.leftButtonDoubleClick = false;\r\n        }\r\n\r\n        if (ms.rightButtonDoubleClick) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.rdblclick, ms);\r\n            }\r\n            this.dispatch(_this.rdblclick, ms);\r\n            ms.rightButtonDoubleClick = false;\r\n        }\r\n\r\n        if (ms.middleButtonDoubleClick) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.mdblclick, ms);\r\n            }\r\n            this.dispatch(_this.mdblclick, ms);\r\n            ms.middleButtonDoubleClick = false;\r\n        }\r\n\r\n        if (ms.wheelDelta) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.mousewheel, ms);\r\n            }\r\n            this.dispatch(_this.mousewheel, ms);\r\n        }\r\n\r\n        if (ms.moving) {\r\n            if (po) {\r\n                pe = po.rendererEvents;\r\n                pe && pe.dispatch(pe.mousemove, ms);\r\n            }\r\n            this.dispatch(_this.mousemove, ms);\r\n            ms.prev_x = ms.x;\r\n            ms.prev_y = ms.y;\r\n        }\r\n\r\n        if (ms.justStopped) {\r\n            this.dispatch(_this.mousestop, ms);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected handleTouchEvents() {\r\n        let _this = this as RendererEventsHandler;\r\n\r\n        let ts = this.touchState;\r\n\r\n        let tpo = ts.pickingObject,\r\n            tpe = null;\r\n\r\n        if (ts.touchCancel) {\r\n            this.dispatch(_this.touchcancel, ts);\r\n            ts.touchCancel = false;\r\n        }\r\n\r\n        if (ts.touchStart) {\r\n            let r = this.renderer;\r\n\r\n            r.readPickingColor(ts.nx, 1 - ts.ny, _currPickingColor);\r\n\r\n            let co = r.getPickingObjectArr<any>(_currPickingColor);\r\n            tpo = ts.pickingObject = co;\r\n            if (tpo) {\r\n                tpe = tpo.rendererEvents;\r\n                tpe && tpe.dispatch(tpe.touchstart, ts);\r\n            }\r\n            this.dispatch(_this.touchstart, ts);\r\n            ts.touchStart = false;\r\n        }\r\n\r\n        if (ts.doubleTouch) {\r\n            if (tpo) {\r\n                tpe = tpo.rendererEvents;\r\n                tpe && tpe.dispatch(tpe.doubletouch, ts);\r\n            }\r\n            this.dispatch(_this.doubletouch, ts);\r\n            ts.doubleTouch = false;\r\n        }\r\n\r\n        if (ts.touchEnd) {\r\n            if (tpo) {\r\n                tpe = tpo.rendererEvents;\r\n                tpe && tpe.dispatch(tpe.touchend, ts);\r\n            }\r\n            this.dispatch(_this.touchend, ts);\r\n            ts.x = 0;\r\n            ts.y = 0;\r\n            ts.touchEnd = false;\r\n        }\r\n\r\n        if (ts.moving) {\r\n            if (tpo) {\r\n                tpe = tpo.rendererEvents;\r\n                tpe && tpe.dispatch(tpe.touchmove, ts);\r\n            }\r\n            this.dispatch(_this.touchmove, ts);\r\n            ts.prev_x = ts.x;\r\n            ts.prev_y = ts.y;\r\n        }\r\n    }\r\n}\r\n\r\nconst RENDERER_EVENTS: RendererEventsType = [\r\n    \"changerelativecenter\",\r\n\r\n    /**\r\n     * Triggered before scene frame is rendered(before render nodes).\r\n     * @event og.RendererEvents#draw\r\n     */\r\n    \"draw\",\r\n\r\n    /**\r\n     * Triggered after all transparent object are drawn\r\n     * @event og.RendererEvents#drawtransparent\r\n     */\r\n    \"drawtransparent\",\r\n\r\n    /**\r\n     * Triggered after scene frame is rendered(after render nodes).\r\n     * @event og.RendererEvents#postdraw\r\n     */\r\n    \"postdraw\",\r\n\r\n    /**\r\n     * Triggered when screen is resized.\r\n     * @event og.RendererEvents#resize\r\n     */\r\n    \"resize\",\r\n\r\n    /**\r\n     * Triggered when screen is resized.\r\n     * @event og.RendererEvents#resizeend\r\n     */\r\n    \"resizeend\",\r\n\r\n    /**\r\n     * Mouse enters the work screen\r\n     * @event og.RendererEvents#mouseenter\r\n     */\r\n    \"mouseenter\",\r\n\r\n    /**\r\n     * Mouse leaves the work screen\r\n     * @event og.RendererEvents#mouseleave\r\n     */\r\n    \"mouseleave\",\r\n\r\n    /**\r\n     * Mouse is moving.\r\n     * @event og.RendererEvents#mousemove\r\n     */\r\n    \"mousemove\",\r\n\r\n    /**\r\n     * Mouse is just stopped.\r\n     * @event og.RendererEvents#mousestop\r\n     */\r\n    \"mousestop\",\r\n\r\n    /**\r\n     * Mouse left button clicked.\r\n     * @event og.RendererEvents#lclick\r\n     */\r\n    \"lclick\",\r\n\r\n    /**\r\n     * Mouse right button clicked.\r\n     * @event og.RendererEvents#rclick\r\n     */\r\n    \"rclick\",\r\n\r\n    /**\r\n     * Mouse middle button clicked.\r\n     * @event og.RendererEvents#mclick\r\n     */\r\n    \"mclick\",\r\n\r\n    /**\r\n     * Mouse left button double click.\r\n     * @event og.RendererEvents#ldblclick\r\n     */\r\n    \"ldblclick\",\r\n\r\n    /**\r\n     * Mouse right button double click.\r\n     * @event og.RendererEvents#rdblclick\r\n     */\r\n    \"rdblclick\",\r\n\r\n    /**\r\n     * Mouse middle button double click.\r\n     * @event og.RendererEvents#mdblclick\r\n     */\r\n    \"mdblclick\",\r\n\r\n    /**\r\n     * Mouse left button up(stop pressing).\r\n     * @event og.RendererEvents#lup\r\n     */\r\n    \"lup\",\r\n\r\n    /**\r\n     * Mouse right button up(stop pressing).\r\n     * @event og.RendererEvents#rup\r\n     */\r\n    \"rup\",\r\n\r\n    /**\r\n     * Mouse middle button up(stop pressing).\r\n     * @event og.RendererEvents#mup\r\n     */\r\n    \"mup\",\r\n\r\n    /**\r\n     * Mouse left button is just pressed down(start pressing).\r\n     * @event og.RendererEvents#ldown\r\n     */\r\n    \"ldown\",\r\n\r\n    /**\r\n     * Mouse right button is just pressed down(start pressing).\r\n     * @event og.RendererEvents#rdown\r\n     */\r\n    \"rdown\",\r\n\r\n    /**\r\n     * Mouse middle button is just pressed down(start pressing).\r\n     * @event og.RendererEvents#mdown\r\n     */\r\n    \"mdown\",\r\n\r\n    /**\r\n     * Mouse left button is pressing.\r\n     * @event og.RendererEvents#lhold\r\n     */\r\n    \"lhold\",\r\n\r\n    /**\r\n     * Mouse right button is pressing.\r\n     * @event og.RendererEvents#rhold\r\n     */\r\n    \"rhold\",\r\n\r\n    /**\r\n     * Mouse middle button is pressing.\r\n     * @event og.RendererEvents#mhold\r\n     */\r\n    \"mhold\",\r\n\r\n    /**\r\n     * Mouse wheel is rotated.\r\n     * @event og.RendererEvents#mousewheel\r\n     */\r\n    \"mousewheel\",\r\n\r\n    /**\r\n     * Triggered when touching starts.\r\n     * @event og.RendererEvents#touchstart\r\n     */\r\n    \"touchstart\",\r\n\r\n    /**\r\n     * Triggered when touching ends.\r\n     * @event og.RendererEvents#touchend\r\n     */\r\n    \"touchend\",\r\n\r\n    /**\r\n     * Triggered when touching cancel.\r\n     * @event og.RendererEvents#touchcancel\r\n     */\r\n    \"touchcancel\",\r\n\r\n    /**\r\n     * Triggered when touch is move.\r\n     * @event og.RendererEvents#touchmove\r\n     */\r\n    \"touchmove\",\r\n\r\n    /**\r\n     * Triggered when double touch.\r\n     * @event og.RendererEvents#doubletouch\r\n     */\r\n    \"doubletouch\",\r\n\r\n    /**\r\n     * Triggered when touch leaves picked object.\r\n     * @event og.RendererEvents#touchleave\r\n     */\r\n    \"touchleave\",\r\n\r\n    /**\r\n     * Triggered when touch enter picking object.\r\n     * @event og.RendererEvents#touchenter\r\n     */\r\n    \"touchenter\"\r\n];\r\n\r\nexport {RendererEvents};\r\n","import {Program} from '../webgl/Program';\r\n\r\nexport function depth() {\r\n    return new Program(\"depth\", {\r\n        uniforms: {\r\n            depthTexture: \"sampler2D\"\r\n        },\r\n        attributes: {\r\n            corners: \"vec2\"\r\n        },\r\n        vertexShader:\r\n            `#version 300 es\r\n            \r\n            in vec2 corners;\r\n            \r\n            out vec2 tc;\r\n\r\n            void main(void) {\r\n                gl_Position = vec4(corners, 0.0, 1.0);\r\n                tc = corners * 0.5 + 0.5;\r\n            }`,\r\n        fragmentShader:\r\n            `#version 300 es\r\n\r\n            precision highp float;\r\n\r\n            uniform sampler2D depthTexture;\r\n           \r\n            in vec2 tc;\r\n\r\n            layout(location = 0) out vec4 fragColor;\r\n\r\n            float LinearizeDepth(in vec2 uv)\r\n            {\r\n                return texture(depthTexture, tc).r;\r\n            }\r\n            \r\n            void main(void) {\r\n                float c = LinearizeDepth(tc);\r\n                fragColor = vec4(c, c, c, 1.0);\r\n            }`\r\n    });\r\n}","/**\r\n * 2D Rectangle class.\r\n * @class\r\n * @param {number} [left] - Left coordinate. 0 - default.\r\n * @param {number} [top] - Top coordinate. 0 - default.\r\n * @param {number} [right] - Right coordinate. 0 - default.\r\n * @param {number} [bottom] - Bottom coordinate. 0 - default.\r\n */\r\nclass Rectangle {\r\n    /**\r\n     * Left coordinate.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public left: number;\r\n\r\n    /**\r\n     * Right coordinate.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public right: number;\r\n\r\n    /**\r\n     * Top coordinate.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public top: number;\r\n\r\n    /**\r\n     * Top coordinate.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public bottom: number;\r\n\r\n    constructor(left: number = 0, top: number = 0, right: number = 0, bottom: number = 0) {\r\n        this.left = left;\r\n        this.right = right;\r\n        this.top = top;\r\n        this.bottom = bottom;\r\n    }\r\n\r\n    public set(left: number = 0, top: number = 0, right: number = 0, bottom: number = 0) {\r\n        this.left = left;\r\n        this.right = right;\r\n        this.top = top;\r\n        this.bottom = bottom;\r\n    }\r\n\r\n    /**\r\n     * Clone rectangle object.\r\n     * @public\r\n     * @returns {Rectangle}\r\n     */\r\n    public clone(): Rectangle {\r\n        return new Rectangle(this.left, this.top, this.right, this.bottom);\r\n    }\r\n\r\n    /**\r\n     * Returns rectangle width.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public getWidth(): number {\r\n        return Math.abs(this.right - this.left);\r\n    }\r\n\r\n    /**\r\n     * Returns rectangle height.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public getHeight(): number {\r\n        return Math.abs(this.bottom - this.top);\r\n    }\r\n\r\n    /**\r\n     * Returns rectangle area.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public getSquare(): number {\r\n        return this.getHeight() * this.getWidth();\r\n    }\r\n\r\n    /**\r\n     * Returns rectangle diagonal size.\r\n     * @public\r\n     * @type {number}\r\n     */\r\n    public getDiagonal(): number {\r\n        let w = this.getWidth(),\r\n            h = this.getHeight();\r\n        return Math.sqrt(h * h + w * w);\r\n    }\r\n\r\n    /**\r\n     * Returns true if rectangle fits their size in width and height.\r\n     * @public\r\n     * @param {number} width - Width.\r\n     * @param {number} height - Height.\r\n     * @type {boolean}\r\n     */\r\n    public fit(width: number, height: number): boolean {\r\n        return this.getWidth() === width && this.getHeight() === height;\r\n    }\r\n\r\n    public isInside(x: number, y: number): boolean {\r\n        return x >= this.left && x <= this.right && y >= this.top && y <= this.bottom;\r\n    }\r\n}\r\n\r\nexport {Rectangle};\r\n","import {QueueArray} from '../QueueArray';\r\n\r\nexport type HTMLImageElementExt =\r\n    HTMLImageElement\r\n    & { __nodeIndex?: number; atlasWidth?: number; atlasHeight?: number };\r\nexport type ImagesCacheManagerCallback = (image: HTMLImageElementExt) => void;\r\n\r\ninterface IImagesCacheRequest {\r\n    \"src\": string;\r\n    \"success\": ImagesCacheManagerCallback;\r\n}\r\n\r\nclass ImagesCacheManager {\r\n\r\n    public imagesCache: Record<string, HTMLImageElementExt>;\r\n\r\n    protected _counter: number;\r\n    protected _pendingsQueue: QueueArray<IImagesCacheRequest>;\r\n    protected _imageIndexCounter: number;\r\n\r\n    constructor() {\r\n        this.imagesCache = {};\r\n\r\n        this._counter = 0;\r\n        this._pendingsQueue = new QueueArray<IImagesCacheRequest>();\r\n        this._imageIndexCounter = 0;\r\n    }\r\n\r\n    public load(src: string, success: ImagesCacheManagerCallback) {\r\n        if (this.imagesCache[src]) {\r\n            success(this.imagesCache[src]);\r\n        } else {\r\n            let req = {\"src\": src, \"success\": success};\r\n            if (this._counter >= 1) {\r\n                this._pendingsQueue.unshift(req);\r\n            } else {\r\n                this._exec(req);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _exec(req: IImagesCacheRequest) {\r\n        this._counter++;\r\n        const that = this;\r\n\r\n        let img: HTMLImageElementExt = new Image();\r\n        img.crossOrigin = '';\r\n        img.onload = function () {\r\n            that.imagesCache[req.src] = img;\r\n            img.__nodeIndex = that._imageIndexCounter++;\r\n            req.success(img);\r\n            that._dequeueRequest();\r\n        };\r\n\r\n        img.onerror = function () {\r\n            that._dequeueRequest();\r\n        };\r\n\r\n        img.src = req.src;\r\n    }\r\n\r\n    protected _dequeueRequest() {\r\n        this._counter--;\r\n        if (this._pendingsQueue.length && this._counter < 1) {\r\n            while (this._pendingsQueue.length) {\r\n                let req = this._pendingsQueue.pop();\r\n                if (req) {\r\n                    if (this.imagesCache[req.src]) {\r\n                        if (this._counter <= 0) {\r\n                            this._counter = 0;\r\n                        } else {\r\n                            this._counter--;\r\n                        }\r\n                        req.success(this.imagesCache[req.src]);\r\n                    } else {\r\n                        this._exec(req);\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport {ImagesCacheManager};","import {ImageCanvas} from \"../ImageCanvas\";\r\nimport {Rectangle} from \"../Rectangle\";\r\nimport {ImagesCacheManager} from \"./ImagesCacheManager\";\r\nimport type {HTMLImageElementExt, ImagesCacheManagerCallback} from \"./ImagesCacheManager\";\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport type {WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\n/**\r\n * Texture atlas stores images in one texture. Each image has its own\r\n * atlas texture coordinates.\r\n * @class\r\n * @param {number} [width=1024] - Texture atlas width, if it hasn't 1024 default.\r\n * @param {number} [height=1024] - Texture atlas height, if it hasn't 1024 default.\r\n */\r\nclass TextureAtlas {\r\n    /**\r\n     * Atlas nodes where input images store. It can be accessed by image.__nodeIndex.\r\n     * @public\r\n     * @type {Map<number, TextureAtlasNode>}\r\n     */\r\n    public nodes: Map<number, TextureAtlasNode>;\r\n\r\n    /**\r\n     * Created gl texture.\r\n     * @public\r\n     */\r\n    public texture: WebGLTextureExt | null;\r\n\r\n    /**\r\n     * Atlas canvas.\r\n     * @public\r\n     * @type {ImageCanvas}\r\n     */\r\n    public canvas: ImageCanvas;\r\n\r\n    public borderSize: number;\r\n\r\n    protected _handler: Handler | null;\r\n    protected _images: HTMLImageElementExt[];\r\n    protected _btree: TextureAtlasNode | null;\r\n    protected _imagesCacheManager: ImagesCacheManager;\r\n\r\n    constructor(width: number = 1024, height: number = 1024) {\r\n\r\n        this.nodes = new Map<number, TextureAtlasNode>();\r\n\r\n        this.texture = null;\r\n\r\n        this.canvas = new ImageCanvas(width, height);\r\n\r\n        this.clearCanvas();\r\n\r\n        this._handler = null;\r\n\r\n        this._images = [];\r\n\r\n        this._btree = null;\r\n\r\n        this._imagesCacheManager = new ImagesCacheManager();\r\n\r\n        this.borderSize = 4;\r\n    }\r\n\r\n    /**\r\n     * Returns atlas javascript image object.\r\n     * @public\r\n     * @returns {HTMLImageElement} -\r\n     */\r\n    public getImage() {\r\n        return this.canvas.getImage();\r\n    }\r\n\r\n    /**\r\n     * Returns canvas object.\r\n     * @public\r\n     * @returns {HTMLCanvasElement} -\r\n     */\r\n    public getCanvas(): HTMLCanvasElement {\r\n        return this.canvas.getCanvas();\r\n    }\r\n\r\n    /**\r\n     * Clear atlas with black.\r\n     * @public\r\n     */\r\n    public clearCanvas() {\r\n        this.canvas.fillEmpty();\r\n    }\r\n\r\n    /**\r\n     * Sets openglobus gl handler that creates gl texture.\r\n     * @public\r\n     * @param {Handler} handler - WebGL handler.\r\n     */\r\n    public assignHandler(handler: Handler) {\r\n        this._handler = handler;\r\n        this.createTexture();\r\n    }\r\n\r\n    /**\r\n     * Returns image diagonal size.\r\n     * @param {HTMLImageElementExt} image - Image object.\r\n     * @returns {number} -\r\n     */\r\n    public getDiagonal(image: HTMLImageElementExt): number {\r\n        let w = image.atlasWidth || image.width,\r\n            h = image.atlasHeight || image.height;\r\n        return Math.sqrt(w * w + h * h);\r\n    }\r\n\r\n    /**\r\n     * Adds image to the atlas and returns created node with texture coordinates of the stored image.\r\n     * @public\r\n     * @param {HTMLImageElementExt} image - Input javascript image object.\r\n     * @param {boolean} [fastInsert] - If it's true atlas doesn't restore all images again\r\n     * and store image in the current atlas scheme.\r\n     * @returns {TextureAtlasNode | undefined} -\r\n     */\r\n    public addImage(image: HTMLImageElementExt, fastInsert: boolean = false): TextureAtlasNode | undefined {\r\n        if (!(image.width && image.height)) {\r\n            return;\r\n        }\r\n\r\n        this._images.push(image);\r\n\r\n        this._makeAtlas(fastInsert);\r\n\r\n        if (image.__nodeIndex != undefined) {\r\n            return this.get(image.__nodeIndex);\r\n        }\r\n    }\r\n\r\n    protected _completeNode(nodes: Map<number, TextureAtlasNode>, node?: TextureAtlasNode | null) {\r\n        if (node) {\r\n\r\n            let w = this.canvas.getWidth(),\r\n                h = this.canvas.getHeight();\r\n\r\n            let im = node.image!;\r\n            let r = node.rect;\r\n            let bs = Math.round(this.borderSize * 0.5);\r\n            this.canvas.drawImage(im, r.left + bs, r.top + bs, im.atlasWidth || 0, im.atlasHeight || 0);\r\n\r\n            let tc = node.texCoords;\r\n\r\n            tc[0] = (r.left + bs) / w;\r\n            tc[1] = (r.top + bs) / h;\r\n\r\n            tc[2] = (r.left + bs) / w;\r\n            tc[3] = (r.bottom - bs) / h;\r\n\r\n            tc[4] = (r.right - bs) / w;\r\n            tc[5] = (r.bottom - bs) / h;\r\n\r\n            tc[6] = (r.right - bs) / w;\r\n            tc[7] = (r.bottom - bs) / h;\r\n\r\n            tc[8] = (r.right - bs) / w;\r\n            tc[9] = (r.top + bs) / h;\r\n\r\n            tc[10] = (r.left + bs) / w;\r\n            tc[11] = (r.top + bs) / h;\r\n\r\n            nodes.set(im.__nodeIndex!, node);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Main atlas making function.\r\n     * @protected\r\n     * @param {boolean} [fastInsert] - If it's true atlas doesn't restore all images again\r\n     * and store image in the current atlas scheme.\r\n     */\r\n    protected _makeAtlas(fastInsert: boolean = false) {\r\n        if (fastInsert && this._btree) {\r\n            let im = this._images[this._images.length - 1];\r\n            this._completeNode(this.nodes, this._btree.insert(im));\r\n        } else {\r\n            let im = this._images.slice(0);\r\n\r\n            im.sort(function (b: HTMLImageElementExt, a: HTMLImageElementExt) {\r\n                return (\r\n                    (a.atlasWidth || a.width) - (b.atlasWidth || b.width) ||\r\n                    (a.atlasHeight || a.height) - (b.atlasHeight || b.height)\r\n                );\r\n            });\r\n\r\n            this._btree = new TextureAtlasNode(\r\n                new Rectangle(0, 0, this.canvas.getWidth(), this.canvas.getHeight())\r\n            );\r\n            this._btree.atlas = this;\r\n\r\n            this.clearCanvas();\r\n\r\n            let newNodes = new Map<number, TextureAtlasNode>();\r\n            for (let i = 0; i < im.length; i++) {\r\n                this._completeNode(newNodes, this._btree.insert(im[i]));\r\n            }\r\n            //@ts-ignore\r\n            this.nodes = null;\r\n            this.nodes = newNodes;\r\n        }\r\n    }\r\n\r\n    public get(key: number): TextureAtlasNode | undefined {\r\n        return this.nodes.get(key);\r\n    }\r\n\r\n    public set(key: number, value: TextureAtlasNode) {\r\n        this.nodes.set(key, value);\r\n    }\r\n\r\n    /**\r\n     * Creates atlas gl texture.\r\n     * @public\r\n     */\r\n    public createTexture(img?: HTMLImageElement | null, internalFormat?: number) {\r\n        if (this._handler) {\r\n            this._handler.gl!.deleteTexture(this.texture!);\r\n            if (img) {\r\n                this.canvas.resize(img.width, img.height);\r\n                this.canvas.drawImage(img, 0, 0, img.width, img.height);\r\n            }\r\n            this.texture = this._handler.createTexture_l(this.canvas.getCanvas(), internalFormat)!;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Asynchronous function that loads and creates image to the image cache, and call success callback when it's done.\r\n     * @public\r\n     * @param {string} src - Image object src string.\r\n     * @param {ImagesCacheManagerCallback} success - The callback that handles the image loads done.\r\n     */\r\n    public loadImage(src: string, success: ImagesCacheManagerCallback) {\r\n        this._imagesCacheManager.load(src, success);\r\n    }\r\n\r\n    public getImageTexCoordinates(img: HTMLImageElementExt): number[] | undefined {\r\n        if (img.__nodeIndex != null) {\r\n            let n = this.get(img.__nodeIndex);\r\n            if (n) {\r\n                return n.texCoords;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Atlas binary tree node.\r\n * @class\r\n * @param {Rectangle} rect - Node image rectangle.\r\n * @param {number[]} texCoords - Node image rectangle.\r\n */\r\nclass TextureAtlasNode {\r\n    public childNodes: TextureAtlasNode[] | null;\r\n    public image: HTMLImageElementExt | null;\r\n    public rect: Rectangle;\r\n    public texCoords: number[];\r\n    public atlas: TextureAtlas | null;\r\n\r\n    constructor(rect?: Rectangle, texCoords?: number[]) {\r\n        this.childNodes = null;\r\n        this.image = null;\r\n        this.rect = rect || new Rectangle();\r\n        this.texCoords = texCoords || [];\r\n        this.atlas = null;\r\n    }\r\n\r\n    public insert(img: HTMLImageElementExt): TextureAtlasNode | undefined {\r\n        if (this.childNodes) {\r\n            let newNode = this.childNodes[0].insert(img);\r\n\r\n            if (newNode) {\r\n                return newNode;\r\n            }\r\n\r\n            return this.childNodes[1].insert(img);\r\n        } else {\r\n            if (this.image != null) {\r\n                return;\r\n            }\r\n\r\n            let rc = this.rect;\r\n            const w = (img.atlasWidth || img.width) + this.atlas!.borderSize;\r\n            const h = (img.atlasHeight || img.height) + this.atlas!.borderSize;\r\n\r\n            if (w > rc.getWidth() || h > rc.getHeight()) {\r\n                return;\r\n            }\r\n\r\n            if (rc.fit(w, h)) {\r\n                this.image = img;\r\n                return this;\r\n            }\r\n\r\n            this.childNodes = new Array(2);\r\n            this.childNodes[0] = new TextureAtlasNode();\r\n            this.childNodes[0].atlas = this.atlas;\r\n            this.childNodes[1] = new TextureAtlasNode();\r\n            this.childNodes[1].atlas = this.atlas;\r\n\r\n            const dw = rc.getWidth() - w;\r\n            const dh = rc.getHeight() - h;\r\n\r\n            if (dw > dh) {\r\n                // this.childNodes[0].rect = new Rectangle(rc.left, rc.top, rc.left + w, rc.bottom);\r\n                // this.childNodes[1].rect = new Rectangle(rc.left + w, rc.top, rc.right, rc.bottom);\r\n                this.childNodes[0].rect.set(rc.left, rc.top, rc.left + w, rc.bottom);\r\n                this.childNodes[1].rect.set(rc.left + w, rc.top, rc.right, rc.bottom);\r\n\r\n            } else {\r\n                // this.childNodes[0].rect = new Rectangle(rc.left, rc.top, rc.right, rc.top + h);\r\n                // this.childNodes[1].rect = new Rectangle(rc.left, rc.top + h, rc.right, rc.bottom);\r\n                this.childNodes[0].rect.set(rc.left, rc.top, rc.right, rc.top + h);\r\n                this.childNodes[1].rect.set(rc.left, rc.top + h, rc.right, rc.bottom);\r\n\r\n            }\r\n\r\n            return this.childNodes[0].insert(img);\r\n        }\r\n    }\r\n}\r\n\r\nexport {TextureAtlas, TextureAtlasNode};\r\n","import {Deferred} from '../Deferred';\r\nimport {Rectangle} from '../Rectangle';\r\nimport {TextureAtlas, TextureAtlasNode} from './TextureAtlas';\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport type {HTMLImageElementExt} from \"./ImagesCacheManager\";\r\n\r\n//@todo: get the value from shader module\r\nconst MAX_SIZE = 11;\r\n\r\ninterface IChar {\r\n    id: number;\r\n    char: string;\r\n    width: number;\r\n    height: number;\r\n    x: number;\r\n    y: number;\r\n    chnl: number;\r\n    index: number;\r\n    page: number;\r\n    xadvance: number;\r\n    xoffset: number;\r\n    yoffset: number;\r\n}\r\n\r\ninterface IKerning {\r\n    first: number;\r\n    second: number;\r\n    amount: number;\r\n}\r\n\r\nexport interface IFontParams {\r\n    common: {\r\n        scaleH: number;\r\n        scaleW: number;\r\n    };\r\n    info: {\r\n        size: number;\r\n    };\r\n    distanceField: {\r\n        distanceRange: number;\r\n    }\r\n    chars: IChar[];\r\n    kernings: IKerning[];\r\n    pages: string[];\r\n}\r\n\r\nclass FontTextureAtlas extends TextureAtlas {\r\n    public width: number;\r\n    public height: number;\r\n    public gliphSize: number;\r\n    public distanceRange: number;\r\n    public override nodes: Map<number, FontTextureAtlasNode>;\r\n    public kernings: Record<number, Record<number, number>>;\r\n\r\n    constructor(width?: number, height?: number) {\r\n        super(width, height);\r\n        this.width = 0;\r\n        this.height = 0;\r\n        this.gliphSize = 0;\r\n        this.distanceRange = 0;\r\n        this.nodes = new Map<number, FontTextureAtlasNode>();\r\n        this.kernings = {};\r\n    }\r\n\r\n    public override get(key: number): FontTextureAtlasNode | undefined {\r\n        return this.nodes.get(key);\r\n    }\r\n}\r\n\r\ninterface IMetrics extends IChar {\r\n    nChar: string;\r\n    nCode: number;\r\n    nWidth: number;\r\n    nHeight: number\r\n    nAdvance: number;\r\n    nXOffset: number;\r\n    nYOffset: number;\r\n}\r\n\r\nclass FontTextureAtlasNode extends TextureAtlasNode {\r\n    public metrics: IMetrics;\r\n    public emptySize: number;\r\n\r\n    constructor(rect: Rectangle, texCoords: number[]) {\r\n        super(rect, texCoords);\r\n        this.emptySize = 1;\r\n        this.metrics = {\r\n            id: 0,\r\n            char: \"\",\r\n            width: 0,\r\n            height: 0,\r\n            x: 0,\r\n            y: 0,\r\n            chnl: 0,\r\n            index: 0,\r\n            page: 0,\r\n            xadvance: 0,\r\n            xoffset: 0,\r\n            yoffset: 0,\r\n\r\n            nChar: \"\",\r\n            nCode: 0,\r\n            nWidth: 0,\r\n            nHeight: 0,\r\n            nAdvance: 0,\r\n            nXOffset: 0,\r\n            nYOffset: 0\r\n        }\r\n    }\r\n}\r\n\r\nclass FontAtlas {\r\n    public atlasesArr: FontTextureAtlas[];\r\n    public samplerArr: Uint32Array;\r\n    public sdfParamsArr: Float32Array;\r\n    public catalogSrc: string;\r\n\r\n    protected atlasIndexes: Record<string, number>;\r\n    protected atlasIndexesDeferred: Record<string, Deferred<number>>;\r\n    protected tokenImageSize: number;\r\n    protected _handler: Handler | null;\r\n\r\n    constructor(catalogSrc?: string) {\r\n        this.atlasesArr = [];\r\n        this.atlasIndexes = {};\r\n        this.atlasIndexesDeferred = {};\r\n        this.tokenImageSize = 64;\r\n        this.samplerArr = new Uint32Array(MAX_SIZE);\r\n        this.sdfParamsArr = new Float32Array(MAX_SIZE * 4);\r\n        this._handler = null;\r\n        this.catalogSrc = catalogSrc || \"./\";\r\n    }\r\n\r\n    public assignHandler(handler: Handler) {\r\n        this._handler = handler;\r\n    }\r\n\r\n    public getFontIndex(face: string): Promise<number> {\r\n        let fullName = this.getFullIndex(face);\r\n\r\n        // Try to load font from the directory\r\n        if (!this.atlasIndexes[fullName]) {\r\n            this.loadFont(face, this.catalogSrc, `${face}.json`);\r\n        }\r\n\r\n        if (!this.atlasIndexesDeferred[fullName]) {\r\n            this.atlasIndexesDeferred[fullName] = new Deferred<number>();\r\n        }\r\n        return this.atlasIndexesDeferred[fullName].promise;\r\n    }\r\n\r\n    public getFullIndex(face: string): string {\r\n        return face.trim().toLowerCase();\r\n    }\r\n\r\n    protected _applyFontDataToAtlas(atlas: FontTextureAtlas, data: IFontParams, index: number = 0) {\r\n        let chars = data.chars;\r\n\r\n        atlas.height = data.common.scaleH;\r\n        atlas.width = data.common.scaleW;\r\n        atlas.gliphSize = data.info.size;\r\n        atlas.distanceRange = data.distanceField.distanceRange;\r\n\r\n        let w = atlas.width,\r\n            h = atlas.height,\r\n            s = atlas.gliphSize;\r\n\r\n        this.sdfParamsArr[index * 4] = w;\r\n        this.sdfParamsArr[index * 4 + 1] = h;\r\n        this.sdfParamsArr[index * 4 + 2] = s;\r\n        this.sdfParamsArr[index * 4 + 3] = atlas.distanceRange;\r\n\r\n        let idToChar: Record<number, string> = {};\r\n\r\n        for (let i = 0; i < chars.length; i++) {\r\n            let ci = chars[i];\r\n            let ti = ci.char;\r\n\r\n            idToChar[ci.id] = ti;\r\n\r\n            let r = new Rectangle(ci.x, ci.y, ci.x + ci.width, ci.y + ci.height);\r\n\r\n            let tc = new Array(12);\r\n\r\n            tc[0] = r.left / w;\r\n            tc[1] = r.top / h;\r\n\r\n            tc[2] = r.left / w;\r\n            tc[3] = r.bottom / h;\r\n\r\n            tc[4] = r.right / w;\r\n            tc[5] = r.bottom / h;\r\n\r\n            tc[6] = r.right / w;\r\n            tc[7] = r.bottom / h;\r\n\r\n            tc[8] = r.right / w;\r\n            tc[9] = r.top / h;\r\n\r\n            tc[10] = r.left / w;\r\n            tc[11] = r.top / h;\r\n\r\n            let taNode = new FontTextureAtlasNode(r, tc);\r\n            let ciNorm = ci.char.normalize('NFKC');\r\n            let ciCode = ciNorm.charCodeAt(0);\r\n\r\n            //taNode.metrics = ci;\r\n\r\n            let m = taNode.metrics;\r\n\r\n            m.id = ci.id;\r\n            m.char = ci.char;\r\n            m.width = ci.width;\r\n            m.height = ci.height;\r\n            m.x = ci.x;\r\n            m.y = ci.y;\r\n            m.chnl = ci.chnl;\r\n            m.index = ci.index;\r\n            m.page = ci.page;\r\n            m.xadvance = ci.xadvance;\r\n            m.xoffset = ci.xoffset;\r\n            m.yoffset = ci.yoffset;\r\n\r\n            m.nChar = ciNorm;\r\n            m.nCode = ciCode;\r\n            m.nWidth = taNode.metrics.width / s;\r\n            m.nHeight = taNode.metrics.height / s;\r\n            m.nAdvance = taNode.metrics.xadvance / s;\r\n            m.nXOffset = taNode.metrics.xoffset / s;\r\n            m.nYOffset = 1.0 - taNode.metrics.yoffset / s;\r\n\r\n            taNode.emptySize = 1;\r\n\r\n            atlas.nodes.set(ciNorm.charCodeAt(0), taNode);\r\n        }\r\n\r\n        atlas.kernings = {};\r\n\r\n        for (let i = 0; i < data.kernings.length; i++) {\r\n            let ki = data.kernings[i];\r\n\r\n            let first = ki.first,\r\n                second = ki.second;\r\n\r\n            //let charFirst = idToChar[first],\r\n            //    charSecond = idToChar[second];\r\n\r\n            // if (!atlas.kernings[charFirst]) {\r\n            //     atlas.kernings[charFirst] = {};\r\n            // }\r\n            //\r\n            // atlas.kernings[charFirst][charSecond] = ki.amount / s;\r\n\r\n            if (!atlas.kernings[first]) {\r\n                atlas.kernings[first] = {};\r\n            }\r\n\r\n            atlas.kernings[first][second] = ki.amount / s;\r\n        }\r\n    }\r\n\r\n    public initFont(faceName: string, dataJson: IFontParams, imageBase64: string) {\r\n        let index = this.atlasesArr.length;\r\n        let fullName = this.getFullIndex(faceName);\r\n\r\n        this.atlasIndexes[fullName] = index;\r\n\r\n        let def = this.atlasIndexesDeferred[fullName];\r\n        if (!def) {\r\n            def = this.atlasIndexesDeferred[fullName] = new Deferred<number>();\r\n        }\r\n\r\n        this.samplerArr[this.atlasesArr.length] = index;\r\n\r\n        // TODO: FontTextureAtlas();\r\n        let atlas = new FontTextureAtlas();\r\n\r\n        atlas.height = 0;\r\n        atlas.width = 0;\r\n        atlas.gliphSize = 0;\r\n        atlas.distanceRange = 0;\r\n        atlas.kernings = {};\r\n\r\n        atlas.assignHandler(this._handler!);\r\n\r\n        this.atlasesArr[index] = atlas;\r\n\r\n        this._applyFontDataToAtlas(atlas, dataJson, index);\r\n\r\n        let img = new Image();\r\n        img.onload = () => {\r\n            this._createTexture(atlas, img);\r\n            def.resolve(index);\r\n        };\r\n        img.src = imageBase64;\r\n    }\r\n\r\n    protected _createTexture(atlas: FontTextureAtlas, img: HTMLImageElementExt) {\r\n        atlas.createTexture(img);\r\n    }\r\n\r\n    public loadFont(faceName: string, srcDir: string, atlasUrl: string) {\r\n\r\n        let index = this.atlasesArr.length;\r\n        let fullName = this.getFullIndex(faceName);\r\n\r\n        this.atlasIndexes[fullName] = index;\r\n\r\n        let def = this.atlasIndexesDeferred[fullName];\r\n        if (!def) {\r\n            def = this.atlasIndexesDeferred[fullName] = new Deferred<number>();\r\n        }\r\n\r\n        this.samplerArr[this.atlasesArr.length] = index;\r\n\r\n        // TODO: FontTextureAtlas();\r\n        let atlas = new FontTextureAtlas();\r\n\r\n        atlas.height = 0;\r\n        atlas.width = 0;\r\n        atlas.gliphSize = 0;\r\n        atlas.distanceRange = 0;\r\n        atlas.kernings = {};\r\n\r\n        atlas.assignHandler(this._handler!);\r\n        this.atlasesArr[index] = atlas;\r\n\r\n        fetch(`${srcDir}/${atlasUrl}`)\r\n            .then((response: Response) => {\r\n                if (!response.ok) {\r\n                    throw Error(`Unable to load \"${srcDir}/${atlasUrl}\"`);\r\n                }\r\n                //return response.json(response);\r\n                return response.json();\r\n            })\r\n            .then((data: IFontParams) => {\r\n\r\n                this._applyFontDataToAtlas(atlas, data, index);\r\n\r\n                let img = new Image();\r\n                img.onload = () => {\r\n                    this._createTexture(atlas, img);\r\n                    def.resolve(index);\r\n                };\r\n\r\n                img.src = `${srcDir}/${data.pages[0]}`;\r\n                img.crossOrigin = \"Anonymous\";\r\n            })\r\n            .catch(err => {\r\n                def.reject();\r\n                return {'status': \"error\", 'msg': err.toString()};\r\n            });\r\n    }\r\n}\r\n\r\nexport {FontAtlas};\r\n","import {Program} from '../webgl/Program';\r\n\r\nexport function screenFrame(): Program {\r\n    return new Program(\"screenFrame\", {\r\n        uniforms: {\r\n            texture: \"sampler2d\"\r\n        },\r\n        attributes: {\r\n            corners: \"vec3\"\r\n        },\r\n        vertexShader:\r\n            `attribute vec2 corners;\r\n            \r\n            varying vec2 tc;\r\n            void main(void) {\r\n                gl_Position = vec4(corners, 0.0, 1.0);\r\n                tc = corners * 0.5 + 0.5;\r\n            }`,\r\n        fragmentShader:\r\n            `precision highp float;\r\n            uniform sampler2D texture;\r\n            \r\n            varying vec2 tc;\r\n            \r\n            void main(void) {\r\n                gl_FragColor = texture2D( texture, tc );\r\n            }`\r\n    });\r\n}","#version 300 es\r\n\r\nin vec2 corners;\r\n\r\nout vec2 tc;\r\n\r\nvoid main(void) {\r\n    gl_Position = vec4(corners, 0.0, 1.0);\r\n    tc = corners * 0.5 + 0.5;\r\n}","#version 300 es\r\n\r\nprecision highp float;\r\n\r\n#ifndef saturate\r\n    #define saturate(a) clamp(a, 0.0, 1.0)\r\n#endif\r\n\r\nuniform sampler2D hdrBuffer;\r\n\r\nuniform float whitepoint;\r\nuniform float exposure;\r\nuniform float gamma;\r\n\r\nvec3 LinearToneMapping(vec3 color) {\r\n    return exposure * color;\r\n}\r\n\r\nvec3 ReinhardToneMapping2(vec3 color) {\r\n    return vec3(1.0) - exp(-color * exposure);\r\n}\r\n\r\nvec3 ReinhardToneMapping(vec3 color) {\r\n    color *= exposure;\r\n    return saturate(color / (vec3(1.0) + color));\r\n}\r\n\r\n#define Uncharted2Helper(x) max(((x * (0.15 * x + 0.10 * 0.50) + 0.20 * 0.02) / (x * (0.15 * x + 0.50) + 0.20 * 0.30)) - 0.02 / 0.30, vec3(0.0))\r\n\r\nvec3 Uncharted2ToneMapping(vec3 color) {\r\n    color *= exposure;\r\n    return saturate(Uncharted2Helper(color) / Uncharted2Helper(vec3(whitepoint)));\r\n}\r\n\r\nvec3 OptimizedCineonToneMapping(vec3 color) {\r\n    color *= exposure;\r\n    color = max(vec3(0.0), color - 0.004);\r\n    return pow((color * (6.2 * color + 0.5)) / (color * (6.2 * color + 1.7) + 0.06), vec3(2.2));\r\n}\r\n\r\nvec3 ACESFilmicToneMapping(vec3 color) {\r\n    color *= exposure;\r\n    return saturate((color * (2.51 * color + 0.03)) / (color * (2.43 * color + 0.59) + 0.14));\r\n}\r\n\r\nin vec2 tc;\r\n\r\nlayout (location = 0) out vec4 fragColor;\r\n\r\nvoid main(void) {\r\n    vec4 hdrColor = texture(hdrBuffer, tc).rgba;\r\n\r\n    float oneByGamma = gamma / gamma;\r\n    float oneByWhitePoint = whitepoint / whitepoint;\r\n    vec3 mapped = ReinhardToneMapping2(hdrColor.rgb) * oneByGamma * oneByWhitePoint;\r\n    //vec3 mapped = ACESFilmicToneMapping(hdrColor.rgb) * oneByGamma * oneByWhitePoint;\r\n\r\n    mapped = pow(mapped, vec3(1.0 / gamma));\r\n\r\n    fragColor = vec4(mapped, hdrColor.a);\r\n}","import {Program} from '../../webgl/Program';\r\n\r\nimport tone_mapping_vert from './tone_mapping.vert.glsl';\r\nimport tone_mapping_frag from './tone_mapping.frag.glsl';\r\n\r\nexport function toneMapping(): Program {\r\n    return new Program(\"toneMapping\", {\r\n        uniforms: {\r\n            hdrBuffer: \"sampler2d\",\r\n            exposure: \"float\",\r\n            gamma: \"float\",\r\n            whitepoint: \"float\"\r\n        },\r\n        attributes: {\r\n            corners: \"vec3\"\r\n        },\r\n        vertexShader: tone_mapping_vert,\r\n        fragmentShader: tone_mapping_frag\r\n    });\r\n}","import {Camera} from \"../camera/Camera\";\r\nimport {Control} from \"../control/Control\";\r\nimport {cons} from \"../cons\";\r\nimport {createRendererEvents} from \"./RendererEvents\";\r\nimport type {IBaseInputState, RendererEventsHandler} from \"./RendererEvents\";\r\nimport {depth} from \"../shaders/depth\";\r\nimport {EntityCollection} from \"../entity/EntityCollection\";\r\nimport {Framebuffer, Multisample} from \"../webgl/index\";\r\nimport {FontAtlas} from \"../utils/FontAtlas\";\r\nimport {Handler} from \"../webgl/Handler\";\r\nimport type {WebGLBufferExt} from \"../webgl/Handler\";\r\nimport {input} from \"../input/input\";\r\nimport {isEmpty} from \"../utils/shared\";\r\nimport {LabelWorker} from \"../entity/LabelWorker\";\r\nimport {randomi} from \"../math\";\r\nimport {RenderNode} from \"../scene/RenderNode\";\r\nimport {screenFrame} from \"../shaders/screenFrame\";\r\nimport {toneMapping} from \"../shaders/tone_mapping/toneMapping\";\r\nimport {TextureAtlas} from \"../utils/TextureAtlas\";\r\nimport {Vec2} from \"../math/Vec2\";\r\nimport {Vec3} from \"../math/Vec3\";\r\nimport type {NumberArray3} from \"../math/Vec3\";\r\nimport {NumberArray4, Vec4} from \"../math/Vec4\";\r\n\r\ninterface IRendererParams {\r\n    controls?: Control[];\r\n    msaa?: number;\r\n    autoActivate?: boolean;\r\n    fontsSrc?: string;\r\n    gamma?: number;\r\n    exposure?: number;\r\n    dpi?: number;\r\n}\r\n\r\ninterface IPickingObject {\r\n    _pickingColor?: Vec3;\r\n    _pickingColorU?: Float32Array;\r\n}\r\n\r\ninterface IFrameCallbackHandler {\r\n    id: number;\r\n    callback: Function;\r\n    sender: any;\r\n}\r\n\r\nconst MSAA_DEFAULT = 0;\r\n\r\nlet __pickingCallbackCounter__ = 0;\r\n\r\nlet __depthCallbackCounter__ = 0;\r\n\r\nlet _tempDepth_ = new Float32Array(2);\r\n\r\n// function clientWaitAsync(gl: WebGL2RenderingContext, sync: WebGLSync, flags: number): Promise<void> {\r\n//     return new Promise<void>((resolve, reject) => {\r\n//         function check() {\r\n//             const res = gl.clientWaitSync(sync, flags, 0);\r\n//             if (res == gl.WAIT_FAILED) {\r\n//                 reject();\r\n//             } else if (res == gl.TIMEOUT_EXPIRED) {\r\n//                 requestAnimationFrame(check);\r\n//             } else {\r\n//                 resolve();\r\n//             }\r\n//         }\r\n//\r\n//         check();\r\n//     });\r\n// }\r\n\r\n/**\r\n * Represents high level WebGL context interface that starts WebGL handler working in real time.\r\n * @class\r\n * @param {Handler} handler - WebGL handler context.\r\n * @param {Object} [params] - Renderer parameters:\r\n * @fires RendererEventsHandler<RendererEventsType>#draw\r\n * @fires RendererEventsHandler<RendererEventsType>#resize\r\n * @fires RendererEventsHandler<RendererEventsType>#mousemove\r\n * @fires RendererEventsHandler<RendererEventsType>#mousestop\r\n * @fires RendererEventsHandler<RendererEventsType>#lclick\r\n * @fires RendererEventsHandler<RendererEventsType>#rclick\r\n * @fires RendererEventsHandler<RendererEventsType>#mclick\r\n * @fires RendererEventsHandler<RendererEventsType>#ldblclick\r\n * @fires RendererEventsHandler<RendererEventsType>#rdblclick\r\n * @fires RendererEventsHandler<RendererEventsType>#mdblclick\r\n * @fires RendererEventsHandler<RendererEventsType>#lup\r\n * @fires RendererEventsHandler<RendererEventsType>#rup\r\n * @fires RendererEventsHandler<RendererEventsType>#mup\r\n * @fires RendererEventsHandler<RendererEventsType>#ldown\r\n * @fires RendererEventsHandler<RendererEventsType>#rdown\r\n * @fires RendererEventsHandler<RendererEventsType>#mdown\r\n * @fires RendererEventsHandler<RendererEventsType>#lhold\r\n * @fires RendererEventsHandler<RendererEventsType>#rhold\r\n * @fires RendererEventsHandler<RendererEventsType>#mhold\r\n * @fires RendererEventsHandler<RendererEventsType>#mousewheel\r\n * @fires RendererEventsHandler<RendererEventsType>#touchstart\r\n * @fires RendererEventsHandler<RendererEventsType>#touchend\r\n * @fires RendererEventsHandler<RendererEventsType>#touchcancel\r\n * @fires RendererEventsHandler<RendererEventsType>#touchmove\r\n * @fires RendererEventsHandler<RendererEventsType>#doubletouch\r\n * @fires RendererEventsHandler<RendererEventsType>#touchleave\r\n * @fires RendererEventsHandler<RendererEventsType>#touchenter\r\n */\r\n\r\nexport interface HTMLDivElementExt extends HTMLDivElement {\r\n    attributions?: HTMLElement;\r\n}\r\n\r\nclass Renderer {\r\n\r\n    /**\r\n     * Div element with WebGL canvas. Assigned in Globe class.\r\n     * @public\r\n     * @type {HTMLElement | null}\r\n     */\r\n    public div: HTMLDivElementExt | null;\r\n\r\n    /**\r\n     * WebGL handler context.\r\n     * @public\r\n     * @type {Handler}\r\n     */\r\n    public handler: Handler;\r\n\r\n    public exposure: number;\r\n    public gamma: number;\r\n    public whitepoint: number;\r\n    public brightThreshold: number;\r\n\r\n    /**\r\n     * Render nodes drawing queue.\r\n     * @public\r\n     * @type {Array.<RenderNode>}\r\n     */\r\n    public _renderNodesArr: RenderNode[];\r\n\r\n    /**\r\n     * Render nodes store for the comfortable access by the node name.\r\n     * @public\r\n     * @type {Object.<RenderNode>}\r\n     */\r\n    public renderNodes: Record<string, RenderNode>;\r\n\r\n    /**\r\n     * Current active camera.\r\n     * @public\r\n     * @type {Camera}\r\n     */\r\n    public activeCamera: Camera;\r\n\r\n    /**\r\n     * Renderer events. Represents interface for setting events like mousemove, draw, keypress etc.\r\n     * @public\r\n     * @type {RendererEvents}\r\n     */\r\n    public events: RendererEventsHandler;\r\n\r\n    /**\r\n     * Controls array.\r\n     * @public\r\n     * @type {Object}\r\n     */\r\n    public controls: Record<string, Control>;\r\n\r\n    /**\r\n     * Provides exchange between controls.\r\n     * @public\r\n     * @type {any}\r\n     */\r\n    public controlsBag: any;\r\n\r\n    /**\r\n     * Hash table for drawing objects.\r\n     * @public\r\n     * @type {Map<string, any>}\r\n     */\r\n    public colorObjects: Map<string, any>;\r\n\r\n    /**\r\n     * Color picking objects rendering queue.\r\n     * @type {Function[]}\r\n     */\r\n    protected _pickingCallbacks: IFrameCallbackHandler[];\r\n\r\n    /**\r\n     * Picking objects(labels and billboards) framebuffer.\r\n     * @public\r\n     * @type {Framebuffer}\r\n     */\r\n    public pickingFramebuffer: Framebuffer | null;\r\n\r\n    /**\r\n     * Depth objects rendering queue.\r\n     * @type {Function[]}\r\n     */\r\n    protected _depthCallbacks: IFrameCallbackHandler[];\r\n\r\n    public depthFramebuffer: Framebuffer | null;\r\n\r\n    protected _msaa: number;\r\n\r\n    protected _internalFormat: string;\r\n    protected _format: string;\r\n    protected _type: string;\r\n\r\n    public sceneFramebuffer: Framebuffer | Multisample | null;\r\n\r\n    protected blitFramebuffer: Framebuffer | null;\r\n\r\n    protected toneMappingFramebuffer: Framebuffer | null;\r\n\r\n    protected _initialized: boolean;\r\n\r\n    /**\r\n     * Texture atlas for the billboards images. One atlas per node.\r\n     * @public\r\n     * @type {TextureAtlas}\r\n     */\r\n    public billboardsTextureAtlas: TextureAtlas;\r\n\r\n    /**\r\n     * Texture atlas for the billboards images. One atlas per node.\r\n     * @public\r\n     * @type {TextureAtlas}\r\n     */\r\n    public geoObjectsTextureAtlas: TextureAtlas;\r\n\r\n    /**\r\n     * Texture font atlas for the font families and styles. One atlas per node.\r\n     * @public\r\n     * @type {FontAtlas}\r\n     */\r\n    public fontAtlas: FontAtlas;\r\n\r\n    protected _entityCollections: EntityCollection[][];\r\n\r\n    protected _currentOutput: string;\r\n\r\n    protected _fnScreenFrame: Function | null;\r\n\r\n    public labelWorker: LabelWorker;\r\n\r\n    public screenDepthFramebuffer: Framebuffer | null;\r\n\r\n    public screenFramePositionBuffer: WebGLBufferExt | null;\r\n\r\n    public screenTexture: Record<string, WebGLTexture>;\r\n\r\n    public outputTexture: WebGLTexture | null;\r\n\r\n    protected _readPickingBuffer: () => void;\r\n\r\n    constructor(handler: Handler | string | HTMLCanvasElement, params: IRendererParams = {}) {\r\n\r\n        this.div = null;\r\n\r\n        if (handler instanceof Handler) {\r\n            this.handler = handler;\r\n        } else {\r\n            this.handler = new Handler(handler, {\r\n                pixelRatio: params.dpi || (window.devicePixelRatio + 0.15),\r\n                autoActivate: true\r\n            });\r\n        }\r\n\r\n        this.exposure = params.exposure || 3.01;\r\n\r\n        this.gamma = params.gamma || 0.47;\r\n\r\n        this.whitepoint = 1.0;\r\n\r\n        this.brightThreshold = 0.9;\r\n\r\n        this._renderNodesArr = [];\r\n\r\n        this.renderNodes = {};\r\n\r\n        this.activeCamera = new Camera({\r\n            width: this.handler.canvas?.width,\r\n            height: this.handler.canvas?.height,\r\n            eye: new Vec3(0, 0, 0),\r\n            look: new Vec3(0, 0, -1),\r\n            up: new Vec3(0, 1, 0)\r\n        });\r\n\r\n        this.events = createRendererEvents(this);\r\n\r\n        this.controls = {};\r\n\r\n        if (params.controls) {\r\n            for (let i in params.controls) {\r\n                this.controls[params.controls[i].name] = params.controls[i];\r\n            }\r\n        }\r\n\r\n        this.controlsBag = {};\r\n\r\n        this.colorObjects = new Map<string, any>();\r\n\r\n        this._pickingCallbacks = [];\r\n\r\n        this.pickingFramebuffer = null;\r\n\r\n        this._depthCallbacks = [];\r\n\r\n        this.depthFramebuffer = null;\r\n\r\n        let urlParams = new URLSearchParams(location.search);\r\n        let msaaParam = urlParams.get('og_msaa');\r\n        if (msaaParam) {\r\n            this._msaa = Number(urlParams.get('og_msaa'));\r\n        } else {\r\n            this._msaa = params.msaa != undefined ? params.msaa : MSAA_DEFAULT;\r\n        }\r\n\r\n        this._internalFormat = \"RGBA16F\";\r\n        this._format = \"RGBA\";\r\n        this._type = \"FLOAT\";\r\n\r\n        this.sceneFramebuffer = null;\r\n\r\n        this.blitFramebuffer = null;\r\n\r\n        this.toneMappingFramebuffer = null;\r\n\r\n        this._initialized = false;\r\n\r\n        /**\r\n         * Texture atlas for the billboards images. One atlas per node.\r\n         * @public\r\n         * @type {TextureAtlas}\r\n         */\r\n        this.billboardsTextureAtlas = new TextureAtlas();\r\n\r\n        /**\r\n         * Texture atlas for the billboards images. One atlas per node.\r\n         * @public\r\n         * @type {TextureAtlas}\r\n         */\r\n        this.geoObjectsTextureAtlas = new TextureAtlas();\r\n\r\n        /**\r\n         * Texture font atlas for the font families and styles. One atlas per node.\r\n         * @public\r\n         * @type {FontAtlas}\r\n         */\r\n        this.fontAtlas = new FontAtlas(params.fontsSrc);\r\n\r\n        this._entityCollections = [[]];\r\n\r\n        this._currentOutput = \"screen\";\r\n\r\n        this._fnScreenFrame = null;\r\n\r\n        this.labelWorker = new LabelWorker(4);\r\n\r\n        this.screenDepthFramebuffer = null;\r\n\r\n        this.screenFramePositionBuffer = null;\r\n\r\n        this.screenTexture = {};\r\n\r\n        this.outputTexture = null;\r\n\r\n        this._readPickingBuffer = this._readPickingBuffer_webgl2;\r\n\r\n        if (params.autoActivate || isEmpty(params.autoActivate)) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    public enableBlendOneSrcAlpha() {\r\n        let gl = this.handler.gl!;\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\r\n    }\r\n\r\n    public enableBlendDefault() {\r\n        let gl = this.handler.gl!;\r\n        gl.enable(gl.BLEND);\r\n        gl.blendEquation(gl.FUNC_ADD);\r\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE);\r\n    }\r\n\r\n    public setRelativeCenter(c?: Vec3) {\r\n        this.events.dispatch(this.events.changerelativecenter, c || this.activeCamera.eye);\r\n    }\r\n\r\n    /**\r\n     * Sets renderer events activity.\r\n     * @param {Boolean} activity - Events activity.\r\n     */\r\n    public setEventsActivity(activity: boolean) {\r\n        this.events.active = activity;\r\n    }\r\n\r\n    public addDepthCallback(sender: any, callback: Function) {\r\n        let id = __depthCallbackCounter__++;\r\n        this._depthCallbacks.push({\r\n            id: id, callback: callback, sender: sender\r\n        });\r\n        return id;\r\n    }\r\n\r\n    public removeDepthCallback(id: number) {\r\n        for (let i = 0; i < this._depthCallbacks.length; i++) {\r\n            if (id === this._depthCallbacks[i].id) {\r\n                this._depthCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds picking rendering callback function.\r\n     * @param {object} sender - Callback context.\r\n     * @param {Function} callback - Rendering callback.\r\n     * @returns {Number} Handler id\r\n     */\r\n    public addPickingCallback(sender: any, callback: Function) {\r\n        let id = __pickingCallbackCounter__++;\r\n        this._pickingCallbacks.push({\r\n            id: id, callback: callback, sender: sender\r\n        });\r\n        return id;\r\n    }\r\n\r\n    /**\r\n     * Removes picking rendering callback function.\r\n     * @param {Number} id - Handler id to remove.\r\n     */\r\n    public removePickingCallback(id: number) {\r\n        for (let i = 0; i < this._pickingCallbacks.length; i++) {\r\n            if (id === this._pickingCallbacks[i].id) {\r\n                this._pickingCallbacks.splice(i, 1);\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    public getPickingObject<T>(r: number, g: number, b: number): T {\r\n        return this.colorObjects.get(`${r}_${g}_${b}`);\r\n    }\r\n\r\n    public getPickingObjectArr<T>(arr: NumberArray3 | Uint8Array): T {\r\n        return this.colorObjects.get(`${arr[0]}_${arr[1]}_${arr[2]}`);\r\n    }\r\n\r\n    public getPickingObject3v<T>(vec: Vec3 | Vec4): T {\r\n        return this.colorObjects.get(`${vec.x}_${vec.y}_${vec.z}`);\r\n    }\r\n\r\n    /**\r\n     * Assign picking color to the object.\r\n     * @public\r\n     * @param {Object} obj - Object that presume to be picked.\r\n     */\r\n    public assignPickingColor<T>(obj: T & IPickingObject) {\r\n        if (!obj._pickingColor || obj._pickingColor.isZero()) {\r\n            let r = 0, g = 0, b = 0;\r\n            let str = \"0_0_0\";\r\n            while (!(r || g || b) || this.colorObjects.has(str)) {\r\n                r = randomi(1, 255);\r\n                g = randomi(1, 255);\r\n                b = randomi(1, 255);\r\n                str = `${r}_${g}_${b}`;\r\n            }\r\n\r\n            if (!obj._pickingColor) {\r\n                obj._pickingColor = new Vec3(r, g, b);\r\n            } else {\r\n                obj._pickingColor.set(r, g, b);\r\n            }\r\n\r\n            obj._pickingColorU = new Float32Array([r / 255, g / 255, b / 255]);\r\n\r\n            this.colorObjects.set(str, obj);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Removes picking color from object.\r\n     * @public\r\n     * @param {Object} obj - Object to remove picking color.\r\n     */\r\n    public clearPickingColor<T>(obj: T & IPickingObject) {\r\n        if (obj._pickingColor && !obj._pickingColor.isZero()) {\r\n            let c = obj._pickingColor;\r\n            if (!c.isZero()) {\r\n                this.colorObjects.delete(`${c.x}_${c.y}_${c.z}`);\r\n                c.x = c.y = c.z = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the client width.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getWidth(): number {\r\n        return this.handler.canvas!.clientWidth;\r\n    }\r\n\r\n    /**\r\n     * Get the client height.\r\n     * @public\r\n     * @returns {number} -\r\n     */\r\n    public getHeight(): number {\r\n        return this.handler.canvas!.clientHeight;\r\n    }\r\n\r\n    /**\r\n     * Get center of the canvas\r\n     * @public\r\n     * @returns {Vec2} -\r\n     */\r\n    public getCenter(): Vec2 {\r\n        let cnv = this.handler.canvas!;\r\n        return new Vec2(Math.round(cnv.width * 0.5), Math.round(cnv.height * 0.5));\r\n    }\r\n\r\n    /**\r\n     * Get center of the screen viewport\r\n     * @public\r\n     * @returns {Vec2} -\r\n     */\r\n    public getClientCenter(): Vec2 {\r\n        let cnv = this.handler.canvas!;\r\n        return new Vec2(Math.round(cnv.clientWidth * 0.5), Math.round(cnv.clientHeight * 0.5));\r\n    }\r\n\r\n    /**\r\n     * Add the given control to the renderer.\r\n     * @param {Control} control - Control.\r\n     */\r\n    public addControl(control: Control) {\r\n        control.addTo(this);\r\n    }\r\n\r\n    /**\r\n     * Add the given controls array to the planet node.\r\n     * @param {Array.<Control>} cArr - Control array.\r\n     */\r\n    public addControls(cArr: Control[]) {\r\n        for (let i = 0; i < cArr.length; i++) {\r\n            cArr[i].addTo(this);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove control from the renderer.\r\n     * @param {Control} control  - Control.\r\n     */\r\n    public removeControl(control: Control) {\r\n        control.remove();\r\n    }\r\n\r\n    public isInitialized(): boolean {\r\n        return this._initialized;\r\n    }\r\n\r\n    /**\r\n     * Renderer initialization.\r\n     * @public\r\n     */\r\n    public initialize() {\r\n\r\n        if (this._initialized) {\r\n            return;\r\n        } else {\r\n            this._initialized = true;\r\n        }\r\n\r\n        this.handler.initialize();\r\n\r\n        this.billboardsTextureAtlas.assignHandler(this.handler);\r\n        this.geoObjectsTextureAtlas.assignHandler(this.handler);\r\n\r\n        this.fontAtlas.assignHandler(this.handler);\r\n\r\n        this.handler.setFrameCallback(() => {\r\n            this.draw();\r\n        });\r\n\r\n        this.events.initialize();\r\n\r\n        // Bind console key\r\n        this.events.on(\"charkeypress\", input.KEY_APOSTROPHE, function () {\r\n            cons.setVisibility(!cons.getVisibility());\r\n        });\r\n\r\n        this.handler.addProgram(screenFrame());\r\n\r\n        this.pickingFramebuffer = new Framebuffer(this.handler, {\r\n            width: 640,\r\n            height: 480,\r\n            targets: [{\r\n                readAsync: true\r\n            }]\r\n        });\r\n        this.pickingFramebuffer.init();\r\n\r\n        this.depthFramebuffer = new Framebuffer(this.handler, {\r\n            width: 640,\r\n            height: 480,\r\n            targets: [{\r\n                internalFormat: \"RGBA\",\r\n                type: \"UNSIGNED_BYTE\",\r\n                attachment: \"COLOR_ATTACHMENT\",\r\n                readAsync: true\r\n            }, {\r\n                internalFormat: \"RGBA16F\",\r\n                type: \"FLOAT\",\r\n                attachment: \"COLOR_ATTACHMENT\",\r\n                readAsync: true\r\n            }],\r\n            useDepth: true\r\n        });\r\n\r\n        this.depthFramebuffer.init();\r\n\r\n        this.screenDepthFramebuffer = new Framebuffer(this.handler, {\r\n            useDepth: false\r\n        });\r\n        this.screenDepthFramebuffer.init();\r\n\r\n        if (this.handler.gl!.type === \"webgl\") {\r\n            this._readPickingBuffer = this._readPickingBuffer_webgl1;\r\n\r\n            this.sceneFramebuffer = new Framebuffer(this.handler);\r\n            this.sceneFramebuffer.init();\r\n\r\n            this._fnScreenFrame = this._screenFrameNoMSAA;\r\n\r\n            this.screenTexture = {\r\n                screen: this.sceneFramebuffer!.textures[0],\r\n                picking: this.pickingFramebuffer!.textures[0],\r\n                depth: this.screenDepthFramebuffer!.textures[0]\r\n            };\r\n        } else {\r\n            let _maxMSAA = this.getMaxMSAA(this._internalFormat);\r\n\r\n            if (this._msaa > _maxMSAA) {\r\n                this._msaa = _maxMSAA;\r\n            }\r\n\r\n            this.handler.addPrograms([toneMapping()]);\r\n\r\n            this.handler.addPrograms([depth()]);\r\n\r\n            this.sceneFramebuffer = new Multisample(this.handler, {\r\n                size: 1,\r\n                msaa: this._msaa,\r\n                internalFormat: this._internalFormat,\r\n                filter: \"LINEAR\"\r\n            });\r\n\r\n            this.sceneFramebuffer.init();\r\n\r\n            this.blitFramebuffer = new Framebuffer(this.handler, {\r\n                size: 1,\r\n                useDepth: false,\r\n                targets: [{\r\n                    internalFormat: this._internalFormat,\r\n                    format: this._format,\r\n                    type: this._type,\r\n                    filter: \"NEAREST\"\r\n                }]\r\n            });\r\n\r\n            this.blitFramebuffer.init();\r\n\r\n            this.toneMappingFramebuffer = new Framebuffer(this.handler, {\r\n                useDepth: false\r\n            });\r\n\r\n            this.toneMappingFramebuffer.init();\r\n\r\n            this._fnScreenFrame = this._screenFrameMSAA;\r\n\r\n            this.screenTexture = {\r\n                screen: this.toneMappingFramebuffer!.textures[0],\r\n                picking: this.pickingFramebuffer!.textures[0],\r\n                depth: this.screenDepthFramebuffer!.textures[0],\r\n                frustum: this.depthFramebuffer!.textures[0]\r\n            };\r\n        }\r\n\r\n        this.handler.ONCANVASRESIZE = () => {\r\n            this._resizeStart();\r\n            this.events.dispatch(this.events.resize, this.handler.canvas);\r\n            this._resizeEnd();\r\n            //clearTimeout(__resizeTimeout);\r\n            // __resizeTimeout = setTimeout(() => {\r\n            //     this._resizeEnd();\r\n            //     this.events.dispatch(this.events.resizeend, this.handler.canvas);\r\n            // }, 320);\r\n            this.events.dispatch(this.events.resizeend, this.handler.canvas);\r\n        };\r\n\r\n        this.screenFramePositionBuffer = this.handler.createArrayBuffer(new Float32Array([1, 1, -1, 1, 1, -1, -1, -1]), 2, 4);\r\n\r\n        this.outputTexture = this.screenTexture.screen;\r\n\r\n        this._initializeRenderNodes();\r\n\r\n        this._initializeControls();\r\n    }\r\n\r\n    public _initializeControls() {\r\n        let temp = this.controls;\r\n        this.controls = {};\r\n        for (let i in temp) {\r\n            this.addControl(temp[i]);\r\n        }\r\n    }\r\n\r\n    public resize() {\r\n        this._resizeEnd();\r\n    }\r\n\r\n    public setCurrentScreen(screenName: string) {\r\n        this._currentOutput = screenName;\r\n        if (this.screenTexture[screenName]) {\r\n            this.outputTexture = this.screenTexture[screenName];\r\n        }\r\n    }\r\n\r\n    public _resizeStart() {\r\n        let c = this.handler.canvas!;\r\n\r\n        this.activeCamera!.setViewportSize(c.width, c.height);\r\n        this.sceneFramebuffer!.setSize(c.width * 0.5, c.height * 0.5);\r\n        this.blitFramebuffer && this.blitFramebuffer.setSize(c.width * 0.5, c.height * 0.5, true);\r\n    }\r\n\r\n    public _resizeEnd() {\r\n        let c = this.handler.canvas!;\r\n\r\n        this.activeCamera!.setViewportSize(c.width, c.height);\r\n        this.sceneFramebuffer!.setSize(c.width, c.height);\r\n        this.blitFramebuffer && this.blitFramebuffer.setSize(c.width, c.height, true);\r\n\r\n        this.toneMappingFramebuffer && this.toneMappingFramebuffer.setSize(c.width, c.height, true);\r\n        this.screenDepthFramebuffer && this.screenDepthFramebuffer.setSize(c.clientWidth, c.clientHeight, true);\r\n        //this.depthFramebuffer && this.depthFramebuffer.setSize(c.clientWidth, c.clientHeight, true);\r\n\r\n        if (this.handler.gl!.type === \"webgl\") {\r\n            this.screenTexture.screen = (this.sceneFramebuffer as Framebuffer)!.textures[0];\r\n            this.screenTexture.picking = this.pickingFramebuffer!.textures[0];\r\n            this.screenTexture.depth = this.screenDepthFramebuffer!.textures[0];\r\n            this.screenTexture.frustum = this.depthFramebuffer!.textures[0];\r\n        } else {\r\n            this.screenTexture.screen = this.toneMappingFramebuffer!.textures[0];\r\n            this.screenTexture.picking = this.pickingFramebuffer!.textures[0];\r\n            this.screenTexture.depth = this.screenDepthFramebuffer!.textures[0];\r\n            this.screenTexture.frustum = this.depthFramebuffer!.textures[0];\r\n        }\r\n\r\n        this.setCurrentScreen(this._currentOutput);\r\n    }\r\n\r\n    public removeNode(renderNode: RenderNode) {\r\n        // TODO: replace from RenderNode to this method\r\n        renderNode.remove();\r\n    }\r\n\r\n    /**\r\n     * Adds render node to the renderer.\r\n     * @public\r\n     * @param {RenderNode} renderNode - Render node.\r\n     */\r\n    public addNode(renderNode: RenderNode) {\r\n        if (!this.renderNodes[renderNode.name]) {\r\n            renderNode.assign(this);\r\n            this._renderNodesArr.unshift(renderNode);\r\n            this.renderNodes[renderNode.name] = renderNode;\r\n        } else {\r\n            cons.logWrn(`Node name ${renderNode.name} already exists.`);\r\n        }\r\n    }\r\n\r\n    protected _initializeRenderNodes() {\r\n        for (let i = 0; i < this._renderNodesArr.length; i++) {\r\n            this._renderNodesArr[i].initialize();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds render node to the renderer before specific node.\r\n     * @public\r\n     * @param {RenderNode} renderNode - Render node.\r\n     * @param {RenderNode} renderNodeBefore - Insert before the renderNodeBefore node.\r\n     */\r\n    public addNodeBefore(renderNode: RenderNode, renderNodeBefore: RenderNode) {\r\n        if (!this.renderNodes[renderNode.name]) {\r\n            renderNode.assign(this);\r\n            this.renderNodes[renderNode.name] = renderNode;\r\n            for (let i = 0; i < this._renderNodesArr.length; i++) {\r\n                if (this._renderNodesArr[i].isEqual(renderNodeBefore)) {\r\n                    this._renderNodesArr.splice(i, 0, renderNode);\r\n                    break;\r\n                }\r\n            }\r\n            this._renderNodesArr.unshift(renderNode);\r\n        } else {\r\n            cons.logWrn(`Node name ${renderNode.name} already exists.`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds render nodes array to the renderer.\r\n     * @public\r\n     * @param {Array.<RenderNode>} nodesArr - Render nodes array.\r\n     */\r\n    public addNodes(nodesArr: RenderNode[]) {\r\n        for (let i = 0; i < nodesArr.length; i++) {\r\n            this.addNode(nodesArr[i]);\r\n        }\r\n    }\r\n\r\n    public getMaxMSAA(internalFormat: string) {\r\n        let gl = this.handler.gl!;\r\n        let samples = gl.getInternalformatParameter(gl.RENDERBUFFER, (gl as any)[internalFormat], gl.SAMPLES);\r\n        return samples[0];\r\n    }\r\n\r\n    public getMSAA(): number {\r\n        return this._msaa;\r\n    }\r\n\r\n    /**\r\n     * TODO: replace with cache friendly linked list by BillboardHandler, LabelHandler etc.\r\n     */\r\n    public enqueueEntityCollectionsToDraw(ecArr: EntityCollection[], depthOrder: number = 0) {\r\n        if (!this._entityCollections[depthOrder]) {\r\n            this._entityCollections[depthOrder] = [];\r\n        }\r\n        this._entityCollections[depthOrder].push(...ecArr);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _drawEntityCollections(depthOrder: number) {\r\n        let ec = this._entityCollections[depthOrder];\r\n\r\n        if (ec.length) {\r\n            let gl = this.handler.gl!;\r\n\r\n            this.enableBlendDefault();\r\n\r\n            // Point Clouds\r\n            let i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].pointCloudHandler.draw();\r\n            }\r\n\r\n            // GeoObjects\r\n            i = ec.length;\r\n            while (i--) {\r\n                let eci = ec[i];\r\n                if (ec[i]._fadingOpacity) {\r\n                    eci.events.dispatch(eci.events.draw, eci);\r\n                    ec[i].geoObjectHandler.draw();\r\n                }\r\n            }\r\n\r\n            // billboards pass\r\n            gl.activeTexture(gl.TEXTURE0);\r\n            gl.bindTexture(gl.TEXTURE_2D, this.billboardsTextureAtlas.texture!);\r\n\r\n            i = ec.length;\r\n            while (i--) {\r\n                let eci = ec[i];\r\n                eci._fadingOpacity && eci.billboardHandler.draw();\r\n            }\r\n\r\n            // labels pass\r\n            let fa = this.fontAtlas.atlasesArr;\r\n            for (i = 0; i < fa.length; i++) {\r\n                gl.activeTexture(gl.TEXTURE0 + i);\r\n                gl.bindTexture(gl.TEXTURE_2D, fa[i].texture!);\r\n            }\r\n\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].labelHandler.draw();\r\n            }\r\n\r\n            // rays\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].rayHandler.draw();\r\n            }\r\n\r\n            // polyline pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].polylineHandler.draw();\r\n            }\r\n\r\n            // Strip pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].stripHandler.draw();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _drawPickingEntityCollections(depthOrder: number) {\r\n        let ec = this._entityCollections[depthOrder];\r\n        if (ec.length) {\r\n            // billboard pass\r\n            let i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].billboardHandler.drawPicking();\r\n            }\r\n            // geoObject pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].geoObjectHandler.drawPicking();\r\n            }\r\n            // label pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].labelHandler.drawPicking();\r\n            }\r\n            // ray pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].rayHandler.drawPicking();\r\n            }\r\n            // polyline pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._visibility && ec[i].polylineHandler.drawPicking();\r\n            }\r\n            //Strip pass\r\n            i = ec.length;\r\n            while (i--) {\r\n                ec[i]._visibility && ec[i].stripHandler.drawPicking();\r\n            }\r\n            // //pointClouds pass\r\n            // i = ec.length;\r\n            // while (i--) {\r\n            //    ec[i]._visibility && ec[i].pointCloudHandler.drawPicking();\r\n            // }\r\n        }\r\n    }\r\n\r\n    protected _drawDepthEntityCollections(depthOrder: number) {\r\n        let ec = this._entityCollections[depthOrder];\r\n        if (ec.length) {\r\n            // geoObject pass\r\n            let i = ec.length;\r\n            while (i--) {\r\n                ec[i]._fadingOpacity && ec[i].geoObjectHandler.drawDepth();\r\n            }\r\n\r\n            // i = ec.length;\r\n            // while (i--) {\r\n            //     ec[i]._fadingOpacity && ec[i].rayHandler.drawDepth();\r\n            // }\r\n            //\r\n            // // polyline pass\r\n            // i = ec.length;\r\n            // while (i--) {\r\n            //     ec[i]._visibility && ec[i].polylineHandler.drawDepth();\r\n            // }\r\n            //\r\n            // //Strip pass\r\n            // i = ec.length;\r\n            // while (i--) {\r\n            //     ec[i]._visibility && ec[i].stripHandler.drawDepth();\r\n            // }\r\n        }\r\n    }\r\n\r\n    protected _clearEntityCollectionQueue(depthOrder: number) {\r\n        this._entityCollections[depthOrder].length = 0;\r\n        this._entityCollections[depthOrder] = [];\r\n    }\r\n\r\n    /**\r\n     * Draw nodes.\r\n     * @public\r\n     */\r\n    public draw() {\r\n        this.activeCamera!.checkMoveEnd();\r\n\r\n        let e = this.events;\r\n        e.handleEvents();\r\n\r\n        let sceneFramebuffer = this.sceneFramebuffer!;\r\n        sceneFramebuffer.activate();\r\n\r\n        let h = this.handler,\r\n            gl = h.gl!;\r\n\r\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n\r\n        this.enableBlendDefault();\r\n\r\n        e.dispatch(e.draw, this);\r\n\r\n        let frustums = this.activeCamera!.frustums;\r\n\r\n        let pointerEvent = e.pointerEvent();\r\n        let mouseFree = !e.mouseState.leftButtonDown && !e.mouseState.rightButtonDown;\r\n\r\n        // Rendering scene nodes and entityCollections\r\n        let rn = this._renderNodesArr;\r\n        let k = frustums.length;\r\n\r\n        //\r\n        // RenderNodes PASS\r\n        //\r\n        while (k--) {\r\n            this.activeCamera!.setCurrentFrustum(k);\r\n            gl.clear(gl.DEPTH_BUFFER_BIT);\r\n\r\n            let i = rn.length;\r\n            while (i--) {\r\n                rn[i].preDrawNode();\r\n            }\r\n\r\n            i = rn.length;\r\n            while (i--) {\r\n                this.enableBlendDefault();\r\n                rn[i].drawNode();\r\n            }\r\n\r\n            this._drawEntityCollections(0);\r\n\r\n            e.dispatch(e.drawtransparent, this);\r\n\r\n            if (pointerEvent && mouseFree) {\r\n                this._drawPickingBuffer(0);\r\n            }\r\n\r\n            this._drawDepthBuffer(0);\r\n\r\n            this._clearEntityCollectionQueue(0);\r\n        }\r\n\r\n        //\r\n        // EntityCollections PASS\r\n        //\r\n        for (let i = 1; i < this._entityCollections.length; i++) {\r\n            gl.clear(gl.DEPTH_BUFFER_BIT);\r\n            let k = frustums.length;\r\n            while (k--) {\r\n                this.activeCamera!.setCurrentFrustum(k);\r\n\r\n                this._drawEntityCollections(i);\r\n\r\n                if (pointerEvent && mouseFree) {\r\n                    this._drawPickingBuffer(i);\r\n                }\r\n\r\n                this._drawDepthBuffer(i);\r\n            }\r\n\r\n            this._clearEntityCollectionQueue(i);\r\n        }\r\n\r\n        sceneFramebuffer.deactivate();\r\n\r\n        this.blitFramebuffer && (sceneFramebuffer as Multisample).blitTo(this.blitFramebuffer, 0);\r\n\r\n        if (pointerEvent && mouseFree) {\r\n            this._readPickingBuffer();\r\n        }\r\n\r\n        if (mouseFree) {\r\n            this._readDepthBuffer();\r\n        }\r\n\r\n        // Tone mapping followed by rendering on the screen\r\n        this._fnScreenFrame!();\r\n\r\n        e.dispatch(e.postdraw, this);\r\n\r\n        e.mouseState.wheelDelta = 0;\r\n        e.mouseState.justStopped = false;\r\n        e.mouseState.moving = false;\r\n        e.touchState.moving = false;\r\n    }\r\n\r\n    public getImageDataURL(type: string = \"image/png\", quality: number = 1.0): string {\r\n        this.draw();\r\n        return this.handler.canvas ? this.handler.canvas.toDataURL(type, quality) : \"\";\r\n    }\r\n\r\n    protected _screenFrameMSAA() {\r\n        let h = this.handler;\r\n\r\n        let sh = h.programs.toneMapping,\r\n            p = sh._program,\r\n            gl = h.gl!;\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.screenFramePositionBuffer!);\r\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\r\n\r\n        this.toneMappingFramebuffer!.activate();\r\n\r\n        sh.activate();\r\n\r\n        // screen texture\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this.blitFramebuffer!.textures[0]);\r\n        gl.uniform1i(p.uniforms.hdrBuffer, 0);\r\n\r\n        gl.uniform1f(p.uniforms.gamma, this.gamma);\r\n        gl.uniform1f(p.uniforms.exposure, this.exposure);\r\n        gl.uniform1f(p.uniforms.whitepoint, this.whitepoint);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        this.toneMappingFramebuffer!.deactivate();\r\n\r\n        // SCREEN PASS\r\n        sh = h.programs.screenFrame;\r\n        p = sh._program;\r\n        sh.activate();\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this.outputTexture);\r\n        gl.uniform1i(p.uniforms.texture, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n\r\n        gl.enable(gl.DEPTH_TEST);\r\n    }\r\n\r\n    protected _screenFrameNoMSAA() {\r\n\r\n        let h = this.handler;\r\n        let sh = h.programs.screenFrame,\r\n            p = sh._program,\r\n            gl = h.gl!;\r\n\r\n        gl.disable(gl.DEPTH_TEST);\r\n        sh.activate();\r\n        gl.activeTexture(gl.TEXTURE0);\r\n        gl.bindTexture(gl.TEXTURE_2D, this.outputTexture);\r\n        gl.uniform1i(p.uniforms.texture, 0);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.screenFramePositionBuffer!);\r\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        gl.enable(gl.DEPTH_TEST);\r\n    }\r\n\r\n    /**\r\n     * Draw picking objects framebuffer.\r\n     * @private\r\n     */\r\n    protected _drawPickingBuffer(depthOrder: number) {\r\n        this.pickingFramebuffer!.activate();\r\n\r\n        let h = this.handler;\r\n        let gl = h.gl!;\r\n\r\n        if (this.activeCamera!.isFirstPass && depthOrder === 0) {\r\n            gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n        } else {\r\n            gl.clear(gl.DEPTH_BUFFER_BIT);\r\n        }\r\n\r\n        //\r\n        // draw picking scenes, usually we don't need blending,\r\n        // but sometimes set it manually in the callbacks\r\n        //\r\n        gl.disable(gl.BLEND);\r\n\r\n        if (depthOrder === 0) {\r\n            let dp = this._pickingCallbacks;\r\n            for (let i = 0, len = dp.length; i < len; i++) {\r\n                /**\r\n                 * This callback renders picking frame.\r\n                 */\r\n                dp[i].callback.call(dp[i].sender);\r\n            }\r\n        }\r\n\r\n        this._drawPickingEntityCollections(depthOrder);\r\n\r\n        gl.enable(gl.BLEND);\r\n\r\n        this.pickingFramebuffer!.deactivate();\r\n    }\r\n\r\n    protected _drawDepthBuffer(depthOrder: number) {\r\n        this.depthFramebuffer!.activate();\r\n\r\n        let h = this.handler;\r\n        let gl = h.gl!;\r\n\r\n        gl.disable(gl.BLEND);\r\n\r\n        if (this.activeCamera!.isFirstPass && depthOrder === 0) {\r\n            gl.clearColor(0.0, 0.0, 0.0, 1.0);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\r\n        } else {\r\n            gl.clear(gl.DEPTH_BUFFER_BIT);\r\n        }\r\n\r\n        if (depthOrder === 0) {\r\n            let dp = this._depthCallbacks;\r\n            let i = dp.length;\r\n            while (i--) {\r\n                /**\r\n                 * This callback renders depth frame.\r\n                 */\r\n                dp[i].callback.call(dp[i].sender);\r\n            }\r\n        }\r\n\r\n        this._drawDepthEntityCollections(depthOrder);\r\n\r\n        this.depthFramebuffer!.deactivate();\r\n\r\n        //\r\n        // DEBUG SCREEN OUTPUTS\r\n        //\r\n        // if (this._currentOutput === \"depth\" || this._currentOutput === \"frustum\") {\r\n        //     //\r\n        //     // PASS to depth visualization\r\n        //     this.screenDepthFramebuffer!.activate();\r\n        //     let sh = h.programs.depth,\r\n        //         p = sh._program;\r\n        //\r\n        //     gl.bindBuffer(gl.ARRAY_BUFFER, this.screenFramePositionBuffer!);\r\n        //     gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\r\n        //\r\n        //     sh.activate();\r\n        //\r\n        //     gl.activeTexture(gl.TEXTURE0);\r\n        //     gl.bindTexture(gl.TEXTURE_2D, this.depthFramebuffer!.textures[1]);\r\n        //     gl.uniform1i(p.uniforms.depthTexture, 0);\r\n        //\r\n        //     gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n        //\r\n        //     this.screenDepthFramebuffer!.deactivate();\r\n        //     gl.enable(gl.BLEND);\r\n        // }\r\n    }\r\n\r\n    protected _readDepthBuffer() {\r\n        this.depthFramebuffer!.readPixelBuffersAsync();\r\n    }\r\n\r\n    protected _readPickingBuffer_webgl1() {\r\n        this.pickingFramebuffer!.readPixelBuffersAsync();\r\n    }\r\n\r\n    protected _readPickingBuffer_webgl2() {\r\n        this.pickingFramebuffer!.readPixelBuffersAsync();\r\n    }\r\n\r\n    public readPickingColor(x: number, y: number, outColor: NumberArray3 | Uint8Array) {\r\n        let w = this.pickingFramebuffer!.width;\r\n        let h = this.pickingFramebuffer!.height;\r\n\r\n        x = Math.round(x * w);\r\n        y = Math.round(y * h);\r\n\r\n        let ind = (y * w + x) * 4;\r\n\r\n        let _tempPickingPix_ = this.pickingFramebuffer?.pixelBuffers[0].data;\r\n\r\n        if (_tempPickingPix_) {\r\n            outColor[0] = _tempPickingPix_[ind];\r\n            outColor[1] = _tempPickingPix_[ind + 1];\r\n            outColor[2] = _tempPickingPix_[ind + 2];\r\n        }\r\n    }\r\n\r\n    public readDepth(x: number, y: number, outDepth: NumberArray3 | Float32Array) {\r\n\r\n        // let depthFramebuffer = this.depthFramebuffer!;\r\n        //\r\n        // let w = depthFramebuffer.width;\r\n        // let h = depthFramebuffer.height;\r\n        //\r\n        // let sx = Math.round(x * w);\r\n        // let sy = Math.round(y * h);\r\n        //\r\n        // let ind = (sy * w + sx) * 4;\r\n        //\r\n        // let _tempDepthPix_ = depthFramebuffer.pixelBuffers[1].data;\r\n        // let _tempFrustumPix_ = depthFramebuffer.pixelBuffers[0].data!;\r\n        //\r\n        // if (_tempDepthPix_) {\r\n        //     outDepth[0] = _tempDepthPix_[ind];\r\n        //     outDepth[1] = Math.round(_tempFrustumPix_[ind] / 10.0) - 1.0; // See Camera.frustumColorIndex\r\n        // }\r\n\r\n        //////\r\n\r\n        let ddd = new Float32Array(4);\r\n        let fff = new Uint8Array(4);\r\n\r\n        this.depthFramebuffer!.readData(x, y, fff, 0);\r\n        this.depthFramebuffer!.readData(x, y, ddd, 1);\r\n\r\n        outDepth[0] = ddd[0];\r\n        outDepth[1] = Math.round(fff[0] / 10.0) - 1.0; // See Camera.frustumColorIndex\r\n    }\r\n\r\n    /**\r\n     * Returns the distance from the active (screen) camera to the 3d-surface using the defined screen coordinates\r\n     * @public\r\n     * @param {Vec2 | IBaseInputState} px - Screen coordinates.\r\n     * @returns {number | undefined} -\r\n     */\r\n    public getDistanceFromPixel(px: Vec2 | IBaseInputState): number | undefined {\r\n\r\n       let camera = this.activeCamera!;\r\n\r\n        let cnv = this.handler!.canvas!;\r\n\r\n        let nx = px.x / cnv.width;\r\n        let ny = (cnv.height - px.y) / cnv.height;\r\n\r\n        _tempDepth_[0] = _tempDepth_[1] = 0.0;\r\n\r\n        let dist = 0;\r\n\r\n        this.readDepth(nx, ny, _tempDepth_);\r\n\r\n        if (_tempDepth_[1] === -1) {\r\n            return;\r\n        }\r\n\r\n        let depth = _tempDepth_[0],\r\n            frustum = camera.frustums[_tempDepth_[1]];\r\n\r\n        if (!frustum) return;\r\n\r\n        let screenPos = new Vec4(nx * 2.0 - 1.0, ny * 2.0 - 1.0, depth * 2.0 - 1.0, 1.0);\r\n        let viewPosition = frustum.inverseProjectionMatrix.mulVec4(screenPos);\r\n        let dir = (px as IBaseInputState).direction || camera.unproject(px.x, px.y);\r\n        dist = -(viewPosition.z / viewPosition.w) / dir.dot(camera.getForward());\r\n\r\n        return dist;\r\n    }\r\n\r\n    /**\r\n     * Returns 3d coordinates from screen coordinates\r\n     * @public\r\n     * @param {Vec2 | IBaseInputState} px - Screen coordinates.\r\n     * @returns {Vec3 | undefined} -\r\n     */\r\n    public getCartesianFromPixel(px: Vec2 | IBaseInputState): Vec3 | undefined {\r\n        let distance = this.getDistanceFromPixel(px);\r\n        if (distance) {\r\n            let direction = (px as IBaseInputState).direction || this.activeCamera.unproject(px.x, px.y);\r\n            return direction.scaleTo(distance).addA(this.activeCamera.eye);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function starts renderer\r\n     * @public\r\n     */\r\n    public start() {\r\n        if (!this._initialized) {\r\n            this.initialize();\r\n        }\r\n        this.handler.start();\r\n    }\r\n\r\n    public destroy() {\r\n        for (let i in this.controls) {\r\n            this.controls[i].remove();\r\n        }\r\n\r\n        for (let i = 0; i < this._renderNodesArr.length; i++) {\r\n            this._renderNodesArr[i].remove();\r\n        }\r\n\r\n        this.div = null;\r\n\r\n        this._renderNodesArr = [];\r\n\r\n        this.renderNodes = {};\r\n\r\n        //@ts-ignore\r\n        this.activeCamera = null;\r\n\r\n        this.controls = {};\r\n\r\n        this.controlsBag = {};\r\n\r\n        this.colorObjects.clear();\r\n\r\n        // @ts-ignore\r\n        this.colorObjects = null;\r\n\r\n        this._pickingCallbacks = [];\r\n\r\n        this.pickingFramebuffer = null;\r\n\r\n        //@ts-ignore\r\n        this._tempPickingPix_ = null;\r\n\r\n        this._depthCallbacks = [];\r\n\r\n        this.depthFramebuffer = null;\r\n\r\n        this.sceneFramebuffer = null;\r\n\r\n        this.blitFramebuffer = null;\r\n\r\n        this.toneMappingFramebuffer = null;\r\n\r\n        // todo\r\n        //this.billboardsTextureAtlas.clear();\r\n        //this.geoObjectsTextureAtlas.clear()\r\n        //this.fontAtlas.clear();\r\n\r\n        this._entityCollections = [[]];\r\n\r\n        this.handler.ONCANVASRESIZE = null;\r\n        this.handler.destroy();\r\n\r\n        // @ts-ignore\r\n        this.handler = null;\r\n\r\n        this._initialized = false;\r\n    }\r\n\r\n}\r\n\r\nexport {Renderer};\r\n","import {CompassButton} from \"./control/CompassButton\";\r\nimport {Control} from \"./control/Control\";\r\nimport {EarthCoordinates} from \"./control/EarthCoordinates\";\r\nimport {Ellipsoid} from \"./ellipsoid/Ellipsoid\";\r\nimport {EmptyTerrain} from \"./terrain/EmptyTerrain\";\r\nimport {Handler} from \"./webgl/Handler\";\r\nimport {isEmpty} from \"./utils/shared\";\r\nimport {Layer} from \"./layer/Layer\";\r\nimport {MouseNavigation} from \"./control/MouseNavigation\";\r\nimport type {NumberArray2} from \"./math/Vec2\";\r\nimport type {NumberArray4} from \"./math/Vec4\";\r\nimport {Planet} from \"./scene/Planet\";\r\nimport {ScaleControl} from \"./control/ScaleControl\";\r\nimport {Sun} from \"./control/Sun\";\r\nimport {TouchNavigation} from \"./control/TouchNavigation\";\r\nimport {Renderer} from \"./renderer/Renderer\";\r\nimport type {HTMLDivElementExt} from \"./renderer/Renderer\";\r\nimport {RenderNode} from \"./scene/RenderNode\";\r\nimport {ZoomControl} from \"./control/ZoomControl\";\r\nimport {Extent} from \"./Extent\";\r\nimport type {IAtmosphereParams} from \"./control/atmosphere/Atmosphere\";\r\n\r\nexport interface IGlobeParams {\r\n    attributionContainer?: HTMLElement;\r\n    target?: string | HTMLElement;\r\n    skybox?: RenderNode;\r\n    dpi?: number;\r\n    msaa?: number;\r\n    name?: string;\r\n    frustums?: NumberArray2[];\r\n    ellipsoid?: Ellipsoid;\r\n    maxGridSize?: number;\r\n    nightTextureSrc?: string | null;\r\n    specularTextureSrc?: string | null;\r\n    minAltitude?: number;\r\n    maxAltitude?: number;\r\n    maxEqualZoomAltitude?: number;\r\n    minEqualZoomAltitude?: number;\r\n    minEqualZoomCameraSlope?: number;\r\n    quadTreeStrategyPrototype?: any;\r\n    maxLoadingRequests?: number;\r\n    atmosphereEnabled?: boolean;\r\n    transitionOpacityEnabled?: boolean;\r\n    terrain?: EmptyTerrain;\r\n    controls?: Control[];\r\n    minSlope?: number;\r\n    sun?: {\r\n        active?: boolean;\r\n        stopped?: boolean\r\n    };\r\n    layers?: Layer[];\r\n    viewExtent?: Extent | NumberArray4;\r\n    autoActivate?: boolean;\r\n\r\n    fontsSrc?: string;\r\n    resourcesSrc?: string;\r\n    atmosphereParameters?: IAtmosphereParams;\r\n    gamma?: number;\r\n    exposure?: number;\r\n}\r\n\r\nconst DEFAULT_NIGHT_SRC = `/night.png`;\r\nconst DEFAULT_SPEC_SRC = `/spec.png`;\r\nconst DEFAULT_RESOURCES_SRC = '/res';\r\n\r\n/** @const {string} */\r\nconst PLANET_NAME_PREFIX = \"globus_planet_\";\r\n\r\n/**\r\n * @typedef {Array<number>} LonLatCoordinate\r\n * @typedef {Array<LonLatCoordinate>} ExtentBoundingBox\r\n */\r\n\r\n/**\r\n * Creates a WebGL context with globe.\r\n * @class\r\n *\r\n * @example <caption>Basic initialization</caption>\r\n * globus = new Globe({\r\n *     atmosphere: false,\r\n *     target: 'globus',\r\n *     name: 'Earth',\r\n *     controls: [\r\n *          new control.MouseNavigation(),\r\n *          new control.KeyboardNavigation(),\r\n *          new control.EarthCoordinates(),\r\n *          new control.LayerSwitcher({),\r\n *          new control.ZoomControl(),\r\n *          new control.TouchNavigation(),\r\n *          new control.Sun()\r\n *      ],\r\n *     terrain: new GlobusRGBTerrain(),\r\n *     layers: [new OpenStreetMap(), new Bing()],\r\n *     atmosphereEnabled: true\r\n * });\r\n *\r\n * @param {IGlobeParams} options - Options:\r\n * @param {string|HTMLElement} options.target - HTML element id where planet canvas have to be created.\r\n * @param {string} [options.name] - Planet name. Default is uniq identifier.\r\n * @param {EmptyTerrain} [options.terrain] - Terrain provider. Default no terrain - og.terrain.EmptyTerrain.\r\n * @param {Array.<Control>} [options.controls] - Controls.\r\n * @param {Array.<Layer>} [options.layers] - Planet layers.\r\n * @param {Extent | ExtentBoundingBox} [options.viewExtent] [options.viewExtent] - Viewable starting extent.\r\n * @param {boolean} [options.autoActivate=true] - Globe rendering auto activation flag. True is default.\r\n * @param {HTMLElement} [options.attributionContainer] - Container for attribution list.\r\n * @param {number} [options.maxGridSize=128] = Maximal segment grid size. 128 is default\r\n * @param {string} [options.fontsSrc] -  Fonts collection url.\r\n * @param {string} [options.resourcesSrc] - Resources root src.\r\n * @param {string} [options.nightTextureSrc] - Night glowing image sources\r\n * @param {string} [options.specularTextureSrc] - Specular water mask image sourcr\r\n * @param {number} [options.maxAltitude=15000000.0] - Maximal camera altitude above terrain\r\n * @param {number} [options.minAltitude=1.0] - Minimal camera altitude above terrain\r\n * @param {number} [options.maxEqualZoomAltitude=15000000.0] - Maximal altitude since segments on the screen became the same zoom level\r\n * @param {number} [options.minEqualZoomAltitude=10000.0] - Minimal altitude since segments on the screen became the same zoom level\r\n * @param {number} [options.minEqualZoomCameraSlope=0.8] - Minimal camera slope above te globe where segments on the screen became the same zoom level\r\n * @param {number} [options.loadingBatchSize=12] -\r\n * @param {number} [options.quadTreeStrategyPrototype] - Prototype of quadTree. QuadTreeStrategy for Earth is default.\r\n * @param {number} [options.msaa=0] - MSAA antialiasing parameter: 2,4,8,16. Default is 0.\r\n * @param {number} [options.dpi] - Device pixel ratio. Default is current screen DPI.\r\n * @param {boolean} [options.atmosphereEnabled] - Enables atmosphere effect.\r\n * @param {boolean} [options.transtitionOpacityEnabled] - Enables terrain smooth opacity transition effect.\r\n * @param {IAtmosphereParams} [options.atmosphereParameters] - Atmosphere model parameters.\r\n * @param {number} [options.gamma] - Gamma\r\n * @param {number} [options.exposure] - Exposure\r\n */\r\n\r\nclass Globe {\r\n\r\n    static __counter__: number = 0;\r\n\r\n    public $target: HTMLElement | null;\r\n\r\n    protected _instanceID: string;\r\n\r\n    protected _canvas: HTMLCanvasElement;\r\n\r\n    public $inner: HTMLDivElementExt;\r\n\r\n    /**\r\n     * Interface for the renderer context(events, input states, renderer nodes etc.)\r\n     * @public\r\n     * @type {Renderer}\r\n     */\r\n    public renderer: Renderer;\r\n\r\n    /**\r\n     * Planet node name. Access with this.renderer.<name>\r\n     * @private\r\n     * @type {String}\r\n     */\r\n    protected _planetName: string;\r\n\r\n    public planet: Planet;\r\n\r\n    public sun: Sun;\r\n\r\n    constructor(options: IGlobeParams) {\r\n\r\n        this.$target = null;\r\n\r\n        this._instanceID = `__globus${Globe.__counter__++ ? Globe.__counter__ : \"\"}__`;\r\n        (window as any)[this._instanceID] = this;\r\n\r\n        //\r\n        // Canvas creation\r\n        //\r\n        this._canvas = document.createElement(\"canvas\");\r\n        this._canvas.id = `canvas${this._instanceID}`;\r\n        this._canvas.style.width = \"100%\";\r\n        this._canvas.style.height = \"100%\";\r\n        this._canvas.style.display = \"block\";\r\n        this._canvas.style.opacity = \"0.0\";\r\n        this._canvas.style.transition = \"opacity 150ms\";\r\n\r\n        /**\r\n         * Dom element where WebGL canvas creates\r\n         * @public\r\n         * @type {Element}\r\n         */\r\n        this.$inner = document.createElement('div');\r\n        this.$inner.classList.add(\"og-inner\");\r\n        this.$inner.appendChild(this._canvas);\r\n\r\n        this.$inner.attributions = document.createElement('div');\r\n        if (options.attributionContainer) {\r\n            options.attributionContainer.appendChild(this.$inner.attributions);\r\n        } else {\r\n            this.$inner.attributions.classList.add(\"og-attribution\");\r\n            this.$inner.appendChild(this.$inner.attributions);\r\n        }\r\n\r\n        if (options.target) {\r\n            this.attachTo(options.target);\r\n        }\r\n\r\n        const _disableWheel = (e: Event) => {\r\n            e.preventDefault();\r\n        }\r\n\r\n        this._canvas.onmouseenter = function () {\r\n            document.addEventListener(\"mousewheel\", _disableWheel, {\r\n                capture: false,\r\n                passive: false\r\n            });\r\n        };\r\n        this._canvas.onmouseleave = function () {\r\n            document.removeEventListener(\"mousewheel\", _disableWheel);\r\n        };\r\n\r\n        this.renderer = new Renderer(\r\n            new Handler(this._canvas, {\r\n                autoActivate: false,\r\n                pixelRatio: options.dpi || (window.devicePixelRatio + 0.15),\r\n                context: {\r\n                    //alpha: false,\r\n                    antialias: false,\r\n                    premultipliedAlpha: false,\r\n                    preserveDrawingBuffer: false\r\n                }\r\n            }), {\r\n                autoActivate: false,\r\n                msaa: options.msaa,\r\n                fontsSrc: options.fontsSrc,\r\n                gamma: options.gamma,\r\n                exposure: options.exposure,\r\n            }\r\n        );\r\n\r\n        this.renderer.div = this.$inner;\r\n\r\n        // Skybox\r\n        if (options.skybox) {\r\n            this.renderer.addNode(options.skybox);\r\n        }\r\n\r\n        this._planetName = options.name ? options.name : PLANET_NAME_PREFIX + Globe.__counter__;\r\n\r\n        this.planet = new Planet({\r\n            name: this._planetName,\r\n            frustums: options.frustums,\r\n            ellipsoid: options.ellipsoid,\r\n            maxGridSize: options.maxGridSize,\r\n            nightTextureSrc: options.nightTextureSrc === null ? null : options.nightTextureSrc || `${options.resourcesSrc || DEFAULT_RESOURCES_SRC}${DEFAULT_NIGHT_SRC}`,\r\n            specularTextureSrc: options.specularTextureSrc === null ? null : options.specularTextureSrc || `${options.resourcesSrc || DEFAULT_RESOURCES_SRC}${DEFAULT_SPEC_SRC}`,\r\n            minAltitude: options.minAltitude,\r\n            maxAltitude: options.maxAltitude || 15000000,\r\n            maxEqualZoomAltitude: options.maxEqualZoomAltitude,\r\n            minEqualZoomAltitude: options.minEqualZoomAltitude,\r\n            minEqualZoomCameraSlope: options.minEqualZoomCameraSlope,\r\n            quadTreeStrategyPrototype: options.quadTreeStrategyPrototype,\r\n            maxLoadingRequests: options.maxLoadingRequests,\r\n            atmosphereEnabled: options.atmosphereEnabled,\r\n            transitionOpacityEnabled: options.transitionOpacityEnabled,\r\n            atmosphereParameters: options.atmosphereParameters,\r\n        });\r\n\r\n        // Attach terrain provider (can be one object or array)\r\n        if (options.terrain) {\r\n            //@todo: refactoring\r\n            if (Array.isArray(options.terrain)) {\r\n                this.planet.setTerrain(options.terrain[0]); // If array get the terrain from 1st element\r\n            } else {\r\n                this.planet.setTerrain(options.terrain);\r\n            }\r\n        } else {\r\n            this.planet.setTerrain(new EmptyTerrain());\r\n        }\r\n\r\n        this.renderer.addNode(this.planet);\r\n\r\n        // Add controls\r\n        if (options.controls) {\r\n            this.planet.addControls(options.controls);\r\n        } else {\r\n            this.planet.addControls([\r\n                new ZoomControl(),\r\n                new MouseNavigation(),\r\n                new TouchNavigation(),\r\n                new EarthCoordinates(),\r\n                new ScaleControl(),\r\n                new CompassButton()\r\n            ]);\r\n        }\r\n\r\n        const _controls = this.renderer.controls;\r\n        let sun;\r\n        for (let i in _controls) {\r\n            if (_controls[i] instanceof Sun) {\r\n                sun = _controls[i] as Sun;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!sun) {\r\n            this.sun = new Sun();\r\n            this.planet.addControl(this.sun);\r\n        } else {\r\n            this.sun = sun;\r\n        }\r\n\r\n        if (options.sun) {\r\n            if (options.sun.active !== undefined && !options.sun.active) {\r\n                this.sun.deactivate();\r\n            }\r\n            if (options.sun.stopped === true) {\r\n                this.sun.stop();\r\n            }\r\n        }\r\n\r\n        if (options.layers) {\r\n            this.planet.addLayers(options.layers);\r\n        }\r\n\r\n        // TODO: view center, altitude, extent\r\n        let ve = options.viewExtent;\r\n        if (ve) {\r\n            if (ve instanceof Array) {\r\n                this.planet.viewExtentArr(ve);\r\n            } else {\r\n                this.planet.viewExtent(ve as Extent);\r\n            }\r\n        }\r\n\r\n        // Run!\r\n        if (options.autoActivate || isEmpty(options.autoActivate)) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    public start() {\r\n        this.renderer.start();\r\n        this.fadeIn();\r\n    }\r\n\r\n    /**\r\n     * Starts screen brightness fading in effect by the duration time.\r\n     * @public\r\n     */\r\n    public fadeIn() {\r\n        this._canvas.style.opacity = \"1.0\";\r\n    }\r\n\r\n    /**\r\n     * Starts screen brightness fading out effect by the duration time.\r\n     * @public\r\n     */\r\n    public fadeOut() {\r\n        this._canvas.style.opacity = \"0\";\r\n    }\r\n\r\n    public attachTo(target: HTMLElement | string, isFirst?: boolean) {\r\n\r\n        this.detach();\r\n\r\n        let t;\r\n        if (target instanceof HTMLElement) {\r\n            t = target;\r\n        } else {\r\n            t = document.getElementById(target) || document.querySelector(target);\r\n        }\r\n\r\n        if (t) {\r\n            this.$target = t as HTMLElement;\r\n            if (isFirst && this.$target.firstChild) {\r\n                this.$target.insertBefore(this.$inner, this.$target.firstChild);\r\n            } else {\r\n                t.appendChild(this.$inner);\r\n            }\r\n        } else {\r\n            console.warn(`Target container not found. Provided target: ${target}`);\r\n        }\r\n    }\r\n\r\n    public detach() {\r\n        if (this.$target) {\r\n            // Remember that when container is zero\r\n            // sized(display none etc.) renderer frame will be stopped\r\n            this.$target.removeChild(this.$inner);\r\n            this.$target = null;\r\n        }\r\n    }\r\n\r\n    public destroy() {\r\n        this.detach();\r\n        this.planet.layers.forEach(l => l.remove());\r\n        this.planet.destroy();\r\n        this.renderer.destroy();\r\n        (window as any)[this._instanceID] = null;\r\n    }\r\n}\r\n\r\nexport {Globe};\r\n","import {Ellipsoid} from \"./Ellipsoid\";\r\n\r\n/**\r\n * Mars ellipsoid object.\r\n * @type {Ellipsoid}\r\n */\r\nexport const mars = new Ellipsoid(3396200.0, 3389508.0);\r\n","import {Ellipsoid} from \"./Ellipsoid\";\r\n\r\n/**\r\n * Moon ellipsoid object.\r\n * @type {Ellipsoid}\r\n */\r\nexport const moon = new Ellipsoid(1737400.0, 1737400.0); // Equitorial Radius (m), Polar Radius (m)\r\n","import {CLOSE_ICON} from './ui/icons';\r\nimport {createLonLat, stringTemplate} from \"./utils/shared\";\r\nimport type {EventsHandler} from \"./Events\";\r\nimport {LonLat} from \"./LonLat\";\r\nimport {Planet} from \"./scene/Planet\";\r\nimport {Vec2} from \"./math/Vec2\";\r\nimport {Vec3} from \"./math/Vec3\";\r\nimport type {NumberArray2} from \"./math/Vec2\";\r\nimport type {NumberArray3} from \"./math/Vec3\";\r\nimport {View} from './ui/View';\r\nimport type {IViewParams, ViewEventsList} from './ui/View';\r\n\r\nconst TEMPLATE = `<div class=\"og-popup {className}\">\r\n      <div class=\"og-popup-content-wrapper\">\r\n        <div class=\"og-popup-content\"></div>\r\n      </div>\r\n      <div class=\"og-popup-tip-container\">\r\n        <div class=\"og-popup-tip\"></div>\r\n      </div>\r\n      <div class=\"og-popup-toolbar\">\r\n        <div class=\"og-popup-btn og-popup-close\">${CLOSE_ICON}</div>\r\n      </div>\r\n      <div class=\"og-popup-title\">{title}</div>\r\n    </div>`;\r\n\r\ninterface IPopupParams extends IViewParams {\r\n    planet: Planet;\r\n    title?: string;\r\n    className?: string;\r\n    visibility?: boolean;\r\n    content?: string;\r\n    offset?: NumberArray2;\r\n    lonLat?: LonLat | NumberArray2 | NumberArray3;\r\n}\r\n\r\ntype PopupEventsList = [\"open\", \"close\"];\r\nconst POPUP_EVENTS: PopupEventsList = [\"open\", \"close\"];\r\n\r\nclass Popup extends View<null> {\r\n\r\n    public override events: EventsHandler<PopupEventsList> & EventsHandler<ViewEventsList>;\r\n\r\n    public $content: HTMLElement | null;\r\n    public $tip: HTMLElement | null;\r\n    public $title: HTMLElement | null;\r\n\r\n    protected _content: string | HTMLElement | null;\r\n\r\n    protected _planet: Planet;\r\n\r\n    protected _offset: NumberArray2;\r\n\r\n    protected _lonLat: LonLat;\r\n\r\n    protected _cartPos: Vec3;\r\n\r\n    protected _visibility: boolean;\r\n\r\n    constructor(options: IPopupParams) {\r\n        super({\r\n            template: stringTemplate(TEMPLATE, {\r\n                title: options.title || \"\"\r\n            }),\r\n            classList: options.className ? [options.className] : [],\r\n            ...options\r\n        });\r\n\r\n        //@ts-ignore\r\n        this.events = this.events.registerNames(POPUP_EVENTS);\r\n\r\n        this._content = options.content || \"\";\r\n\r\n        this.$content = null;\r\n        this.$tip = null;\r\n        this.$title = null;\r\n\r\n        this._planet = options.planet;\r\n\r\n        this._offset = options.offset || [0, 0];\r\n\r\n        this._lonLat = createLonLat(options.lonLat);\r\n\r\n        this._cartPos = new Vec3();\r\n\r\n        this._visibility = options.visibility || false;\r\n\r\n        this.render();\r\n    }\r\n\r\n    _updatePosition() {\r\n        this.setCartesian3v(this._cartPos);\r\n    }\r\n\r\n    public setScreen(p: Vec2) {\r\n        if (this._planet) {\r\n            let r = this._planet.renderer!.handler.pixelRatio;\r\n            this.el!.style.transform =\r\n                `translate(${p.x / r - this.clientWidth * 0.5}px, ${p.y / r - this._planet.renderer!.handler.canvas!.clientHeight - this.$tip!.clientHeight}px)`;\r\n        }\r\n    }\r\n\r\n    public get clientWidth(): number {\r\n        return this.el ? this.el.clientWidth : 0;\r\n    }\r\n\r\n    public get clientHeight(): number {\r\n        return this.el ? this.el.clientHeight : 0;\r\n    }\r\n\r\n    public setOffset(x: number = 0, y: number = 0): this {\r\n        this._offset[0] = x;\r\n        this._offset[1] = y;\r\n        if (this.el) {\r\n            this.el.style.left = `${x}px`;\r\n            this.el.style.bottom = `${y}px`;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public override render(params?: any): this {\r\n        super.render(params);\r\n\r\n        this.$content = this.select(\".og-popup-content\")!;\r\n        this.$title = this.select(\".og-popup-title\")!;\r\n        this.$tip = this.select(\".og-popup-tip-container\")!;\r\n\r\n        this.setOffset(this._offset[0], this._offset[1]);\r\n        this.setContent(this._content);\r\n        this.setLonLat(this._lonLat);\r\n        this.setVisibility(this._visibility);\r\n        this.select(\".og-popup-close\")!.addEventListener(\"click\", () => {\r\n            this.hide();\r\n        });\r\n\r\n        return this;\r\n    }\r\n\r\n    public setVisibility(visibility: boolean): this {\r\n        if (visibility) {\r\n            this.show();\r\n        } else {\r\n            this.hide();\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public getContainer(): HTMLElement | null {\r\n        return this.$content;\r\n    }\r\n\r\n    public getToolbarContainer(): HTMLElement {\r\n        return this.select(\".og-popup-toolbar\")!;\r\n    }\r\n\r\n    public show(): this {\r\n        this._visibility = true;\r\n        if (this._planet) {\r\n            this._planet.events.on(\"draw\", this._updatePosition, this);\r\n            this.appendTo(this._planet.renderer!.div as HTMLElement);\r\n            this.events.dispatch(this.events.open, this);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public hide(): this {\r\n        this._visibility = false;\r\n        if (this.el && this.el.parentNode) {\r\n            this._planet.events.off(\"draw\", this._updatePosition);\r\n            this.el.parentNode.removeChild(this.el);\r\n            this.events.dispatch(this.events.close, this);\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public setCartesian3v(cart: Vec3, height: number = 0): this {\r\n        this._cartPos = cart;\r\n\r\n        if (this._planet) {\r\n            let cam = this._planet.camera;\r\n            let f = this._planet.ellipsoid.equatorialSize + height,\r\n                g = cam._lonLat.height;\r\n\r\n            let look = cart.sub(cam.eye),\r\n                v = Math.sqrt((f + g) * (f + g) - f * f);\r\n\r\n            if (v > look.length() && cam.getForward().dot(look.normalize()) > 0.0) {\r\n                this.el!.style.display = \"block\";\r\n                this.setScreen(cam.project3v(cart));\r\n            } else {\r\n                this.el!.style.display = \"none\";\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    public setTitle(html: string) {\r\n        if (this.$title) {\r\n            this.$title.innerHTML = html;\r\n        }\r\n    }\r\n\r\n    public setLonLat(lonLat: LonLat) {\r\n        this._lonLat = lonLat;\r\n        if (this._planet) {\r\n            this.setCartesian3v(this._planet.ellipsoid.lonLatToCartesian(lonLat), lonLat.height);\r\n        }\r\n    }\r\n\r\n    public setContent(content?: string | HTMLElement | null) {\r\n        if (content) {\r\n            this.clear();\r\n            this._content = content;\r\n            if (this.$content) {\r\n                if (typeof content === \"string\") {\r\n                    this.$content.innerHTML = content;\r\n                } else {\r\n                    this.$content.appendChild(content);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public clear() {\r\n        this._content = null;\r\n        if (this.$content) {\r\n            this.$content.innerHTML = \"\";\r\n        }\r\n    }\r\n}\r\n\r\nexport {Popup};\r\n","import {Extent} from \"../Extent\";\r\nimport {Node} from \"../quadTree/Node\";\r\nimport {Planet} from \"../scene/Planet\";\r\nimport {SegmentLonLat} from \"./SegmentLonLat\";\r\nimport {getTileCellIndex, TILEGROUP_COMMON} from \"./Segment\";\r\nimport {equi} from \"../proj/equi\";\r\nimport type {WebGLTextureExt} from \"../webgl/Handler\";\r\n\r\nconst MAX_POLE_ZOOM = 5;\r\nexport const POLE_PIECE_SIZE = 5 / Math.pow(2, MAX_POLE_ZOOM);\r\n\r\nexport class SegmentLonLatEqui extends SegmentLonLat {\r\n    constructor(node: Node, planet: Planet, tileZoom: number, extent: Extent) {\r\n        super(node, planet, tileZoom, extent);\r\n        this._projection = equi;\r\n        this.isPole = false;\r\n        this._tileGroup = TILEGROUP_COMMON;\r\n    }\r\n\r\n    protected override _getMaxZoom(): number {\r\n        let maxPoleZoom = 0;\r\n        if (this._extent.northEast.lat > 85) {\r\n            //north pole limits\r\n            let Yz = Math.floor((90.0 - this._extent.northEast.lat) / POLE_PIECE_SIZE);\r\n            maxPoleZoom = Math.floor(Yz / 16) + MAX_POLE_ZOOM;\r\n        } else if (this._extent.southWest.lat < -85) {\r\n            //south pole limits\r\n            let Yz = Math.floor((90 + this._extent.southWest.lat) / POLE_PIECE_SIZE);\r\n            maxPoleZoom = Math.floor(Yz / 16) + MAX_POLE_ZOOM;\r\n        } else {\r\n            maxPoleZoom = 50;\r\n        }\r\n        return maxPoleZoom;\r\n    }\r\n\r\n    protected override _assignTileYIndexes(extent: Extent) {\r\n        const lat = extent.getCenter().lat;\r\n        this.tileY = getTileCellIndex(lat, extent.getHeight(), 90.0);\r\n        this.tileYN = this.tileY - 1;\r\n        this.tileYS = this.tileY + 1;\r\n    }\r\n\r\n    protected override _assignTileXIndexes(extent: Extent) {\r\n        let lon = extent.getCenter().lon;\r\n        this.tileX = getTileCellIndex(lon, extent.getWidth(), -180);\r\n        let p2 = (1 << this.tileZoom) * 2;\r\n        this.tileXE = (this.tileX + 1) % p2;\r\n        this.tileXW = (p2 + this.tileX - 1) % p2;\r\n    }\r\n\r\n    public override getDefaultTexture(): WebGLTextureExt | null {\r\n        return this.planet.solidTextureOne;\r\n    }\r\n}","import {EntityCollectionsTreeStrategy} from \"../EntityCollectionsTreeStrategy\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {NE, NW, SE, SW} from \"../quadTree\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {EntityCollection} from \"../../entity/EntityCollection\";\r\nimport {EntityCollectionNode} from \"../EntityCollectionNode\";\r\nimport type {NodesDict} from \"../EntityCollectionNode\";\r\nimport {EquiEntityCollectionsTreeStrategy} from \"./EquiEntityCollectionsTreeStrategy\";\r\n\r\nexport class EquiEntityCollectionNodeLonLat extends EntityCollectionNode {\r\n\r\n    public override strategy: EquiEntityCollectionsTreeStrategy;\r\n\r\n    constructor(strategy: EquiEntityCollectionsTreeStrategy, partId: number, parent: EquiEntityCollectionNodeLonLat | null, extent: Extent, planet: Planet, zoom: number) {\r\n        super(strategy, partId, parent, extent, planet, zoom);\r\n        this.strategy = strategy;\r\n    }\r\n\r\n    public override createChildNodes() {\r\n        const s = this.strategy;\r\n        const ext = this.extent;\r\n        const size_x = ext.getWidth() * 0.5;\r\n        const size_y = ext.getHeight() * 0.5;\r\n        const ne = ext.northEast;\r\n        const sw = ext.southWest;\r\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\r\n        const nd = this.childNodes;\r\n        const p = this.layer._planet!;\r\n        const z = this.zoom + 1;\r\n\r\n        nd[NW] = new EquiEntityCollectionNodeLonLat(s, NW, this, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)), p, z);\r\n        nd[NE] = new EquiEntityCollectionNodeLonLat(s, NE, this, new Extent(c, new LonLat(ne.lon, ne.lat)), p, z);\r\n        nd[SW] = new EquiEntityCollectionNodeLonLat(s, SW, this, new Extent(new LonLat(sw.lon, sw.lat), c), p, z);\r\n        nd[SE] = new EquiEntityCollectionNodeLonLat(s, SE, this, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)), p, z);\r\n    }\r\n\r\n    protected override _setExtentBounds() {\r\n        this.bsphere.setFromExtent(this.layer._planet!.ellipsoid, this.extent);\r\n    }\r\n\r\n    public override __setLonLat__(entity: Entity): LonLat {\r\n        if (entity._lonLat.isZero()) {\r\n            entity._lonLat = this.layer._planet!.ellipsoid.cartesianToLonLat(entity._cartesian);\r\n        }\r\n        return entity._lonLat;\r\n    }\r\n\r\n    public override isVisible(): boolean {\r\n        if (this.strategy._renderingNodesWest[this.nodeId]) {\r\n            return true;\r\n        } else if (this.strategy._renderingNodesEast[this.nodeId]) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public override isInside(entity: Entity): boolean {\r\n        return this.extent.isInside(entity._lonLat);\r\n    }\r\n\r\n    public override renderCollection(outArr: EntityCollection[], visibleNodes: NodesDict, renderingNode: number) {\r\n\r\n        if (this.extent.southWest.lon < 0) {\r\n            this.strategy._renderingNodesWest[this.nodeId] = true;\r\n        } else {\r\n            this.strategy._renderingNodesEast[this.nodeId] = true;\r\n        }\r\n\r\n        if (this.deferredEntities.length && !this._inTheQueue) {\r\n            if (this.layer.async) {\r\n                this.strategy._queueDeferredNode(this);\r\n            } else {\r\n                this.applyCollection();\r\n            }\r\n        }\r\n\r\n        const ec = this.entityCollection!;\r\n\r\n        ec._fadingOpacity = this.layer._fadingOpacity;\r\n        ec.scaleByDistance = this.layer.scaleByDistance;\r\n        ec.pickingScale = this.layer.pickingScale;\r\n\r\n        if (!ec.isEmpty()) {\r\n            outArr.push(ec);\r\n        }\r\n    }\r\n}\r\n","import {Vector} from \"../../layer/Vector\";\r\nimport * as quadTree from \"../quadTree\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {Entity} from \"../../entity/Entity\";\r\nimport {EntityCollection} from \"../../entity/EntityCollection\";\r\nimport {EquiQuadTreeStrategy} from \"./EquiQuadTreeStrategy\";\r\nimport {EntityCollectionsTreeStrategy} from \"../EntityCollectionsTreeStrategy\";\r\nimport {EquiEntityCollectionNodeLonLat} from \"./EquiEntityCollectionNodeLonLat\";\r\n\r\nexport class EquiEntityCollectionsTreeStrategy extends EntityCollectionsTreeStrategy {\r\n\r\n    protected _entityCollectionsTreeWest: EquiEntityCollectionNodeLonLat;\r\n    protected _entityCollectionsTreeEast: EquiEntityCollectionNodeLonLat;\r\n\r\n    public _renderingNodesWest: Record<number, boolean>;\r\n    public _renderingNodesEast: Record<number, boolean>;\r\n\r\n    constructor(layer: Vector, nodeCapacity: number) {\r\n        super(layer, nodeCapacity);\r\n\r\n        let planet = layer._planet!;\r\n\r\n        this._entityCollectionsTreeWest = new EquiEntityCollectionNodeLonLat(\r\n            this,\r\n            quadTree.NW,\r\n            null,\r\n            Extent.createFromArray([-180, -90, 0, 90]),\r\n            planet,\r\n            0\r\n        );\r\n\r\n        this._entityCollectionsTreeEast = new EquiEntityCollectionNodeLonLat(\r\n            this,\r\n            quadTree.NW,\r\n            null,\r\n            Extent.createFromArray([0, -90, 180, 90]),\r\n            planet,\r\n            0\r\n        );\r\n\r\n        this._renderingNodesWest = {};\r\n        this._renderingNodesEast = {};\r\n    }\r\n\r\n    public override insertEntity(entity: Entity, rightNow: boolean = false) {\r\n        if (entity._lonLat.lon < 0) {\r\n            this._entityCollectionsTreeWest!.__setLonLat__(entity);\r\n            this._entityCollectionsTreeWest!.insertEntity(entity, rightNow);\r\n        } else {\r\n            this._entityCollectionsTreeEast!.__setLonLat__(entity);\r\n            this._entityCollectionsTreeEast!.insertEntity(entity, rightNow);\r\n        }\r\n    }\r\n\r\n    public override setPickingEnabled(pickingEnabled: boolean) {\r\n        this._entityCollectionsTreeWest.traverseTree((node: EquiEntityCollectionNodeLonLat) => {\r\n            node.entityCollection!.setPickingEnabled(pickingEnabled);\r\n        });\r\n\r\n        this._entityCollectionsTreeEast.traverseTree((node: EquiEntityCollectionNodeLonLat) => {\r\n            node.entityCollection!.setPickingEnabled(pickingEnabled);\r\n        });\r\n    }\r\n\r\n    public override dispose() {\r\n        //@ts-ignore\r\n        this._entityCollectionsTreeWest = null;\r\n        //@ts-ignore\r\n        this._entityCollectionsTreeEast = null;\r\n\r\n        this._renderingNodesWest = {};\r\n        this._renderingNodesEast = {};\r\n    }\r\n\r\n    public override insertEntities(entitiesForTree: Entity[]) {\r\n        let westEntities: Entity[] = [],\r\n            eastEntities: Entity[] = [];\r\n        for (let i = 0, len = entitiesForTree.length; i < len; i++) {\r\n            let entity = entitiesForTree[i];\r\n            if (entity._lonLat.lon < 0) {\r\n                westEntities.push(entity);\r\n                this._entityCollectionsTreeWest.__setLonLat__(entity);\r\n            } else {\r\n                eastEntities.push(entity);\r\n                this._entityCollectionsTreeEast.__setLonLat__(entity);\r\n            }\r\n        }\r\n\r\n        this._entityCollectionsTreeWest.buildTree(westEntities);\r\n        this._entityCollectionsTreeEast.buildTree(eastEntities);\r\n    }\r\n\r\n    public override collectVisibleEntityCollections(outArr: EntityCollection[]) {\r\n        this._renderingNodesWest = {};\r\n        this._renderingNodesEast = {};\r\n\r\n        let pqs = this._layer._planet!.quadTreeStrategy as EquiQuadTreeStrategy;\r\n\r\n        // Wset\r\n        this._secondPASS = [];\r\n        this._entityCollectionsTreeWest.collectRenderCollectionsPASS1(pqs._visibleNodesWest, outArr);\r\n        let i = this._secondPASS.length;\r\n        while (i--) {\r\n            this._secondPASS[i].collectRenderCollectionsPASS2(pqs._visibleNodesWest, outArr, this._secondPASS[i].nodeId);\r\n        }\r\n\r\n        // East\r\n        this._secondPASS = [];\r\n        this._entityCollectionsTreeEast.collectRenderCollectionsPASS1(pqs._visibleNodesEast, outArr);\r\n        i = this._secondPASS.length;\r\n        while (i--) {\r\n            this._secondPASS[i].collectRenderCollectionsPASS2(pqs._visibleNodesEast, outArr, this._secondPASS[i].nodeId);\r\n        }\r\n    }\r\n}","import * as quadTree from \"../quadTree\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {equi} from \"../../proj/equi\";\r\nimport {Node} from \"../Node\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {SegmentLonLatEqui} from \"../../segment/SegmentLonLatEqui\";\r\nimport {QuadTreeStrategy} from \"../QuadTreeStrategy\";\r\nimport {LonLat} from \"../../LonLat\";\r\nimport {\r\n    getTileCellExtent,\r\n    getTileCellIndex,\r\n    TILEGROUP_COMMON\r\n} from \"../../segment/Segment\";\r\nimport {Vector} from \"../../layer/Vector\";\r\nimport {EntityCollectionsTreeStrategy} from \"../EntityCollectionsTreeStrategy\";\r\nimport {EquiEntityCollectionsTreeStrategy} from \"./EquiEntityCollectionsTreeStrategy\";\r\n\r\nexport class EquiQuadTreeStrategy extends QuadTreeStrategy {\r\n\r\n    private _westExtent: Extent;\r\n    private _eastExtent: Extent;\r\n\r\n    public _visibleNodesWest: Record<number, Node>;\r\n    public _visibleNodesEast: Record<number, Node>;\r\n\r\n    constructor(planet: Planet) {\r\n        super(planet, \"Mars\", equi);\r\n        this._westExtent = Extent.createFromArray([-180, -90, 0, 90]);\r\n        this._eastExtent = Extent.createFromArray([0, -90, 180, 90]);\r\n\r\n        this._visibleNodesWest = {};\r\n        this._visibleNodesEast = {};\r\n    }\r\n\r\n    public override init() {\r\n        this._quadTreeList = [\r\n            new Node(\r\n                SegmentLonLatEqui,\r\n                this.planet,\r\n                0,\r\n                null,\r\n                0,\r\n                this._westExtent\r\n            ),\r\n            new Node(\r\n                SegmentLonLatEqui,\r\n                this.planet,\r\n                0,\r\n                null,\r\n                0,\r\n                this._eastExtent\r\n            )\r\n        ];\r\n    }\r\n\r\n    public override getTileXY(lonLat: LonLat, zoom: number): [number, number, number, number] {\r\n        let z = zoom,\r\n            x = -1,\r\n            y = -1,\r\n            pz = (1 << z);\r\n\r\n        if (lonLat.lon > 0) {\r\n            x = getTileCellIndex(lonLat.lon, 180 / pz, 0) + pz;\r\n        } else {\r\n            x = getTileCellIndex(lonLat.lon, 180 / pz, -180);\r\n        }\r\n\r\n        y = getTileCellIndex(lonLat.lat, 180 / pz, 90);\r\n\r\n        return [x, y, z, TILEGROUP_COMMON];\r\n    }\r\n\r\n    public override getLonLatTileOffset(lonLat: LonLat, x: number, y: number, z: number, gridSize: number): [number, number] {\r\n        let coords = lonLat;\r\n        let extent = new Extent();\r\n\r\n        if (lonLat.lon > 0) {\r\n            extent = getTileCellExtent(x - (1 << z), y, z, this._eastExtent);\r\n        } else {\r\n            extent = getTileCellExtent(x, y, z, this._westExtent);\r\n        }\r\n\r\n        let sizeImgW = extent.getWidth() / (gridSize - 1),\r\n            sizeImgH = extent.getHeight() / (gridSize - 1);\r\n\r\n        let i = gridSize - Math.ceil((coords.lat - extent.southWest.lat) / sizeImgH) - 1,\r\n            j = Math.floor((coords.lon - extent.southWest.lon) / sizeImgW);\r\n\r\n        return [i, j];\r\n    }\r\n\r\n    public override createEntitiCollectionsTreeStrategy(layer: Vector, nodeCapacity: number): EntityCollectionsTreeStrategy {\r\n        return new EquiEntityCollectionsTreeStrategy(layer, nodeCapacity);\r\n    }\r\n\r\n    public override collectVisibleNode(node: Node) {\r\n        let ext = node.segment.getExtent();\r\n        if (ext.southWest.lon < 0) {\r\n            this._visibleNodesWest[node.nodeId] = node;\r\n        } else {\r\n            this._visibleNodesEast[node.nodeId] = node;\r\n        }\r\n    }\r\n\r\n    protected override _clearVisibleNodes() {\r\n        this._visibleNodesWest = {};\r\n        this._visibleNodesEast = {};\r\n    }\r\n}","import * as quadTree from \"../quadTree\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {EPSG4326} from \"../../proj/EPSG4326\";\r\nimport {Node} from \"../Node\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {QuadTreeStrategy} from \"../QuadTreeStrategy\";\r\nimport {SegmentLonLatEqui} from \"../../segment/SegmentLonLatEqui\";\r\n\r\nexport class EPSG4326QuadTreeStrategy extends QuadTreeStrategy {\r\n    constructor(planet: Planet) {\r\n        super(planet, \"EPSG4326\", EPSG4326);\r\n    }\r\n\r\n    public override init() {\r\n        this._quadTreeList = [\r\n            new Node(\r\n                SegmentLonLatEqui,\r\n                this.planet,\r\n                0,\r\n                null,\r\n                0,\r\n                Extent.createFromArray([-180, -90, 0, 90])\r\n            ),\r\n            new Node(\r\n                SegmentLonLatEqui,\r\n                this.planet,\r\n                0,\r\n                null,\r\n                0,\r\n                Extent.createFromArray([0, -90, 180, 90])\r\n            )\r\n        ];\r\n    }\r\n}","import * as quadTree from \"../quadTree\";\r\nimport {Extent} from \"../../Extent\";\r\nimport {EPSG4326} from \"../../proj/EPSG4326\";\r\nimport {Node} from \"../Node\";\r\nimport {Planet} from \"../../scene/Planet\";\r\nimport {SegmentLonLatEqui} from \"../../segment/SegmentLonLatEqui\";\r\nimport {QuadTreeStrategy} from \"../QuadTreeStrategy\";\r\n\r\nexport class Wgs84QuadTreeStrategy extends QuadTreeStrategy {\r\n    constructor(planet: Planet) {\r\n        super(planet, \"wgs84\", EPSG4326);\r\n    }\r\n\r\n    public override init() {\r\n        this._quadTreeList = [\r\n            new Node(\r\n                SegmentLonLatEqui,\r\n                this.planet,\r\n                0, null,\r\n                0,\r\n                Extent.createFromArray([-180, -90, 180, 90])\r\n            )\r\n        ];\r\n    }\r\n}","import {EarthQuadTreeStrategy} from \"./earth/EarthQuadTreeStrategy\";\r\nimport {EquiQuadTreeStrategy} from \"./equi/EquiQuadTreeStrategy\";\r\nimport {EPSG4326QuadTreeStrategy} from \"./EPSG4326/EPSG4326QuadTreeStrategy\";\r\nimport {QuadTreeStrategy} from \"./QuadTreeStrategy\";\r\nimport {Wgs84QuadTreeStrategy} from \"./wgs84/Wgs84QuadTreeStrategy\";\r\n\r\nconst quadTreeStrategyType = {\r\n    epsg4326: EPSG4326QuadTreeStrategy,\r\n    earth: EarthQuadTreeStrategy,\r\n    equi: EquiQuadTreeStrategy,\r\n    wgs84: Wgs84QuadTreeStrategy\r\n}\r\n\r\nexport {\r\n    quadTreeStrategyType,\r\n    QuadTreeStrategy,\r\n    Wgs84QuadTreeStrategy,\r\n    EquiQuadTreeStrategy,\r\n    EarthQuadTreeStrategy\r\n};\r\n"],"names":["TWO_PI","Math","PI","PI_TWO","X","Y","Z","W","MAX_FLOAT","Number","MAX_VALUE","LOG2","log","MAX32","MAX","MIN","RADIANS","DEGREES","DEGREES_DOUBLE","RADIANS_HALF","ARCSECONDS_TO_RADIANS","RADIANS_TO_HOURS","HOURS_TO_RADIANS","HOURS_TO_DEGREES","DEGREES_TO_HOURS","SQRT_HALF","sqrt","EPS1","EPS2","EPS3","EPS4","EPS5","EPS6","EPS7","EPS8","EPS9","EPS10","EPS11","EPS12","EPS13","EPS14","EPS15","EPS16","EPS17","EPS18","EPS19","EPS20","n","base","clamp","value","min","max","DEG2RAD","degrees","RAD2DEG","angle","isPowerOfTwo","x","nextHighestPowerOfTwo","maxValue","i","randomi","floor","random","degToDec","d","m","s","p","mod","zeroTwoPI","a","res","abs","step","edge","frac","mx","log2","exp2","pow","pow2i","slice","t","h1","h0","lerp","cube","f","square","bezier1v","p0","p1","p2","p3","bezier3v","u","tt","uu","uuu","ttt","scaleTo","addA","rev","norm_lon","lon","negativePItoPI","solve_iteration_fixed","x0","maxIter","x2","solve_iteration","err","getAngleBetweenAzimuths","b","HALF_PI","INV_PI_BY_180","INV_PI_BY_360","PI_BY_360","INV_PI_BY_180_HALF_PI","LonLat","lat","height","this","arr","length","ai","createFromArray","toArray","lonLat","mercator.POLE_BY_180","tan","mercator.POLE_BY_PI","forwardMercatorRes","inverseMercator","y","mercator.INV_POLE_BY_180","atan","exp","mercator.PI_BY_POLE","clone","forwardMercator","POLE","POLE2","PI_BY_POLE","POLE_BY_PI","POLE_BY_180","INV_POLE_BY_180","PI_BY_180","POLE_DOUBLE","ONE_BY_POLE_DOUBLE","forward","forward_lon","forward_lat","inverse_lon","inverse_lat","getTileX","zoom","getTileY","cos","forwardArray","lonlatArr","push","getTileExtent","z","size","sw","Extent","MAX_LAT","MIN_LAT","ne","southWest","northEast","lonmin","math.MAX","lonmax","math.MIN","latmin","latmax","vi","createByCoordinatesArr","width","mercator.POLE_DOUBLE","H","lnSize","ltSize","left","top","bottom","right","lonlat","e","getWidth","getCenter","getNorthEast","getSouthWest","extent","ellipsoid","xmin","xmax","ymin","ymax","zmin","zmax","v","coord","lonLatToCartesian","toString","toFixed","Mat3","constructor","_m","set","g","Vec3","Mat4","Vec4","w","toVec3","scale","iw","isZero","identity","center","ZERO","up","UP","rot","getRotation","tr","setIdentity","translate","ntr","negateTo","mul","setRotation","getMat3","c","h","j","k","l","o","r","A","B","C","D","E","q","F","G","sin","Quat","getRotationBetweenVectors","getMat4","near","far","n2","mm","lr","bt","nf","ax","ay","az","ad","bd","mat","IDENTITY","yRotation","axisAngleToQuat","axis","getNormal","half_angle","sin_a","negate","cross","normalize","fd","sourcePoint","destPoint","forwardVector","subA","dot","FORWARD","rotAngle","acos","rotAxis","getRotationBetweenVectorsRes","source","dest","isNaN","clear","cos_a","sin_lat","cos_lat","sin_long","cos_long","tx","ty","tz","asin","atan2","alpha","getAxisAngle","vl","ivl","sinPitch","sign","getYaw","getRoll","pitchRad","yawRad","rollRad","frame","qp","xRotation","qy","qr","zRotation","copy","conjugate","pitch","yaw","roll","ex","math.RADIANS_HALF","ey","ez","cr","cp","cy","sr","sp","sy","cpcy","spsy","getEulerAngles","sqy","nxt","out","xs","ys","zs","wx","wy","wz","xx","xy","xz","yy","yz","zz","inverse","magnitude2","magnitude","matching","aw","bx","by","bz","bw","omega","cosom","sinom","scale0","scale1","UNIT_Z","doubleToTwoFloats","high","low","doubleHigh","fround","doubleToTwoFloat32Array","fromVec","dotProduct","crossProduct","v1","v2","mulA","noncollinear","Boolean","proj_b_to_plane","def","sub","proj_b_to_a","orthoNormalize","normal","tangent","div","divA","length2","toVec4","vec","point3","dx","dy","dz","pos","direction","one_d","LERP_DELTA","add","fallbackAxis","v0","equal","UNIT_X","UNIT_Y","invs","Vec2","DOWN","toVector3","point2","colorTable","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","Ellipsoid","equatorialSize","polarSize","_a","_b","_flattening","_f","_a2","_b2","qa2b2","_e","_e2","_e22","_k","_k2","_radii","_radii2","_invRadii","_invRadii2","startLonLat","endLonLat","f1","f2","df","dd","lonLat1","lonLat2","fraction","dist","distance","azimuth","initialAzimuth","getGreatCircleDestination","l1","l2","getEquatorialSize","getPolarSize","polarSizeSqr","geodeticToCartesian","latrad","lonrad","slt","N","nc","pX","pY","pZ","invRadii2X","invRadii2Y","invRadii2Z","y2","z2","norm","ratio","first","isFinite","lambda","m_X","m_Y","m_Z","m_X2","m_Y2","m_Z2","func","m_X3","m_Y3","m_Z3","cart","cartesianToLonLatRes","projToSurface","getSurfaceNormal3v","r2","nx","ny","nz","direct","destination","fi1","lambda1","fi2","lambda2","L","tanU1","cosU1","sinU1","tanU2","cosU2","sinU2","antipodal","lmb","sinLmb","cosLmb","sin_s","cos_s","sinSqs","cos2sm","cosSqa","lmb_","iterations","uSq","ds","a1","EPSILON","a2","NaN","finalAzimuth","lon1","lat1","alpha1","sinAlpha1","cosAlpha1","sigma1","sinAlpha","cosSqAlpha","sigma","sigmaP","cos2SigmaM","sinSigma","cosSigma","deltaSigma","tmp","lat2","revAz","origin","q2","qw","difference","w2","product","discriminant","temp","qw2","eps","root0","root1","root","cartesian","NORTH","getLookRotation","bearing","nlon","dR","sinf1","cosf1","sinl1","cosl1","sinf2","cosf2","sinl2","cosl2","dl","f3","l3","getRhumbBearing","dLon","dPhi","eye","look","maxVisibleDistance","wgs84","getDefault","param","isEmpty","isUndef","obj","isUndefExt","defVal","_stampCounter","stamp","_openglobus_id","isString","String","d2h","val","padStart","rgbToStringHTML","rgb","Array","htmlColorToRgba","htmlColor","opacity","hColor","shorthandRegex","hex","replace","result","exec","parseInt","split","parseFloat","htmlColorToFloat32Array","Float32Array","htmlColorToRgb","stringTemplate","template","params","key","stringTemplate2","_","trim","getHTML","parseHTML","htmlStr","document","createElement","innerHTML","domArr","childNodes","removeChild","print2d","id","text","el","getElementById","classList","body","appendChild","style","isNumber","defaultString","str","createVector3","createVector4","createColorRGBA","createColorRGB","createExtent","createLonLat","binarySearchFast","start","end","binarySearch","ar","compare_fn","cmp","binaryInsert","splice","getLinesIntersection2v","start1","end1","start2","end2","isSegment","dir1","dir2","b1","d1","b2","d2","seg1_line2_start","seg1_line2_end","seg2_line1_start","seg2_line1_end","getLinesIntersectionLonLat","xmlToJson","xml","nodeType","attributes","attribute","item","nodeName","nodeValue","hasChildNodes","old","castType","string","date","Date","datetime","time","integer","float","boolean","toLowerCase","base64toBlob","base64Data","contentType","sliceSize","byteCharacters","atob","bytesLength","slicesCount","ceil","byteArrays","sliceIndex","begin","bytes","offset","charCodeAt","Uint8Array","Blob","type","base64StringToBlog","block","data","throttle","limit","skip","lastFunc","lastRan","args","arguments","apply","now","clearTimeout","setTimeout","blerp","fQ11","fQ21","fQ12","fQ22","x1","y1","blerp2","extractElevationTiles","rgbaData","outCurrenElevations","outChildrenElevations","destSize","destSizeOne","sourceSize","dt","rightHeigh","bottomHeigh","currIndex","sourceDataLength","tileX","tileY","destArr","ii","jj","destIndex","middleHeight","rightindex","bottomindex","rightBottomHeight","rightBottomindex","concatTypedArrays","concatArrays","ArrayBuffer","isView","makeArrayTyped","ctor","typedArr","makeArray","from","spliceArray","starting","deleteCount","spliceTypedArray","newSize","splicedArray","subarray","getMatrixSubArray64","sourceArr","gridSize","i0","j0","size_1","i0size","j0size","Float64Array","vInd","ind","getMatrixSubArray32","getMatrixSubArrayBoundsExt","sourceArrHigh","sourceArrLow","noDataVertices","outArr","outArrHigh","outArrLow","outBounds","outNoDataVertices","nInd","indBy3","cloneArray","items","map","isArray","async","loadImage","url","Promise","resolve","image","Image","addEventListener","src","crossOrigin","isImageLoaded","complete","naturalHeight","distanceFormat","round","distanceFormatExt","getUrlParam","paramName","urlParams","URLSearchParams","location","search","get","getTileImageResolution","imageSize","ext","mercator.getTileExtent","b0","getGreatCircleDistance","toFixedMax","maxFixed","factor","SECONDS_PER_MILLISECOND","MILLISECONDS_PER_SECOND","SECONDS_PER_MINUTE","ONE_BY_SECONDS_PER_MINUTE","MINUTES_PER_HOUR","HOURS_PER_DAY","ONE_BY_HOURS_PER_DAY","SECONDS_PER_HOUR","ONE_BY_SECONDS_PER_HOUR","SECONDS_PER_12_HOURS","MINUTES_PER_DAY","ONE_BY_MINUTES_PER_DAY","SECONDS_PER_DAY","MILLISECONDS_PER_DAY","ONE_BY_MILLISECONDS_PER_DAY","ONE_BY_SECONDS_PER_DAY","DAYS_PER_JULIAN_CENTURY","DAYS_PER_JULIAN_YEAR","PICOSECOND","MODIFIED_JULIAN_DATE_DIFFERENCE","J2000","T","jd","getDayNumber","year","month","day","DateToUTC","dayNumber","getUTCFullYear","getUTCMonth","getUTCDate","hour","getUTCHours","secondsOfDay","getUTCSeconds","getUTCMinutes","getUTCMilliseconds","extraDays","DateToTAI","UTCtoTAI","leapSeconds","leapSecondsTable","index","TAItoUTC","tai","diff","UTCtoDate","utc","julianDayNumber","I","J","remainingSeconds","minute","second","millisecond","UTC","TAItoDate","addSeconds","console","trace","addMilliseconds","milliseconds","seconds","addHours","hours","addMinutes","minutes","addDays","days","getMilliseconds","getSeconds","getHours","getMinutes","getDays","secondsToDays","daysToSeconds","__ls","J2000TAI","Box","boundsArr","vertices","setFromBoundsArr","bbox","len","bounds","getCartesianBounds","Sphere","radius","setFromBounds","createEvents","methodNames","sender","Events","eventNames","__id","__counter__","_eventNames","registerNames","_sender","_stopPropagation","_stampCache","active","handlers","name","ogid","st","_getStamp","callback","priority","_stamp","bind","_openglobus_priority","indexToRemove","hi","event","stopPropagation","VIEW_EVENTS","View","options","events","model","parent","_classList","initRender","render","on","off","insertAfter","newNodes","referenceNode","parentNode","insertBefore","nextSibling","view","HTMLElement","node","clean","firstPosition","beforeRender","afterRender","renderTemplate","dispatch","queryStr","querySelector","select","querySelectorAll","remove","TEMPLATE","BUTTON_EVENTS","Button","super","icon","title","_onMouseDown","preventDefault","mousedown","_onMouseUp","mouseup","_onTouchStart","touchstart","_onTouchEnd","touchend","_onTouchCancel","touchcancel","_onMouseClick","_mouseClickHandler","$icon","$text","__og_button__","_initEvents","click","_clearEvents","removeEventListener","Control","_name","planet","_initialized","renderer","autoActivate","_active","_deferredActive","onremove","onactivate","controls","onadd","isInitialized","oninit","activate","deactivate","isEqual","ondeactivate","isActive","control","ICON_BUTTON_SVG","CompassButton","_heading","_svg","btn","appendTo","_onClick","_draw","getCartesianFromPixelTerrain","handler","flyCartesian","camera","setHeading","getHeading","heading","transform","CLOSE_ICON","DIALOG_EVENTS","Dialog","display","visible","resize","resizable","minHeight","maxHeight","minWidth","maxWidth","_onCloseBtnClick","close","_onMouseDownAll","bringToFront","_startDragging","_startPosX","clientX","_startPosY","clientY","_onMouseMove","setPosition","offsetLeft","offsetTop","_clearDragging","$header","$title","$container","$buttons","_closeBtn","useHide","_visibility","_right","container","zIndex","__zIndex__","_initButtons","visibility","observer","IntersectionObserver","entries","obs","forEach","entry","isIntersecting","clientWidth","disconnect","observe","hide","show","getVisibility","contains","dragstart","dragend","TOGGLEBUTTON_EVENTS","ToggleButton","preventClick","setActive","_isActive","_toggle","change","toggle","VISIBLE_DISTANCE","MAX_RENDERED_NODES","NW","NE","SW","SE","S","NOTRENDERING","RENDERING","WALKTHROUGH","OPSIDE","NEIGHBOUR","OPPART","PARTOFFSET","Material","segment","layer","isReady","isLoading","texture","pickingMask","textureExists","appliedNodeId","appliedNode","texOffset","loadingAttempts","_updateTexture","_updatePickingMask","pickingReady","abortLoading","abortMaterialLoading","img","_planet","createTexture","_internalFormat","initialized","_createTexture","nodeId","textureNotExists","clearMaterial","FADING_RATIO","Layer","isVector","_iconSrc","iconSrc","LAYER_EVENTS","properties","hideInLayerSwitcher","_hasImageryTiles","_opacity","minZoom","maxZoom","_attribution","attribution","_zIndex","_isBaseLayer","isBaseLayer","_defaultTextures","defaultTextures","_fading","fading","_fadingFactor","_fadingOpacity","_height","_extent","_textureFilter","textureFilter","toUpperCase","_isSRGB","isSRGB","_extentMerc","setExtent","utils.createExtent","_pickingColor","_pickingEnabled","pickingEnabled","_isPreloadDone","_preLoadZoomLevels","preLoadZoomLevels","_ambient","_diffuse","_specular","ambient","utils.createColorRGB","diffuse","specular","shininess","nightTextureCoefficient","getTMS","getTileIndex","tileGroup","rendererEvents","picking","hasImageryTiles","getID","_id","_layers","gl","SRGB8_ALPHA8","RGBA8","_onLayerVisibilityChanged","setBaseLayer","layeradd","updateVisibleLayers","_bindPicking","_preLoad","_terrainCompletedActivated","assignPickingColor","_assignPlanet","clearPickingColor","layerremove","_clearLayerMaterial","html","updateAttributionsList","getAttribution","getHeight","getZIndex","visibleTileLayers","setZIndex","baseLayer","visibilitychange","pm","materials","createMaterial","_renderCompleted","applyMaterial","material","forceLoading","isForced","tileZoom","includes","_forceMaterialApply","nodes","_preLoadRecursive","quadTreeStrategy","quadTreeList","mercator.MIN_LAT","mercator.MAX_LAT","_correctFullExtent","getExtent","flyExtent","viewExtent","getViewExtent","overlaps","maxCurrZoom","minCurrZoom","redraw","clearLayerMaterial","CANVASTILES_EVENTS","CanvasTiles","animated","minNativeZoom","maxNativeZoom","_counter","_pendingsQueue","drawTile","_onLoadend_","_onLoadend","addTo","layerloadend","isIdle","qi","setVisibility","seg","getDefaultTexture","transparentTexture","layerLock","isFree","__requestsCounter","MAX_REQUESTS","_exec","load","requestAnimationFrame","canvas","_correctCounter","applyImage","_dequeueRequest","pmat","_whilePendings","loadend","pop","getState","quadTree.RENDERING","pn","parentTextureExists","passReady","loadMaterial","mId","psegm","pnm","dZ2","default","deleteTexture","ICON_LOCK_BUTTON_SVG","ICON_CANVASTILES_SVG","DebugInfo","_watch","watch","_toggleBtn","_dialog","_canvasTiles","applyCanvas","cnv","ctx","getContext","clearRect","beginPath","rect","lineWidth","strokeStyle","stroke","fillStyle","font","textAlign","fillText","watches","addWatch","watchEl","label","valEl","className","$controls","_frame","addWatches","_renderedNodes","_fadingNodes","_createdNodesCount","_indexesCacheToRemoveCounter","_distBeforeMemClear","getCartesianFromMouseTerrain","lodSize","deltaTime","getPitch","_lonLat","getAltitude","slope","_renderCompletedActivated","_terrainCompleted","_plainSegmentWorker","pendingQueue","_tileLoader","loading","queue","terrain","loader","_terrainWorker","_normalMapCreator","queueSize","_vectorTileCreator","lockTreeBtn","lockQuadTree","unlockQuadTree","canvasTilesBtn","addLayer","BUTTONGROUP_EVENTS","ButtonGroup","_onChange","_buttons","bi","buttons","_bindButton","button","BaseWorker","numWorkers","program","_sourceId","_source","Map","_pendingQueue","_numWorkers","_workerQueue","setProgram","make","Worker","URL","createObjectURL","onmessage","_onMessage","unshift","target","check","terminate","LOCK_UPDATE","LOCK_FREE","LabelWorker","LabelWorkerImpl","_lockId","workerCallback","delete","_entityCollection","labelData","serializeWorkerData","postMessage","buffer","BaseBillboard","_position","utils.createVector3","position","_positionHigh","_positionLow","_rotation","rotation","_color","utils.createColorRGBA","color","_alignedAxis","alignedAxis","_offset","_entity","_handler","_handlerIndex","_isReady","setPositionArr","getPosition","setOffsetArr","setOffset","setRotationArr","setRgbaArr","setColor","setColor4v","utils.htmlColorToRgba","getColor","setAlignedAxisArr","setAlignedAxis","getAlignedAxis","setPickingColorArr","workerId","Billboard","_src","_image","_scale","_width","bh","rn","renderNode","ta","billboardsTextureAtlas","that","__nodeIndex","setTexCoordArr","texCoords","addImage","updateBillboardsTexCoords","setSrc","setSizeArr","getSize","setSize","GeometryTypeEnum","GeometryType","POINT","LINESTRING","POLYGON","MULTIPOLYGON","MULTILINESTRING","Geometry","_polyVerticesHighMerc","_polyVerticesLowMerc","_polyVerticesLength","_polyIndexesLength","_polyVerticesHandlerIndex","_polyIndexesHandlerIndex","_lineVerticesHighMerc","_lineVerticesLowMerc","_lineVerticesLength","_lineOrdersLength","_lineIndexesLength","_lineColorsLength","_lineThicknessLength","_lineVerticesHandlerIndex","_lineOrdersHandlerIndex","_lineIndexesHandlerIndex","_lineThicknessHandlerIndex","_lineColorsHandlerIndex","_type","getType","_coordinates","coordinates","_style","fillColor","lineColor","strokeColor","strokeWidth","_pickingReady","typeStr","geometryObj","outCoordinates","ci","cij","pi","pij","pijk","geoJson","setPolyColorArr","rgba","setFillColor","setLineStrokeColorArr","setLineColorArr","setStrokeColor","setLineColor","setLineStrokeArr","setLineThicknessArr","setGeometryVisibility","Line2","getParallel","getIntersection","L0","L1","Line3","sphere","cx","cz","px","py","pz","vx","vy","vz","t1","solution1","t2","solution2","line","res2","p13","p43","p21","d1343","d4321","d1321","d4343","d2121","denom","numer","mua","mub","point","mag","getMagnitude","DISJOINT","COINCIDE","INTERSECT","Plane","setByPoints","pp","getProjection","vh","Pn1","Pn2","maxc","iP","Ray$1","Ray","INSIDE","INPLANE","w0","OUTSIDE","AWAY","uv","vv","wu","wv","plane","getPoint","oc","sqrtDisc","box","getTexturePath","path","filename","folder","Obj","objPositions","objTexcoords","objNormals","objVertexData","vertexData","_materialLibs","geometries","geometry","object","groups","_path","keywords","parts","vn","vt","setGeometry","numTriangles","tri","addVertex","mtllib","unparsedArgs","usemtl","newGeometry","newmtl","Ns","Ni","Ka","Kd","Ks","Ke","illum","Tr","Tf","map_Ka","map_Kd","colorTexture","map_Bump","normalTexture","map_Ns","metallicRoughnessTexture","normals","vert","ptn","objIndexStr","dlen","fileName","keywordRE","lines","lineNo","startsWith","keyword","warn","substring","lastIndexOf","response","fetch","ok","Error","reader","getReader","decoder","TextDecoder","done","read","partialLine","decode","stream","_innerParser","_cleanupGeometryArrays","defArr","then","all","mtlArr","mtl","file","objFile","mtlFile","_readAndParse","Object","fromEntries","filter","array","getColor3v","Object3d","_vertices","_numVertices","_texCoords","centering","indices","_indices","_normals","getNormals","verts","min_x","min_y","min_z","max_x","max_y","max_z","mulVec3","minX","minY","minZ","maxX","maxY","maxZ","t03","t13","t23","v0_x","v0_y","v0_z","v1_x","v1_y","v1_z","v2_x","v2_y","v2_z","vv0_x","vv0_y","vv0_z","vv1_x","vv1_y","vv1_z","n_x","n_y","n_z","lonBands","latBands","offsetX","offsetY","offsetZ","latNumber","theta","sinTheta","cosTheta","longNumber","phi","sinPhi","cosPhi","radialSegments","isTop","startIndex","thetaStart","thetaLength","centerIndexStart","centerIndexEnd","getFrustumScaleByCameraAngles","horizontalAngle","verticalAngle","aspectRatio","vAngle","xOffset","yOffset","zOffset","radiusTop","radiusBottom","heightSegments","isBottom","indexArray","indexRow","cap","createDisc","createCube","depth","sx","sz","back","front","readFileObj","baseUrl","readFile","other","objects","maxSize","merge","LOCAL_FORWARD","GeoObject","_tag","tag","_rtcPositionHigh","_rtcPositionLow","_translate","_localPosition","_tagData","_tagDataIndex","object3d","objSrc","setObjectSrc","_objectSrc","_object3d","_children","_direction","_qFrame","_qRot","updateRTCPosition","updateRotation","getRTCPosition","setRTCPositionArr","setScaleArr","setTranslateArr","getTranslate","localPosition","setLocalPositionArr","getLocalPosition","qRot","mulVec3Res","setQRotArr","getDirection","ALIGN","RIGHT","LEFT","CENTER","STR2ALIGN","Label","_text","_face","utils.defaultString","face","_size","_outline","outline","_outlineColor","outlineColor","_align","align","_fontIndex","_fontAtlas","_isRTL","isRTL","_letterSpacing","letterSpacing","setText","getText","update","setOutlineArr","getOutline","setOpacity","setOutlineOpacity","setOutlineColorArr","setOutlineColor","setOutlineColor4v","getOutlineOpacity","fontIndex","getFontIndex","_applyFontIndex","setFontIndexArr","fontAtlas","_maxLetters","COORDINATES_BUFFER","COLOR_BUFFER","PICKING_COLOR_BUFFER","PointCloud","pointSize","pickingScale","_renderNode","_points","_coordinatesData","_colorData","_pickingColorData","_coordinatesBuffer","_colorBuffer","_pickingColorBuffer","_buffersUpdateCallbacks","_createCoordinatesBuffer","_createColorBuffer","_createPickingColorBuffer","_changedBuffers","points","setPoints","_deleteBuffers","_setPickingColors","col","pointCloud","draw","_update","sh","programs","_program","sha","shu","uniforms","uniformMatrix4fv","projectionViewMatrix","activeCamera","getProjectionViewMatrix","uniform1f","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","itemSize","FLOAT","colors","drawArrays","POINTS","numItems","call","deleteBuffer","createArrayBuffer","VERTICES_BUFFER","INDEX_BUFFER","COLORS_BUFFER","DEFAULT_COLOR","R","Polyline","__doubleToTwoFloats","altitude","thickness","_defaultColor","_closedLine","isClosed","_path3v","_pathLengths","_pathLonLat","_pathLonLatMerc","_pathColors","pathColors","_verticesHigh","_verticesLow","_orders","_indexes","_colors","_verticesHighBuffer","_verticesLowBuffer","_ordersBuffer","_indexesBuffer","_colorsBuffer","_createVerticesBuffer","_createIndexBuffer","_createColorsBuffer","visibleSpherePosition","visibleSphereRadius","_visibleSphere","pathLonLat","setPathLonLat","path3v","setPath3v","_refresh","defaultColor","outVerticesHigh","outVerticesLow","outOrders","outIndexes","outTransformedPathLonLat","outPath3v","outTransformedPathMerc","outExtent","outColors","v_high","v_low","pathColors_j","last","cur","cartesianToLonLat","point3v","pathColors_last","transformedPathLonLat","transformedPathMerc","setPathColors","outTransformedPathCartesian","outPathLonLat","pji","segmentIndex","setPoint3v","skipLonLat","kk","concat","multiLineIndex","multilineIndex","cc","addPoint3v","skipEllipsoid","__appendPoint3v","_clearData","getThickness","_createDataLonLat","_createData3v","__appendLineData3v","_resizePathLengths","pathLonlat","__appendLineDataLonLat","getPathLonLat","getPathColors","slen","forceEqual","_setEqualPathLonLat","_setEqualPath3v","polyline_screen","ec","disable","CULL_FACE","depthOffset","polygonOffsetUnits","proj","getProjectionMatrix","getViewMatrix","uniform3fv","rtcEyePositionHigh","_rtcEyePositionHigh","rtcEyePositionLow","_rtcEyePositionLow","uniform4fv","visibleSphere","uniform2fv","viewport","prevHigh","currentHigh","nextHigh","prevLow","currentLow","nextLow","order","ELEMENT_ARRAY_BUFFER","drawElements","TRIANGLE_STRIP","UNSIGNED_INT","enable","polyline_picking","createStreamArrayBuffer","setStreamArrayBuffer","Uint32Array","createElementArrayBuffer","_relativeCenter","_thickness","_startPosition","startPosition","_startPositionHigh","_startPositionLow","_endPosition","endPosition","_endPositionHigh","_endPositionLow","_startColor","startColor","_endColor","endColor","setStartPositionArr","setEndPositionArr","setThicknessArr","getStartPosition","getEndPosition","_tempHigh","_tempLow","Strip","_indexBuffer","_gridSize","setPath","_createBuffers","strip","viewMatrix","projectionMatrix","eyePositionHigh","eyeHigh","eyePositionLow","eyeLow","uColor","uOpacity","aVertexPositionHigh","aVertexPositionLow","drawPicking","vHigh","vLow","gs","gs1","di","p02","dj","p01","p23","intersects","ind3","addEdge3v","vSize","prev","p4","p5","next","p35","p24","ij","p45","Entity","childEntities","forceGlobalPosition","forceGlobalRotation","forceGlobalScale","_cartesian","_rootCartesian","_absoluteLocalPosition","utils.createLonLat","_lonLatMerc","_altitude","_entityCollectionIndex","_layer","_layerIndex","_independentPicking","independentPicking","_relativePosition","relativePosition","_pitchRad","_yawRad","_rollRad","_absoluteQRot","_featureConstructorArray","billboard","setBillboard","setLabel","polyline","setPolyline","setPointCloud","geoObject","setGeoObject","setStrip","ray","setRay","_createOptionFeature","isRelative","getAbsoluteCartesian","getAbsolutePitch","getAbsoluteYaw","getAbsoluteRoll","setCartesian3v","setPitch","setYaw","setRoll","setAbsoluteCartesian3v","setAbsolutePitch","setAbsoluteYaw","setAbsoluteRoll","entityCollection","entity","instanceName","featureName","collection","rightNow","removeEntity","setCartesian","getScale","setScale3v","chi","setScale","lq","setLookRotation","setAbsoluteRotation","setLook3v","_updatePitchYawRoll","_updateAbsolutePosition","setPitchYawRoll","_getScaleByDistance","scd","scaleByDistance","lookLength","absolutCartesian","getCartesian","_updateLonLat","mulRes","rotCart","addRes","getFrameRotation","setPosition3v","setLocalPosition3v","getLonLat","lonLatToCartesianRes","billboardHandler","labelHandler","rayHandler","polylineHandler","pointCloudHandler","geoObjectHandler","stripHandler","appendChildEntity","setPickingColor3v","setPickingColor","BaseNode","topNode","_dictionary","destroy","_clear","RenderNode","drawMode","lightEnabled","_lightPosition","_lightParams","_lightShininess","entityCollections","_entityCollectionsByDepthOrder","_pickingId","addNode","assign","addPickingCallback","_entityCollectionPickingCallback","initialize","bindRenderNode","init","renderNodes","_renderNodesArr","removePickingCallback","isHidden","updateEntityCollectionsDepthOrder","_updateGeodeticCoordinates","grouped","depthOrder","keys","sort","light","_preDrawNodes","_drawNodes","mode","setDrawMode","refreshTexCoordsArr","preFrame","drawEntityCollections","enqueueEntityCollectionsToDraw","Cons","_container","cons","_declarations","types","variableHandlers","MAT4","variable","_pName","MAT3","uniformMatrix3fv","INT","uniform1i","VEC2","VEC3","VEC4","SAMPLER2D","pgl","activeTexture","TEXTURE0","_textureID","bindTexture","TEXTURE_2D","SAMPLERCUBE","TEXTURE_CUBE_MAP","SAMPLER2DARRAY","samplerArr","Int32Array","uniform1iv","INTXX","FLOATXX","uniform1fv","vertexAttrib1f","vertexAttrib2fv","vertexAttrib3fv","itemTypes","injectWebGL2Define","isWebGL2","versionIndex","findIndex","join","Program","_attributes","_uniforms","vertexShader","fragmentShader","_variables","_p","_attribArrays","_attribDivisor","vertexAttribDivisor","drawElementsInstanced","itemType","normalized","use","useProgram","UNSIGNED_SHORT","shader","WebGL2RenderingContext","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","logErr","getShaderInfoLog","createShader","VERTEX_SHADER","_getShaderCompileStatus","FRAGMENT_SHADER","disableAttribArrays","disableVertexAttribArray","enableVertexAttribArray","deleteProgram","createProgram","fs","_createFragmentShader","vs","_createVertexShader","attachShader","linkProgram","getExtension","drawElementsInstancedANGLE","vertexAttribDivisorANGLE","getProgramParameter","LINK_STATUS","getProgramInfoLog","itemTypeStr","indexOf","divisor","getAttribLocation","loc","getUniformLocation","detachShader","deleteShader","billboard_picking_vert_default","billboard_picking_frag_default","billboard_screen_vert_default","billboard_screen_frag_default","billboardPicking","planetRadius","uScaleByDistance","a_vertices","a_positionsHigh","a_positionsLow","a_offset","a_size","a_rotation","a_rgba","billboard_picking_vert","billboard_picking_frag","billboard_screen","u_texture","a_texCoord","billboard_screen_vert","billboard_screen_frag","PICKINGCOLOR_BUFFER","POSITION_BUFFER","SIZE_BUFFER","OFFSET_BUFFER","RGBA_BUFFER","ROTATION_BUFFER","TEXCOORD_BUFFER","VERTEX_BUFFER","BaseBillboardHandler","_renderer","_billboards","_positionHighBuffer","_positionLowBuffer","_sizeBuffer","_offsetBuffer","_rgbaBuffer","_rotationBuffer","_texCoordBuffer","_vertexBuffer","_texCoordArr","_vertexArr","_positionHighArr","_positionLowArr","_sizeArr","_offsetArr","_rgbaArr","_rotationArr","_pickingColorArr","createPickingColorBuffer","createPositionBuffer","createSizeBuffer","createOffsetBuffer","createRgbaBuffer","createRotationBuffer","createTexCoordBuffer","createVertexBuffer","curr","initProgram","addProgram","shaders.billboard_screen","shaders.billboardPicking","_removeBillboards","refresh","_planetRadius2","clientHeight","TRIANGLES","_displayPASS","_pickingPASS","reindexBillboardsArray","_removeBillboard","positionHigh","positionLow","tcoordArr","vArr","setVertexArr","vertexArr","BillboardHandler","props","_addBillboardToArrays","getSrc","getImage","bc","imageNode","geo_object_vert_default","geo_object_frag_default","geo_object_picking_vert_default","geo_object_picking_frag_default","geo_object_depth_vert_default","geo_object_depth_frag_default","geo_object","sunPosition","materialParams","materialShininess","uTexture","uUseTexture","useLighting","aVertexPosition","aVertexNormal","aTexCoord","aLocalPosition","aRTCPositionHigh","aRTCPositionLow","aColor","aScale","aTranslate","aDispose","geoObjectVert","geoObjectFrag","geo_object_picking","aPickingColor","geoObjectPickingVert","geoObjectPickingFrag","geo_object_depth","frustumPickingColor","geoObjectDepthVert","geoObjectDepthFrag","AMBIENT_R","AMBIENT_G","AMBIENT_B","DIFFUSE_R","DIFFUSE_G","DIFFUSE_B","SPECULAR_R","SPECULAR_G","SPECULAR_B","InstanceData","_geoObjectHandler","geoObjects","numInstances","_colorTexture","_colorTextureSrc","_normalTexture","_normalTextureSrc","_metallicRoughnessTexture","_metallicRoughnessTextureSrc","_translateArr","_rtcPositionHighArr","_rtcPositionLowArr","_qRotArr","_normalsArr","_indicesArr","_visibleArr","_localPositionArr","_translateBuffer","_rtcPositionHighBuffer","_rtcPositionLowBuffer","_qRotBuffer","_normalsBuffer","_indicesBuffer","_visibleBuffer","_localPositionBuffer","_materialParams","_materialShininess","NORMALS_BUFFER","createNormalsBuffer","createIndicesBuffer","VISIBLE_BUFFER","createVisibleBuffer","QROT_BUFFER","createQRotBuffer","TRANSLATE_BUFFER","createTranslateBuffer","RTC_POSITION_BUFFER","createRTCPositionBuffer","LOCALPOSITION_BUFFER","createLocalPositionBuffer","setMaterialAmbient","setMaterialDiffuse","setMaterialSpecular","setMaterialShininess","_drawElementsInstanced","defaultTexture","createTextureDefault","REPEAT","setParametersToArray","GeoObjectHandler","_geoObjects","_instanceDataMap","_instanceDataMapValues","_dataTagUpdateQueue","shaders.geo_object","shaders.geo_object_picking","shaders.geo_object_depth","_loadColorTexture","_loadNormalTexture","_loadMetallicRoughnessTexture","tagData","loadObj","_updateInstanceData","_updateTag","values","setMaterialParams","_bindCommon","_useLighting","_displayOpaquePASS","instanceData","drawOpaque","drawTransparent","_depthPASS","cam","frustumColorIndex","createColorTexture","createNormalTexture","createMetallicRoughnessTexture","tagDataIndex","rtcPositionHigh","rtcPositionLow","dataTag","gi","_removeAll","rtcPosition","_updateRTCEyePosition","isFirstPass","rtcEyePosition","_displayTransparentPASS","_addGeoObjectToArray","_removeGeoObject","_clearDataTagQueue","tdi","label_webgl2_vert_default","label_webgl2_frag_default","label_webgl1_vert_default","label_webgl1_frag_default","label_picking_vert_default","label_picking_frag_default","label_webgl2","fontTextureArr","sdfParamsArr","isOutlinePass","a_outline","a_gliphParam","a_fontIndex","label_webgl2_vert","label_webgl2_frag","label_screen","label_webgl1_vert","label_webgl1_frag","labelPicking","label_picking_vert","label_picking_frag","FONTINDEX_BUFFER","OUTLINE_BUFFER","OUTLINECOLOR_BUFFER","EMPTY","RTL","LabelHandler","maxLetters","_gliphParamBuffer","_fontIndexBuffer","_outlineBuffer","_outlineColorBuffer","_gliphParamArr","_fontIndexArr","_outlineArr","_outlineColorArr","createFontIndexBuffer","createOutlineBuffer","createOutlineColorBuffer","shaders.label_webgl2","shaders.label_screen","shaders.labelPicking","assignFontAtlas","labelWorker","_addLabelToArrays","texCoordArr","gliphParamArr","positionHighArr","positionLowArr","sizeArr","offsetArr","rgbaArr","rotationArr","fontIndexArr","outlineArr","outlineColorArr","pickingColorArr","depthFunc","EQUAL","LESS","li","ml","fa","atlasesArr","_rtl_","kern","kernings","char","tc","metrics","nWidth","nHeight","nXOffset","nYOffset","nAdvance","xl","yl","zl","PointCloudHandler","_pointClouds","shaders.pointCloud","_initProgram","setRenderNode","_reindexPointCloudArray","pc","polyline_screen_vert_default","polyline_screen_frag_default","polyline_picking_vert_default","polyline_picking_frag_default","polyline_screen_vert","polyline_screen_frag","polyline_picking_vert","polyline_picking_frag","PolylineHandler","_polylines","shaders.polyline_screen","shaders.polyline_picking","reindexPolylineArray","ls","ray_vert_default","ray_frag_default","rayScreen","resolution","a_startPosHigh","a_startPosLow","a_endPosHigh","a_endPosLow","a_thickness","ray_vert","ray_frag","START_POSITION_BUFFER","END_POSITION_BUFFER","THICKNESS_BUFFER","RayHandler","_rays","_startPositionHighBuffer","_startPositionLowBuffer","_endPositionHighBuffer","_endPositionLowBuffer","_thicknessBuffer","_startPositionHighArr","_startPositionLowArr","_endPositionHighArr","_endPositionLowArr","_thicknessArr","createStartPositionBuffer","createEndPositionBuffer","createThicknessBuffer","shaders.rayScreen","ri","_removeRays","_addRayToArrays","r0","g0","a0","r1","g1","_tanViewAngle_hradOneByHeight","reindexRaysArray","_removeRay","DYNAMIC_DRAW","StripHandler","_strips","reindexStripArray","EntityCollection","_onChangeRelativeCenter","setRelativeCenter","labelMaxLetters","setPickingEnabled","_entities","_depthOrder","ENTITYCOLLECTION_EVENTS","entities","addEntities","depghOrder","farInvisible","math.MAX32","_addRecursively","_setPickingColor","entityadd","_removeRecursively","reindexEntitiesArray","belongs","entityremove","ei","createPickingColors","addEntityCollection","setRenderer","updateBillboardsTextureAtlas","updateLabelsFontAtlas","billboards","updateFonts","removeEntityCollection","getEntities","_clearEntity","doubleToTwoFloats2","highLowArr","doubleToTwoFloatsV2","highLowVec","earcut","holeIndices","dim","hasHoles","outerLen","outerNode","linkedList","triangles","eliminateHoles","earcutLinked","clockwise","signedArea","insertNode","equals","removeNode","filterPoints","again","steiner","area","ear","pass","stop","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","zOrder","nextZ","prevZ","locallyInside","isValidDiagonal","splitPolygon","list","getLeftmost","compareX","eliminateHole","hole","findHoleBridge","hx","hy","qx","my","tanMin","Infinity","indexCurve","sortLinked","tail","numMerges","pSize","qSize","inSize","leftmost","intersectsPolygon","middleInside","q1","inside","Node","an","bp","sum","flatten","holes","dimensions","holeIndex","POLYVERTICES_BUFFER","POLYINDEXES_BUFFER","POLYCOLORS_BUFFER","LINEVERTICES_BUFFER","LINEINDEXES_BUFFER","LINEORDERS_BUFFER","LINECOLORS_BUFFER","LINETHICKNESS_BUFFER","LINESTROKES_BUFFER","LINESTROKECOLORS_BUFFER","POLYPICKINGCOLORS_BUFFER","LINEPICKINGCOLORS_BUFFER","tempHigh","tempLow","tempHighLow","GeometryHandler","_geometries","_updatedGeometryArr","_updatedGeometry","_removeGeometryExtentArr","_removeGeometryExtents","_polyColors","_polyPickingColors","_polyIndexes","_lineOrders","_lineIndexes","_lineColors","_linePickingColors","_lineThickness","_lineStrokes","_lineStrokeColors","_polyVerticesHighBufferMerc","_polyVerticesLowBufferMerc","_polyColorsBuffer","_polyPickingColorsBuffer","_polyIndexesBuffer","_lineVerticesHighBufferMerc","_lineVerticesLowBufferMerc","_lineColorsBuffer","_linePickingColorsBuffer","_lineThicknessBuffer","_lineStrokesBuffer","_lineStrokeColorsBuffer","_lineOrdersBuffer","_lineIndexesBuffer","createPolyVerticesBuffer","createPolyIndexesBuffer","createPolyColorsBuffer","createLineVerticesBuffer","createLineIndexesBuffer","createLineOrdersBuffer","createLineColorsBuffer","createLineThicknessBuffer","createLineStrokesBuffer","createLineStrokeColorsBuffer","createPolyPickingColorsBuffer","createLinePickingColorsBuffer","pathArr","pickingColor","strokeSize","outPickingColors","outThickness","outStrokeColors","outStrokes","outVerticesHigh2","outVerticesLow2","sc","mercator.forward_lon","mercator.forward_lat","indexes","verticesHigh","verticesLow","appendLineData","cci","dataIndexes","treeNode","ready","lid","ni","getExtentLonLat","_refreshRecursevely","_refreshRecursevelyExt","ql","_refreshPlanetNode","needUpdate","_updatePlanet","polyIndexes","lineIndexes","_entitiesConstructor","Vector","VECTOR_EVENTS","clampToGround","relativeToGround","_labelMaxLetters","_stripEntityCollection","_bindEventsDefault","_polylineEntityCollection","_geoObjectEntityCollection","_geometryHandler","_nodeCapacity","nodeCapacity","_entityCollectionsTreeStrategy","setEntities","assignHandler","_proceedEntity","_setCartesian3vSilent","insertEntity","_reindexEntitiesArray","_removeEntitySilent","_nodePtr","count","deferredEntities","defEntities","dispose","entitiesForTree","_createEntityCollectionsTree","createEntitiCollectionsTreeStrategy","insertEntities","ve","mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","doubletouch","touchleave","touchenter","rtg","visibleExtent","e_i","coords","c_j","c_j_h","ll","n_k","isInside","getTerrainPoint","alt","_collectStripCollectionPASS","_collectPolylineCollectionPASS","_collectGeoObjectCollectionPASS","collectVisibleEntityCollections","_isNorth","solidTextureOne","solidTextureTwo","notEmpty","POLYGONDRAWINGSCENE_EVENTS","POINTER_OBJ3D","createCylinder","NUM_SEGMENTS","OUTLINE_ALT","COORDINATES_COLOR","CENTER_COLOR","OUTLINE_COLOR","OUTLINE_THICKNESS","CORNER_OPTIONS","instanced","CENTER_OPTIONS","OUTLINE_OPTIONS","PolygonDrawingScene","_cornerDblClick","geometryType","getCoordinates","_geometryLayer","_onCornerMouseEnter","cursor","hideGhostPointer","_onCornerMouseLeave","showGhostPointer","_onCenterMouseEnter","_onCenterMouseLeave","_pickedCenter","_pickedCorner","_onLup","mouseNavigation","setGhostPointerPosition","_onCornerLdown","_getLdown","_onCenterLdown","_moveCenterPoint","_moveCornerPoint","_onCornerLdblclick","pickingObject","layerIndex","setCoordinates","_onMouseDblClick","_showGhostPointer","_addNew","_isStartPoint","_cornerLayer","startpoint","_initCoordinates","_startPos","_startClick","_centerLayer","_outlineLayer","_ghostCorner","_ghostOutlineLayer","_insertCornerIndex","corners","_initGhostLayerPointer","startNewPoint","stopNewPoint","centers","_clearGhostPointer","_appendCart","groundPos","_updateGhostOutlinePointer","getPixelFromCartesian","_checkTerrainCollision","_drawCenters","_drawGhostCorner","_drawCorners","_tempTerrPoint","_extentLonLat","getEntityTerrainPoint","newCorner","segNum","prevCorn","corner","firstCart","prevCart","vecPrev","vecFirst","distPrev","distFirst","prevPath","firstPath","firstCenter","prevCenterCart","firstCenterCart","groundCoords","cartPrev","cartNext","vecNext","distNext","pathPrev","pathNext","prevPolyline","nextPolyline","prevCenter","nextCenter","nextCenterCart","minDist","cCurr","cNext","cPrev","nPrev","nNext","nGround","midVec","toMid","side","getNearestDistancePoint","LineStringDrawingScene","indexCurrent","indexPrev","indexCenter","cartCurr","vecCurr","distCurr","centerCart","_moveCorner","DrawingControl","_drawingScene","activatePolygonDrawing","activateLineStringDrawing","bindPlanet","ICON_POLYGON_SVG","ICON_LINESTRING_SVG","ICON_DEFAULT_SVG","DrawingSwitcher","drawingControl","addControl","_createMenu","defaultBtn","polyBtn","lineBtn","ELL","MSL","GND","heightMode","ell","msl","gnd","KM_to_M","M_to_KM","FT_to_M","M_to_FT","MS_to_KMH","KMH_to_MS","MS_to_FTS","FT_to_KM","KM_to_FT","km","ft","ms","kmh","fts","DEFAULT_NAN","_abbr","_tenth","_convFn","convert","to","convertExt","isNotNaN","unitFrom","unitTo","fixed","DECIMAL_TEMPLATE","DEGREE_TEMPLATE","CENTER_SVG","TYPE_HTML","EarthCoordinates","_TYPE_FUNC","_SHOW_DECIMAL","_SHOW_DEGREE","_showFn","_el","_latSideEl","_lonSideEl","_latValEl","_lonValEl","_heightEl","_altUnitVal","altitudeUnit","_heightModeVal","_altUnit","units","_heightMode","_centerMode","deg","sec","_createCenterEl","_updateUnits","units.toString","_showHeight","_refreshCoordinates","_grabCoordinates","scrPx","getLonLatFromPixelTerrain","getHeightAboveELL","units.convertExt","units.m","getHeightDefault","BASEGEOIMAGE_EVENTS","BaseGeoImage","_projType","_frameWidth","_frameHeight","_sourceReady","_sourceTexture","_materialTexture","_gridBufferLow","_gridBufferHigh","_extentWgs84ParamsHigh","_extentWgs84ParamsLow","_extentMercParamsHigh","_extentMercParamsLow","_refreshFrame","_frameCreated","_sourceCreated","_animate","_ready","_creationProceeding","_isRendering","_extentWgs84","_cornersWgs84","_cornersMerc","_isFullExtent","fullExtent","rendering","_renderingProjType0","setCorners","setCornersLonLat","setByCoordinates","me","_renderingProjType1","_geoImageCreator","_createFrame","forwardMercatorEPS01","tempArr","createEmptyTexture_l","gridBufferArr","createGridBuffer","applyTexture","v0s","v0t","getExtentMerc","sSize_x","sSize_y","dV0s_x","dV0s_y","dSize_x","dSize_y","getFrameWidth","getFrameHeight","creator","_createSourceTexture","_framebuffer","geoImageTransform","bindOutputTexture","clearColor","COLOR_BUFFER_BIT","isFullExtent","_texCoordsBuffer","cornersHigh","cornersLow","extentParamsHigh","extentParamsLow","sourceTexture","GeoImageDragControl","_cornerIndex","_catchCorner","_bindLayer","layers","_unbindLayer","_onMouseLeave","_onLDown","_onLUp","getCornersLonLat","ground","getDistanceFromPixel","input","MB_LEFT","MB_RIGHT","MB_MIDDLE","KEY_CTRL","KEY_ALT","KEY_SHIFT","KEY_SPACE","KEY_PGUP","KEY_PGDN","KEY_LEFT","KEY_UP","KEY_RIGHT","KEY_DOWN","KEY_PRINTSCREEN","KEY_EQUALS","KEY_A","KEY_C","KEY_D","KEY_E","KEY_F","KEY_H","KEY_I","KEY_K","KEY_L","KEY_N","KEY_O","KEY_P","KEY_Q","KEY_R","KEY_S","KEY_V","KEY_W","KEY_X","KEY_Z","KEY_PLUS","KEY_F1","KEY_MINUS","KEY_APOSTROPHE","KEY_BACK_SLASH","KEY_MORE","KEY_SLASH","KEY_LESS","KEY_LEFT_SQUARE_BRACKET","KEY_RIGHT_SQUARE_BRACKET","KEY_SINGLE_QUOTE","KeyboardNavigation","onCameraPitchUp","_camera","onCameraPitchDown","onCameraYawLeft","onCameraYawRight","onCameraMoveForward","force","getForward","onCameraMoveBackward","getBackward","speed","vel","mass","onDraw","acc","LAYERANIMATION_EVENTS","LayerAnimation","_currVisibleIndex","_onViewchange","_timeoutStart","performance","_onVisibilityChange","isVisible","pause","_onLayerLoadend","currLayer","_layersArr","_currentIndex","currFrame","_getFrameIndex","_frameSize","currVisibleLayer","prevFrame","_removeFrameFromPlanet","idle","_playInterval","playInterval","_playIntervalHandler","_playIndex","frameSize","repeat","skipTimeout","_getFramesNum","frameIndex","_appendFrameToPlanet","minIndex","maxIndex","_initLayers","_setCurrentIndexAsync","layersToRemove","isPlaying","play","setInterval","_checkEnd","_clearInterval","setCurrentIndex","clearInterval","forceVisibility","prevCurrIndex","prevCurrFrame","prevCurrLayer","frameChanged","LAYER_BUTTON_TEMPLATE","LayerButtonView","_onDblClick","LayerSwitcher","layerView","_createLayerButton","_layerViews","$baseLayers","$overlays","removeLayer","_panel","SLIDER_EVENTS","Slider","_onResize","_setOffset","_value","_min","$panel","_max","_onMouseWheel","window","wheelDelta","_onMouseWheelFF","_onInput","getBoundingClientRect","_resizeObserver","ResizeObserver","$label","$pointer","$progress","$input","COLOR_EVENTS","__labelCounter__","Color","SUN_STOP_SVG_ICON","SUN_ACTIVE_SVG_ICON","LIGHTING_ENABLED_SVG_ICON","ATMOSPHERE_SVG_ICON","MAX_COLOR","Lighting","_selectedLayer","$gamma","$exposure","$night","$opacity","$diffuse","$ambient","$specular","$atmosphereOpacity","$simpleSkyBackground","_atmosphereMaxOpacity","_atmosphereMinOpacity","_simpleSkyBackgroundColorOne","_simpleSkyBackgroundColorTwo","_gamma","_exposure","_night","_diffuse_r","_diffuse_g","_diffuse_b","_ambient_r","_ambient_g","_ambient_b","_specular_r","_specular_g","_specular_b","_shininess","$suncontrol","sunStopBtn","sunActiveBtn","sun","lightingEnabledBtn","atmosphereEnabledBtn","atmosphereEnabled","gamma","exposure","atmosphereMinOpacity","atmosphereMaxOpacity","atmos","Atmosphere","simpleSkyBackgroundControl","SimpleSkyBackground","colorOne","colorTwo","getLayerByName","bindLayer","_onLayerAdd","_onLayerRemove","_fetchLayers","opt","innerText","Lock","_lock","Key","OldMouseNavigation","_deactivate","_shiftBusy","grabbedPoint","_eye0","pointOnEarth","earthUp","inertia","grabbedSpheroid","scaleRot","distDiff","stepsCount","stepsForward","stepIndex","_lmbDoubleClickActive","minSlope","_wheelDirection","_keyLock","getMovePointsFromPixelTerrain","delta","dir","steps","getRight","getUp","scaled_n","rotArr","eyeArr","breaked","hitSphere","rotateBetweenVectors","onMouseWheel","onMouseLeftButtonDown","onMouseRightButtonDown","onMouseLeftButtonClick","onMouseLeftButtonUp","onMouseRightButtonClick","onMouseMove","onMouseLeave","onMouseEnter","onMouseLeftButtonDoubleClick","renderEvents","isKeyPressed","releaseKeys","updateButtonsStates","sys","mouseState","leftButtonDown","stopFlying","stopRotation","lockPlanet","onShiftFree","maxAlt","maxAltitude","minAlt","minAltitude","camAlt","flyLonLat","freePlanet","prev_x","prev_y","moving","targetPoint","rotate","hitPlaneRes","fromPoints","controlsBag","math.RADIANS","rotateHorizontal","rotateVertical","prevEye","sf","_u","_r","slerp","skipTerrain","lock","terrainLock","free","DEFAULT_VELINERTIA","MIN_SLOPE","MouseNavigation","_hold","_prevVel","_screenPosIsChanged","_onShiftFree","_onRHold","_onRDown","_onMouseEnter","_targetRotationPoint","_velInertia","force_h","force_v","_getTargetPoint","_targetZoomPoint","_targetDragPoint","_tUp","_tRad","_grabbedSphere","_curPitch","_curYaw","_curRoll","_currScreenPos","_isTouchPad","isTouchPad","spdAlt","force_roll","_grabbedPoint","_grabbedCameraHeight","fixedUp","_onLHold","newEye","vel_h","vel_v","vel_roll","_lookPos","_rotHDir","_rotVDir","_rot","_newEye","_updateVel","_handleZoom","_handleDrag","_handleRotation","d_v_h","d_v_v","getCartesianFromPixelEllipsoid","eyeNorm","d_v","d_s","_corrRoll","checkTerrainCollision","velDir","destDist","dirCurr","unproject2v","dirNew","px0","px1","pl","dp","_updateVel_h","_updateVel_v","_updateVel_roll","OUTLINE_COUNT","obj3d","LABEL_OPTIONS","RULER_CORNER_OPTIONS","RulerScene","_startLonLat","_anchorLonLat","_cornerEntity","_onCornerLup","_onCornerEnter","_onCornerLeave","_onLdblclick","_preventClick","_onLclick","_timeout","_stopDrawing","_propsLabel","_drawLine","newLonLat","RULERSCENE_EVENTS","_ignoreTerrain","ignoreTerrain","_trackLayer","_labelLayer","_cornersLayer","_trackEntity","_createCorners","_activate","startPos","endPos","getPath3v","isCornersPositionChanged","Ruler","_rulerScene","RAYS_OPTIONS","HeightRulerScene","_geoRulerLayer","_rayV","_rayH","_heightLabels","startCorner","startCornerLonLat","endCorner","endCornerHeight","endCornerLonLat","maxHeightCornerLonLat","startCornerHeight","minHeightCornerLonLat","deltaHeight","_updateHeightRaysAndLabels","middleLonLat","setStartPosition3v","setEndPosition3v","deltaLabel","setLonLat","startLabel","endLabel","startHeight","endHeight","HeightRuler","RulerSwitcher","ruler","_createMenuBtn","ScaleControl","_template","_minWidth","_maxWidth","_isCenter","isCenter","_mPx","currWidth","_metersInMinSize","_scaleLabelEl","_renderTemplate","_drawScreen","leftButtonHold","rightButtonHold","s0","project3v","tempSize","viewAngle","s1","metersInMinSize","minMeters","maxMeters","ShowFps","SimpleNavigation","_onMouseLeftButtonClick","getCartesianFromPixel","_onMouseLeftButtonUp","_onMouseLeftButtonDown","camSlope","_up","onCameraStrifeLeft","getLeft","onCameraStrifeRight","onCameraLookUp","onCameraLookDown","onCameraTurnLeft","onCameraTurnRight","onCameraRollLeft","onCameraRollRight","_colorOne","_colorTwo","simpleSkyBackgroundShader","_drawBackground","simpleSkyBackground","DEPTH_TEST","screenFramePositionBuffer","camPos","iResolution","fov","getViewAngle","earthRadius","J2000_OBLIQUITY","AU_TO_METERS","getSunPosition","jDate","jd.J2000","M","math.rev","oblecl","astro.J2000_OBLIQUITY","math.DEGREES","xequat","yequat","zequat","math.TWO_PI","astro.AU_TO_METERS","LightSource","_tempAmbient","_tempDiffuse","_tempSpecular","_tempShininess","setAmbient","setDiffuse","setSpecular","setShininess","setAmbient3v","setDiffuse3v","setSpecular3v","Sun","activationHeight","offsetVertical","offsetHorizontal","sunlight","_currDate","_prevDate","_clockPtr","_lightOn","_stopped","stopped","defaultClock","clock","currentDate","tu","ToggleWireframe","toogleWireframe","LINE_STRIP","TouchExt","_vec","_vecPrev","dX","TouchNavigation","touches","_touching","onTouchStart","onTouchEnd","onDoubleTouch","onTouchCancel","onTouchMove","t0","pixelRatio","_startTouchOne","middle","earthMiddlePoint","prevAngle","curAngle","deltaAngle","distanceToPointOnEarth","zoomCur","zoomPrev","rotateAround","panCur","panPrev","panOffset","unproject","ICON_PLUS_SVG","ICON_MINUS_SVG","ZoomControl","_move","_targetPoint","zoomInBtn","zoomOutBtn","zoomIn","stopZoom","zoomOut","SelectionScene","EVENT_NAMES","_onSelect","onSelect","_autoSelectionHide","autoSelectionHide","_c","_d","_onMouseMove_","_onMouseLdown_","_onMouseLdown","_onMouseLup_","_onMouseLup","createPath","sideA","sideB","Selection","_selectorScene","dateToStr","showTime","showMilliseconds","MONTHS","getMonth","createCanvasHTML","getNearestTimeLeft","drawNotch","moveTo","lineTo","drawText","baseLine","rotDeg","save","textBaseline","restore","SCALES","TIMELINE_EVENTS","TimelineModel","_current","current","_rangeStart","rangeStart","_rangeEnd","rangeEnd","_range","getTime","_minDate","minDate","_maxDate","maxDate","multiplier","_requestAnimationFrameId","_prevNow","_animationFrameCallback","cancelAnimationFrame","currentTime","range","SECONDS_TO_MILLISECONDS","MILLISECONDS_TO_SECONDS","TIMELINEVIEW_EVENTS","ICON_PLAY_SVG","ICON_PAUSE_SVG","SCALE_FILL_COLOR","SCALE_NOTCH_COLOR","SCALE_TIME_COLOR","TimelineView","_isMouseOver","_canvasEl","pointerPosX","pointerCenterOffsetX","pointerTime","rangeStartTime","_millisecondsInPixel","_zoom","_isCurrentMouseOver","_isDragging","_clickPosX","_clickTime","_clickRangeStart","_clickRangeEnd","startdrag","_isCurrentDragging","_clickCurrentDate","startdragcurrent","_clickDelay","stopdrag","setcurrent","stopdragcurrent","_onMouseOut","_onCurrentMouseEnter","_onCurrentMouseOut","offsetSec","newCurrent","_frameEl","_currentEl","_ctx","_canvasScale","_onResizeObserver_","_onResizeObserver","_pauseBtn","_playBtn","_resize","_drawCurrent","reset","playback","centerTime","centerTimeOffset","newRangeStart","newRangeEnd","msPx","timeOffset","fillRect","curPosX","minWidthMs","scaleData","_clearCanvas","scaleMs","scalePx","segCount","originTime","rangeEndTime","getOffsetByTime","setHours","TimelineControl","startDate","endDate","_timelineView","setDate","Deferred","reject","promise","freeze","DEFAULT_WARNING_HEIGHT_LEVEL","ELEVATIONPROFILE_EVENTS","SAFE","WARNING","COLLISION","TRACK","GROUND","SEGMMENT_LENGTH","GROUND_OFFSET","BOTTOM_PADDING","TOP_PADDING","HEIGHT_EPS","ElevationProfile","_warningHeightLevel","_pointsReady","_isWarning","_minX","_planeDistance","_maxX","_minY","_maxY","_drawData","_promiseArr","_promiseCounter","_pMaxY","_pMinY","_pDist","_pTrackCoords","_pGroundCoords","_pIndex","warningHeight","pIndex","promiseCounter","geoid","getHeightLonLat","getHeightAsync","elv","_updatePointType","internalPoints","scaleFactor","trackDir","dirSegLen","pjd","llx","_getHeightAsync","pointsLonLat","lonlat0","lonlat1","dirLength","n0","projLen","_getGroundElevation","_collectCoordsBetweenTwoTrackPoints","_collectAllPoints","trackCoords","planeDistance","isWarningOrCollision","startcollecting","counter","_calcPointsAsync","setRange","profilecollected","_setPointsType","FILL_COLOR","TRACK_COLOR","TERRAIN_COLOR","TERRAIN_FILL_COLOR","WARNING_COLOR","COLLISION_COLOR","LINE_COLORS","TERRAIN_ALPHA","LINE_WIDTH","ELEVATIONPROFILEVIEW_EVENTS","ElevationProfileView","$canvas","pointerDistance","_leftDistance","_rightDistance","groundData","drawData","trackData","groundPoiIndex","gp0","gp1","groundElv","trackPoiIndex","tp0","tp1","trackElv","dblclick","_customFrame","_clickLeftDistance","_clickRightDistance","_onCanvasMouseMove","pointsReady","$pointerCanvas","redrawPointerCanvas","clearPointerCanvas","distanceOffset","_pixelsInMeter_x","setFrame","padDist","distanceCenterOffsetX","leftDistance","rightDistance","_pixelsInMeter_y","pointerEvents","_pointerCtx","$loading","_timeStartHandler","canvasScale","_hideLoading","_showLoading","clearCanvas","trackY","groundY","pointer","arc","fill","devicePixelRatio","distStr","grd","createLinearGradient","addColorStop","_drawTrack","_drawTerrain","_drawWarningAndCollision","_drawLabels","yt","trackLength","prevP","aa","bb","yg","tracklength","groundLength","closePath","globalAlpha","groundlength","warningLength","collisionLength","pi0","pi1","warninglength","collisionlength","groundObj3d","headObj3d","POINTER_RAY_OPTIONS","POINTER_BILLBOARD_OPTIONS","POINTER_LABEL_OPTIONS","GROUND_POINTER_OPTIONS","HEAD_POINTER_OPTIONS","ElevationProfileScene","_onLClick","addGroundPoint3vAsync","_pickedGroundEntity","_startClickPos","_startEntityPos","groundCart","setGroundPointCartesian3v","_pickedHeadEntity","groundEntity","groundNormal","headPos","setHeadPointCartesian3v","_onGroundPointerEnter","_onGroundPointerLeave","_onGroundPointerLDown","_clampToGround","_onGroundPointerLUp","_onHeadPointerEnter","_onHeadPointerLeave","_onHeadPointerLDown","_onHeadPointerLUp","ELEVATIONPROFILESCENE_EVENTS","_groundPointersLayer","_headPointersLayer","_columnPointersLayer","_heightsLayer","_pointerHeadEntity","_pointerLabelEntity","_pointerRayEntity","_pointerLayer","minLon","minLat","maxLon","maxLat","surfaceNormal","headCart","columnEntity","headEntity","heightLabelEntity","lonLatEll","setPointerVisibility","getPointsLonLat","hGnd","hMsl","getHeightMSL","lonLatArr","addPointLonLatAsync","ellLonLat","ellPos","_createGroundPointer","appendPoint3v","getHeightELLAsync","hEll","addpoint","_addPoint","entityIndex","__tempVec__","nj","isEntityInside","RESET_SVG_ICON","LIST_SVG_ICON","LOCATION_SVG_ICON","ELEVATIONPROFILEBUTTONSVIEW_EVENTS","ElevationProfileButtonsView","pointListBtn","resetBtn","locationBtn","LIST_TEMPLATE","PointListDialog","_onApplyClick","coordsArr","JSON","parse","$textarea","addPointLonLatArrayAsync","error","applyBtn","ElevationProfileLegend","$groundValue","$trackValue","$warningValue","$collisionValue","$trackUnits","$groundUnits","$warningUnits","$collisionUnits","warningDist","collisionDist","ElevationProfileControl","_onSceneChange","_collectProfileThrottled","_onElevationProfilePointer","elevation","lonLat0","_elevationProfileScene","getPointLonLat","cart0","cart1","setPointerCartesian3v","_onElevationProfileDblClick","poi","flyDistance","_onElevationProfileMouseEnter","_elevationProfileView","_onElevationProfileMouseLeave","_elevationProfileLegend","_elevationProfileButtonsView","_graphView","_poiListDialog","collectProfile","setTrackLength","setGroundLength","setWarningLength","setCollisionLength","AtmosphereConfig","$maxOpacity","$minOpacity","$rayleight","$mie","$height","$bottomRadius","$mieScatteringCoefficient","$mieExtinctionCoefficient","$rayleighScatteringCoefficientA","$rayleighScatteringCoefficientB","$rayleighScatteringCoefficientC","$ozoneAbsorptionCoefficientA","$ozoneAbsorptionCoefficientB","$ozoneAbsorptionCoefficientC","$sunAngularRadius","$sunIntensity","$groundAlbedo","$ozoneDensityHeight","$ozoneDensityWide","_maxOpacity","_minOpacity","_rayleight","_mie","_bottomRadius","_mieScatteringCoefficient","_mieExtinctionCoefficient","_rayleighScatteringCoefficientA","_rayleighScatteringCoefficientB","_rayleighScatteringCoefficientC","_ozoneAbsorptionCoefficientA","_ozoneAbsorptionCoefficientB","_ozoneAbsorptionCoefficientC","_ozoneDensityHeight","_ozoneDensityWide","_sunAngularRadius","_sunIntensity","_groundAlbedo","_parameters","ATMOS_HEIGHT","RAYLEIGH_SCALE","MIE_SCALE","GROUND_ALBEDO","BOTTOM_RADIUS","rayleighScatteringCoefficient_0","rayleighScatteringCoefficient_1","rayleighScatteringCoefficient_2","mieScatteringCoefficient","mieExtinctionCoefficient","ozoneAbsorptionCoefficient_0","ozoneAbsorptionCoefficient_1","ozoneAbsorptionCoefficient_2","SUN_ANGULAR_RADIUS","SUN_INTENSITY","ozoneDensityHeight","ozoneDensityWide","atmosphereControl","parameters","setParameters","X_COLOR","SEL_X_COLOR","Y_COLOR","SEL_Y_COLOR","Z_COLOR","SEL_Z_COLOR","XZ_COLOR","SEL_XZ_COLOR","SCALE","SCALE_VEC","TIP_LENGTH","TIP_RADIUS","SPIN_RADIUS","lineObj","tipObj","ArrowEntity","trans","tip","setTranslate3v","setColorHTML","MoveAxisEntity","_init","arrowX","opName","noEdit","selectColor","arrowY","arrowZ","getAbsoluteRotation","planeObj","createPlane","MovePlaneEntity","planeXZ","SEG_SIZE","VISIBLESPHERE_DOT_THRESHOLD","pitchCoords","yawCoords","rollCoords","RotateEntity","qNorthFrame","pitch_p","yaw_p","roll_p","dir_pitch","dir_yaw","dir_roll","setVisibleSphere","AxisTrackEntity","lonColors","latCoords","yColors","lonCol","yCol","latCol","op","axisX","axisY","axisZ","yCoords","lonCoords","setPathLonLatFast","setPath3vFast","zCoords","xCoords","dragSimpleRes","unit","clickDir","clickCart","dragCart","dragVec","GeoObjectEditorScene","_onAxisLayerMouseEnter","_onAxisLayerMouseLeave","_onAxisLayerLUp","_selectedMove","_navActivate","_setAxisTrackVisibility","_onAxisLayerLDown","_clickPos","_selectedEntity","_selectedEntityCart","_navDeactivate","_onPlaneLayerMouseEnter","_onPlaneLayerMouseLeave","_onPlaneLayerLUp","_onPlaneLayerLDown","_onRotateLayerMouseEnter","_onRotateLayerMouseLeave","_onRotateLayerLUp","_onRotateLayerLDown","_selectedEntityPitch","_selectedEntityYaw","_selectedEntityRoll","_ops","_moveX","currCart","_ellipsoid","p0_lonLat","px_lonLat","_moveY","_axisEntity","getY","_moveZ","_moveXZ","_moveXY","_moveZY","_rotatePitch","c0","c1","sig","_rotateYaw","_rotateRoll","_scaleX","_scaleY","_scaleZ","GEOOBJECTEDITORCENE_EVENTS","_planeEntity","_rotateEntity","_axisTrackEntity","_moveLayer","_planeLayer","_rotateLayer","_axisTrackVisibility","_axisTrackLayer","move_x","move_y","move_z","move_xz","move_xy","move_zy","rotate_pitch","rotate_yaw","rotate_roll","scale_x","scale_y","scale_z","_addAxisLayers","_removeAxisLayers","unlockView","readyToEdit","unselect","selectedEntity","getSelectedEntity","camLock","CameraLock","lockView","Input","_setValue","_maxFixed","Checkbox","checked","_checked","_disabled","disabled","_updateDisabled","isChecked","GeoObjectPropertiesDialog","_onVisibility","vis","_onUnselect","_onChangeRelativePosition","_onPosition","_onPitch","_pitchView","_absolutePitchView","_onYaw","_yawView","_absoluteYawView","_onRoll","_rollView","_absoluteRollView","_onChangeLon","setLonLat2","_onChangeLat","_onChangeHeight","_onChangeX","_onChangeY","_onChangeZ","_onChangeAbsoluteX","setAbsoluteCartesian","_onChangeAbsoluteY","_onChangeAbsoluteZ","_onChangePitch","_onChangeYaw","_onChangeRoll","_onChangeAbsolutePitch","_onChangeAbsoluteYaw","_onChangeAbsoluteRoll","_onChangeScale","_scaleXView","_scaleYView","_scaleZView","_onChangeScaleX","_onChangeScaleY","_onChangeScaleZ","_onGround","_heightView","_relativePositionView","_lonView","_latView","_xView","_yView","_zView","_absXView","_absYView","_absZView","_scaleView","_groundBtn","_initSceneEvents","$toolbar","cameraLockBtn","_clearSceneEvents","scl","MIN_LOCK_DISTANCE","MIN_VIEW_DISTANCE","CameraLockEvents","_onLockViewDraw","_lockEntity","_isFromTheBack","viewDistance","_lockDistance","rightButtonDown","_viewDir","isVisibleDistance","fromTheBack","_getDistance","_deactivateLockViewEvents","_deactivateNav","_activateLockViewEvents","lockview","simpleNavigation","_activateNav","unlockview","_getCenterDist","prevEntity","camDist","lockEntity","GeoObjectEditor","_geoObjectEditopScene","ITEM_TEMPLATE","Object3dItemView","Object3dCollectionView","_onAdd","_addItem","_activeView","itemView","getItems","ICON_LOAD_BUTTON_SVG","Object3dManagerDialog","_onLoadClick","fileInp","files","find","endsWith","_addObject","_object3dCollectionView","addItem","loadBtn","Object3dCollection","_items","createItemsMap","has","Object3dManager","_currentItem","_createEntity","_collection","childEntity","CameraFrameHandler","frameBuffer","_composer","_composerIndex","composer","_handlers","CameraFrameComposer","_onPostdraw","Axes","axesBuffer","axesColorBuffer","createAxesBuffer","LINES","aVertexColor","axesShader","NewIndexesTypedArray","NewIndexesTypedArrayEmpty","createCenterBodyIndexes","i1","j1","ind1","ind2","nr","createWestNeighborSkirt","deltaGr","grCount","rind","lind","createNorthNeighborSkirt","createEastNeighborSkirt","createSouthNeighborSkirt","rb","lb","initIndexesBodySkirts","table","initIndexBodiesTable","createTextureCoords","Uint16Array","SegmentHelper","maxGridSize","_maxGridSize","centerIndexesTable","skirtsIndexesTable","sidesSizes","instance","getInstance","drawnode_screen_nl_vert_default","drawnode_screen_nl_frag_default","drawnode_screen_wl_webgl1NoAtmos_vert_default","drawnode_screen_wl_webgl1NoAtmos_frag_default","drawnode_screen_wl_webgl2Atmos_vert_default","drawnode_screen_wl_webgl2Atmos_frag_default","drawnode_screen_wl_webgl2NoAtmos_vert_default","drawnode_screen_wl_webgl2NoAtmos_frag_default","drawnode_colorPicking_vert_default","drawnode_colorPicking_frag_default","drawnode_depth_vert_default","drawnode_depth_frag_default","drawnode_screen_nl","samplerCount","tileOffsetArr","layerOpacityArr","aTextureCoord","drawnode_screen_nl_vert","drawnode_screen_nl_frag","drawnode_screen_wl_webgl1NoAtmos","uGlobalTextureCoord","uNormalMapBias","uNormalMap","nightTexture","specularTexture","lightPosition","camHeight","drawnode_screen_wl_webgl1NoAtmos_vert","drawnode_screen_wl_webgl1NoAtmos_frag","drawnode_screen_wl_webgl2NoAtmos","transitionOpacity","drawnode_screen_wl_webgl2NoAtmos_vert","drawnode_screen_wl_webgl2NoAtmos_frag","drawnode_screen_wl_webgl2Atmos","atmosParams","transmittanceTexture","scatteringTexture","maxMinOpacity","drawnode_screen_wl_webgl2Atmos_vert","drawnode_screen_wl_webgl2Atmos_frag","drawnode_colorPicking","pickingMaskArr","drawnode_colorPicking_vert","drawnode_colorPicking_frag","drawnode_depth","drawnode_depth_vert","drawnode_depth_frag","transmittance_vert_default","transmittance_frag_default","scattering_vert_default","scattering_frag_default","transmittance","a_position","transmittance_vert","transmittance_frag","scattering","scattering_vert","scattering_frag","BaseFramebuffer","_fbo","_depthComponent","depthComponent","_useDepth","useDepth","_depthRenderbuffer","_filter","forceDestroy","isComplete","checkFramebufferStatus","FRAMEBUFFER","FRAMEBUFFER_COMPLETE","bindFramebuffer","framebufferStack","popPrev","ImageCanvas","_canvas","_context","willReadFrequently","getCanvas","imgd","getImageData","pixels","putImageData","imageData","createImageData","drawImage","toDataURL","measureText","onload","openImage","dataUrl","windowContent","printWin","open","write","focus","TypeArrayConstructor","UNSIGNED_BYTE","clientWaitAsync","sync","flags","clientWaitSync","WAIT_FAILED","TIMEOUT_EXPIRED","Framebuffer","readPixelBuffersAsync","_skipFrame","pb","pixelBuffers","pbi","PIXEL_PACK_BUFFER","bufferData","byteLength","STREAM_READ","readBuffer","glAttachment","readPixels","RGBA","glType","fenceSync","SYNC_GPU_COMMANDS_COMPLETE","flush","deleteSync","getBufferSubData","_targets","createTargets","targets","_renderbufferTarget","renderbufferTarget","textures","attInd","pbInd","ti","attachment","internalFormat","format","pixelBufferIndex","readAsync","deleteFramebuffer","deleteRenderbuffer","createFramebuffer","attachmentArr","createEmptyTexture2DExt","att_i","_createPixelBuffer","drawBuffers","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","framebufferRenderbuffer","targetIndex","createBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","attachmentIndex","readAllPixels","imageCanvas","setData","outData","atmosphere_vert_default","atmosphere_frag_default","_transmittanceBuffer","_scatteringBuffer","rayleighScale","mieScale","groundAlbedo","bottomRadius","sunAngularRadius","sunIntensity","stringify","initLookupTexturesShaders","drawLookupTextures","removeLookupTexturesShaders","initPlanetAtmosphereShader","initAtmosphereShader","_initLookupTextures","initBackgroundShader","atmosphereBackgroundShader","removeProgram","_renderLookupTextures","positionBuffer","DEPTH_BUFFER_BIT","atmosphereBackground","TEXTURE1","sunPos","sceneFramebuffer","atmosphere_vert","atmosphere_frag","Units","METERS","Proj","code","EPSG3857","Slice","SLICE_SIZE_4","SLICE_SIZE","screenOpacity","n4","getTileCellIndex","coordinate","tileSize","worldEdge","getTileCellExtent","worldExtent","worldWidth","worldHeight","sw_lon","ne_lat","TILEGROUP_COMMON","TILEGROUP_NORTH","TILEGROUP_SOUTH","getTileGroupByLat","_v0","_v1","_v2","_v3","_ray","_rayEx","_S","_V","Segment","isPole","_tileGroup","_projection","bsphere","_plainRadius","_sw","_nw","_se","_ne","centerNormal","gridSizeByZoom","fileGridSize","powTileZoom","tileXE","tileXW","tileYN","tileYS","tileIndex","elevationData","_assignTileIndexes","plainReady","normalMapReady","terrainReady","terrainIsLoading","terrainExists","plainVertices","plainVerticesHigh","plainVerticesLow","plainNormals","terrainVertices","terrainVerticesHigh","terrainVerticesLow","tempVertices","tempVerticesHigh","tempVerticesLow","normalMapTexture","normalMapTextureBias","normalMapVertices","normalMapVerticesHigh","normalMapVerticesLow","normalMapNormals","vertexNormalBuffer","vertexPositionBuffer","vertexPositionBufferHigh","vertexPositionBufferLow","vertexTextureCoordBuffer","_globalTextureCoordinates","_inTheQueue","_appliedNeighborsZoom","_slices","readyToEngage","plainProcessing","normalMapTexturePtr","_transitionOpacity","_transitionTimestamp","checkZoom","_maxNodeZoom","getInsideLonLat","xyz","insideSegmentPosition","sxn","syn","xn","yn","indX","indY","ind_v0","ind_v2","hitTriangleRes","hitRay","elevationsNotExists","loadTerrain","elevations","_elevations","equalizeVertices","appliedTerrainNodeId","equalizedSideWithNodeId","neighborSide","neigborNode","equalize","nn","neighbors","gsOne","_checkEqualization","getOffsetOppositeNeighbourSide","nv","nvHigh","nvLow","n_gs","n_gsOne","inc","n_inc","n_offset","nk","n_index","createCoordsBuffers","setBoundingVolumeArr","nmc","nns","getEqualNeighbor","seg_a","seg_b","seg_a_raw","seg_b_raw","s_gs","s_gs1","i_a","i_b","vInd_a","vInd_b","elevationsExists","deleteBuffers","deleteMaterials","mi","deleteElevations","childrenInitialized","clearSegment","_setExtentLonLat","coord_sw","coord_ne","coord_nw","coord_se","_createExtentNormals","setBoundingVolume3v","pnGsOne","ind_sw","ind_nw","ind_ne","ind_se","pVerts","v_sw","v_ne","v_nw","v_se","pseg","insideSize","t_i0","t_j0","bigOne","v_lt","v_rb","vw","vi_y","vi_x","coords_lt","coords_rb","createBoundsByExtent","vmin","vmax","gsgs","_textureCoordsBufferCache","_addViewExtent","viewExt","_viewExtent","pole","mercator.POLE","plainGridSize","sideSizeLog2","_assignGlobalTextureCoordinates","mercator.ONE_BY_POLE_DOUBLE","plainRadius","createPlainSegment","_createPlainVertices","fgs","currGridSize","lonSize","latSize","llStep","ltStep","esw_lon","ene_lat","dg","gridSize3","nmInd","vertsHigh","vertsLow","norms","nmVerts","nmVertsHigh","nmVertsLow","nmNorms","_projToDeg","nxl","nyl","nzl","layerSlice","isOverlay","forcedOpacity","currHeight","initSlice","_getIndexBuffer","layerOverlap","append","_samplerArr","transitionTime","_pickingMaskArr","cache","_indexesCache","segmentHelper.getInstance","createSegmentIndexes","_vertOrder","_neGridSize","BOUNDS","__staticCounter","Node$1","SegmentPrototype","partId","state","prevState","_cameraInside","inFrustum","createBounds","ps","size_x","size_y","nd","setBoundingSphere","createBoundsByParent","part","pathId","terrainReadySegment","stopLoading","zoomPassNode","createChildNodes","renderTree","clearNeighbors","_insideSegment","frustums","numFrustums","containsSphere","containsBox","horizonDist","_heightFactor","altVis","distance2","collectVisibleNode","traverseNodes","projectedSize","_maxLodSize","onlyTerrain","whileTerrainLoading","createPlainSegmentAsync","whileNormalMapCreating","addToRender","isFading","timestamp","childrenPrevStateEquals","_refreshTransitionOpacity","increaseTransitionOpacity","_transitionOpacityEnabled","getRenderedNodesNeighbors","rf","_renderedNodesInFrustum","opcs","ap","ld","cs_size","opcs_size","cs","getCommonSide","applyNeighbor","as","bs","getNeighborSide","a_ne","a_sw","b_ne","b_sw","a_ne_lon","a_ne_lat","a_sw_lon","a_sw_lat","b_ne_lon","b_ne_lat","b_sw_lon","b_sw_lat","gridSizeExt","vi_x_is","vi_y_is","i3","setBoundingVolume","fgsZ","destroySegment","nij","destroyBranches","clearTree","clearBranches","nodesToRemove","traverseTree","neighbourNode","pNode","neighbourZoom","QueueArray","_array","_popIndex","_shiftIndex","shift","EntityCollectionsTreeStrategy","_secondPASS","_deferredEntitiesPendingQueue","_renderingNodes","_execDeferredNode","applyCollection","QuadTreeStrategy","projection","_quadTreeList","_visibleNodes","mats","preRender","quadTree","normalMapCreator","drawSingle","_clearVisibleNodes","sizeImgW","sizeImgH","EPSG4326","MAX_POLE_ZOOM","POLE_PIECE_SIZE","SegmentLonLat","maxPoleZoom","Yz","_getMaxZoom","_assignTileXIndexes","_assignTileYIndexes","EntityCollectionNode","strategy","_setExtentBounds","buildTree","_quadNode","setFromExtent","cn","en_nw","en_ne","en_sw","en_se","_addEntitiesToCollection","visibleNodes","renderCollection","collectRenderCollectionsPASS1","renderingNodeId","collectRenderCollectionsPASS2","_queueDeferredNode","alignEntityToTheGround","EarthEntityCollectionNodeLonLat","isNorth","_renderingNodesNorth","_renderingNodesSouth","renderingNode","EarthEntityCollectionsTreeStrategy","_entityCollectionsTree","quadTree.NW","_entityCollectionsTreeNorth","_entityCollectionsTreeSouth","__setLonLat__","northEntities","southEntities","mercEntities","pqs","_visibleNodesNorth","_visibleNodesSouth","EarthQuadTreeStrategy","tg","merc","mercator.forward","mercator.POLE2","Geoid","_cached_ix","_cached_iy","_v00","_v01","_v10","_v11","_t","status","arrayBuffer","rawfile","getline","fromCharCode","match","levels","payload_len","rlonres","rlatres","ix","iy","fy","fx","_rawval","GeoImageCreator","maxFrames","MAX_FRAMES","_framebufferMercProj","_currentFrame","_queue","_quadTexCoordsBuffer","_quadVertexBuffer","_initShaders","_initBuffers","toMerc","v03","v12","v01","v32","halfSize","gridHigh","gridLow","kh","kl","P03i","P12i","P01j","P32j","utils.getLinesIntersectionLonLat","geoImage","LOADER_EVENTS","Loader","maxRequests","_loading","_senderRequestCounter","_promises","json","blob","imageBitmap","createImageBitmap","premultiplyAlpha","__requestCounterFrame__","catch","msg","request","_checkLoadend","_handleResponse","abortAll","NormalMapCreator","_minTabelSize","minTableSize","_maxTableSize","maxTableSize","_verticesBufferArray","_indexBufferArray","_positionBuffer","_normalMapVerticesTexture","normalMapBlur","s_texture","normalMap","a_normal","gs2","positions","quadTree.NOTRENDERING","indBuf","equalizeNormals","_normalMapEdgeEqualize","quadTree.N","quadTree.S","quadTree.W","quadTree.E","outTexture","isBlur","_drawNormalMapBlur","_drawNormalMapNoBlur","BLEND","_drawNormalMap","startTime","equi","PlainSegmentWorker","PlainSegmentWorkerImpl","_plainSegmentWorkerCallback","isLonLat","planeNormalize","Frustum","_pickingColorU","inverseProjectionMatrix","projectionViewRTEMatrix","inverseProjectionViewMatrix","cameraFrustumIndex","setProjectionMatrix","aspect","getBackwardPlane","getInverseProjectionMatrix","setPerspective","inverseTo","viewRTEMatrix","dotArr","cout","cin","getHorizontalViewAngleByFov","Camera","_viewAngle","_horizontalViewAngle","_viewMatrix","_viewMatrixRTE","_normalMatrix","_pr","_pu","_pb","_peye","isMoving","_tanViewAngle_hrad","frustumColors","fi","fr","getAspectRatio","FARTHEST_FRUSTUM_INDEX","currentFrustumIndex","_projSizeConst","moveend","_setProj","getDown","setViewMatrix","setProjectionViewRTEMatrix","viewchange","_updateViewportParameters","verticalViewAngle","du","dv","dn","sn","world1","mulVec4","affinity","world2","project","isArc","trm","getRotationAroundPoint","frustum","newPos","setViewAngle","PlanetCamera","_terrainAltitude","_terrainPoint","_framesArr","_framesCounter","_numFrames","_completeCallback","_frameCallback","_flying","updateGeodeticPosition","lookLonLat","newLook","north","getNorth","south","getSouth","east","getEast","west","getWest","southEast","northWest","_h","_w","tanPhi","tanTheta","getExtentPosition","ampl","completeCallback","startCallback","frameCallback","newUp","ground_a","v_a","n_a","lonlat_b","up_b","ground_b","n_b","u_b","v_b","bn","anbn","hM_a","math.SQRT_HALF","currMaxHeight","max_h","zero","g_i","smerp","ground_i","getRayIntersectionEllipsoid","height_i","eye_i","up_i","look_i","frameCallbak","stopDragging","spin","dSlope","checkFly","setAltitude","equatorialSizeSqr","qFrame","TerrainWorker","TerrainWorkerImpl","_terrainWorkerCallback","info","this_plainVertices","this_plainNormals","this_normalMapVertices","this_normalMapNormals","heightFactor","noDataValues","MAX_FRAME_TIME","VectorTileCreator","vectorTileLineRasterization","thicknessOutline","vectorTilePolygonRasterization","coordinatesHigh","coordinatesLow","hLine","hPoly","_w2","_h2","createEmptyTexture_n","geomHandler","mb","CUR_LOD_SIZE","MIN_LOD_SIZE","MAX_LOD_SIZE","MAX_NODES","HORIZON_TANGENT","Planet","_renderingFadingNodes","currentNode","sl","outTransparentSegments","outOpaqueSegments","isEq","engage","screenRendering","_renderingFadingNodesNoDepth","_atmosphere","atmosphereParameters","_prevNodes","_currNodes","_updateLayer","visibleVectorLayers","_visibleVectorLayersByDepthOrder","_visibleTileLayerSlices","_visibleEntityCollections","maxEqualZoomAltitude","minEqualZoomAltitude","minEqualZoomCameraSlope","mousePositionOnEarth","emptyTexture","_skipPreRender","_initialViewExtent","_fadingNodesInFrustum","_fadingOpaqueSegments","_indexesCacheToRemove","quadTreeStrategyPrototype","_nightTexture","_specularTexture","SLICE_SIZE_3","_lodSize","_curLodSize","_minLodSize","maxLoadingRequests","_memKey","PLANET_EVENTS","_prevCamEye","always","_collectRenderNodesIsActive","_renderScreenNodesPASS","_renderScreenNodesPASSNoAtmos","_renderScreenNodesWithHeightPASS","_renderScreenNodesWithHeightPASSNoAtmos","_atmosphereEnabled","_atmosphereMaxMinOpacity","_nightTextureSrc","nightTextureSrc","_specularTextureSrc","specularTextureSrc","transitionOpacityEnabled","getNorthFrameRotation","enabled","_initializeAtmosphere","currentLodSize","minLodSize","maxLodSize","cArr","layervisibilitychange","baselayerchange","_clearRenderedNodeList","_clearRenderNodesInFrustum","memClear","clearCache","_geoid","setGeoid","getGeoid","loadModel","setModel","isWebGl2","shaders.drawnode_screen_wl_webgl2Atmos","_renderScreenNodesPASSAtmos","_renderScreenNodesWithHeightPASSAtmos","shaders.drawnode_screen_wl_webgl1NoAtmos","shaders.drawnode_screen_wl_webgl2NoAtmos","_initializeShaders","shaders.drawnode_screen_nl","shaders.drawnode_colorPicking","shaders.drawnode_depth","_renderColorPickingFramebufferPASS","addDepthCallback","_renderDepthFramebufferPASS","setMaxGridSize","TABLESIZE","ptr","texCoordCache","initTextureCoordsTable","createDefaultTexture","_updateVisibleLayers","_globalPreDraw","_preRender","_checkRendercompleted","initLayers","bindFrustumsPickingColors","preLoad","param0","param1","_getLayerAttributionHTML","_applyAttribution","createDefaultTextures","_sortLayers","attributions","temp2","ht","isEnabled","math.lerp","collectRenderNodes","_collectRenderedNodesMaxZoom","opaqueNodes","_collectFadingNodes","rij","_setUniformsNoAtmos","_renderingScreenNodes","_setUniformsAtmos","_renderingScreenNodesWithHeight","_clearIndexesCache","_collectRenderNodes","_collectVectorLayerCollections","rendercompleted","terraincompleted","setTerrainCollisionActivity","enableBlendOneSrcAlpha","drawnode_screen_wl","renderedNodes","firstPass","sli","_refreshFadingOpacity","transparentSegments","tj","POLYGON_OFFSET_FILL","slj","polygonOffset","getCurrentFrustum","colorPickingRendering","enableBlendDefault","depthRendering","group","collectVisibleCollections","getDistanceFromPixelEllipsoid","extentArr","min_lon","min_lat","max_lon","max_lat","readyCollections","each","EarthNavigation","skybox","uSampler","enableArray","SkyBox","createDefault","RESOURCES_URL","shaders.skybox","loadCubeMapTexture","buf","EmptyTerrain","geoidSrc","ur","checkNoDataValue","maxNodeZoom","GlobusTerrain","_s","subdomains","GLOBUSTERRAIN_EVENTS","_requestCount","_requestsPeerSubdomain","_dataType","_elevationCache","_fetchCache","_loader","_urlRewriteCallback","urlRewrite","heights","tileData","firstAttempt","getTileXY","getElevationCache","_getGroundHeightMerc","buildURL","_createHeights","setElevationCache","v0Ind","v1Ind","v2Ind","v3Ind","h2","h3","v3","isReadyToLoad","_applyElevationsData","_getHTTPRequestString","_getSubdomain","_createUrl","isMaxZoom","applyTerrain","XYZ","XYZ_EVENTS","_requestsPeerSubdomains","getRequestCounter","abort","_checkSegment","em","ENLARGE_MERCATOR_LON","ENLARGE_MERCATOR_LAT","WMS","_extra","extra","imageWidth","imageHeight","_getBbox","get_bbox_v1_1_1","_version","setVersion","version","srs","get_bbox_v1_3_0","createRequestUrl","BilTerrain","_format","_imageSize","preventChildren","bil16","Int16Array","extractElevationTilesNonPowerOfTwo","elevationsSize","rightHeight","bottomHeight","isNoDataCurrent","isNoDataRight","isNoDataBottom","isNoDataRightBottom","RgbTerrain","_createTemporalCanvas","_imageDataCache","_minHeight","_resolution","SIZE","availableParentTileX","availableParentTileY","availableParentTileZoom","availableParentData","skipPositiveHeights","extractElevationTilesRgbNonPowerOfTwo","availableParentOffsetX","availableParentOffsetY","availableZoomDiff","getTileOffset","extractElevationSimple","extractElevationTilesRgb","getChildTileIndex","extractElevationTilesRgbNoChildren","qts","getLonLatTileOffset","rgb2Height","isNoData","fromInd4","getParentHeight","i4","currentTileX","currentTileY","currentTileZoom","sourceSize4","k4","parentTileX","parentTileY","parentTileZoom","dz2","currentParentTileX","currentParentTileY","currentParentTileZoom","childOffsetX","childOffsetY","oneByDz2","parentGridSize","pj","urlPref","urlRewriteFunc","GlobusRgbTerrain","GeoImage","_onLoad_","HTMLImageElement","_onLoad","_applyImage","createTexture_l","ev","GeoTexture2d","frameWidth","frameHeight","GeoVideo","_video","videoElement","video","texImage2D","createTexture_n_webgl1","videoWidth","videoHeight","readyState","HAVE_ENOUGH_DATA","_onCanPlay","_onError","autoplay","loop","muted","setAttribute","KML","_billboard","xmlDoc","raw","getElementsByTagName","rawText","textContent","co","agbr","placemark","nameTags","iconHeading","iconURL","iconColor","_extractStyle","lonLats","_parseKMLcoordinates","lonlatalt","hdgrad","iconstyle","_AGBRtoRGBA","hdg","href","linestyle","documentElement","_kmlPlacemarkToEntity","_parseKML","addToExtent","_pathes","kmlFile","fileReader","FileReader","DOMParser","parseFromString","readAsText","extent1","extent2","addKmlFromFiles","kmls","kmlObjs","_getXmlContent","coordonates","_extractCoordonatesFromKml","_convertCoordonatesIntoEntities","_expandExtents","XMLHttpRequest","responseType","overrideMimeType","DONE","responseXML","send","kml","_getKmlFromUrl","_convertKMLintoEntities","OpenStreetMap","toQuadKey","mask","Bing","quad","CLOCK_EVENTS","Clock","__handler","jd.DateToUTC","_multiplier","_running","deltaTicks","_intervalDelay","_intervalStart","_intervalCallback","delay","jd.ONE_BY_MILLISECONDS_PER_DAY","jd.UTCtoDate","cd","jd.addMilliseconds","tick","ProgramController","_activated","activeProgram","enableAttribArrays","drawIndexBuffer","Stack","_head","vendorPrefixes","CONTEXT_TYPE","MAX_LEVELS","Handler","canvasTarget","drawFrame","prevDeltaTime","_lastAnimationFrameTime","_clocks","_params","hidden","_throttledDrawFrame","_canvasSize","anisotropy","extensions","context","_canvasTarget","createTexture_n","createTexture_n_webgl2","createTexture_l_webgl2","createTexture_mm","createTexture_mm_webgl2","createTexture_a","createTexture_a_webgl2","NEAREST","LINEAR","MIPMAP","ANISOTROPIC","ONCANVASRESIZE","_createCanvas","contextAttributes","ver","level","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","texParami","CLAMP_TO_EDGE","generateMipmap","LINEAR_MIPMAP_LINEAR","texParameterf","EXT_texture_filter_anisotropic","TEXTURE_MAX_ANISOTROPY_EXT","texStorage2D","texSubImage2D","faces","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_Z","fillEmpty","emptyImage","notActivate","_initProgramController","programsArr","extensionStr","showLog","initializeExtension","createTexture_l_webgl1","createTexture_mm_webgl1","createTexture_a_webgl1","_initPrograms","_setDefaults","intersectionObserver","_toggleVisibilityChange","threshold","resizeObserver","contentRect","visibilityState","frontFace","CCW","cullFace","BACK","getCanvasSize","usage","STREAM_DRAW","bufferSubData","STATIC_DRAW","pr","getClientAspect","clearFrame","isStopped","success","imgCnv","numAttribs","getParameter","MAX_VERTEX_ATTRIBS","numTextureUnits","MAX_TEXTURE_IMAGE_UNITS","DITHER","SCISSOR_TEST","blendColor","blendEquation","FUNC_ADD","blendFunc","ONE","clearDepth","clearStencil","clockArr","addClock","Multisample","_msaa","msaa","_glFilter","renderbuffers","colorAttachments","renderbufferStorageMultisample","DEPTH_ATTACHMENT","framebuffer","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","clearBufferfv","COLOR","blitFramebuffer","STAMP_SPACER","_sortByPriority","KeyboardHandler","_currentlyPressedKeys","_pressedKeysCallbacks","_unpressedKeysCallbacks","_charkeysCallbacks","_anykeyCallback","_event","onkeydown","handleKeyDown","onkeyup","handleKeyUp","getcurrentlyPressedKeys","getUnpressedKeysCallbacks","getCharkeysCallbacks","keyCode","_removeCallback","activity","ch","ccl","pk","cpk","handleEvents","_checkTouchPad","deltaMode","deltaY","MouseHandler","htmlObject","_htmlObject","detail","TouchHandler","eventExt","createRendererEvents","RendererEvents","LB_M","RB_M","MB_M","ISBLACK","NOTBLACK","_currPickingColor","_tempCurrPickingColor","_prevPickingColor","RENDERER_EVENTS","_touchHandler","_mouseHandler","_keyboardHandler","clickRadius","leftButtonUp","rightButtonUp","middleButtonUp","middleButtonDown","middleButtonHold","leftButtonDoubleClick","rightButtonDoubleClick","middleButtonDoubleClick","leftButtonClick","rightButtonClick","middleButtonClick","justStopped","doubleClickDelay","clickDelay","touchState","touchEnd","touchStart","touchCancel","doubleTouch","doubleTouchDelay","doubleTouchRadius","_isMouseInside","_entityPickingEventsActive","_dblTchCoords","_oneTouchStart","_dblTchBegins","_mousestopThread","_ldblClkBegins","_rdblClkBegins","_mdblClkBegins","_lClkBegins","_rClkBegins","_mClkBegins","_lclickX","_lclickY","_rclickX","_rclickY","_mclickX","_mclickY","pointerEvent","ts","setActivity","handleMouseEvents","handleTouchEvents","entityPickingEvents","keyPriority","addEvent","removeEvent","setEvent","onMouseUp","onMouseDown","deltatime","dY","getPickingObjectArr","pe","readPickingColor","po","ce","_this","mousestop","tpo","tpe","depthTexture","Rectangle","getSquare","ImagesCacheManager","imagesCache","_imageIndexCounter","req","onerror","TextureAtlas","_images","_btree","_imagesCacheManager","borderSize","atlasWidth","atlasHeight","fastInsert","_makeAtlas","im","_completeNode","insert","TextureAtlasNode","atlas","newNode","rc","fit","dw","dh","MAX_SIZE","FontTextureAtlas","gliphSize","distanceRange","FontTextureAtlasNode","emptySize","chnl","page","xadvance","xoffset","yoffset","nChar","nCode","FontAtlas","catalogSrc","atlasIndexes","atlasIndexesDeferred","tokenImageSize","fullName","getFullIndex","loadFont","chars","common","scaleH","scaleW","distanceField","idToChar","taNode","ciNorm","ciCode","ki","amount","faceName","dataJson","imageBase64","_applyFontDataToAtlas","srcDir","atlasUrl","pages","screenFrame","tone_mapping_vert_default","tone_mapping_frag_default","toneMapping","hdrBuffer","whitepoint","tone_mapping_vert","tone_mapping_frag","MSAA_DEFAULT","__pickingCallbackCounter__","__depthCallbackCounter__","_tempDepth_","Renderer","dpi","brightThreshold","colorObjects","_pickingCallbacks","pickingFramebuffer","_depthCallbacks","depthFramebuffer","msaaParam","toneMappingFramebuffer","geoObjectsTextureAtlas","fontsSrc","_entityCollections","_currentOutput","_fnScreenFrame","screenDepthFramebuffer","screenTexture","outputTexture","_readPickingBuffer","_readPickingBuffer_webgl2","ONE_MINUS_SRC_ALPHA","blendFuncSeparate","SRC_ALPHA","changerelativecenter","setFrameCallback","_readPickingBuffer_webgl1","_screenFrameNoMSAA","screen","_maxMSAA","getMaxMSAA","addPrograms","_screenFrameMSAA","_resizeStart","_resizeEnd","resizeend","_initializeRenderNodes","_initializeControls","screenName","setViewportSize","setCurrentScreen","logWrn","renderNodeBefore","nodesArr","samples","getInternalformatParameter","SAMPLES","getMSAA","ecArr","eci","drawDepth","checkMoveEnd","mouseFree","setCurrentFrustum","preDrawNode","drawNode","_drawEntityCollections","drawtransparent","_drawPickingBuffer","_drawDepthBuffer","_clearEntityCollectionQueue","blitTo","_readDepthBuffer","postdraw","quality","_drawPickingEntityCollections","_drawDepthEntityCollections","outColor","_tempPickingPix_","outDepth","ddd","fff","readData","readDepth","screenPos","viewPosition","DEFAULT_NIGHT_SRC","DEFAULT_SPEC_SRC","DEFAULT_RESOURCES_SRC","PLANET_NAME_PREFIX","Globe","$target","_instanceID","transition","$inner","attributionContainer","attachTo","_disableWheel","onmouseenter","capture","passive","onmouseleave","antialias","premultipliedAlpha","preserveDrawingBuffer","_planetName","resourcesSrc","setTerrain","addControls","_controls","addLayers","viewExtentArr","fadeIn","isFirst","detach","firstChild","mars","moon","POPUP_EVENTS","Popup","_content","content","$content","$tip","_cartPos","setContent","getContainer","_updatePosition","setScreen","SegmentLonLatEqui","EquiEntityCollectionNodeLonLat","_renderingNodesWest","_renderingNodesEast","EquiEntityCollectionsTreeStrategy","_entityCollectionsTreeWest","_entityCollectionsTreeEast","westEntities","eastEntities","_visibleNodesWest","_visibleNodesEast","EquiQuadTreeStrategy","_westExtent","_eastExtent","EPSG4326QuadTreeStrategy","Wgs84QuadTreeStrategy","quadTreeStrategyType","epsg4326","earth"],"mappings":"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"}